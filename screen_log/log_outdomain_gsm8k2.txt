PYTHONPATH=/home/ylu130/workspace/in-context-generalization
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 4 --seed 42 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s42-rTrue --rationales --num-out-domain 5
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-08 19:45:15,681] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s42-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 5
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s42-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 4
  clip_grad .................... 1.0
  seed ......................... 42
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                        | 0/9741 [00:00<?, ?it/s]  0%|▏                                                                             | 19/9741 [00:00<00:53, 180.76it/s]  0%|▎                                                                             | 38/9741 [00:00<00:52, 185.30it/s]  1%|▍                                                                             | 57/9741 [00:00<00:52, 182.86it/s]  1%|▌                                                                             | 76/9741 [00:00<00:54, 177.90it/s]  1%|▊                                                                             | 94/9741 [00:00<00:54, 177.82it/s]  1%|▉                                                                            | 112/9741 [00:00<00:58, 165.79it/s]  1%|█                                                                            | 131/9741 [00:00<00:55, 172.58it/s]  2%|█▏                                                                           | 150/9741 [00:00<00:54, 177.47it/s]  2%|█▎                                                                           | 168/9741 [00:00<00:54, 176.19it/s]  2%|█▍                                                                           | 186/9741 [00:01<00:54, 174.95it/s]  2%|█▌                                                                           | 204/9741 [00:01<00:57, 165.56it/s]  2%|█▋                                                                           | 221/9741 [00:01<01:01, 154.87it/s]  2%|█▉                                                                           | 240/9741 [00:01<00:57, 164.44it/s]  3%|██                                                                           | 258/9741 [00:01<00:56, 168.28it/s]  3%|██▏                                                                          | 276/9741 [00:01<00:55, 169.43it/s]  3%|██▎                                                                          | 294/9741 [00:01<00:59, 159.88it/s]  3%|██▍                                                                          | 311/9741 [00:01<00:58, 161.02it/s]  3%|██▌                                                                          | 330/9741 [00:01<00:56, 167.86it/s]  4%|██▊                                                                          | 349/9741 [00:02<00:54, 173.20it/s]  4%|██▉                                                                          | 367/9741 [00:02<00:54, 172.46it/s]  4%|███                                                                          | 385/9741 [00:02<00:54, 170.67it/s]  4%|███▏                                                                         | 403/9741 [00:02<00:55, 167.13it/s]  4%|███▎                                                                         | 421/9741 [00:02<00:55, 168.42it/s]  5%|███▍                                                                         | 440/9741 [00:02<00:53, 173.13it/s]  5%|███▋                                                                         | 459/9741 [00:02<00:52, 175.78it/s]  5%|███▊                                                                         | 477/9741 [00:02<00:53, 174.06it/s]  5%|███▉                                                                         | 495/9741 [00:02<00:53, 173.97it/s]  5%|████                                                                         | 513/9741 [00:03<00:54, 169.90it/s]  5%|████▏                                                                        | 531/9741 [00:03<00:53, 170.79it/s]  6%|████▎                                                                        | 550/9741 [00:03<00:52, 176.12it/s]  6%|████▍                                                                        | 568/9741 [00:03<00:51, 177.00it/s]  6%|████▋                                                                        | 586/9741 [00:03<00:52, 175.58it/s]  6%|████▊                                                                        | 604/9741 [00:03<00:51, 175.99it/s]  6%|████▉                                                                        | 622/9741 [00:03<00:56, 162.59it/s]  7%|█████                                                                        | 641/9741 [00:03<00:53, 169.26it/s]  7%|█████▏                                                                       | 659/9741 [00:03<00:52, 171.44it/s]  7%|█████▎                                                                       | 677/9741 [00:03<00:52, 171.57it/s]  7%|█████▍                                                                       | 695/9741 [00:04<00:53, 170.18it/s]  7%|█████▋                                                                       | 713/9741 [00:04<00:53, 168.89it/s]  8%|█████▊                                                                       | 731/9741 [00:04<00:53, 169.75it/s]  8%|█████▉                                                                       | 751/9741 [00:04<00:51, 175.77it/s]  8%|██████                                                                       | 769/9741 [00:04<00:51, 173.90it/s]  8%|██████▏                                                                      | 787/9741 [00:04<00:51, 172.95it/s]  8%|██████▎                                                                      | 805/9741 [00:04<00:51, 174.68it/s]  8%|██████▌                                                                      | 823/9741 [00:04<00:52, 171.19it/s]  9%|██████▋                                                                      | 842/9741 [00:04<00:50, 176.14it/s]  9%|██████▊                                                                      | 862/9741 [00:05<00:49, 180.75it/s]  9%|██████▉                                                                      | 881/9741 [00:05<00:49, 177.50it/s]  9%|███████                                                                      | 900/9741 [00:05<00:49, 179.78it/s]  9%|███████▎                                                                     | 919/9741 [00:05<00:50, 175.49it/s] 10%|███████▍                                                                     | 939/9741 [00:05<00:48, 180.29it/s] 10%|███████▌                                                                     | 958/9741 [00:05<00:48, 182.39it/s] 10%|███████▋                                                                     | 977/9741 [00:05<00:48, 181.38it/s] 10%|███████▊                                                                     | 996/9741 [00:05<00:47, 182.71it/s] 10%|███████▉                                                                    | 1015/9741 [00:05<00:48, 181.22it/s] 11%|████████                                                                    | 1034/9741 [00:05<00:48, 179.48it/s] 11%|████████▏                                                                   | 1052/9741 [00:06<00:48, 178.90it/s] 11%|████████▎                                                                   | 1070/9741 [00:06<00:49, 176.22it/s] 11%|████████▍                                                                   | 1089/9741 [00:06<00:48, 177.70it/s] 11%|████████▋                                                                   | 1108/9741 [00:06<00:47, 180.24it/s] 12%|████████▊                                                                   | 1127/9741 [00:06<00:49, 173.00it/s] 12%|████████▉                                                                   | 1145/9741 [00:06<00:49, 172.15it/s] 12%|█████████                                                                   | 1164/9741 [00:06<00:49, 174.45it/s] 12%|█████████▏                                                                  | 1184/9741 [00:06<00:47, 179.51it/s] 12%|█████████▍                                                                  | 1203/9741 [00:06<00:47, 181.51it/s] 13%|█████████▌                                                                  | 1222/9741 [00:07<00:49, 173.59it/s] 13%|█████████▋                                                                  | 1241/9741 [00:07<00:48, 175.89it/s] 13%|█████████▊                                                                  | 1260/9741 [00:07<00:47, 179.50it/s] 13%|█████████▉                                                                  | 1280/9741 [00:07<00:46, 183.18it/s] 13%|██████████▏                                                                 | 1300/9741 [00:07<00:45, 185.29it/s] 14%|██████████▎                                                                 | 1319/9741 [00:07<00:45, 185.55it/s] 14%|██████████▍                                                                 | 1338/9741 [00:07<00:50, 167.67it/s] 14%|██████████▌                                                                 | 1357/9741 [00:07<00:48, 173.67it/s] 14%|██████████▋                                                                 | 1377/9741 [00:07<00:46, 178.54it/s] 14%|██████████▉                                                                 | 1396/9741 [00:08<00:46, 181.33it/s] 15%|███████████                                                                 | 1415/9741 [00:08<00:45, 183.31it/s] 15%|███████████▏                                                                | 1434/9741 [00:08<00:47, 175.63it/s] 15%|███████████▎                                                                | 1453/9741 [00:08<00:46, 178.36it/s] 15%|███████████▍                                                                | 1472/9741 [00:08<00:45, 180.21it/s] 15%|███████████▋                                                                | 1492/9741 [00:08<00:44, 185.81it/s] 16%|███████████▊                                                                | 1521/9741 [00:08<00:38, 215.37it/s] 16%|████████████                                                                | 1545/9741 [00:08<00:36, 222.36it/s] 16%|████████████▏                                                               | 1568/9741 [00:08<00:37, 219.25it/s] 16%|████████████▍                                                               | 1594/9741 [00:08<00:35, 228.91it/s] 17%|████████████▋                                                               | 1623/9741 [00:09<00:32, 246.58it/s] 17%|████████████▊                                                               | 1649/9741 [00:09<00:32, 250.30it/s] 17%|█████████████                                                               | 1675/9741 [00:09<00:33, 241.39it/s] 17%|█████████████▎                                                              | 1700/9741 [00:09<00:36, 220.65it/s] 18%|█████████████▍                                                              | 1723/9741 [00:09<00:39, 203.95it/s] 18%|█████████████▌                                                              | 1744/9741 [00:09<00:40, 198.09it/s] 18%|█████████████▊                                                              | 1765/9741 [00:09<00:40, 194.80it/s] 18%|█████████████▉                                                              | 1785/9741 [00:09<00:48, 163.06it/s] 19%|██████████████                                                              | 1805/9741 [00:10<00:46, 169.80it/s] 19%|██████████████▏                                                             | 1823/9741 [00:10<00:46, 171.60it/s] 19%|██████████████▎                                                             | 1841/9741 [00:10<00:50, 157.68it/s] 19%|██████████████▍                                                             | 1858/9741 [00:10<00:49, 160.13it/s] 19%|██████████████▋                                                             | 1876/9741 [00:10<00:47, 164.12it/s] 19%|██████████████▊                                                             | 1894/9741 [00:10<00:46, 167.23it/s] 20%|██████████████▉                                                             | 1911/9741 [00:10<00:51, 153.04it/s] 20%|███████████████                                                             | 1928/9741 [00:10<00:49, 157.15it/s] 20%|███████████████▏                                                            | 1947/9741 [00:10<00:46, 166.07it/s] 20%|███████████████▎                                                            | 1965/9741 [00:11<00:46, 167.38it/s] 20%|███████████████▍                                                            | 1982/9741 [00:11<00:52, 149.05it/s] 21%|███████████████▌                                                            | 1999/9741 [00:11<00:50, 154.35it/s] 21%|███████████████▋                                                            | 2018/9741 [00:11<00:47, 163.25it/s] 21%|███████████████▉                                                            | 2037/9741 [00:11<00:45, 170.26it/s] 21%|████████████████                                                            | 2055/9741 [00:11<00:49, 155.76it/s] 21%|████████████████▏                                                           | 2072/9741 [00:11<00:49, 154.47it/s] 21%|████████████████▎                                                           | 2092/9741 [00:11<00:46, 164.48it/s] 22%|████████████████▍                                                           | 2111/9741 [00:11<00:44, 170.04it/s] 22%|████████████████▌                                                           | 2129/9741 [00:12<00:45, 167.25it/s] 22%|████████████████▋                                                           | 2146/9741 [00:12<00:47, 158.71it/s] 22%|████████████████▉                                                           | 2163/9741 [00:12<00:47, 161.01it/s] 22%|█████████████████                                                           | 2183/9741 [00:12<00:44, 169.47it/s] 23%|█████████████████▏                                                          | 2201/9741 [00:12<00:43, 172.16it/s] 23%|█████████████████▎                                                          | 2220/9741 [00:12<00:42, 174.91it/s] 23%|█████████████████▍                                                          | 2238/9741 [00:12<00:42, 175.84it/s] 23%|█████████████████▌                                                          | 2256/9741 [00:12<00:43, 172.48it/s] 23%|█████████████████▋                                                          | 2274/9741 [00:12<00:42, 174.11it/s] 24%|█████████████████▉                                                          | 2293/9741 [00:12<00:42, 177.29it/s] 24%|██████████████████                                                          | 2311/9741 [00:13<00:43, 170.77it/s] 24%|██████████████████▏                                                         | 2330/9741 [00:13<00:42, 176.18it/s] 24%|██████████████████▎                                                         | 2348/9741 [00:13<00:42, 173.49it/s] 24%|██████████████████▍                                                         | 2366/9741 [00:13<00:42, 172.39it/s] 24%|██████████████████▌                                                         | 2384/9741 [00:13<00:42, 173.57it/s] 25%|██████████████████▊                                                         | 2404/9741 [00:13<00:41, 178.95it/s] 25%|██████████████████▉                                                         | 2423/9741 [00:13<00:40, 180.96it/s] 25%|███████████████████                                                         | 2442/9741 [00:13<00:40, 181.18it/s] 25%|███████████████████▏                                                        | 2461/9741 [00:13<00:41, 176.82it/s] 25%|███████████████████▎                                                        | 2479/9741 [00:14<00:41, 176.46it/s] 26%|███████████████████▍                                                        | 2498/9741 [00:14<00:40, 180.30it/s] 26%|███████████████████▋                                                        | 2517/9741 [00:14<00:39, 180.98it/s] 26%|███████████████████▊                                                        | 2536/9741 [00:14<00:40, 179.02it/s] 26%|███████████████████▉                                                        | 2554/9741 [00:14<00:42, 170.31it/s] 26%|████████████████████                                                        | 2573/9741 [00:14<00:41, 174.28it/s] 27%|████████████████████▏                                                       | 2592/9741 [00:14<00:40, 177.79it/s] 27%|████████████████████▎                                                       | 2610/9741 [00:14<00:39, 178.31it/s] 27%|████████████████████▌                                                       | 2629/9741 [00:14<00:39, 179.39it/s] 27%|████████████████████▋                                                       | 2648/9741 [00:15<00:39, 177.60it/s] 27%|████████████████████▊                                                       | 2666/9741 [00:15<00:40, 176.65it/s] 28%|████████████████████▉                                                       | 2685/9741 [00:15<00:39, 178.07it/s] 28%|█████████████████████                                                       | 2703/9741 [00:15<00:39, 176.53it/s] 28%|█████████████████████▏                                                      | 2721/9741 [00:15<00:39, 177.30it/s] 28%|█████████████████████▍                                                      | 2740/9741 [00:15<00:38, 179.73it/s] 28%|█████████████████████▌                                                      | 2758/9741 [00:15<00:40, 174.06it/s] 28%|█████████████████████▋                                                      | 2776/9741 [00:15<00:39, 174.53it/s] 29%|█████████████████████▊                                                      | 2794/9741 [00:15<00:39, 175.32it/s] 29%|█████████████████████▉                                                      | 2813/9741 [00:15<00:38, 178.84it/s] 29%|██████████████████████                                                      | 2832/9741 [00:16<00:37, 182.10it/s] 29%|██████████████████████▏                                                     | 2851/9741 [00:16<00:39, 175.97it/s] 29%|██████████████████████▍                                                     | 2869/9741 [00:16<00:38, 176.21it/s] 30%|██████████████████████▌                                                     | 2887/9741 [00:16<00:42, 162.35it/s] 30%|██████████████████████▋                                                     | 2906/9741 [00:16<00:40, 169.86it/s] 30%|██████████████████████▊                                                     | 2924/9741 [00:16<00:39, 172.01it/s] 30%|██████████████████████▉                                                     | 2942/9741 [00:16<00:40, 169.61it/s] 30%|███████████████████████                                                     | 2960/9741 [00:16<00:39, 171.16it/s] 31%|███████████████████████▏                                                    | 2979/9741 [00:16<00:38, 175.38it/s] 31%|███████████████████████▍                                                    | 2998/9741 [00:17<00:37, 178.51it/s] 31%|███████████████████████▌                                                    | 3016/9741 [00:17<00:37, 178.46it/s] 31%|███████████████████████▋                                                    | 3035/9741 [00:17<00:37, 178.84it/s] 31%|███████████████████████▊                                                    | 3053/9741 [00:17<00:38, 174.17it/s] 32%|███████████████████████▉                                                    | 3072/9741 [00:17<00:37, 178.52it/s] 32%|████████████████████████                                                    | 3091/9741 [00:17<00:37, 179.34it/s] 32%|████████████████████████▎                                                   | 3109/9741 [00:17<00:37, 178.14it/s] 32%|████████████████████████▍                                                   | 3128/9741 [00:17<00:36, 178.82it/s] 32%|████████████████████████▌                                                   | 3146/9741 [00:17<00:37, 174.61it/s] 32%|████████████████████████▋                                                   | 3165/9741 [00:17<00:37, 177.53it/s] 33%|████████████████████████▊                                                   | 3183/9741 [00:18<00:37, 173.88it/s] 33%|████████████████████████▉                               