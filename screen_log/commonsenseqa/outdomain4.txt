PYTHONPATH=/home/ylu130/workspace/in-context-generalization
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o10-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 10
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 11:46:33,946] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o10-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 10
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o10-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  1%|▎                                                     | 49/9741 [00:00<00:19, 486.83it/s]  1%|▌                                                     | 99/9741 [00:00<00:19, 489.39it/s]  2%|▊                                                    | 149/9741 [00:00<00:19, 490.22it/s]  2%|█                                                    | 199/9741 [00:00<00:19, 489.92it/s]  3%|█▎                                                   | 248/9741 [00:00<00:19, 487.38it/s]  3%|█▌                                                   | 297/9741 [00:00<00:19, 488.13it/s]  4%|█▉                                                   | 346/9741 [00:00<00:19, 488.54it/s]  4%|██▏                                                  | 395/9741 [00:00<00:19, 481.92it/s]  5%|██▍                                                  | 444/9741 [00:00<00:19, 480.77it/s]  5%|██▋                                                  | 493/9741 [00:01<00:19, 482.92it/s]  6%|██▉                                                  | 542/9741 [00:01<00:18, 484.85it/s]  6%|███▏                                                 | 591/9741 [00:01<00:19, 475.94it/s]  7%|███▍                                                 | 640/9741 [00:01<00:18, 479.35it/s]  7%|███▋                                                 | 689/9741 [00:01<00:18, 480.33it/s]  8%|████                                                 | 738/9741 [00:01<00:18, 482.55it/s]  8%|████▎                                                | 787/9741 [00:01<00:18, 484.28it/s]  9%|████▌                                                | 836/9741 [00:01<00:18, 483.97it/s]  9%|████▊                                                | 885/9741 [00:01<00:19, 465.32it/s] 10%|█████                                                | 934/9741 [00:01<00:18, 470.62it/s] 10%|█████▎                                               | 982/9741 [00:02<00:18, 468.54it/s] 11%|█████▌                                              | 1031/9741 [00:02<00:18, 472.86it/s] 11%|█████▊                                              | 1081/9741 [00:02<00:18, 478.31it/s] 12%|██████                                              | 1130/9741 [00:02<00:17, 479.70it/s] 12%|██████▎                                             | 1180/9741 [00:02<00:17, 482.77it/s] 13%|██████▋                                             | 1254/9741 [00:02<00:15, 556.82it/s] 14%|███████                                             | 1329/9741 [00:02<00:13, 613.10it/s] 14%|███████▍                                            | 1403/9741 [00:02<00:12, 649.46it/s] 15%|███████▉                                            | 1478/9741 [00:02<00:12, 677.34it/s] 16%|████████▎                                           | 1553/9741 [00:02<00:11, 697.12it/s] 17%|████████▋                                           | 1627/9741 [00:03<00:11, 708.58it/s] 17%|█████████                                           | 1701/9741 [00:03<00:11, 717.72it/s] 18%|█████████▍                                          | 1775/9741 [00:03<00:11, 723.29it/s] 19%|█████████▊                                          | 1848/9741 [00:03<00:11, 700.24it/s] 20%|██████████▎                                         | 1923/9741 [00:03<00:10, 711.96it/s] 21%|██████████▋                                         | 1998/9741 [00:03<00:10, 721.09it/s] 21%|███████████                                         | 2072/9741 [00:03<00:10, 724.22it/s] 22%|███████████▍                                        | 2146/9741 [00:03<00:10, 728.49it/s] 23%|███████████▊                                        | 2221/9741 [00:03<00:10, 732.72it/s] 24%|████████████▎                                       | 2295/9741 [00:03<00:10, 732.61it/s] 24%|████████████▋                                       | 2370/9741 [00:04<00:10, 735.29it/s] 25%|█████████████                                       | 2445/9741 [00:04<00:09, 737.99it/s] 26%|█████████████▍                                      | 2519/9741 [00:04<00:09, 733.71it/s] 27%|█████████████▊                                      | 2593/9741 [00:04<00:09, 732.31it/s] 27%|██████████████▏                                     | 2667/9741 [00:04<00:09, 731.41it/s] 28%|██████████████▋                                     | 2741/9741 [00:04<00:09, 730.99it/s] 29%|███████████████                                     | 2815/9741 [00:04<00:09, 731.89it/s] 30%|███████████████▍                                    | 2890/9741 [00:04<00:09, 735.33it/s] 30%|███████████████▊                                    | 2964/9741 [00:04<00:09, 733.40it/s] 31%|████████████████▏                                   | 3039/9741 [00:04<00:09, 735.73it/s] 32%|████████████████▌                                   | 3113/9741 [00:05<00:08, 736.98it/s] 33%|█████████████████                                   | 3187/9741 [00:05<00:08, 734.61it/s] 33%|█████████████████▍                                  | 3262/9741 [00:05<00:08, 737.12it/s] 34%|█████████████████▊                                  | 3336/9741 [00:05<00:08, 737.59it/s] 35%|██████████████████▏                                 | 3410/9741 [00:05<00:08, 736.56it/s] 36%|██████████████████▌                                 | 3484/9741 [00:05<00:08, 737.38it/s] 37%|██████████████████▉                                 | 3558/9741 [00:05<00:08, 737.99it/s] 37%|███████████████████▍                                | 3632/9741 [00:05<00:08, 730.38it/s] 38%|███████████████████▊                                | 3706/9741 [00:05<00:08, 732.68it/s] 39%|████████████████████▏                               | 3780/9741 [00:05<00:08, 733.14it/s] 40%|████████████████████▌                               | 3854/9741 [00:06<00:08, 706.95it/s] 40%|████████████████████▉                               | 3929/9741 [00:06<00:08, 717.31it/s] 41%|█████████████████████▎                              | 4004/9741 [00:06<00:07, 724.24it/s] 42%|█████████████████████▊                              | 4078/9741 [00:06<00:07, 727.10it/s] 43%|██████████████████████▏                             | 4152/9741 [00:06<00:07, 730.67it/s] 43%|██████████████████████▌                             | 4226/9741 [00:06<00:07, 733.04it/s] 44%|██████████████████████▉                             | 4300/9741 [00:06<00:07, 725.17it/s] 45%|███████████████████████▎                            | 4374/9741 [00:06<00:07, 726.97it/s] 46%|███████████████████████▋                            | 4448/9741 [00:06<00:07, 729.77it/s] 46%|████████████████████████▏                           | 4522/9741 [00:07<00:07, 691.92it/s] 47%|████████████████████████▌                           | 4596/9741 [00:07<00:07, 703.07it/s] 48%|████████████████████████▉                           | 4670/9741 [00:07<00:07, 713.73it/s] 49%|█████████████████████████▎                          | 4742/9741 [00:07<00:09, 522.10it/s] 49%|█████████████████████████▋                          | 4816/9741 [00:07<00:08, 571.75it/s] 50%|██████████████████████████                          | 4890/9741 [00:07<00:07, 612.53it/s] 51%|██████████████████████████▍                         | 4963/9741 [00:07<00:07, 642.33it/s] 52%|██████████████████████████▉                         | 5037/9741 [00:07<00:07, 668.56it/s] 52%|███████████████████████████▎                        | 5111/9741 [00:07<00:06, 688.09it/s] 53%|███████████████████████████▋                        | 5185/9741 [00:08<00:06, 700.58it/s] 54%|████████████████████████████                        | 5259/9741 [00:08<00:06, 711.93it/s] 55%|████████████████████████████▍                       | 5333/9741 [00:08<00:06, 719.33it/s] 55%|████████████████████████████▊                       | 5406/9741 [00:08<00:06, 717.09it/s] 56%|█████████████████████████████▎                      | 5481/9741 [00:08<00:05, 725.30it/s] 57%|█████████████████████████████▋                      | 5558/9741 [00:08<00:05, 738.00it/s] 58%|██████████████████████████████                      | 5634/9741 [00:08<00:05, 742.38it/s] 59%|██████████████████████████████▍                     | 5711/9741 [00:08<00:05, 750.11it/s] 59%|██████████████████████████████▉                     | 5789/9741 [00:08<00:05, 756.83it/s] 60%|███████████████████████████████▎                    | 5866/9741 [00:08<00:05, 758.56it/s] 61%|███████████████████████████████▋                    | 5943/9741 [00:09<00:04, 761.24it/s] 62%|████████████████████████████████▏                   | 6020/9741 [00:09<00:04, 763.74it/s] 63%|████████████████████████████████▌                   | 6097/9741 [00:09<00:04, 763.78it/s] 63%|████████████████████████████████▉                   | 6174/9741 [00:09<00:04, 765.28it/s] 64%|█████████████████████████████████▎                  | 6251/9741 [00:09<00:04, 766.26it/s] 65%|█████████████████████████████████▊                  | 6328/9741 [00:09<00:04, 763.49it/s] 66%|██████████████████████████████████▏                 | 6405/9741 [00:09<00:04, 754.98it/s] 67%|██████████████████████████████████▌                 | 6481/9741 [00:09<00:04, 755.41it/s] 67%|███████████████████████████████████                 | 6557/9741 [00:09<00:04, 754.65it/s] 68%|███████████████████████████████████▍                | 6634/9741 [00:09<00:04, 758.39it/s] 69%|███████████████████████████████████▊                | 6711/9741 [00:10<00:03, 759.11it/s] 70%|████████████████████████████████████▏               | 6787/9741 [00:10<00:03, 759.26it/s] 70%|████████████████████████████████████▋               | 6864/9741 [00:10<00:03, 760.70it/s] 71%|█████████████████████████████████████               | 6941/9741 [00:10<00:03, 762.21it/s] 72%|█████████████████████████████████████▍              | 7018/9741 [00:10<00:03, 760.52it/s] 73%|█████████████████████████████████████▉              | 7096/9741 [00:10<00:03, 763.49it/s] 74%|██████████████████████████████████████▎             | 7173/9741 [00:10<00:03, 764.33it/s] 74%|██████████████████████████████████████▋             | 7250/9741 [00:10<00:03, 761.60it/s] 75%|███████████████████████████████████████             | 7327/9741 [00:10<00:03, 758.93it/s] 76%|███████████████████████████████████████▌            | 7404/9741 [00:11<00:03, 760.43it/s] 77%|███████████████████████████████████████▉            | 7481/9741 [00:11<00:03, 711.61it/s] 78%|████████████████████████████████████████▎           | 7558/9741 [00:11<00:03, 726.10it/s] 78%|████████████████████████████████████████▊           | 7635/9741 [00:11<00:02, 737.89it/s] 79%|█████████████████████████████████████████▏          | 7711/9741 [00:11<00:02, 744.05it/s] 80%|█████████████████████████████████████████▌          | 7789/9741 [00:11<00:02, 752.16it/s] 81%|█████████████████████████████████████████▉          | 7866/9741 [00:11<00:02, 757.19it/s] 82%|██████████████████████████████████████████▍         | 7942/9741 [00:11<00:02, 757.29it/s] 82%|██████████████████████████████████████████▊         | 8018/9741 [00:11<00:02, 757.55it/s] 83%|███████████████████████████████████████████▏        | 8094/9741 [00:11<00:02, 754.22it/s] 84%|███████████████████████████████████████████▌        | 8170/9741 [00:12<00:02, 748.44it/s] 85%|████████████████████████████████████████████        | 8247/9741 [00:12<00:01, 752.93it/s] 85%|████████████████████████████████████████████▍       | 8324/9741 [00:12<00:01, 755.04it/s] 86%|████████████████████████████████████████████▊       | 8400/9741 [00:12<00:01, 752.01it/s] 87%|█████████████████████████████████████████████▎      | 8477/9741 [00:12<00:01, 756.23it/s] 88%|█████████████████████████████████████████████▋      | 8554/9741 [00:12<00:01, 759.64it/s] 89%|██████████████████████████████████████████████      | 8630/9741 [00:12<00:01, 759.49it/s] 89%|██████████████████████████████████████████████▍     | 8707/9741 [00:12<00:01, 762.30it/s] 90%|██████████████████████████████████████████████▉     | 8784/9741 [00:12<00:01, 763.95it/s] 91%|███████████████████████████████████████████████▎    | 8861/9741 [00:12<00:01, 762.22it/s] 92%|███████████████████████████████████████████████▋    | 8938/9741 [00:13<00:01, 764.43it/s] 93%|████████████████████████████████████████████████    | 9015/9741 [00:13<00:00, 764.79it/s] 93%|████████████████████████████████████████████████▌   | 9092/9741 [00:13<00:00, 760.61it/s] 94%|████████████████████████████████████████████████▉   | 9169/9741 [00:13<00:00, 762.25it/s] 95%|█████████████████████████████████████████████████▎  | 9246/9741 [00:13<00:00, 763.58it/s] 96%|█████████████████████████████████████████████████▊  | 9323/9741 [00:13<00:00, 760.88it/s] 96%|██████████████████████████████████████████████████▏ | 9400/9741 [00:13<00:00, 761.78it/s] 97%|██████████████████████████████████████████████████▌ | 9477/9741 [00:13<00:00, 762.42it/s] 98%|███████████████████████████████████████████████████ | 9554/9741 [00:13<00:00, 760.98it/s] 99%|███████████████████████████████████████████████████▍| 9631/9741 [00:13<00:00, 757.55it/s]100%|███████████████████████████████████████████████████▊| 9707/9741 [00:14<00:00, 757.64it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:14<00:00, 690.88it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.70s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.63s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.62s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:06<00:12,  6.26s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.55s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.68s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.55s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.87s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.98s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.17s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.04s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.19s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.17s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.28s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.34s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.53s/it]
[2023-08-21 11:47:42,126] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 11:47:54,626] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 11:47:54,627] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 11:47:54,627] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 11:47:54,627] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 11:47:54,627] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 11:47:54,627] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f4726528f40>
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f46fdf2edc0>
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 11:47:54,629] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.448444128036499 seconds
Loading extension module utils...
Time to load utils op: 0.40442609786987305 seconds
Loading extension module utils...
Time to load utils op: 0.504676103591919 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o10-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.5050630569458008 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:46<37:57, 46.47s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:33<37:19, 46.65s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:19<36:16, 46.32s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [03:07<35:58, 46.93s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:53<34:59, 46.66s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:24<30:28, 41.55s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:05<29:35, 41.28s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:52<30:02, 42.93s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:27<27:45, 40.62s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:14<28:28, 42.70s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:50<26:18, 40.47s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:36<26:45, 42.26s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:24<27:02, 43.86s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:11<26:55, 44.88s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:59<26:39, 45.69s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:45<25:57, 45.81s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:31<25:16, 45.95s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [13:18<24:41, 46.30s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [14:05<24:01, 46.49s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:52<23:18, 46.63s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [15:31<21:23, 44.25s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [16:17<20:57, 44.92s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [17:05<20:34, 45.71s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [17:45<19:07, 44.14s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [18:32<18:43, 44.95s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [19:18<18:03, 45.16s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [19:53<16:08, 42.11s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [20:39<15:52, 43.30s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [21:26<15:31, 44.38s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [22:12<14:58, 44.95s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [22:59<14:25, 45.56s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [23:46<13:48, 46.02s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [24:33<13:07, 46.33s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [25:20<12:25, 46.61s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [26:02<11:19, 45.27s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [26:38<09:53, 42.39s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [27:25<09:29, 43.81s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [28:09<08:46, 43.89s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [28:56<08:12, 44.79s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [29:43<07:35, 45.50s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [30:30<06:51, 45.77s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [30:58<05:25, 40.63s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [31:45<04:58, 42.58s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [32:33<04:23, 43.91s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [33:10<03:30, 42.04s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [33:57<02:54, 43.57s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [34:44<02:13, 44.41s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [35:30<01:30, 45.02s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [36:17<00:45, 45.69s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [36:43<00:00, 39.77s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [36:43<00:00, 44.08s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.0272} | lm_loss 7.9754 | avg. gen lenth: 272.076
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o11-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 11
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 12:26:37,610] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o11-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 11
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o11-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▎                                                     | 46/9741 [00:00<00:21, 453.50it/s]  1%|▌                                                     | 92/9741 [00:00<00:21, 455.64it/s]  1%|▊                                                    | 138/9741 [00:00<00:21, 456.91it/s]  2%|█                                                    | 184/9741 [00:00<00:20, 456.25it/s]  2%|█▎                                                   | 230/9741 [00:00<00:20, 454.45it/s]  3%|█▌                                                   | 276/9741 [00:00<00:20, 454.68it/s]  3%|█▊                                                   | 322/9741 [00:00<00:20, 455.35it/s]  4%|██                                                   | 368/9741 [00:00<00:20, 449.84it/s]  4%|██▎                                                  | 414/9741 [00:00<00:20, 451.17it/s]  5%|██▌                                                  | 460/9741 [00:01<00:20, 450.37it/s]  5%|██▊                                                  | 506/9741 [00:01<00:20, 451.57it/s]  6%|███                                                  | 552/9741 [00:01<00:20, 452.71it/s]  6%|███▎                                                 | 598/9741 [00:01<00:20, 452.95it/s]  7%|███▌                                                 | 644/9741 [00:01<00:20, 453.28it/s]  7%|███▊                                                 | 690/9741 [00:01<00:20, 451.94it/s]  8%|████                                                 | 736/9741 [00:01<00:19, 452.11it/s]  8%|████▎                                                | 782/9741 [00:01<00:19, 453.09it/s]  9%|████▌                                                | 832/9741 [00:01<00:19, 465.55it/s]  9%|████▉                                                | 900/9741 [00:01<00:16, 529.16it/s] 10%|█████▎                                               | 969/9741 [00:02<00:15, 577.10it/s] 11%|█████▌                                              | 1038/9741 [00:02<00:14, 610.54it/s] 11%|█████▉                                              | 1107/9741 [00:02<00:13, 634.16it/s] 12%|██████▎                                             | 1176/9741 [00:02<00:13, 648.39it/s] 13%|██████▋                                             | 1245/9741 [00:02<00:12, 659.65it/s] 13%|███████                                             | 1315/9741 [00:02<00:12, 668.80it/s] 14%|███████▍                                            | 1383/9741 [00:02<00:12, 671.85it/s] 15%|███████▊                                            | 1452/9741 [00:02<00:12, 676.42it/s] 16%|████████                                            | 1521/9741 [00:02<00:12, 680.07it/s] 16%|████████▍                                           | 1590/9741 [00:02<00:11, 680.26it/s] 17%|████████▊                                           | 1659/9741 [00:03<00:11, 682.82it/s] 18%|█████████▏                                          | 1728/9741 [00:03<00:11, 679.51it/s] 18%|█████████▌                                          | 1796/9741 [00:03<00:12, 653.31it/s] 19%|█████████▉                                          | 1865/9741 [00:03<00:11, 662.70it/s] 20%|██████████▎                                         | 1934/9741 [00:03<00:11, 669.26it/s] 21%|██████████▋                                         | 2003/9741 [00:03<00:11, 674.66it/s] 21%|███████████                                         | 2071/9741 [00:03<00:11, 674.37it/s] 22%|███████████▍                                        | 2140/9741 [00:03<00:11, 677.26it/s] 23%|███████████▊                                        | 2209/9741 [00:03<00:11, 680.17it/s] 23%|████████████▏                                       | 2278/9741 [00:03<00:10, 679.54it/s] 24%|████████████▌                                       | 2347/9741 [00:04<00:10, 681.31it/s] 25%|████████████▉                                       | 2416/9741 [00:04<00:10, 683.78it/s] 26%|█████████████▎                                      | 2485/9741 [00:04<00:10, 682.21it/s] 26%|█████████████▋                                      | 2554/9741 [00:04<00:10, 682.89it/s] 27%|██████████████                                      | 2623/9741 [00:04<00:10, 677.66it/s] 28%|██████████████▎                                     | 2692/9741 [00:04<00:10, 679.62it/s] 28%|██████████████▋                                     | 2760/9741 [00:04<00:10, 677.71it/s] 29%|███████████████                                     | 2829/9741 [00:04<00:10, 679.02it/s] 30%|███████████████▍                                    | 2898/9741 [00:04<00:10, 681.20it/s] 30%|███████████████▊                                    | 2967/9741 [00:04<00:09, 680.45it/s] 31%|████████████████▏                                   | 3036/9741 [00:05<00:09, 681.95it/s] 32%|████████████████▌                                   | 3105/9741 [00:05<00:09, 683.17it/s] 33%|████████████████▉                                   | 3174/9741 [00:05<00:09, 681.63it/s] 33%|█████████████████▎                                  | 3243/9741 [00:05<00:09, 683.45it/s] 34%|█████████████████▋                                  | 3312/9741 [00:05<00:09, 684.47it/s] 35%|██████████████████                                  | 3381/9741 [00:05<00:09, 682.26it/s] 35%|██████████████████▍                                 | 3450/9741 [00:05<00:09, 683.29it/s] 36%|██████████████████▊                                 | 3519/9741 [00:05<00:09, 675.65it/s] 37%|███████████████████▏                                | 3588/9741 [00:05<00:09, 677.72it/s] 38%|███████████████████▌                                | 3656/9741 [00:05<00:09, 673.84it/s] 38%|███████████████████▉                                | 3725/9741 [00:06<00:08, 677.60it/s] 39%|████████████████████▎                               | 3794/9741 [00:06<00:08, 680.03it/s] 40%|████████████████████▌                               | 3863/9741 [00:06<00:08, 679.53it/s] 40%|████████████████████▉                               | 3932/9741 [00:06<00:08, 681.17it/s] 41%|█████████████████████▎                              | 4001/9741 [00:06<00:08, 682.26it/s] 42%|█████████████████████▋                              | 4070/9741 [00:06<00:08, 680.97it/s] 42%|██████████████████████                              | 4139/9741 [00:06<00:08, 682.25it/s] 43%|██████████████████████▍                             | 4208/9741 [00:06<00:08, 682.63it/s] 44%|██████████████████████▊                             | 4277/9741 [00:06<00:07, 683.89it/s] 45%|███████████████████████▏                            | 4346/9741 [00:06<00:07, 682.96it/s] 45%|███████████████████████▌                            | 4415/9741 [00:07<00:07, 682.82it/s] 46%|███████████████████████▉                            | 4484/9741 [00:07<00:07, 683.35it/s] 47%|████████████████████████▎                           | 4553/9741 [00:07<00:08, 633.67it/s] 47%|████████████████████████▋                           | 4622/9741 [00:07<00:07, 648.51it/s] 48%|█████████████████████████                           | 4691/9741 [00:07<00:07, 659.51it/s] 49%|█████████████████████████▍                          | 4758/9741 [00:07<00:09, 528.23it/s] 50%|█████████████████████████▊                          | 4827/9741 [00:07<00:08, 567.26it/s] 50%|██████████████████████████▏                         | 4896/9741 [00:07<00:08, 597.96it/s] 51%|██████████████████████████▍                         | 4964/9741 [00:08<00:07, 619.37it/s] 52%|██████████████████████████▊                         | 5033/9741 [00:08<00:07, 636.50it/s] 52%|███████████████████████████▏                        | 5102/9741 [00:08<00:07, 650.19it/s] 53%|███████████████████████████▌                        | 5171/9741 [00:08<00:06, 658.42it/s] 54%|███████████████████████████▉                        | 5240/9741 [00:08<00:06, 665.40it/s] 55%|████████████████████████████▎                       | 5309/9741 [00:08<00:06, 671.71it/s] 55%|████████████████████████████▋                       | 5378/9741 [00:08<00:06, 675.37it/s] 56%|█████████████████████████████                       | 5446/9741 [00:08<00:06, 675.55it/s] 57%|█████████████████████████████▍                      | 5515/9741 [00:08<00:06, 679.10it/s] 57%|█████████████████████████████▊                      | 5587/9741 [00:08<00:06, 689.62it/s] 58%|██████████████████████████████▏                     | 5658/9741 [00:09<00:05, 694.20it/s] 59%|██████████████████████████████▌                     | 5730/9741 [00:09<00:05, 700.82it/s] 60%|██████████████████████████████▉                     | 5802/9741 [00:09<00:05, 705.01it/s] 60%|███████████████████████████████▎                    | 5873/9741 [00:09<00:05, 704.99it/s] 61%|███████████████████████████████▋                    | 5945/9741 [00:09<00:05, 708.24it/s] 62%|████████████████████████████████                    | 6017/9741 [00:09<00:05, 710.47it/s] 63%|████████████████████████████████▌                   | 6089/9741 [00:09<00:05, 708.74it/s] 63%|████████████████████████████████▉                   | 6161/9741 [00:09<00:05, 710.41it/s] 64%|█████████████████████████████████▎                  | 6233/9741 [00:09<00:04, 710.98it/s] 65%|█████████████████████████████████▋                  | 6305/9741 [00:09<00:04, 711.65it/s] 65%|██████████████████████████████████                  | 6377/9741 [00:10<00:04, 710.59it/s] 66%|██████████████████████████████████▍                 | 6449/9741 [00:10<00:04, 711.67it/s] 67%|██████████████████████████████████▊                 | 6521/9741 [00:10<00:04, 711.17it/s] 68%|███████████████████████████████████▏                | 6593/9741 [00:10<00:04, 709.43it/s] 68%|███████████████████████████████████▌                | 6665/9741 [00:10<00:04, 710.93it/s] 69%|███████████████████████████████████▉                | 6737/9741 [00:10<00:04, 711.84it/s] 70%|████████████████████████████████████▎               | 6809/9741 [00:10<00:04, 710.99it/s] 71%|████████████████████████████████████▋               | 6881/9741 [00:10<00:04, 711.17it/s] 71%|█████████████████████████████████████               | 6953/9741 [00:10<00:03, 711.85it/s] 72%|█████████████████████████████████████▌              | 7025/9741 [00:10<00:03, 710.11it/s] 73%|█████████████████████████████████████▉              | 7097/9741 [00:11<00:03, 711.61it/s] 74%|██████████████████████████████████████▎             | 7169/9741 [00:11<00:03, 712.73it/s] 74%|██████████████████████████████████████▋             | 7241/9741 [00:11<00:03, 710.56it/s] 75%|███████████████████████████████████████             | 7313/9741 [00:11<00:03, 711.22it/s] 76%|███████████████████████████████████████▍            | 7385/9741 [00:11<00:03, 712.27it/s] 77%|███████████████████████████████████████▊            | 7457/9741 [00:11<00:03, 679.26it/s] 77%|████████████████████████████████████████▏           | 7528/9741 [00:11<00:03, 687.79it/s] 78%|████████████████████████████████████████▌           | 7600/9741 [00:11<00:03, 695.52it/s] 79%|████████████████████████████████████████▉           | 7671/9741 [00:11<00:02, 698.19it/s] 79%|█████████████████████████████████████████▎          | 7743/9741 [00:11<00:02, 702.30it/s] 80%|█████████████████████████████████████████▋          | 7815/9741 [00:12<00:02, 705.27it/s] 81%|██████████████████████████████████████████          | 7886/9741 [00:12<00:02, 705.84it/s] 82%|██████████████████████████████████████████▍         | 7957/9741 [00:12<00:02, 706.09it/s] 82%|██████████████████████████████████████████▊         | 8029/9741 [00:12<00:02, 708.54it/s] 83%|███████████████████████████████████████████▏        | 8101/9741 [00:12<00:02, 710.23it/s] 84%|███████████████████████████████████████████▋        | 8173/9741 [00:12<00:02, 709.24it/s] 85%|████████████████████████████████████████████        | 8245/9741 [00:12<00:02, 710.97it/s] 85%|████████████████████████████████████████████▍       | 8317/9741 [00:12<00:02, 711.02it/s] 86%|████████████████████████████████████████████▊       | 8389/9741 [00:12<00:01, 709.48it/s] 87%|█████████████████████████████████████████████▏      | 8461/9741 [00:12<00:01, 711.09it/s] 88%|█████████████████████████████████████████████▌      | 8533/9741 [00:13<00:01, 711.60it/s] 88%|█████████████████████████████████████████████▉      | 8605/9741 [00:13<00:01, 709.75it/s] 89%|██████████████████████████████████████████████▎     | 8677/9741 [00:13<00:01, 710.12it/s] 90%|██████████████████████████████████████████████▋     | 8749/9741 [00:13<00:01, 711.07it/s] 91%|███████████████████████████████████████████████     | 8821/9741 [00:13<00:01, 708.97it/s] 91%|███████████████████████████████████████████████▍    | 8893/9741 [00:13<00:01, 709.99it/s] 92%|███████████████████████████████████████████████▊    | 8965/9741 [00:13<00:01, 711.13it/s] 93%|████████████████████████████████████████████████▏   | 9037/9741 [00:13<00:00, 709.76it/s] 94%|████████████████████████████████████████████████▌   | 9108/9741 [00:13<00:00, 705.40it/s] 94%|█████████████████████████████████████████████████   | 9180/9741 [00:13<00:00, 707.81it/s] 95%|█████████████████████████████████████████████████▍  | 9252/9741 [00:14<00:00, 709.22it/s] 96%|█████████████████████████████████████████████████▊  | 9323/9741 [00:14<00:00, 708.17it/s] 96%|██████████████████████████████████████████████████▏ | 9395/9741 [00:14<00:00, 709.95it/s] 97%|██████████████████████████████████████████████████▌ | 9467/9741 [00:14<00:00, 710.75it/s] 98%|██████████████████████████████████████████████████▉ | 9539/9741 [00:14<00:00, 709.20it/s] 99%|███████████████████████████████████████████████████▎| 9611/9741 [00:14<00:00, 710.06it/s] 99%|███████████████████████████████████████████████████▋| 9683/9741 [00:14<00:00, 710.63it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:14<00:00, 658.97it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.96s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.07s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.29s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.99s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.23s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.26s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.41s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.57s/it]
[2023-08-21 12:27:43,684] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.39s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.55s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.83s/it]
[2023-08-21 12:27:57,340] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 12:27:57,341] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f5413384f40>
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f54135fedc0>
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 12:27:57,343] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.45584940910339355 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o11-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.40461039543151855 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.4043731689453125 seconds
Time to load utils op: 0.4045078754425049 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:45<37:20, 45.73s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:32<37:08, 46.42s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:18<36:02, 46.02s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [03:04<35:28, 46.28s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:44<32:57, 43.94s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:30<32:46, 44.68s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:16<32:20, 45.12s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:54<29:50, 42.64s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:39<29:48, 43.62s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:25<29:32, 44.32s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [08:11<29:03, 44.70s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:57<28:34, 45.12s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:43<27:55, 45.28s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:14<24:37, 41.05s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [11:00<24:51, 42.63s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:47<24:55, 43.99s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:34<24:37, 44.78s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [13:16<23:27, 43.97s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [14:02<23:01, 44.56s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:37<20:49, 41.64s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:55<16:41, 34.54s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:41<17:45, 38.04s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:27<18:11, 40.44s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [17:01<16:44, 38.62s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:47<17:01, 40.86s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:34<16:58, 42.43s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [19:14<16:00, 41.76s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [20:00<15:48, 43.12s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:42<14:57, 42.72s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [21:28<14:34, 43.73s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [22:15<14:08, 44.66s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [23:01<13:33, 45.20s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [23:47<12:53, 45.49s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [24:34<12:12, 45.80s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [25:20<11:29, 45.99s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [26:06<10:42, 45.88s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [26:43<09:20, 43.11s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [27:29<08:50, 44.19s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [28:15<08:12, 44.78s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [29:02<07:31, 45.16s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [29:48<06:50, 45.61s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [30:35<06:07, 45.97s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [31:14<05:06, 43.75s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [32:00<04:27, 44.59s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [32:47<03:45, 45.18s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [33:33<03:02, 45.51s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [34:20<02:17, 45.93s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [35:05<01:31, 45.58s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [35:28<00:38, 38.79s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [36:14<00:00, 41.03s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [36:14<00:00, 43.49s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.1037} | lm_loss 8.0399 | avg. gen lenth: 277.984
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o12-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 12
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 13:04:21,422] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o12-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 12
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o12-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 43/9741 [00:00<00:22, 422.83it/s]  1%|▍                                                     | 86/9741 [00:00<00:22, 425.08it/s]  1%|▋                                                    | 129/9741 [00:00<00:22, 426.26it/s]  2%|▉                                                    | 172/9741 [00:00<00:22, 426.87it/s]  2%|█▏                                                   | 215/9741 [00:00<00:22, 423.76it/s]  3%|█▍                                                   | 258/9741 [00:00<00:22, 424.71it/s]  3%|█▋                                                   | 301/9741 [00:00<00:22, 418.73it/s]  4%|█▊                                                   | 344/9741 [00:00<00:22, 419.66it/s]  4%|██                                                   | 387/9741 [00:00<00:22, 421.39it/s]  4%|██▎                                                  | 430/9741 [00:01<00:22, 420.76it/s]  5%|██▌                                                  | 473/9741 [00:01<00:21, 422.71it/s]  5%|██▊                                                  | 516/9741 [00:01<00:21, 424.15it/s]  6%|███                                                  | 559/9741 [00:01<00:21, 424.45it/s]  6%|███▎                                                 | 602/9741 [00:01<00:21, 424.98it/s]  7%|███▌                                                 | 645/9741 [00:01<00:21, 425.40it/s]  7%|███▋                                                 | 688/9741 [00:01<00:21, 424.44it/s]  8%|███▉                                                 | 731/9741 [00:01<00:21, 420.41it/s]  8%|████▏                                                | 774/9741 [00:01<00:21, 421.60it/s]  8%|████▍                                                | 817/9741 [00:01<00:21, 423.17it/s]  9%|████▋                                                | 860/9741 [00:02<00:20, 424.36it/s]  9%|████▉                                                | 903/9741 [00:02<00:20, 423.11it/s] 10%|█████▏                                               | 946/9741 [00:02<00:20, 423.97it/s] 10%|█████▍                                               | 989/9741 [00:02<00:20, 424.82it/s] 11%|█████▌                                              | 1032/9741 [00:02<00:20, 425.45it/s] 11%|█████▊                                              | 1088/9741 [00:02<00:18, 464.50it/s] 12%|██████▏                                             | 1152/9741 [00:02<00:16, 514.91it/s] 12%|██████▍                                             | 1216/9741 [00:02<00:15, 552.04it/s] 13%|██████▊                                             | 1280/9741 [00:02<00:14, 578.15it/s] 14%|███████▏                                            | 1344/9741 [00:02<00:14, 594.43it/s] 14%|███████▌                                            | 1408/9741 [00:03<00:13, 607.86it/s] 15%|███████▊                                            | 1473/9741 [00:03<00:13, 617.75it/s] 16%|████████▏                                           | 1538/9741 [00:03<00:13, 624.55it/s] 16%|████████▌                                           | 1602/9741 [00:03<00:12, 626.88it/s] 17%|████████▉                                           | 1667/9741 [00:03<00:12, 631.96it/s] 18%|█████████▏                                          | 1732/9741 [00:03<00:12, 634.85it/s] 18%|█████████▌                                          | 1796/9741 [00:03<00:12, 611.56it/s] 19%|█████████▉                                          | 1860/9741 [00:03<00:12, 619.45it/s] 20%|██████████▎                                         | 1924/9741 [00:03<00:12, 625.40it/s] 20%|██████████▌                                         | 1988/9741 [00:03<00:12, 628.81it/s] 21%|██████████▉                                         | 2051/9741 [00:04<00:12, 628.64it/s] 22%|███████████▎                                        | 2115/9741 [00:04<00:12, 631.40it/s] 22%|███████████▋                                        | 2179/9741 [00:04<00:11, 633.92it/s] 23%|███████████▉                                        | 2243/9741 [00:04<00:11, 629.16it/s] 24%|████████████▎                                       | 2307/9741 [00:04<00:11, 631.91it/s] 24%|████████████▋                                       | 2371/9741 [00:04<00:11, 633.68it/s] 25%|█████████████                                       | 2436/9741 [00:04<00:11, 636.12it/s] 26%|█████████████▎                                      | 2500/9741 [00:04<00:11, 634.15it/s] 26%|█████████████▋                                      | 2564/9741 [00:04<00:11, 635.36it/s] 27%|██████████████                                      | 2629/9741 [00:04<00:11, 637.21it/s] 28%|██████████████▍                                     | 2693/9741 [00:05<00:11, 637.06it/s] 28%|██████████████▋                                     | 2757/9741 [00:05<00:11, 634.33it/s] 29%|███████████████                                     | 2821/9741 [00:05<00:10, 631.93it/s] 30%|███████████████▍                                    | 2886/9741 [00:05<00:10, 634.59it/s] 30%|███████████████▋                                    | 2950/9741 [00:05<00:10, 633.88it/s] 31%|████████████████                                    | 3015/9741 [00:05<00:10, 636.21it/s] 32%|████████████████▍                                   | 3079/9741 [00:05<00:10, 629.78it/s] 32%|████████████████▊                                   | 3143/9741 [00:05<00:10, 632.28it/s] 33%|█████████████████                                   | 3207/9741 [00:05<00:10, 631.95it/s] 34%|█████████████████▍                                  | 3271/9741 [00:05<00:10, 634.14it/s] 34%|█████████████████▊                                  | 3335/9741 [00:06<00:10, 635.20it/s] 35%|██████████████████▏                                 | 3399/9741 [00:06<00:10, 633.05it/s] 36%|██████████████████▍                                 | 3463/9741 [00:06<00:09, 634.71it/s] 36%|██████████████████▊                                 | 3527/9741 [00:06<00:09, 635.86it/s] 37%|███████████████████▏                                | 3591/9741 [00:06<00:09, 636.67it/s] 38%|███████████████████▌                                | 3655/9741 [00:06<00:09, 635.31it/s] 38%|███████████████████▊                                | 3720/9741 [00:06<00:09, 636.84it/s] 39%|████████████████████▏                               | 3785/9741 [00:06<00:09, 637.89it/s] 40%|████████████████████▌                               | 3849/9741 [00:06<00:09, 635.49it/s] 40%|████████████████████▉                               | 3913/9741 [00:06<00:09, 630.34it/s] 41%|█████████████████████▏                              | 3977/9741 [00:07<00:09, 633.14it/s] 41%|█████████████████████▌                              | 4041/9741 [00:07<00:08, 635.04it/s] 42%|█████████████████████▉                              | 4105/9741 [00:07<00:08, 632.68it/s] 43%|██████████████████████▎                             | 4169/9741 [00:07<00:08, 634.77it/s] 43%|██████████████████████▌                             | 4233/9741 [00:07<00:08, 635.68it/s] 44%|██████████████████████▉                             | 4297/9741 [00:07<00:08, 634.11it/s] 45%|███████████████████████▎                            | 4361/9741 [00:07<00:08, 635.15it/s] 45%|███████████████████████▌                            | 4425/9741 [00:07<00:08, 635.67it/s] 46%|███████████████████████▉                            | 4489/9741 [00:07<00:08, 636.54it/s] 47%|████████████████████████▎                           | 4553/9741 [00:08<00:08, 587.26it/s] 47%|████████████████████████▋                           | 4617/9741 [00:08<00:08, 602.07it/s] 48%|████████████████████████▉                           | 4681/9741 [00:08<00:08, 612.86it/s] 49%|█████████████████████████▎                          | 4743/9741 [00:08<00:11, 450.69it/s] 49%|█████████████████████████▋                          | 4807/9741 [00:08<00:09, 494.65it/s] 50%|██████████████████████████                          | 4871/9741 [00:08<00:09, 530.01it/s] 51%|██████████████████████████▎                         | 4935/9741 [00:08<00:08, 558.22it/s] 51%|██████████████████████████▋                         | 4999/9741 [00:08<00:08, 578.09it/s] 52%|███████████████████████████                         | 5063/9741 [00:08<00:07, 595.12it/s] 53%|███████████████████████████▎                        | 5127/9741 [00:09<00:07, 607.32it/s] 53%|███████████████████████████▋                        | 5190/9741 [00:09<00:07, 613.83it/s] 54%|████████████████████████████                        | 5254/9741 [00:09<00:07, 620.72it/s] 55%|████████████████████████████▍                       | 5318/9741 [00:09<00:07, 625.18it/s] 55%|████████████████████████████▋                       | 5382/9741 [00:09<00:06, 628.64it/s] 56%|█████████████████████████████                       | 5446/9741 [00:09<00:06, 629.04it/s] 57%|█████████████████████████████▍                      | 5512/9741 [00:09<00:06, 636.40it/s] 57%|█████████████████████████████▊                      | 5579/9741 [00:09<00:06, 644.32it/s] 58%|██████████████████████████████▏                     | 5645/9741 [00:09<00:06, 646.37it/s] 59%|██████████████████████████████▍                     | 5712/9741 [00:09<00:06, 651.75it/s] 59%|██████████████████████████████▊                     | 5779/9741 [00:10<00:06, 655.20it/s] 60%|███████████████████████████████▏                    | 5846/9741 [00:10<00:05, 657.58it/s] 61%|███████████████████████████████▌                    | 5912/9741 [00:10<00:05, 657.41it/s] 61%|███████████████████████████████▉                    | 5979/9741 [00:10<00:05, 660.73it/s] 62%|████████████████████████████████▎                   | 6046/9741 [00:10<00:05, 662.64it/s] 63%|████████████████████████████████▋                   | 6113/9741 [00:10<00:05, 660.72it/s] 63%|████████████████████████████████▉                   | 6180/9741 [00:10<00:05, 661.74it/s] 64%|█████████████████████████████████▎                  | 6247/9741 [00:10<00:05, 661.54it/s] 65%|█████████████████████████████████▋                  | 6314/9741 [00:10<00:05, 659.02it/s] 66%|██████████████████████████████████                  | 6381/9741 [00:10<00:05, 660.91it/s] 66%|██████████████████████████████████▍                 | 6448/9741 [00:11<00:04, 661.62it/s] 67%|██████████████████████████████████▊                 | 6515/9741 [00:11<00:04, 661.38it/s] 68%|███████████████████████████████████▏                | 6582/9741 [00:11<00:04, 659.01it/s] 68%|███████████████████████████████████▍                | 6649/9741 [00:11<00:04, 660.23it/s] 69%|███████████████████████████████████▊                | 6716/9741 [00:11<00:04, 660.44it/s] 70%|████████████████████████████████████▏               | 6783/9741 [00:11<00:04, 659.59it/s] 70%|████████████████████████████████████▌               | 6850/9741 [00:11<00:04, 660.30it/s] 71%|████████████████████████████████████▉               | 6917/9741 [00:11<00:04, 660.84it/s] 72%|█████████████████████████████████████▎              | 6984/9741 [00:11<00:04, 661.78it/s] 72%|█████████████████████████████████████▋              | 7051/9741 [00:11<00:04, 659.95it/s] 73%|█████████████████████████████████████▉              | 7118/9741 [00:12<00:03, 661.70it/s] 74%|██████████████████████████████████████▎             | 7185/9741 [00:12<00:03, 662.95it/s] 74%|██████████████████████████████████████▋             | 7252/9741 [00:12<00:03, 660.72it/s] 75%|███████████████████████████████████████             | 7319/9741 [00:12<00:03, 661.53it/s] 76%|███████████████████████████████████████▍            | 7386/9741 [00:12<00:03, 662.01it/s] 77%|███████████████████████████████████████▊            | 7453/9741 [00:12<00:03, 629.57it/s] 77%|████████████████████████████████████████▏           | 7520/9741 [00:12<00:03, 638.58it/s] 78%|████████████████████████████████████████▍           | 7586/9741 [00:12<00:03, 644.77it/s] 79%|████████████████████████████████████████▊           | 7653/9741 [00:12<00:03, 650.85it/s] 79%|█████████████████████████████████████████▏          | 7719/9741 [00:13<00:03, 652.33it/s] 80%|█████████████████████████████████████████▌          | 7786/9741 [00:13<00:02, 655.65it/s] 81%|█████████████████████████████████████████▉          | 7853/9741 [00:13<00:02, 658.28it/s] 81%|██████████████████████████████████████████▎         | 7919/9741 [00:13<00:02, 654.78it/s] 82%|██████████████████████████████████████████▋         | 7986/9741 [00:13<00:02, 656.70it/s] 83%|██████████████████████████████████████████▉         | 8053/9741 [00:13<00:02, 657.86it/s] 83%|███████████████████████████████████████████▎        | 8120/9741 [00:13<00:02, 658.18it/s] 84%|███████████████████████████████████████████▋        | 8187/9741 [00:13<00:02, 660.86it/s] 85%|████████████████████████████████████████████        | 8254/9741 [00:13<00:02, 661.52it/s] 85%|████████████████████████████████████████████▍       | 8321/9741 [00:13<00:02, 661.14it/s] 86%|████████████████████████████████████████████▊       | 8388/9741 [00:14<00:02, 658.78it/s] 87%|█████████████████████████████████████████████▏      | 8455/9741 [00:14<00:01, 659.61it/s] 87%|█████████████████████████████████████████████▍      | 8522/9741 [00:14<00:01, 660.92it/s] 88%|█████████████████████████████████████████████▊      | 8589/9741 [00:14<00:01, 658.49it/s] 89%|██████████████████████████████████████████████▏     | 8656/9741 [00:14<00:01, 659.62it/s] 90%|██████████████████████████████████████████████▌     | 8723/9741 [00:14<00:01, 661.59it/s] 90%|██████████████████████████████████████████████▉     | 8790/9741 [00:14<00:01, 661.57it/s] 91%|███████████████████████████████████████████████▎    | 8857/9741 [00:14<00:01, 660.06it/s] 92%|███████████████████████████████████████████████▋    | 8924/9741 [00:14<00:01, 661.09it/s] 92%|███████████████████████████████████████████████▉    | 8991/9741 [00:14<00:01, 661.07it/s] 93%|████████████████████████████████████████████████▎   | 9058/9741 [00:15<00:01, 656.81it/s] 94%|████████████████████████████████████████████████▋   | 9125/9741 [00:15<00:00, 658.55it/s] 94%|█████████████████████████████████████████████████   | 9192/9741 [00:15<00:00, 659.78it/s] 95%|█████████████████████████████████████████████████▍  | 9258/9741 [00:15<00:00, 658.26it/s] 96%|█████████████████████████████████████████████████▊  | 9325/9741 [00:15<00:00, 659.75it/s] 96%|██████████████████████████████████████████████████▏ | 9392/9741 [00:15<00:00, 660.92it/s] 97%|██████████████████████████████████████████████████▍ | 9459/9741 [00:15<00:00, 661.21it/s] 98%|██████████████████████████████████████████████████▊ | 9526/9741 [00:15<00:00, 659.77it/s] 98%|███████████████████████████████████████████████████▏| 9593/9741 [00:15<00:00, 660.08it/s] 99%|███████████████████████████████████████████████████▌| 9660/9741 [00:15<00:00, 659.30it/s]100%|███████████████████████████████████████████████████▉| 9726/9741 [00:16<00:00, 655.29it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:16<00:00, 605.58it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.16s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.20s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.00s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.07s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.22s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.22s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.38s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.56s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.49s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.65s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]
[2023-08-21 13:05:29,381] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 13:05:37,952] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 13:05:37,953] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 13:05:37,954] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 13:05:37,954] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 13:05:37,954] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 13:05:37,954] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f9ef2c83f40>
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f9ec954bdc0>
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 13:05:37,957] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4539928436279297 seconds
Loading extension module utils...
Time to load utils op: 0.4043312072753906 seconds
Loading extension module utils...
Time to load utils op: 0.40460658073425293 seconds
Loading extension module utils...
Time to load utils op: 0.5047159194946289 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o12-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:45<37:06, 45.43s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:30<36:14, 45.29s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:15<35:24, 45.19s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [03:01<34:48, 45.41s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:38<31:40, 42.24s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:23<31:44, 43.28s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:08<31:28, 43.91s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:54<31:06, 44.44s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:39<30:39, 44.87s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:25<30:01, 45.03s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [08:11<29:28, 45.34s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:56<28:45, 45.41s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:42<28:02, 45.46s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:13<24:39, 41.10s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:58<24:40, 42.31s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:43<24:26, 43.14s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:28<24:01, 43.70s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [13:14<23:40, 44.39s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:59<23:03, 44.64s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:44<22:22, 44.75s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [15:30<21:40, 44.85s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [16:01<19:01, 40.77s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:46<18:53, 41.99s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [17:31<18:35, 42.91s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [18:16<18:13, 43.72s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [19:02<17:46, 44.42s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [19:32<15:16, 39.86s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [20:17<15:13, 41.54s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [21:03<14:57, 42.73s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [21:49<14:35, 43.76s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [22:35<14:03, 44.40s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [23:20<13:23, 44.64s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [24:06<12:47, 45.14s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [24:52<12:07, 45.48s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [25:38<11:24, 45.62s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [26:24<10:39, 45.66s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [27:10<09:55, 45.81s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [27:56<09:10, 45.85s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [28:42<08:22, 45.72s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [29:27<07:36, 45.61s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [30:12<06:50, 45.56s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [30:39<05:19, 39.88s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [31:24<04:49, 41.37s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [32:10<04:16, 42.73s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [32:56<03:38, 43.75s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [33:41<02:56, 44.24s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [34:27<02:14, 44.78s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [35:13<01:30, 45.17s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [35:59<00:45, 45.17s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [36:44<00:00, 45.26s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [36:44<00:00, 44.09s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.2744} | lm_loss 8.0472 | avg. gen lenth: 308.38
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o13-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 13
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 13:42:29,679] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o13-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 13
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o13-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 41/9741 [00:00<00:24, 404.01it/s]  1%|▍                                                     | 82/9741 [00:00<00:23, 405.17it/s]  1%|▋                                                    | 123/9741 [00:00<00:23, 406.63it/s]  2%|▉                                                    | 164/9741 [00:00<00:23, 407.28it/s]  2%|█                                                    | 205/9741 [00:00<00:23, 404.99it/s]  3%|█▎                                                   | 246/9741 [00:00<00:23, 405.62it/s]  3%|█▌                                                   | 287/9741 [00:00<00:23, 406.07it/s]  3%|█▊                                                   | 328/9741 [00:00<00:23, 406.57it/s]  4%|██                                                   | 369/9741 [00:00<00:23, 406.31it/s]  4%|██▏                                                  | 410/9741 [00:01<00:22, 406.58it/s]  5%|██▍                                                  | 451/9741 [00:01<00:22, 404.80it/s]  5%|██▋                                                  | 492/9741 [00:01<00:23, 399.53it/s]  5%|██▉                                                  | 533/9741 [00:01<00:22, 401.39it/s]  6%|███                                                  | 574/9741 [00:01<00:22, 402.30it/s]  6%|███▎                                                 | 615/9741 [00:01<00:22, 403.01it/s]  7%|███▌                                                 | 656/9741 [00:01<00:22, 401.94it/s]  7%|███▊                                                 | 697/9741 [00:01<00:22, 402.99it/s]  8%|████                                                 | 738/9741 [00:01<00:22, 403.31it/s]  8%|████▏                                                | 779/9741 [00:01<00:22, 403.80it/s]  8%|████▍                                                | 820/9741 [00:02<00:22, 404.42it/s]  9%|████▋                                                | 861/9741 [00:02<00:24, 362.20it/s]  9%|████▉                                                | 899/9741 [00:02<00:25, 340.99it/s] 10%|█████                                                | 940/9741 [00:02<00:24, 357.99it/s] 10%|█████▎                                               | 981/9741 [00:02<00:23, 371.21it/s] 10%|█████▍                                              | 1021/9741 [00:02<00:23, 379.11it/s] 11%|█████▋                                              | 1062/9741 [00:02<00:22, 386.74it/s] 11%|█████▉                                              | 1103/9741 [00:02<00:21, 392.67it/s] 12%|██████                                              | 1143/9741 [00:02<00:21, 393.99it/s] 12%|██████▎                                             | 1184/9741 [00:03<00:21, 396.87it/s] 13%|██████▌                                             | 1224/9741 [00:03<00:21, 390.13it/s] 13%|██████▋                                             | 1264/9741 [00:03<00:21, 392.89it/s] 13%|██████▉                                             | 1305/9741 [00:03<00:21, 396.00it/s] 14%|███████▏                                            | 1345/9741 [00:03<00:21, 395.29it/s] 14%|███████▍                                            | 1386/9741 [00:03<00:21, 397.36it/s] 15%|███████▌                                            | 1426/9741 [00:03<00:20, 397.93it/s] 15%|███████▊                                            | 1467/9741 [00:03<00:20, 399.40it/s] 15%|████████                                            | 1508/9741 [00:03<00:20, 400.39it/s] 16%|████████▎                                           | 1549/9741 [00:03<00:20, 401.55it/s] 16%|████████▍                                           | 1590/9741 [00:04<00:20, 400.31it/s] 17%|████████▋                                           | 1631/9741 [00:04<00:20, 401.21it/s] 17%|████████▉                                           | 1672/9741 [00:04<00:20, 398.53it/s] 18%|█████████▎                                          | 1733/9741 [00:04<00:17, 460.12it/s] 18%|█████████▌                                          | 1789/9741 [00:04<00:17, 467.48it/s] 19%|█████████▉                                          | 1850/9741 [00:04<00:15, 507.06it/s] 20%|██████████▏                                         | 1911/9741 [00:04<00:14, 536.21it/s] 20%|██████████▌                                         | 1972/9741 [00:04<00:13, 556.24it/s] 21%|██████████▊                                         | 2032/9741 [00:04<00:13, 568.30it/s] 21%|███████████▏                                        | 2093/9741 [00:04<00:13, 578.77it/s] 22%|███████████▍                                        | 2154/9741 [00:05<00:12, 587.36it/s] 23%|███████████▊                                        | 2215/9741 [00:05<00:12, 593.70it/s] 23%|████████████▏                                       | 2275/9741 [00:05<00:12, 594.92it/s] 24%|████████████▍                                       | 2336/9741 [00:05<00:12, 598.17it/s] 25%|████████████▊                                       | 2397/9741 [00:05<00:12, 601.35it/s] 25%|█████████████                                       | 2458/9741 [00:05<00:12, 602.32it/s] 26%|█████████████▍                                      | 2519/9741 [00:05<00:12, 600.94it/s] 26%|█████████████▊                                      | 2580/9741 [00:05<00:11, 602.34it/s] 27%|██████████████                                      | 2641/9741 [00:05<00:11, 604.20it/s] 28%|██████████████▍                                     | 2702/9741 [00:05<00:11, 602.23it/s] 28%|██████████████▋                                     | 2763/9741 [00:06<00:11, 602.53it/s] 29%|███████████████                                     | 2824/9741 [00:06<00:11, 603.37it/s] 30%|███████████████▍                                    | 2885/9741 [00:06<00:11, 601.60it/s] 30%|███████████████▋                                    | 2946/9741 [00:06<00:11, 599.97it/s] 31%|████████████████                                    | 3007/9741 [00:06<00:11, 602.13it/s] 31%|████████████████▍                                   | 3068/9741 [00:06<00:11, 602.41it/s] 32%|████████████████▋                                   | 3129/9741 [00:06<00:10, 603.83it/s] 33%|█████████████████                                   | 3190/9741 [00:06<00:10, 601.98it/s] 33%|█████████████████▎                                  | 3251/9741 [00:06<00:10, 603.04it/s] 34%|█████████████████▋                                  | 3312/9741 [00:06<00:10, 603.71it/s] 35%|██████████████████                                  | 3373/9741 [00:07<00:10, 596.55it/s] 35%|██████████████████▎                                 | 3433/9741 [00:07<00:10, 594.92it/s] 36%|██████████████████▋                                 | 3494/9741 [00:07<00:10, 597.17it/s] 36%|██████████████████▉                                 | 3555/9741 [00:07<00:10, 599.25it/s] 37%|███████████████████▎                                | 3615/9741 [00:07<00:10, 597.64it/s] 38%|███████████████████▌                                | 3676/9741 [00:07<00:10, 599.72it/s] 38%|███████████████████▉                                | 3737/9741 [00:07<00:09, 601.95it/s] 39%|████████████████████▎                               | 3798/9741 [00:07<00:09, 601.21it/s] 40%|████████████████████▌                               | 3859/9741 [00:07<00:09, 599.24it/s] 40%|████████████████████▉                               | 3920/9741 [00:07<00:09, 600.65it/s] 41%|█████████████████████▎                              | 3981/9741 [00:08<00:09, 600.91it/s] 41%|█████████████████████▌                              | 4042/9741 [00:08<00:09, 602.21it/s] 42%|█████████████████████▉                              | 4103/9741 [00:08<00:09, 599.86it/s] 43%|██████████████████████▏                             | 4164/9741 [00:08<00:09, 600.99it/s] 43%|██████████████████████▌                             | 4225/9741 [00:08<00:09, 601.47it/s] 44%|██████████████████████▉                             | 4286/9741 [00:08<00:09, 599.87it/s] 45%|███████████████████████▏                            | 4346/9741 [00:08<00:08, 599.58it/s] 45%|███████████████████████▌                            | 4406/9741 [00:08<00:08, 599.61it/s] 46%|███████████████████████▊                            | 4467/9741 [00:08<00:08, 600.75it/s] 46%|████████████████████████▏                           | 4528/9741 [00:09<00:09, 555.48it/s] 47%|████████████████████████▍                           | 4589/9741 [00:09<00:09, 569.38it/s] 48%|████████████████████████▊                           | 4650/9741 [00:09<00:08, 579.86it/s] 48%|█████████████████████████▏                          | 4711/9741 [00:09<00:08, 586.60it/s] 49%|█████████████████████████▍                          | 4770/9741 [00:09<00:10, 459.19it/s] 50%|█████████████████████████▊                          | 4831/9741 [00:09<00:09, 495.01it/s] 50%|██████████████████████████                          | 4892/9741 [00:09<00:09, 523.42it/s] 51%|██████████████████████████▍                         | 4952/9741 [00:09<00:08, 541.93it/s] 51%|██████████████████████████▊                         | 5013/9741 [00:09<00:08, 559.06it/s] 52%|███████████████████████████                         | 5074/9741 [00:10<00:08, 571.72it/s] 53%|███████████████████████████▍                        | 5135/9741 [00:10<00:07, 581.47it/s] 53%|███████████████████████████▋                        | 5195/9741 [00:10<00:07, 586.12it/s] 54%|████████████████████████████                        | 5256/9741 [00:10<00:07, 590.49it/s] 55%|████████████████████████████▍                       | 5317/9741 [00:10<00:07, 593.54it/s] 55%|████████████████████████████▋                       | 5378/9741 [00:10<00:07, 596.56it/s] 56%|█████████████████████████████                       | 5438/9741 [00:10<00:07, 596.14it/s] 56%|█████████████████████████████▎                      | 5500/9741 [00:10<00:07, 601.48it/s] 57%|█████████████████████████████▋                      | 5564/9741 [00:10<00:06, 610.26it/s] 58%|██████████████████████████████                      | 5626/9741 [00:10<00:06, 613.07it/s] 58%|██████████████████████████████▎                     | 5689/9741 [00:11<00:06, 617.37it/s] 59%|██████████████████████████████▋                     | 5752/9741 [00:11<00:06, 620.88it/s] 60%|███████████████████████████████                     | 5815/9741 [00:11<00:06, 622.89it/s] 60%|███████████████████████████████▍                    | 5878/9741 [00:11<00:06, 621.07it/s] 61%|███████████████████████████████▋                    | 5941/9741 [00:11<00:06, 623.02it/s] 62%|████████████████████████████████                    | 6004/9741 [00:11<00:05, 624.82it/s] 62%|████████████████████████████████▍                   | 6067/9741 [00:11<00:05, 625.63it/s] 63%|████████████████████████████████▋                   | 6130/9741 [00:11<00:05, 623.27it/s] 64%|█████████████████████████████████                   | 6194/9741 [00:11<00:05, 625.46it/s] 64%|█████████████████████████████████▍                  | 6257/9741 [00:11<00:05, 626.09it/s] 65%|█████████████████████████████████▋                  | 6320/9741 [00:12<00:05, 624.03it/s] 66%|██████████████████████████████████                  | 6383/9741 [00:12<00:05, 625.41it/s] 66%|██████████████████████████████████▍                 | 6446/9741 [00:12<00:05, 626.13it/s] 67%|██████████████████████████████████▋                 | 6509/9741 [00:12<00:05, 625.84it/s] 67%|███████████████████████████████████                 | 6572/9741 [00:12<00:05, 623.45it/s] 68%|███████████████████████████████████▍                | 6635/9741 [00:12<00:04, 623.77it/s] 69%|███████████████████████████████████▊                | 6698/9741 [00:12<00:04, 624.98it/s] 69%|████████████████████████████████████                | 6761/9741 [00:12<00:04, 624.21it/s] 70%|████████████████████████████████████▍               | 6824/9741 [00:12<00:04, 625.43it/s] 71%|████████████████████████████████████▊               | 6887/9741 [00:12<00:04, 626.67it/s] 71%|█████████████████████████████████████               | 6950/9741 [00:13<00:04, 627.06it/s] 72%|█████████████████████████████████████▍              | 7013/9741 [00:13<00:04, 623.61it/s] 73%|█████████████████████████████████████▊              | 7076/9741 [00:13<00:04, 625.35it/s] 73%|██████████████████████████████████████              | 7139/9741 [00:13<00:04, 625.79it/s] 74%|██████████████████████████████████████▍             | 7202/9741 [00:13<00:04, 625.99it/s] 75%|██████████████████████████████████████▊             | 7265/9741 [00:13<00:03, 620.34it/s] 75%|███████████████████████████████████████             | 7328/9741 [00:13<00:03, 622.38it/s] 76%|███████████████████████████████████████▍            | 7391/9741 [00:13<00:03, 624.37it/s] 77%|███████████████████████████████████████▊            | 7454/9741 [00:13<00:03, 592.67it/s] 77%|████████████████████████████████████████▏           | 7517/9741 [00:13<00:03, 601.80it/s] 78%|████████████████████████████████████████▍           | 7580/9741 [00:14<00:03, 608.94it/s] 78%|████████████████████████████████████████▊           | 7643/9741 [00:14<00:03, 614.69it/s] 79%|█████████████████████████████████████████▏          | 7705/9741 [00:14<00:03, 614.49it/s] 80%|█████████████████████████████████████████▍          | 7768/9741 [00:14<00:03, 618.66it/s] 80%|█████████████████████████████████████████▊          | 7830/9741 [00:14<00:03, 614.70it/s] 81%|██████████████████████████████████████████▏         | 7893/9741 [00:14<00:03, 615.29it/s] 82%|██████████████████████████████████████████▍         | 7956/9741 [00:14<00:02, 618.74it/s] 82%|██████████████████████████████████████████▊         | 8019/9741 [00:14<00:02, 620.56it/s] 83%|███████████████████████████████████████████▏        | 8082/9741 [00:14<00:02, 621.85it/s] 84%|███████████████████████████████████████████▍        | 8145/9741 [00:14<00:02, 620.59it/s] 84%|███████████████████████████████████████████▊        | 8208/9741 [00:15<00:02, 622.03it/s] 85%|████████████████████████████████████████████▏       | 8271/9741 [00:15<00:02, 623.25it/s] 86%|████████████████████████████████████████████▍       | 8334/9741 [00:15<00:02, 623.79it/s] 86%|████████████████████████████████████████████▊       | 8397/9741 [00:15<00:02, 621.21it/s] 87%|█████████████████████████████████████████████▏      | 8460/9741 [00:15<00:02, 618.06it/s] 87%|█████████████████████████████████████████████▍      | 8523/9741 [00:15<00:01, 620.86it/s] 88%|█████████████████████████████████████████████▊      | 8586/9741 [00:15<00:01, 618.79it/s] 89%|██████████████████████████████████████████████▏     | 8649/9741 [00:15<00:01, 620.90it/s] 89%|██████████████████████████████████████████████▌     | 8712/9741 [00:15<00:01, 622.90it/s] 90%|██████████████████████████████████████████████▊     | 8775/9741 [00:16<00:01, 623.81it/s] 91%|███████████████████████████████████████████████▏    | 8838/9741 [00:16<00:01, 621.98it/s] 91%|███████████████████████████████████████████████▌    | 8901/9741 [00:16<00:01, 622.80it/s] 92%|███████████████████████████████████████████████▊    | 8964/9741 [00:16<00:01, 623.63it/s] 93%|████████████████████████████████████████████████▏   | 9027/9741 [00:16<00:01, 624.43it/s] 93%|████████████████████████████████████████████████▌   | 9090/9741 [00:16<00:01, 618.24it/s] 94%|████████████████████████████████████████████████▊   | 9153/9741 [00:16<00:00, 620.46it/s] 95%|█████████████████████████████████████████████████▏  | 9216/9741 [00:16<00:00, 621.94it/s] 95%|█████████████████████████████████████████████████▌  | 9279/9741 [00:16<00:00, 619.91it/s] 96%|█████████████████████████████████████████████████▊  | 9342/9741 [00:16<00:00, 620.58it/s] 97%|██████████████████████████████████████████████████▏ | 9405/9741 [00:17<00:00, 621.91it/s] 97%|██████████████████████████████████████████████████▌ | 9468/9741 [00:17<00:00, 622.87it/s] 98%|██████████████████████████████████████████████████▉ | 9531/9741 [00:17<00:00, 620.99it/s] 98%|███████████████████████████████████████████████████▏| 9594/9741 [00:17<00:00, 622.26it/s] 99%|███████████████████████████████████████████████████▌| 9657/9741 [00:17<00:00, 623.35it/s]100%|███████████████████████████████████████████████████▉| 9720/9741 [00:17<00:00, 621.18it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:17<00:00, 554.67it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.02s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.30s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.53s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.13s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.61s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.35s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.57s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.13s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
[2023-08-21 13:43:40,113] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
[2023-08-21 13:43:54,084] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 13:43:54,084] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f520d84ff40>
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f51e3a3cdc0>
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 13:43:54,087] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.479752779006958 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o13-tgsm8k-s1-rFalse
Time to load utils op: 0.40436482429504395 seconds
Loading extension module utils...
Time to load utils op: 0.5045933723449707 seconds
Loading extension module utils...
Time to load utils op: 0.5047204494476318 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:45<36:55, 45.22s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:29<35:44, 44.68s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:14<35:03, 44.76s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:59<34:25, 44.91s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:45<33:51, 45.16s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:29<33:00, 45.02s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:14<32:11, 44.91s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:59<31:21, 44.80s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:43<30:33, 44.71s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:28<29:55, 44.90s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [08:14<29:18, 45.08s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [09:00<28:38, 45.23s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:40<27:03, 43.88s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:14<24:30, 40.85s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:59<24:28, 41.95s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:44<24:18, 42.89s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:29<23:57, 43.55s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [13:05<21:59, 41.22s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:49<21:46, 42.14s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:34<21:33, 43.13s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [15:19<21:05, 43.63s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [16:05<20:38, 44.22s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:34<17:49, 39.61s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [17:19<17:53, 41.28s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [18:04<17:41, 42.47s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:49<17:15, 43.15s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [19:34<16:47, 43.80s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [20:19<16:13, 44.27s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:49<13:58, 39.94s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [21:34<13:49, 41.48s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [22:19<13:25, 42.41s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [22:56<12:16, 40.90s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [23:41<11:57, 42.18s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:59<09:17, 34.84s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [24:44<09:28, 37.91s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [25:31<09:26, 40.46s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [26:16<09:06, 42.03s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [27:01<08:34, 42.88s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [27:47<07:59, 43.61s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [28:31<07:19, 43.96s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [29:16<06:37, 44.17s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [30:01<05:56, 44.52s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [30:46<05:12, 44.61s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [31:32<04:29, 44.85s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [32:17<03:44, 44.95s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [33:02<03:00, 45.08s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [33:47<02:14, 44.95s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [34:19<01:22, 41.00s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [35:04<00:42, 42.38s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [35:49<00:00, 43.09s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [35:49<00:00, 42.99s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.1197} | lm_loss 8.1181 | avg. gen lenth: 287.108
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o14-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 14
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 14:21:09,013] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o14-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 14
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o14-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 32/9741 [00:00<00:30, 313.68it/s]  1%|▎                                                     | 64/9741 [00:00<00:30, 315.12it/s]  1%|▌                                                     | 96/9741 [00:00<00:30, 315.74it/s]  1%|▋                                                    | 128/9741 [00:00<00:30, 315.87it/s]  2%|▊                                                    | 160/9741 [00:00<00:32, 296.38it/s]  2%|█                                                    | 192/9741 [00:00<00:31, 301.93it/s]  2%|█▏                                                   | 223/9741 [00:00<00:31, 304.27it/s]  3%|█▍                                                   | 254/9741 [00:00<00:31, 299.34it/s]  3%|█▌                                                   | 286/9741 [00:00<00:31, 303.27it/s]  3%|█▋                                                   | 318/9741 [00:01<00:30, 306.45it/s]  4%|█▉                                                   | 350/9741 [00:01<00:30, 308.44it/s]  4%|██                                                   | 382/9741 [00:01<00:30, 309.92it/s]  4%|██▎                                                  | 414/9741 [00:01<00:30, 310.87it/s]  5%|██▍                                                  | 446/9741 [00:01<00:30, 309.61it/s]  5%|██▌                                                  | 478/9741 [00:01<00:29, 310.72it/s]  5%|██▊                                                  | 510/9741 [00:01<00:29, 311.23it/s]  6%|██▉                                                  | 542/9741 [00:01<00:30, 305.95it/s]  6%|███                                                  | 573/9741 [00:01<00:29, 306.49it/s]  6%|███▎                                                 | 605/9741 [00:01<00:29, 308.25it/s]  7%|███▍                                                 | 637/9741 [00:02<00:29, 309.67it/s]  7%|███▋                                                 | 668/9741 [00:02<00:29, 308.23it/s]  7%|███▊                                                 | 700/9741 [00:02<00:29, 309.78it/s]  8%|███▉                                                 | 732/9741 [00:02<00:29, 310.26it/s]  8%|████▏                                                | 764/9741 [00:02<00:28, 311.23it/s]  8%|████▎                                                | 796/9741 [00:02<00:28, 312.14it/s]  9%|████▌                                                | 828/9741 [00:02<00:28, 312.50it/s]  9%|████▋                                                | 863/9741 [00:02<00:27, 323.42it/s]  9%|████▉                                                | 910/9741 [00:02<00:24, 365.73it/s] 10%|█████▏                                               | 958/9741 [00:02<00:22, 397.99it/s] 10%|█████▎                                              | 1005/9741 [00:03<00:20, 418.01it/s] 11%|█████▌                                              | 1053/9741 [00:03<00:19, 434.66it/s] 11%|█████▉                                              | 1101/9741 [00:03<00:19, 446.48it/s] 12%|██████▏                                             | 1148/9741 [00:03<00:18, 452.34it/s] 12%|██████▍                                             | 1196/9741 [00:03<00:18, 458.65it/s] 13%|██████▋                                             | 1244/9741 [00:03<00:18, 462.09it/s] 13%|██████▉                                             | 1292/9741 [00:03<00:18, 465.29it/s] 14%|███████▏                                            | 1339/9741 [00:03<00:18, 464.84it/s] 14%|███████▍                                            | 1387/9741 [00:03<00:17, 467.05it/s] 15%|███████▋                                            | 1435/9741 [00:03<00:17, 468.64it/s] 15%|███████▉                                            | 1483/9741 [00:04<00:17, 469.82it/s] 16%|████████▏                                           | 1531/9741 [00:04<00:17, 470.47it/s] 16%|████████▍                                           | 1579/9741 [00:04<00:17, 468.20it/s] 17%|████████▋                                           | 1626/9741 [00:04<00:17, 464.55it/s] 17%|████████▉                                           | 1674/9741 [00:04<00:17, 467.11it/s] 18%|█████████▏                                          | 1722/9741 [00:04<00:17, 468.54it/s] 18%|█████████▍                                          | 1770/9741 [00:04<00:16, 469.55it/s] 19%|█████████▋                                          | 1817/9741 [00:04<00:18, 433.24it/s] 19%|█████████▉                                          | 1865/9741 [00:04<00:17, 444.26it/s] 20%|██████████▏                                         | 1913/9741 [00:05<00:17, 452.17it/s] 20%|██████████▍                                         | 1961/9741 [00:05<00:16, 457.70it/s] 21%|██████████▋                                         | 2009/9741 [00:05<00:16, 461.92it/s] 21%|██████████▉                                         | 2056/9741 [00:05<00:16, 462.10it/s] 22%|███████████▏                                        | 2103/9741 [00:05<00:16, 463.94it/s] 22%|███████████▍                                        | 2150/9741 [00:05<00:16, 464.24it/s] 23%|███████████▋                                        | 2198/9741 [00:05<00:16, 466.29it/s] 23%|███████████▉                                        | 2245/9741 [00:05<00:16, 462.67it/s] 24%|████████████▏                                       | 2293/9741 [00:05<00:16, 465.05it/s] 24%|████████████▍                                       | 2341/9741 [00:05<00:15, 467.05it/s] 25%|████████████▊                                       | 2389/9741 [00:06<00:15, 468.64it/s] 25%|█████████████                                       | 2437/9741 [00:06<00:15, 470.07it/s] 26%|█████████████▎                                      | 2485/9741 [00:06<00:15, 467.76it/s] 26%|█████████████▌                                      | 2533/9741 [00:06<00:15, 468.65it/s] 26%|█████████████▊                                      | 2581/9741 [00:06<00:15, 469.81it/s] 27%|██████████████                                      | 2629/9741 [00:06<00:15, 470.36it/s] 27%|██████████████▎                                     | 2677/9741 [00:06<00:15, 470.84it/s] 28%|██████████████▌                                     | 2725/9741 [00:06<00:14, 467.90it/s] 28%|██████████████▊                                     | 2773/9741 [00:06<00:14, 468.70it/s] 29%|███████████████                                     | 2821/9741 [00:06<00:14, 469.15it/s] 29%|███████████████▎                                    | 2869/9741 [00:07<00:14, 470.36it/s] 30%|███████████████▌                                    | 2917/9741 [00:07<00:14, 471.12it/s] 30%|███████████████▊                                    | 2965/9741 [00:07<00:14, 468.95it/s] 31%|████████████████                                    | 3012/9741 [00:07<00:14, 468.37it/s] 31%|████████████████▎                                   | 3059/9741 [00:07<00:14, 468.71it/s] 32%|████████████████▌                                   | 3107/9741 [00:07<00:14, 469.45it/s] 32%|████████████████▊                                   | 3154/9741 [00:07<00:14, 467.55it/s] 33%|█████████████████                                   | 3202/9741 [00:07<00:13, 468.91it/s] 33%|█████████████████▎                                  | 3250/9741 [00:07<00:13, 469.97it/s] 34%|█████████████████▌                                  | 3298/9741 [00:07<00:13, 470.31it/s] 34%|█████████████████▊                                  | 3346/9741 [00:08<00:13, 470.38it/s] 35%|██████████████████                                  | 3394/9741 [00:08<00:13, 468.44it/s] 35%|██████████████████▎                                 | 3442/9741 [00:08<00:13, 469.06it/s] 36%|██████████████████▋                                 | 3489/9741 [00:08<00:13, 469.24it/s] 36%|██████████████████▉                                 | 3537/9741 [00:08<00:13, 469.52it/s] 37%|███████████████████▏                                | 3584/9741 [00:08<00:13, 469.25it/s] 37%|███████████████████▍                                | 3631/9741 [00:08<00:13, 467.05it/s] 38%|███████████████████▋                                | 3679/9741 [00:08<00:12, 468.35it/s] 38%|███████████████████▉                                | 3727/9741 [00:08<00:12, 469.59it/s] 39%|████████████████████▏                               | 3775/9741 [00:09<00:12, 470.10it/s] 39%|████████████████████▍                               | 3823/9741 [00:09<00:12, 468.89it/s] 40%|████████████████████▋                               | 3870/9741 [00:09<00:12, 467.53it/s] 40%|████████████████████▉                               | 3918/9741 [00:09<00:12, 468.64it/s] 41%|█████████████████████▏                              | 3966/9741 [00:09<00:12, 469.29it/s] 41%|█████████████████████▍                              | 4014/9741 [00:09<00:12, 469.56it/s] 42%|█████████████████████▋                              | 4061/9741 [00:09<00:12, 467.34it/s] 42%|█████████████████████▉                              | 4108/9741 [00:09<00:12, 467.93it/s] 43%|██████████████████████▏                             | 4156/9741 [00:09<00:11, 468.86it/s] 43%|██████████████████████▍                             | 4204/9741 [00:09<00:11, 469.51it/s] 44%|██████████████████████▋                             | 4252/9741 [00:10<00:11, 469.76it/s] 44%|██████████████████████▉                             | 4299/9741 [00:10<00:11, 468.14it/s] 45%|███████████████████████▏                            | 4347/9741 [00:10<00:11, 469.03it/s] 45%|███████████████████████▍                            | 4395/9741 [00:10<00:11, 469.55it/s] 46%|███████████████████████▋                            | 4442/9741 [00:10<00:11, 469.58it/s] 46%|███████████████████████▉                            | 4489/9741 [00:10<00:11, 469.16it/s] 47%|████████████████████████▏                           | 4536/9741 [00:10<00:11, 438.56it/s] 47%|████████████████████████▍                           | 4583/9741 [00:10<00:11, 447.34it/s] 48%|████████████████████████▋                           | 4631/9741 [00:10<00:11, 454.58it/s] 48%|████████████████████████▉                           | 4678/9741 [00:10<00:11, 458.52it/s] 49%|█████████████████████████▏                          | 4726/9741 [00:11<00:10, 462.28it/s] 49%|█████████████████████████▍                          | 4773/9741 [00:11<00:15, 320.54it/s] 49%|█████████████████████████▋                          | 4821/9741 [00:11<00:13, 355.15it/s] 50%|█████████████████████████▉                          | 4869/9741 [00:11<00:12, 383.58it/s] 50%|██████████████████████████▏                         | 4917/9741 [00:11<00:11, 406.48it/s] 51%|██████████████████████████▍                         | 4964/9741 [00:11<00:11, 421.72it/s] 51%|██████████████████████████▊                         | 5012/9741 [00:11<00:10, 435.72it/s] 52%|███████████████████████████                         | 5060/9741 [00:11<00:10, 446.13it/s] 52%|███████████████████████████▎                        | 5108/9741 [00:12<00:10, 453.62it/s] 53%|███████████████████████████▌                        | 5156/9741 [00:12<00:09, 459.01it/s] 53%|███████████████████████████▊                        | 5203/9741 [00:12<00:09, 460.56it/s] 54%|████████████████████████████                        | 5251/9741 [00:12<00:09, 463.49it/s] 54%|████████████████████████████▎                       | 5299/9741 [00:12<00:09, 465.96it/s] 55%|████████████████████████████▌                       | 5346/9741 [00:12<00:09, 463.00it/s] 55%|████████████████████████████▊                       | 5394/9741 [00:12<00:09, 465.32it/s] 56%|█████████████████████████████                       | 5441/9741 [00:12<00:09, 464.71it/s] 56%|█████████████████████████████▎                      | 5489/9741 [00:12<00:09, 468.56it/s] 57%|█████████████████████████████▌                      | 5538/9741 [00:12<00:08, 474.38it/s] 57%|█████████████████████████████▊                      | 5587/9741 [00:13<00:08, 478.34it/s] 58%|██████████████████████████████                      | 5636/9741 [00:13<00:08, 479.11it/s] 58%|██████████████████████████████▎                     | 5685/9741 [00:13<00:08, 481.61it/s] 59%|██████████████████████████████▌                     | 5734/9741 [00:13<00:08, 483.38it/s] 59%|██████████████████████████████▊                     | 5783/9741 [00:13<00:08, 484.70it/s] 60%|███████████████████████████████▏                    | 5832/9741 [00:13<00:08, 485.38it/s] 60%|███████████████████████████████▍                    | 5881/9741 [00:13<00:07, 482.75it/s] 61%|███████████████████████████████▋                    | 5930/9741 [00:13<00:07, 483.05it/s] 61%|███████████████████████████████▉                    | 5979/9741 [00:13<00:07, 483.78it/s] 62%|████████████████████████████████▏                   | 6028/9741 [00:13<00:07, 484.58it/s] 62%|████████████████████████████████▍                   | 6077/9741 [00:14<00:07, 485.52it/s] 63%|████████████████████████████████▋                   | 6126/9741 [00:14<00:07, 479.28it/s] 63%|████████████████████████████████▉                   | 6175/9741 [00:14<00:07, 481.25it/s] 64%|█████████████████████████████████▏                  | 6224/9741 [00:14<00:07, 482.49it/s] 64%|█████████████████████████████████▍                  | 6273/9741 [00:14<00:07, 483.47it/s] 65%|█████████████████████████████████▋                  | 6322/9741 [00:14<00:07, 481.80it/s] 65%|██████████████████████████████████                  | 6371/9741 [00:14<00:06, 482.96it/s] 66%|██████████████████████████████████▎                 | 6420/9741 [00:14<00:06, 484.12it/s] 66%|██████████████████████████████████▌                 | 6469/9741 [00:14<00:06, 484.52it/s] 67%|██████████████████████████████████▊                 | 6518/9741 [00:14<00:06, 484.65it/s] 67%|███████████████████████████████████                 | 6567/9741 [00:15<00:06, 483.02it/s] 68%|███████████████████████████████████▎                | 6616/9741 [00:15<00:06, 484.34it/s] 68%|███████████████████████████████████▌                | 6665/9741 [00:15<00:06, 485.26it/s] 69%|███████████████████████████████████▊                | 6714/9741 [00:15<00:06, 485.89it/s] 69%|████████████████████████████████████                | 6763/9741 [00:15<00:06, 483.98it/s] 70%|████████████████████████████████████▎               | 6812/9741 [00:15<00:06, 484.76it/s] 70%|████████████████████████████████████▋               | 6861/9741 [00:15<00:05, 485.54it/s] 71%|████████████████████████████████████▉               | 6910/9741 [00:15<00:05, 485.51it/s] 71%|█████████████████████████████████████▏              | 6959/9741 [00:15<00:05, 480.05it/s] 72%|█████████████████████████████████████▍              | 7008/9741 [00:15<00:05, 477.60it/s] 72%|█████████████████████████████████████▋              | 7057/9741 [00:16<00:05, 480.17it/s] 73%|█████████████████████████████████████▉              | 7106/9741 [00:16<00:05, 482.00it/s] 73%|██████████████████████████████████████▏             | 7155/9741 [00:16<00:05, 483.21it/s] 74%|██████████████████████████████████████▍             | 7204/9741 [00:16<00:05, 484.56it/s] 74%|██████████████████████████████████████▋             | 7253/9741 [00:16<00:05, 483.19it/s] 75%|██████████████████████████████████████▉             | 7302/9741 [00:16<00:05, 484.23it/s] 75%|███████████████████████████████████████▏            | 7351/9741 [00:16<00:04, 484.72it/s] 76%|███████████████████████████████████████▌            | 7400/9741 [00:16<00:04, 486.11it/s] 76%|███████████████████████████████████████▊            | 7449/9741 [00:16<00:05, 441.18it/s] 77%|████████████████████████████████████████            | 7498/9741 [00:17<00:04, 453.84it/s] 77%|████████████████████████████████████████▎           | 7547/9741 [00:17<00:04, 463.17it/s] 78%|████████████████████████████████████████▌           | 7596/9741 [00:17<00:04, 470.15it/s] 78%|████████████████████████████████████████▊           | 7645/9741 [00:17<00:04, 475.19it/s] 79%|█████████████████████████████████████████           | 7693/9741 [00:17<00:04, 476.22it/s] 79%|█████████████████████████████████████████▎          | 7742/9741 [00:17<00:04, 479.94it/s] 80%|█████████████████████████████████████████▌          | 7791/9741 [00:17<00:04, 476.18it/s] 80%|█████████████████████████████████████████▊          | 7840/9741 [00:17<00:03, 479.49it/s] 81%|██████████████████████████████████████████          | 7889/9741 [00:17<00:03, 481.04it/s] 81%|██████████████████████████████████████████▍         | 7938/9741 [00:17<00:03, 480.62it/s] 82%|██████████████████████████████████████████▋         | 7987/9741 [00:18<00:03, 482.30it/s] 82%|██████████████████████████████████████████▉         | 8036/9741 [00:18<00:03, 483.20it/s] 83%|███████████████████████████████████████████▏        | 8085/9741 [00:18<00:03, 483.79it/s] 84%|███████████████████████████████████████████▍        | 8134/9741 [00:18<00:03, 482.93it/s] 84%|███████████████████████████████████████████▋        | 8183/9741 [00:18<00:03, 483.64it/s] 85%|███████████████████████████████████████████▉        | 8232/9741 [00:18<00:03, 484.26it/s] 85%|████████████████████████████████████████████▏       | 8281/9741 [00:18<00:03, 485.03it/s] 86%|████████████████████████████████████████████▍       | 8330/9741 [00:18<00:02, 485.44it/s] 86%|████████████████████████████████████████████▋       | 8379/9741 [00:18<00:02, 483.60it/s] 87%|████████████████████████████████████████████▉       | 8428/9741 [00:18<00:02, 483.87it/s] 87%|█████████████████████████████████████████████▎      | 8477/9741 [00:19<00:02, 484.54it/s] 88%|█████████████████████████████████████████████▌      | 8526/9741 [00:19<00:02, 485.29it/s] 88%|█████████████████████████████████████████████▊      | 8575/9741 [00:19<00:02, 482.66it/s] 89%|██████████████████████████████████████████████      | 8624/9741 [00:19<00:02, 483.40it/s] 89%|██████████████████████████████████████████████▎     | 8673/9741 [00:19<00:02, 484.30it/s] 90%|██████████████████████████████████████████████▌     | 8722/9741 [00:19<00:02, 485.20it/s] 90%|██████████████████████████████████████████████▊     | 8771/9741 [00:19<00:01, 485.48it/s] 91%|███████████████████████████████████████████████     | 8820/9741 [00:19<00:01, 483.31it/s] 91%|███████████████████████████████████████████████▎    | 8869/9741 [00:19<00:01, 484.29it/s] 92%|███████████████████████████████████████████████▌    | 8918/9741 [00:19<00:01, 484.77it/s] 92%|███████████████████████████████████████████████▊    | 8967/9741 [00:20<00:01, 484.96it/s] 93%|████████████████████████████████████████████████▏   | 9016/9741 [00:20<00:01, 485.38it/s] 93%|████████████████████████████████████████████████▍   | 9065/9741 [00:20<00:01, 483.17it/s] 94%|████████████████████████████████████████████████▋   | 9114/9741 [00:20<00:01, 484.29it/s] 94%|████████████████████████████████████████████████▉   | 9163/9741 [00:20<00:01, 485.10it/s] 95%|█████████████████████████████████████████████████▏  | 9212/9741 [00:20<00:01, 485.37it/s] 95%|█████████████████████████████████████████████████▍  | 9261/9741 [00:20<00:00, 484.08it/s] 96%|█████████████████████████████████████████████████▋  | 9310/9741 [00:20<00:00, 484.05it/s] 96%|█████████████████████████████████████████████████▉  | 9359/9741 [00:20<00:00, 483.44it/s] 97%|██████████████████████████████████████████████████▏ | 9408/9741 [00:20<00:00, 483.69it/s] 97%|██████████████████████████████████████████████████▍ | 9457/9741 [00:21<00:00, 483.85it/s] 98%|██████████████████████████████████████████████████▋ | 9506/9741 [00:21<00:00, 482.06it/s] 98%|███████████████████████████████████████████████████ | 9555/9741 [00:21<00:00, 482.47it/s] 99%|███████████████████████████████████████████████████▎| 9604/9741 [00:21<00:00, 483.04it/s] 99%|███████████████████████████████████████████████████▌| 9653/9741 [00:21<00:00, 480.32it/s]100%|███████████████████████████████████████████████████▊| 9702/9741 [00:21<00:00, 481.66it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:21<00:00, 449.56it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.11s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.22s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.78s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.20s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.08s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:12<00:06,  6.16s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
[2023-08-21 14:22:22,196] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:17<00:00,  5.82s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:17<00:00,  5.87s/it]
[2023-08-21 14:22:40,890] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 14:22:40,891] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fb54425bf40>
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fb518e07d30>
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 14:22:40,894] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.49880003929138184 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Time to load utils op: 0.5047774314880371 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]Loading extension module utils...
############### Example ###############
Time to load utils op: 0.5045032501220703 seconds
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o14-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.5044536590576172 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:44<36:22, 44.54s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:27<35:04, 43.84s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:11<34:13, 43.70s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:54<33:19, 43.48s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:38<32:36, 43.47s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:20<31:34, 43.06s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:03<30:55, 43.16s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:47<30:16, 43.24s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:30<29:35, 43.30s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:13<28:53, 43.33s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:57<28:14, 43.45s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:41<27:39, 43.67s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:26<27:02, 43.85s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:11<26:37, 44.38s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:55<25:45, 44.15s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:39<24:57, 44.04s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:22<24:10, 43.97s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [13:06<23:22, 43.83s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:36<20:31, 39.73s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:20<20:26, 40.87s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [15:04<20:12, 41.82s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:46<19:39, 42.14s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:30<19:06, 42.45s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [17:13<18:32, 42.81s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:58<18:01, 43.25s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:24<15:19, 38.30s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [19:08<15:16, 39.84s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [19:51<14:58, 40.86s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:35<14:34, 41.65s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [21:19<14:10, 42.53s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [22:03<13:35, 42.92s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [22:46<12:54, 43.05s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [23:30<12:13, 43.15s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:52<09:48, 36.79s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [24:35<09:42, 38.83s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [25:19<09:24, 40.34s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [26:03<08:56, 41.30s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [26:46<08:25, 42.08s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [27:26<07:33, 41.24s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [28:10<07:01, 42.11s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [28:54<06:23, 42.61s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [29:36<05:40, 42.55s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [30:20<05:01, 43.05s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [31:04<04:19, 43.24s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [31:48<03:37, 43.43s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [32:31<02:53, 43.45s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [33:15<02:10, 43.64s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [33:59<01:27, 43.66s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [34:42<00:43, 43.56s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [35:26<00:00, 43.57s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [35:26<00:00, 42.53s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.9228} | lm_loss 8.1879 | avg. gen lenth: 311.896
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o15-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 15
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 14:58:57,788] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o15-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 15
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o15-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 31/9741 [00:00<00:31, 304.45it/s]  1%|▎                                                     | 62/9741 [00:00<00:31, 306.16it/s]  1%|▌                                                     | 93/9741 [00:00<00:31, 306.53it/s]  1%|▋                                                    | 124/9741 [00:00<00:31, 306.86it/s]  2%|▊                                                    | 155/9741 [00:00<00:31, 307.04it/s]  2%|█                                                    | 186/9741 [00:00<00:31, 306.50it/s]  2%|█▏                                                   | 217/9741 [00:00<00:31, 299.83it/s]  3%|█▎                                                   | 248/9741 [00:00<00:31, 300.95it/s]  3%|█▌                                                   | 279/9741 [00:00<00:31, 301.92it/s]  3%|█▋                                                   | 310/9741 [00:01<00:31, 303.25it/s]  4%|█▊                                                   | 341/9741 [00:01<00:30, 303.65it/s]  4%|██                                                   | 372/9741 [00:01<00:30, 304.07it/s]  4%|██▏                                                  | 403/9741 [00:01<00:30, 304.43it/s]  4%|██▎                                                  | 434/9741 [00:01<00:30, 302.37it/s]  5%|██▌                                                  | 465/9741 [00:01<00:30, 302.96it/s]  5%|██▋                                                  | 496/9741 [00:01<00:30, 303.55it/s]  5%|██▊                                                  | 527/9741 [00:01<00:30, 301.28it/s]  6%|███                                                  | 558/9741 [00:01<00:30, 301.99it/s]  6%|███▎                                                 | 602/9741 [00:01<00:26, 341.21it/s]  7%|███▌                                                 | 649/9741 [00:02<00:24, 377.55it/s]  7%|███▊                                                 | 695/9741 [00:02<00:22, 401.15it/s]  8%|████                                                 | 742/9741 [00:02<00:21, 419.63it/s]  8%|████▎                                                | 789/9741 [00:02<00:20, 433.13it/s]  9%|████▌                                                | 836/9741 [00:02<00:20, 442.24it/s]  9%|████▊                                                | 882/9741 [00:02<00:19, 446.77it/s] 10%|█████                                                | 929/9741 [00:02<00:19, 451.73it/s] 10%|█████▎                                               | 976/9741 [00:02<00:19, 455.27it/s] 11%|█████▍                                              | 1023/9741 [00:02<00:19, 457.58it/s] 11%|█████▋                                              | 1070/9741 [00:02<00:18, 458.99it/s] 11%|█████▉                                              | 1116/9741 [00:03<00:18, 457.67it/s] 12%|██████▏                                             | 1163/9741 [00:03<00:18, 459.14it/s] 12%|██████▍                                             | 1210/9741 [00:03<00:18, 459.88it/s] 13%|██████▋                                             | 1257/9741 [00:03<00:18, 460.58it/s] 13%|██████▉                                             | 1304/9741 [00:03<00:18, 460.78it/s] 14%|███████▏                                            | 1351/9741 [00:03<00:18, 458.98it/s] 14%|███████▍                                            | 1397/9741 [00:03<00:18, 459.08it/s] 15%|███████▋                                            | 1444/9741 [00:03<00:18, 459.49it/s] 15%|███████▉                                            | 1491/9741 [00:03<00:17, 459.94it/s] 16%|████████▏                                           | 1538/9741 [00:03<00:17, 460.10it/s] 16%|████████▍                                           | 1585/9741 [00:04<00:17, 458.13it/s] 17%|████████▋                                           | 1632/9741 [00:04<00:17, 459.07it/s] 17%|████████▉                                           | 1679/9741 [00:04<00:17, 459.83it/s] 18%|█████████▏                                          | 1726/9741 [00:04<00:17, 460.09it/s] 18%|█████████▍                                          | 1773/9741 [00:04<00:17, 460.64it/s] 19%|█████████▋                                          | 1820/9741 [00:04<00:18, 438.81it/s] 19%|█████████▉                                          | 1866/9741 [00:04<00:17, 444.60it/s] 20%|██████████▏                                         | 1913/9741 [00:04<00:17, 449.25it/s] 20%|██████████▍                                         | 1959/9741 [00:04<00:17, 452.23it/s] 21%|██████████▋                                         | 2006/9741 [00:05<00:16, 455.17it/s] 21%|██████████▉                                         | 2052/9741 [00:05<00:16, 453.76it/s] 22%|███████████▏                                        | 2098/9741 [00:05<00:16, 454.95it/s] 22%|███████████▍                                        | 2145/9741 [00:05<00:16, 456.48it/s] 22%|███████████▋                                        | 2191/9741 [00:05<00:16, 457.44it/s] 23%|███████████▉                                        | 2237/9741 [00:05<00:16, 458.18it/s] 23%|████████████▏                                       | 2283/9741 [00:05<00:16, 456.56it/s] 24%|████████████▍                                       | 2329/9741 [00:05<00:16, 455.51it/s] 24%|████████████▋                                       | 2376/9741 [00:05<00:16, 457.02it/s] 25%|████████████▉                                       | 2423/9741 [00:05<00:15, 458.13it/s] 25%|█████████████▏                                      | 2469/9741 [00:06<00:15, 458.67it/s] 26%|█████████████▍                                      | 2515/9741 [00:06<00:15, 456.26it/s] 26%|█████████████▋                                      | 2561/9741 [00:06<00:15, 456.95it/s] 27%|█████████████▉                                      | 2608/9741 [00:06<00:15, 458.23it/s] 27%|██████████████▏                                     | 2654/9741 [00:06<00:15, 458.30it/s] 28%|██████████████▍                                     | 2700/9741 [00:06<00:15, 456.19it/s] 28%|██████████████▋                                     | 2746/9741 [00:06<00:15, 456.76it/s] 29%|██████████████▉                                     | 2792/9741 [00:06<00:15, 457.33it/s] 29%|███████████████▏                                    | 2838/9741 [00:06<00:15, 458.08it/s] 30%|███████████████▍                                    | 2884/9741 [00:06<00:14, 458.24it/s] 30%|███████████████▋                                    | 2930/9741 [00:07<00:15, 452.30it/s] 31%|███████████████▉                                    | 2976/9741 [00:07<00:14, 454.37it/s] 31%|████████████████▏                                   | 3023/9741 [00:07<00:14, 456.09it/s] 32%|████████████████▍                                   | 3069/9741 [00:07<00:14, 456.28it/s] 32%|████████████████▋                                   | 3116/9741 [00:07<00:14, 457.46it/s] 32%|████████████████▉                                   | 3162/9741 [00:07<00:14, 455.56it/s] 33%|█████████████████▏                                  | 3209/9741 [00:07<00:14, 457.07it/s] 33%|█████████████████▍                                  | 3256/9741 [00:07<00:14, 458.00it/s] 34%|█████████████████▋                                  | 3302/9741 [00:07<00:14, 458.11it/s] 34%|█████████████████▊                                  | 3348/9741 [00:07<00:13, 458.02it/s] 35%|██████████████████                                  | 3394/9741 [00:08<00:13, 455.72it/s] 35%|██████████████████▎                                 | 3440/9741 [00:08<00:13, 456.68it/s] 36%|██████████████████▌                                 | 3486/9741 [00:08<00:13, 453.41it/s] 36%|██████████████████▊                                 | 3532/9741 [00:08<00:13, 454.53it/s] 37%|███████████████████                                 | 3578/9741 [00:08<00:13, 455.69it/s] 37%|███████████████████▎                                | 3624/9741 [00:08<00:13, 454.33it/s] 38%|███████████████████▌                                | 3670/9741 [00:08<00:13, 455.50it/s] 38%|███████████████████▊                                | 3716/9741 [00:08<00:13, 456.05it/s] 39%|████████████████████                                | 3762/9741 [00:08<00:13, 457.04it/s] 39%|████████████████████▎                               | 3808/9741 [00:08<00:12, 457.79it/s] 40%|████████████████████▌                               | 3854/9741 [00:09<00:12, 456.14it/s] 40%|████████████████████▊                               | 3900/9741 [00:09<00:12, 457.02it/s] 41%|█████████████████████                               | 3946/9741 [00:09<00:12, 457.34it/s] 41%|█████████████████████▎                              | 3992/9741 [00:09<00:12, 457.58it/s] 41%|█████████████████████▌                              | 4038/9741 [00:09<00:12, 458.27it/s] 42%|█████████████████████▊                              | 4084/9741 [00:09<00:12, 452.10it/s] 42%|██████████████████████                              | 4130/9741 [00:09<00:12, 453.86it/s] 43%|██████████████████████▎                             | 4176/9741 [00:09<00:12, 455.33it/s] 43%|██████████████████████▌                             | 4222/9741 [00:09<00:12, 455.97it/s] 44%|██████████████████████▊                             | 4269/9741 [00:09<00:11, 457.36it/s] 44%|███████████████████████                             | 4315/9741 [00:10<00:12, 450.76it/s] 45%|███████████████████████▎                            | 4361/9741 [00:10<00:11, 452.68it/s] 45%|███████████████████████▌                            | 4407/9741 [00:10<00:11, 454.22it/s] 46%|███████████████████████▊                            | 4453/9741 [00:10<00:11, 455.30it/s] 46%|████████████████████████                            | 4500/9741 [00:10<00:11, 456.83it/s] 47%|████████████████████████▎                           | 4546/9741 [00:10<00:12, 413.16it/s] 47%|████████████████████████▌                           | 4592/9741 [00:10<00:12, 425.92it/s] 48%|████████████████████████▊                           | 4638/9741 [00:10<00:11, 435.52it/s] 48%|█████████████████████████                           | 4685/9741 [00:10<00:11, 442.74it/s] 49%|█████████████████████████▏                          | 4730/9741 [00:11<00:11, 444.66it/s] 49%|█████████████████████████▍                          | 4775/9741 [00:11<00:15, 324.73it/s] 49%|█████████████████████████▋                          | 4821/9741 [00:11<00:13, 355.95it/s] 50%|█████████████████████████▉                          | 4867/9741 [00:11<00:12, 381.25it/s] 50%|██████████████████████████▏                         | 4913/9741 [00:11<00:12, 401.60it/s] 51%|██████████████████████████▍                         | 4959/9741 [00:11<00:11, 415.76it/s] 51%|██████████████████████████▋                         | 5005/9741 [00:11<00:11, 428.10it/s] 52%|██████████████████████████▉                         | 5051/9741 [00:11<00:10, 436.88it/s] 52%|███████████████████████████▏                        | 5097/9741 [00:11<00:10, 443.25it/s] 53%|███████████████████████████▍                        | 5143/9741 [00:12<00:10, 447.90it/s] 53%|███████████████████████████▋                        | 5189/9741 [00:12<00:10, 449.00it/s] 54%|███████████████████████████▉                        | 5235/9741 [00:12<00:10, 448.01it/s] 54%|████████████████████████████▏                       | 5281/9741 [00:12<00:09, 450.69it/s] 55%|████████████████████████████▍                       | 5327/9741 [00:12<00:09, 453.22it/s] 55%|████████████████████████████▋                       | 5373/9741 [00:12<00:09, 454.81it/s] 56%|████████████████████████████▉                       | 5419/9741 [00:12<00:09, 453.46it/s] 56%|█████████████████████████████▏                      | 5465/9741 [00:12<00:09, 454.33it/s] 57%|█████████████████████████████▍                      | 5513/9741 [00:12<00:09, 459.51it/s] 57%|█████████████████████████████▋                      | 5561/9741 [00:12<00:09, 463.87it/s] 58%|█████████████████████████████▉                      | 5609/9741 [00:13<00:08, 466.19it/s] 58%|██████████████████████████████▏                     | 5656/9741 [00:13<00:08, 465.84it/s] 59%|██████████████████████████████▍                     | 5704/9741 [00:13<00:08, 468.50it/s] 59%|██████████████████████████████▋                     | 5752/9741 [00:13<00:08, 470.30it/s] 60%|██████████████████████████████▉                     | 5800/9741 [00:13<00:08, 470.90it/s] 60%|███████████████████████████████▏                    | 5848/9741 [00:13<00:08, 470.70it/s] 61%|███████████████████████████████▍                    | 5896/9741 [00:13<00:08, 468.68it/s] 61%|███████████████████████████████▋                    | 5944/9741 [00:13<00:08, 469.90it/s] 62%|███████████████████████████████▉                    | 5991/9741 [00:13<00:07, 469.09it/s] 62%|████████████████████████████████▏                   | 6039/9741 [00:13<00:07, 470.85it/s] 62%|████████████████████████████████▍                   | 6087/9741 [00:14<00:07, 469.82it/s] 63%|████████████████████████████████▊                   | 6135/9741 [00:14<00:07, 470.41it/s] 63%|█████████████████████████████████                   | 6183/9741 [00:14<00:07, 471.16it/s] 64%|█████████████████████████████████▎                  | 6231/9741 [00:14<00:07, 471.61it/s] 64%|█████████████████████████████████▌                  | 6279/9741 [00:14<00:07, 471.52it/s] 65%|█████████████████████████████████▊                  | 6327/9741 [00:14<00:07, 469.57it/s] 65%|██████████████████████████████████                  | 6375/9741 [00:14<00:07, 470.87it/s] 66%|██████████████████████████████████▎                 | 6423/9741 [00:14<00:07, 471.76it/s] 66%|██████████████████████████████████▌                 | 6471/9741 [00:14<00:06, 472.15it/s] 67%|██████████████████████████████████▊                 | 6519/9741 [00:14<00:06, 471.47it/s] 67%|███████████████████████████████████                 | 6567/9741 [00:15<00:06, 469.90it/s] 68%|███████████████████████████████████▎                | 6615/9741 [00:15<00:06, 470.38it/s] 68%|███████████████████████████████████▌                | 6663/9741 [00:15<00:06, 471.15it/s] 69%|███████████████████████████████████▊                | 6711/9741 [00:15<00:06, 471.71it/s] 69%|████████████████████████████████████                | 6759/9741 [00:15<00:06, 472.50it/s] 70%|████████████████████████████████████▎               | 6807/9741 [00:15<00:06, 470.11it/s] 70%|████████████████████████████████████▌               | 6855/9741 [00:15<00:06, 470.99it/s] 71%|████████████████████████████████████▊               | 6903/9741 [00:15<00:06, 472.01it/s] 71%|█████████████████████████████████████               | 6951/9741 [00:15<00:05, 472.44it/s] 72%|█████████████████████████████████████▎              | 6999/9741 [00:16<00:05, 470.11it/s] 72%|█████████████████████████████████████▌              | 7047/9741 [00:16<00:05, 471.17it/s] 73%|█████████████████████████████████████▊              | 7095/9741 [00:16<00:05, 471.78it/s] 73%|██████████████████████████████████████▏             | 7143/9741 [00:16<00:05, 472.40it/s] 74%|██████████████████████████████████████▍             | 7191/9741 [00:16<00:05, 472.70it/s] 74%|██████████████████████████████████████▋             | 7239/9741 [00:16<00:05, 470.87it/s] 75%|██████████████████████████████████████▉             | 7287/9741 [00:16<00:05, 471.12it/s] 75%|███████████████████████████████████████▏            | 7335/9741 [00:16<00:05, 471.55it/s] 76%|███████████████████████████████████████▍            | 7383/9741 [00:16<00:04, 472.47it/s] 76%|███████████████████████████████████████▋            | 7431/9741 [00:16<00:04, 472.43it/s] 77%|███████████████████████████████████████▉            | 7479/9741 [00:17<00:05, 444.49it/s] 77%|████████████████████████████████████████▏           | 7527/9741 [00:17<00:04, 452.78it/s] 78%|████████████████████████████████████████▍           | 7575/9741 [00:17<00:04, 459.16it/s] 78%|████████████████████████████████████████▋           | 7622/9741 [00:17<00:04, 462.12it/s] 79%|████████████████████████████████████████▉           | 7669/9741 [00:17<00:04, 462.62it/s] 79%|█████████████████████████████████████████▏          | 7717/9741 [00:17<00:04, 465.88it/s] 80%|█████████████████████████████████████████▍          | 7765/9741 [00:17<00:04, 468.36it/s] 80%|█████████████████████████████████████████▋          | 7813/9741 [00:17<00:04, 469.39it/s] 81%|█████████████████████████████████████████▉          | 7861/9741 [00:17<00:03, 470.12it/s] 81%|██████████████████████████████████████████▏         | 7909/9741 [00:17<00:03, 468.92it/s] 82%|██████████████████████████████████████████▍         | 7957/9741 [00:18<00:03, 469.57it/s] 82%|██████████████████████████████████████████▋         | 8005/9741 [00:18<00:03, 470.70it/s] 83%|██████████████████████████████████████████▉         | 8053/9741 [00:18<00:03, 471.14it/s] 83%|███████████████████████████████████████████▏        | 8101/9741 [00:18<00:03, 472.44it/s] 84%|███████████████████████████████████████████▌        | 8149/9741 [00:18<00:03, 471.22it/s] 84%|███████████████████████████████████████████▊        | 8197/9741 [00:18<00:03, 471.48it/s] 85%|████████████████████████████████████████████        | 8245/9741 [00:18<00:03, 472.14it/s] 85%|████████████████████████████████████████████▎       | 8293/9741 [00:18<00:03, 471.70it/s] 86%|████████████████████████████████████████████▌       | 8341/9741 [00:18<00:02, 472.28it/s] 86%|████████████████████████████████████████████▊       | 8389/9741 [00:18<00:02, 469.15it/s] 87%|█████████████████████████████████████████████       | 8437/9741 [00:19<00:02, 470.52it/s] 87%|█████████████████████████████████████████████▎      | 8485/9741 [00:19<00:02, 470.95it/s] 88%|█████████████████████████████████████████████▌      | 8533/9741 [00:19<00:02, 470.84it/s] 88%|█████████████████████████████████████████████▊      | 8581/9741 [00:19<00:02, 469.02it/s] 89%|██████████████████████████████████████████████      | 8629/9741 [00:19<00:02, 469.59it/s] 89%|██████████████████████████████████████████████▎     | 8677/9741 [00:19<00:02, 469.91it/s] 90%|██████████████████████████████████████████████▌     | 8725/9741 [00:19<00:02, 470.87it/s] 90%|██████████████████████████████████████████████▊     | 8773/9741 [00:19<00:02, 471.56it/s] 91%|███████████████████████████████████████████████     | 8821/9741 [00:19<00:01, 469.22it/s] 91%|███████████████████████████████████████████████▎    | 8869/9741 [00:19<00:01, 470.15it/s] 92%|███████████████████████████████████████████████▌    | 8917/9741 [00:20<00:01, 471.44it/s] 92%|███████████████████████████████████████████████▊    | 8965/9741 [00:20<00:01, 471.64it/s] 93%|████████████████████████████████████████████████    | 9013/9741 [00:20<00:01, 472.10it/s] 93%|████████████████████████████████████████████████▎   | 9061/9741 [00:20<00:01, 470.60it/s] 94%|████████████████████████████████████████████████▋   | 9109/9741 [00:20<00:01, 471.17it/s] 94%|████████████████████████████████████████████████▉   | 9157/9741 [00:20<00:01, 471.41it/s] 94%|█████████████████████████████████████████████████▏  | 9205/9741 [00:20<00:01, 471.52it/s] 95%|█████████████████████████████████████████████████▍  | 9253/9741 [00:20<00:01, 471.87it/s] 95%|█████████████████████████████████████████████████▋  | 9301/9741 [00:20<00:00, 469.87it/s] 96%|█████████████████████████████████████████████████▉  | 9349/9741 [00:21<00:00, 470.54it/s] 96%|██████████████████████████████████████████████████▏ | 9397/9741 [00:21<00:00, 471.18it/s] 97%|██████████████████████████████████████████████████▍ | 9445/9741 [00:21<00:00, 471.77it/s] 97%|██████████████████████████████████████████████████▋ | 9493/9741 [00:21<00:00, 469.59it/s] 98%|██████████████████████████████████████████████████▉ | 9541/9741 [00:21<00:00, 470.63it/s] 98%|███████████████████████████████████████████████████▏| 9589/9741 [00:21<00:00, 471.07it/s] 99%|███████████████████████████████████████████████████▍| 9637/9741 [00:21<00:00, 471.23it/s] 99%|███████████████████████████████████████████████████▋| 9685/9741 [00:21<00:00, 471.75it/s]100%|███████████████████████████████████████████████████▉| 9733/9741 [00:21<00:00, 469.67it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:21<00:00, 445.83it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.07s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.49s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.97s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.06s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.23s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.37s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.60s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.46s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.63s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.55s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]
[2023-08-21 15:00:11,275] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.94s/it]
[2023-08-21 15:00:25,541] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 15:00:25,542] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 15:00:25,542] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 15:00:25,542] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 15:00:25,542] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 15:00:25,542] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 15:00:25,542] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 15:00:25,542] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fe3a3d3bf40>
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fe37b8dcd90>
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 15:00:25,544] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 15:00:25,544] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 15:00:25,544] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 15:00:25,544] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 15:00:25,544] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 15:00:25,544] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 15:00:25,544] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.524294376373291 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o15-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.5052719116210938 seconds
Loading extension module utils...
Time to load utils op: 0.5046749114990234 seconds
Loading extension module utils...
Time to load utils op: 0.50472092628479 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:43<35:37, 43.62s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:26<34:29, 43.12s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:46<25:38, 32.73s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:30<28:21, 37.00s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:14<29:38, 39.51s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:56<29:45, 40.57s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:40<29:47, 41.58s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:23<29:25, 42.04s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:06<28:58, 42.40s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:49<28:24, 42.61s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:33<27:55, 42.97s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:17<27:23, 43.24s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:00<26:42, 43.31s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:44<26:06, 43.50s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:28<25:25, 43.58s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:11<24:38, 43.48s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:56<24:02, 43.72s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:39<23:19, 43.72s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:19<21:54, 42.40s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:02<21:22, 42.74s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:46<20:46, 42.99s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:30<20:10, 43.23s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:13<19:25, 43.15s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [16:56<18:45, 43.28s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:40<18:03, 43.33s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:23<17:21, 43.39s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [18:37<13:16, 34.62s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [19:21<13:41, 37.32s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:04<13:42, 39.16s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [20:48<13:29, 40.48s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [21:32<13:07, 41.43s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [22:16<12:39, 42.21s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [22:40<10:26, 36.86s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:23<10:21, 38.83s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [24:07<10:04, 40.27s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [24:51<09:37, 41.23s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [25:34<09:05, 41.97s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [26:09<07:56, 39.70s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [26:52<07:29, 40.87s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [27:36<06:58, 41.82s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [28:20<06:22, 42.47s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [29:04<05:41, 42.73s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [29:31<04:27, 38.25s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [30:15<03:59, 39.95s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [30:59<03:25, 41.08s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [31:43<02:47, 41.88s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [32:26<02:07, 42.38s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [33:10<01:25, 42.77s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [33:53<00:42, 42.98s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:37<00:00, 43.05s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:37<00:00, 41.54s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.9045} | lm_loss 8.1555 | avg. gen lenth: 295.532
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o16-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 16
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 15:36:36,589] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o16-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 16
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o16-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 29/9741 [00:00<00:34, 283.91it/s]  1%|▎                                                     | 58/9741 [00:00<00:33, 284.92it/s]  1%|▍                                                     | 87/9741 [00:00<00:33, 285.26it/s]  1%|▋                                                    | 116/9741 [00:00<00:33, 286.01it/s]  1%|▊                                                    | 145/9741 [00:00<00:33, 286.02it/s]  2%|▉                                                    | 174/9741 [00:00<00:33, 286.24it/s]  2%|█                                                    | 203/9741 [00:00<00:34, 279.09it/s]  2%|█▎                                                   | 232/9741 [00:00<00:33, 280.86it/s]  3%|█▍                                                   | 261/9741 [00:00<00:33, 282.32it/s]  3%|█▌                                                   | 290/9741 [00:01<00:33, 282.91it/s]  3%|█▋                                                   | 319/9741 [00:01<00:33, 278.49it/s]  4%|█▉                                                   | 348/9741 [00:01<00:33, 280.68it/s]  4%|██                                                   | 377/9741 [00:01<00:33, 282.37it/s]  4%|██▏                                                  | 406/9741 [00:01<00:32, 283.37it/s]  4%|██▎                                                  | 435/9741 [00:01<00:32, 282.35it/s]  5%|██▌                                                  | 464/9741 [00:01<00:32, 283.47it/s]  5%|██▋                                                  | 493/9741 [00:01<00:32, 280.50it/s]  5%|██▊                                                  | 522/9741 [00:01<00:32, 281.87it/s]  6%|██▉                                                  | 551/9741 [00:01<00:32, 283.07it/s]  6%|███▏                                                 | 580/9741 [00:02<00:32, 283.38it/s]  6%|███▎                                                 | 609/9741 [00:02<00:32, 283.76it/s]  7%|███▍                                                 | 638/9741 [00:02<00:32, 284.08it/s]  7%|███▋                                                 | 667/9741 [00:02<00:32, 282.50it/s]  7%|███▊                                                 | 696/9741 [00:02<00:31, 283.33it/s]  8%|████                                                 | 736/9741 [00:02<00:28, 316.24it/s]  8%|████▏                                                | 780/9741 [00:02<00:25, 351.22it/s]  8%|████▍                                                | 824/9741 [00:02<00:23, 376.11it/s]  9%|████▋                                                | 868/9741 [00:02<00:22, 393.37it/s]  9%|████▉                                                | 911/9741 [00:02<00:21, 402.89it/s] 10%|█████▏                                               | 955/9741 [00:03<00:21, 411.61it/s] 10%|█████▍                                               | 999/9741 [00:03<00:20, 418.03it/s] 11%|█████▌                                              | 1043/9741 [00:03<00:20, 422.81it/s] 11%|█████▊                                              | 1087/9741 [00:03<00:20, 426.29it/s] 12%|██████                                              | 1130/9741 [00:03<00:20, 425.78it/s] 12%|██████▎                                             | 1174/9741 [00:03<00:20, 427.47it/s] 13%|██████▌                                             | 1218/9741 [00:03<00:19, 428.47it/s] 13%|██████▋                                             | 1262/9741 [00:03<00:19, 429.53it/s] 13%|██████▉                                             | 1306/9741 [00:03<00:19, 430.26it/s] 14%|███████▏                                            | 1350/9741 [00:03<00:19, 428.39it/s] 14%|███████▍                                            | 1393/9741 [00:04<00:19, 426.83it/s] 15%|███████▋                                            | 1437/9741 [00:04<00:19, 428.55it/s] 15%|███████▉                                            | 1480/9741 [00:04<00:19, 428.38it/s] 16%|████████▏                                           | 1523/9741 [00:04<00:19, 428.24it/s] 16%|████████▎                                           | 1566/9741 [00:04<00:19, 427.04it/s] 17%|████████▌                                           | 1610/9741 [00:04<00:18, 428.33it/s] 17%|████████▊                                           | 1654/9741 [00:04<00:18, 429.97it/s] 17%|█████████                                           | 1697/9741 [00:04<00:18, 429.62it/s] 18%|█████████▎                                          | 1741/9741 [00:04<00:18, 430.17it/s] 18%|█████████▌                                          | 1785/9741 [00:05<00:18, 430.64it/s] 19%|█████████▊                                          | 1829/9741 [00:05<00:19, 408.16it/s] 19%|█████████▉                                          | 1872/9741 [00:05<00:18, 414.20it/s] 20%|██████████▏                                         | 1915/9741 [00:05<00:18, 416.05it/s] 20%|██████████▍                                         | 1959/9741 [00:05<00:18, 420.29it/s] 21%|██████████▋                                         | 2003/9741 [00:05<00:18, 423.56it/s] 21%|██████████▉                                         | 2046/9741 [00:05<00:18, 418.93it/s] 21%|███████████▏                                        | 2089/9741 [00:05<00:18, 421.24it/s] 22%|███████████▍                                        | 2132/9741 [00:05<00:18, 420.67it/s] 22%|███████████▌                                        | 2176/9741 [00:05<00:17, 423.82it/s] 23%|███████████▊                                        | 2220/9741 [00:06<00:17, 425.79it/s] 23%|████████████                                        | 2263/9741 [00:06<00:17, 424.71it/s] 24%|████████████▎                                       | 2307/9741 [00:06<00:17, 426.94it/s] 24%|████████████▌                                       | 2351/9741 [00:06<00:17, 428.20it/s] 25%|████████████▊                                       | 2394/9741 [00:06<00:17, 428.66it/s] 25%|█████████████                                       | 2437/9741 [00:06<00:17, 428.95it/s] 25%|█████████████▏                                      | 2480/9741 [00:06<00:16, 427.19it/s] 26%|█████████████▍                                      | 2523/9741 [00:06<00:16, 427.54it/s] 26%|█████████████▋                                      | 2566/9741 [00:06<00:16, 428.15it/s] 27%|█████████████▉                                      | 2609/9741 [00:06<00:16, 424.24it/s] 27%|██████████████▏                                     | 2653/9741 [00:07<00:16, 426.13it/s] 28%|██████████████▍                                     | 2697/9741 [00:07<00:16, 424.14it/s] 28%|██████████████▋                                     | 2740/9741 [00:07<00:16, 425.78it/s] 29%|██████████████▊                                     | 2783/9741 [00:07<00:16, 426.37it/s] 29%|███████████████                                     | 2826/9741 [00:07<00:16, 427.08it/s] 29%|███████████████▎                                    | 2870/9741 [00:07<00:16, 428.51it/s] 30%|███████████████▌                                    | 2914/9741 [00:07<00:15, 429.44it/s] 30%|███████████████▊                                    | 2957/9741 [00:07<00:15, 426.01it/s] 31%|████████████████                                    | 3001/9741 [00:07<00:15, 427.32it/s] 31%|████████████████▎                                   | 3045/9741 [00:07<00:15, 428.78it/s] 32%|████████████████▍                                   | 3089/9741 [00:08<00:15, 429.41it/s] 32%|████████████████▋                                   | 3132/9741 [00:08<00:15, 426.86it/s] 33%|████████████████▉                                   | 3175/9741 [00:08<00:15, 424.68it/s] 33%|█████████████████▏                                  | 3219/9741 [00:08<00:15, 426.54it/s] 33%|█████████████████▍                                  | 3263/9741 [00:08<00:15, 428.46it/s] 34%|█████████████████▋                                  | 3306/9741 [00:08<00:15, 428.37it/s] 34%|█████████████████▉                                  | 3349/9741 [00:08<00:14, 428.57it/s] 35%|██████████████████                                  | 3392/9741 [00:08<00:14, 426.34it/s] 35%|██████████████████▎                                 | 3436/9741 [00:08<00:14, 428.22it/s] 36%|██████████████████▌                                 | 3479/9741 [00:08<00:14, 428.34it/s] 36%|██████████████████▊                                 | 3522/9741 [00:09<00:14, 428.01it/s] 37%|███████████████████                                 | 3566/9741 [00:09<00:14, 428.84it/s] 37%|███████████████████▎                                | 3609/9741 [00:09<00:14, 427.38it/s] 38%|███████████████████▌                                | 3653/9741 [00:09<00:14, 428.66it/s] 38%|███████████████████▋                                | 3696/9741 [00:09<00:14, 428.11it/s] 38%|███████████████████▉                                | 3740/9741 [00:09<00:13, 429.17it/s] 39%|████████████████████▏                               | 3784/9741 [00:09<00:13, 429.58it/s] 39%|████████████████████▍                               | 3827/9741 [00:09<00:13, 429.64it/s] 40%|████████████████████▋                               | 3870/9741 [00:09<00:13, 426.51it/s] 40%|████████████████████▉                               | 3913/9741 [00:10<00:13, 426.27it/s] 41%|█████████████████████                               | 3956/9741 [00:10<00:13, 427.28it/s] 41%|█████████████████████▎                              | 4000/9741 [00:10<00:13, 428.57it/s] 42%|█████████████████████▌                              | 4043/9741 [00:10<00:13, 428.53it/s] 42%|█████████████████████▊                              | 4086/9741 [00:10<00:13, 426.28it/s] 42%|██████████████████████                              | 4130/9741 [00:10<00:13, 427.48it/s] 43%|██████████████████████▎                             | 4173/9741 [00:10<00:13, 427.62it/s] 43%|██████████████████████▌                             | 4216/9741 [00:10<00:12, 426.57it/s] 44%|██████████████████████▋                             | 4260/9741 [00:10<00:12, 427.63it/s] 44%|██████████████████████▉                             | 4303/9741 [00:10<00:12, 426.14it/s] 45%|███████████████████████▏                            | 4347/9741 [00:11<00:12, 427.49it/s] 45%|███████████████████████▍                            | 4390/9741 [00:11<00:12, 427.39it/s] 46%|███████████████████████▋                            | 4433/9741 [00:11<00:12, 427.75it/s] 46%|███████████████████████▉                            | 4476/9741 [00:11<00:12, 428.11it/s] 46%|████████████████████████                            | 4519/9741 [00:11<00:13, 394.78it/s] 47%|████████████████████████▎                           | 4562/9741 [00:11<00:12, 403.95it/s] 47%|████████████████████████▌                           | 4605/9741 [00:11<00:12, 411.06it/s] 48%|████████████████████████▊                           | 4649/9741 [00:11<00:12, 416.70it/s] 48%|█████████████████████████                           | 4693/9741 [00:11<00:11, 421.04it/s] 49%|█████████████████████████▎                          | 4736/9741 [00:11<00:11, 423.31it/s] 49%|█████████████████████████▌                          | 4779/9741 [00:12<00:16, 295.08it/s] 50%|█████████████████████████▋                          | 4822/9741 [00:12<00:15, 325.43it/s] 50%|█████████████████████████▉                          | 4865/9741 [00:12<00:13, 350.50it/s] 50%|██████████████████████████▏                         | 4908/9741 [00:12<00:13, 370.40it/s] 51%|██████████████████████████▍                         | 4951/9741 [00:12<00:12, 384.38it/s] 51%|██████████████████████████▋                         | 4995/9741 [00:12<00:11, 397.18it/s] 52%|██████████████████████████▉                         | 5038/9741 [00:12<00:11, 405.29it/s] 52%|███████████████████████████                         | 5081/9741 [00:12<00:11, 411.80it/s] 53%|███████████████████████████▎                        | 5124/9741 [00:13<00:11, 416.67it/s] 53%|███████████████████████████▌                        | 5167/9741 [00:13<00:10, 420.10it/s] 53%|███████████████████████████▊                        | 5210/9741 [00:13<00:10, 419.81it/s] 54%|████████████████████████████                        | 5253/9741 [00:13<00:10, 419.79it/s] 54%|████████████████████████████▎                       | 5296/9741 [00:13<00:10, 421.97it/s] 55%|████████████████████████████▌                       | 5339/9741 [00:13<00:10, 422.92it/s] 55%|████████████████████████████▋                       | 5382/9741 [00:13<00:10, 421.43it/s] 56%|████████████████████████████▉                       | 5425/9741 [00:13<00:10, 419.52it/s] 56%|█████████████████████████████▏                      | 5469/9741 [00:13<00:10, 422.66it/s] 57%|█████████████████████████████▍                      | 5514/9741 [00:13<00:09, 428.64it/s] 57%|█████████████████████████████▋                      | 5559/9741 [00:14<00:09, 432.91it/s] 58%|█████████████████████████████▉                      | 5604/9741 [00:14<00:09, 435.97it/s] 58%|██████████████████████████████▏                     | 5648/9741 [00:14<00:09, 435.45it/s] 58%|██████████████████████████████▍                     | 5693/9741 [00:14<00:09, 437.31it/s] 59%|██████████████████████████████▋                     | 5738/9741 [00:14<00:09, 439.07it/s] 59%|██████████████████████████████▊                     | 5783/9741 [00:14<00:08, 440.59it/s] 60%|███████████████████████████████                     | 5828/9741 [00:14<00:08, 441.59it/s] 60%|███████████████████████████████▎                    | 5873/9741 [00:14<00:08, 440.10it/s] 61%|███████████████████████████████▌                    | 5918/9741 [00:14<00:08, 440.75it/s] 61%|███████████████████████████████▊                    | 5963/9741 [00:14<00:08, 441.66it/s] 62%|████████████████████████████████                    | 6008/9741 [00:15<00:08, 440.94it/s] 62%|████████████████████████████████▎                   | 6053/9741 [00:15<00:08, 441.47it/s] 63%|████████████████████████████████▌                   | 6098/9741 [00:15<00:08, 438.78it/s] 63%|████████████████████████████████▊                   | 6143/9741 [00:15<00:08, 440.24it/s] 64%|█████████████████████████████████                   | 6188/9741 [00:15<00:08, 441.66it/s] 64%|█████████████████████████████████▎                  | 6233/9741 [00:15<00:07, 441.94it/s] 64%|█████████████████████████████████▌                  | 6278/9741 [00:15<00:07, 440.95it/s] 65%|█████████████████████████████████▊                  | 6323/9741 [00:15<00:07, 439.50it/s] 65%|█████████████████████████████████▉                  | 6368/9741 [00:15<00:07, 441.22it/s] 66%|██████████████████████████████████▏                 | 6413/9741 [00:15<00:07, 438.37it/s] 66%|██████████████████████████████████▍                 | 6457/9741 [00:16<00:07, 428.55it/s] 67%|██████████████████████████████████▋                 | 6500/9741 [00:16<00:07, 417.71it/s] 67%|██████████████████████████████████▉                 | 6544/9741 [00:16<00:07, 421.83it/s] 68%|███████████████████████████████████▏                | 6588/9741 [00:16<00:07, 425.78it/s] 68%|███████████████████████████████████▍                | 6633/9741 [00:16<00:07, 430.47it/s] 69%|███████████████████████████████████▋                | 6677/9741 [00:16<00:07, 424.74it/s] 69%|███████████████████████████████████▊                | 6720/9741 [00:16<00:07, 419.52it/s] 69%|████████████████████████████████████                | 6764/9741 [00:16<00:07, 424.40it/s] 70%|████████████████████████████████████▎               | 6809/9741 [00:16<00:06, 429.92it/s] 70%|████████████████████████████████████▌               | 6853/9741 [00:17<00:06, 430.06it/s] 71%|████████████████████████████████████▊               | 6897/9741 [00:17<00:06, 418.26it/s] 71%|█████████████████████████████████████               | 6939/9741 [00:17<00:06, 416.15it/s] 72%|█████████████████████████████████████▎              | 6983/9741 [00:17<00:06, 421.09it/s] 72%|█████████████████████████████████████▌              | 7026/9741 [00:17<00:06, 412.93it/s] 73%|█████████████████████████████████████▋              | 7070/9741 [00:17<00:06, 418.28it/s] 73%|█████████████████████████████████████▉              | 7115/9741 [00:17<00:06, 425.93it/s] 74%|██████████████████████████████████████▏             | 7160/9741 [00:17<00:05, 431.28it/s] 74%|██████████████████████████████████████▍             | 7205/9741 [00:17<00:05, 434.77it/s] 74%|██████████████████████████████████████▋             | 7249/9741 [00:17<00:05, 435.53it/s] 75%|██████████████████████████████████████▉             | 7294/9741 [00:18<00:05, 438.52it/s] 75%|███████████████████████████████████████▏            | 7339/9741 [00:18<00:05, 439.98it/s] 76%|███████████████████████████████████████▍            | 7384/9741 [00:18<00:05, 441.37it/s] 76%|███████████████████████████████████████▋            | 7429/9741 [00:18<00:05, 442.58it/s] 77%|███████████████████████████████████████▉            | 7474/9741 [00:18<00:05, 409.64it/s] 77%|████████████████████████████████████████▏           | 7519/9741 [00:18<00:05, 419.13it/s] 78%|████████████████████████████████████████▎           | 7562/9741 [00:18<00:05, 413.76it/s] 78%|████████████████████████████████████████▌           | 7604/9741 [00:18<00:05, 402.38it/s] 79%|████████████████████████████████████████▊           | 7648/9741 [00:18<00:05, 411.81it/s] 79%|█████████████████████████████████████████           | 7690/9741 [00:19<00:05, 403.70it/s] 79%|█████████████████████████████████████████▎          | 7734/9741 [00:19<00:04, 412.74it/s] 80%|█████████████████████████████████████████▌          | 7779/9741 [00:19<00:04, 421.48it/s] 80%|█████████████████████████████████████████▊          | 7824/9741 [00:19<00:04, 428.17it/s] 81%|██████████████████████████████████████████          | 7869/9741 [00:19<00:04, 432.62it/s] 81%|██████████████████████████████████████████▏         | 7913/9741 [00:19<00:04, 434.04it/s] 82%|██████████████████████████████████████████▍         | 7958/9741 [00:19<00:04, 437.97it/s] 82%|██████████████████████████████████████████▋         | 8003/9741 [00:19<00:03, 440.90it/s] 83%|██████████████████████████████████████████▉         | 8048/9741 [00:19<00:03, 441.97it/s] 83%|███████████████████████████████████████████▏        | 8093/9741 [00:19<00:03, 442.61it/s] 84%|███████████████████████████████████████████▍        | 8138/9741 [00:20<00:03, 440.34it/s] 84%|███████████████████████████████████████████▋        | 8183/9741 [00:20<00:03, 435.62it/s] 84%|███████████████████████████████████████████▉        | 8228/9741 [00:20<00:03, 437.81it/s] 85%|████████████████████████████████████████████▏       | 8273/9741 [00:20<00:03, 439.67it/s] 85%|████████████████████████████████████████████▍       | 8318/9741 [00:20<00:03, 441.32it/s] 86%|████████████████████████████████████████████▋       | 8363/9741 [00:20<00:03, 440.53it/s] 86%|████████████████████████████████████████████▉       | 8408/9741 [00:20<00:03, 441.41it/s] 87%|█████████████████████████████████████████████       | 8453/9741 [00:20<00:02, 442.65it/s] 87%|█████████████████████████████████████████████▎      | 8498/9741 [00:20<00:02, 442.86it/s] 88%|█████████████████████████████████████████████▌      | 8543/9741 [00:20<00:02, 443.04it/s] 88%|█████████████████████████████████████████████▊      | 8588/9741 [00:21<00:02, 440.61it/s] 89%|██████████████████████████████████████████████      | 8633/9741 [00:21<00:02, 441.21it/s] 89%|██████████████████████████████████████████████▎     | 8678/9741 [00:21<00:02, 438.61it/s] 90%|██████████████████████████████████████████████▌     | 8722/9741 [00:21<00:02, 437.60it/s] 90%|██████████████████████████████████████████████▊     | 8767/9741 [00:21<00:02, 438.53it/s] 90%|███████████████████████████████████████████████     | 8811/9741 [00:21<00:02, 437.93it/s] 91%|███████████████████████████████████████████████▎    | 8856/9741 [00:21<00:02, 439.87it/s] 91%|███████████████████████████████████████████████▌    | 8900/9741 [00:21<00:01, 437.54it/s] 92%|███████████████████████████████████████████████▊    | 8945/9741 [00:21<00:01, 438.83it/s] 92%|███████████████████████████████████████████████▉    | 8990/9741 [00:21<00:01, 440.23it/s] 93%|████████████████████████████████████████████████▏   | 9035/9741 [00:22<00:01, 438.45it/s] 93%|████████████████████████████████████████████████▍   | 9080/9741 [00:22<00:01, 440.35it/s] 94%|████████████████████████████████████████████████▋   | 9125/9741 [00:22<00:01, 441.26it/s] 94%|████████████████████████████████████████████████▉   | 9170/9741 [00:22<00:01, 439.31it/s] 95%|█████████████████████████████████████████████████▏  | 9215/9741 [00:22<00:01, 440.85it/s] 95%|█████████████████████████████████████████████████▍  | 9260/9741 [00:22<00:01, 438.97it/s] 96%|█████████████████████████████████████████████████▋  | 9305/9741 [00:22<00:00, 440.19it/s] 96%|█████████████████████████████████████████████████▉  | 9350/9741 [00:22<00:00, 440.72it/s] 96%|██████████████████████████████████████████████████▏ | 9395/9741 [00:22<00:00, 441.23it/s] 97%|██████████████████████████████████████████████████▍ | 9440/9741 [00:22<00:00, 442.18it/s] 97%|██████████████████████████████████████████████████▋ | 9485/9741 [00:23<00:00, 440.45it/s] 98%|██████████████████████████████████████████████████▊ | 9530/9741 [00:23<00:00, 441.76it/s] 98%|███████████████████████████████████████████████████ | 9575/9741 [00:23<00:00, 442.57it/s] 99%|███████████████████████████████████████████████████▎| 9620/9741 [00:23<00:00, 442.68it/s] 99%|███████████████████████████████████████████████████▌| 9665/9741 [00:23<00:00, 435.23it/s]100%|███████████████████████████████████████████████████▊| 9709/9741 [00:23<00:00, 432.73it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:23<00:00, 411.65it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.22s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.37s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.66s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.87s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.23s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.56s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.27s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]
[2023-08-21 15:37:51,343] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.88s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.08s/it]
[2023-08-21 15:38:02,572] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 15:38:02,573] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 15:38:02,574] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 15:38:02,574] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 15:38:02,574] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 15:38:02,574] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f23bb677f40>
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f238f0bfdc0>
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 15:38:02,576] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.48862218856811523 seconds
2048
Loading extension module utils...
Time to load utils op: 0.4047822952270508 seconds
Loading extension module utils...
Time to load utils op: 0.4048459529876709 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

2048
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]2048
############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input: Tonya has $150.00 on her credit card.  If she leaves any balance on her card at the end of the month, she is charged 20% interest.  If she makes a $50.00 payment on her card, what will be the new balance?
Output: 120

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o16-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.5049498081207275 seconds
2048
2048
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:43<35:32, 43.51s/it]2048
2048
2048
Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:19<31:05, 38.87s/it]2048
2048
2048
2048
Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:02<31:53, 40.71s/it]2048
2048
2048
2048
Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:45<31:59, 41.73s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  10%|███                            | 5/50 [03:28<31:37, 42.17s/it]2048
2048
2048
2048
2048
2048
Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:10<31:01, 42.30s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:54<30:33, 42.64s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:36<29:53, 42.70s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:19<29:11, 42.71s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:02<28:24, 42.62s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:44<27:44, 42.67s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:27<27:01, 42.68s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:10<26:24, 42.83s/it]2048
2048
2048
2048
2048
Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:53<25:42, 42.84s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:36<25:00, 42.86s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:19<24:18, 42.90s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:02<23:39, 43.02s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:45<22:56, 43.02s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:29<22:20, 43.24s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:12<21:33, 43.10s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:54<20:43, 42.89s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:37<19:57, 42.78s/it]2048
2048
2048
Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:55<15:56, 35.41s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [16:38<16:17, 37.61s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:21<16:22, 39.29s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:04<16:10, 40.45s/it]2048
2048
2048
2048
2048
Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [18:48<15:51, 41.38s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [19:31<15:19, 41.81s/it]2048
2048
2048
Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:09<14:18, 40.87s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [20:52<13:48, 41.41s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [21:35<13:14, 41.84s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [22:18<12:39, 42.20s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [23:01<12:00, 42.41s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:44<11:20, 42.54s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [24:26<10:38, 42.57s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [25:09<09:56, 42.62s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [25:52<09:15, 42.74s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [26:35<08:34, 42.88s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [27:18<07:52, 43.00s/it]2048
2048
2048
2048
2048
Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [28:02<07:11, 43.11s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [28:45<06:27, 43.07s/it]2048
Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [29:10<05:01, 37.66s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [29:52<04:34, 39.16s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [30:35<04:01, 40.20s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [31:18<03:24, 40.96s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [32:01<02:46, 41.59s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [32:43<02:05, 41.87s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [33:27<01:24, 42.31s/it]2048
2048
2048
2048
2048
Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [34:10<00:42, 42.59s/it]2048
2048
2048
Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:53<00:00, 42.79s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:53<00:00, 41.87s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.8092} | lm_loss 8.1901 | avg. gen lenth: 302.244
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o17-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 17
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[2023-08-21 16:13:10,187] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o17-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 17
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o17-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 26/9741 [00:00<00:37, 258.49it/s]  1%|▎                                                     | 52/9741 [00:00<00:37, 259.09it/s]  1%|▍                                                     | 79/9741 [00:00<00:37, 259.78it/s]  1%|▌                                                    | 106/9741 [00:00<00:37, 260.33it/s]  1%|▋                                                    | 133/9741 [00:00<00:36, 260.29it/s]  2%|▊                                                    | 160/9741 [00:00<00:36, 260.71it/s]  2%|█                                                    | 187/9741 [00:00<00:36, 260.13it/s]  2%|█▏                                                   | 214/9741 [00:00<00:37, 254.64it/s]  2%|█▎                                                   | 240/9741 [00:00<00:37, 256.11it/s]  3%|█▍                                                   | 266/9741 [00:01<00:36, 257.09it/s]  3%|█▌                                                   | 292/9741 [00:01<00:36, 257.88it/s]  3%|█▋                                                   | 318/9741 [00:01<00:36, 258.48it/s]  4%|█▊                                                   | 344/9741 [00:01<00:36, 258.90it/s]  4%|██                                                   | 370/9741 [00:01<00:36, 258.91it/s]  4%|██▏                                                  | 397/9741 [00:01<00:36, 259.33it/s]  4%|██▎                                                  | 423/9741 [00:01<00:35, 259.33it/s]  5%|██▍                                                  | 449/9741 [00:01<00:36, 258.01it/s]  5%|██▌                                                  | 475/9741 [00:01<00:36, 255.95it/s]  5%|██▋                                                  | 501/9741 [00:01<00:35, 256.90it/s]  5%|██▊                                                  | 527/9741 [00:02<00:35, 257.69it/s]  6%|███                                                  | 553/9741 [00:02<00:35, 258.28it/s]  6%|███▏                                                 | 579/9741 [00:02<00:35, 258.60it/s]  6%|███▎                                                 | 605/9741 [00:02<00:35, 258.86it/s]  7%|███▍                                                 | 642/9741 [00:02<00:31, 291.47it/s]  7%|███▋                                                 | 681/9741 [00:02<00:28, 319.96it/s]  7%|███▉                                                 | 721/9741 [00:02<00:26, 341.99it/s]  8%|████▏                                                | 761/9741 [00:02<00:25, 357.15it/s]  8%|████▎                                                | 801/9741 [00:02<00:24, 368.08it/s]  9%|████▌                                                | 841/9741 [00:02<00:23, 375.74it/s]  9%|████▊                                                | 881/9741 [00:03<00:23, 378.99it/s]  9%|█████                                                | 921/9741 [00:03<00:23, 382.84it/s] 10%|█████▏                                               | 961/9741 [00:03<00:22, 385.78it/s] 10%|█████▎                                              | 1001/9741 [00:03<00:22, 387.86it/s] 11%|█████▌                                              | 1041/9741 [00:03<00:22, 389.72it/s] 11%|█████▊                                              | 1081/9741 [00:03<00:22, 390.51it/s] 12%|█████▉                                              | 1121/9741 [00:03<00:22, 388.94it/s] 12%|██████▏                                             | 1161/9741 [00:03<00:22, 389.94it/s] 12%|██████▍                                             | 1201/9741 [00:03<00:21, 390.56it/s] 13%|██████▌                                             | 1241/9741 [00:03<00:21, 390.59it/s] 13%|██████▊                                             | 1281/9741 [00:04<00:21, 391.12it/s] 14%|███████                                             | 1321/9741 [00:04<00:21, 391.15it/s] 14%|███████▎                                            | 1361/9741 [00:04<00:21, 389.23it/s] 14%|███████▍                                            | 1400/9741 [00:04<00:21, 389.27it/s] 15%|███████▋                                            | 1440/9741 [00:04<00:21, 389.65it/s] 15%|███████▉                                            | 1480/9741 [00:04<00:21, 390.43it/s] 16%|████████                                            | 1520/9741 [00:04<00:21, 390.73it/s] 16%|████████▎                                           | 1560/9741 [00:04<00:20, 391.42it/s] 16%|████████▌                                           | 1600/9741 [00:04<00:20, 388.65it/s] 17%|████████▊                                           | 1640/9741 [00:04<00:20, 389.67it/s] 17%|████████▉                                           | 1680/9741 [00:05<00:20, 390.76it/s] 18%|█████████▏                                          | 1720/9741 [00:05<00:20, 390.94it/s] 18%|█████████▍                                          | 1760/9741 [00:05<00:20, 391.20it/s] 18%|█████████▌                                          | 1800/9741 [00:05<00:21, 370.10it/s] 19%|█████████▊                                          | 1839/9741 [00:05<00:21, 375.73it/s] 19%|██████████                                          | 1879/9741 [00:05<00:20, 380.59it/s] 20%|██████████▏                                         | 1918/9741 [00:05<00:20, 382.06it/s] 20%|██████████▍                                         | 1958/9741 [00:05<00:20, 384.61it/s] 21%|██████████▋                                         | 1998/9741 [00:05<00:20, 386.44it/s] 21%|██████████▊                                         | 2037/9741 [00:06<00:19, 385.66it/s] 21%|███████████                                         | 2077/9741 [00:06<00:19, 387.06it/s] 22%|███████████▎                                        | 2116/9741 [00:06<00:19, 387.74it/s] 22%|███████████▌                                        | 2156/9741 [00:06<00:19, 388.54it/s] 23%|███████████▋                                        | 2196/9741 [00:06<00:19, 389.42it/s] 23%|███████████▉                                        | 2235/9741 [00:06<00:19, 389.27it/s] 23%|████████████▏                                       | 2274/9741 [00:06<00:19, 387.30it/s] 24%|████████████▎                                       | 2314/9741 [00:06<00:19, 388.43it/s] 24%|████████████▌                                       | 2354/9741 [00:06<00:18, 389.11it/s] 25%|████████████▊                                       | 2394/9741 [00:06<00:18, 389.78it/s] 25%|████████████▉                                       | 2433/9741 [00:07<00:18, 386.34it/s] 25%|█████████████▏                                      | 2472/9741 [00:07<00:18, 385.21it/s] 26%|█████████████▍                                      | 2512/9741 [00:07<00:18, 386.99it/s] 26%|█████████████▌                                      | 2551/9741 [00:07<00:18, 387.73it/s] 27%|█████████████▊                                      | 2591/9741 [00:07<00:18, 388.66it/s] 27%|██████████████                                      | 2631/9741 [00:07<00:18, 389.20it/s] 27%|██████████████▎                                     | 2671/9741 [00:07<00:18, 389.93it/s] 28%|██████████████▍                                     | 2710/9741 [00:07<00:18, 387.77it/s] 28%|██████████████▋                                     | 2749/9741 [00:07<00:18, 388.17it/s] 29%|██████████████▉                                     | 2788/9741 [00:07<00:17, 388.69it/s] 29%|███████████████                                     | 2828/9741 [00:08<00:17, 389.27it/s] 29%|███████████████▎                                    | 2868/9741 [00:08<00:17, 390.06it/s] 30%|███████████████▌                                    | 2908/9741 [00:08<00:17, 386.14it/s] 30%|███████████████▋                                    | 2947/9741 [00:08<00:17, 384.60it/s] 31%|███████████████▉                                    | 2987/9741 [00:08<00:17, 386.23it/s] 31%|████████████████▏                                   | 3027/9741 [00:08<00:17, 387.78it/s] 31%|████████████████▎                                   | 3066/9741 [00:08<00:17, 387.76it/s] 32%|████████████████▌                                   | 3105/9741 [00:08<00:17, 388.28it/s] 32%|████████████████▊                                   | 3144/9741 [00:08<00:16, 388.71it/s] 33%|████████████████▉                                   | 3183/9741 [00:08<00:16, 387.35it/s] 33%|█████████████████▏                                  | 3223/9741 [00:09<00:16, 388.22it/s] 33%|█████████████████▍                                  | 3263/9741 [00:09<00:16, 388.80it/s] 34%|█████████████████▋                                  | 3302/9741 [00:09<00:16, 388.94it/s] 34%|█████████████████▊                                  | 3342/9741 [00:09<00:16, 389.46it/s] 35%|██████████████████                                  | 3381/9741 [00:09<00:16, 387.19it/s] 35%|██████████████████▎                                 | 3420/9741 [00:09<00:16, 384.48it/s] 36%|██████████████████▍                                 | 3459/9741 [00:09<00:16, 385.64it/s] 36%|██████████████████▋                                 | 3498/9741 [00:09<00:16, 386.87it/s] 36%|██████████████████▉                                 | 3537/9741 [00:09<00:16, 387.34it/s] 37%|███████████████████                                 | 3576/9741 [00:10<00:15, 387.48it/s] 37%|███████████████████▎                                | 3615/9741 [00:10<00:15, 385.55it/s] 38%|███████████████████▌                                | 3655/9741 [00:10<00:15, 387.07it/s] 38%|███████████████████▋                                | 3695/9741 [00:10<00:15, 388.15it/s] 38%|███████████████████▉                                | 3735/9741 [00:10<00:15, 388.72it/s] 39%|████████████████████▏                               | 3775/9741 [00:10<00:15, 389.14it/s] 39%|████████████████████▎                               | 3815/9741 [00:10<00:15, 389.50it/s] 40%|████████████████████▌                               | 3854/9741 [00:10<00:15, 387.36it/s] 40%|████████████████████▊                               | 3893/9741 [00:10<00:15, 388.04it/s] 40%|████████████████████▉                               | 3932/9741 [00:10<00:14, 388.26it/s] 41%|█████████████████████▏                              | 3972/9741 [00:11<00:14, 388.86it/s] 41%|█████████████████████▍                              | 4012/9741 [00:11<00:14, 389.75it/s] 42%|█████████████████████▋                              | 4051/9741 [00:11<00:14, 389.62it/s] 42%|█████████████████████▊                              | 4090/9741 [00:11<00:14, 387.20it/s] 42%|██████████████████████                              | 4129/9741 [00:11<00:14, 387.85it/s] 43%|██████████████████████▏                             | 4168/9741 [00:11<00:14, 388.18it/s] 43%|██████████████████████▍                             | 4207/9741 [00:11<00:14, 388.41it/s] 44%|██████████████████████▋                             | 4246/9741 [00:11<00:14, 388.50it/s] 44%|██████████████████████▊                             | 4285/9741 [00:11<00:14, 386.50it/s] 44%|███████████████████████                             | 4325/9741 [00:11<00:13, 387.69it/s] 45%|███████████████████████▎                            | 4364/9741 [00:12<00:13, 388.32it/s] 45%|███████████████████████▌                            | 4403/9741 [00:12<00:13, 388.48it/s] 46%|███████████████████████▋                            | 4442/9741 [00:12<00:13, 386.16it/s] 46%|███████████████████████▉                            | 4481/9741 [00:12<00:13, 387.20it/s] 46%|████████████████████████▏                           | 4520/9741 [00:12<00:15, 347.08it/s] 47%|████████████████████████▎                           | 4559/9741 [00:12<00:14, 358.28it/s] 47%|████████████████████████▌                           | 4598/9741 [00:12<00:14, 366.92it/s] 48%|████████████████████████▊                           | 4637/9741 [00:12<00:13, 373.48it/s] 48%|████████████████████████▉                           | 4676/9741 [00:12<00:13, 378.16it/s] 48%|█████████████████████████▏                          | 4716/9741 [00:12<00:13, 381.80it/s] 49%|█████████████████████████▍                          | 4755/9741 [00:13<00:17, 287.39it/s] 49%|█████████████████████████▌                          | 4794/9741 [00:13<00:15, 311.60it/s] 50%|█████████████████████████▊                          | 4833/9741 [00:13<00:14, 331.50it/s] 50%|██████████████████████████                          | 4872/9741 [00:13<00:14, 346.34it/s] 50%|██████████████████████████▏                         | 4911/9741 [00:13<00:13, 358.06it/s] 51%|██████████████████████████▍                         | 4950/9741 [00:13<00:13, 365.44it/s] 51%|██████████████████████████▋                         | 4989/9741 [00:13<00:12, 372.43it/s] 52%|██████████████████████████▊                         | 5028/9741 [00:13<00:12, 374.84it/s] 52%|███████████████████████████                         | 5067/9741 [00:13<00:12, 378.93it/s] 52%|███████████████████████████▎                        | 5106/9741 [00:14<00:12, 381.80it/s] 53%|███████████████████████████▍                        | 5145/9741 [00:14<00:11, 383.90it/s] 53%|███████████████████████████▋                        | 5184/9741 [00:14<00:11, 382.74it/s] 54%|███████████████████████████▉                        | 5223/9741 [00:14<00:11, 384.46it/s] 54%|████████████████████████████                        | 5262/9741 [00:14<00:11, 385.84it/s] 54%|████████████████████████████▎                       | 5301/9741 [00:14<00:11, 386.84it/s] 55%|████████████████████████████▌                       | 5340/9741 [00:14<00:11, 386.80it/s] 55%|████████████████████████████▋                       | 5379/9741 [00:14<00:11, 387.68it/s] 56%|████████████████████████████▉                       | 5418/9741 [00:14<00:11, 386.09it/s] 56%|█████████████████████████████▏                      | 5457/9741 [00:15<00:11, 386.55it/s] 56%|█████████████████████████████▎                      | 5497/9741 [00:15<00:10, 389.41it/s] 57%|█████████████████████████████▌                      | 5538/9741 [00:15<00:10, 393.35it/s] 57%|█████████████████████████████▊                      | 5579/9741 [00:15<00:10, 396.33it/s] 58%|██████████████████████████████                      | 5620/9741 [00:15<00:10, 398.27it/s] 58%|██████████████████████████████▏                     | 5660/9741 [00:15<00:10, 397.56it/s] 59%|██████████████████████████████▍                     | 5700/9741 [00:15<00:10, 397.74it/s] 59%|██████████████████████████████▋                     | 5741/9741 [00:15<00:10, 399.18it/s] 59%|██████████████████████████████▊                     | 5782/9741 [00:15<00:09, 400.54it/s] 60%|███████████████████████████████                     | 5823/9741 [00:15<00:09, 401.20it/s] 60%|███████████████████████████████▎                    | 5864/9741 [00:16<00:09, 398.49it/s] 61%|███████████████████████████████▌                    | 5905/9741 [00:16<00:09, 399.60it/s] 61%|███████████████████████████████▋                    | 5946/9741 [00:16<00:09, 400.19it/s] 61%|███████████████████████████████▉                    | 5987/9741 [00:16<00:09, 401.26it/s] 62%|████████████████████████████████▏                   | 6028/9741 [00:16<00:09, 401.43it/s] 62%|████████████████████████████████▍                   | 6069/9741 [00:16<00:09, 401.82it/s] 63%|████████████████████████████████▌                   | 6110/9741 [00:16<00:09, 399.87it/s] 63%|████████████████████████████████▊                   | 6151/9741 [00:16<00:08, 399.98it/s] 64%|█████████████████████████████████                   | 6192/9741 [00:16<00:08, 400.51it/s] 64%|█████████████████████████████████▎                  | 6233/9741 [00:16<00:08, 400.76it/s] 64%|█████████████████████████████████▍                  | 6274/9741 [00:17<00:08, 401.46it/s] 65%|█████████████████████████████████▋                  | 6315/9741 [00:17<00:08, 399.33it/s] 65%|█████████████████████████████████▉                  | 6356/9741 [00:17<00:08, 400.43it/s] 66%|██████████████████████████████████▏                 | 6397/9741 [00:17<00:08, 400.25it/s] 66%|██████████████████████████████████▎                 | 6438/9741 [00:17<00:08, 400.84it/s] 67%|██████████████████████████████████▌                 | 6479/9741 [00:17<00:08, 400.97it/s] 67%|██████████████████████████████████▊                 | 6520/9741 [00:17<00:08, 400.98it/s] 67%|███████████████████████████████████                 | 6561/9741 [00:17<00:07, 398.56it/s] 68%|███████████████████████████████████▏                | 6602/9741 [00:17<00:07, 399.35it/s] 68%|███████████████████████████████████▍                | 6643/9741 [00:17<00:07, 399.75it/s] 69%|███████████████████████████████████▋                | 6684/9741 [00:18<00:07, 400.62it/s] 69%|███████████████████████████████████▉                | 6725/9741 [00:18<00:07, 400.80it/s] 69%|████████████████████████████████████                | 6766/9741 [00:18<00:07, 399.18it/s] 70%|████████████████████████████████████▎               | 6807/9741 [00:18<00:07, 400.38it/s] 70%|████████████████████████████████████▌               | 6848/9741 [00:18<00:07, 400.56it/s] 71%|████████████████████████████████████▊               | 6889/9741 [00:18<00:07, 400.84it/s] 71%|████████████████████████████████████▉               | 6930/9741 [00:18<00:06, 401.63it/s] 72%|█████████████████████████████████████▏              | 6971/9741 [00:18<00:06, 402.00it/s] 72%|█████████████████████████████████████▍              | 7012/9741 [00:18<00:06, 399.99it/s] 72%|█████████████████████████████████████▋              | 7053/9741 [00:18<00:06, 398.67it/s] 73%|█████████████████████████████████████▊              | 7094/9741 [00:19<00:06, 399.40it/s] 73%|██████████████████████████████████████              | 7135/9741 [00:19<00:06, 400.17it/s] 74%|██████████████████████████████████████▎             | 7176/9741 [00:19<00:06, 400.70it/s] 74%|██████████████████████████████████████▌             | 7217/9741 [00:19<00:06, 398.61it/s] 75%|██████████████████████████████████████▋             | 7258/9741 [00:19<00:06, 399.46it/s] 75%|██████████████████████████████████████▉             | 7299/9741 [00:19<00:06, 400.56it/s] 75%|███████████████████████████████████████▏            | 7340/9741 [00:19<00:05, 401.63it/s] 76%|███████████████████████████████████████▍            | 7381/9741 [00:19<00:05, 401.42it/s] 76%|███████████████████████████████████████▌            | 7422/9741 [00:19<00:05, 401.60it/s] 77%|███████████████████████████████████████▊            | 7463/9741 [00:20<00:06, 374.40it/s] 77%|████████████████████████████████████████            | 7504/9741 [00:20<00:05, 382.27it/s] 77%|████████████████████████████████████████▎           | 7545/9741 [00:20<00:05, 387.48it/s] 78%|████████████████████████████████████████▍           | 7586/9741 [00:20<00:05, 391.73it/s] 78%|████████████████████████████████████████▋           | 7627/9741 [00:20<00:05, 395.22it/s] 79%|████████████████████████████████████████▉           | 7667/9741 [00:20<00:05, 395.10it/s] 79%|█████████████████████████████████████████▏          | 7708/9741 [00:20<00:05, 396.84it/s] 80%|█████████████████████████████████████████▎          | 7748/9741 [00:20<00:05, 394.42it/s] 80%|█████████████████████████████████████████▌          | 7789/9741 [00:20<00:04, 396.52it/s] 80%|█████████████████████████████████████████▊          | 7830/9741 [00:20<00:04, 398.01it/s] 81%|██████████████████████████████████████████          | 7871/9741 [00:21<00:04, 398.92it/s] 81%|██████████████████████████████████████████▏         | 7911/9741 [00:21<00:04, 387.94it/s] 82%|██████████████████████████████████████████▍         | 7951/9741 [00:21<00:04, 390.68it/s] 82%|██████████████████████████████████████████▋         | 7992/9741 [00:21<00:04, 394.42it/s] 82%|██████████████████████████████████████████▉         | 8033/9741 [00:21<00:04, 396.14it/s] 83%|███████████████████████████████████████████         | 8074/9741 [00:21<00:04, 397.57it/s] 83%|███████████████████████████████████████████▎        | 8115/9741 [00:21<00:04, 399.54it/s] 84%|███████████████████████████████████████████▌        | 8155/9741 [00:21<00:03, 398.43it/s] 84%|███████████████████████████████████████████▊        | 8196/9741 [00:21<00:03, 399.27it/s] 85%|███████████████████████████████████████████▉        | 8237/9741 [00:21<00:03, 400.27it/s] 85%|████████████████████████████████████████████▏       | 8278/9741 [00:22<00:03, 401.28it/s] 85%|████████████████████████████████████████████▍       | 8319/9741 [00:22<00:03, 401.95it/s] 86%|████████████████████████████████████████████▋       | 8360/9741 [00:22<00:03, 399.57it/s] 86%|████████████████████████████████████████████▊       | 8400/9741 [00:22<00:03, 395.96it/s] 87%|█████████████████████████████████████████████       | 8441/9741 [00:22<00:03, 397.84it/s] 87%|█████████████████████████████████████████████▎      | 8482/9741 [00:22<00:03, 399.04it/s] 87%|█████████████████████████████████████████████▍      | 8523/9741 [00:22<00:03, 399.35it/s] 88%|█████████████████████████████████████████████▋      | 8564/9741 [00:22<00:02, 399.95it/s] 88%|█████████████████████████████████████████████▉      | 8604/9741 [00:22<00:02, 398.06it/s] 89%|██████████████████████████████████████████████▏     | 8645/9741 [00:23<00:02, 399.43it/s] 89%|██████████████████████████████████████████████▎     | 8686/9741 [00:23<00:02, 400.17it/s] 90%|██████████████████████████████████████████████▌     | 8727/9741 [00:23<00:02, 400.14it/s] 90%|██████████████████████████████████████████████▊     | 8768/9741 [00:23<00:02, 400.62it/s] 90%|███████████████████████████████████████████████     | 8809/9741 [00:23<00:02, 398.57it/s] 91%|███████████████████████████████████████████████▏    | 8850/9741 [00:23<00:02, 399.26it/s] 91%|███████████████████████████████████████████████▍    | 8891/9741 [00:23<00:02, 399.77it/s] 92%|███████████████████████████████████████████████▋    | 8932/9741 [00:23<00:02, 400.47it/s] 92%|███████████████████████████████████████████████▉    | 8973/9741 [00:23<00:01, 401.17it/s] 93%|████████████████████████████████████████████████    | 9014/9741 [00:23<00:01, 401.38it/s] 93%|████████████████████████████████████████████████▎   | 9055/9741 [00:24<00:01, 398.70it/s] 93%|████████████████████████████████████████████████▌   | 9095/9741 [00:24<00:01, 395.44it/s] 94%|████████████████████████████████████████████████▊   | 9136/9741 [00:24<00:01, 397.20it/s] 94%|████████████████████████████████████████████████▉   | 9177/9741 [00:24<00:01, 399.05it/s] 95%|█████████████████████████████████████████████████▏  | 9217/9741 [00:24<00:01, 398.99it/s] 95%|█████████████████████████████████████████████████▍  | 9257/9741 [00:24<00:01, 397.60it/s] 95%|█████████████████████████████████████████████████▋  | 9298/9741 [00:24<00:01, 398.97it/s] 96%|█████████████████████████████████████████████████▊  | 9339/9741 [00:24<00:01, 400.19it/s] 96%|██████████████████████████████████████████████████  | 9380/9741 [00:24<00:00, 400.47it/s] 97%|██████████████████████████████████████████████████▎ | 9421/9741 [00:24<00:00, 400.15it/s] 97%|██████████████████████████████████████████████████▌ | 9462/9741 [00:25<00:00, 400.79it/s] 98%|██████████████████████████████████████████████████▋ | 9503/9741 [00:25<00:00, 399.08it/s] 98%|██████████████████████████████████████████████████▉ | 9544/9741 [00:25<00:00, 399.84it/s] 98%|███████████████████████████████████████████████████▏| 9585/9741 [00:25<00:00, 400.54it/s] 99%|███████████████████████████████████████████████████▍| 9626/9741 [00:25<00:00, 401.22it/s] 99%|███████████████████████████████████████████████████▌| 9667/9741 [00:25<00:00, 401.45it/s]100%|███████████████████████████████████████████████████▊| 9708/9741 [00:25<00:00, 401.22it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:25<00:00, 378.32it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.50s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.09s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.81s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.84s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.97s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.57s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.79s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.80s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.36s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.53s/it]
[2023-08-21 16:14:27,512] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.97s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.12s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.37s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.49s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.42s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.53s/it]
[2023-08-21 16:14:38,561] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 16:14:38,562] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 16:14:38,562] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 16:14:38,562] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 16:14:38,562] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 16:14:38,562] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fdf67bede80>
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fdf54353f10>
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 16:14:38,565] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 16:14:38,565] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 16:14:38,565] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 16:14:38,565] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.40445637702941895 seconds
Time to load utils op: 0.5168542861938477 seconds
Loading extension module utils...
Time to load utils op: 0.4028167724609375 seconds
Loading extension module utils...
Time to load utils op: 0.4044957160949707 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input: Tonya has $150.00 on her credit card.  If she leaves any balance on her card at the end of the month, she is charged 20% interest.  If she makes a $50.00 payment on her card, what will be the new balance?
Output: 120

Input: In her first term, Governor Sandoval gave twice as many commencement addresses as Governor Hawkins. Governor Sloan gave ten more commencement addresses than Governor Sandoval in the same amount of time. If Governor Sandoval gave 12 commencement addresses, how many commencement addresses did the three of them give altogether?
Output: 40

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o17-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:40<33:08, 40.57s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:20<32:07, 40.16s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:00<31:22, 40.06s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:39<30:34, 39.88s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:19<29:43, 39.63s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:42<25:07, 34.25s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:22<25:51, 36.08s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:02<26:02, 37.20s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:42<25:56, 37.96s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:21<25:42, 38.56s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:01<25:13, 38.81s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:40<24:41, 39.00s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:20<24:08, 39.15s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [08:59<23:33, 39.26s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:39<23:02, 39.49s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:19<22:23, 39.51s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:59<21:46, 39.60s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:38<21:05, 39.55s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:18<20:26, 39.57s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:58<19:51, 39.72s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:38<19:12, 39.75s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:17<18:33, 39.78s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:57<17:53, 39.75s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:37<17:15, 39.81s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:17<16:37, 39.91s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:57<15:55, 39.81s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:37<15:15, 39.80s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:12<14:04, 38.38s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:52<13:37, 38.92s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:32<13:05, 39.29s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:12<12:29, 39.46s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:51<11:50, 39.50s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:31<11:13, 39.65s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [22:11<10:34, 39.64s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:51<09:56, 39.78s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [23:31<09:17, 39.82s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [24:10<08:35, 39.67s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [24:50<07:55, 39.63s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [25:30<07:17, 39.74s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [26:10<06:38, 39.81s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [26:50<05:58, 39.85s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [27:30<05:18, 39.80s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [28:09<04:38, 39.83s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [28:49<03:58, 39.72s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [29:28<03:18, 39.63s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [30:08<02:38, 39.56s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [30:48<01:59, 39.88s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [31:28<01:19, 39.77s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [32:08<00:39, 39.93s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [32:48<00:00, 39.86s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [32:48<00:00, 39.37s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.3238} | avg. gen lenth: 306.512
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o18-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 18
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 16:47:33,571] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o18-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 18
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o18-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 25/9741 [00:00<00:40, 242.75it/s]  1%|▎                                                     | 50/9741 [00:00<00:39, 242.70it/s]  1%|▍                                                     | 75/9741 [00:00<00:39, 243.18it/s]  1%|▌                                                    | 100/9741 [00:00<00:39, 243.89it/s]  1%|▋                                                    | 125/9741 [00:00<00:39, 244.02it/s]  2%|▊                                                    | 150/9741 [00:00<00:39, 243.80it/s]  2%|▉                                                    | 175/9741 [00:00<00:39, 243.86it/s]  2%|█                                                    | 200/9741 [00:00<00:40, 237.91it/s]  2%|█▏                                                   | 225/9741 [00:00<00:39, 239.40it/s]  3%|█▎                                                   | 250/9741 [00:01<00:39, 240.14it/s]  3%|█▍                                                   | 275/9741 [00:01<00:39, 241.22it/s]  3%|█▋                                                   | 300/9741 [00:01<00:39, 241.97it/s]  3%|█▊                                                   | 325/9741 [00:01<00:38, 242.16it/s]  4%|█▉                                                   | 350/9741 [00:01<00:38, 242.35it/s]  4%|██                                                   | 375/9741 [00:01<00:38, 242.93it/s]  4%|██▏                                                  | 400/9741 [00:01<00:38, 243.10it/s]  4%|██▎                                                  | 425/9741 [00:01<00:38, 240.16it/s]  5%|██▍                                                  | 450/9741 [00:01<00:39, 237.56it/s]  5%|██▌                                                  | 475/9741 [00:01<00:38, 238.93it/s]  5%|██▋                                                  | 500/9741 [00:02<00:38, 240.48it/s]  5%|██▊                                                  | 525/9741 [00:02<00:38, 240.92it/s]  6%|██▉                                                  | 550/9741 [00:02<00:38, 241.58it/s]  6%|███▏                                                 | 575/9741 [00:02<00:37, 241.74it/s]  6%|███▎                                                 | 600/9741 [00:02<00:37, 243.55it/s]  7%|███▍                                                 | 637/9741 [00:02<00:32, 280.52it/s]  7%|███▋                                                 | 674/9741 [00:02<00:29, 305.17it/s]  7%|███▊                                                 | 711/9741 [00:02<00:27, 323.82it/s]  8%|████                                                 | 748/9741 [00:02<00:26, 336.79it/s]  8%|████▎                                                | 786/9741 [00:02<00:25, 346.90it/s]  8%|████▍                                                | 823/9741 [00:03<00:25, 353.40it/s]  9%|████▋                                                | 860/9741 [00:03<00:24, 358.10it/s]  9%|████▉                                                | 897/9741 [00:03<00:24, 359.50it/s] 10%|█████                                                | 934/9741 [00:03<00:24, 361.58it/s] 10%|█████▎                                               | 971/9741 [00:03<00:24, 364.04it/s] 10%|█████▍                                              | 1009/9741 [00:03<00:23, 365.88it/s] 11%|█████▌                                              | 1046/9741 [00:03<00:23, 366.89it/s] 11%|█████▊                                              | 1084/9741 [00:03<00:23, 367.89it/s] 12%|█████▉                                              | 1121/9741 [00:03<00:23, 365.90it/s] 12%|██████▏                                             | 1158/9741 [00:04<00:23, 366.98it/s] 12%|██████▍                                             | 1195/9741 [00:04<00:23, 367.55it/s] 13%|██████▌                                             | 1232/9741 [00:04<00:23, 357.61it/s] 13%|██████▊                                             | 1270/9741 [00:04<00:23, 361.32it/s] 13%|██████▉                                             | 1308/9741 [00:04<00:23, 364.27it/s] 14%|███████▏                                            | 1345/9741 [00:04<00:23, 363.67it/s] 14%|███████▍                                            | 1382/9741 [00:04<00:22, 365.09it/s] 15%|███████▌                                            | 1419/9741 [00:04<00:22, 366.29it/s] 15%|███████▊                                            | 1456/9741 [00:04<00:22, 366.90it/s] 15%|███████▉                                            | 1493/9741 [00:04<00:22, 366.85it/s] 16%|████████▏                                           | 1530/9741 [00:05<00:22, 367.24it/s] 16%|████████▎                                           | 1567/9741 [00:05<00:22, 366.00it/s] 16%|████████▌                                           | 1604/9741 [00:05<00:22, 366.64it/s] 17%|████████▊                                           | 1641/9741 [00:05<00:22, 367.47it/s] 17%|████████▉                                           | 1678/9741 [00:05<00:21, 367.32it/s] 18%|█████████▏                                          | 1715/9741 [00:05<00:21, 367.93it/s] 18%|█████████▎                                          | 1752/9741 [00:05<00:21, 368.39it/s] 18%|█████████▌                                          | 1789/9741 [00:05<00:22, 348.55it/s] 19%|█████████▋                                          | 1826/9741 [00:05<00:22, 353.86it/s] 19%|█████████▉                                          | 1863/9741 [00:05<00:22, 357.91it/s] 20%|██████████▏                                         | 1900/9741 [00:06<00:21, 358.72it/s] 20%|██████████▎                                         | 1937/9741 [00:06<00:21, 361.23it/s] 20%|██████████▌                                         | 1974/9741 [00:06<00:21, 363.30it/s] 21%|██████████▋                                         | 2011/9741 [00:06<00:21, 364.91it/s] 21%|██████████▉                                         | 2048/9741 [00:06<00:21, 363.69it/s] 21%|███████████▏                                        | 2085/9741 [00:06<00:20, 365.18it/s] 22%|███████████▎                                        | 2122/9741 [00:06<00:20, 366.33it/s] 22%|███████████▌                                        | 2159/9741 [00:06<00:20, 366.92it/s] 23%|███████████▋                                        | 2196/9741 [00:06<00:20, 366.82it/s] 23%|███████████▉                                        | 2233/9741 [00:06<00:20, 367.12it/s] 23%|████████████                                        | 2270/9741 [00:07<00:20, 362.66it/s] 24%|████████████▎                                       | 2307/9741 [00:07<00:20, 364.22it/s] 24%|████████████▌                                       | 2344/9741 [00:07<00:20, 364.95it/s] 24%|████████████▋                                       | 2381/9741 [00:07<00:20, 365.88it/s] 25%|████████████▉                                       | 2418/9741 [00:07<00:20, 366.08it/s] 25%|█████████████                                       | 2455/9741 [00:07<00:19, 366.69it/s] 26%|█████████████▎                                      | 2492/9741 [00:07<00:19, 364.81it/s] 26%|█████████████▌                                      | 2529/9741 [00:07<00:19, 365.67it/s] 26%|█████████████▋                                      | 2566/9741 [00:07<00:19, 366.43it/s] 27%|█████████████▉                                      | 2603/9741 [00:07<00:19, 366.98it/s] 27%|██████████████                                      | 2640/9741 [00:08<00:19, 367.23it/s] 27%|██████████████▎                                     | 2677/9741 [00:08<00:19, 367.32it/s] 28%|██████████████▍                                     | 2714/9741 [00:08<00:19, 365.23it/s] 28%|██████████████▋                                     | 2751/9741 [00:08<00:19, 362.58it/s] 29%|██████████████▉                                     | 2788/9741 [00:08<00:19, 363.85it/s] 29%|███████████████                                     | 2825/9741 [00:08<00:18, 365.07it/s] 29%|███████████████▎                                    | 2862/9741 [00:08<00:18, 366.32it/s] 30%|███████████████▍                                    | 2899/9741 [00:08<00:18, 366.49it/s] 30%|███████████████▋                                    | 2936/9741 [00:08<00:18, 365.01it/s] 31%|███████████████▊                                    | 2973/9741 [00:08<00:18, 365.98it/s] 31%|████████████████                                    | 3010/9741 [00:09<00:18, 367.03it/s] 31%|████████████████▎                                   | 3047/9741 [00:09<00:18, 367.28it/s] 32%|████████████████▍                                   | 3084/9741 [00:09<00:18, 367.28it/s] 32%|████████████████▋                                   | 3121/9741 [00:09<00:18, 365.37it/s] 32%|████████████████▊                                   | 3158/9741 [00:09<00:18, 362.56it/s] 33%|█████████████████                                   | 3195/9741 [00:09<00:17, 364.55it/s] 33%|█████████████████▎                                  | 3232/9741 [00:09<00:17, 362.88it/s] 34%|█████████████████▍                                  | 3269/9741 [00:09<00:17, 364.62it/s] 34%|█████████████████▋                                  | 3306/9741 [00:09<00:17, 365.40it/s] 34%|█████████████████▊                                  | 3343/9741 [00:09<00:17, 365.84it/s] 35%|██████████████████                                  | 3380/9741 [00:10<00:17, 363.88it/s] 35%|██████████████████▏                                 | 3417/9741 [00:10<00:17, 365.31it/s] 35%|██████████████████▍                                 | 3454/9741 [00:10<00:17, 365.90it/s] 36%|██████████████████▋                                 | 3491/9741 [00:10<00:17, 366.21it/s] 36%|██████████████████▊                                 | 3528/9741 [00:10<00:16, 366.44it/s] 37%|███████████████████                                 | 3565/9741 [00:10<00:16, 366.16it/s] 37%|███████████████████▏                                | 3602/9741 [00:10<00:16, 366.91it/s] 37%|███████████████████▍                                | 3639/9741 [00:10<00:16, 365.28it/s] 38%|███████████████████▌                                | 3676/9741 [00:10<00:16, 366.11it/s] 38%|███████████████████▊                                | 3713/9741 [00:11<00:16, 366.78it/s] 38%|████████████████████                                | 3750/9741 [00:11<00:16, 367.35it/s] 39%|████████████████████▏                               | 3787/9741 [00:11<00:16, 367.52it/s] 39%|████████████████████▍                               | 3824/9741 [00:11<00:16, 367.46it/s] 40%|████████████████████▌                               | 3861/9741 [00:11<00:16, 364.56it/s] 40%|████████████████████▊                               | 3898/9741 [00:11<00:15, 365.75it/s] 40%|█████████████████████                               | 3935/9741 [00:11<00:15, 366.18it/s] 41%|█████████████████████▏                              | 3972/9741 [00:11<00:15, 366.42it/s] 41%|█████████████████████▍                              | 4009/9741 [00:11<00:15, 367.18it/s] 42%|█████████████████████▌                              | 4046/9741 [00:11<00:15, 367.28it/s] 42%|█████████████████████▊                              | 4083/9741 [00:12<00:15, 365.24it/s] 42%|█████████████████████▉                              | 4120/9741 [00:12<00:15, 365.75it/s] 43%|██████████████████████▏                             | 4157/9741 [00:12<00:15, 366.41it/s] 43%|██████████████████████▍                             | 4194/9741 [00:12<00:15, 364.11it/s] 43%|██████████████████████▌                             | 4231/9741 [00:12<00:15, 365.03it/s] 44%|██████████████████████▊                             | 4268/9741 [00:12<00:14, 366.08it/s] 44%|██████████████████████▉                             | 4305/9741 [00:12<00:14, 364.60it/s] 45%|███████████████████████▏                            | 4342/9741 [00:12<00:14, 365.69it/s] 45%|███████████████████████▍                            | 4379/9741 [00:12<00:14, 365.60it/s] 45%|███████████████████████▌                            | 4416/9741 [00:12<00:14, 366.45it/s] 46%|███████████████████████▊                            | 4453/9741 [00:13<00:14, 366.33it/s] 46%|███████████████████████▉                            | 4490/9741 [00:13<00:14, 366.92it/s] 46%|████████████████████████▏                           | 4527/9741 [00:13<00:15, 330.33it/s] 47%|████████████████████████▎                           | 4564/9741 [00:13<00:15, 340.84it/s] 47%|████████████████████████▌                           | 4601/9741 [00:13<00:14, 347.80it/s] 48%|████████████████████████▊                           | 4638/9741 [00:13<00:14, 353.56it/s] 48%|████████████████████████▉                           | 4675/9741 [00:13<00:14, 357.66it/s] 48%|█████████████████████████▏                          | 4712/9741 [00:13<00:13, 360.75it/s] 49%|█████████████████████████▎                          | 4749/9741 [00:14<00:20, 244.09it/s] 49%|█████████████████████████▌                          | 4786/9741 [00:14<00:18, 271.28it/s] 50%|█████████████████████████▋                          | 4823/9741 [00:14<00:16, 294.33it/s] 50%|█████████████████████████▉                          | 4860/9741 [00:14<00:15, 312.79it/s] 50%|██████████████████████████▏                         | 4897/9741 [00:14<00:14, 327.19it/s] 51%|██████████████████████████▎                         | 4934/9741 [00:14<00:14, 338.27it/s] 51%|██████████████████████████▌                         | 4971/9741 [00:14<00:13, 344.91it/s] 51%|██████████████████████████▋                         | 5008/9741 [00:14<00:13, 351.22it/s] 52%|██████████████████████████▉                         | 5045/9741 [00:14<00:13, 355.94it/s] 52%|███████████████████████████▏                        | 5082/9741 [00:14<00:12, 359.13it/s] 53%|███████████████████████████▎                        | 5119/9741 [00:15<00:12, 361.77it/s] 53%|███████████████████████████▌                        | 5156/9741 [00:15<00:12, 363.60it/s] 53%|███████████████████████████▋                        | 5193/9741 [00:15<00:12, 362.78it/s] 54%|███████████████████████████▉                        | 5230/9741 [00:15<00:12, 364.15it/s] 54%|████████████████████████████                        | 5267/9741 [00:15<00:12, 363.49it/s] 54%|████████████████████████████▎                       | 5304/9741 [00:15<00:12, 364.73it/s] 55%|████████████████████████████▌                       | 5341/9741 [00:15<00:12, 364.94it/s] 55%|████████████████████████████▋                       | 5378/9741 [00:15<00:11, 365.41it/s] 56%|████████████████████████████▉                       | 5415/9741 [00:15<00:11, 363.64it/s] 56%|█████████████████████████████                       | 5452/9741 [00:15<00:11, 364.84it/s] 56%|█████████████████████████████▎                      | 5490/9741 [00:16<00:11, 367.34it/s] 57%|█████████████████████████████▌                      | 5528/9741 [00:16<00:11, 370.58it/s] 57%|█████████████████████████████▋                      | 5566/9741 [00:16<00:11, 372.51it/s] 58%|█████████████████████████████▉                      | 5604/9741 [00:16<00:11, 374.03it/s] 58%|██████████████████████████████                      | 5642/9741 [00:16<00:10, 373.39it/s] 58%|██████████████████████████████▎                     | 5680/9741 [00:16<00:10, 374.89it/s] 59%|██████████████████████████████▌                     | 5718/9741 [00:16<00:10, 375.94it/s] 59%|██████████████████████████████▋                     | 5756/9741 [00:16<00:10, 376.74it/s] 59%|██████████████████████████████▉                     | 5794/9741 [00:16<00:10, 376.54it/s] 60%|███████████████████████████████▏                    | 5832/9741 [00:16<00:10, 376.83it/s] 60%|███████████████████████████████▎                    | 5870/9741 [00:17<00:10, 374.98it/s] 61%|███████████████████████████████▌                    | 5908/9741 [00:17<00:10, 375.75it/s] 61%|███████████████████████████████▋                    | 5946/9741 [00:17<00:10, 375.96it/s] 61%|███████████████████████████████▉                    | 5984/9741 [00:17<00:09, 376.38it/s] 62%|████████████████████████████████▏                   | 6022/9741 [00:17<00:09, 375.90it/s] 62%|████████████████████████████████▎                   | 6061/9741 [00:17<00:09, 377.25it/s] 63%|████████████████████████████████▌                   | 6099/9741 [00:17<00:09, 375.35it/s] 63%|████████████████████████████████▊                   | 6137/9741 [00:17<00:09, 376.51it/s] 63%|████████████████████████████████▉                   | 6175/9741 [00:17<00:09, 376.82it/s] 64%|█████████████████████████████████▏                  | 6213/9741 [00:17<00:09, 376.96it/s] 64%|█████████████████████████████████▎                  | 6251/9741 [00:18<00:09, 376.90it/s] 65%|█████████████████████████████████▌                  | 6289/9741 [00:18<00:09, 377.42it/s] 65%|█████████████████████████████████▊                  | 6327/9741 [00:18<00:09, 375.54it/s] 65%|█████████████████████████████████▉                  | 6365/9741 [00:18<00:08, 376.00it/s] 66%|██████████████████████████████████▏                 | 6403/9741 [00:18<00:08, 376.87it/s] 66%|██████████████████████████████████▍                 | 6441/9741 [00:18<00:08, 377.63it/s] 67%|██████████████████████████████████▌                 | 6479/9741 [00:18<00:08, 377.63it/s] 67%|██████████████████████████████████▊                 | 6517/9741 [00:18<00:08, 377.54it/s] 67%|██████████████████████████████████▉                 | 6555/9741 [00:18<00:08, 375.62it/s] 68%|███████████████████████████████████▏                | 6593/9741 [00:18<00:08, 376.40it/s] 68%|███████████████████████████████████▍                | 6631/9741 [00:19<00:08, 375.72it/s] 68%|███████████████████████████████████▌                | 6669/9741 [00:19<00:08, 376.43it/s] 69%|███████████████████████████████████▊                | 6707/9741 [00:19<00:08, 376.80it/s] 69%|████████████████████████████████████                | 6745/9741 [00:19<00:07, 377.48it/s] 70%|████████████████████████████████████▏               | 6783/9741 [00:19<00:07, 375.23it/s] 70%|████████████████████████████████████▍               | 6821/9741 [00:19<00:07, 376.13it/s] 70%|████████████████████████████████████▌               | 6859/9741 [00:19<00:07, 376.73it/s] 71%|████████████████████████████████████▊               | 6897/9741 [00:19<00:07, 377.33it/s] 71%|█████████████████████████████████████               | 6935/9741 [00:19<00:07, 377.82it/s] 72%|█████████████████████████████████████▏              | 6973/9741 [00:19<00:07, 378.18it/s] 72%|█████████████████████████████████████▍              | 7011/9741 [00:20<00:07, 375.99it/s] 72%|█████████████████████████████████████▋              | 7049/9741 [00:20<00:07, 376.80it/s] 73%|█████████████████████████████████████▊              | 7087/9741 [00:20<00:07, 376.49it/s] 73%|██████████████████████████████████████              | 7125/9741 [00:20<00:06, 377.05it/s] 74%|██████████████████████████████████████▏             | 7163/9741 [00:20<00:06, 376.60it/s] 74%|██████████████████████████████████████▍             | 7201/9741 [00:20<00:06, 376.90it/s] 74%|██████████████████████████████████████▋             | 7239/9741 [00:20<00:06, 375.36it/s] 75%|██████████████████████████████████████▊             | 7277/9741 [00:20<00:06, 373.37it/s] 75%|███████████████████████████████████████             | 7315/9741 [00:20<00:06, 374.81it/s] 75%|███████████████████████████████████████▎            | 7353/9741 [00:21<00:06, 375.72it/s] 76%|███████████████████████████████████████▍            | 7391/9741 [00:21<00:06, 376.93it/s] 76%|███████████████████████████████████████▋            | 7429/9741 [00:21<00:06, 377.62it/s] 77%|███████████████████████████████████████▊            | 7467/9741 [00:21<00:06, 352.06it/s] 77%|████████████████████████████████████████            | 7505/9741 [00:21<00:06, 359.31it/s] 77%|████████████████████████████████████████▎           | 7543/9741 [00:21<00:06, 363.63it/s] 78%|████████████████████████████████████████▍           | 7581/9741 [00:21<00:05, 367.83it/s] 78%|████████████████████████████████████████▋           | 7619/9741 [00:21<00:05, 370.47it/s] 79%|████████████████████████████████████████▉           | 7657/9741 [00:21<00:05, 372.73it/s] 79%|█████████████████████████████████████████           | 7695/9741 [00:21<00:05, 372.32it/s] 79%|█████████████████████████████████████████▎          | 7733/9741 [00:22<00:05, 374.28it/s] 80%|█████████████████████████████████████████▍          | 7771/9741 [00:22<00:05, 375.11it/s] 80%|█████████████████████████████████████████▋          | 7809/9741 [00:22<00:05, 375.77it/s] 81%|█████████████████████████████████████████▉          | 7847/9741 [00:22<00:05, 375.01it/s] 81%|██████████████████████████████████████████          | 7885/9741 [00:22<00:04, 372.87it/s] 81%|██████████████████████████████████████████▎         | 7923/9741 [00:22<00:04, 369.82it/s] 82%|██████████████████████████████████████████▍         | 7961/9741 [00:22<00:04, 371.99it/s] 82%|██████████████████████████████████████████▋         | 7999/9741 [00:22<00:04, 373.66it/s] 83%|██████████████████████████████████████████▉         | 8037/9741 [00:22<00:04, 375.21it/s] 83%|███████████████████████████████████████████         | 8075/9741 [00:22<00:04, 375.72it/s] 83%|███████████████████████████████████████████▎        | 8113/9741 [00:23<00:04, 376.82it/s] 84%|███████████████████████████████████████████▌        | 8151/9741 [00:23<00:04, 375.33it/s] 84%|███████████████████████████████████████████▋        | 8189/9741 [00:23<00:04, 376.13it/s] 84%|███████████████████████████████████████████▉        | 8227/9741 [00:23<00:04, 376.81it/s] 85%|████████████████████████████████████████████        | 8265/9741 [00:23<00:03, 377.56it/s] 85%|████████████████████████████████████████████▎       | 8303/9741 [00:23<00:03, 376.78it/s] 86%|████████████████████████████████████████████▌       | 8341/9741 [00:23<00:03, 377.38it/s] 86%|████████████████████████████████████████████▋       | 8379/9741 [00:23<00:03, 376.08it/s] 86%|████████████████████████████████████████████▉       | 8417/9741 [00:23<00:03, 376.35it/s] 87%|█████████████████████████████████████████████▏      | 8455/9741 [00:23<00:03, 376.85it/s] 87%|█████████████████████████████████████████████▎      | 8493/9741 [00:24<00:03, 377.39it/s] 88%|█████████████████████████████████████████████▌      | 8531/9741 [00:24<00:03, 374.94it/s] 88%|█████████████████████████████████████████████▋      | 8569/9741 [00:24<00:03, 375.65it/s] 88%|█████████████████████████████████████████████▉      | 8607/9741 [00:24<00:03, 373.94it/s] 89%|██████████████████████████████████████████████▏     | 8645/9741 [00:24<00:02, 374.89it/s] 89%|██████████████████████████████████████████████▎     | 8683/9741 [00:24<00:02, 375.97it/s] 90%|██████████████████████████████████████████████▌     | 8721/9741 [00:24<00:02, 376.27it/s] 90%|██████████████████████████████████████████████▊     | 8759/9741 [00:24<00:02, 375.95it/s] 90%|██████████████████████████████████████████████▉     | 8797/9741 [00:24<00:02, 372.16it/s] 91%|███████████████████████████████████████████████▏    | 8835/9741 [00:24<00:02, 370.01it/s] 91%|███████████████████████████████████████████████▎    | 8873/9741 [00:25<00:02, 372.53it/s] 91%|███████████████████████████████████████████████▌    | 8911/9741 [00:25<00:02, 358.80it/s] 92%|███████████████████████████████████████████████▊    | 8949/9741 [00:25<00:02, 364.50it/s] 92%|███████████████████████████████████████████████▉    | 8987/9741 [00:25<00:02, 367.60it/s] 93%|████████████████████████████████████████████████▏   | 9025/9741 [00:25<00:01, 369.93it/s] 93%|████████████████████████████████████████████████▍   | 9063/9741 [00:25<00:01, 368.43it/s] 93%|████████████████████████████████████████████████▌   | 9101/9741 [00:25<00:01, 370.47it/s] 94%|████████████████████████████████████████████████▊   | 9139/9741 [00:25<00:01, 372.06it/s] 94%|████████████████████████████████████████████████▉   | 9177/9741 [00:25<00:01, 368.86it/s] 95%|█████████████████████████████████████████████████▏  | 9215/9741 [00:26<00:01, 369.97it/s] 95%|█████████████████████████████████████████████████▍  | 9253/9741 [00:26<00:01, 372.07it/s] 95%|█████████████████████████████████████████████████▌  | 9291/9741 [00:26<00:01, 371.00it/s] 96%|█████████████████████████████████████████████████▊  | 9329/9741 [00:26<00:01, 372.83it/s] 96%|██████████████████████████████████████████████████  | 9367/9741 [00:26<00:01, 373.92it/s] 97%|██████████████████████████████████████████████████▏ | 9405/9741 [00:26<00:00, 374.23it/s] 97%|██████████████████████████████████████████████████▍ | 9443/9741 [00:26<00:00, 374.03it/s] 97%|██████████████████████████████████████████████████▌ | 9481/9741 [00:26<00:00, 374.54it/s] 98%|██████████████████████████████████████████████████▊ | 9519/9741 [00:26<00:00, 372.57it/s] 98%|███████████████████████████████████████████████████ | 9557/9741 [00:26<00:00, 373.54it/s] 99%|███████████████████████████████████████████████████▏| 9595/9741 [00:27<00:00, 370.79it/s] 99%|███████████████████████████████████████████████████▍| 9633/9741 [00:27<00:00, 371.56it/s] 99%|███████████████████████████████████████████████████▋| 9671/9741 [00:27<00:00, 372.55it/s]100%|███████████████████████████████████████████████████▊| 9709/9741 [00:27<00:00, 370.38it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:27<00:00, 355.23it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.32s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.51s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.07s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.24s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.20s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.42s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.96s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.62s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]
[2023-08-21 16:48:53,055] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.86s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.36s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.53s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
[2023-08-21 16:49:02,351] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 16:49:02,352] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 16:49:02,352] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 16:49:02,352] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 16:49:02,352] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 16:49:02,352] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 16:49:02,352] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 16:49:02,352] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 16:49:02,352] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 16:49:02,352] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 16:49:02,352] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 16:49:02,352] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f56ff71ffd0>
[2023-08-21 16:49:02,352] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f56f759e220>
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 16:49:02,353] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 16:49:02,354] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 16:49:02,354] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 16:49:02,354] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 16:49:02,354] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.48223161697387695 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input: Tonya has $150.00 on her credit card.  If she leaves any balance on her card at the end of the month, she is charged 20% interest.  If she makes a $50.00 payment on her card, what will be the new balance?
Output: 120

Input: In her first term, Governor Sandoval gave twice as many commencement addresses as Governor Hawkins. Governor Sloan gave ten more commencement addresses than Governor Sandoval in the same amount of time. If Governor Sandoval gave 12 commencement addresses, how many commencement addresses did the three of them give altogether?
Output: 40

Input: If Buzz bought a pizza with 78 slices at a restaurant and then decided to share it with the waiter in the ratio of 5:8, with Buzz's ratio being 5, what's twenty less the number of slices of pizza that the waiter ate?
Output: 28

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o18-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.5048131942749023 seconds
Loading extension module utils...
Time to load utils op: 0.4045753479003906 seconds
Loading extension module utils...
Time to load utils op: 0.40451645851135254 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:39<32:32, 39.85s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:00<22:50, 28.55s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:39<26:04, 33.30s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:18<27:21, 35.69s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [02:57<27:40, 36.91s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:21<23:49, 32.48s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:01<24:52, 34.71s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [04:40<25:26, 36.34s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:20<25:28, 37.27s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [05:59<25:15, 37.88s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [06:38<24:48, 38.16s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:17<24:23, 38.52s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [07:56<23:51, 38.69s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [08:20<20:35, 34.32s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:00<20:55, 35.86s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [09:39<20:56, 36.94s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:18<20:39, 37.56s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [10:58<20:22, 38.20s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [11:37<19:49, 38.37s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:17<19:25, 38.86s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [12:56<18:49, 38.96s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [13:35<18:15, 39.11s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:15<17:36, 39.13s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [14:53<16:54, 39.02s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [15:33<16:16, 39.08s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:12<15:37, 39.05s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [16:51<14:58, 39.06s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [17:15<12:44, 34.73s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [17:54<12:35, 36.00s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [18:33<12:19, 36.99s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:13<11:56, 37.70s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [19:52<11:27, 38.17s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [20:31<10:53, 38.44s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:10<10:17, 38.61s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [21:49<09:39, 38.64s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [22:28<09:02, 38.78s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:07<08:25, 38.91s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [23:46<07:47, 38.92s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [24:25<07:08, 38.93s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [25:04<06:29, 38.92s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [25:35<05:29, 36.57s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:14<04:57, 37.24s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [26:53<04:23, 37.67s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [27:31<03:47, 38.00s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:10<03:11, 38.32s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [28:50<02:34, 38.62s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [29:29<01:56, 38.70s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [30:08<01:17, 38.86s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [30:47<00:38, 38.93s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:26<00:00, 38.94s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:26<00:00, 37.73s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.816} | avg. gen lenth: 316.384
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o19-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 19
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 17:21:37,206] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o19-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 19
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o19-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 22/9741 [00:00<00:44, 217.04it/s]  0%|▏                                                     | 44/9741 [00:00<00:44, 218.08it/s]  1%|▎                                                     | 66/9741 [00:00<00:44, 218.38it/s]  1%|▍                                                     | 88/9741 [00:00<00:44, 218.83it/s]  1%|▌                                                    | 111/9741 [00:00<00:43, 219.18it/s]  1%|▋                                                    | 133/9741 [00:00<00:44, 214.46it/s]  2%|▊                                                    | 155/9741 [00:00<00:44, 215.89it/s]  2%|▉                                                    | 177/9741 [00:00<00:44, 216.76it/s]  2%|█                                                    | 199/9741 [00:00<00:43, 217.40it/s]  2%|█▏                                                   | 221/9741 [00:01<00:44, 216.21it/s]  2%|█▎                                                   | 243/9741 [00:01<00:43, 217.02it/s]  3%|█▍                                                   | 265/9741 [00:01<00:43, 217.74it/s]  3%|█▌                                                   | 287/9741 [00:01<00:43, 218.14it/s]  3%|█▋                                                   | 309/9741 [00:01<00:43, 218.60it/s]  3%|█▊                                                   | 331/9741 [00:01<00:42, 218.84it/s]  4%|█▉                                                   | 357/9741 [00:01<00:40, 229.63it/s]  4%|██▏                                                  | 391/9741 [00:01<00:35, 260.77it/s]  4%|██▎                                                  | 425/9741 [00:01<00:33, 282.28it/s]  5%|██▍                                                  | 458/9741 [00:01<00:31, 295.25it/s]  5%|██▋                                                  | 492/9741 [00:02<00:30, 306.33it/s]  5%|██▊                                                  | 526/9741 [00:02<00:29, 314.17it/s]  6%|███                                                  | 560/9741 [00:02<00:28, 319.55it/s]  6%|███▏                                                 | 593/9741 [00:02<00:28, 322.60it/s]  6%|███▍                                                 | 626/9741 [00:02<00:28, 323.94it/s]  7%|███▌                                                 | 659/9741 [00:02<00:28, 323.24it/s]  7%|███▊                                                 | 692/9741 [00:02<00:27, 324.67it/s]  7%|███▉                                                 | 726/9741 [00:02<00:27, 326.37it/s]  8%|████▏                                                | 760/9741 [00:02<00:27, 328.12it/s]  8%|████▎                                                | 793/9741 [00:02<00:27, 326.66it/s]  8%|████▍                                                | 827/9741 [00:03<00:27, 328.15it/s]  9%|████▋                                                | 861/9741 [00:03<00:26, 329.61it/s]  9%|████▊                                                | 894/9741 [00:03<00:26, 328.27it/s] 10%|█████                                                | 928/9741 [00:03<00:26, 329.54it/s] 10%|█████▏                                               | 962/9741 [00:03<00:26, 330.38it/s] 10%|█████▍                                               | 996/9741 [00:03<00:26, 330.95it/s] 11%|█████▍                                              | 1030/9741 [00:03<00:26, 331.49it/s] 11%|█████▋                                              | 1064/9741 [00:03<00:26, 331.82it/s] 11%|█████▊                                              | 1098/9741 [00:03<00:26, 332.16it/s] 12%|██████                                              | 1132/9741 [00:03<00:26, 330.31it/s] 12%|██████▏                                             | 1166/9741 [00:04<00:25, 330.69it/s] 12%|██████▍                                             | 1200/9741 [00:04<00:25, 331.00it/s] 13%|██████▌                                             | 1234/9741 [00:04<00:25, 329.35it/s] 13%|██████▊                                             | 1268/9741 [00:04<00:25, 330.16it/s] 13%|██████▉                                             | 1302/9741 [00:04<00:25, 330.58it/s] 14%|███████▏                                            | 1336/9741 [00:04<00:25, 328.94it/s] 14%|███████▎                                            | 1370/9741 [00:04<00:25, 329.86it/s] 14%|███████▍                                            | 1404/9741 [00:04<00:25, 330.34it/s] 15%|███████▋                                            | 1438/9741 [00:04<00:25, 330.63it/s] 15%|███████▊                                            | 1472/9741 [00:05<00:24, 331.12it/s] 15%|████████                                            | 1506/9741 [00:05<00:24, 331.16it/s] 16%|████████▏                                           | 1540/9741 [00:05<00:24, 331.40it/s] 16%|████████▍                                           | 1574/9741 [00:05<00:24, 329.58it/s] 17%|████████▌                                           | 1608/9741 [00:05<00:24, 330.16it/s] 17%|████████▊                                           | 1642/9741 [00:05<00:24, 327.70it/s] 17%|████████▉                                           | 1676/9741 [00:05<00:24, 329.13it/s] 18%|█████████▏                                          | 1710/9741 [00:05<00:24, 329.98it/s] 18%|█████████▎                                          | 1744/9741 [00:05<00:24, 330.70it/s] 18%|█████████▍                                          | 1778/9741 [00:05<00:24, 331.17it/s] 19%|█████████▋                                          | 1812/9741 [00:06<00:25, 310.21it/s] 19%|█████████▊                                          | 1846/9741 [00:06<00:24, 316.08it/s] 19%|██████████                                          | 1880/9741 [00:06<00:24, 320.59it/s] 20%|██████████▏                                         | 1914/9741 [00:06<00:24, 323.81it/s] 20%|██████████▍                                         | 1948/9741 [00:06<00:23, 325.96it/s] 20%|██████████▌                                         | 1982/9741 [00:06<00:23, 327.72it/s] 21%|██████████▊                                         | 2016/9741 [00:06<00:23, 327.05it/s] 21%|██████████▉                                         | 2050/9741 [00:06<00:23, 328.26it/s] 21%|███████████                                         | 2083/9741 [00:06<00:23, 325.67it/s] 22%|███████████▎                                        | 2117/9741 [00:06<00:23, 327.38it/s] 22%|███████████▍                                        | 2151/9741 [00:07<00:23, 328.70it/s] 22%|███████████▋                                        | 2185/9741 [00:07<00:22, 329.70it/s] 23%|███████████▊                                        | 2219/9741 [00:07<00:22, 330.45it/s] 23%|████████████                                        | 2253/9741 [00:07<00:22, 328.29it/s] 23%|████████████▏                                       | 2287/9741 [00:07<00:22, 329.43it/s] 24%|████████████▍                                       | 2321/9741 [00:07<00:22, 330.03it/s] 24%|████████████▌                                       | 2355/9741 [00:07<00:22, 330.71it/s] 25%|████████████▊                                       | 2389/9741 [00:07<00:22, 331.25it/s] 25%|████████████▉                                       | 2423/9741 [00:07<00:22, 331.69it/s] 25%|█████████████                                       | 2457/9741 [00:08<00:21, 331.83it/s] 26%|█████████████▎                                      | 2491/9741 [00:08<00:22, 329.41it/s] 26%|█████████████▍                                      | 2524/9741 [00:08<00:22, 328.02it/s] 26%|█████████████▋                                      | 2558/9741 [00:08<00:21, 328.82it/s] 27%|█████████████▊                                      | 2592/9741 [00:08<00:21, 329.87it/s] 27%|██████████████                                      | 2626/9741 [00:08<00:21, 330.49it/s] 27%|██████████████▏                                     | 2660/9741 [00:08<00:21, 330.80it/s] 28%|██████████████▍                                     | 2694/9741 [00:08<00:21, 330.85it/s] 28%|██████████████▌                                     | 2728/9741 [00:08<00:21, 328.93it/s] 28%|██████████████▋                                     | 2762/9741 [00:08<00:21, 329.63it/s] 29%|██████████████▉                                     | 2796/9741 [00:09<00:21, 329.86it/s] 29%|███████████████                                     | 2830/9741 [00:09<00:20, 330.40it/s] 29%|███████████████▎                                    | 2864/9741 [00:09<00:20, 331.08it/s] 30%|███████████████▍                                    | 2898/9741 [00:09<00:20, 331.33it/s] 30%|███████████████▋                                    | 2932/9741 [00:09<00:20, 329.44it/s] 30%|███████████████▊                                    | 2966/9741 [00:09<00:20, 329.99it/s] 31%|████████████████                                    | 3000/9741 [00:09<00:20, 330.74it/s] 31%|████████████████▏                                   | 3034/9741 [00:09<00:20, 331.00it/s] 31%|████████████████▍                                   | 3068/9741 [00:09<00:20, 330.83it/s] 32%|████████████████▌                                   | 3102/9741 [00:09<00:20, 331.07it/s] 32%|████████████████▋                                   | 3136/9741 [00:10<00:19, 331.15it/s] 33%|████████████████▉                                   | 3170/9741 [00:10<00:19, 329.03it/s] 33%|█████████████████                                   | 3204/9741 [00:10<00:19, 329.87it/s] 33%|█████████████████▎                                  | 3238/9741 [00:10<00:19, 330.26it/s] 34%|█████████████████▍                                  | 3272/9741 [00:10<00:19, 330.06it/s] 34%|█████████████████▋                                  | 3306/9741 [00:10<00:19, 330.33it/s] 34%|█████████████████▊                                  | 3340/9741 [00:10<00:19, 329.59it/s] 35%|██████████████████                                  | 3374/9741 [00:10<00:19, 330.15it/s] 35%|██████████████████▏                                 | 3408/9741 [00:10<00:19, 328.47it/s] 35%|██████████████████▎                                 | 3442/9741 [00:10<00:19, 329.11it/s] 36%|██████████████████▌                                 | 3476/9741 [00:11<00:19, 329.68it/s] 36%|██████████████████▋                                 | 3509/9741 [00:11<00:18, 329.43it/s] 36%|██████████████████▉                                 | 3543/9741 [00:11<00:18, 329.68it/s] 37%|███████████████████                                 | 3577/9741 [00:11<00:18, 330.12it/s] 37%|███████████████████▎                                | 3611/9741 [00:11<00:18, 328.52it/s] 37%|███████████████████▍                                | 3645/9741 [00:11<00:18, 329.76it/s] 38%|███████████████████▋                                | 3679/9741 [00:11<00:18, 330.38it/s] 38%|███████████████████▊                                | 3713/9741 [00:11<00:18, 330.81it/s] 38%|████████████████████                                | 3747/9741 [00:11<00:18, 331.14it/s] 39%|████████████████████▏                               | 3781/9741 [00:12<00:17, 331.52it/s] 39%|████████████████████▎                               | 3815/9741 [00:12<00:17, 331.85it/s] 40%|████████████████████▌                               | 3849/9741 [00:12<00:17, 329.98it/s] 40%|████████████████████▋                               | 3883/9741 [00:12<00:17, 330.84it/s] 40%|████████████████████▉                               | 3917/9741 [00:12<00:17, 331.26it/s] 41%|█████████████████████                               | 3951/9741 [00:12<00:17, 331.48it/s] 41%|█████████████████████▎                              | 3985/9741 [00:12<00:17, 331.44it/s] 41%|█████████████████████▍                              | 4019/9741 [00:12<00:17, 332.02it/s] 42%|█████████████████████▋                              | 4053/9741 [00:12<00:17, 331.99it/s] 42%|█████████████████████▊                              | 4087/9741 [00:12<00:17, 329.99it/s] 42%|█████████████████████▉                              | 4121/9741 [00:13<00:17, 329.79it/s] 43%|██████████████████████▏                             | 4154/9741 [00:13<00:16, 328.75it/s] 43%|██████████████████████▎                             | 4187/9741 [00:13<00:17, 326.37it/s] 43%|██████████████████████▌                             | 4221/9741 [00:13<00:16, 327.82it/s] 44%|██████████████████████▋                             | 4255/9741 [00:13<00:16, 329.13it/s] 44%|██████████████████████▉                             | 4288/9741 [00:13<00:16, 328.00it/s] 44%|███████████████████████                             | 4322/9741 [00:13<00:16, 328.72it/s] 45%|███████████████████████▎                            | 4356/9741 [00:13<00:16, 329.70it/s] 45%|███████████████████████▍                            | 4390/9741 [00:13<00:16, 330.27it/s] 45%|███████████████████████▌                            | 4424/9741 [00:13<00:16, 330.73it/s] 46%|███████████████████████▊                            | 4458/9741 [00:14<00:15, 330.96it/s] 46%|███████████████████████▉                            | 4492/9741 [00:14<00:15, 331.20it/s] 46%|████████████████████████▏                           | 4526/9741 [00:14<00:17, 303.66it/s] 47%|████████████████████████▎                           | 4560/9741 [00:14<00:16, 311.48it/s] 47%|████████████████████████▌                           | 4594/9741 [00:14<00:16, 316.94it/s] 48%|████████████████████████▋                           | 4628/9741 [00:14<00:15, 320.82it/s] 48%|████████████████████████▉                           | 4662/9741 [00:14<00:15, 324.08it/s] 48%|█████████████████████████                           | 4696/9741 [00:14<00:15, 326.45it/s] 49%|█████████████████████████▏                          | 4730/9741 [00:14<00:15, 327.73it/s] 49%|█████████████████████████▍                          | 4763/9741 [00:15<00:21, 234.61it/s] 49%|█████████████████████████▌                          | 4797/9741 [00:15<00:19, 257.20it/s] 50%|█████████████████████████▊                          | 4831/9741 [00:15<00:17, 275.86it/s] 50%|█████████████████████████▉                          | 4864/9741 [00:15<00:16, 289.81it/s] 50%|██████████████████████████▏                         | 4898/9741 [00:15<00:16, 301.56it/s] 51%|██████████████████████████▎                         | 4932/9741 [00:15<00:15, 310.30it/s] 51%|██████████████████████████▌                         | 4965/9741 [00:15<00:15, 314.91it/s] 51%|██████████████████████████▋                         | 4999/9741 [00:15<00:14, 320.09it/s] 52%|██████████████████████████▊                         | 5033/9741 [00:15<00:14, 323.73it/s] 52%|███████████████████████████                         | 5067/9741 [00:16<00:14, 326.22it/s] 52%|███████████████████████████▏                        | 5101/9741 [00:16<00:14, 327.53it/s] 53%|███████████████████████████▍                        | 5134/9741 [00:16<00:14, 327.90it/s] 53%|███████████████████████████▌                        | 5167/9741 [00:16<00:13, 328.47it/s] 53%|███████████████████████████▊                        | 5200/9741 [00:16<00:13, 326.64it/s] 54%|███████████████████████████▉                        | 5233/9741 [00:16<00:13, 327.28it/s] 54%|████████████████████████████                        | 5266/9741 [00:16<00:13, 326.63it/s] 54%|████████████████████████████▎                       | 5299/9741 [00:16<00:13, 327.60it/s] 55%|████████████████████████████▍                       | 5332/9741 [00:16<00:13, 328.05it/s] 55%|████████████████████████████▋                       | 5365/9741 [00:16<00:13, 328.18it/s] 55%|████████████████████████████▊                       | 5398/9741 [00:17<00:13, 326.22it/s] 56%|████████████████████████████▉                       | 5431/9741 [00:17<00:13, 327.32it/s] 56%|█████████████████████████████▏                      | 5464/9741 [00:17<00:13, 327.86it/s] 56%|█████████████████████████████▎                      | 5498/9741 [00:17<00:12, 330.84it/s] 57%|█████████████████████████████▌                      | 5533/9741 [00:17<00:12, 333.78it/s] 57%|█████████████████████████████▋                      | 5568/9741 [00:17<00:12, 335.93it/s] 58%|█████████████████████████████▉                      | 5602/9741 [00:17<00:12, 337.01it/s] 58%|██████████████████████████████                      | 5636/9741 [00:17<00:12, 335.92it/s] 58%|██████████████████████████████▎                     | 5671/9741 [00:17<00:12, 337.36it/s] 59%|██████████████████████████████▍                     | 5706/9741 [00:18<00:11, 338.45it/s] 59%|██████████████████████████████▋                     | 5741/9741 [00:18<00:11, 339.96it/s] 59%|██████████████████████████████▊                     | 5776/9741 [00:18<00:11, 340.74it/s] 60%|███████████████████████████████                     | 5811/9741 [00:18<00:11, 338.31it/s] 60%|███████████████████████████████▏                    | 5846/9741 [00:18<00:11, 339.30it/s] 60%|███████████████████████████████▍                    | 5880/9741 [00:18<00:11, 338.37it/s] 61%|███████████████████████████████▌                    | 5915/9741 [00:18<00:11, 339.80it/s] 61%|███████████████████████████████▊                    | 5950/9741 [00:18<00:11, 340.70it/s] 61%|███████████████████████████████▉                    | 5985/9741 [00:18<00:10, 341.46it/s] 62%|████████████████████████████████▏                   | 6020/9741 [00:18<00:10, 341.74it/s] 62%|████████████████████████████████▎                   | 6055/9741 [00:19<00:10, 342.32it/s] 63%|████████████████████████████████▌                   | 6090/9741 [00:19<00:10, 340.45it/s] 63%|████████████████████████████████▋                   | 6125/9741 [00:19<00:10, 341.18it/s] 63%|████████████████████████████████▉                   | 6160/9741 [00:19<00:10, 341.60it/s] 64%|█████████████████████████████████                   | 6195/9741 [00:19<00:10, 342.24it/s] 64%|█████████████████████████████████▎                  | 6230/9741 [00:19<00:10, 342.04it/s] 64%|█████████████████████████████████▍                  | 6265/9741 [00:19<00:10, 342.17it/s] 65%|█████████████████████████████████▋                  | 6300/9741 [00:19<00:10, 342.33it/s] 65%|█████████████████████████████████▊                  | 6335/9741 [00:19<00:10, 340.44it/s] 65%|██████████████████████████████████                  | 6370/9741 [00:19<00:09, 341.10it/s] 66%|██████████████████████████████████▏                 | 6405/9741 [00:20<00:09, 338.55it/s] 66%|██████████████████████████████████▍                 | 6440/9741 [00:20<00:09, 339.81it/s] 66%|██████████████████████████████████▌                 | 6475/9741 [00:20<00:09, 340.60it/s] 67%|██████████████████████████████████▊                 | 6510/9741 [00:20<00:09, 341.15it/s] 67%|██████████████████████████████████▉                 | 6545/9741 [00:20<00:09, 339.51it/s] 68%|███████████████████████████████████▏                | 6580/9741 [00:20<00:09, 340.30it/s] 68%|███████████████████████████████████▎                | 6615/9741 [00:20<00:09, 340.93it/s] 68%|███████████████████████████████████▍                | 6650/9741 [00:20<00:09, 341.61it/s] 69%|███████████████████████████████████▋                | 6685/9741 [00:20<00:08, 342.12it/s] 69%|███████████████████████████████████▊                | 6720/9741 [00:20<00:08, 341.15it/s] 69%|████████████████████████████████████                | 6755/9741 [00:21<00:08, 341.75it/s] 70%|████████████████████████████████████▏               | 6790/9741 [00:21<00:08, 339.94it/s] 70%|████████████████████████████████████▍               | 6825/9741 [00:21<00:08, 341.00it/s] 70%|████████████████████████████████████▌               | 6860/9741 [00:21<00:08, 341.77it/s] 71%|████████████████████████████████████▊               | 6895/9741 [00:21<00:08, 341.50it/s] 71%|████████████████████████████████████▉               | 6930/9741 [00:21<00:08, 342.08it/s] 72%|█████████████████████████████████████▏              | 6965/9741 [00:21<00:08, 342.39it/s] 72%|█████████████████████████████████████▎              | 7000/9741 [00:21<00:08, 337.16it/s] 72%|█████████████████████████████████████▌              | 7035/9741 [00:21<00:07, 338.80it/s] 73%|█████████████████████████████████████▋              | 7069/9741 [00:22<00:07, 339.13it/s] 73%|█████████████████████████████████████▉              | 7104/9741 [00:22<00:07, 339.69it/s] 73%|██████████████████████████████████████              | 7139/9741 [00:22<00:07, 340.65it/s] 74%|██████████████████████████████████████▎             | 7174/9741 [00:22<00:07, 341.22it/s] 74%|██████████████████████████████████████▍             | 7209/9741 [00:22<00:07, 341.67it/s] 74%|██████████████████████████████████████▋             | 7244/9741 [00:22<00:07, 339.59it/s] 75%|██████████████████████████████████████▊             | 7279/9741 [00:22<00:07, 340.50it/s] 75%|███████████████████████████████████████             | 7314/9741 [00:22<00:07, 341.34it/s] 75%|███████████████████████████████████████▏            | 7349/9741 [00:22<00:06, 341.83it/s] 76%|███████████████████████████████████████▍            | 7384/9741 [00:22<00:06, 342.33it/s] 76%|███████████████████████████████████████▌            | 7419/9741 [00:23<00:06, 342.51it/s] 77%|███████████████████████████████████████▊            | 7454/9741 [00:23<00:07, 314.46it/s] 77%|███████████████████████████████████████▉            | 7489/9741 [00:23<00:06, 322.28it/s] 77%|████████████████████████████████████████▏           | 7524/9741 [00:23<00:06, 328.00it/s] 78%|████████████████████████████████████████▎           | 7558/9741 [00:23<00:06, 328.77it/s] 78%|████████████████████████████████████████▌           | 7593/9741 [00:23<00:06, 332.22it/s] 78%|████████████████████████████████████████▋           | 7628/9741 [00:23<00:06, 335.38it/s] 79%|████████████████████████████████████████▉           | 7663/9741 [00:23<00:06, 337.18it/s] 79%|█████████████████████████████████████████           | 7697/9741 [00:23<00:06, 335.63it/s] 79%|█████████████████████████████████████████▎          | 7732/9741 [00:23<00:05, 338.24it/s] 80%|█████████████████████████████████████████▍          | 7767/9741 [00:24<00:05, 339.66it/s] 80%|█████████████████████████████████████████▋          | 7802/9741 [00:24<00:05, 340.29it/s] 80%|█████████████████████████████████████████▊          | 7837/9741 [00:24<00:05, 340.80it/s] 81%|██████████████████████████████████████████          | 7872/9741 [00:24<00:05, 341.19it/s] 81%|██████████████████████████████████████████▏         | 7907/9741 [00:24<00:05, 339.80it/s] 82%|██████████████████████████████████████████▍         | 7942/9741 [00:24<00:05, 340.62it/s] 82%|██████████████████████████████████████████▌         | 7977/9741 [00:24<00:05, 341.30it/s] 82%|██████████████████████████████████████████▊         | 8012/9741 [00:24<00:05, 341.66it/s] 83%|██████████████████████████████████████████▉         | 8047/9741 [00:24<00:04, 341.80it/s] 83%|███████████████████████████████████████████▏        | 8082/9741 [00:24<00:04, 341.80it/s] 83%|███████████████████████████████████████████▎        | 8117/9741 [00:25<00:04, 338.46it/s] 84%|███████████████████████████████████████████▌        | 8151/9741 [00:25<00:04, 337.34it/s] 84%|███████████████████████████████████████████▋        | 8185/9741 [00:25<00:04, 337.98it/s] 84%|███████████████████████████████████████████▉        | 8220/9741 [00:25<00:04, 338.73it/s] 85%|████████████████████████████████████████████        | 8255/9741 [00:25<00:04, 339.90it/s] 85%|████████████████████████████████████████████▎       | 8290/9741 [00:25<00:04, 340.49it/s] 85%|████████████████████████████████████████████▍       | 8325/9741 [00:25<00:04, 340.87it/s] 86%|████████████████████████████████████████████▋       | 8360/9741 [00:25<00:04, 339.43it/s] 86%|████████████████████████████████████████████▊       | 8395/9741 [00:25<00:03, 340.28it/s] 87%|█████████████████████████████████████████████       | 8430/9741 [00:26<00:03, 341.14it/s] 87%|█████████████████████████████████████████████▏      | 8465/9741 [00:26<00:03, 341.62it/s] 87%|█████████████████████████████████████████████▍      | 8500/9741 [00:26<00:03, 341.85it/s] 88%|█████████████████████████████████████████████▌      | 8535/9741 [00:26<00:03, 341.47it/s] 88%|█████████████████████████████████████████████▋      | 8570/9741 [00:26<00:03, 341.25it/s] 88%|█████████████████████████████████████████████▉      | 8605/9741 [00:26<00:03, 339.33it/s] 89%|██████████████████████████████████████████████      | 8640/9741 [00:26<00:03, 339.98it/s] 89%|██████████████████████████████████████████████▎     | 8675/9741 [00:26<00:03, 340.63it/s] 89%|██████████████████████████████████████████████▍     | 8710/9741 [00:26<00:03, 341.03it/s] 90%|██████████████████████████████████████████████▋     | 8745/9741 [00:26<00:02, 341.35it/s] 90%|██████████████████████████████████████████████▊     | 8780/9741 [00:27<00:02, 341.59it/s] 90%|███████████████████████████████████████████████     | 8815/9741 [00:27<00:02, 339.65it/s] 91%|███████████████████████████████████████████████▏    | 8850/9741 [00:27<00:02, 340.40it/s] 91%|███████████████████████████████████████████████▍    | 8885/9741 [00:27<00:02, 341.05it/s] 92%|███████████████████████████████████████████████▌    | 8920/9741 [00:27<00:02, 341.24it/s] 92%|███████████████████████████████████████████████▊    | 8955/9741 [00:27<00:02, 341.55it/s] 92%|███████████████████████████████████████████████▉    | 8990/9741 [00:27<00:02, 341.65it/s] 93%|████████████████████████████████████████████████▏   | 9025/9741 [00:27<00:02, 341.74it/s] 93%|████████████████████████████████████████████████▎   | 9060/9741 [00:27<00:02, 339.74it/s] 93%|████████████████████████████████████████████████▌   | 9095/9741 [00:27<00:01, 340.56it/s] 94%|████████████████████████████████████████████████▋   | 9130/9741 [00:28<00:01, 341.22it/s] 94%|████████████████████████████████████████████████▉   | 9165/9741 [00:28<00:01, 341.47it/s] 94%|█████████████████████████████████████████████████   | 9200/9741 [00:28<00:01, 341.89it/s] 95%|█████████████████████████████████████████████████▎  | 9235/9741 [00:28<00:01, 341.96it/s] 95%|█████████████████████████████████████████████████▍  | 9270/9741 [00:28<00:01, 340.14it/s] 96%|█████████████████████████████████████████████████▋  | 9305/9741 [00:28<00:01, 340.58it/s] 96%|█████████████████████████████████████████████████▊  | 9340/9741 [00:28<00:01, 339.38it/s] 96%|██████████████████████████████████████████████████  | 9375/9741 [00:28<00:01, 339.88it/s] 97%|██████████████████████████████████████████████████▏ | 9409/9741 [00:28<00:00, 338.22it/s] 97%|██████████████████████████████████████████████████▍ | 9444/9741 [00:29<00:00, 339.23it/s] 97%|██████████████████████████████████████████████████▌ | 9479/9741 [00:29<00:00, 340.07it/s] 98%|██████████████████████████████████████████████████▊ | 9514/9741 [00:29<00:00, 338.74it/s] 98%|██████████████████████████████████████████████████▉ | 9549/9741 [00:29<00:00, 339.86it/s] 98%|███████████████████████████████████████████████████▏| 9584/9741 [00:29<00:00, 340.51it/s] 99%|███████████████████████████████████████████████████▎| 9619/9741 [00:29<00:00, 340.88it/s] 99%|███████████████████████████████████████████████████▌| 9654/9741 [00:29<00:00, 341.11it/s] 99%|███████████████████████████████████████████████████▋| 9689/9741 [00:29<00:00, 341.46it/s]100%|███████████████████████████████████████████████████▉| 9724/9741 [00:29<00:00, 339.19it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:29<00:00, 326.05it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.94s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.70s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.94s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.06s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.27s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.87s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.34s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.64s/it]
[2023-08-21 17:22:58,901] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.49s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.57s/it]
[2023-08-21 17:23:13,074] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 17:23:13,075] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 17:23:13,075] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 17:23:13,075] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 17:23:13,075] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 17:23:13,075] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f780b616fd0>
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 17:23:13,076] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f7807fae220>
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 17:23:13,077] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 17:23:13,078] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 17:23:13,078] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 17:23:13,078] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 17:23:13,078] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5602657794952393 seconds
Loading extension module utils...
Time to load utils op: 0.5045907497406006 seconds
Loading extension module utils...
Time to load utils op: 0.504478931427002 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input: Tonya has $150.00 on her credit card.  If she leaves any balance on her card at the end of the month, she is charged 20% interest.  If she makes a $50.00 payment on her card, what will be the new balance?
Output: 120

Input: In her first term, Governor Sandoval gave twice as many commencement addresses as Governor Hawkins. Governor Sloan gave ten more commencement addresses than Governor Sandoval in the same amount of time. If Governor Sandoval gave 12 commencement addresses, how many commencement addresses did the three of them give altogether?
Output: 40

Input: If Buzz bought a pizza with 78 slices at a restaurant and then decided to share it with the waiter in the ratio of 5:8, with Buzz's ratio being 5, what's twenty less the number of slices of pizza that the waiter ate?
Output: 28

Input: Jolene and Phil have four children, each with the same birthday.  They gave birth to their first child exactly 15 years ago.  They gave birth to their second child exactly one year after the birth of their first child.  They gave birth to their third child on the fourth birthday of their second child. Two years after the birth of their third child, they gave birth to their fourth child.  How old, in years, is their fourth child?
Output: 8

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o19-tgsm8k-s1-rFalse
Time to load utils op: 0.5047531127929688 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:40<32:44, 40.10s/it]Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:42<34:39, 42.45s/it]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 3334693 closing signal SIGTERM
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 3334694 closing signal SIGTERM
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 3334695 closing signal SIGTERM
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3334692) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
  <NO_OTHER_FAILURES>
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_17:24:00
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3334692)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o20-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 20
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 17:24:04,663] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o20-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 20
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o20-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 22/9741 [00:00<00:46, 210.84it/s]  0%|▏                                                     | 44/9741 [00:00<00:45, 211.16it/s]  1%|▎                                                     | 66/9741 [00:00<00:45, 211.15it/s]  1%|▍                                                     | 88/9741 [00:00<00:45, 211.55it/s]  1%|▌                                                    | 110/9741 [00:00<00:45, 211.89it/s]  1%|▋                                                    | 132/9741 [00:00<00:45, 211.96it/s]  2%|▊                                                    | 154/9741 [00:00<00:45, 208.94it/s]  2%|▉                                                    | 176/9741 [00:00<00:45, 209.58it/s]  2%|█                                                    | 198/9741 [00:00<00:45, 210.18it/s]  2%|█▏                                                   | 220/9741 [00:01<00:45, 208.91it/s]  2%|█▎                                                   | 242/9741 [00:01<00:45, 209.54it/s]  3%|█▍                                                   | 264/9741 [00:01<00:45, 210.12it/s]  3%|█▌                                                   | 286/9741 [00:01<00:44, 210.47it/s]  3%|█▋                                                   | 308/9741 [00:01<00:44, 210.88it/s]  3%|█▊                                                   | 330/9741 [00:01<00:44, 211.00it/s]  4%|█▉                                                   | 352/9741 [00:01<00:44, 211.01it/s]  4%|██                                                   | 374/9741 [00:01<00:44, 208.54it/s]  4%|██▏                                                  | 396/9741 [00:01<00:44, 209.55it/s]  4%|██▎                                                  | 418/9741 [00:01<00:44, 209.90it/s]  5%|██▍                                                  | 443/9741 [00:02<00:42, 221.22it/s]  5%|██▌                                                  | 476/9741 [00:02<00:36, 251.27it/s]  5%|██▊                                                  | 509/9741 [00:02<00:33, 272.51it/s]  6%|██▉                                                  | 542/9741 [00:02<00:32, 287.42it/s]  6%|███▏                                                 | 575/9741 [00:02<00:30, 297.34it/s]  6%|███▎                                                 | 608/9741 [00:02<00:29, 304.49it/s]  7%|███▍                                                 | 640/9741 [00:02<00:29, 308.76it/s]  7%|███▋                                                 | 672/9741 [00:02<00:29, 310.29it/s]  7%|███▊                                                 | 705/9741 [00:02<00:28, 313.53it/s]  8%|████                                                 | 738/9741 [00:03<00:28, 315.62it/s]  8%|████▏                                                | 771/9741 [00:03<00:28, 317.31it/s]  8%|████▎                                                | 804/9741 [00:03<00:28, 318.51it/s]  9%|████▌                                                | 837/9741 [00:03<00:27, 319.43it/s]  9%|████▋                                                | 870/9741 [00:03<00:27, 320.05it/s]  9%|████▉                                                | 903/9741 [00:03<00:27, 317.99it/s] 10%|█████                                                | 935/9741 [00:03<00:27, 318.34it/s] 10%|█████▎                                               | 968/9741 [00:03<00:27, 318.83it/s] 10%|█████▎                                              | 1000/9741 [00:03<00:27, 318.93it/s] 11%|█████▌                                              | 1033/9741 [00:03<00:27, 319.68it/s] 11%|█████▋                                              | 1065/9741 [00:04<00:27, 319.40it/s] 11%|█████▊                                              | 1098/9741 [00:04<00:27, 319.64it/s] 12%|██████                                              | 1130/9741 [00:04<00:27, 317.77it/s] 12%|██████▏                                             | 1163/9741 [00:04<00:26, 318.54it/s] 12%|██████▍                                             | 1195/9741 [00:04<00:26, 318.72it/s] 13%|██████▌                                             | 1228/9741 [00:04<00:26, 319.13it/s] 13%|██████▋                                             | 1261/9741 [00:04<00:26, 319.53it/s] 13%|██████▉                                             | 1294/9741 [00:04<00:26, 319.88it/s] 14%|███████                                             | 1326/9741 [00:04<00:26, 318.03it/s] 14%|███████▏                                            | 1358/9741 [00:04<00:26, 316.73it/s] 14%|███████▍                                            | 1390/9741 [00:05<00:26, 317.53it/s] 15%|███████▌                                            | 1422/9741 [00:05<00:26, 317.63it/s] 15%|███████▊                                            | 1454/9741 [00:05<00:26, 317.70it/s] 15%|███████▉                                            | 1486/9741 [00:05<00:26, 315.87it/s] 16%|████████                                            | 1518/9741 [00:05<00:25, 316.89it/s] 16%|████████▎                                           | 1550/9741 [00:05<00:25, 317.81it/s] 16%|████████▍                                           | 1582/9741 [00:05<00:25, 316.19it/s] 17%|████████▌                                           | 1614/9741 [00:05<00:25, 317.30it/s] 17%|████████▊                                           | 1647/9741 [00:05<00:25, 318.39it/s] 17%|████████▉                                           | 1680/9741 [00:05<00:25, 318.92it/s] 18%|█████████▏                                          | 1713/9741 [00:06<00:25, 319.32it/s] 18%|█████████▎                                          | 1746/9741 [00:06<00:25, 319.68it/s] 18%|█████████▍                                          | 1779/9741 [00:06<00:24, 319.87it/s] 19%|█████████▋                                          | 1811/9741 [00:06<00:26, 298.61it/s] 19%|█████████▊                                          | 1843/9741 [00:06<00:25, 304.45it/s] 19%|██████████                                          | 1875/9741 [00:06<00:25, 308.66it/s] 20%|██████████▏                                         | 1907/9741 [00:06<00:25, 309.16it/s] 20%|██████████▎                                         | 1939/9741 [00:06<00:24, 312.12it/s] 20%|██████████▌                                         | 1971/9741 [00:06<00:24, 314.07it/s] 21%|██████████▋                                         | 2003/9741 [00:07<00:24, 314.89it/s] 21%|██████████▊                                         | 2035/9741 [00:07<00:24, 311.61it/s] 21%|███████████                                         | 2067/9741 [00:07<00:24, 313.70it/s] 22%|███████████▏                                        | 2099/9741 [00:07<00:24, 314.79it/s] 22%|███████████▍                                        | 2131/9741 [00:07<00:24, 316.16it/s] 22%|███████████▌                                        | 2163/9741 [00:07<00:23, 317.19it/s] 23%|███████████▋                                        | 2195/9741 [00:07<00:23, 317.83it/s] 23%|███████████▉                                        | 2227/9741 [00:07<00:23, 318.00it/s] 23%|████████████                                        | 2259/9741 [00:07<00:23, 316.00it/s] 24%|████████████▏                                       | 2291/9741 [00:07<00:23, 314.97it/s] 24%|████████████▍                                       | 2323/9741 [00:08<00:23, 314.93it/s] 24%|████████████▌                                       | 2355/9741 [00:08<00:23, 315.39it/s] 25%|████████████▋                                       | 2387/9741 [00:08<00:23, 315.77it/s] 25%|████████████▉                                       | 2419/9741 [00:08<00:23, 315.98it/s] 25%|█████████████                                       | 2451/9741 [00:08<00:23, 315.97it/s] 25%|█████████████▎                                      | 2483/9741 [00:08<00:23, 313.78it/s] 26%|█████████████▍                                      | 2515/9741 [00:08<00:22, 314.48it/s] 26%|█████████████▌                                      | 2547/9741 [00:08<00:22, 314.61it/s] 26%|█████████████▊                                      | 2579/9741 [00:08<00:22, 316.18it/s] 27%|█████████████▉                                      | 2612/9741 [00:08<00:22, 317.39it/s] 27%|██████████████                                      | 2644/9741 [00:09<00:22, 317.70it/s] 27%|██████████████▎                                     | 2676/9741 [00:09<00:22, 318.18it/s] 28%|██████████████▍                                     | 2708/9741 [00:09<00:22, 316.13it/s] 28%|██████████████▋                                     | 2740/9741 [00:09<00:22, 316.47it/s] 28%|██████████████▊                                     | 2772/9741 [00:09<00:21, 316.85it/s] 29%|██████████████▉                                     | 2804/9741 [00:09<00:21, 317.05it/s] 29%|███████████████▏                                    | 2836/9741 [00:09<00:21, 317.48it/s] 29%|███████████████▎                                    | 2868/9741 [00:09<00:21, 318.07it/s] 30%|███████████████▍                                    | 2900/9741 [00:09<00:21, 318.20it/s] 30%|███████████████▋                                    | 2932/9741 [00:09<00:21, 316.41it/s] 30%|███████████████▊                                    | 2964/9741 [00:10<00:21, 315.91it/s] 31%|███████████████▉                                    | 2996/9741 [00:10<00:21, 317.05it/s] 31%|████████████████▏                                   | 3028/9741 [00:10<00:21, 317.56it/s] 31%|████████████████▎                                   | 3060/9741 [00:10<00:21, 317.85it/s] 32%|████████████████▌                                   | 3092/9741 [00:10<00:20, 318.23it/s] 32%|████████████████▋                                   | 3124/9741 [00:10<00:20, 318.61it/s] 32%|████████████████▊                                   | 3156/9741 [00:10<00:20, 316.57it/s] 33%|█████████████████                                   | 3189/9741 [00:10<00:20, 317.59it/s] 33%|█████████████████▏                                  | 3221/9741 [00:10<00:20, 317.97it/s] 33%|█████████████████▎                                  | 3254/9741 [00:10<00:20, 318.65it/s] 34%|█████████████████▌                                  | 3286/9741 [00:11<00:20, 318.75it/s] 34%|█████████████████▋                                  | 3318/9741 [00:11<00:20, 319.03it/s] 34%|█████████████████▉                                  | 3350/9741 [00:11<00:20, 318.90it/s] 35%|██████████████████                                  | 3382/9741 [00:11<00:20, 316.45it/s] 35%|██████████████████▏                                 | 3414/9741 [00:11<00:19, 317.16it/s] 35%|██████████████████▍                                 | 3446/9741 [00:11<00:19, 317.45it/s] 36%|██████████████████▌                                 | 3478/9741 [00:11<00:19, 317.78it/s] 36%|██████████████████▋                                 | 3510/9741 [00:11<00:19, 317.53it/s] 36%|██████████████████▉                                 | 3542/9741 [00:11<00:19, 317.86it/s] 37%|███████████████████                                 | 3574/9741 [00:11<00:19, 317.82it/s] 37%|███████████████████▏                                | 3606/9741 [00:12<00:19, 315.72it/s] 37%|███████████████████▍                                | 3638/9741 [00:12<00:19, 316.61it/s] 38%|███████████████████▌                                | 3670/9741 [00:12<00:19, 317.03it/s] 38%|███████████████████▊                                | 3702/9741 [00:12<00:19, 317.66it/s] 38%|███████████████████▉                                | 3734/9741 [00:12<00:18, 318.22it/s] 39%|████████████████████                                | 3766/9741 [00:12<00:18, 318.33it/s] 39%|████████████████████▎                               | 3798/9741 [00:12<00:18, 318.38it/s] 39%|████████████████████▍                               | 3830/9741 [00:12<00:18, 318.59it/s] 40%|████████████████████▌                               | 3862/9741 [00:12<00:18, 316.65it/s] 40%|████████████████████▊                               | 3894/9741 [00:12<00:18, 317.43it/s] 40%|████████████████████▉                               | 3926/9741 [00:13<00:18, 316.54it/s] 41%|█████████████████████▏                              | 3958/9741 [00:13<00:18, 315.66it/s] 41%|█████████████████████▎                              | 3990/9741 [00:13<00:18, 315.17it/s] 41%|█████████████████████▍                              | 4022/9741 [00:13<00:18, 314.87it/s] 42%|█████████████████████▋                              | 4054/9741 [00:13<00:18, 315.34it/s] 42%|█████████████████████▊                              | 4086/9741 [00:13<00:18, 313.49it/s] 42%|█████████████████████▉                              | 4118/9741 [00:13<00:17, 314.68it/s] 43%|██████████████████████▏                             | 4150/9741 [00:13<00:17, 315.45it/s] 43%|██████████████████████▎                             | 4182/9741 [00:13<00:17, 315.89it/s] 43%|██████████████████████▍                             | 4214/9741 [00:13<00:17, 316.38it/s] 44%|██████████████████████▋                             | 4246/9741 [00:14<00:17, 316.87it/s] 44%|██████████████████████▊                             | 4278/9741 [00:14<00:17, 317.35it/s] 44%|███████████████████████                             | 4310/9741 [00:14<00:17, 315.55it/s] 45%|███████████████████████▏                            | 4342/9741 [00:14<00:17, 316.34it/s] 45%|███████████████████████▎                            | 4374/9741 [00:14<00:16, 316.77it/s] 45%|███████████████████████▌                            | 4406/9741 [00:14<00:16, 316.82it/s] 46%|███████████████████████▋                            | 4438/9741 [00:14<00:16, 315.41it/s] 46%|███████████████████████▊                            | 4470/9741 [00:14<00:16, 316.11it/s] 46%|████████████████████████                            | 4502/9741 [00:14<00:16, 316.72it/s] 47%|████████████████████████▏                           | 4534/9741 [00:15<00:17, 291.23it/s] 47%|████████████████████████▎                           | 4566/9741 [00:15<00:17, 298.51it/s] 47%|████████████████████████▌                           | 4598/9741 [00:15<00:16, 304.28it/s] 48%|████████████████████████▋                           | 4630/9741 [00:15<00:16, 308.47it/s] 48%|████████████████████████▉                           | 4662/9741 [00:15<00:16, 311.50it/s] 48%|█████████████████████████                           | 4694/9741 [00:15<00:16, 313.63it/s] 49%|█████████████████████████▏                          | 4726/9741 [00:15<00:15, 314.72it/s] 49%|█████████████████████████▍                          | 4758/9741 [00:15<00:23, 212.58it/s] 49%|█████████████████████████▌                          | 4790/9741 [00:15<00:20, 236.04it/s] 50%|█████████████████████████▋                          | 4822/9741 [00:16<00:19, 255.81it/s] 50%|█████████████████████████▉                          | 4854/9741 [00:16<00:17, 271.61it/s] 50%|██████████████████████████                          | 4886/9741 [00:16<00:17, 283.91it/s] 50%|██████████████████████████▎                         | 4918/9741 [00:16<00:16, 292.71it/s] 51%|██████████████████████████▍                         | 4950/9741 [00:16<00:16, 298.30it/s] 51%|██████████████████████████▌                         | 4982/9741 [00:16<00:15, 304.03it/s] 51%|██████████████████████████▊                         | 5014/9741 [00:16<00:15, 308.13it/s] 52%|██████████████████████████▉                         | 5046/9741 [00:16<00:15, 311.26it/s] 52%|███████████████████████████                         | 5078/9741 [00:16<00:14, 312.75it/s] 52%|███████████████████████████▎                        | 5110/9741 [00:17<00:14, 313.18it/s] 53%|███████████████████████████▍                        | 5142/9741 [00:17<00:14, 313.23it/s] 53%|███████████████████████████▌                        | 5174/9741 [00:17<00:14, 312.33it/s] 53%|███████████████████████████▊                        | 5206/9741 [00:17<00:14, 313.90it/s] 54%|███████████████████████████▉                        | 5238/9741 [00:17<00:14, 314.69it/s] 54%|████████████████████████████▏                       | 5270/9741 [00:17<00:14, 315.68it/s] 54%|████████████████████████████▎                       | 5302/9741 [00:17<00:14, 316.53it/s] 55%|████████████████████████████▍                       | 5334/9741 [00:17<00:13, 316.89it/s] 55%|████████████████████████████▋                       | 5366/9741 [00:17<00:13, 317.39it/s] 55%|████████████████████████████▊                       | 5398/9741 [00:17<00:13, 315.30it/s] 56%|████████████████████████████▉                       | 5430/9741 [00:18<00:13, 315.96it/s] 56%|█████████████████████████████▏                      | 5462/9741 [00:18<00:13, 313.71it/s] 56%|█████████████████████████████▎                      | 5495/9741 [00:18<00:13, 317.19it/s] 57%|█████████████████████████████▌                      | 5528/9741 [00:18<00:13, 320.57it/s] 57%|█████████████████████████████▋                      | 5561/9741 [00:18<00:12, 322.93it/s] 57%|█████████████████████████████▊                      | 5594/9741 [00:18<00:12, 324.03it/s] 58%|██████████████████████████████                      | 5627/9741 [00:18<00:12, 323.18it/s] 58%|██████████████████████████████▏                     | 5660/9741 [00:18<00:12, 324.60it/s] 58%|██████████████████████████████▍                     | 5693/9741 [00:18<00:12, 325.70it/s] 59%|██████████████████████████████▌                     | 5726/9741 [00:18<00:12, 326.55it/s] 59%|██████████████████████████████▋                     | 5759/9741 [00:19<00:12, 327.12it/s] 59%|██████████████████████████████▉                     | 5792/9741 [00:19<00:12, 327.47it/s] 60%|███████████████████████████████                     | 5825/9741 [00:19<00:11, 327.74it/s] 60%|███████████████████████████████▎                    | 5858/9741 [00:19<00:11, 325.52it/s] 60%|███████████████████████████████▍                    | 5891/9741 [00:19<00:11, 326.16it/s] 61%|███████████████████████████████▌                    | 5924/9741 [00:19<00:11, 326.74it/s] 61%|███████████████████████████████▊                    | 5957/9741 [00:19<00:11, 327.19it/s] 61%|███████████████████████████████▉                    | 5990/9741 [00:19<00:11, 327.32it/s] 62%|████████████████████████████████▏                   | 6023/9741 [00:19<00:11, 324.49it/s] 62%|████████████████████████████████▎                   | 6056/9741 [00:19<00:11, 325.54it/s] 63%|████████████████████████████████▌                   | 6089/9741 [00:20<00:11, 323.51it/s] 63%|████████████████████████████████▋                   | 6122/9741 [00:20<00:11, 324.65it/s] 63%|████████████████████████████████▊                   | 6155/9741 [00:20<00:11, 325.42it/s] 64%|█████████████████████████████████                   | 6188/9741 [00:20<00:10, 326.24it/s] 64%|█████████████████████████████████▏                  | 6221/9741 [00:20<00:10, 326.85it/s] 64%|█████████████████████████████████▍                  | 6254/9741 [00:20<00:10, 326.82it/s] 65%|█████████████████████████████████▌                  | 6287/9741 [00:20<00:10, 327.23it/s] 65%|█████████████████████████████████▋                  | 6320/9741 [00:20<00:10, 325.17it/s] 65%|█████████████████████████████████▉                  | 6353/9741 [00:20<00:10, 325.95it/s] 66%|██████████████████████████████████                  | 6386/9741 [00:20<00:10, 326.61it/s] 66%|██████████████████████████████████▎                 | 6419/9741 [00:21<00:10, 326.96it/s] 66%|██████████████████████████████████▍                 | 6452/9741 [00:21<00:10, 327.23it/s] 67%|██████████████████████████████████▌                 | 6485/9741 [00:21<00:09, 327.17it/s] 67%|██████████████████████████████████▊                 | 6518/9741 [00:21<00:09, 327.22it/s] 67%|██████████████████████████████████▉                 | 6551/9741 [00:21<00:09, 325.23it/s] 68%|███████████████████████████████████▏                | 6584/9741 [00:21<00:09, 322.41it/s] 68%|███████████████████████████████████▎                | 6617/9741 [00:21<00:09, 323.81it/s] 68%|███████████████████████████████████▍                | 6650/9741 [00:21<00:09, 325.01it/s] 69%|███████████████████████████████████▋                | 6683/9741 [00:21<00:09, 325.97it/s] 69%|███████████████████████████████████▊                | 6716/9741 [00:21<00:09, 326.49it/s] 69%|████████████████████████████████████                | 6749/9741 [00:22<00:09, 326.92it/s] 70%|████████████████████████████████████▏               | 6782/9741 [00:22<00:09, 325.17it/s] 70%|████████████████████████████████████▍               | 6815/9741 [00:22<00:08, 325.88it/s] 70%|████████████████████████████████████▌               | 6848/9741 [00:22<00:08, 326.51it/s] 71%|████████████████████████████████████▋               | 6881/9741 [00:22<00:08, 326.98it/s] 71%|████████████████████████████████████▉               | 6914/9741 [00:22<00:08, 327.25it/s] 71%|█████████████████████████████████████               | 6947/9741 [00:22<00:08, 327.60it/s] 72%|█████████████████████████████████████▎              | 6980/9741 [00:22<00:08, 327.47it/s] 72%|█████████████████████████████████████▍              | 7013/9741 [00:22<00:08, 325.31it/s] 72%|█████████████████████████████████████▌              | 7046/9741 [00:22<00:08, 326.16it/s] 73%|█████████████████████████████████████▊              | 7079/9741 [00:23<00:08, 326.73it/s] 73%|█████████████████████████████████████▉              | 7112/9741 [00:23<00:08, 327.18it/s] 73%|██████████████████████████████████████▏             | 7145/9741 [00:23<00:07, 324.75it/s] 74%|██████████████████████████████████████▎             | 7178/9741 [00:23<00:07, 325.46it/s] 74%|██████████████████████████████████████▍             | 7211/9741 [00:23<00:07, 322.81it/s] 74%|██████████████████████████████████████▋             | 7244/9741 [00:23<00:07, 324.13it/s] 75%|██████████████████████████████████████▊             | 7277/9741 [00:23<00:07, 325.09it/s] 75%|███████████████████████████████████████             | 7310/9741 [00:23<00:07, 326.00it/s] 75%|███████████████████████████████████████▏            | 7343/9741 [00:23<00:07, 326.64it/s] 76%|███████████████████████████████████████▍            | 7376/9741 [00:23<00:07, 327.34it/s] 76%|███████████████████████████████████████▌            | 7409/9741 [00:24<00:07, 327.12it/s] 76%|███████████████████████████████████████▋            | 7442/9741 [00:24<00:08, 286.18it/s] 77%|███████████████████████████████████████▉            | 7475/9741 [00:24<00:07, 297.34it/s] 77%|████████████████████████████████████████            | 7508/9741 [00:24<00:07, 305.61it/s] 77%|████████████████████████████████████████▎           | 7541/9741 [00:24<00:07, 311.86it/s] 78%|████████████████████████████████████████▍           | 7574/9741 [00:24<00:06, 316.53it/s] 78%|████████████████████████████████████████▌           | 7607/9741 [00:24<00:06, 319.83it/s] 78%|████████████████████████████████████████▊           | 7640/9741 [00:24<00:06, 321.77it/s] 79%|████████████████████████████████████████▉           | 7673/9741 [00:24<00:06, 317.75it/s] 79%|█████████████████████████████████████████▏          | 7706/9741 [00:25<00:06, 320.29it/s] 79%|█████████████████████████████████████████▎          | 7739/9741 [00:25<00:06, 322.48it/s] 80%|█████████████████████████████████████████▍          | 7772/9741 [00:25<00:06, 323.93it/s] 80%|█████████████████████████████████████████▋          | 7805/9741 [00:25<00:05, 324.97it/s] 80%|█████████████████████████████████████████▊          | 7838/9741 [00:25<00:05, 325.88it/s] 81%|██████████████████████████████████████████          | 7871/9741 [00:25<00:05, 326.40it/s] 81%|██████████████████████████████████████████▏         | 7904/9741 [00:25<00:05, 324.79it/s] 81%|██████████████████████████████████████████▎         | 7937/9741 [00:25<00:05, 325.59it/s] 82%|██████████████████████████████████████████▌         | 7970/9741 [00:25<00:05, 326.25it/s] 82%|██████████████████████████████████████████▋         | 8003/9741 [00:25<00:05, 326.59it/s] 82%|██████████████████████████████████████████▉         | 8036/9741 [00:26<00:05, 326.76it/s] 83%|███████████████████████████████████████████         | 8069/9741 [00:26<00:05, 326.76it/s] 83%|███████████████████████████████████████████▎        | 8102/9741 [00:26<00:05, 327.26it/s] 84%|███████████████████████████████████████████▍        | 8135/9741 [00:26<00:04, 325.35it/s] 84%|███████████████████████████████████████████▌        | 8168/9741 [00:26<00:04, 326.09it/s] 84%|███████████████████████████████████████████▊        | 8201/9741 [00:26<00:04, 326.59it/s] 85%|███████████████████████████████████████████▉        | 8234/9741 [00:26<00:04, 325.74it/s] 85%|████████████████████████████████████████████▏       | 8267/9741 [00:26<00:04, 326.31it/s] 85%|████████████████████████████████████████████▎       | 8300/9741 [00:26<00:04, 326.32it/s] 86%|████████████████████████████████████████████▍       | 8333/9741 [00:26<00:04, 326.23it/s] 86%|████████████████████████████████████████████▋       | 8366/9741 [00:27<00:04, 324.41it/s] 86%|████████████████████████████████████████████▊       | 8399/9741 [00:27<00:04, 325.16it/s] 87%|█████████████████████████████████████████████       | 8432/9741 [00:27<00:04, 326.15it/s] 87%|█████████████████████████████████████████████▏      | 8465/9741 [00:27<00:03, 326.44it/s] 87%|█████████████████████████████████████████████▎      | 8498/9741 [00:27<00:03, 326.63it/s] 88%|█████████████████████████████████████████████▌      | 8531/9741 [00:27<00:03, 326.68it/s] 88%|█████████████████████████████████████████████▋      | 8564/9741 [00:27<00:03, 326.70it/s] 88%|█████████████████████████████████████████████▉      | 8597/9741 [00:27<00:03, 324.97it/s] 89%|██████████████████████████████████████████████      | 8630/9741 [00:27<00:03, 325.44it/s] 89%|██████████████████████████████████████████████▏     | 8663/9741 [00:27<00:03, 325.98it/s] 89%|██████████████████████████████████████████████▍     | 8696/9741 [00:28<00:03, 326.43it/s] 90%|██████████████████████████████████████████████▌     | 8729/9741 [00:28<00:03, 326.69it/s] 90%|██████████████████████████████████████████████▊     | 8762/9741 [00:28<00:02, 326.74it/s] 90%|██████████████████████████████████████████████▉     | 8795/9741 [00:28<00:02, 326.64it/s] 91%|███████████████████████████████████████████████▏    | 8828/9741 [00:28<00:02, 324.82it/s] 91%|███████████████████████████████████████████████▎    | 8861/9741 [00:28<00:02, 325.47it/s] 91%|███████████████████████████████████████████████▍    | 8894/9741 [00:28<00:02, 324.32it/s] 92%|███████████████████████████████████████████████▋    | 8927/9741 [00:28<00:02, 325.34it/s] 92%|███████████████████████████████████████████████▊    | 8960/9741 [00:28<00:02, 326.06it/s] 92%|████████████████████████████████████████████████    | 8993/9741 [00:28<00:02, 326.35it/s] 93%|████████████████████████████████████████████████▏   | 9026/9741 [00:29<00:02, 326.48it/s] 93%|████████████████████████████████████████████████▎   | 9059/9741 [00:29<00:02, 324.54it/s] 93%|████████████████████████████████████████████████▌   | 9092/9741 [00:29<00:01, 325.35it/s] 94%|████████████████████████████████████████████████▋   | 9125/9741 [00:29<00:01, 325.94it/s] 94%|████████████████████████████████████████████████▉   | 9158/9741 [00:29<00:01, 326.36it/s] 94%|█████████████████████████████████████████████████   | 9191/9741 [00:29<00:01, 326.14it/s] 95%|█████████████████████████████████████████████████▏  | 9224/9741 [00:29<00:01, 326.29it/s] 95%|█████████████████████████████████████████████████▍  | 9257/9741 [00:29<00:01, 324.63it/s] 95%|█████████████████████████████████████████████████▌  | 9290/9741 [00:29<00:01, 325.59it/s] 96%|█████████████████████████████████████████████████▊  | 9323/9741 [00:30<00:01, 325.97it/s] 96%|█████████████████████████████████████████████████▉  | 9356/9741 [00:30<00:01, 326.19it/s] 96%|██████████████████████████████████████████████████  | 9389/9741 [00:30<00:01, 326.11it/s] 97%|██████████████████████████████████████████████████▎ | 9422/9741 [00:30<00:00, 326.28it/s] 97%|██████████████████████████████████████████████████▍ | 9455/9741 [00:30<00:00, 326.44it/s] 97%|██████████████████████████████████████████████████▋ | 9488/9741 [00:30<00:00, 324.61it/s] 98%|██████████████████████████████████████████████████▊ | 9521/9741 [00:30<00:00, 325.34it/s] 98%|███████████████████████████████████████████████████ | 9554/9741 [00:30<00:00, 325.79it/s] 98%|███████████████████████████████████████████████████▏| 9587/9741 [00:30<00:00, 326.13it/s] 99%|███████████████████████████████████████████████████▎| 9620/9741 [00:30<00:00, 326.53it/s] 99%|███████████████████████████████████████████████████▌| 9653/9741 [00:31<00:00, 326.32it/s] 99%|███████████████████████████████████████████████████▋| 9686/9741 [00:31<00:00, 326.17it/s]100%|███████████████████████████████████████████████████▉| 9719/9741 [00:31<00:00, 323.49it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:31<00:00, 311.24it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.09s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.10s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.11s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.67s/it]
[2023-08-21 17:25:27,704] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.11s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.17s/it]
[2023-08-21 17:25:43,620] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 17:25:43,621] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7ff2056adfd0>
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 17:25:43,622] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7ff1fcbb2220>
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 17:25:43,623] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 17:25:43,624] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 17:25:43,624] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 17:25:43,624] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 17:25:43,624] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 17:25:43,624] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 17:25:43,624] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 17:25:43,624] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 17:25:43,624] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 17:25:43,624] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 17:25:43,624] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 17:25:43,624] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 17:25:43,624] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 17:25:43,624] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.632462739944458 seconds
Loading extension module utils...
Time to load utils op: 0.607595682144165 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
Time to load utils op: 0.6046431064605713 seconds
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input: Tonya has $150.00 on her credit card.  If she leaves any balance on her card at the end of the month, she is charged 20% interest.  If she makes a $50.00 payment on her card, what will be the new balance?
Output: 120

Input: In her first term, Governor Sandoval gave twice as many commencement addresses as Governor Hawkins. Governor Sloan gave ten more commencement addresses than Governor Sandoval in the same amount of time. If Governor Sandoval gave 12 commencement addresses, how many commencement addresses did the three of them give altogether?
Output: 40

Input: If Buzz bought a pizza with 78 slices at a restaurant and then decided to share it with the waiter in the ratio of 5:8, with Buzz's ratio being 5, what's twenty less the number of slices of pizza that the waiter ate?
Output: 28

Input: Jolene and Phil have four children, each with the same birthday.  They gave birth to their first child exactly 15 years ago.  They gave birth to their second child exactly one year after the birth of their first child.  They gave birth to their third child on the fourth birthday of their second child. Two years after the birth of their third child, they gave birth to their fourth child.  How old, in years, is their fourth child?
Output: 8

Input: Each purple book has 230 pages. Each orange book contains 510 pages. Mirella read 5 purple books and 4 orange books. How many more orange pages did she read than purple pages?
Output: 890

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o20-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.604621410369873 seconds
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3336295) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_17:25:52
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3336296)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-21_17:25:52
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3336297)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-21_17:25:52
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3336298)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_17:25:52
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3336295)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o21-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 21
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 17:25:55,730] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o21-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 21
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o21-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 20/9741 [00:00<00:49, 195.50it/s]  0%|▏                                                     | 40/9741 [00:00<00:49, 196.12it/s]  1%|▎                                                     | 60/9741 [00:00<00:49, 196.05it/s]  1%|▍                                                     | 80/9741 [00:00<00:49, 196.41it/s]  1%|▌                                                    | 100/9741 [00:00<00:48, 197.07it/s]  1%|▋                                                    | 120/9741 [00:00<00:48, 197.35it/s]  1%|▊                                                    | 140/9741 [00:00<00:48, 197.53it/s]  2%|▊                                                    | 160/9741 [00:00<00:48, 197.80it/s]  2%|▉                                                    | 180/9741 [00:00<00:48, 197.81it/s]  2%|█                                                    | 200/9741 [00:01<00:48, 196.40it/s]  2%|█▏                                                   | 220/9741 [00:01<00:49, 194.04it/s]  2%|█▎                                                   | 240/9741 [00:01<00:48, 194.85it/s]  3%|█▍                                                   | 260/9741 [00:01<00:48, 195.61it/s]  3%|█▌                                                   | 280/9741 [00:01<00:48, 196.46it/s]  3%|█▋                                                   | 300/9741 [00:01<00:47, 196.77it/s]  3%|█▋                                                   | 320/9741 [00:01<00:47, 196.90it/s]  3%|█▊                                                   | 340/9741 [00:01<00:47, 196.96it/s]  4%|█▉                                                   | 360/9741 [00:01<00:47, 197.07it/s]  4%|██                                                   | 380/9741 [00:01<00:47, 197.43it/s]  4%|██▏                                                  | 400/9741 [00:02<00:47, 197.63it/s]  4%|██▎                                                  | 420/9741 [00:02<00:47, 197.45it/s]  5%|██▍                                                  | 440/9741 [00:02<00:48, 192.97it/s]  5%|██▌                                                  | 460/9741 [00:02<00:47, 194.28it/s]  5%|██▌                                                  | 480/9741 [00:02<00:47, 195.07it/s]  5%|██▋                                                  | 500/9741 [00:02<00:47, 195.62it/s]  5%|██▊                                                  | 520/9741 [00:02<00:47, 196.08it/s]  6%|██▉                                                  | 540/9741 [00:02<00:46, 196.45it/s]  6%|███                                                  | 560/9741 [00:02<00:46, 196.50it/s]  6%|███▏                                                 | 587/9741 [00:02<00:42, 217.27it/s]  6%|███▎                                                 | 618/9741 [00:03<00:37, 242.50it/s]  7%|███▌                                                 | 648/9741 [00:03<00:35, 259.30it/s]  7%|███▋                                                 | 677/9741 [00:03<00:33, 268.25it/s]  7%|███▊                                                 | 707/9741 [00:03<00:32, 277.57it/s]  8%|████                                                 | 738/9741 [00:03<00:31, 284.48it/s]  8%|████▏                                                | 768/9741 [00:03<00:31, 288.13it/s]  8%|████▎                                                | 798/9741 [00:03<00:30, 289.42it/s]  9%|████▌                                                | 829/9741 [00:03<00:30, 292.71it/s]  9%|████▋                                                | 860/9741 [00:03<00:30, 295.17it/s]  9%|████▊                                                | 890/9741 [00:03<00:30, 294.83it/s]  9%|█████                                                | 920/9741 [00:04<00:29, 296.21it/s] 10%|█████▏                                               | 950/9741 [00:04<00:29, 296.75it/s] 10%|█████▎                                               | 980/9741 [00:04<00:30, 288.03it/s] 10%|█████▍                                              | 1010/9741 [00:04<00:29, 291.29it/s] 11%|█████▌                                              | 1041/9741 [00:04<00:29, 294.07it/s] 11%|█████▋                                              | 1071/9741 [00:04<00:29, 295.68it/s] 11%|█████▉                                              | 1101/9741 [00:04<00:29, 291.96it/s] 12%|██████                                              | 1131/9741 [00:04<00:30, 286.73it/s] 12%|██████▏                                             | 1160/9741 [00:04<00:29, 287.17it/s] 12%|██████▎                                             | 1190/9741 [00:05<00:29, 289.24it/s] 13%|██████▌                                             | 1220/9741 [00:05<00:29, 291.13it/s] 13%|██████▋                                             | 1250/9741 [00:05<00:29, 291.55it/s] 13%|██████▊                                             | 1280/9741 [00:05<00:28, 292.87it/s] 13%|██████▉                                             | 1310/9741 [00:05<00:28, 293.98it/s] 14%|███████▏                                            | 1340/9741 [00:05<00:28, 292.51it/s] 14%|███████▎                                            | 1370/9741 [00:05<00:28, 293.56it/s] 14%|███████▍                                            | 1400/9741 [00:05<00:28, 293.86it/s] 15%|███████▋                                            | 1430/9741 [00:05<00:28, 293.67it/s] 15%|███████▊                                            | 1460/9741 [00:05<00:28, 291.28it/s] 15%|███████▉                                            | 1490/9741 [00:06<00:28, 289.17it/s] 16%|████████                                            | 1520/9741 [00:06<00:28, 291.88it/s] 16%|████████▎                                           | 1550/9741 [00:06<00:27, 294.00it/s] 16%|████████▍                                           | 1580/9741 [00:06<00:27, 293.58it/s] 17%|████████▌                                           | 1610/9741 [00:06<00:27, 295.38it/s] 17%|████████▊                                           | 1640/9741 [00:06<00:27, 296.68it/s] 17%|████████▉                                           | 1671/9741 [00:06<00:27, 297.90it/s] 17%|█████████                                           | 1701/9741 [00:06<00:26, 298.48it/s] 18%|█████████▏                                          | 1731/9741 [00:06<00:26, 298.90it/s] 18%|█████████▍                                          | 1761/9741 [00:06<00:26, 299.22it/s] 18%|█████████▌                                          | 1791/9741 [00:07<00:28, 278.45it/s] 19%|█████████▋                                          | 1820/9741 [00:07<00:28, 280.47it/s] 19%|█████████▉                                          | 1850/9741 [00:07<00:27, 284.87it/s] 19%|██████████                                          | 1880/9741 [00:07<00:27, 289.09it/s] 20%|██████████▏                                         | 1910/9741 [00:07<00:26, 292.22it/s] 20%|██████████▎                                         | 1940/9741 [00:07<00:26, 294.38it/s] 20%|██████████▌                                         | 1970/9741 [00:07<00:26, 295.61it/s] 21%|██████████▋                                         | 2000/9741 [00:07<00:26, 296.32it/s] 21%|██████████▊                                         | 2030/9741 [00:07<00:26, 294.09it/s] 21%|██████████▉                                         | 2060/9741 [00:07<00:25, 295.66it/s] 21%|███████████▏                                        | 2090/9741 [00:08<00:25, 296.36it/s] 22%|███████████▎                                        | 2120/9741 [00:08<00:25, 297.36it/s] 22%|███████████▍                                        | 2150/9741 [00:08<00:25, 297.64it/s] 22%|███████████▋                                        | 2180/9741 [00:08<00:25, 297.51it/s] 23%|███████████▊                                        | 2210/9741 [00:08<00:25, 294.88it/s] 23%|███████████▉                                        | 2240/9741 [00:08<00:25, 296.24it/s] 23%|████████████                                        | 2270/9741 [00:08<00:25, 294.23it/s] 24%|████████████▎                                       | 2300/9741 [00:08<00:25, 295.20it/s] 24%|████████████▍                                       | 2330/9741 [00:08<00:25, 295.45it/s] 24%|████████████▌                                       | 2361/9741 [00:08<00:24, 296.90it/s] 25%|████████████▊                                       | 2391/9741 [00:09<00:24, 297.49it/s] 25%|████████████▉                                       | 2421/9741 [00:09<00:24, 297.65it/s] 25%|█████████████                                       | 2451/9741 [00:09<00:24, 297.38it/s] 25%|█████████████▏                                      | 2481/9741 [00:09<00:24, 294.75it/s] 26%|█████████████▍                                      | 2511/9741 [00:09<00:24, 295.24it/s] 26%|█████████████▌                                      | 2541/9741 [00:09<00:24, 295.98it/s] 26%|█████████████▋                                      | 2571/9741 [00:09<00:24, 297.02it/s] 27%|█████████████▉                                      | 2602/9741 [00:09<00:23, 297.87it/s] 27%|██████████████                                      | 2632/9741 [00:09<00:23, 298.21it/s] 27%|██████████████▏                                     | 2662/9741 [00:10<00:23, 298.39it/s] 28%|██████████████▎                                     | 2692/9741 [00:10<00:23, 298.40it/s] 28%|██████████████▌                                     | 2722/9741 [00:10<00:23, 296.53it/s] 28%|██████████████▋                                     | 2752/9741 [00:10<00:23, 296.98it/s] 29%|██████████████▊                                     | 2782/9741 [00:10<00:23, 297.17it/s] 29%|███████████████                                     | 2812/9741 [00:10<00:23, 296.49it/s] 29%|███████████████▏                                    | 2842/9741 [00:10<00:23, 296.44it/s] 29%|███████████████▎                                    | 2872/9741 [00:10<00:23, 297.34it/s] 30%|███████████████▍                                    | 2902/9741 [00:10<00:22, 297.70it/s] 30%|███████████████▋                                    | 2932/9741 [00:10<00:22, 296.33it/s] 30%|███████████████▊                                    | 2962/9741 [00:11<00:22, 297.00it/s] 31%|███████████████▉                                    | 2993/9741 [00:11<00:22, 298.01it/s] 31%|████████████████▏                                   | 3023/9741 [00:11<00:22, 298.45it/s] 31%|████████████████▎                                   | 3053/9741 [00:11<00:22, 297.91it/s] 32%|████████████████▍                                   | 3083/9741 [00:11<00:22, 297.04it/s] 32%|████████████████▌                                   | 3113/9741 [00:11<00:22, 294.72it/s] 32%|████████████████▊                                   | 3143/9741 [00:11<00:22, 295.41it/s] 33%|████████████████▉                                   | 3173/9741 [00:11<00:22, 294.53it/s] 33%|█████████████████                                   | 3203/9741 [00:11<00:22, 296.00it/s] 33%|█████████████████▎                                  | 3233/9741 [00:11<00:21, 296.83it/s] 33%|█████████████████▍                                  | 3263/9741 [00:12<00:21, 297.57it/s] 34%|█████████████████▌                                  | 3293/9741 [00:12<00:21, 297.93it/s] 34%|█████████████████▋                                  | 3323/9741 [00:12<00:21, 297.88it/s] 34%|█████████████████▉                                  | 3353/9741 [00:12<00:21, 298.02it/s] 35%|██████████████████                                  | 3383/9741 [00:12<00:21, 293.51it/s] 35%|██████████████████▏                                 | 3413/9741 [00:12<00:21, 294.79it/s] 35%|██████████████████▍                                 | 3443/9741 [00:12<00:21, 294.87it/s] 36%|██████████████████▌                                 | 3473/9741 [00:12<00:21, 293.74it/s] 36%|██████████████████▋                                 | 3503/9741 [00:12<00:21, 289.23it/s] 36%|██████████████████▊                                 | 3533/9741 [00:12<00:21, 291.35it/s] 37%|███████████████████                                 | 3563/9741 [00:13<00:21, 293.77it/s] 37%|███████████████████▏                                | 3593/9741 [00:13<00:20, 295.24it/s] 37%|███████████████████▎                                | 3623/9741 [00:13<00:20, 293.60it/s] 38%|███████████████████▌                                | 3653/9741 [00:13<00:20, 295.27it/s] 38%|███████████████████▋                                | 3683/9741 [00:13<00:20, 296.30it/s] 38%|███████████████████▊                                | 3713/9741 [00:13<00:20, 297.18it/s] 38%|███████████████████▉                                | 3743/9741 [00:13<00:20, 295.44it/s] 39%|████████████████████▏                               | 3773/9741 [00:13<00:20, 296.32it/s] 39%|████████████████████▎                               | 3803/9741 [00:13<00:20, 296.85it/s] 39%|████████████████████▍                               | 3833/9741 [00:13<00:20, 293.59it/s] 40%|████████████████████▌                               | 3863/9741 [00:14<00:19, 294.66it/s] 40%|████████████████████▊                               | 3893/9741 [00:14<00:19, 295.84it/s] 40%|████████████████████▉                               | 3923/9741 [00:14<00:19, 296.65it/s] 41%|█████████████████████                               | 3953/9741 [00:14<00:19, 297.08it/s] 41%|█████████████████████▎                              | 3983/9741 [00:14<00:19, 297.48it/s] 41%|█████████████████████▍                              | 4013/9741 [00:14<00:19, 297.16it/s] 42%|█████████████████████▌                              | 4043/9741 [00:14<00:19, 297.56it/s] 42%|█████████████████████▋                              | 4073/9741 [00:14<00:19, 295.95it/s] 42%|█████████████████████▉                              | 4103/9741 [00:14<00:19, 296.57it/s] 42%|██████████████████████                              | 4133/9741 [00:14<00:19, 294.32it/s] 43%|██████████████████████▏                             | 4163/9741 [00:15<00:18, 294.88it/s] 43%|██████████████████████▍                             | 4193/9741 [00:15<00:18, 295.92it/s] 43%|██████████████████████▌                             | 4223/9741 [00:15<00:18, 295.58it/s] 44%|██████████████████████▋                             | 4253/9741 [00:15<00:18, 296.64it/s] 44%|██████████████████████▊                             | 4283/9741 [00:15<00:18, 297.27it/s] 44%|███████████████████████                             | 4313/9741 [00:15<00:18, 295.74it/s] 45%|███████████████████████▏                            | 4343/9741 [00:15<00:18, 296.41it/s] 45%|███████████████████████▎                            | 4373/9741 [00:15<00:18, 297.03it/s] 45%|███████████████████████▌                            | 4403/9741 [00:15<00:17, 297.47it/s] 46%|███████████████████████▋                            | 4433/9741 [00:15<00:17, 297.81it/s] 46%|███████████████████████▊                            | 4463/9741 [00:16<00:17, 297.56it/s] 46%|███████████████████████▉                            | 4493/9741 [00:16<00:17, 297.81it/s] 46%|████████████████████████▏                           | 4523/9741 [00:16<00:20, 260.34it/s] 47%|████████████████████████▎                           | 4553/9741 [00:16<00:19, 270.89it/s] 47%|████████████████████████▍                           | 4583/9741 [00:16<00:18, 278.84it/s] 47%|████████████████████████▋                           | 4613/9741 [00:16<00:18, 284.80it/s] 48%|████████████████████████▊                           | 4643/9741 [00:16<00:17, 288.04it/s] 48%|████████████████████████▉                           | 4673/9741 [00:16<00:17, 291.29it/s] 48%|█████████████████████████                           | 4703/9741 [00:16<00:17, 293.66it/s] 49%|█████████████████████████▎                          | 4733/9741 [00:17<00:16, 295.24it/s] 49%|█████████████████████████▍                          | 4763/9741 [00:17<00:25, 198.44it/s] 49%|█████████████████████████▌                          | 4793/9741 [00:17<00:22, 220.22it/s] 50%|█████████████████████████▋                          | 4823/9741 [00:17<00:20, 238.63it/s] 50%|█████████████████████████▉                          | 4853/9741 [00:17<00:19, 253.41it/s] 50%|██████████████████████████                          | 4883/9741 [00:17<00:18, 264.97it/s] 50%|██████████████████████████▏                         | 4913/9741 [00:17<00:17, 273.70it/s] 51%|██████████████████████████▍                         | 4943/9741 [00:17<00:17, 278.58it/s] 51%|██████████████████████████▌                         | 4973/9741 [00:18<00:16, 283.68it/s] 51%|██████████████████████████▋                         | 5003/9741 [00:18<00:16, 286.86it/s] 52%|██████████████████████████▊                         | 5033/9741 [00:18<00:16, 289.04it/s] 52%|███████████████████████████                         | 5063/9741 [00:18<00:16, 291.60it/s] 52%|███████████████████████████▏                        | 5093/9741 [00:18<00:15, 293.02it/s] 53%|███████████████████████████▎                        | 5123/9741 [00:18<00:15, 294.79it/s] 53%|███████████████████████████▌                        | 5153/9741 [00:18<00:15, 295.98it/s] 53%|███████████████████████████▋                        | 5183/9741 [00:18<00:15, 294.05it/s] 54%|███████████████████████████▊                        | 5213/9741 [00:18<00:15, 295.56it/s] 54%|███████████████████████████▉                        | 5243/9741 [00:18<00:15, 296.37it/s] 54%|████████████████████████████▏                       | 5273/9741 [00:19<00:15, 296.95it/s] 54%|████████████████████████████▎                       | 5303/9741 [00:19<00:14, 297.47it/s] 55%|████████████████████████████▍                       | 5333/9741 [00:19<00:14, 297.53it/s] 55%|████████████████████████████▋                       | 5363/9741 [00:19<00:14, 295.84it/s] 55%|████████████████████████████▊                       | 5393/9741 [00:19<00:14, 296.02it/s] 56%|████████████████████████████▉                       | 5423/9741 [00:19<00:14, 294.23it/s] 56%|█████████████████████████████                       | 5453/9741 [00:19<00:14, 295.44it/s] 56%|█████████████████████████████▎                      | 5484/9741 [00:19<00:14, 297.19it/s] 57%|█████████████████████████████▍                      | 5515/9741 [00:19<00:14, 300.12it/s] 57%|█████████████████████████████▌                      | 5546/9741 [00:19<00:13, 302.26it/s] 57%|█████████████████████████████▊                      | 5577/9741 [00:20<00:13, 303.71it/s] 58%|█████████████████████████████▉                      | 5608/9741 [00:20<00:13, 303.92it/s] 58%|██████████████████████████████                      | 5639/9741 [00:20<00:13, 302.88it/s] 58%|██████████████████████████████▎                     | 5670/9741 [00:20<00:13, 303.37it/s] 59%|██████████████████████████████▍                     | 5701/9741 [00:20<00:13, 304.15it/s] 59%|██████████████████████████████▌                     | 5732/9741 [00:20<00:13, 305.15it/s] 59%|██████████████████████████████▊                     | 5763/9741 [00:20<00:13, 305.67it/s] 59%|██████████████████████████████▉                     | 5794/9741 [00:20<00:12, 306.22it/s] 60%|███████████████████████████████                     | 5825/9741 [00:20<00:12, 306.56it/s] 60%|███████████████████████████████▎                    | 5856/9741 [00:20<00:12, 304.76it/s] 60%|███████████████████████████████▍                    | 5887/9741 [00:21<00:12, 305.65it/s] 61%|███████████████████████████████▌                    | 5918/9741 [00:21<00:12, 306.21it/s] 61%|███████████████████████████████▊                    | 5949/9741 [00:21<00:12, 306.48it/s] 61%|███████████████████████████████▉                    | 5980/9741 [00:21<00:12, 305.55it/s] 62%|████████████████████████████████                    | 6011/9741 [00:21<00:12, 305.59it/s] 62%|████████████████████████████████▎                   | 6042/9741 [00:21<00:12, 305.96it/s] 62%|████████████████████████████████▍                   | 6073/9741 [00:21<00:11, 306.34it/s] 63%|████████████████████████████████▌                   | 6104/9741 [00:21<00:11, 304.37it/s] 63%|████████████████████████████████▊                   | 6135/9741 [00:21<00:11, 305.19it/s] 63%|████████████████████████████████▉                   | 6166/9741 [00:21<00:11, 305.83it/s] 64%|█████████████████████████████████                   | 6197/9741 [00:22<00:11, 306.36it/s] 64%|█████████████████████████████████▏                  | 6228/9741 [00:22<00:11, 306.68it/s] 64%|█████████████████████████████████▍                  | 6259/9741 [00:22<00:11, 306.80it/s] 65%|█████████████████████████████████▌                  | 6290/9741 [00:22<00:11, 307.17it/s] 65%|█████████████████████████████████▋                  | 6321/9741 [00:22<00:11, 304.49it/s] 65%|█████████████████████████████████▉                  | 6352/9741 [00:22<00:11, 305.20it/s] 66%|██████████████████████████████████                  | 6383/9741 [00:22<00:10, 305.75it/s] 66%|██████████████████████████████████▏                 | 6414/9741 [00:22<00:10, 306.30it/s] 66%|██████████████████████████████████▍                 | 6445/9741 [00:22<00:10, 306.73it/s] 66%|██████████████████████████████████▌                 | 6476/9741 [00:22<00:10, 306.86it/s] 67%|██████████████████████████████████▋                 | 6507/9741 [00:23<00:10, 307.07it/s] 67%|██████████████████████████████████▉                 | 6538/9741 [00:23<00:10, 305.10it/s] 67%|███████████████████████████████████                 | 6569/9741 [00:23<00:10, 305.61it/s] 68%|███████████████████████████████████▏                | 6600/9741 [00:23<00:10, 304.88it/s] 68%|███████████████████████████████████▍                | 6631/9741 [00:23<00:10, 304.60it/s] 68%|███████████████████████████████████▌                | 6662/9741 [00:23<00:10, 302.72it/s] 69%|███████████████████████████████████▋                | 6693/9741 [00:23<00:10, 302.23it/s] 69%|███████████████████████████████████▉                | 6724/9741 [00:23<00:09, 303.41it/s] 69%|████████████████████████████████████                | 6755/9741 [00:23<00:09, 304.89it/s] 70%|████████████████████████████████████▏               | 6786/9741 [00:24<00:09, 303.76it/s] 70%|████████████████████████████████████▍               | 6817/9741 [00:24<00:09, 304.89it/s] 70%|████████████████████████████████████▌               | 6848/9741 [00:24<00:09, 305.93it/s] 71%|████████████████████████████████████▋               | 6879/9741 [00:24<00:09, 306.36it/s] 71%|████████████████████████████████████▉               | 6910/9741 [00:24<00:09, 306.68it/s] 71%|█████████████████████████████████████               | 6941/9741 [00:24<00:09, 307.13it/s] 72%|█████████████████████████████████████▏              | 6972/9741 [00:24<00:09, 307.01it/s] 72%|█████████████████████████████████████▍              | 7003/9741 [00:24<00:09, 304.09it/s] 72%|█████████████████████████████████████▌              | 7034/9741 [00:24<00:08, 304.88it/s] 73%|█████████████████████████████████████▋              | 7065/9741 [00:24<00:08, 305.72it/s] 73%|█████████████████████████████████████▉              | 7096/9741 [00:25<00:08, 306.09it/s] 73%|██████████████████████████████████████              | 7127/9741 [00:25<00:08, 306.04it/s] 73%|██████████████████████████████████████▏             | 7158/9741 [00:25<00:08, 303.61it/s] 74%|██████████████████████████████████████▍             | 7189/9741 [00:25<00:08, 304.51it/s] 74%|██████████████████████████████████████▌             | 7220/9741 [00:25<00:08, 302.48it/s] 74%|██████████████████████████████████████▋             | 7251/9741 [00:25<00:08, 303.88it/s] 75%|██████████████████████████████████████▊             | 7282/9741 [00:25<00:08, 304.85it/s] 75%|███████████████████████████████████████             | 7313/9741 [00:25<00:07, 305.65it/s] 75%|███████████████████████████████████████▏            | 7344/9741 [00:25<00:07, 305.78it/s] 76%|███████████████████████████████████████▎            | 7375/9741 [00:25<00:07, 306.06it/s] 76%|███████████████████████████████████████▌            | 7406/9741 [00:26<00:07, 306.61it/s] 76%|███████████████████████████████████████▋            | 7437/9741 [00:26<00:07, 306.51it/s] 77%|███████████████████████████████████████▊            | 7468/9741 [00:26<00:08, 283.04it/s] 77%|████████████████████████████████████████            | 7499/9741 [00:26<00:07, 289.55it/s] 77%|████████████████████████████████████████▏           | 7530/9741 [00:26<00:07, 294.17it/s] 78%|████████████████████████████████████████▎           | 7561/9741 [00:26<00:07, 297.97it/s] 78%|████████████████████████████████████████▌           | 7592/9741 [00:26<00:07, 300.70it/s] 78%|████████████████████████████████████████▋           | 7623/9741 [00:26<00:06, 302.88it/s] 79%|████████████████████████████████████████▊           | 7654/9741 [00:26<00:06, 301.48it/s] 79%|█████████████████████████████████████████           | 7685/9741 [00:26<00:06, 298.87it/s] 79%|█████████████████████████████████████████▏          | 7716/9741 [00:27<00:06, 301.23it/s] 80%|█████████████████████████████████████████▎          | 7747/9741 [00:27<00:06, 303.24it/s] 80%|█████████████████████████████████████████▌          | 7778/9741 [00:27<00:06, 304.40it/s] 80%|█████████████████████████████████████████▋          | 7809/9741 [00:27<00:06, 304.43it/s] 80%|█████████████████████████████████████████▊          | 7840/9741 [00:27<00:06, 305.27it/s] 81%|██████████████████████████████████████████          | 7871/9741 [00:27<00:06, 305.67it/s] 81%|██████████████████████████████████████████▏         | 7902/9741 [00:27<00:06, 304.49it/s] 81%|██████████████████████████████████████████▎         | 7933/9741 [00:27<00:05, 304.17it/s] 82%|██████████████████████████████████████████▌         | 7964/9741 [00:27<00:05, 303.92it/s] 82%|██████████████████████████████████████████▋         | 7995/9741 [00:27<00:05, 304.85it/s] 82%|██████████████████████████████████████████▊         | 8026/9741 [00:28<00:05, 305.62it/s] 83%|███████████████████████████████████████████         | 8057/9741 [00:28<00:05, 305.97it/s] 83%|███████████████████████████████████████████▏        | 8088/9741 [00:28<00:05, 306.56it/s] 83%|███████████████████████████████████████████▎        | 8119/9741 [00:28<00:05, 307.00it/s] 84%|███████████████████████████████████████████▌        | 8150/9741 [00:28<00:05, 304.85it/s] 84%|███████████████████████████████████████████▋        | 8181/9741 [00:28<00:05, 303.44it/s] 84%|███████████████████████████████████████████▊        | 8212/9741 [00:28<00:05, 304.49it/s] 85%|████████████████████████████████████████████        | 8243/9741 [00:28<00:04, 305.41it/s] 85%|████████████████████████████████████████████▏       | 8274/9741 [00:28<00:04, 305.71it/s] 85%|████████████████████████████████████████████▎       | 8305/9741 [00:29<00:04, 305.67it/s] 86%|████████████████████████████████████████████▍       | 8336/9741 [00:29<00:04, 305.16it/s] 86%|████████████████████████████████████████████▋       | 8367/9741 [00:29<00:04, 303.65it/s] 86%|████████████████████████████████████████████▊       | 8398/9741 [00:29<00:04, 304.56it/s] 87%|████████████████████████████████████████████▉       | 8429/9741 [00:29<00:04, 304.72it/s] 87%|█████████████████████████████████████████████▏      | 8460/9741 [00:29<00:04, 305.49it/s] 87%|█████████████████████████████████████████████▎      | 8491/9741 [00:29<00:04, 305.86it/s] 87%|█████████████████████████████████████████████▍      | 8522/9741 [00:29<00:03, 306.39it/s] 88%|█████████████████████████████████████████████▋      | 8553/9741 [00:29<00:03, 306.48it/s] 88%|█████████████████████████████████████████████▊      | 8584/9741 [00:29<00:03, 304.59it/s] 88%|█████████████████████████████████████████████▉      | 8615/9741 [00:30<00:03, 305.05it/s] 89%|██████████████████████████████████████████████▏     | 8646/9741 [00:30<00:03, 305.21it/s] 89%|██████████████████████████████████████████████▎     | 8677/9741 [00:30<00:03, 305.28it/s] 89%|██████████████████████████████████████████████▍     | 8708/9741 [00:30<00:03, 305.08it/s] 90%|██████████████████████████████████████████████▋     | 8739/9741 [00:30<00:03, 305.36it/s] 90%|██████████████████████████████████████████████▊     | 8770/9741 [00:30<00:03, 305.69it/s] 90%|██████████████████████████████████████████████▉     | 8801/9741 [00:30<00:03, 304.02it/s] 91%|███████████████████████████████████████████████▏    | 8832/9741 [00:30<00:02, 304.99it/s] 91%|███████████████████████████████████████████████▎    | 8863/9741 [00:30<00:02, 305.47it/s] 91%|███████████████████████████████████████████████▍    | 8894/9741 [00:30<00:02, 306.04it/s] 92%|███████████████████████████████████████████████▋    | 8925/9741 [00:31<00:02, 306.54it/s] 92%|███████████████████████████████████████████████▊    | 8956/9741 [00:31<00:02, 306.57it/s] 92%|███████████████████████████████████████████████▉    | 8987/9741 [00:31<00:02, 306.17it/s] 93%|████████████████████████████████████████████████▏   | 9018/9741 [00:31<00:02, 305.54it/s] 93%|████████████████████████████████████████████████▎   | 9049/9741 [00:31<00:02, 301.74it/s] 93%|████████████████████████████████████████████████▍   | 9080/9741 [00:31<00:02, 303.24it/s] 94%|████████████████████████████████████████████████▋   | 9111/9741 [00:31<00:02, 304.25it/s] 94%|████████████████████████████████████████████████▊   | 9142/9741 [00:31<00:01, 305.16it/s] 94%|████████████████████████████████████████████████▉   | 9173/9741 [00:31<00:01, 305.80it/s] 94%|█████████████████████████████████████████████████▏  | 9204/9741 [00:31<00:01, 306.16it/s] 95%|█████████████████████████████████████████████████▎  | 9235/9741 [00:32<00:01, 306.43it/s] 95%|█████████████████████████████████████████████████▍  | 9266/9741 [00:32<00:01, 304.61it/s] 95%|█████████████████████████████████████████████████▋  | 9297/9741 [00:32<00:01, 305.29it/s] 96%|█████████████████████████████████████████████████▊  | 9328/9741 [00:32<00:01, 305.94it/s] 96%|█████████████████████████████████████████████████▉  | 9359/9741 [00:32<00:01, 306.23it/s] 96%|██████████████████████████████████████████████████▏ | 9390/9741 [00:32<00:01, 306.54it/s] 97%|██████████████████████████████████████████████████▎ | 9421/9741 [00:32<00:01, 306.63it/s] 97%|██████████████████████████████████████████████████▍ | 9452/9741 [00:32<00:00, 306.68it/s] 97%|██████████████████████████████████████████████████▌ | 9483/9741 [00:32<00:00, 304.88it/s] 98%|██████████████████████████████████████████████████▊ | 9514/9741 [00:32<00:00, 305.46it/s] 98%|██████████████████████████████████████████████████▉ | 9545/9741 [00:33<00:00, 306.02it/s] 98%|███████████████████████████████████████████████████ | 9576/9741 [00:33<00:00, 306.46it/s] 99%|███████████████████████████████████████████████████▎| 9607/9741 [00:33<00:00, 306.48it/s] 99%|███████████████████████████████████████████████████▍| 9638/9741 [00:33<00:00, 306.64it/s] 99%|███████████████████████████████████████████████████▌| 9669/9741 [00:33<00:00, 305.70it/s]100%|███████████████████████████████████████████████████▊| 9700/9741 [00:33<00:00, 305.54it/s]100%|███████████████████████████████████████████████████▉| 9731/9741 [00:33<00:00, 298.97it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:33<00:00, 288.95it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.86s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.02s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.30s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.33s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.04s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.02s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.31s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.60s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.60s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.87s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.73s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.89s/it]
[2023-08-21 17:27:22,260] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 17:27:31,946] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 17:27:31,947] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7ff9b20d2fd0>
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 17:27:31,948] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7ff9b1cff220>
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 17:27:31,949] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 17:27:31,949] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5743756294250488 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input: Tonya has $150.00 on her credit card.  If she leaves any balance on her card at the end of the month, she is charged 20% interest.  If she makes a $50.00 payment on her card, what will be the new balance?
Output: 120

Input: In her first term, Governor Sandoval gave twice as many commencement addresses as Governor Hawkins. Governor Sloan gave ten more commencement addresses than Governor Sandoval in the same amount of time. If Governor Sandoval gave 12 commencement addresses, how many commencement addresses did the three of them give altogether?
Output: 40

Input: If Buzz bought a pizza with 78 slices at a restaurant and then decided to share it with the waiter in the ratio of 5:8, with Buzz's ratio being 5, what's twenty less the number of slices of pizza that the waiter ate?
Output: 28

Input: Jolene and Phil have four children, each with the same birthday.  They gave birth to their first child exactly 15 years ago.  They gave birth to their second child exactly one year after the birth of their first child.  They gave birth to their third child on the fourth birthday of their second child. Two years after the birth of their third child, they gave birth to their fourth child.  How old, in years, is their fourth child?
Output: 8

Input: Each purple book has 230 pages. Each orange book contains 510 pages. Mirella read 5 purple books and 4 orange books. How many more orange pages did she read than purple pages?
Output: 890

Input: Isabella has $45 more than Sam but only $15 more than Giselle. If Giselle has $120, calculate the total amount of money each shopper will receive if Isabella, Sam, and Giselle donate the money to three shoppers at their local town's supermarket who then decides to share it equally.
Output: 115

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o21-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.504601001739502 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5044829845428467 seconds
Time to load utils op: 0.5046820640563965 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3337645) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_17:27:39
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3337646)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-21_17:27:39
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3337647)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-21_17:27:39
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3337648)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_17:27:39
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3337645)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o22-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 22
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 17:27:42,704] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o22-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 22
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o22-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 19/9741 [00:00<00:51, 189.09it/s]  0%|▏                                                     | 39/9741 [00:00<00:51, 189.77it/s]  1%|▎                                                     | 59/9741 [00:00<00:50, 189.91it/s]  1%|▍                                                     | 79/9741 [00:00<00:50, 190.07it/s]  1%|▌                                                     | 99/9741 [00:00<00:50, 190.27it/s]  1%|▋                                                    | 119/9741 [00:00<00:51, 187.09it/s]  1%|▊                                                    | 138/9741 [00:00<00:51, 187.88it/s]  2%|▊                                                    | 158/9741 [00:00<00:50, 188.72it/s]  2%|▉                                                    | 177/9741 [00:00<00:50, 188.56it/s]  2%|█                                                    | 196/9741 [00:01<00:50, 188.42it/s]  2%|█▏                                                   | 215/9741 [00:01<00:50, 187.08it/s]  2%|█▎                                                   | 234/9741 [00:01<00:50, 187.78it/s]  3%|█▍                                                   | 253/9741 [00:01<00:50, 188.09it/s]  3%|█▍                                                   | 272/9741 [00:01<00:50, 188.52it/s]  3%|█▌                                                   | 291/9741 [00:01<00:50, 188.73it/s]  3%|█▋                                                   | 310/9741 [00:01<00:50, 186.59it/s]  3%|█▊                                                   | 329/9741 [00:01<00:50, 187.10it/s]  4%|█▉                                                   | 348/9741 [00:01<00:50, 187.64it/s]  4%|█▉                                                   | 367/9741 [00:01<00:49, 188.00it/s]  4%|██                                                   | 386/9741 [00:02<00:49, 188.53it/s]  4%|██▏                                                  | 405/9741 [00:02<00:49, 188.74it/s]  4%|██▎                                                  | 424/9741 [00:02<00:49, 188.87it/s]  5%|██▍                                                  | 448/9741 [00:02<00:45, 203.73it/s]  5%|██▌                                                  | 477/9741 [00:02<00:40, 229.04it/s]  5%|██▊                                                  | 506/9741 [00:02<00:37, 246.68it/s]  5%|██▉                                                  | 535/9741 [00:02<00:35, 258.44it/s]  6%|███                                                  | 564/9741 [00:02<00:34, 267.02it/s]  6%|███▏                                                 | 593/9741 [00:02<00:33, 273.36it/s]  6%|███▍                                                 | 622/9741 [00:02<00:32, 277.68it/s]  7%|███▌                                                 | 651/9741 [00:03<00:32, 280.93it/s]  7%|███▋                                                 | 680/9741 [00:03<00:32, 281.18it/s]  7%|███▊                                                 | 709/9741 [00:03<00:31, 282.90it/s]  8%|████                                                 | 738/9741 [00:03<00:31, 283.71it/s]  8%|████▏                                                | 767/9741 [00:03<00:31, 285.01it/s]  8%|████▎                                                | 796/9741 [00:03<00:31, 286.13it/s]  8%|████▍                                                | 825/9741 [00:03<00:31, 286.30it/s]  9%|████▋                                                | 854/9741 [00:03<00:30, 286.93it/s]  9%|████▊                                                | 883/9741 [00:03<00:31, 285.53it/s]  9%|████▉                                                | 912/9741 [00:03<00:30, 285.46it/s] 10%|█████                                                | 941/9741 [00:04<00:30, 286.18it/s] 10%|█████▎                                               | 970/9741 [00:04<00:30, 286.24it/s] 10%|█████▍                                               | 999/9741 [00:04<00:30, 286.69it/s] 11%|█████▍                                              | 1028/9741 [00:04<00:30, 287.26it/s] 11%|█████▋                                              | 1057/9741 [00:04<00:30, 287.56it/s] 11%|█████▊                                              | 1086/9741 [00:04<00:30, 287.97it/s] 11%|█████▉                                              | 1115/9741 [00:04<00:30, 285.33it/s] 12%|██████                                              | 1144/9741 [00:04<00:29, 286.64it/s] 12%|██████▎                                             | 1174/9741 [00:04<00:29, 288.22it/s] 12%|██████▍                                             | 1204/9741 [00:04<00:29, 289.17it/s] 13%|██████▌                                             | 1234/9741 [00:05<00:29, 289.70it/s] 13%|██████▋                                             | 1264/9741 [00:05<00:29, 290.22it/s] 13%|██████▉                                             | 1294/9741 [00:05<00:29, 288.60it/s] 14%|███████                                             | 1323/9741 [00:05<00:29, 288.74it/s] 14%|███████▏                                            | 1352/9741 [00:05<00:29, 287.46it/s] 14%|███████▍                                            | 1382/9741 [00:05<00:28, 288.34it/s] 14%|███████▌                                            | 1412/9741 [00:05<00:28, 289.20it/s] 15%|███████▋                                            | 1442/9741 [00:05<00:28, 289.72it/s] 15%|███████▊                                            | 1472/9741 [00:05<00:28, 290.16it/s] 15%|████████                                            | 1502/9741 [00:06<00:28, 290.32it/s] 16%|████████▏                                           | 1532/9741 [00:06<00:28, 290.60it/s] 16%|████████▎                                           | 1562/9741 [00:06<00:28, 289.12it/s] 16%|████████▍                                           | 1592/9741 [00:06<00:28, 289.70it/s] 17%|████████▋                                           | 1622/9741 [00:06<00:27, 290.11it/s] 17%|████████▊                                           | 1652/9741 [00:06<00:30, 268.44it/s] 17%|████████▉                                           | 1680/9741 [00:06<00:37, 215.64it/s] 17%|█████████                                           | 1704/9741 [00:06<00:42, 189.14it/s] 18%|█████████▏                                          | 1725/9741 [00:07<00:45, 174.56it/s] 18%|█████████▎                                          | 1744/9741 [00:07<00:48, 165.10it/s] 18%|█████████▍                                          | 1762/9741 [00:07<00:48, 162.89it/s] 18%|█████████▌                                          | 1789/9741 [00:07<00:44, 176.99it/s] 19%|█████████▋                                          | 1818/9741 [00:07<00:38, 204.49it/s] 19%|█████████▊                                          | 1847/9741 [00:07<00:34, 226.21it/s] 19%|██████████                                          | 1877/9741 [00:07<00:32, 243.90it/s] 20%|██████████▏                                         | 1907/9741 [00:07<00:30, 257.14it/s] 20%|██████████▎                                         | 1936/9741 [00:07<00:29, 266.31it/s] 20%|██████████▍                                         | 1965/9741 [00:08<00:28, 271.94it/s] 20%|██████████▋                                         | 1995/9741 [00:08<00:27, 277.57it/s] 21%|██████████▊                                         | 2024/9741 [00:08<00:27, 279.45it/s] 21%|██████████▉                                         | 2053/9741 [00:08<00:27, 282.34it/s] 21%|███████████                                         | 2082/9741 [00:08<00:26, 284.47it/s] 22%|███████████▎                                        | 2112/9741 [00:08<00:26, 286.39it/s] 22%|███████████▍                                        | 2142/9741 [00:08<00:26, 287.48it/s] 22%|███████████▌                                        | 2172/9741 [00:08<00:26, 288.39it/s] 23%|███████████▊                                        | 2202/9741 [00:08<00:26, 289.09it/s] 23%|███████████▉                                        | 2232/9741 [00:08<00:25, 289.53it/s] 23%|████████████                                        | 2261/9741 [00:09<00:25, 287.83it/s] 24%|████████████▏                                       | 2290/9741 [00:09<00:25, 288.43it/s] 24%|████████████▍                                       | 2320/9741 [00:09<00:25, 288.86it/s] 24%|████████████▌                                       | 2349/9741 [00:09<00:25, 289.06it/s] 24%|████████████▋                                       | 2379/9741 [00:09<00:25, 289.49it/s] 25%|████████████▊                                       | 2409/9741 [00:09<00:25, 289.98it/s] 25%|█████████████                                       | 2439/9741 [00:09<00:25, 289.97it/s] 25%|█████████████▏                                      | 2469/9741 [00:09<00:25, 290.09it/s] 26%|█████████████▎                                      | 2499/9741 [00:09<00:25, 287.93it/s] 26%|█████████████▍                                      | 2528/9741 [00:10<00:25, 288.33it/s] 26%|█████████████▋                                      | 2557/9741 [00:10<00:24, 288.45it/s] 27%|█████████████▊                                      | 2587/9741 [00:10<00:24, 289.15it/s] 27%|█████████████▉                                      | 2617/9741 [00:10<00:24, 289.44it/s] 27%|██████████████▏                                     | 2646/9741 [00:10<00:24, 289.39it/s] 27%|██████████████▎                                     | 2675/9741 [00:10<00:24, 289.45it/s] 28%|██████████████▍                                     | 2704/9741 [00:10<00:24, 286.94it/s] 28%|██████████████▌                                     | 2733/9741 [00:10<00:24, 286.61it/s] 28%|██████████████▋                                     | 2762/9741 [00:10<00:24, 286.42it/s] 29%|██████████████▉                                     | 2791/9741 [00:10<00:24, 286.26it/s] 29%|███████████████                                     | 2820/9741 [00:11<00:24, 286.16it/s] 29%|███████████████▏                                    | 2849/9741 [00:11<00:24, 286.17it/s] 30%|███████████████▎                                    | 2878/9741 [00:11<00:23, 286.69it/s] 30%|███████████████▌                                    | 2907/9741 [00:11<00:23, 286.72it/s] 30%|███████████████▋                                    | 2936/9741 [00:11<00:23, 284.14it/s] 30%|███████████████▊                                    | 2965/9741 [00:11<00:23, 284.61it/s] 31%|███████████████▉                                    | 2994/9741 [00:11<00:23, 285.34it/s] 31%|████████████████▏                                   | 3023/9741 [00:11<00:23, 286.05it/s] 31%|████████████████▎                                   | 3052/9741 [00:11<00:23, 286.13it/s] 32%|████████████████▍                                   | 3081/9741 [00:11<00:23, 286.55it/s] 32%|████████████████▌                                   | 3110/9741 [00:12<00:23, 286.88it/s] 32%|████████████████▊                                   | 3139/9741 [00:12<00:23, 286.82it/s] 33%|████████████████▉                                   | 3168/9741 [00:12<00:23, 285.10it/s] 33%|█████████████████                                   | 3197/9741 [00:12<00:22, 285.96it/s] 33%|█████████████████▏                                  | 3226/9741 [00:12<00:22, 286.34it/s] 33%|█████████████████▍                                  | 3255/9741 [00:12<00:22, 286.84it/s] 34%|█████████████████▌                                  | 3284/9741 [00:12<00:22, 286.47it/s] 34%|█████████████████▋                                  | 3313/9741 [00:12<00:22, 286.78it/s] 34%|█████████████████▊                                  | 3342/9741 [00:12<00:22, 286.93it/s] 35%|█████████████████▉                                  | 3371/9741 [00:12<00:22, 287.12it/s] 35%|██████████████████▏                                 | 3400/9741 [00:13<00:22, 285.46it/s] 35%|██████████████████▎                                 | 3429/9741 [00:13<00:22, 285.41it/s] 35%|██████████████████▍                                 | 3458/9741 [00:13<00:21, 286.06it/s] 36%|██████████████████▌                                 | 3487/9741 [00:13<00:21, 286.88it/s] 36%|██████████████████▊                                 | 3516/9741 [00:13<00:21, 286.72it/s] 36%|██████████████████▉                                 | 3545/9741 [00:13<00:21, 287.60it/s] 37%|███████████████████                                 | 3574/9741 [00:13<00:21, 287.71it/s] 37%|███████████████████▏                                | 3603/9741 [00:13<00:21, 288.23it/s] 37%|███████████████████▍                                | 3632/9741 [00:13<00:21, 286.77it/s] 38%|███████████████████▌                                | 3661/9741 [00:13<00:21, 287.33it/s] 38%|███████████████████▋                                | 3690/9741 [00:14<00:21, 287.99it/s] 38%|███████████████████▊                                | 3719/9741 [00:14<00:20, 288.55it/s] 38%|████████████████████                                | 3748/9741 [00:14<00:20, 288.78it/s] 39%|████████████████████▏                               | 3777/9741 [00:14<00:20, 288.90it/s] 39%|████████████████████▎                               | 3806/9741 [00:14<00:20, 289.05it/s] 39%|████████████████████▍                               | 3835/9741 [00:14<00:20, 287.34it/s] 40%|████████████████████▋                               | 3864/9741 [00:14<00:20, 287.81it/s] 40%|████████████████████▊                               | 3893/9741 [00:14<00:20, 288.01it/s] 40%|████████████████████▉                               | 3922/9741 [00:14<00:20, 288.42it/s] 41%|█████████████████████                               | 3951/9741 [00:14<00:20, 288.20it/s] 41%|█████████████████████▏                              | 3980/9741 [00:15<00:20, 287.91it/s] 41%|█████████████████████▍                              | 4009/9741 [00:15<00:19, 288.33it/s] 41%|█████████████████████▌                              | 4038/9741 [00:15<00:19, 288.75it/s] 42%|█████████████████████▋                              | 4067/9741 [00:15<00:19, 286.94it/s] 42%|█████████████████████▊                              | 4096/9741 [00:15<00:19, 287.33it/s] 42%|██████████████████████                              | 4125/9741 [00:15<00:19, 287.85it/s] 43%|██████████████████████▏                             | 4154/9741 [00:15<00:19, 288.02it/s] 43%|██████████████████████▎                             | 4183/9741 [00:15<00:19, 288.39it/s] 43%|██████████████████████▍                             | 4212/9741 [00:15<00:19, 288.50it/s] 44%|██████████████████████▋                             | 4241/9741 [00:15<00:19, 288.65it/s] 44%|██████████████████████▊                             | 4270/9741 [00:16<00:18, 289.01it/s] 44%|██████████████████████▉                             | 4299/9741 [00:16<00:18, 287.33it/s] 44%|███████████████████████                             | 4328/9741 [00:16<00:18, 287.90it/s] 45%|███████████████████████▎                            | 4357/9741 [00:16<00:18, 288.32it/s] 45%|███████████████████████▍                            | 4386/9741 [00:16<00:18, 287.46it/s] 45%|███████████████████████▌                            | 4415/9741 [00:16<00:18, 287.73it/s] 46%|███████████████████████▋                            | 4444/9741 [00:16<00:18, 287.78it/s] 46%|███████████████████████▉                            | 4473/9741 [00:16<00:18, 288.29it/s] 46%|████████████████████████                            | 4502/9741 [00:16<00:18, 288.68it/s] 47%|████████████████████████▏                           | 4531/9741 [00:17<00:19, 265.28it/s] 47%|████████████████████████▎                           | 4560/9741 [00:17<00:19, 272.13it/s] 47%|████████████████████████▍                           | 4589/9741 [00:17<00:18, 277.03it/s] 47%|████████████████████████▋                           | 4618/9741 [00:17<00:18, 280.40it/s] 48%|████████████████████████▊                           | 4647/9741 [00:17<00:18, 282.56it/s] 48%|████████████████████████▉                           | 4676/9741 [00:17<00:17, 284.28it/s] 48%|█████████████████████████                           | 4705/9741 [00:17<00:17, 285.67it/s] 49%|█████████████████████████▎                          | 4735/9741 [00:17<00:17, 287.14it/s] 49%|█████████████████████████▍                          | 4764/9741 [00:17<00:25, 196.11it/s] 49%|█████████████████████████▌                          | 4793/9741 [00:18<00:22, 217.00it/s] 50%|█████████████████████████▋                          | 4822/9741 [00:18<00:21, 233.17it/s] 50%|█████████████████████████▉                          | 4851/9741 [00:18<00:19, 247.42it/s] 50%|██████████████████████████                          | 4880/9741 [00:18<00:18, 258.24it/s] 50%|██████████████████████████▏                         | 4909/9741 [00:18<00:18, 266.93it/s] 51%|██████████████████████████▎                         | 4938/9741 [00:18<00:17, 273.29it/s] 51%|██████████████████████████▌                         | 4967/9741 [00:18<00:17, 276.10it/s] 51%|██████████████████████████▋                         | 4996/9741 [00:18<00:16, 279.91it/s] 52%|██████████████████████████▊                         | 5025/9741 [00:18<00:16, 282.60it/s] 52%|██████████████████████████▉                         | 5054/9741 [00:18<00:16, 284.48it/s] 52%|███████████████████████████▏                        | 5083/9741 [00:19<00:16, 285.79it/s] 52%|███████████████████████████▎                        | 5112/9741 [00:19<00:16, 286.56it/s] 53%|███████████████████████████▍                        | 5141/9741 [00:19<00:16, 287.07it/s] 53%|███████████████████████████▌                        | 5170/9741 [00:19<00:16, 282.27it/s] 53%|███████████████████████████▊                        | 5199/9741 [00:19<00:16, 283.40it/s] 54%|███████████████████████████▉                        | 5228/9741 [00:19<00:15, 284.82it/s] 54%|████████████████████████████                        | 5257/9741 [00:19<00:15, 285.81it/s] 54%|████████████████████████████▏                       | 5286/9741 [00:19<00:15, 286.67it/s] 55%|████████████████████████████▎                       | 5315/9741 [00:19<00:15, 285.30it/s] 55%|████████████████████████████▌                       | 5344/9741 [00:19<00:15, 286.30it/s] 55%|████████████████████████████▋                       | 5373/9741 [00:20<00:15, 287.20it/s] 55%|████████████████████████████▊                       | 5402/9741 [00:20<00:15, 285.72it/s] 56%|████████████████████████████▉                       | 5431/9741 [00:20<00:15, 286.82it/s] 56%|█████████████████████████████▏                      | 5460/9741 [00:20<00:14, 287.54it/s] 56%|█████████████████████████████▎                      | 5490/9741 [00:20<00:14, 289.33it/s] 57%|█████████████████████████████▍                      | 5520/9741 [00:20<00:14, 291.73it/s] 57%|█████████████████████████████▋                      | 5550/9741 [00:20<00:14, 293.30it/s] 57%|█████████████████████████████▊                      | 5580/9741 [00:20<00:14, 294.27it/s] 58%|█████████████████████████████▉                      | 5610/9741 [00:20<00:14, 295.00it/s] 58%|██████████████████████████████                      | 5640/9741 [00:21<00:13, 294.06it/s] 58%|██████████████████████████████▎                     | 5670/9741 [00:21<00:13, 295.04it/s] 59%|██████████████████████████████▍                     | 5700/9741 [00:21<00:13, 295.79it/s] 59%|██████████████████████████████▌                     | 5730/9741 [00:21<00:13, 296.39it/s] 59%|██████████████████████████████▋                     | 5760/9741 [00:21<00:13, 296.51it/s] 59%|██████████████████████████████▉                     | 5790/9741 [00:21<00:13, 296.18it/s] 60%|███████████████████████████████                     | 5820/9741 [00:21<00:13, 293.67it/s] 60%|███████████████████████████████▏                    | 5850/9741 [00:21<00:13, 292.63it/s] 60%|███████████████████████████████▍                    | 5880/9741 [00:21<00:13, 294.07it/s] 61%|███████████████████████████████▌                    | 5910/9741 [00:21<00:12, 295.19it/s] 61%|███████████████████████████████▋                    | 5940/9741 [00:22<00:12, 295.90it/s] 61%|███████████████████████████████▊                    | 5970/9741 [00:22<00:12, 296.54it/s] 62%|████████████████████████████████                    | 6000/9741 [00:22<00:12, 296.76it/s] 62%|████████████████████████████████▏                   | 6030/9741 [00:22<00:12, 297.07it/s] 62%|████████████████████████████████▎                   | 6060/9741 [00:22<00:12, 297.26it/s] 63%|████████████████████████████████▌                   | 6090/9741 [00:22<00:12, 295.35it/s] 63%|████████████████████████████████▋                   | 6120/9741 [00:22<00:12, 295.67it/s] 63%|████████████████████████████████▊                   | 6150/9741 [00:22<00:12, 295.99it/s] 63%|████████████████████████████████▉                   | 6180/9741 [00:22<00:12, 296.57it/s] 64%|█████████████████████████████████▏                  | 6210/9741 [00:22<00:11, 296.70it/s] 64%|█████████████████████████████████▎                  | 6240/9741 [00:23<00:11, 296.49it/s] 64%|█████████████████████████████████▍                  | 6270/9741 [00:23<00:11, 296.56it/s] 65%|█████████████████████████████████▋                  | 6300/9741 [00:23<00:11, 296.52it/s] 65%|█████████████████████████████████▊                  | 6330/9741 [00:23<00:11, 291.75it/s] 65%|█████████████████████████████████▉                  | 6360/9741 [00:23<00:11, 292.99it/s] 66%|██████████████████████████████████                  | 6390/9741 [00:23<00:11, 293.96it/s] 66%|██████████████████████████████████▎                 | 6420/9741 [00:23<00:11, 294.55it/s] 66%|██████████████████████████████████▍                 | 6450/9741 [00:23<00:11, 295.04it/s] 67%|██████████████████████████████████▌                 | 6480/9741 [00:23<00:11, 295.27it/s] 67%|██████████████████████████████████▊                 | 6510/9741 [00:23<00:10, 295.97it/s] 67%|██████████████████████████████████▉                 | 6540/9741 [00:24<00:10, 294.47it/s] 67%|███████████████████████████████████                 | 6570/9741 [00:24<00:10, 295.28it/s] 68%|███████████████████████████████████▏                | 6600/9741 [00:24<00:10, 295.77it/s] 68%|███████████████████████████████████▍                | 6630/9741 [00:24<00:10, 296.34it/s] 68%|███████████████████████████████████▌                | 6660/9741 [00:24<00:10, 296.80it/s] 69%|███████████████████████████████████▋                | 6690/9741 [00:24<00:10, 296.92it/s] 69%|███████████████████████████████████▊                | 6720/9741 [00:24<00:10, 295.78it/s] 69%|████████████████████████████████████                | 6750/9741 [00:24<00:10, 296.05it/s] 70%|████████████████████████████████████▏               | 6780/9741 [00:24<00:10, 294.60it/s] 70%|████████████████████████████████████▎               | 6810/9741 [00:24<00:09, 293.55it/s] 70%|████████████████████████████████████▌               | 6840/9741 [00:25<00:09, 294.79it/s] 71%|████████████████████████████████████▋               | 6870/9741 [00:25<00:09, 295.69it/s] 71%|████████████████████████████████████▊               | 6900/9741 [00:25<00:09, 296.15it/s] 71%|████████████████████████████████████▉               | 6930/9741 [00:25<00:09, 296.64it/s] 71%|█████████████████████████████████████▏              | 6960/9741 [00:25<00:09, 296.45it/s] 72%|█████████████████████████████████████▎              | 6990/9741 [00:25<00:09, 295.01it/s] 72%|█████████████████████████████████████▍              | 7020/9741 [00:25<00:09, 295.44it/s] 72%|█████████████████████████████████████▋              | 7050/9741 [00:25<00:09, 296.28it/s] 73%|█████████████████████████████████████▊              | 7080/9741 [00:25<00:08, 296.70it/s] 73%|█████████████████████████████████████▉              | 7110/9741 [00:25<00:08, 296.91it/s] 73%|██████████████████████████████████████              | 7140/9741 [00:26<00:08, 297.32it/s] 74%|██████████████████████████████████████▎             | 7170/9741 [00:26<00:08, 297.28it/s] 74%|██████████████████████████████████████▍             | 7200/9741 [00:26<00:08, 297.27it/s] 74%|██████████████████████████████████████▌             | 7230/9741 [00:26<00:08, 295.35it/s] 75%|██████████████████████████████████████▊             | 7260/9741 [00:26<00:08, 295.99it/s] 75%|██████████████████████████████████████▉             | 7290/9741 [00:26<00:08, 294.22it/s] 75%|███████████████████████████████████████             | 7320/9741 [00:26<00:08, 292.05it/s] 75%|███████████████████████████████████████▏            | 7350/9741 [00:26<00:08, 293.35it/s] 76%|███████████████████████████████████████▍            | 7380/9741 [00:26<00:08, 294.81it/s] 76%|███████████████████████████████████████▌            | 7410/9741 [00:26<00:07, 295.66it/s] 76%|███████████████████████████████████████▋            | 7440/9741 [00:27<00:08, 262.24it/s] 77%|███████████████████████████████████████▉            | 7470/9741 [00:27<00:08, 271.62it/s] 77%|████████████████████████████████████████            | 7500/9741 [00:27<00:08, 278.95it/s] 77%|████████████████████████████████████████▏           | 7530/9741 [00:27<00:07, 283.68it/s] 78%|████████████████████████████████████████▎           | 7560/9741 [00:27<00:07, 287.46it/s] 78%|████████████████████████████████████████▌           | 7590/9741 [00:27<00:07, 289.99it/s] 78%|████████████████████████████████████████▋           | 7620/9741 [00:27<00:07, 292.15it/s] 79%|████████████████████████████████████████▊           | 7650/9741 [00:27<00:07, 293.47it/s] 79%|████████████████████████████████████████▉           | 7680/9741 [00:27<00:07, 292.62it/s] 79%|█████████████████████████████████████████▏          | 7710/9741 [00:28<00:06, 294.16it/s] 79%|█████████████████████████████████████████▎          | 7740/9741 [00:28<00:06, 295.52it/s] 80%|█████████████████████████████████████████▍          | 7770/9741 [00:28<00:06, 296.10it/s] 80%|█████████████████████████████████████████▋          | 7800/9741 [00:28<00:06, 296.30it/s] 80%|█████████████████████████████████████████▊          | 7830/9741 [00:28<00:06, 296.67it/s] 81%|█████████████████████████████████████████▉          | 7860/9741 [00:28<00:06, 296.96it/s] 81%|██████████████████████████████████████████          | 7890/9741 [00:28<00:06, 296.62it/s] 81%|██████████████████████████████████████████▎         | 7920/9741 [00:28<00:06, 293.58it/s] 82%|██████████████████████████████████████████▍         | 7950/9741 [00:28<00:06, 294.70it/s] 82%|██████████████████████████████████████████▌         | 7980/9741 [00:28<00:05, 295.45it/s] 82%|██████████████████████████████████████████▊         | 8010/9741 [00:29<00:05, 295.93it/s] 83%|██████████████████████████████████████████▉         | 8040/9741 [00:29<00:05, 296.48it/s] 83%|███████████████████████████████████████████         | 8070/9741 [00:29<00:05, 296.73it/s] 83%|███████████████████████████████████████████▏        | 8100/9741 [00:29<00:05, 296.84it/s] 83%|███████████████████████████████████████████▍        | 8130/9741 [00:29<00:05, 295.44it/s] 84%|███████████████████████████████████████████▌        | 8160/9741 [00:29<00:05, 295.82it/s] 84%|███████████████████████████████████████████▋        | 8190/9741 [00:29<00:05, 296.12it/s] 84%|███████████████████████████████████████████▉        | 8220/9741 [00:29<00:05, 296.39it/s] 85%|████████████████████████████████████████████        | 8250/9741 [00:29<00:05, 296.73it/s] 85%|████████████████████████████████████████████▏       | 8280/9741 [00:29<00:04, 296.86it/s] 85%|████████████████████████████████████████████▎       | 8310/9741 [00:30<00:04, 296.74it/s] 86%|████████████████████████████████████████████▌       | 8340/9741 [00:30<00:04, 297.09it/s] 86%|████████████████████████████████████████████▋       | 8370/9741 [00:30<00:04, 295.43it/s] 86%|████████████████████████████████████████████▊       | 8400/9741 [00:30<00:04, 295.98it/s] 87%|█████████████████████████████████████████████       | 8430/9741 [00:30<00:04, 296.64it/s] 87%|█████████████████████████████████████████████▏      | 8460/9741 [00:30<00:04, 297.05it/s] 87%|█████████████████████████████████████████████▎      | 8490/9741 [00:30<00:04, 296.91it/s] 87%|█████████████████████████████████████████████▍      | 8520/9741 [00:30<00:04, 297.14it/s] 88%|█████████████████████████████████████████████▋      | 8550/9741 [00:30<00:04, 297.18it/s] 88%|█████████████████████████████████████████████▊      | 8580/9741 [00:30<00:03, 295.44it/s] 88%|█████████████████████████████████████████████▉      | 8610/9741 [00:31<00:03, 295.93it/s] 89%|██████████████████████████████████████████████      | 8640/9741 [00:31<00:03, 296.23it/s] 89%|██████████████████████████████████████████████▎     | 8670/9741 [00:31<00:03, 296.54it/s] 89%|██████████████████████████████████████████████▍     | 8700/9741 [00:31<00:03, 296.77it/s] 90%|██████████████████████████████████████████████▌     | 8730/9741 [00:31<00:03, 296.87it/s] 90%|██████████████████████████████████████████████▊     | 8760/9741 [00:31<00:03, 296.35it/s] 90%|██████████████████████████████████████████████▉     | 8790/9741 [00:31<00:03, 296.04it/s] 91%|███████████████████████████████████████████████     | 8820/9741 [00:31<00:03, 294.48it/s] 91%|███████████████████████████████████████████████▏    | 8850/9741 [00:31<00:03, 295.12it/s] 91%|███████████████████████████████████████████████▍    | 8880/9741 [00:31<00:02, 295.94it/s] 91%|███████████████████████████████████████████████▌    | 8910/9741 [00:32<00:02, 296.38it/s] 92%|███████████████████████████████████████████████▋    | 8940/9741 [00:32<00:02, 296.76it/s] 92%|███████████████████████████████████████████████▉    | 8970/9741 [00:32<00:02, 296.98it/s] 92%|████████████████████████████████████████████████    | 9000/9741 [00:32<00:02, 296.93it/s] 93%|████████████████████████████████████████████████▏   | 9030/9741 [00:32<00:02, 295.13it/s] 93%|████████████████████████████████████████████████▎   | 9060/9741 [00:32<00:02, 295.38it/s] 93%|████████████████████████████████████████████████▌   | 9090/9741 [00:32<00:02, 295.84it/s] 94%|████████████████████████████████████████████████▋   | 9120/9741 [00:32<00:02, 296.15it/s] 94%|████████████████████████████████████████████████▊   | 9150/9741 [00:32<00:01, 296.49it/s] 94%|█████████████████████████████████████████████████   | 9180/9741 [00:33<00:01, 296.89it/s] 95%|█████████████████████████████████████████████████▏  | 9210/9741 [00:33<00:01, 296.89it/s] 95%|█████████████████████████████████████████████████▎  | 9240/9741 [00:33<00:01, 296.91it/s] 95%|█████████████████████████████████████████████████▍  | 9270/9741 [00:33<00:01, 295.10it/s] 95%|█████████████████████████████████████████████████▋  | 9300/9741 [00:33<00:01, 295.64it/s] 96%|█████████████████████████████████████████████████▊  | 9330/9741 [00:33<00:01, 296.31it/s] 96%|█████████████████████████████████████████████████▉  | 9360/9741 [00:33<00:01, 295.93it/s] 96%|██████████████████████████████████████████████████▏ | 9390/9741 [00:33<00:01, 296.26it/s] 97%|██████████████████████████████████████████████████▎ | 9420/9741 [00:33<00:01, 296.56it/s] 97%|██████████████████████████████████████████████████▍ | 9450/9741 [00:33<00:00, 296.68it/s] 97%|██████████████████████████████████████████████████▌ | 9480/9741 [00:34<00:00, 296.92it/s] 98%|██████████████████████████████████████████████████▊ | 9510/9741 [00:34<00:00, 295.02it/s] 98%|██████████████████████████████████████████████████▉ | 9540/9741 [00:34<00:00, 295.75it/s] 98%|███████████████████████████████████████████████████ | 9570/9741 [00:34<00:00, 296.24it/s] 99%|███████████████████████████████████████████████████▏| 9600/9741 [00:34<00:00, 296.47it/s] 99%|███████████████████████████████████████████████████▍| 9630/9741 [00:34<00:00, 296.34it/s] 99%|███████████████████████████████████████████████████▌| 9660/9741 [00:34<00:00, 296.01it/s] 99%|███████████████████████████████████████████████████▋| 9690/9741 [00:34<00:00, 296.08it/s]100%|███████████████████████████████████████████████████▉| 9720/9741 [00:34<00:00, 293.56it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:34<00:00, 279.05it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.05s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.45s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.54s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:07<00:14,  7.46s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.93s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.46s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.48s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.32s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.49s/it]
Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:13<00:06,  6.52s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.99s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.99s/it]
[2023-08-21 17:29:10,290] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:19<00:00,  6.16s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:19<00:00,  6.35s/it]
[2023-08-21 17:29:26,123] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 17:29:26,124] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 17:29:26,125] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 17:29:26,125] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 17:29:26,125] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 17:29:26,125] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 17:29:26,125] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 17:29:26,125] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 17:29:26,125] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 17:29:26,125] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 17:29:26,125] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 17:29:26,125] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f9d15017fd0>
[2023-08-21 17:29:26,125] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 17:29:26,125] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f9d0a3ab220>
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 17:29:26,126] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 17:29:26,127] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 17:29:26,127] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5667102336883545 seconds
Loading extension module utils...
Time to load utils op: 0.5044846534729004 seconds
Loading extension module utils...
Time to load utils op: 0.5031814575195312 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input: Tonya has $150.00 on her credit card.  If she leaves any balance on her card at the end of the month, she is charged 20% interest.  If she makes a $50.00 payment on her card, what will be the new balance?
Output: 120

Input: In her first term, Governor Sandoval gave twice as many commencement addresses as Governor Hawkins. Governor Sloan gave ten more commencement addresses than Governor Sandoval in the same amount of time. If Governor Sandoval gave 12 commencement addresses, how many commencement addresses did the three of them give altogether?
Output: 40

Input: If Buzz bought a pizza with 78 slices at a restaurant and then decided to share it with the waiter in the ratio of 5:8, with Buzz's ratio being 5, what's twenty less the number of slices of pizza that the waiter ate?
Output: 28

Input: Jolene and Phil have four children, each with the same birthday.  They gave birth to their first child exactly 15 years ago.  They gave birth to their second child exactly one year after the birth of their first child.  They gave birth to their third child on the fourth birthday of their second child. Two years after the birth of their third child, they gave birth to their fourth child.  How old, in years, is their fourth child?
Output: 8

Input: Each purple book has 230 pages. Each orange book contains 510 pages. Mirella read 5 purple books and 4 orange books. How many more orange pages did she read than purple pages?
Output: 890

Input: Isabella has $45 more than Sam but only $15 more than Giselle. If Giselle has $120, calculate the total amount of money each shopper will receive if Isabella, Sam, and Giselle donate the money to three shoppers at their local town's supermarket who then decides to share it equally.
Output: 115

Input: It takes 40 minutes to freeze ice cubes and 3 minutes per smoothie to turn them into smoothies once they're frozen. How long does it take to make 5 smoothies?
Output: 55

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o22-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.6049535274505615 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3338911) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_17:29:35
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3338912)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-21_17:29:35
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3338913)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-21_17:29:35
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3338914)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_17:29:35
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3338911)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o23-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 23
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 17:29:39,224] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o23-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 23
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o23-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 19/9741 [00:00<00:53, 181.25it/s]  0%|▏                                                     | 38/9741 [00:00<00:53, 181.84it/s]  1%|▎                                                     | 57/9741 [00:00<00:53, 182.37it/s]  1%|▍                                                     | 76/9741 [00:00<00:52, 182.66it/s]  1%|▌                                                     | 95/9741 [00:00<00:52, 182.77it/s]  1%|▌                                                    | 114/9741 [00:00<00:53, 180.08it/s]  1%|▋                                                    | 133/9741 [00:00<00:53, 180.87it/s]  2%|▊                                                    | 152/9741 [00:00<00:52, 181.56it/s]  2%|▉                                                    | 171/9741 [00:00<00:52, 181.95it/s]  2%|█                                                    | 190/9741 [00:01<00:52, 182.00it/s]  2%|█▏                                                   | 209/9741 [00:01<00:52, 180.86it/s]  2%|█▏                                                   | 228/9741 [00:01<00:52, 181.38it/s]  3%|█▎                                                   | 247/9741 [00:01<00:52, 181.70it/s]  3%|█▍                                                   | 266/9741 [00:01<00:52, 181.99it/s]  3%|█▌                                                   | 285/9741 [00:01<00:51, 182.11it/s]  3%|█▋                                                   | 304/9741 [00:01<00:52, 179.97it/s]  3%|█▊                                                   | 323/9741 [00:01<00:52, 180.51it/s]  4%|█▊                                                   | 342/9741 [00:01<00:51, 181.12it/s]  4%|█▉                                                   | 361/9741 [00:01<00:51, 181.52it/s]  4%|██                                                   | 380/9741 [00:02<00:51, 181.96it/s]  4%|██▏                                                  | 407/9741 [00:02<00:45, 206.79it/s]  4%|██▎                                                  | 434/9741 [00:02<00:41, 224.79it/s]  5%|██▌                                                  | 463/9741 [00:02<00:38, 241.47it/s]  5%|██▋                                                  | 491/9741 [00:02<00:36, 252.49it/s]  5%|██▊                                                  | 519/9741 [00:02<00:35, 260.60it/s]  6%|██▉                                                  | 547/9741 [00:02<00:34, 265.42it/s]  6%|███▏                                                 | 575/9741 [00:02<00:34, 268.70it/s]  6%|███▎                                                 | 603/9741 [00:02<00:33, 271.44it/s]  6%|███▍                                                 | 631/9741 [00:03<00:33, 273.47it/s]  7%|███▌                                                 | 659/9741 [00:03<00:33, 272.92it/s]  7%|███▋                                                 | 687/9741 [00:03<00:32, 274.45it/s]  7%|███▉                                                 | 715/9741 [00:03<00:32, 275.52it/s]  8%|████                                                 | 743/9741 [00:03<00:32, 276.20it/s]  8%|████▏                                                | 771/9741 [00:03<00:32, 276.64it/s]  8%|████▎                                                | 799/9741 [00:03<00:32, 277.07it/s]  8%|████▍                                                | 827/9741 [00:03<00:32, 276.60it/s]  9%|████▋                                                | 855/9741 [00:03<00:32, 277.24it/s]  9%|████▊                                                | 883/9741 [00:03<00:32, 275.47it/s]  9%|████▉                                                | 911/9741 [00:04<00:32, 275.53it/s] 10%|█████                                                | 939/9741 [00:04<00:31, 276.17it/s] 10%|█████▎                                               | 967/9741 [00:04<00:31, 276.76it/s] 10%|█████▍                                               | 995/9741 [00:04<00:31, 277.13it/s] 11%|█████▍                                              | 1023/9741 [00:04<00:31, 277.48it/s] 11%|█████▌                                              | 1051/9741 [00:04<00:31, 277.91it/s] 11%|█████▊                                              | 1079/9741 [00:04<00:31, 278.20it/s] 11%|█████▉                                              | 1107/9741 [00:04<00:31, 278.10it/s] 12%|██████                                              | 1135/9741 [00:04<00:31, 276.27it/s] 12%|██████▏                                             | 1163/9741 [00:04<00:30, 276.79it/s] 12%|██████▎                                             | 1191/9741 [00:05<00:30, 277.17it/s] 13%|██████▌                                             | 1219/9741 [00:05<00:30, 277.17it/s] 13%|██████▋                                             | 1247/9741 [00:05<00:30, 277.09it/s] 13%|██████▊                                             | 1275/9741 [00:05<00:30, 275.36it/s] 13%|██████▉                                             | 1303/9741 [00:05<00:30, 275.94it/s] 14%|███████                                             | 1331/9741 [00:05<00:30, 276.08it/s] 14%|███████▎                                            | 1359/9741 [00:05<00:30, 274.25it/s] 14%|███████▍                                            | 1387/9741 [00:05<00:30, 273.84it/s] 15%|███████▌                                            | 1415/9741 [00:05<00:31, 264.46it/s] 15%|███████▋                                            | 1443/9741 [00:05<00:31, 266.69it/s] 15%|███████▊                                            | 1471/9741 [00:06<00:30, 269.22it/s] 15%|████████                                            | 1499/9741 [00:06<00:30, 269.72it/s] 16%|████████▏                                           | 1527/9741 [00:06<00:30, 271.52it/s] 16%|████████▎                                           | 1555/9741 [00:06<00:29, 273.05it/s] 16%|████████▍                                           | 1583/9741 [00:06<00:29, 271.95it/s] 17%|████████▌                                           | 1611/9741 [00:06<00:29, 271.05it/s] 17%|████████▋                                           | 1639/9741 [00:06<00:29, 273.20it/s] 17%|████████▉                                           | 1667/9741 [00:06<00:29, 274.76it/s] 17%|█████████                                           | 1695/9741 [00:06<00:29, 275.74it/s] 18%|█████████▏                                          | 1723/9741 [00:06<00:29, 276.46it/s] 18%|█████████▎                                          | 1751/9741 [00:07<00:28, 276.96it/s] 18%|█████████▍                                          | 1779/9741 [00:07<00:28, 276.48it/s] 19%|█████████▋                                          | 1807/9741 [00:07<00:31, 250.46it/s] 19%|█████████▊                                          | 1835/9741 [00:07<00:30, 257.90it/s] 19%|█████████▉                                          | 1863/9741 [00:07<00:29, 263.47it/s] 19%|██████████                                          | 1891/9741 [00:07<00:29, 267.56it/s] 20%|██████████▏                                         | 1919/9741 [00:07<00:29, 269.70it/s] 20%|██████████▍                                         | 1947/9741 [00:07<00:28, 271.97it/s] 20%|██████████▌                                         | 1975/9741 [00:07<00:28, 272.14it/s] 21%|██████████▋                                         | 2003/9741 [00:08<00:28, 273.79it/s] 21%|██████████▊                                         | 2031/9741 [00:08<00:28, 272.75it/s] 21%|██████████▉                                         | 2059/9741 [00:08<00:28, 273.50it/s] 21%|███████████▏                                        | 2087/9741 [00:08<00:27, 274.17it/s] 22%|███████████▎                                        | 2115/9741 [00:08<00:27, 275.23it/s] 22%|███████████▍                                        | 2143/9741 [00:08<00:27, 275.98it/s] 22%|███████████▌                                        | 2171/9741 [00:08<00:27, 276.63it/s] 23%|███████████▋                                        | 2199/9741 [00:08<00:27, 276.90it/s] 23%|███████████▉                                        | 2227/9741 [00:08<00:27, 277.17it/s] 23%|████████████                                        | 2255/9741 [00:08<00:27, 275.20it/s] 23%|████████████▏                                       | 2283/9741 [00:09<00:27, 275.83it/s] 24%|████████████▎                                       | 2311/9741 [00:09<00:26, 276.33it/s] 24%|████████████▍                                       | 2339/9741 [00:09<00:26, 276.54it/s] 24%|████████████▋                                       | 2367/9741 [00:09<00:26, 276.79it/s] 25%|████████████▊                                       | 2395/9741 [00:09<00:26, 277.09it/s] 25%|████████████▉                                       | 2423/9741 [00:09<00:26, 277.35it/s] 25%|█████████████                                       | 2451/9741 [00:09<00:26, 276.56it/s] 25%|█████████████▏                                      | 2479/9741 [00:09<00:26, 274.06it/s] 26%|█████████████▍                                      | 2507/9741 [00:09<00:26, 274.91it/s] 26%|█████████████▌                                      | 2535/9741 [00:09<00:26, 275.30it/s] 26%|█████████████▋                                      | 2563/9741 [00:10<00:26, 275.83it/s] 27%|█████████████▊                                      | 2591/9741 [00:10<00:25, 276.38it/s] 27%|█████████████▉                                      | 2619/9741 [00:10<00:25, 276.94it/s] 27%|██████████████▏                                     | 2647/9741 [00:10<00:25, 276.91it/s] 27%|██████████████▎                                     | 2675/9741 [00:10<00:25, 276.66it/s] 28%|██████████████▍                                     | 2703/9741 [00:10<00:25, 274.43it/s] 28%|██████████████▌                                     | 2731/9741 [00:10<00:25, 275.10it/s] 28%|██████████████▋                                     | 2759/9741 [00:10<00:25, 275.56it/s] 29%|██████████████▉                                     | 2787/9741 [00:10<00:25, 275.94it/s] 29%|███████████████                                     | 2815/9741 [00:10<00:25, 276.22it/s] 29%|███████████████▏                                    | 2843/9741 [00:11<00:24, 276.71it/s] 29%|███████████████▎                                    | 2871/9741 [00:11<00:24, 277.14it/s] 30%|███████████████▍                                    | 2899/9741 [00:11<00:24, 277.08it/s] 30%|███████████████▋                                    | 2927/9741 [00:11<00:24, 275.29it/s] 30%|███████████████▊                                    | 2955/9741 [00:11<00:24, 275.62it/s] 31%|███████████████▉                                    | 2983/9741 [00:11<00:24, 276.02it/s] 31%|████████████████                                    | 3011/9741 [00:11<00:24, 276.38it/s] 31%|████████████████▏                                   | 3039/9741 [00:11<00:24, 275.80it/s] 31%|████████████████▎                                   | 3067/9741 [00:11<00:24, 275.93it/s] 32%|████████████████▌                                   | 3095/9741 [00:11<00:24, 276.23it/s] 32%|████████████████▋                                   | 3123/9741 [00:12<00:23, 276.77it/s] 32%|████████████████▊                                   | 3151/9741 [00:12<00:23, 274.81it/s] 33%|████████████████▉                                   | 3179/9741 [00:12<00:23, 275.61it/s] 33%|█████████████████                                   | 3207/9741 [00:12<00:23, 276.17it/s] 33%|█████████████████▎                                  | 3235/9741 [00:12<00:23, 276.51it/s] 33%|█████████████████▍                                  | 3263/9741 [00:12<00:23, 276.89it/s] 34%|█████████████████▌                                  | 3291/9741 [00:12<00:23, 276.83it/s] 34%|█████████████████▋                                  | 3319/9741 [00:12<00:23, 276.96it/s] 34%|█████████████████▊                                  | 3347/9741 [00:12<00:23, 276.85it/s] 35%|██████████████████                                  | 3375/9741 [00:12<00:23, 276.43it/s] 35%|██████████████████▏                                 | 3403/9741 [00:13<00:23, 274.67it/s] 35%|██████████████████▎                                 | 3431/9741 [00:13<00:22, 275.32it/s] 36%|██████████████████▍                                 | 3459/9741 [00:13<00:22, 275.67it/s] 36%|██████████████████▌                                 | 3487/9741 [00:13<00:22, 275.85it/s] 36%|██████████████████▊                                 | 3515/9741 [00:13<00:22, 275.90it/s] 36%|██████████████████▉                                 | 3543/9741 [00:13<00:22, 276.29it/s] 37%|███████████████████                                 | 3571/9741 [00:13<00:22, 273.86it/s] 37%|███████████████████▏                                | 3599/9741 [00:13<00:22, 268.14it/s] 37%|███████████████████▎                                | 3626/9741 [00:13<00:22, 268.61it/s] 38%|███████████████████▌                                | 3654/9741 [00:14<00:22, 271.01it/s] 38%|███████████████████▋                                | 3682/9741 [00:14<00:22, 272.77it/s] 38%|███████████████████▊                                | 3710/9741 [00:14<00:22, 274.00it/s] 38%|███████████████████▉                                | 3738/9741 [00:14<00:21, 275.14it/s] 39%|████████████████████                                | 3766/9741 [00:14<00:21, 275.67it/s] 39%|████████████████████▎                               | 3794/9741 [00:14<00:21, 276.01it/s] 39%|████████████████████▍                               | 3822/9741 [00:14<00:21, 276.30it/s] 40%|████████████████████▌                               | 3850/9741 [00:14<00:21, 273.76it/s] 40%|████████████████████▋                               | 3878/9741 [00:14<00:21, 274.77it/s] 40%|████████████████████▊                               | 3906/9741 [00:14<00:21, 275.47it/s] 40%|█████████████████████                               | 3934/9741 [00:15<00:21, 275.87it/s] 41%|█████████████████████▏                              | 3962/9741 [00:15<00:20, 276.03it/s] 41%|█████████████████████▎                              | 3990/9741 [00:15<00:20, 276.01it/s] 41%|█████████████████████▍                              | 4018/9741 [00:15<00:20, 276.48it/s] 42%|█████████████████████▌                              | 4046/9741 [00:15<00:20, 276.76it/s] 42%|█████████████████████▋                              | 4074/9741 [00:15<00:20, 274.87it/s] 42%|█████████████████████▉                              | 4102/9741 [00:15<00:20, 275.35it/s] 42%|██████████████████████                              | 4130/9741 [00:15<00:20, 275.79it/s] 43%|██████████████████████▏                             | 4158/9741 [00:15<00:20, 275.23it/s] 43%|██████████████████████▎                             | 4186/9741 [00:15<00:20, 275.74it/s] 43%|██████████████████████▍                             | 4214/9741 [00:16<00:20, 276.14it/s] 44%|██████████████████████▋                             | 4242/9741 [00:16<00:19, 276.27it/s] 44%|██████████████████████▊                             | 4270/9741 [00:16<00:19, 276.60it/s] 44%|██████████████████████▉                             | 4298/9741 [00:16<00:19, 272.70it/s] 44%|███████████████████████                             | 4326/9741 [00:16<00:19, 273.84it/s] 45%|███████████████████████▏                            | 4354/9741 [00:16<00:19, 274.73it/s] 45%|███████████████████████▍                            | 4382/9741 [00:16<00:19, 275.35it/s] 45%|███████████████████████▌                            | 4410/9741 [00:16<00:19, 275.66it/s] 46%|███████████████████████▋                            | 4438/9741 [00:16<00:19, 275.88it/s] 46%|███████████████████████▊                            | 4466/9741 [00:16<00:19, 275.86it/s] 46%|███████████████████████▉                            | 4494/9741 [00:17<00:19, 276.09it/s] 46%|████████████████████████▏                           | 4522/9741 [00:17<00:20, 250.83it/s] 47%|████████████████████████▎                           | 4550/9741 [00:17<00:20, 257.92it/s] 47%|████████████████████████▍                           | 4578/9741 [00:17<00:19, 263.03it/s] 47%|████████████████████████▌                           | 4606/9741 [00:17<00:19, 266.95it/s] 48%|████████████████████████▋                           | 4634/9741 [00:17<00:18, 270.01it/s] 48%|████████████████████████▉                           | 4662/9741 [00:17<00:18, 272.04it/s] 48%|█████████████████████████                           | 4690/9741 [00:17<00:18, 272.83it/s] 48%|█████████████████████████▏                          | 4718/9741 [00:17<00:18, 274.05it/s] 49%|█████████████████████████▎                          | 4746/9741 [00:18<00:26, 185.16it/s] 49%|█████████████████████████▍                          | 4774/9741 [00:18<00:24, 205.44it/s] 49%|█████████████████████████▋                          | 4802/9741 [00:18<00:22, 222.46it/s] 50%|█████████████████████████▊                          | 4830/9741 [00:18<00:20, 236.21it/s] 50%|█████████████████████████▉                          | 4858/9741 [00:18<00:19, 246.92it/s] 50%|██████████████████████████                          | 4886/9741 [00:18<00:19, 255.05it/s] 50%|██████████████████████████▏                         | 4914/9741 [00:18<00:18, 261.07it/s] 51%|██████████████████████████▍                         | 4942/9741 [00:18<00:18, 265.57it/s] 51%|██████████████████████████▌                         | 4970/9741 [00:18<00:17, 267.03it/s] 51%|██████████████████████████▋                         | 4998/9741 [00:19<00:17, 269.44it/s] 52%|██████████████████████████▊                         | 5026/9741 [00:19<00:17, 271.15it/s] 52%|██████████████████████████▉                         | 5054/9741 [00:19<00:17, 272.65it/s] 52%|███████████████████████████▏                        | 5082/9741 [00:19<00:17, 273.87it/s] 52%|███████████████████████████▎                        | 5110/9741 [00:19<00:16, 274.68it/s] 53%|███████████████████████████▍                        | 5138/9741 [00:19<00:16, 275.09it/s] 53%|███████████████████████████▌                        | 5166/9741 [00:19<00:16, 275.61it/s] 53%|███████████████████████████▋                        | 5194/9741 [00:19<00:16, 271.05it/s] 54%|███████████████████████████▉                        | 5222/9741 [00:19<00:16, 272.40it/s] 54%|████████████████████████████                        | 5250/9741 [00:20<00:16, 273.66it/s] 54%|████████████████████████████▏                       | 5278/9741 [00:20<00:16, 274.37it/s] 54%|████████████████████████████▎                       | 5306/9741 [00:20<00:16, 274.63it/s] 55%|████████████████████████████▍                       | 5334/9741 [00:20<00:16, 274.46it/s] 55%|████████████████████████████▌                       | 5362/9741 [00:20<00:15, 274.96it/s] 55%|████████████████████████████▊                       | 5390/9741 [00:20<00:15, 275.38it/s] 56%|████████████████████████████▉                       | 5418/9741 [00:20<00:15, 273.69it/s] 56%|█████████████████████████████                       | 5446/9741 [00:20<00:15, 274.30it/s] 56%|█████████████████████████████▏                      | 5474/9741 [00:20<00:15, 275.14it/s] 56%|█████████████████████████████▍                      | 5503/9741 [00:20<00:15, 277.74it/s] 57%|█████████████████████████████▌                      | 5532/9741 [00:21<00:15, 279.78it/s] 57%|█████████████████████████████▋                      | 5561/9741 [00:21<00:14, 281.25it/s] 57%|█████████████████████████████▊                      | 5590/9741 [00:21<00:14, 281.74it/s] 58%|█████████████████████████████▉                      | 5619/9741 [00:21<00:14, 282.55it/s] 58%|██████████████████████████████▏                     | 5648/9741 [00:21<00:14, 281.17it/s] 58%|██████████████████████████████▎                     | 5677/9741 [00:21<00:14, 279.90it/s] 59%|██████████████████████████████▍                     | 5706/9741 [00:21<00:14, 281.23it/s] 59%|██████████████████████████████▌                     | 5735/9741 [00:21<00:14, 282.39it/s] 59%|██████████████████████████████▊                     | 5764/9741 [00:21<00:14, 282.59it/s] 59%|██████████████████████████████▉                     | 5793/9741 [00:21<00:13, 282.99it/s] 60%|███████████████████████████████                     | 5822/9741 [00:22<00:13, 283.30it/s] 60%|███████████████████████████████▏                    | 5851/9741 [00:22<00:13, 281.54it/s] 60%|███████████████████████████████▍                    | 5880/9741 [00:22<00:13, 282.46it/s] 61%|███████████████████████████████▌                    | 5909/9741 [00:22<00:13, 283.09it/s] 61%|███████████████████████████████▋                    | 5938/9741 [00:22<00:13, 283.12it/s] 61%|███████████████████████████████▊                    | 5967/9741 [00:22<00:13, 283.58it/s] 62%|████████████████████████████████                    | 5996/9741 [00:22<00:13, 283.78it/s] 62%|████████████████████████████████▏                   | 6025/9741 [00:22<00:13, 284.03it/s] 62%|████████████████████████████████▎                   | 6054/9741 [00:22<00:12, 284.36it/s] 62%|████████████████████████████████▍                   | 6083/9741 [00:22<00:12, 282.45it/s] 63%|████████████████████████████████▋                   | 6112/9741 [00:23<00:12, 283.04it/s] 63%|████████████████████████████████▊                   | 6141/9741 [00:23<00:12, 280.80it/s] 63%|████████████████████████████████▉                   | 6170/9741 [00:23<00:12, 281.63it/s] 64%|█████████████████████████████████                   | 6199/9741 [00:23<00:12, 282.25it/s] 64%|█████████████████████████████████▏                  | 6228/9741 [00:23<00:12, 282.62it/s] 64%|█████████████████████████████████▍                  | 6257/9741 [00:23<00:12, 282.83it/s] 65%|█████████████████████████████████▌                  | 6286/9741 [00:23<00:12, 283.31it/s] 65%|█████████████████████████████████▋                  | 6315/9741 [00:23<00:12, 281.21it/s] 65%|█████████████████████████████████▊                  | 6344/9741 [00:23<00:12, 281.60it/s] 65%|██████████████████████████████████                  | 6373/9741 [00:24<00:11, 282.40it/s] 66%|██████████████████████████████████▏                 | 6402/9741 [00:24<00:11, 283.05it/s] 66%|██████████████████████████████████▎                 | 6431/9741 [00:24<00:11, 283.40it/s] 66%|██████████████████████████████████▍                 | 6460/9741 [00:24<00:11, 283.41it/s] 67%|██████████████████████████████████▋                 | 6489/9741 [00:24<00:11, 283.80it/s] 67%|██████████████████████████████████▊                 | 6518/9741 [00:24<00:11, 283.74it/s] 67%|██████████████████████████████████▉                 | 6547/9741 [00:24<00:11, 282.14it/s] 68%|███████████████████████████████████                 | 6576/9741 [00:24<00:11, 282.62it/s] 68%|███████████████████████████████████▎                | 6605/9741 [00:24<00:11, 282.79it/s] 68%|███████████████████████████████████▍                | 6634/9741 [00:24<00:11, 280.29it/s] 68%|███████████████████████████████████▌                | 6663/9741 [00:25<00:10, 281.23it/s] 69%|███████████████████████████████████▋                | 6692/9741 [00:25<00:10, 281.81it/s] 69%|███████████████████████████████████▉                | 6721/9741 [00:25<00:10, 282.36it/s] 69%|████████████████████████████████████                | 6750/9741 [00:25<00:10, 282.98it/s] 70%|████████████████████████████████████▏               | 6779/9741 [00:25<00:10, 281.39it/s] 70%|████████████████████████████████████▎               | 6808/9741 [00:25<00:10, 282.36it/s] 70%|████████████████████████████████████▍               | 6837/9741 [00:25<00:10, 282.94it/s] 70%|████████████████████████████████████▋               | 6866/9741 [00:25<00:10, 283.37it/s] 71%|████████████████████████████████████▊               | 6895/9741 [00:25<00:10, 283.13it/s] 71%|████████████████████████████████████▉               | 6924/9741 [00:25<00:09, 282.84it/s] 71%|█████████████████████████████████████               | 6953/9741 [00:26<00:09, 283.36it/s] 72%|█████████████████████████████████████▎              | 6982/9741 [00:26<00:09, 283.64it/s] 72%|█████████████████████████████████████▍              | 7011/9741 [00:26<00:09, 281.76it/s] 72%|█████████████████████████████████████▌              | 7040/9741 [00:26<00:09, 282.51it/s] 73%|█████████████████████████████████████▋              | 7069/9741 [00:26<00:09, 282.95it/s] 73%|█████████████████████████████████████▉              | 7098/9741 [00:26<00:09, 283.25it/s] 73%|██████████████████████████████████████              | 7127/9741 [00:26<00:09, 283.63it/s] 73%|██████████████████████████████████████▏             | 7156/9741 [00:26<00:09, 283.93it/s] 74%|██████████████████████████████████████▎             | 7185/9741 [00:26<00:09, 283.80it/s] 74%|██████████████████████████████████████▌             | 7214/9741 [00:26<00:08, 281.60it/s] 74%|██████████████████████████████████████▋             | 7243/9741 [00:27<00:08, 280.56it/s] 75%|██████████████████████████████████████▊             | 7272/9741 [00:27<00:08, 281.53it/s] 75%|██████████████████████████████████████▉             | 7301/9741 [00:27<00:08, 282.33it/s] 75%|███████████████████████████████████████▏            | 7330/9741 [00:27<00:08, 282.93it/s] 76%|███████████████████████████████████████▎            | 7359/9741 [00:27<00:08, 283.35it/s] 76%|███████████████████████████████████████▍            | 7388/9741 [00:27<00:08, 283.83it/s] 76%|███████████████████████████████████████▌            | 7417/9741 [00:27<00:08, 283.95it/s] 76%|███████████████████████████████████████▋            | 7446/9741 [00:27<00:09, 249.70it/s] 77%|███████████████████████████████████████▉            | 7475/9741 [00:27<00:08, 258.35it/s] 77%|████████████████████████████████████████            | 7504/9741 [00:28<00:08, 265.06it/s] 77%|████████████████████████████████████████▏           | 7533/9741 [00:28<00:08, 269.98it/s] 78%|████████████████████████████████████████▎           | 7562/9741 [00:28<00:07, 274.09it/s] 78%|████████████████████████████████████████▌           | 7591/9741 [00:28<00:07, 276.85it/s] 78%|████████████████████████████████████████▋           | 7620/9741 [00:28<00:07, 278.79it/s] 79%|████████████████████████████████████████▊           | 7649/9741 [00:28<00:07, 280.23it/s] 79%|████████████████████████████████████████▉           | 7678/9741 [00:28<00:07, 279.30it/s] 79%|█████████████████████████████████████████▏          | 7707/9741 [00:28<00:07, 280.82it/s] 79%|█████████████████████████████████████████▎          | 7736/9741 [00:28<00:07, 282.06it/s] 80%|█████████████████████████████████████████▍          | 7765/9741 [00:28<00:06, 282.64it/s] 80%|█████████████████████████████████████████▌          | 7794/9741 [00:29<00:06, 282.69it/s] 80%|█████████████████████████████████████████▊          | 7823/9741 [00:29<00:06, 283.24it/s] 81%|█████████████████████████████████████████▉          | 7852/9741 [00:29<00:06, 283.14it/s] 81%|██████████████████████████████████████████          | 7881/9741 [00:29<00:06, 283.32it/s] 81%|██████████████████████████████████████████▏         | 7910/9741 [00:29<00:06, 281.91it/s] 82%|██████████████████████████████████████████▍         | 7939/9741 [00:29<00:06, 282.29it/s] 82%|██████████████████████████████████████████▌         | 7968/9741 [00:29<00:06, 282.83it/s] 82%|██████████████████████████████████████████▋         | 7997/9741 [00:29<00:06, 281.15it/s] 82%|██████████████████████████████████████████▊         | 8026/9741 [00:29<00:06, 281.26it/s] 83%|██████████████████████████████████████████▉         | 8055/9741 [00:29<00:05, 281.97it/s] 83%|███████████████████████████████████████████▏        | 8084/9741 [00:30<00:05, 282.79it/s] 83%|███████████████████████████████████████████▎        | 8113/9741 [00:30<00:05, 283.22it/s] 84%|███████████████████████████████████████████▍        | 8142/9741 [00:30<00:05, 281.89it/s] 84%|███████████████████████████████████████████▌        | 8171/9741 [00:30<00:05, 282.53it/s] 84%|███████████████████████████████████████████▊        | 8200/9741 [00:30<00:05, 283.14it/s] 84%|███████████████████████████████████████████▉        | 8229/9741 [00:30<00:05, 283.25it/s] 85%|████████████████████████████████████████████        | 8258/9741 [00:30<00:05, 283.64it/s] 85%|████████████████████████████████████████████▏       | 8287/9741 [00:30<00:05, 283.70it/s] 85%|████████████████████████████████████████████▍       | 8316/9741 [00:30<00:05, 283.65it/s] 86%|████████████████████████████████████████████▌       | 8345/9741 [00:31<00:04, 283.91it/s] 86%|████████████████████████████████████████████▋       | 8374/9741 [00:31<00:04, 282.12it/s] 86%|████████████████████████████████████████████▊       | 8403/9741 [00:31<00:04, 282.23it/s] 87%|█████████████████████████████████████████████       | 8432/9741 [00:31<00:04, 283.17it/s] 87%|█████████████████████████████████████████████▏      | 8461/9741 [00:31<00:04, 283.63it/s] 87%|█████████████████████████████████████████████▎      | 8490/9741 [00:31<00:04, 283.34it/s] 87%|█████████████████████████████████████████████▍      | 8519/9741 [00:31<00:04, 283.73it/s] 88%|█████████████████████████████████████████████▋      | 8548/9741 [00:31<00:04, 283.70it/s] 88%|█████████████████████████████████████████████▊      | 8577/9741 [00:31<00:04, 282.00it/s] 88%|█████████████████████████████████████████████▉      | 8606/9741 [00:31<00:04, 282.10it/s] 89%|██████████████████████████████████████████████      | 8635/9741 [00:32<00:03, 282.70it/s] 89%|██████████████████████████████████████████████▎     | 8664/9741 [00:32<00:03, 282.77it/s] 89%|██████████████████████████████████████████████▍     | 8693/9741 [00:32<00:03, 283.25it/s] 90%|██████████████████████████████████████████████▌     | 8722/9741 [00:32<00:03, 283.61it/s] 90%|██████████████████████████████████████████████▋     | 8751/9741 [00:32<00:03, 283.66it/s] 90%|██████████████████████████████████████████████▊     | 8780/9741 [00:32<00:03, 283.80it/s] 90%|███████████████████████████████████████████████     | 8809/9741 [00:32<00:03, 282.13it/s] 91%|███████████████████████████████████████████████▏    | 8838/9741 [00:32<00:03, 282.80it/s] 91%|███████████████████████████████████████████████▎    | 8867/9741 [00:32<00:03, 283.18it/s] 91%|███████████████████████████████████████████████▍    | 8896/9741 [00:32<00:02, 283.49it/s] 92%|███████████████████████████████████████████████▋    | 8925/9741 [00:33<00:02, 283.85it/s] 92%|███████████████████████████████████████████████▊    | 8954/9741 [00:33<00:02, 284.01it/s] 92%|███████████████████████████████████████████████▉    | 8983/9741 [00:33<00:02, 283.96it/s] 93%|████████████████████████████████████████████████    | 9012/9741 [00:33<00:02, 283.92it/s] 93%|████████████████████████████████████████████████▎   | 9041/9741 [00:33<00:02, 282.15it/s] 93%|████████████████████████████████████████████████▍   | 9070/9741 [00:33<00:02, 282.62it/s] 93%|████████████████████████████████████████████████▌   | 9099/9741 [00:33<00:02, 281.57it/s] 94%|████████████████████████████████████████████████▋   | 9128/9741 [00:33<00:02, 281.17it/s] 94%|████████████████████████████████████████████████▉   | 9157/9741 [00:33<00:02, 281.06it/s] 94%|█████████████████████████████████████████████████   | 9186/9741 [00:33<00:01, 280.49it/s] 95%|█████████████████████████████████████████████████▏  | 9215/9741 [00:34<00:01, 280.48it/s] 95%|█████████████████████████████████████████████████▎  | 9244/9741 [00:34<00:01, 280.67it/s] 95%|█████████████████████████████████████████████████▌  | 9273/9741 [00:34<00:01, 279.06it/s] 95%|█████████████████████████████████████████████████▋  | 9302/9741 [00:34<00:01, 279.37it/s] 96%|█████████████████████████████████████████████████▊  | 9331/9741 [00:34<00:01, 279.85it/s] 96%|█████████████████████████████████████████████████▉  | 9360/9741 [00:34<00:01, 280.09it/s] 96%|██████████████████████████████████████████████████  | 9389/9741 [00:34<00:01, 280.33it/s] 97%|██████████████████████████████████████████████████▎ | 9418/9741 [00:34<00:01, 280.35it/s] 97%|██████████████████████████████████████████████████▍ | 9447/9741 [00:34<00:01, 280.33it/s] 97%|██████████████████████████████████████████████████▌ | 9476/9741 [00:35<00:00, 280.51it/s] 98%|██████████████████████████████████████████████████▋ | 9505/9741 [00:35<00:00, 278.69it/s] 98%|██████████████████████████████████████████████████▉ | 9534/9741 [00:35<00:00, 279.33it/s] 98%|███████████████████████████████████████████████████ | 9563/9741 [00:35<00:00, 279.73it/s] 98%|███████████████████████████████████████████████████▏| 9592/9741 [00:35<00:00, 279.95it/s] 99%|███████████████████████████████████████████████████▎| 9621/9741 [00:35<00:00, 280.28it/s] 99%|███████████████████████████████████████████████████▌| 9650/9741 [00:35<00:00, 280.22it/s] 99%|███████████████████████████████████████████████████▋| 9679/9741 [00:35<00:00, 280.43it/s]100%|███████████████████████████████████████████████████▊| 9708/9741 [00:35<00:00, 280.51it/s]100%|███████████████████████████████████████████████████▉| 9737/9741 [00:35<00:00, 277.58it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:35<00:00, 270.73it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.32s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.31s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.27s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.39s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.21s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.21s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.18s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.26s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.59s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]
[2023-08-21 17:31:07,269] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.57s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.62s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
[2023-08-21 17:31:16,587] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 17:31:16,589] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 17:31:16,589] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 17:31:16,589] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 17:31:16,589] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 17:31:16,589] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f24edbcafd0>
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 17:31:16,590] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f24ed2ed220>
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 17:31:16,591] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 17:31:16,592] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 17:31:16,592] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5649199485778809 seconds
Loading extension module utils...
Time to load utils op: 0.5048787593841553 seconds
Loading extension module utils...
Time to load utils op: 0.5045650005340576 seconds
Loading extension module utils...
Time to load utils op: 0.5045609474182129 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input: Tonya has $150.00 on her credit card.  If she leaves any balance on her card at the end of the month, she is charged 20% interest.  If she makes a $50.00 payment on her card, what will be the new balance?
Output: 120

Input: In her first term, Governor Sandoval gave twice as many commencement addresses as Governor Hawkins. Governor Sloan gave ten more commencement addresses than Governor Sandoval in the same amount of time. If Governor Sandoval gave 12 commencement addresses, how many commencement addresses did the three of them give altogether?
Output: 40

Input: If Buzz bought a pizza with 78 slices at a restaurant and then decided to share it with the waiter in the ratio of 5:8, with Buzz's ratio being 5, what's twenty less the number of slices of pizza that the waiter ate?
Output: 28

Input: Jolene and Phil have four children, each with the same birthday.  They gave birth to their first child exactly 15 years ago.  They gave birth to their second child exactly one year after the birth of their first child.  They gave birth to their third child on the fourth birthday of their second child. Two years after the birth of their third child, they gave birth to their fourth child.  How old, in years, is their fourth child?
Output: 8

Input: Each purple book has 230 pages. Each orange book contains 510 pages. Mirella read 5 purple books and 4 orange books. How many more orange pages did she read than purple pages?
Output: 890

Input: Isabella has $45 more than Sam but only $15 more than Giselle. If Giselle has $120, calculate the total amount of money each shopper will receive if Isabella, Sam, and Giselle donate the money to three shoppers at their local town's supermarket who then decides to share it equally.
Output: 115

Input: It takes 40 minutes to freeze ice cubes and 3 minutes per smoothie to turn them into smoothies once they're frozen. How long does it take to make 5 smoothies?
Output: 55

Input: Belle eats 4 dog biscuits and 2 rawhide bones every evening. If each rawhide bone is $1, and each dog biscuit is $0.25, then how much does it cost, in dollars, to feed Belle these treats for a week?
Output: 21

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o23-tgsm8k-s1-rFalse
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3340101) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_17:31:22
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3340102)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-21_17:31:22
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3340103)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-21_17:31:22
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3340104)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_17:31:22
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3340101)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o24-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 24
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 17:31:25,264] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o24-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 24
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o24-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 18/9741 [00:00<00:55, 173.83it/s]  0%|▏                                                     | 36/9741 [00:00<00:55, 174.13it/s]  1%|▎                                                     | 54/9741 [00:00<00:55, 174.51it/s]  1%|▍                                                     | 72/9741 [00:00<00:55, 174.46it/s]  1%|▍                                                     | 90/9741 [00:00<00:55, 174.45it/s]  1%|▌                                                    | 108/9741 [00:00<00:55, 174.64it/s]  1%|▋                                                    | 126/9741 [00:00<00:55, 174.60it/s]  1%|▊                                                    | 144/9741 [00:00<00:54, 174.84it/s]  2%|▉                                                    | 162/9741 [00:00<00:54, 175.60it/s]  2%|▉                                                    | 180/9741 [00:01<00:54, 175.76it/s]  2%|█                                                    | 198/9741 [00:01<00:54, 173.67it/s]  2%|█▏                                                   | 216/9741 [00:01<00:55, 173.00it/s]  2%|█▎                                                   | 234/9741 [00:01<00:54, 174.06it/s]  3%|█▎                                                   | 252/9741 [00:01<00:54, 174.66it/s]  3%|█▍                                                   | 270/9741 [00:01<00:54, 175.24it/s]  3%|█▌                                                   | 288/9741 [00:01<00:53, 175.58it/s]  3%|█▋                                                   | 306/9741 [00:01<00:53, 175.94it/s]  3%|█▊                                                   | 324/9741 [00:01<00:53, 175.93it/s]  4%|█▊                                                   | 342/9741 [00:01<00:53, 176.12it/s]  4%|█▉                                                   | 360/9741 [00:02<00:53, 173.75it/s]  4%|██                                                   | 378/9741 [00:02<00:53, 174.38it/s]  4%|██▏                                                  | 396/9741 [00:02<00:53, 175.01it/s]  4%|██▎                                                  | 414/9741 [00:02<00:53, 175.11it/s]  4%|██▎                                                  | 432/9741 [00:02<00:54, 172.36it/s]  5%|██▍                                                  | 450/9741 [00:02<00:53, 173.43it/s]  5%|██▌                                                  | 468/9741 [00:02<00:53, 174.00it/s]  5%|██▋                                                  | 486/9741 [00:02<00:53, 174.41it/s]  5%|██▊                                                  | 509/9741 [00:02<00:48, 189.15it/s]  6%|██▉                                                  | 536/9741 [00:02<00:43, 212.43it/s]  6%|███                                                  | 563/9741 [00:03<00:40, 228.10it/s]  6%|███▏                                                 | 590/9741 [00:03<00:38, 239.66it/s]  6%|███▎                                                 | 617/9741 [00:03<00:36, 247.85it/s]  7%|███▌                                                 | 644/9741 [00:03<00:35, 253.86it/s]  7%|███▋                                                 | 671/9741 [00:03<00:35, 257.05it/s]  7%|███▊                                                 | 699/9741 [00:03<00:34, 261.36it/s]  7%|███▉                                                 | 727/9741 [00:03<00:34, 264.16it/s]  8%|████                                                 | 755/9741 [00:03<00:33, 266.22it/s]  8%|████▎                                                | 783/9741 [00:03<00:33, 267.74it/s]  8%|████▍                                                | 811/9741 [00:04<00:33, 268.78it/s]  9%|████▌                                                | 839/9741 [00:04<00:33, 269.38it/s]  9%|████▋                                                | 867/9741 [00:04<00:32, 269.95it/s]  9%|████▊                                                | 894/9741 [00:04<00:32, 268.11it/s]  9%|█████                                                | 921/9741 [00:04<00:32, 268.16it/s] 10%|█████▏                                               | 949/9741 [00:04<00:32, 268.97it/s] 10%|█████▎                                               | 977/9741 [00:04<00:32, 269.29it/s] 10%|█████▎                                              | 1005/9741 [00:04<00:32, 269.72it/s] 11%|█████▌                                              | 1033/9741 [00:04<00:32, 269.95it/s] 11%|█████▋                                              | 1061/9741 [00:04<00:32, 270.22it/s] 11%|█████▊                                              | 1089/9741 [00:05<00:31, 270.65it/s] 11%|█████▉                                              | 1117/9741 [00:05<00:32, 268.70it/s] 12%|██████                                              | 1145/9741 [00:05<00:31, 269.43it/s] 12%|██████▎                                             | 1173/9741 [00:05<00:31, 269.89it/s] 12%|██████▍                                             | 1201/9741 [00:05<00:31, 270.18it/s] 13%|██████▌                                             | 1229/9741 [00:05<00:31, 270.22it/s] 13%|██████▋                                             | 1257/9741 [00:05<00:31, 268.87it/s] 13%|██████▊                                             | 1285/9741 [00:05<00:31, 269.32it/s] 13%|███████                                             | 1313/9741 [00:05<00:31, 269.74it/s] 14%|███████▏                                            | 1340/9741 [00:05<00:31, 267.95it/s] 14%|███████▎                                            | 1368/9741 [00:06<00:31, 268.85it/s] 14%|███████▍                                            | 1396/9741 [00:06<00:31, 269.19it/s] 15%|███████▌                                            | 1424/9741 [00:06<00:30, 269.50it/s] 15%|███████▊                                            | 1452/9741 [00:06<00:30, 269.69it/s] 15%|███████▉                                            | 1479/9741 [00:06<00:30, 268.66it/s] 15%|████████                                            | 1506/9741 [00:06<00:30, 268.84it/s] 16%|████████▏                                           | 1534/9741 [00:06<00:30, 269.27it/s] 16%|████████▎                                           | 1562/9741 [00:06<00:30, 267.87it/s] 16%|████████▍                                           | 1589/9741 [00:06<00:30, 268.35it/s] 17%|████████▋                                           | 1616/9741 [00:07<00:30, 266.80it/s] 17%|████████▊                                           | 1644/9741 [00:07<00:30, 268.01it/s] 17%|████████▉                                           | 1672/9741 [00:07<00:30, 268.75it/s] 17%|█████████                                           | 1700/9741 [00:07<00:29, 269.19it/s] 18%|█████████▏                                          | 1727/9741 [00:07<00:29, 269.40it/s] 18%|█████████▎                                          | 1755/9741 [00:07<00:29, 269.77it/s] 18%|█████████▌                                          | 1783/9741 [00:07<00:29, 269.92it/s] 19%|█████████▋                                          | 1810/9741 [00:07<00:32, 245.85it/s] 19%|█████████▊                                          | 1837/9741 [00:07<00:31, 252.47it/s] 19%|█████████▉                                          | 1865/9741 [00:07<00:30, 257.60it/s] 19%|██████████                                          | 1892/9741 [00:08<00:30, 261.12it/s] 20%|██████████▏                                         | 1919/9741 [00:08<00:29, 263.46it/s] 20%|██████████▍                                         | 1946/9741 [00:08<00:29, 265.36it/s] 20%|██████████▌                                         | 1973/9741 [00:08<00:29, 265.21it/s] 21%|██████████▋                                         | 2000/9741 [00:08<00:29, 266.59it/s] 21%|██████████▊                                         | 2027/9741 [00:08<00:29, 265.54it/s] 21%|██████████▉                                         | 2054/9741 [00:08<00:28, 266.64it/s] 21%|███████████                                         | 2081/9741 [00:08<00:28, 267.55it/s] 22%|███████████▎                                        | 2108/9741 [00:08<00:28, 268.11it/s] 22%|███████████▍                                        | 2135/9741 [00:08<00:28, 268.64it/s] 22%|███████████▌                                        | 2162/9741 [00:09<00:28, 269.00it/s] 22%|███████████▋                                        | 2189/9741 [00:09<00:28, 269.29it/s] 23%|███████████▊                                        | 2216/9741 [00:09<00:27, 269.39it/s] 23%|███████████▉                                        | 2243/9741 [00:09<00:28, 267.60it/s] 23%|████████████                                        | 2270/9741 [00:09<00:27, 268.18it/s] 24%|████████████▎                                       | 2297/9741 [00:09<00:27, 268.62it/s] 24%|████████████▍                                       | 2324/9741 [00:09<00:27, 268.85it/s] 24%|████████████▌                                       | 2351/9741 [00:09<00:27, 269.15it/s] 24%|████████████▋                                       | 2379/9741 [00:09<00:27, 269.51it/s] 25%|████████████▊                                       | 2407/9741 [00:09<00:27, 269.82it/s] 25%|████████████▉                                       | 2434/9741 [00:10<00:27, 269.03it/s] 25%|█████████████▏                                      | 2461/9741 [00:10<00:27, 268.26it/s] 26%|█████████████▎                                      | 2488/9741 [00:10<00:27, 265.69it/s] 26%|█████████████▍                                      | 2515/9741 [00:10<00:27, 265.77it/s] 26%|█████████████▌                                      | 2542/9741 [00:10<00:27, 265.67it/s] 26%|█████████████▋                                      | 2569/9741 [00:10<00:26, 265.86it/s] 27%|█████████████▊                                      | 2596/9741 [00:10<00:26, 265.12it/s] 27%|██████████████                                      | 2623/9741 [00:10<00:26, 264.45it/s] 27%|██████████████▏                                     | 2650/9741 [00:10<00:27, 254.74it/s] 27%|██████████████▎                                     | 2677/9741 [00:11<00:27, 257.09it/s] 28%|██████████████▍                                     | 2703/9741 [00:11<00:27, 257.53it/s] 28%|██████████████▌                                     | 2730/9741 [00:11<00:26, 259.88it/s] 28%|██████████████▋                                     | 2757/9741 [00:11<00:26, 261.67it/s] 29%|██████████████▊                                     | 2784/9741 [00:11<00:26, 262.71it/s] 29%|███████████████                                     | 2811/9741 [00:11<00:26, 263.65it/s] 29%|███████████████▏                                    | 2838/9741 [00:11<00:26, 264.62it/s] 29%|███████████████▎                                    | 2865/9741 [00:11<00:25, 265.27it/s] 30%|███████████████▍                                    | 2892/9741 [00:11<00:25, 265.48it/s] 30%|███████████████▌                                    | 2919/9741 [00:11<00:25, 265.74it/s] 30%|███████████████▋                                    | 2946/9741 [00:12<00:25, 263.79it/s] 31%|███████████████▊                                    | 2973/9741 [00:12<00:25, 264.54it/s] 31%|████████████████                                    | 3000/9741 [00:12<00:25, 265.15it/s] 31%|████████████████▏                                   | 3027/9741 [00:12<00:25, 265.41it/s] 31%|████████████████▎                                   | 3054/9741 [00:12<00:25, 265.44it/s] 32%|████████████████▍                                   | 3081/9741 [00:12<00:25, 265.57it/s] 32%|████████████████▌                                   | 3108/9741 [00:12<00:25, 265.19it/s] 32%|████████████████▋                                   | 3135/9741 [00:12<00:24, 265.43it/s] 32%|████████████████▉                                   | 3162/9741 [00:12<00:24, 263.30it/s] 33%|█████████████████                                   | 3189/9741 [00:12<00:24, 264.44it/s] 33%|█████████████████▏                                  | 3216/9741 [00:13<00:24, 264.79it/s] 33%|█████████████████▎                                  | 3243/9741 [00:13<00:24, 265.35it/s] 34%|█████████████████▍                                  | 3270/9741 [00:13<00:24, 265.70it/s] 34%|█████████████████▌                                  | 3297/9741 [00:13<00:24, 265.77it/s] 34%|█████████████████▋                                  | 3324/9741 [00:13<00:24, 264.81it/s] 34%|█████████████████▉                                  | 3351/9741 [00:13<00:24, 265.27it/s] 35%|██████████████████                                  | 3378/9741 [00:13<00:24, 263.34it/s] 35%|██████████████████▏                                 | 3405/9741 [00:13<00:23, 264.14it/s] 35%|██████████████████▎                                 | 3432/9741 [00:13<00:23, 264.56it/s] 36%|██████████████████▍                                 | 3459/9741 [00:13<00:23, 264.61it/s] 36%|██████████████████▌                                 | 3486/9741 [00:14<00:23, 264.89it/s] 36%|██████████████████▊                                 | 3513/9741 [00:14<00:23, 264.80it/s] 36%|██████████████████▉                                 | 3540/9741 [00:14<00:23, 264.93it/s] 37%|███████████████████                                 | 3567/9741 [00:14<00:23, 264.98it/s] 37%|███████████████████▏                                | 3594/9741 [00:14<00:23, 265.13it/s] 37%|███████████████████▎                                | 3621/9741 [00:14<00:23, 264.10it/s] 37%|███████████████████▍                                | 3648/9741 [00:14<00:22, 265.72it/s] 38%|███████████████████▌                                | 3675/9741 [00:14<00:22, 266.75it/s] 38%|███████████████████▊                                | 3702/9741 [00:14<00:22, 267.55it/s] 38%|███████████████████▉                                | 3730/9741 [00:14<00:22, 268.36it/s] 39%|████████████████████                                | 3757/9741 [00:15<00:22, 268.23it/s] 39%|████████████████████▏                               | 3784/9741 [00:15<00:22, 268.37it/s] 39%|████████████████████▎                               | 3811/9741 [00:15<00:22, 268.72it/s] 39%|████████████████████▍                               | 3838/9741 [00:15<00:22, 267.01it/s] 40%|████████████████████▋                               | 3865/9741 [00:15<00:21, 267.78it/s] 40%|████████████████████▊                               | 3892/9741 [00:15<00:21, 268.36it/s] 40%|████████████████████▉                               | 3919/9741 [00:15<00:21, 268.60it/s] 41%|█████████████████████                               | 3946/9741 [00:15<00:21, 268.78it/s] 41%|█████████████████████▏                              | 3973/9741 [00:15<00:21, 268.92it/s] 41%|█████████████████████▎                              | 4000/9741 [00:15<00:21, 268.89it/s] 41%|█████████████████████▍                              | 4027/9741 [00:16<00:21, 269.19it/s] 42%|█████████████████████▋                              | 4054/9741 [00:16<00:21, 269.21it/s] 42%|█████████████████████▊                              | 4081/9741 [00:16<00:21, 267.39it/s] 42%|█████████████████████▉                              | 4108/9741 [00:16<00:21, 267.81it/s] 42%|██████████████████████                              | 4135/9741 [00:16<00:20, 268.40it/s] 43%|██████████████████████▏                             | 4162/9741 [00:16<00:20, 268.63it/s] 43%|██████████████████████▎                             | 4189/9741 [00:16<00:20, 268.07it/s] 43%|██████████████████████▌                             | 4216/9741 [00:16<00:20, 267.75it/s] 44%|██████████████████████▋                             | 4243/9741 [00:16<00:20, 268.17it/s] 44%|██████████████████████▊                             | 4270/9741 [00:16<00:20, 267.29it/s] 44%|██████████████████████▉                             | 4297/9741 [00:17<00:20, 264.94it/s] 44%|███████████████████████                             | 4324/9741 [00:17<00:20, 265.95it/s] 45%|███████████████████████▏                            | 4351/9741 [00:17<00:20, 267.00it/s] 45%|███████████████████████▎                            | 4378/9741 [00:17<00:20, 267.72it/s] 45%|███████████████████████▌                            | 4405/9741 [00:17<00:19, 268.03it/s] 45%|███████████████████████▋                            | 4432/9741 [00:17<00:19, 268.30it/s] 46%|███████████████████████▊                            | 4459/9741 [00:17<00:19, 268.54it/s] 46%|███████████████████████▉                            | 4486/9741 [00:17<00:19, 268.73it/s] 46%|████████████████████████                            | 4513/9741 [00:17<00:21, 245.71it/s] 47%|████████████████████████▏                           | 4540/9741 [00:18<00:20, 251.66it/s] 47%|████████████████████████▍                           | 4567/9741 [00:18<00:20, 256.69it/s] 47%|████████████████████████▌                           | 4594/9741 [00:18<00:19, 260.41it/s] 47%|████████████████████████▋                           | 4621/9741 [00:18<00:19, 262.76it/s] 48%|████████████████████████▊                           | 4648/9741 [00:18<00:19, 264.60it/s] 48%|████████████████████████▉                           | 4675/9741 [00:18<00:19, 263.90it/s] 48%|█████████████████████████                           | 4702/9741 [00:18<00:18, 265.69it/s] 49%|█████████████████████████▏                          | 4729/9741 [00:18<00:18, 266.86it/s] 49%|█████████████████████████▍                          | 4756/9741 [00:19<00:27, 178.42it/s] 49%|█████████████████████████▌                          | 4783/9741 [00:19<00:24, 198.50it/s] 49%|█████████████████████████▋                          | 4810/9741 [00:19<00:22, 215.45it/s] 50%|█████████████████████████▊                          | 4837/9741 [00:19<00:21, 228.89it/s] 50%|█████████████████████████▉                          | 4864/9741 [00:19<00:20, 239.39it/s] 50%|██████████████████████████                          | 4891/9741 [00:19<00:19, 247.59it/s] 50%|██████████████████████████▎                         | 4918/9741 [00:19<00:19, 253.69it/s] 51%|██████████████████████████▍                         | 4945/9741 [00:19<00:18, 256.59it/s] 51%|██████████████████████████▌                         | 4972/9741 [00:19<00:18, 260.16it/s] 51%|██████████████████████████▋                         | 4999/9741 [00:19<00:18, 262.75it/s] 52%|██████████████████████████▊                         | 5026/9741 [00:20<00:17, 264.65it/s] 52%|██████████████████████████▉                         | 5053/9741 [00:20<00:17, 265.98it/s] 52%|███████████████████████████                         | 5080/9741 [00:20<00:17, 264.92it/s] 52%|███████████████████████████▎                        | 5107/9741 [00:20<00:17, 266.10it/s] 53%|███████████████████████████▍                        | 5134/9741 [00:20<00:17, 266.94it/s] 53%|███████████████████████████▌                        | 5161/9741 [00:20<00:17, 267.61it/s] 53%|███████████████████████████▋                        | 5188/9741 [00:20<00:17, 265.79it/s] 54%|███████████████████████████▊                        | 5215/9741 [00:20<00:16, 266.86it/s] 54%|███████████████████████████▉                        | 5242/9741 [00:20<00:16, 267.43it/s] 54%|████████████████████████████▏                       | 5269/9741 [00:20<00:16, 267.25it/s] 54%|████████████████████████████▎                       | 5296/9741 [00:21<00:16, 266.83it/s] 55%|████████████████████████████▍                       | 5323/9741 [00:21<00:16, 266.57it/s] 55%|████████████████████████████▌                       | 5350/9741 [00:21<00:16, 266.18it/s] 55%|████████████████████████████▋                       | 5377/9741 [00:21<00:16, 266.13it/s] 55%|████████████████████████████▊                       | 5404/9741 [00:21<00:16, 264.08it/s] 56%|████████████████████████████▉                       | 5431/9741 [00:21<00:16, 264.57it/s] 56%|█████████████████████████████▏                      | 5458/9741 [00:21<00:16, 264.94it/s] 56%|█████████████████████████████▎                      | 5485/9741 [00:21<00:15, 266.24it/s] 57%|█████████████████████████████▍                      | 5513/9741 [00:21<00:15, 268.27it/s] 57%|█████████████████████████████▌                      | 5540/9741 [00:21<00:15, 267.78it/s] 57%|█████████████████████████████▋                      | 5568/9741 [00:22<00:15, 269.36it/s] 57%|█████████████████████████████▊                      | 5596/9741 [00:22<00:15, 270.11it/s] 58%|██████████████████████████████                      | 5624/9741 [00:22<00:15, 269.32it/s] 58%|██████████████████████████████▏                     | 5652/9741 [00:22<00:15, 270.35it/s] 58%|██████████████████████████████▎                     | 5680/9741 [00:22<00:14, 271.19it/s] 59%|██████████████████████████████▍                     | 5708/9741 [00:22<00:14, 271.76it/s] 59%|██████████████████████████████▌                     | 5736/9741 [00:22<00:14, 272.26it/s] 59%|██████████████████████████████▊                     | 5764/9741 [00:22<00:14, 272.50it/s] 59%|██████████████████████████████▉                     | 5792/9741 [00:22<00:14, 272.71it/s] 60%|███████████████████████████████                     | 5820/9741 [00:22<00:14, 272.88it/s] 60%|███████████████████████████████▏                    | 5848/9741 [00:23<00:14, 272.70it/s] 60%|███████████████████████████████▎                    | 5876/9741 [00:23<00:14, 271.02it/s] 61%|███████████████████████████████▌                    | 5904/9741 [00:23<00:14, 271.58it/s] 61%|███████████████████████████████▋                    | 5932/9741 [00:23<00:14, 272.00it/s] 61%|███████████████████████████████▊                    | 5960/9741 [00:23<00:13, 272.48it/s] 61%|███████████████████████████████▉                    | 5988/9741 [00:23<00:13, 270.93it/s] 62%|████████████████████████████████                    | 6016/9741 [00:23<00:13, 271.41it/s] 62%|████████████████████████████████▎                   | 6044/9741 [00:23<00:13, 272.05it/s] 62%|████████████████████████████████▍                   | 6072/9741 [00:23<00:13, 272.38it/s] 63%|████████████████████████████████▌                   | 6100/9741 [00:23<00:13, 270.75it/s] 63%|████████████████████████████████▋                   | 6128/9741 [00:24<00:13, 271.23it/s] 63%|████████████████████████████████▊                   | 6156/9741 [00:24<00:13, 271.66it/s] 63%|█████████████████████████████████                   | 6184/9741 [00:24<00:13, 272.20it/s] 64%|█████████████████████████████████▏                  | 6212/9741 [00:24<00:12, 272.41it/s] 64%|█████████████████████████████████▎                  | 6240/9741 [00:24<00:12, 272.40it/s] 64%|█████████████████████████████████▍                  | 6268/9741 [00:24<00:12, 272.39it/s] 65%|█████████████████████████████████▌                  | 6296/9741 [00:24<00:13, 261.75it/s] 65%|█████████████████████████████████▊                  | 6323/9741 [00:24<00:12, 263.11it/s] 65%|█████████████████████████████████▉                  | 6351/9741 [00:24<00:12, 266.19it/s] 65%|██████████████████████████████████                  | 6379/9741 [00:25<00:12, 268.30it/s] 66%|██████████████████████████████████▏                 | 6407/9741 [00:25<00:12, 269.83it/s] 66%|██████████████████████████████████▎                 | 6435/9741 [00:25<00:12, 269.18it/s] 66%|██████████████████████████████████▌                 | 6463/9741 [00:25<00:12, 269.93it/s] 67%|██████████████████████████████████▋                 | 6491/9741 [00:25<00:11, 270.96it/s] 67%|██████████████████████████████████▊                 | 6519/9741 [00:25<00:11, 271.44it/s] 67%|██████████████████████████████████▉                 | 6547/9741 [00:25<00:11, 268.81it/s] 67%|███████████████████████████████████                 | 6575/9741 [00:25<00:11, 269.88it/s] 68%|███████████████████████████████████▏                | 6603/9741 [00:25<00:11, 270.72it/s] 68%|███████████████████████████████████▍                | 6631/9741 [00:25<00:11, 271.47it/s] 68%|███████████████████████████████████▌                | 6659/9741 [00:26<00:11, 272.14it/s] 69%|███████████████████████████████████▋                | 6687/9741 [00:26<00:11, 272.45it/s] 69%|███████████████████████████████████▊                | 6715/9741 [00:26<00:11, 272.66it/s] 69%|███████████████████████████████████▉                | 6743/9741 [00:26<00:10, 272.95it/s] 70%|████████████████████████████████████▏               | 6771/9741 [00:26<00:10, 271.07it/s] 70%|████████████████████████████████████▎               | 6799/9741 [00:26<00:10, 271.78it/s] 70%|████████████████████████████████████▍               | 6827/9741 [00:26<00:10, 272.27it/s] 70%|████████████████████████████████████▌               | 6855/9741 [00:26<00:10, 272.57it/s] 71%|████████████████████████████████████▋               | 6883/9741 [00:26<00:10, 272.83it/s] 71%|████████████████████████████████████▉               | 6911/9741 [00:26<00:10, 270.55it/s] 71%|█████████████████████████████████████               | 6939/9741 [00:27<00:10, 271.32it/s] 72%|█████████████████████████████████████▏              | 6967/9741 [00:27<00:10, 271.87it/s] 72%|█████████████████████████████████████▎              | 6995/9741 [00:27<00:10, 270.18it/s] 72%|█████████████████████████████████████▍              | 7023/9741 [00:27<00:10, 270.91it/s] 72%|█████████████████████████████████████▋              | 7051/9741 [00:27<00:09, 271.72it/s] 73%|█████████████████████████████████████▊              | 7079/9741 [00:27<00:09, 272.03it/s] 73%|█████████████████████████████████████▉              | 7107/9741 [00:27<00:09, 272.36it/s] 73%|██████████████████████████████████████              | 7135/9741 [00:27<00:09, 272.71it/s] 74%|██████████████████████████████████████▏             | 7163/9741 [00:27<00:09, 273.36it/s] 74%|██████████████████████████████████████▍             | 7191/9741 [00:28<00:09, 274.47it/s] 74%|██████████████████████████████████████▌             | 7219/9741 [00:28<00:09, 273.24it/s] 74%|██████████████████████████████████████▋             | 7247/9741 [00:28<00:09, 274.22it/s] 75%|██████████████████████████████████████▊             | 7275/9741 [00:28<00:08, 274.92it/s] 75%|██████████████████████████████████████▉             | 7303/9741 [00:28<00:08, 275.58it/s] 75%|███████████████████████████████████████▏            | 7331/9741 [00:28<00:08, 275.85it/s] 76%|███████████████████████████████████████▎            | 7359/9741 [00:28<00:08, 276.03it/s] 76%|███████████████████████████████████████▍            | 7387/9741 [00:28<00:08, 275.58it/s] 76%|███████████████████████████████████████▌            | 7415/9741 [00:28<00:08, 275.93it/s] 76%|███████████████████████████████████████▋            | 7443/9741 [00:28<00:09, 241.10it/s] 77%|███████████████████████████████████████▉            | 7471/9741 [00:29<00:09, 250.78it/s] 77%|████████████████████████████████████████            | 7499/9741 [00:29<00:08, 257.89it/s] 77%|████████████████████████████████████████▏           | 7527/9741 [00:29<00:08, 262.85it/s] 78%|████████████████████████████████████████▎           | 7555/9741 [00:29<00:08, 266.78it/s] 78%|████████████████████████████████████████▍           | 7583/9741 [00:29<00:08, 269.67it/s] 78%|████████████████████████████████████████▋           | 7611/9741 [00:29<00:07, 271.95it/s] 78%|████████████████████████████████████████▊           | 7639/9741 [00:29<00:07, 273.26it/s] 79%|████████████████████████████████████████▉           | 7667/9741 [00:29<00:07, 272.17it/s] 79%|█████████████████████████████████████████           | 7695/9741 [00:29<00:07, 273.12it/s] 79%|█████████████████████████████████████████▏          | 7723/9741 [00:29<00:07, 274.41it/s] 80%|█████████████████████████████████████████▍          | 7751/9741 [00:30<00:07, 275.15it/s] 80%|█████████████████████████████████████████▌          | 7779/9741 [00:30<00:07, 275.54it/s] 80%|█████████████████████████████████████████▋          | 7807/9741 [00:30<00:07, 276.01it/s] 80%|█████████████████████████████████████████▊          | 7835/9741 [00:30<00:06, 276.32it/s] 81%|█████████████████████████████████████████▉          | 7863/9741 [00:30<00:06, 276.46it/s] 81%|██████████████████████████████████████████          | 7891/9741 [00:30<00:06, 276.51it/s] 81%|██████████████████████████████████████████▎         | 7919/9741 [00:30<00:06, 273.33it/s] 82%|██████████████████████████████████████████▍         | 7947/9741 [00:30<00:06, 274.16it/s] 82%|██████████████████████████████████████████▌         | 7975/9741 [00:30<00:06, 275.04it/s] 82%|██████████████████████████████████████████▋         | 8003/9741 [00:31<00:06, 275.56it/s] 82%|██████████████████████████████████████████▊         | 8031/9741 [00:31<00:06, 275.72it/s] 83%|███████████████████████████████████████████         | 8059/9741 [00:31<00:06, 275.80it/s] 83%|███████████████████████████████████████████▏        | 8087/9741 [00:31<00:05, 276.14it/s] 83%|███████████████████████████████████████████▎        | 8115/9741 [00:31<00:05, 276.57it/s] 84%|███████████████████████████████████████████▍        | 8143/9741 [00:31<00:05, 274.60it/s] 84%|███████████████████████████████████████████▌        | 8171/9741 [00:31<00:05, 275.08it/s] 84%|███████████████████████████████████████████▊        | 8199/9741 [00:31<00:05, 275.63it/s] 84%|███████████████████████████████████████████▉        | 8227/9741 [00:31<00:05, 275.75it/s] 85%|████████████████████████████████████████████        | 8255/9741 [00:31<00:05, 276.05it/s] 85%|████████████████████████████████████████████▏       | 8283/9741 [00:32<00:05, 276.13it/s] 85%|████████████████████████████████████████████▎       | 8311/9741 [00:32<00:05, 276.15it/s] 86%|████████████████████████████████████████████▌       | 8339/9741 [00:32<00:05, 276.40it/s] 86%|████████████████████████████████████████████▋       | 8367/9741 [00:32<00:05, 274.61it/s] 86%|████████████████████████████████████████████▊       | 8395/9741 [00:32<00:04, 275.13it/s] 86%|████████████████████████████████████████████▉       | 8423/9741 [00:32<00:04, 275.75it/s] 87%|█████████████████████████████████████████████       | 8451/9741 [00:32<00:04, 276.03it/s] 87%|█████████████████████████████████████████████▎      | 8479/9741 [00:32<00:04, 275.75it/s] 87%|█████████████████████████████████████████████▍      | 8507/9741 [00:32<00:04, 276.00it/s] 88%|█████████████████████████████████████████████▌      | 8535/9741 [00:32<00:04, 275.46it/s] 88%|█████████████████████████████████████████████▋      | 8563/9741 [00:33<00:04, 275.67it/s] 88%|█████████████████████████████████████████████▊      | 8591/9741 [00:33<00:04, 274.06it/s] 88%|██████████████████████████████████████████████      | 8619/9741 [00:33<00:04, 274.55it/s] 89%|██████████████████████████████████████████████▏     | 8647/9741 [00:33<00:03, 274.99it/s] 89%|██████████████████████████████████████████████▎     | 8675/9741 [00:33<00:03, 275.23it/s] 89%|██████████████████████████████████████████████▍     | 8703/9741 [00:33<00:03, 275.66it/s] 90%|██████████████████████████████████████████████▌     | 8731/9741 [00:33<00:03, 275.94it/s] 90%|██████████████████████████████████████████████▊     | 8759/9741 [00:33<00:03, 276.08it/s] 90%|██████████████████████████████████████████████▉     | 8787/9741 [00:33<00:03, 276.07it/s] 90%|███████████████████████████████████████████████     | 8815/9741 [00:33<00:03, 273.82it/s] 91%|███████████████████████████████████████████████▏    | 8843/9741 [00:34<00:03, 274.37it/s] 91%|███████████████████████████████████████████████▎    | 8871/9741 [00:34<00:03, 275.13it/s] 91%|███████████████████████████████████████████████▌    | 8899/9741 [00:34<00:03, 275.41it/s] 92%|███████████████████████████████████████████████▋    | 8927/9741 [00:34<00:02, 275.81it/s] 92%|███████████████████████████████████████████████▊    | 8955/9741 [00:34<00:02, 276.08it/s] 92%|███████████████████████████████████████████████▉    | 8983/9741 [00:34<00:02, 276.15it/s] 93%|████████████████████████████████████████████████    | 9011/9741 [00:34<00:02, 276.19it/s] 93%|████████████████████████████████████████████████▎   | 9039/9741 [00:34<00:02, 274.06it/s] 93%|████████████████████████████████████████████████▍   | 9067/9741 [00:34<00:02, 274.56it/s] 93%|████████████████████████████████████████████████▌   | 9095/9741 [00:34<00:02, 275.13it/s] 94%|████████████████████████████████████████████████▋   | 9123/9741 [00:35<00:02, 275.55it/s] 94%|████████████████████████████████████████████████▊   | 9151/9741 [00:35<00:02, 275.87it/s] 94%|████████████████████████████████████████████████▉   | 9179/9741 [00:35<00:02, 276.03it/s] 95%|█████████████████████████████████████████████████▏  | 9207/9741 [00:35<00:01, 276.16it/s] 95%|█████████████████████████████████████████████████▎  | 9235/9741 [00:35<00:01, 276.23it/s] 95%|█████████████████████████████████████████████████▍  | 9263/9741 [00:35<00:01, 274.56it/s] 95%|█████████████████████████████████████████████████▌  | 9291/9741 [00:35<00:01, 275.08it/s] 96%|█████████████████████████████████████████████████▋  | 9319/9741 [00:35<00:01, 275.59it/s] 96%|█████████████████████████████████████████████████▉  | 9347/9741 [00:35<00:01, 275.80it/s] 96%|██████████████████████████████████████████████████  | 9375/9741 [00:35<00:01, 276.12it/s] 97%|██████████████████████████████████████████████████▏ | 9403/9741 [00:36<00:01, 276.12it/s] 97%|██████████████████████████████████████████████████▎ | 9431/9741 [00:36<00:01, 276.37it/s] 97%|██████████████████████████████████████████████████▍ | 9459/9741 [00:36<00:01, 276.32it/s] 97%|██████████████████████████████████████████████████▋ | 9487/9741 [00:36<00:00, 274.50it/s] 98%|██████████████████████████████████████████████████▊ | 9515/9741 [00:36<00:00, 274.72it/s] 98%|██████████████████████████████████████████████████▉ | 9543/9741 [00:36<00:00, 274.36it/s] 98%|███████████████████████████████████████████████████ | 9571/9741 [00:36<00:00, 275.01it/s] 99%|███████████████████████████████████████████████████▏| 9599/9741 [00:36<00:00, 274.90it/s] 99%|███████████████████████████████████████████████████▍| 9627/9741 [00:36<00:00, 275.30it/s] 99%|███████████████████████████████████████████████████▌| 9655/9741 [00:37<00:00, 275.42it/s] 99%|███████████████████████████████████████████████████▋| 9683/9741 [00:37<00:00, 275.79it/s]100%|███████████████████████████████████████████████████▊| 9711/9741 [00:37<00:00, 273.83it/s]100%|███████████████████████████████████████████████████▉| 9739/9741 [00:37<00:00, 274.49it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:37<00:00, 260.97it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.24s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.26s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.36s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:06<00:12,  6.04s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.26s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.15s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.27s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:12<00:06,  6.03s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.50s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.63s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
[2023-08-21 17:32:55,069] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.85s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.44s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.60s/it]
[2023-08-21 17:33:08,914] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 17:33:08,915] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f636b4f4fd0>
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 17:33:08,916] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f6367f4a220>
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 17:33:08,917] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 17:33:08,917] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.6518328189849854 seconds
Loading extension module utils...
Time to load utils op: 0.6048688888549805 seconds
Loading extension module utils...
Time to load utils op: 0.7038602828979492 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]Time to load utils op: 0.7051393985748291 seconds
############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input: Tonya has $150.00 on her credit card.  If she leaves any balance on her card at the end of the month, she is charged 20% interest.  If she makes a $50.00 payment on her card, what will be the new balance?
Output: 120

Input: In her first term, Governor Sandoval gave twice as many commencement addresses as Governor Hawkins. Governor Sloan gave ten more commencement addresses than Governor Sandoval in the same amount of time. If Governor Sandoval gave 12 commencement addresses, how many commencement addresses did the three of them give altogether?
Output: 40

Input: If Buzz bought a pizza with 78 slices at a restaurant and then decided to share it with the waiter in the ratio of 5:8, with Buzz's ratio being 5, what's twenty less the number of slices of pizza that the waiter ate?
Output: 28

Input: Jolene and Phil have four children, each with the same birthday.  They gave birth to their first child exactly 15 years ago.  They gave birth to their second child exactly one year after the birth of their first child.  They gave birth to their third child on the fourth birthday of their second child. Two years after the birth of their third child, they gave birth to their fourth child.  How old, in years, is their fourth child?
Output: 8

Input: Each purple book has 230 pages. Each orange book contains 510 pages. Mirella read 5 purple books and 4 orange books. How many more orange pages did she read than purple pages?
Output: 890

Input: Isabella has $45 more than Sam but only $15 more than Giselle. If Giselle has $120, calculate the total amount of money each shopper will receive if Isabella, Sam, and Giselle donate the money to three shoppers at their local town's supermarket who then decides to share it equally.
Output: 115

Input: It takes 40 minutes to freeze ice cubes and 3 minutes per smoothie to turn them into smoothies once they're frozen. How long does it take to make 5 smoothies?
Output: 55

Input: Belle eats 4 dog biscuits and 2 rawhide bones every evening. If each rawhide bone is $1, and each dog biscuit is $0.25, then how much does it cost, in dollars, to feed Belle these treats for a week?
Output: 21

Input: There are 10 6-ounces of glasses that are only 4/5 full of water. How many ounces of water are needed to fill to the brim all those 10 glasses?
Output: 12

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o24-tgsm8k-s1-rFalse
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3341275) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_17:33:18
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3341276)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-21_17:33:18
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3341277)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-21_17:33:18
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3341278)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_17:33:18
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3341275)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o25-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 25
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 17:33:22,363] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o25-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 25
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o25-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 26/9741 [00:00<00:38, 251.41it/s]  1%|▎                                                     | 52/9741 [00:00<00:38, 252.32it/s]  1%|▍                                                     | 78/9741 [00:00<00:38, 252.56it/s]  1%|▌                                                    | 104/9741 [00:00<00:38, 251.94it/s]  1%|▋                                                    | 130/9741 [00:00<00:38, 252.06it/s]  2%|▊                                                    | 156/9741 [00:00<00:38, 251.42it/s]  2%|▉                                                    | 182/9741 [00:00<00:38, 247.46it/s]  2%|█▏                                                   | 207/9741 [00:00<00:38, 246.17it/s]  2%|█▎                                                   | 232/9741 [00:00<00:38, 247.31it/s]  3%|█▍                                                   | 258/9741 [00:01<00:38, 249.15it/s]  3%|█▌                                                   | 284/9741 [00:01<00:37, 249.43it/s]  3%|█▋                                                   | 309/9741 [00:01<00:37, 249.41it/s]  3%|█▊                                                   | 335/9741 [00:01<00:37, 250.34it/s]  4%|█▉                                                   | 361/9741 [00:01<00:37, 251.17it/s]  4%|██                                                   | 387/9741 [00:01<00:37, 251.97it/s]  4%|██▏                                                  | 413/9741 [00:01<00:36, 252.39it/s]  5%|██▍                                                  | 439/9741 [00:01<00:37, 246.07it/s]  5%|██▌                                                  | 465/9741 [00:01<00:37, 248.16it/s]  5%|██▋                                                  | 491/9741 [00:01<00:37, 249.65it/s]  5%|██▊                                                  | 517/9741 [00:02<00:36, 250.78it/s]  6%|██▉                                                  | 543/9741 [00:02<00:36, 251.51it/s]  6%|███                                                  | 569/9741 [00:02<00:36, 250.48it/s]  6%|███▏                                                 | 595/9741 [00:02<00:36, 250.93it/s]  6%|███▍                                                 | 621/9741 [00:02<00:36, 250.15it/s]  7%|███▌                                                 | 647/9741 [00:02<00:36, 251.16it/s]  7%|███▋                                                 | 673/9741 [00:02<00:36, 250.15it/s]  7%|███▊                                                 | 699/9741 [00:02<00:36, 250.28it/s]  7%|███▉                                                 | 725/9741 [00:02<00:35, 250.85it/s]  8%|████                                                 | 751/9741 [00:03<00:35, 251.83it/s]  8%|████▏                                                | 777/9741 [00:03<00:35, 252.62it/s]  8%|████▎                                                | 803/9741 [00:03<00:35, 252.84it/s]  9%|████▌                                                | 829/9741 [00:03<00:35, 253.23it/s]  9%|████▋                                                | 855/9741 [00:03<00:35, 253.53it/s]  9%|████▊                                                | 881/9741 [00:03<00:35, 251.71it/s]  9%|████▉                                                | 907/9741 [00:03<00:35, 252.27it/s] 10%|█████                                                | 933/9741 [00:03<00:34, 252.57it/s] 10%|█████▏                                               | 959/9741 [00:03<00:34, 252.87it/s] 10%|█████▎                                               | 985/9741 [00:03<00:34, 253.00it/s] 10%|█████▍                                              | 1011/9741 [00:04<00:34, 251.90it/s] 11%|█████▌                                              | 1037/9741 [00:04<00:34, 249.56it/s] 11%|█████▋                                              | 1062/9741 [00:04<00:35, 247.00it/s] 11%|█████▊                                              | 1087/9741 [00:04<00:35, 243.99it/s] 11%|█████▉                                              | 1112/9741 [00:04<00:35, 242.75it/s] 12%|██████                                              | 1138/9741 [00:04<00:35, 245.15it/s] 12%|██████▏                                             | 1163/9741 [00:04<00:34, 245.95it/s] 12%|██████▎                                             | 1188/9741 [00:04<00:34, 245.48it/s] 12%|██████▍                                             | 1213/9741 [00:04<00:34, 245.96it/s] 13%|██████▌                                             | 1238/9741 [00:04<00:34, 246.46it/s] 13%|██████▋                                             | 1263/9741 [00:05<00:34, 246.94it/s] 13%|██████▉                                             | 1288/9741 [00:05<00:34, 247.19it/s] 13%|███████                                             | 1313/9741 [00:05<00:34, 245.86it/s] 14%|███████▏                                            | 1338/9741 [00:05<00:34, 241.49it/s] 14%|███████▎                                            | 1364/9741 [00:05<00:34, 244.85it/s] 14%|███████▍                                            | 1390/9741 [00:05<00:33, 247.00it/s] 15%|███████▌                                            | 1416/9741 [00:05<00:33, 248.75it/s] 15%|███████▋                                            | 1442/9741 [00:05<00:33, 249.99it/s] 15%|███████▊                                            | 1468/9741 [00:05<00:32, 251.02it/s] 15%|███████▉                                            | 1494/9741 [00:05<00:32, 251.57it/s] 16%|████████                                            | 1520/9741 [00:06<00:33, 244.48it/s] 16%|████████▎                                           | 1546/9741 [00:06<00:33, 247.03it/s] 16%|████████▍                                           | 1571/9741 [00:06<00:33, 246.91it/s] 16%|████████▌                                           | 1597/9741 [00:06<00:32, 248.47it/s] 17%|████████▋                                           | 1623/9741 [00:06<00:32, 248.97it/s] 17%|████████▊                                           | 1648/9741 [00:06<00:32, 249.10it/s] 17%|████████▉                                           | 1673/9741 [00:06<00:32, 247.17it/s] 17%|█████████                                           | 1699/9741 [00:06<00:32, 248.50it/s] 18%|█████████▏                                          | 1725/9741 [00:06<00:32, 249.39it/s] 18%|█████████▎                                          | 1751/9741 [00:07<00:31, 249.95it/s] 18%|█████████▍                                          | 1777/9741 [00:07<00:31, 250.46it/s] 19%|█████████▌                                          | 1803/9741 [00:07<00:34, 229.22it/s] 19%|█████████▊                                          | 1829/9741 [00:07<00:33, 235.54it/s] 19%|█████████▉                                          | 1855/9741 [00:07<00:32, 240.44it/s] 19%|██████████                                          | 1881/9741 [00:07<00:32, 243.52it/s] 20%|██████████▏                                         | 1907/9741 [00:07<00:31, 245.73it/s] 20%|██████████▎                                         | 1932/9741 [00:07<00:31, 246.68it/s] 20%|██████████▍                                         | 1957/9741 [00:07<00:31, 246.42it/s] 20%|██████████▌                                         | 1982/9741 [00:07<00:31, 245.01it/s] 21%|██████████▋                                         | 2008/9741 [00:08<00:31, 247.08it/s] 21%|██████████▊                                         | 2033/9741 [00:08<00:31, 244.69it/s] 21%|██████████▉                                         | 2059/9741 [00:08<00:31, 246.77it/s] 21%|███████████▏                                        | 2085/9741 [00:08<00:30, 247.75it/s] 22%|███████████▎                                        | 2110/9741 [00:08<00:30, 247.76it/s] 22%|███████████▍                                        | 2136/9741 [00:08<00:30, 248.82it/s] 22%|███████████▌                                        | 2162/9741 [00:08<00:30, 249.86it/s] 22%|███████████▋                                        | 2188/9741 [00:08<00:30, 250.55it/s] 23%|███████████▊                                        | 2214/9741 [00:08<00:29, 250.95it/s] 23%|███████████▉                                        | 2240/9741 [00:09<00:29, 251.28it/s] 23%|████████████                                        | 2266/9741 [00:09<00:29, 249.60it/s] 24%|████████████▏                                       | 2292/9741 [00:09<00:29, 250.39it/s] 24%|████████████▎                                       | 2318/9741 [00:09<00:29, 250.48it/s] 24%|████████████▌                                       | 2344/9741 [00:09<00:29, 250.93it/s] 24%|████████████▋                                       | 2370/9741 [00:09<00:29, 251.27it/s] 25%|████████████▊                                       | 2396/9741 [00:09<00:29, 251.75it/s] 25%|████████████▉                                       | 2422/9741 [00:09<00:29, 251.80it/s] 25%|█████████████                                       | 2448/9741 [00:09<00:28, 251.72it/s] 25%|█████████████▏                                      | 2474/9741 [00:09<00:29, 249.89it/s] 26%|█████████████▎                                      | 2500/9741 [00:10<00:28, 250.30it/s] 26%|█████████████▍                                      | 2526/9741 [00:10<00:28, 250.66it/s] 26%|█████████████▌                                      | 2552/9741 [00:10<00:28, 251.01it/s] 26%|█████████████▊                                      | 2578/9741 [00:10<00:28, 251.47it/s] 27%|█████████████▉                                      | 2604/9741 [00:10<00:28, 251.29it/s] 27%|██████████████                                      | 2630/9741 [00:10<00:28, 251.49it/s] 27%|██████████████▏                                     | 2656/9741 [00:10<00:28, 251.68it/s] 28%|██████████████▎                                     | 2682/9741 [00:10<00:28, 250.99it/s] 28%|██████████████▍                                     | 2708/9741 [00:10<00:28, 249.22it/s] 28%|██████████████▌                                     | 2734/9741 [00:10<00:28, 249.98it/s] 28%|██████████████▋                                     | 2760/9741 [00:11<00:27, 250.60it/s] 29%|██████████████▊                                     | 2786/9741 [00:11<00:27, 250.89it/s] 29%|███████████████                                     | 2812/9741 [00:11<00:27, 251.18it/s] 29%|███████████████▏                                    | 2838/9741 [00:11<00:27, 251.68it/s] 29%|███████████████▎                                    | 2864/9741 [00:11<00:27, 251.33it/s] 30%|███████████████▍                                    | 2890/9741 [00:11<00:27, 250.73it/s] 30%|███████████████▌                                    | 2916/9741 [00:11<00:27, 251.32it/s] 30%|███████████████▋                                    | 2942/9741 [00:11<00:27, 249.73it/s] 30%|███████████████▊                                    | 2968/9741 [00:11<00:27, 250.43it/s] 31%|███████████████▉                                    | 2994/9741 [00:12<00:26, 251.06it/s] 31%|████████████████                                    | 3020/9741 [00:12<00:26, 251.44it/s] 31%|████████████████▎                                   | 3046/9741 [00:12<00:26, 251.59it/s] 32%|████████████████▍                                   | 3072/9741 [00:12<00:26, 251.52it/s] 32%|████████████████▌                                   | 3098/9741 [00:12<00:26, 251.74it/s] 32%|████████████████▋                                   | 3124/9741 [00:12<00:26, 251.52it/s] 32%|████████████████▊                                   | 3150/9741 [00:12<00:26, 249.08it/s] 33%|████████████████▉                                   | 3175/9741 [00:12<00:26, 249.27it/s] 33%|█████████████████                                   | 3201/9741 [00:12<00:26, 250.32it/s] 33%|█████████████████▏                                  | 3227/9741 [00:12<00:25, 250.81it/s] 33%|█████████████████▎                                  | 3253/9741 [00:13<00:25, 251.46it/s] 34%|█████████████████▌                                  | 3279/9741 [00:13<00:25, 251.64it/s] 34%|█████████████████▋                                  | 3305/9741 [00:13<00:25, 251.60it/s] 34%|█████████████████▊                                  | 3331/9741 [00:13<00:25, 251.55it/s] 34%|█████████████████▉                                  | 3357/9741 [00:13<00:25, 251.63it/s] 35%|██████████████████                                  | 3383/9741 [00:13<00:25, 249.87it/s] 35%|██████████████████▏                                 | 3409/9741 [00:13<00:25, 250.62it/s] 35%|██████████████████▎                                 | 3435/9741 [00:13<00:25, 251.02it/s] 36%|██████████████████▍                                 | 3461/9741 [00:13<00:24, 251.27it/s] 36%|██████████████████▌                                 | 3487/9741 [00:13<00:24, 251.46it/s] 36%|██████████████████▊                                 | 3513/9741 [00:14<00:24, 250.81it/s] 36%|██████████████████▉                                 | 3539/9741 [00:14<00:24, 250.73it/s] 37%|███████████████████                                 | 3565/9741 [00:14<00:24, 250.97it/s] 37%|███████████████████▏                                | 3591/9741 [00:14<00:24, 250.89it/s] 37%|███████████████████▎                                | 3617/9741 [00:14<00:24, 248.74it/s] 37%|███████████████████▍                                | 3643/9741 [00:14<00:24, 249.77it/s] 38%|███████████████████▌                                | 3669/9741 [00:14<00:24, 250.25it/s] 38%|███████████████████▋                                | 3695/9741 [00:14<00:24, 250.86it/s] 38%|███████████████████▊                                | 3721/9741 [00:14<00:23, 251.30it/s] 38%|████████████████████                                | 3747/9741 [00:15<00:23, 251.62it/s] 39%|████████████████████▏                               | 3773/9741 [00:15<00:23, 251.79it/s] 39%|████████████████████▎                               | 3799/9741 [00:15<00:23, 250.73it/s] 39%|████████████████████▍                               | 3825/9741 [00:15<00:23, 251.02it/s] 40%|████████████████████▌                               | 3851/9741 [00:15<00:23, 249.45it/s] 40%|████████████████████▋                               | 3877/9741 [00:15<00:23, 250.24it/s] 40%|████████████████████▊                               | 3903/9741 [00:15<00:23, 250.92it/s] 40%|████████████████████▉                               | 3929/9741 [00:15<00:23, 251.06it/s] 41%|█████████████████████                               | 3955/9741 [00:15<00:23, 251.40it/s] 41%|█████████████████████▎                              | 3981/9741 [00:15<00:22, 251.70it/s] 41%|█████████████████████▍                              | 4007/9741 [00:16<00:22, 250.84it/s] 41%|█████████████████████▌                              | 4033/9741 [00:16<00:22, 251.25it/s] 42%|█████████████████████▋                              | 4059/9741 [00:16<00:22, 248.52it/s] 42%|█████████████████████▊                              | 4084/9741 [00:16<00:22, 248.71it/s] 42%|█████████████████████▉                              | 4110/9741 [00:16<00:22, 249.63it/s] 42%|██████████████████████                              | 4135/9741 [00:16<00:22, 249.62it/s] 43%|██████████████████████▏                             | 4161/9741 [00:16<00:22, 250.08it/s] 43%|██████████████████████▎                             | 4187/9741 [00:16<00:22, 250.29it/s] 43%|██████████████████████▍                             | 4213/9741 [00:16<00:22, 250.74it/s] 44%|██████████████████████▋                             | 4239/9741 [00:16<00:21, 250.99it/s] 44%|██████████████████████▊                             | 4265/9741 [00:17<00:21, 251.34it/s] 44%|██████████████████████▉                             | 4291/9741 [00:17<00:21, 249.58it/s] 44%|███████████████████████                             | 4317/9741 [00:17<00:21, 249.71it/s] 45%|███████████████████████▏                            | 4343/9741 [00:17<00:21, 250.31it/s] 45%|███████████████████████▎                            | 4369/9741 [00:17<00:21, 250.63it/s] 45%|███████████████████████▍                            | 4395/9741 [00:17<00:21, 250.92it/s] 45%|███████████████████████▌                            | 4421/9741 [00:17<00:21, 251.25it/s] 46%|███████████████████████▋                            | 4447/9741 [00:17<00:21, 250.04it/s] 46%|███████████████████████▉                            | 4473/9741 [00:17<00:21, 250.52it/s] 46%|████████████████████████                            | 4499/9741 [00:18<00:20, 250.96it/s] 46%|████████████████████████▏                           | 4525/9741 [00:18<00:22, 227.92it/s] 47%|████████████████████████▎                           | 4551/9741 [00:18<00:22, 234.50it/s] 47%|████████████████████████▍                           | 4577/9741 [00:18<00:21, 239.13it/s] 47%|████████████████████████▌                           | 4602/9741 [00:18<00:21, 242.17it/s] 48%|████████████████████████▋                           | 4627/9741 [00:18<00:20, 243.66it/s] 48%|████████████████████████▊                           | 4653/9741 [00:18<00:20, 246.14it/s] 48%|████████████████████████▉                           | 4679/9741 [00:18<00:20, 247.88it/s] 48%|█████████████████████████                           | 4705/9741 [00:18<00:20, 249.15it/s] 49%|█████████████████████████▎                          | 4731/9741 [00:18<00:20, 250.11it/s] 49%|█████████████████████████▍                          | 4757/9741 [00:19<00:29, 167.20it/s] 49%|█████████████████████████▌                          | 4783/9741 [00:19<00:26, 185.98it/s] 49%|█████████████████████████▋                          | 4808/9741 [00:19<00:24, 200.30it/s] 50%|█████████████████████████▊                          | 4834/9741 [00:19<00:22, 213.40it/s] 50%|█████████████████████████▉                          | 4859/9741 [00:19<00:21, 222.24it/s] 50%|██████████████████████████                          | 4884/9741 [00:19<00:21, 229.58it/s] 50%|██████████████████████████▏                         | 4910/9741 [00:19<00:20, 235.88it/s] 51%|██████████████████████████▎                         | 4936/9741 [00:19<00:19, 240.40it/s] 51%|██████████████████████████▍                         | 4961/9741 [00:20<00:19, 242.00it/s] 51%|██████████████████████████▌                         | 4987/9741 [00:20<00:19, 244.81it/s] 51%|██████████████████████████▊                         | 5013/9741 [00:20<00:19, 246.67it/s] 52%|██████████████████████████▉                         | 5039/9741 [00:20<00:18, 248.30it/s] 52%|███████████████████████████                         | 5065/9741 [00:20<00:18, 249.28it/s] 52%|███████████████████████████▏                        | 5091/9741 [00:20<00:18, 249.30it/s] 53%|███████████████████████████▎                        | 5117/9741 [00:20<00:18, 250.17it/s] 53%|███████████████████████████▍                        | 5143/9741 [00:20<00:18, 250.32it/s] 53%|███████████████████████████▌                        | 5169/9741 [00:20<00:18, 250.27it/s] 53%|███████████████████████████▋                        | 5195/9741 [00:21<00:18, 248.83it/s] 54%|███████████████████████████▊                        | 5221/9741 [00:21<00:18, 249.62it/s] 54%|████████████████████████████                        | 5246/9741 [00:21<00:18, 248.31it/s] 54%|████████████████████████████▏                       | 5272/9741 [00:21<00:17, 249.21it/s] 54%|████████████████████████████▎                       | 5298/9741 [00:21<00:17, 249.98it/s] 55%|████████████████████████████▍                       | 5324/9741 [00:21<00:17, 250.60it/s] 55%|████████████████████████████▌                       | 5350/9741 [00:21<00:17, 250.61it/s] 55%|████████████████████████████▋                       | 5376/9741 [00:21<00:17, 250.80it/s] 55%|████████████████████████████▊                       | 5402/9741 [00:21<00:17, 248.93it/s] 56%|████████████████████████████▉                       | 5428/9741 [00:21<00:17, 249.72it/s] 56%|█████████████████████████████                       | 5454/9741 [00:22<00:17, 250.27it/s] 56%|█████████████████████████████▎                      | 5480/9741 [00:22<00:16, 251.29it/s] 57%|█████████████████████████████▍                      | 5506/9741 [00:22<00:16, 253.24it/s] 57%|█████████████████████████████▌                      | 5532/9741 [00:22<00:16, 254.86it/s] 57%|█████████████████████████████▋                      | 5558/9741 [00:22<00:16, 256.14it/s] 57%|█████████████████████████████▊                      | 5584/9741 [00:22<00:16, 255.66it/s] 58%|█████████████████████████████▉                      | 5610/9741 [00:22<00:16, 256.42it/s] 58%|██████████████████████████████                      | 5636/9741 [00:22<00:16, 255.06it/s] 58%|██████████████████████████████▏                     | 5662/9741 [00:22<00:16, 254.21it/s] 58%|██████████████████████████████▎                     | 5688/9741 [00:22<00:15, 255.15it/s] 59%|██████████████████████████████▌                     | 5714/9741 [00:23<00:15, 256.13it/s] 59%|██████████████████████████████▋                     | 5740/9741 [00:23<00:15, 256.80it/s] 59%|██████████████████████████████▊                     | 5766/9741 [00:23<00:15, 256.84it/s] 59%|██████████████████████████████▉                     | 5792/9741 [00:23<00:15, 257.10it/s] 60%|███████████████████████████████                     | 5818/9741 [00:23<00:15, 257.19it/s] 60%|███████████████████████████████▏                    | 5844/9741 [00:23<00:15, 257.11it/s] 60%|███████████████████████████████▎                    | 5870/9741 [00:23<00:15, 255.44it/s] 61%|███████████████████████████████▍                    | 5896/9741 [00:23<00:15, 256.19it/s] 61%|███████████████████████████████▌                    | 5922/9741 [00:23<00:14, 256.84it/s] 61%|███████████████████████████████▊                    | 5948/9741 [00:23<00:14, 257.40it/s] 61%|███████████████████████████████▉                    | 5974/9741 [00:24<00:14, 257.90it/s] 62%|████████████████████████████████                    | 6000/9741 [00:24<00:14, 257.72it/s] 62%|████████████████████████████████▏                   | 6026/9741 [00:24<00:14, 256.24it/s] 62%|████████████████████████████████▎                   | 6052/9741 [00:24<00:14, 257.01it/s] 62%|████████████████████████████████▍                   | 6078/9741 [00:24<00:14, 255.50it/s] 63%|████████████████████████████████▌                   | 6104/9741 [00:24<00:14, 253.93it/s] 63%|████████████████████████████████▋                   | 6130/9741 [00:24<00:14, 255.00it/s] 63%|████████████████████████████████▊                   | 6156/9741 [00:24<00:14, 255.90it/s] 63%|█████████████████████████████████                   | 6182/9741 [00:24<00:13, 256.51it/s] 64%|█████████████████████████████████▏                  | 6208/9741 [00:24<00:13, 256.92it/s] 64%|█████████████████████████████████▎                  | 6234/9741 [00:25<00:13, 257.06it/s] 64%|█████████████████████████████████▍                  | 6260/9741 [00:25<00:13, 257.26it/s] 65%|█████████████████████████████████▌                  | 6286/9741 [00:25<00:13, 257.50it/s] 65%|█████████████████████████████████▋                  | 6312/9741 [00:25<00:13, 255.39it/s] 65%|█████████████████████████████████▊                  | 6338/9741 [00:25<00:13, 255.15it/s] 65%|█████████████████████████████████▉                  | 6364/9741 [00:25<00:13, 255.87it/s] 66%|██████████████████████████████████                  | 6390/9741 [00:25<00:13, 256.76it/s] 66%|██████████████████████████████████▎                 | 6416/9741 [00:25<00:12, 257.19it/s] 66%|██████████████████████████████████▍                 | 6442/9741 [00:25<00:12, 257.52it/s] 66%|██████████████████████████████████▌                 | 6468/9741 [00:26<00:12, 257.58it/s] 67%|██████████████████████████████████▋                 | 6494/9741 [00:26<00:12, 257.84it/s] 67%|██████████████████████████████████▊                 | 6520/9741 [00:26<00:12, 257.72it/s] 67%|██████████████████████████████████▉                 | 6546/9741 [00:26<00:12, 254.36it/s] 67%|███████████████████████████████████                 | 6572/9741 [00:26<00:12, 255.43it/s] 68%|███████████████████████████████████▏                | 6598/9741 [00:26<00:12, 256.12it/s] 68%|███████████████████████████████████▎                | 6624/9741 [00:26<00:12, 256.01it/s] 68%|███████████████████████████████████▍                | 6650/9741 [00:26<00:12, 255.02it/s] 69%|███████████████████████████████████▋                | 6676/9741 [00:26<00:12, 254.79it/s] 69%|███████████████████████████████████▊                | 6702/9741 [00:26<00:11, 255.64it/s] 69%|███████████████████████████████████▉                | 6728/9741 [00:27<00:11, 256.59it/s] 69%|████████████████████████████████████                | 6754/9741 [00:27<00:11, 257.30it/s] 70%|████████████████████████████████████▏               | 6780/9741 [00:27<00:11, 255.80it/s] 70%|████████████████████████████████████▎               | 6806/9741 [00:27<00:11, 256.48it/s] 70%|████████████████████████████████████▍               | 6832/9741 [00:27<00:11, 257.08it/s] 70%|████████████████████████████████████▌               | 6858/9741 [00:27<00:11, 257.34it/s] 71%|████████████████████████████████████▋               | 6884/9741 [00:27<00:11, 257.69it/s] 71%|████████████████████████████████████▉               | 6910/9741 [00:27<00:10, 257.83it/s] 71%|█████████████████████████████████████               | 6936/9741 [00:27<00:10, 257.84it/s] 71%|█████████████████████████████████████▏              | 6962/9741 [00:27<00:10, 256.11it/s] 72%|█████████████████████████████████████▎              | 6988/9741 [00:28<00:10, 254.40it/s] 72%|█████████████████████████████████████▍              | 7014/9741 [00:28<00:10, 255.19it/s] 72%|█████████████████████████████████████▌              | 7040/9741 [00:28<00:10, 256.17it/s] 73%|█████████████████████████████████████▋              | 7066/9741 [00:28<00:10, 256.67it/s] 73%|█████████████████████████████████████▊              | 7092/9741 [00:28<00:10, 257.18it/s] 73%|█████████████████████████████████████▉              | 7118/9741 [00:28<00:10, 257.49it/s] 73%|██████████████████████████████████████▏             | 7144/9741 [00:28<00:10, 257.05it/s] 74%|██████████████████████████████████████▎             | 7170/9741 [00:28<00:09, 257.47it/s] 74%|██████████████████████████████████████▍             | 7196/9741 [00:28<00:09, 257.77it/s] 74%|██████████████████████████████████████▌             | 7222/9741 [00:28<00:09, 255.86it/s] 74%|██████████████████████████████████████▋             | 7248/9741 [00:29<00:09, 256.54it/s] 75%|██████████████████████████████████████▊             | 7274/9741 [00:29<00:09, 256.42it/s] 75%|██████████████████████████████████████▉             | 7300/9741 [00:29<00:09, 257.03it/s] 75%|███████████████████████████████████████             | 7326/9741 [00:29<00:09, 257.36it/s] 75%|███████████████████████████████████████▏            | 7352/9741 [00:29<00:09, 257.61it/s] 76%|███████████████████████████████████████▍            | 7378/9741 [00:29<00:09, 258.02it/s] 76%|███████████████████████████████████████▌            | 7404/9741 [00:29<00:09, 258.13it/s] 76%|███████████████████████████████████████▋            | 7430/9741 [00:29<00:08, 258.05it/s] 77%|███████████████████████████████████████▊            | 7456/9741 [00:29<00:10, 225.83it/s] 77%|███████████████████████████████████████▉            | 7482/9741 [00:29<00:09, 233.55it/s] 77%|████████████████████████████████████████            | 7508/9741 [00:30<00:09, 240.28it/s] 77%|████████████████████████████████████████▏           | 7534/9741 [00:30<00:08, 245.29it/s] 78%|████████████████████████████████████████▎           | 7560/9741 [00:30<00:08, 249.20it/s] 78%|████████████████████████████████████████▍           | 7586/9741 [00:30<00:08, 251.99it/s] 78%|████████████████████████████████████████▋           | 7612/9741 [00:30<00:08, 254.04it/s] 78%|████████████████████████████████████████▊           | 7638/9741 [00:30<00:08, 255.37it/s] 79%|████████████████████████████████████████▉           | 7664/9741 [00:30<00:08, 255.39it/s] 79%|█████████████████████████████████████████           | 7690/9741 [00:30<00:08, 254.38it/s] 79%|█████████████████████████████████████████▏          | 7716/9741 [00:30<00:07, 255.69it/s] 79%|█████████████████████████████████████████▎          | 7742/9741 [00:31<00:07, 256.57it/s] 80%|█████████████████████████████████████████▍          | 7768/9741 [00:31<00:07, 257.02it/s] 80%|█████████████████████████████████████████▌          | 7794/9741 [00:31<00:07, 257.45it/s] 80%|█████████████████████████████████████████▋          | 7820/9741 [00:31<00:07, 257.84it/s] 81%|█████████████████████████████████████████▉          | 7846/9741 [00:31<00:07, 258.25it/s] 81%|██████████████████████████████████████████          | 7872/9741 [00:31<00:07, 258.41it/s] 81%|██████████████████████████████████████████▏         | 7898/9741 [00:31<00:07, 256.57it/s] 81%|██████████████████████████████████████████▎         | 7924/9741 [00:31<00:07, 257.17it/s] 82%|██████████████████████████████████████████▍         | 7950/9741 [00:31<00:06, 257.59it/s] 82%|██████████████████████████████████████████▌         | 7976/9741 [00:31<00:06, 257.92it/s] 82%|██████████████████████████████████████████▋         | 8002/9741 [00:32<00:06, 257.70it/s] 82%|██████████████████████████████████████████▊         | 8028/9741 [00:32<00:06, 257.81it/s] 83%|██████████████████████████████████████████▉         | 8054/9741 [00:32<00:06, 257.55it/s] 83%|███████████████████████████████████████████▏        | 8080/9741 [00:32<00:06, 257.49it/s] 83%|███████████████████████████████████████████▎        | 8106/9741 [00:32<00:06, 257.97it/s] 83%|███████████████████████████████████████████▍        | 8132/9741 [00:32<00:06, 256.32it/s] 84%|███████████████████████████████████████████▌        | 8158/9741 [00:32<00:06, 256.72it/s] 84%|███████████████████████████████████████████▋        | 8184/9741 [00:32<00:06, 256.81it/s] 84%|███████████████████████████████████████████▊        | 8210/9741 [00:32<00:05, 257.36it/s] 85%|███████████████████████████████████████████▉        | 8236/9741 [00:32<00:05, 257.81it/s] 85%|████████████████████████████████████████████        | 8262/9741 [00:33<00:05, 258.14it/s] 85%|████████████████████████████████████████████▏       | 8288/9741 [00:33<00:05, 257.89it/s] 85%|████████████████████████████████████████████▍       | 8314/9741 [00:33<00:05, 257.36it/s] 86%|████████████████████████████████████████████▌       | 8340/9741 [00:33<00:05, 257.49it/s] 86%|████████████████████████████████████████████▋       | 8366/9741 [00:33<00:05, 255.82it/s] 86%|████████████████████████████████████████████▊       | 8392/9741 [00:33<00:05, 256.48it/s] 86%|████████████████████████████████████████████▉       | 8418/9741 [00:33<00:05, 257.10it/s] 87%|█████████████████████████████████████████████       | 8444/9741 [00:33<00:05, 257.42it/s] 87%|█████████████████████████████████████████████▏      | 8470/9741 [00:33<00:04, 257.64it/s] 87%|█████████████████████████████████████████████▎      | 8496/9741 [00:33<00:04, 257.92it/s] 87%|█████████████████████████████████████████████▍      | 8522/9741 [00:34<00:04, 257.77it/s] 88%|█████████████████████████████████████████████▋      | 8548/9741 [00:34<00:04, 257.74it/s] 88%|█████████████████████████████████████████████▊      | 8574/9741 [00:34<00:04, 257.82it/s] 88%|█████████████████████████████████████████████▉      | 8600/9741 [00:34<00:04, 256.05it/s] 89%|██████████████████████████████████████████████      | 8626/9741 [00:34<00:04, 256.30it/s] 89%|██████████████████████████████████████████████▏     | 8652/9741 [00:34<00:04, 256.62it/s] 89%|██████████████████████████████████████████████▎     | 8678/9741 [00:34<00:04, 256.34it/s] 89%|██████████████████████████████████████████████▍     | 8704/9741 [00:34<00:04, 256.93it/s] 90%|██████████████████████████████████████████████▌     | 8730/9741 [00:34<00:03, 257.28it/s] 90%|██████████████████████████████████████████████▋     | 8756/9741 [00:34<00:03, 257.64it/s] 90%|██████████████████████████████████████████████▉     | 8782/9741 [00:35<00:03, 257.86it/s] 90%|███████████████████████████████████████████████     | 8808/9741 [00:35<00:03, 256.04it/s] 91%|███████████████████████████████████████████████▏    | 8834/9741 [00:35<00:03, 256.69it/s] 91%|███████████████████████████████████████████████▎    | 8860/9741 [00:35<00:03, 257.14it/s] 91%|███████████████████████████████████████████████▍    | 8886/9741 [00:35<00:03, 257.58it/s] 91%|███████████████████████████████████████████████▌    | 8912/9741 [00:35<00:03, 257.94it/s] 92%|███████████████████████████████████████████████▋    | 8938/9741 [00:35<00:03, 258.16it/s] 92%|███████████████████████████████████████████████▊    | 8964/9741 [00:35<00:03, 256.33it/s] 92%|███████████████████████████████████████████████▉    | 8990/9741 [00:35<00:02, 256.10it/s] 93%|████████████████████████████████████████████████▏   | 9016/9741 [00:35<00:02, 256.44it/s] 93%|████████████████████████████████████████████████▎   | 9042/9741 [00:36<00:02, 255.04it/s] 93%|████████████████████████████████████████████████▍   | 9068/9741 [00:36<00:02, 255.54it/s] 93%|████████████████████████████████████████████████▌   | 9094/9741 [00:36<00:02, 256.33it/s] 94%|████████████████████████████████████████████████▋   | 9120/9741 [00:36<00:02, 256.97it/s] 94%|████████████████████████████████████████████████▊   | 9146/9741 [00:36<00:02, 257.17it/s] 94%|████████████████████████████████████████████████▉   | 9172/9741 [00:36<00:02, 257.48it/s] 94%|█████████████████████████████████████████████████   | 9198/9741 [00:36<00:02, 257.12it/s] 95%|█████████████████████████████████████████████████▏  | 9224/9741 [00:36<00:02, 257.12it/s] 95%|█████████████████████████████████████████████████▍  | 9250/9741 [00:36<00:01, 257.56it/s] 95%|█████████████████████████████████████████████████▌  | 9276/9741 [00:36<00:01, 255.72it/s] 95%|█████████████████████████████████████████████████▋  | 9302/9741 [00:37<00:01, 256.29it/s] 96%|█████████████████████████████████████████████████▊  | 9328/9741 [00:37<00:01, 256.91it/s] 96%|█████████████████████████████████████████████████▉  | 9354/9741 [00:37<00:01, 257.27it/s] 96%|██████████████████████████████████████████████████  | 9380/9741 [00:37<00:01, 257.74it/s] 97%|██████████████████████████████████████████████████▏ | 9406/9741 [00:37<00:01, 257.73it/s] 97%|██████████████████████████████████████████████████▎ | 9432/9741 [00:37<00:01, 257.94it/s] 97%|██████████████████████████████████████████████████▍ | 9458/9741 [00:37<00:01, 257.96it/s] 97%|██████████████████████████████████████████████████▋ | 9484/9741 [00:37<00:01, 256.27it/s] 98%|██████████████████████████████████████████████████▊ | 9510/9741 [00:37<00:00, 255.70it/s] 98%|██████████████████████████████████████████████████▉ | 9536/9741 [00:37<00:00, 255.08it/s] 98%|███████████████████████████████████████████████████ | 9562/9741 [00:38<00:00, 255.82it/s] 98%|███████████████████████████████████████████████████▏| 9588/9741 [00:38<00:00, 256.24it/s] 99%|███████████████████████████████████████████████████▎| 9614/9741 [00:38<00:00, 256.82it/s] 99%|███████████████████████████████████████████████████▍| 9640/9741 [00:38<00:00, 257.24it/s] 99%|███████████████████████████████████████████████████▌| 9666/9741 [00:38<00:00, 257.49it/s] 99%|███████████████████████████████████████████████████▋| 9692/9741 [00:38<00:00, 257.66it/s]100%|███████████████████████████████████████████████████▉| 9718/9741 [00:38<00:00, 255.49it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:38<00:00, 251.15it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.93s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.43s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.95s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.12s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.10s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.02s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.17s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.51s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.65s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.61s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.93s/it]
[2023-08-21 17:34:53,745] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]
[2023-08-21 17:35:02,883] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 17:35:02,883] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7eff201e9fd0>
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 17:35:02,884] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7eff1d873220>
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 17:35:02,885] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 17:35:02,886] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 17:35:02,886] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.575509786605835 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input: Tonya has $150.00 on her credit card.  If she leaves any balance on her card at the end of the month, she is charged 20% interest.  If she makes a $50.00 payment on her card, what will be the new balance?
Output: 120

Input: In her first term, Governor Sandoval gave twice as many commencement addresses as Governor Hawkins. Governor Sloan gave ten more commencement addresses than Governor Sandoval in the same amount of time. If Governor Sandoval gave 12 commencement addresses, how many commencement addresses did the three of them give altogether?
Output: 40

Input: If Buzz bought a pizza with 78 slices at a restaurant and then decided to share it with the waiter in the ratio of 5:8, with Buzz's ratio being 5, what's twenty less the number of slices of pizza that the waiter ate?
Output: 28

Input: Jolene and Phil have four children, each with the same birthday.  They gave birth to their first child exactly 15 years ago.  They gave birth to their second child exactly one year after the birth of their first child.  They gave birth to their third child on the fourth birthday of their second child. Two years after the birth of their third child, they gave birth to their fourth child.  How old, in years, is their fourth child?
Output: 8

Input: Each purple book has 230 pages. Each orange book contains 510 pages. Mirella read 5 purple books and 4 orange books. How many more orange pages did she read than purple pages?
Output: 890

Input: Isabella has $45 more than Sam but only $15 more than Giselle. If Giselle has $120, calculate the total amount of money each shopper will receive if Isabella, Sam, and Giselle donate the money to three shoppers at their local town's supermarket who then decides to share it equally.
Output: 115

Input: It takes 40 minutes to freeze ice cubes and 3 minutes per smoothie to turn them into smoothies once they're frozen. How long does it take to make 5 smoothies?
Output: 55

Input: Belle eats 4 dog biscuits and 2 rawhide bones every evening. If each rawhide bone is $1, and each dog biscuit is $0.25, then how much does it cost, in dollars, to feed Belle these treats for a week?
Output: 21

Input: There are 10 6-ounces of glasses that are only 4/5 full of water. How many ounces of water are needed to fill to the brim all those 10 glasses?
Output: 12

Input: Tony decided to rent a small cottage.  The master bedroom and bath totaled 500 sq ft.  The 2 guest bedrooms were 200 sq ft each.  And the kitchen, guest bath and living area totaled 600 sq ft.  If Tony spends $3,000 a month on rent, how much money is he spending per sq ft of house?
Output: 2

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o25-tgsm8k-s1-rFalse
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5045757293701172 seconds
Time to load utils op: 0.504568338394165 seconds
Loading extension module utils...
Time to load utils op: 0.605067253112793 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3343268) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_17:35:10
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3343269)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-21_17:35:10
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3343270)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-21_17:35:10
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3343271)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_17:35:10
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3343268)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o10-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 10
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[2023-08-21 17:35:13,950] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o10-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 10
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o10-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  1%|▎                                                     | 50/9741 [00:00<00:19, 498.87it/s]  1%|▌                                                    | 101/9741 [00:00<00:19, 502.21it/s]  2%|▊                                                    | 152/9741 [00:00<00:19, 502.43it/s]  2%|█                                                    | 203/9741 [00:00<00:19, 500.84it/s]  3%|█▍                                                   | 254/9741 [00:00<00:18, 501.77it/s]  3%|█▋                                                   | 305/9741 [00:00<00:18, 502.24it/s]  4%|█▉                                                   | 356/9741 [00:00<00:18, 502.42it/s]  4%|██▏                                                  | 407/9741 [00:00<00:18, 502.76it/s]  5%|██▍                                                  | 458/9741 [00:00<00:18, 494.00it/s]  5%|██▊                                                  | 508/9741 [00:01<00:18, 495.21it/s]  6%|███                                                  | 559/9741 [00:01<00:18, 496.89it/s]  6%|███▎                                                 | 610/9741 [00:01<00:18, 498.31it/s]  7%|███▌                                                 | 660/9741 [00:01<00:18, 497.58it/s]  7%|███▊                                                 | 711/9741 [00:01<00:18, 499.05it/s]  8%|████▏                                                | 762/9741 [00:01<00:17, 499.65it/s]  8%|████▍                                                | 813/9741 [00:01<00:17, 501.04it/s]  9%|████▋                                                | 864/9741 [00:01<00:17, 501.60it/s]  9%|████▉                                                | 915/9741 [00:01<00:17, 499.80it/s] 10%|█████▎                                               | 965/9741 [00:01<00:17, 497.48it/s] 10%|█████▍                                              | 1016/9741 [00:02<00:17, 498.53it/s] 11%|█████▋                                              | 1067/9741 [00:02<00:17, 500.03it/s] 11%|█████▉                                              | 1118/9741 [00:02<00:17, 498.40it/s] 12%|██████▏                                             | 1169/9741 [00:02<00:17, 499.31it/s] 13%|██████▌                                             | 1220/9741 [00:02<00:17, 499.78it/s] 13%|██████▉                                             | 1292/9741 [00:02<00:14, 564.23it/s] 14%|███████▎                                            | 1368/9741 [00:02<00:13, 621.14it/s] 15%|███████▋                                            | 1444/9741 [00:02<00:12, 662.40it/s] 16%|████████                                            | 1520/9741 [00:02<00:11, 691.30it/s] 16%|████████▌                                           | 1596/9741 [00:02<00:11, 709.70it/s] 17%|████████▉                                           | 1673/9741 [00:03<00:11, 725.88it/s] 18%|█████████▎                                          | 1750/9741 [00:03<00:10, 737.00it/s] 19%|█████████▋                                          | 1824/9741 [00:03<00:11, 710.27it/s] 20%|██████████▏                                         | 1900/9741 [00:03<00:10, 724.11it/s] 20%|██████████▌                                         | 1976/9741 [00:03<00:10, 734.30it/s] 21%|██████████▉                                         | 2051/9741 [00:03<00:10, 736.98it/s] 22%|███████████▎                                        | 2127/9741 [00:03<00:10, 743.24it/s] 23%|███████████▊                                        | 2203/9741 [00:03<00:10, 747.70it/s] 23%|████████████▏                                       | 2279/9741 [00:03<00:09, 748.69it/s] 24%|████████████▌                                       | 2355/9741 [00:03<00:09, 751.98it/s] 25%|████████████▉                                       | 2432/9741 [00:04<00:09, 755.05it/s] 26%|█████████████▍                                      | 2508/9741 [00:04<00:09, 753.88it/s] 27%|█████████████▊                                      | 2584/9741 [00:04<00:09, 755.51it/s] 27%|██████████████▏                                     | 2661/9741 [00:04<00:09, 756.95it/s] 28%|██████████████▌                                     | 2737/9741 [00:04<00:09, 753.73it/s] 29%|███████████████                                     | 2813/9741 [00:04<00:09, 746.93it/s] 30%|███████████████▍                                    | 2890/9741 [00:04<00:09, 751.63it/s] 30%|███████████████▊                                    | 2966/9741 [00:04<00:09, 750.83it/s] 31%|████████████████▏                                   | 3043/9741 [00:04<00:08, 753.76it/s] 32%|████████████████▋                                   | 3119/9741 [00:04<00:08, 754.76it/s] 33%|█████████████████                                   | 3195/9741 [00:05<00:08, 753.39it/s] 34%|█████████████████▍                                  | 3271/9741 [00:05<00:08, 754.75it/s] 34%|█████████████████▊                                  | 3347/9741 [00:05<00:08, 755.66it/s] 35%|██████████████████▎                                 | 3423/9741 [00:05<00:08, 753.72it/s] 36%|██████████████████▋                                 | 3499/9741 [00:05<00:08, 754.73it/s] 37%|███████████████████                                 | 3575/9741 [00:05<00:08, 755.58it/s] 37%|███████████████████▍                                | 3651/9741 [00:05<00:08, 754.58it/s] 38%|███████████████████▉                                | 3728/9741 [00:05<00:07, 756.32it/s] 39%|████████████████████▎                               | 3804/9741 [00:05<00:07, 752.74it/s] 40%|████████████████████▋                               | 3880/9741 [00:05<00:07, 752.29it/s] 41%|█████████████████████                               | 3956/9741 [00:06<00:07, 754.24it/s] 41%|█████████████████████▌                              | 4032/9741 [00:06<00:07, 755.93it/s] 42%|█████████████████████▉                              | 4108/9741 [00:06<00:07, 754.87it/s] 43%|██████████████████████▎                             | 4184/9741 [00:06<00:07, 756.06it/s] 44%|██████████████████████▋                             | 4260/9741 [00:06<00:07, 756.79it/s] 45%|███████████████████████▏                            | 4336/9741 [00:06<00:07, 754.29it/s] 45%|███████████████████████▌                            | 4412/9741 [00:06<00:07, 755.21it/s] 46%|███████████████████████▉                            | 4488/9741 [00:06<00:06, 756.40it/s] 47%|████████████████████████▎                           | 4564/9741 [00:06<00:07, 711.93it/s] 48%|████████████████████████▊                           | 4640/9741 [00:07<00:07, 724.96it/s] 48%|█████████████████████████▏                          | 4716/9741 [00:07<00:06, 734.70it/s] 49%|█████████████████████████▌                          | 4790/9741 [00:07<00:08, 589.39it/s] 50%|█████████████████████████▉                          | 4866/9741 [00:07<00:07, 630.95it/s] 51%|██████████████████████████▍                         | 4942/9741 [00:07<00:07, 663.99it/s] 51%|██████████████████████████▊                         | 5016/9741 [00:07<00:06, 683.61it/s] 52%|███████████████████████████▏                        | 5092/9741 [00:07<00:06, 703.85it/s] 53%|███████████████████████████▌                        | 5168/9741 [00:07<00:06, 719.41it/s] 54%|███████████████████████████▉                        | 5243/9741 [00:07<00:06, 727.41it/s] 55%|████████████████████████████▍                       | 5319/9741 [00:07<00:06, 736.06it/s] 55%|████████████████████████████▊                       | 5395/9741 [00:08<00:05, 741.92it/s] 56%|█████████████████████████████▏                      | 5470/9741 [00:08<00:05, 743.61it/s] 57%|█████████████████████████████▌                      | 5549/9741 [00:08<00:05, 755.94it/s] 58%|██████████████████████████████                      | 5627/9741 [00:08<00:05, 762.26it/s] 59%|██████████████████████████████▍                     | 5706/9741 [00:08<00:05, 769.05it/s] 59%|██████████████████████████████▉                     | 5785/9741 [00:08<00:05, 774.71it/s] 60%|███████████████████████████████▎                    | 5863/9741 [00:08<00:05, 775.59it/s] 61%|███████████████████████████████▋                    | 5943/9741 [00:08<00:04, 780.24it/s] 62%|████████████████████████████████▏                   | 6022/9741 [00:08<00:04, 782.42it/s] 63%|████████████████████████████████▌                   | 6101/9741 [00:09<00:04, 783.07it/s] 63%|████████████████████████████████▉                   | 6181/9741 [00:09<00:04, 786.28it/s] 64%|█████████████████████████████████▍                  | 6261/9741 [00:09<00:04, 787.73it/s] 65%|█████████████████████████████████▊                  | 6340/9741 [00:09<00:04, 784.52it/s] 66%|██████████████████████████████████▎                 | 6420/9741 [00:09<00:04, 787.54it/s] 67%|██████████████████████████████████▋                 | 6500/9741 [00:09<00:04, 788.77it/s] 68%|███████████████████████████████████                 | 6579/9741 [00:09<00:04, 787.06it/s] 68%|███████████████████████████████████▌                | 6659/9741 [00:09<00:03, 788.80it/s] 69%|███████████████████████████████████▉                | 6739/9741 [00:09<00:03, 789.89it/s] 70%|████████████████████████████████████▍               | 6818/9741 [00:09<00:03, 788.78it/s] 71%|████████████████████████████████████▊               | 6898/9741 [00:10<00:03, 790.56it/s] 72%|█████████████████████████████████████▎              | 6978/9741 [00:10<00:03, 791.30it/s] 72%|█████████████████████████████████████▋              | 7058/9741 [00:10<00:03, 789.32it/s] 73%|██████████████████████████████████████              | 7138/9741 [00:10<00:03, 790.31it/s] 74%|██████████████████████████████████████▌             | 7218/9741 [00:10<00:03, 788.16it/s] 75%|██████████████████████████████████████▉             | 7298/9741 [00:10<00:03, 789.44it/s] 76%|███████████████████████████████████████▍            | 7378/9741 [00:10<00:02, 790.60it/s] 77%|███████████████████████████████████████▊            | 7458/9741 [00:10<00:03, 756.67it/s] 77%|████████████████████████████████████████▏           | 7537/9741 [00:10<00:02, 765.03it/s] 78%|████████████████████████████████████████▋           | 7616/9741 [00:10<00:02, 771.27it/s] 79%|█████████████████████████████████████████           | 7694/9741 [00:11<00:02, 772.91it/s] 80%|█████████████████████████████████████████▍          | 7774/9741 [00:11<00:02, 778.34it/s] 81%|█████████████████████████████████████████▉          | 7853/9741 [00:11<00:02, 781.69it/s] 81%|██████████████████████████████████████████▎         | 7932/9741 [00:11<00:02, 781.49it/s] 82%|██████████████████████████████████████████▊         | 8011/9741 [00:11<00:02, 783.99it/s] 83%|███████████████████████████████████████████▏        | 8090/9741 [00:11<00:02, 785.19it/s] 84%|███████████████████████████████████████████▌        | 8169/9741 [00:11<00:02, 784.06it/s] 85%|████████████████████████████████████████████        | 8248/9741 [00:11<00:01, 785.02it/s] 85%|████████████████████████████████████████████▍       | 8327/9741 [00:11<00:01, 785.37it/s] 86%|████████████████████████████████████████████▊       | 8406/9741 [00:11<00:01, 783.51it/s] 87%|█████████████████████████████████████████████▎      | 8485/9741 [00:12<00:01, 785.03it/s] 88%|█████████████████████████████████████████████▋      | 8564/9741 [00:12<00:01, 785.33it/s] 89%|██████████████████████████████████████████████▏     | 8643/9741 [00:12<00:01, 782.99it/s] 90%|██████████████████████████████████████████████▌     | 8722/9741 [00:12<00:01, 784.29it/s] 90%|██████████████████████████████████████████████▉     | 8801/9741 [00:12<00:01, 782.18it/s] 91%|███████████████████████████████████████████████▍    | 8880/9741 [00:12<00:01, 783.53it/s] 92%|███████████████████████████████████████████████▊    | 8959/9741 [00:12<00:01, 776.72it/s] 93%|████████████████████████████████████████████████▏   | 9037/9741 [00:12<00:00, 777.15it/s] 94%|████████████████████████████████████████████████▋   | 9116/9741 [00:12<00:00, 779.98it/s] 94%|█████████████████████████████████████████████████   | 9195/9741 [00:12<00:00, 781.72it/s] 95%|█████████████████████████████████████████████████▌  | 9274/9741 [00:13<00:00, 780.65it/s] 96%|█████████████████████████████████████████████████▉  | 9353/9741 [00:13<00:00, 782.17it/s] 97%|██████████████████████████████████████████████████▎ | 9432/9741 [00:13<00:00, 783.40it/s] 98%|██████████████████████████████████████████████████▊ | 9511/9741 [00:13<00:00, 781.40it/s] 98%|███████████████████████████████████████████████████▏| 9590/9741 [00:13<00:00, 782.46it/s] 99%|███████████████████████████████████████████████████▌| 9669/9741 [00:13<00:00, 783.03it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:13<00:00, 713.44it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.02s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.06s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.50s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.03s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.15s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.36s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.54s/it]
[2023-08-21 17:36:18,908] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.43s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.41s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.58s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.60s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.83s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  5.00s/it]
[2023-08-21 17:36:29,632] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 17:36:29,633] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 17:36:29,633] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fc004e36fd0>
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 17:36:29,634] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fc004c04220>
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 17:36:29,635] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 17:36:29,635] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.4340212345123291 seconds
Time to load utils op: 0.30439281463623047 seconds
Loading extension module utils...
Time to load utils op: 0.5045497417449951 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Time to load utils op: 0.5046896934509277 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o10-tgsm8k-s10-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:45<37:10, 45.52s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:21<31:59, 40.00s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:06<32:54, 42.02s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:42<30:36, 39.93s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:27<31:07, 41.51s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:11<31:15, 42.63s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:56<30:56, 43.18s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:40<30:28, 43.53s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:24<29:53, 43.75s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:09<29:19, 43.98s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:52<28:26, 43.77s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:37<27:57, 44.16s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:22<27:19, 44.31s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:06<26:29, 44.16s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:49<25:38, 43.97s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:33<24:55, 43.99s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:17<24:11, 43.98s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [13:01<23:28, 44.00s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:45<22:42, 43.96s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:10<19:06, 38.21s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:54<19:20, 40.03s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:32<18:26, 39.52s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:17<18:24, 40.91s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [16:45<16:05, 37.12s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:28<16:14, 38.99s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:13<16:14, 40.62s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [18:57<16:01, 41.81s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [19:41<15:30, 42.29s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:24<14:57, 42.75s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [21:03<13:51, 41.56s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [21:47<13:24, 42.34s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [22:31<12:50, 42.82s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [23:15<12:11, 43.01s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [24:00<11:37, 43.56s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [24:44<10:57, 43.85s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [25:29<10:16, 44.03s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [26:00<08:42, 40.17s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [26:44<08:17, 41.45s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [27:29<07:45, 42.34s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [28:13<07:10, 43.03s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [28:57<06:28, 43.14s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [29:40<05:45, 43.16s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [30:24<05:05, 43.58s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [31:08<04:22, 43.72s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [31:53<03:39, 43.90s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [32:36<02:55, 43.81s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [33:20<02:11, 43.91s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [33:35<01:10, 35.20s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [34:20<00:38, 38.03s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:51<00:00, 35.86s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:51<00:00, 41.83s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.731} | avg. gen lenth: 277.296
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o11-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 11
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 18:12:57,693] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o11-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 11
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o11-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▎                                                     | 47/9741 [00:00<00:21, 461.23it/s]  1%|▌                                                     | 94/9741 [00:00<00:20, 463.16it/s]  1%|▊                                                    | 141/9741 [00:00<00:20, 465.11it/s]  2%|█                                                    | 188/9741 [00:00<00:20, 465.01it/s]  2%|█▎                                                   | 235/9741 [00:00<00:20, 462.77it/s]  3%|█▌                                                   | 282/9741 [00:00<00:20, 463.64it/s]  3%|█▊                                                   | 329/9741 [00:00<00:20, 463.79it/s]  4%|██                                                   | 376/9741 [00:00<00:20, 454.93it/s]  4%|██▎                                                  | 422/9741 [00:00<00:20, 456.44it/s]  5%|██▌                                                  | 468/9741 [00:01<00:20, 454.60it/s]  5%|██▊                                                  | 515/9741 [00:01<00:20, 456.75it/s]  6%|███                                                  | 562/9741 [00:01<00:20, 458.11it/s]  6%|███▎                                                 | 609/9741 [00:01<00:19, 459.56it/s]  7%|███▌                                                 | 655/9741 [00:01<00:19, 458.58it/s]  7%|███▊                                                 | 702/9741 [00:01<00:19, 459.86it/s]  8%|████                                                 | 749/9741 [00:01<00:19, 460.45it/s]  8%|████▎                                                | 796/9741 [00:01<00:19, 461.43it/s]  9%|████▌                                                | 843/9741 [00:01<00:19, 458.98it/s]  9%|████▊                                                | 889/9741 [00:01<00:19, 457.14it/s] 10%|█████                                                | 936/9741 [00:02<00:19, 458.98it/s] 10%|█████▍                                               | 999/9741 [00:02<00:17, 508.48it/s] 11%|█████▋                                              | 1070/9741 [00:02<00:15, 567.15it/s] 12%|██████                                              | 1140/9741 [00:02<00:14, 605.18it/s] 12%|██████▍                                             | 1211/9741 [00:02<00:13, 634.09it/s] 13%|██████▊                                             | 1281/9741 [00:02<00:12, 653.69it/s] 14%|███████▏                                            | 1350/9741 [00:02<00:12, 663.82it/s] 15%|███████▌                                            | 1421/9741 [00:02<00:12, 674.84it/s] 15%|███████▉                                            | 1490/9741 [00:02<00:12, 679.34it/s] 16%|████████▎                                           | 1561/9741 [00:02<00:11, 686.63it/s] 17%|████████▋                                           | 1630/9741 [00:03<00:11, 687.39it/s] 17%|█████████                                           | 1701/9741 [00:03<00:11, 691.73it/s] 18%|█████████▍                                          | 1771/9741 [00:03<00:11, 694.14it/s] 19%|█████████▊                                          | 1841/9741 [00:03<00:11, 671.46it/s] 20%|██████████▏                                         | 1911/9741 [00:03<00:11, 679.23it/s] 20%|██████████▌                                         | 1981/9741 [00:03<00:11, 684.89it/s] 21%|██████████▉                                         | 2050/9741 [00:03<00:11, 684.80it/s] 22%|███████████▎                                        | 2120/9741 [00:03<00:11, 686.63it/s] 22%|███████████▋                                        | 2190/9741 [00:03<00:10, 690.34it/s] 23%|████████████                                        | 2260/9741 [00:03<00:10, 690.60it/s] 24%|████████████▍                                       | 2330/9741 [00:04<00:10, 690.43it/s] 25%|████████████▊                                       | 2400/9741 [00:04<00:10, 693.15it/s] 25%|█████████████▏                                      | 2470/9741 [00:04<00:10, 692.99it/s] 26%|█████████████▌                                      | 2540/9741 [00:04<00:10, 689.81it/s] 27%|█████████████▉                                      | 2610/9741 [00:04<00:10, 692.15it/s] 28%|██████████████▎                                     | 2680/9741 [00:04<00:10, 693.42it/s] 28%|██████████████▋                                     | 2750/9741 [00:04<00:10, 692.04it/s] 29%|███████████████                                     | 2820/9741 [00:04<00:10, 690.64it/s] 30%|███████████████▍                                    | 2890/9741 [00:04<00:09, 692.80it/s] 30%|███████████████▊                                    | 2960/9741 [00:04<00:09, 692.30it/s] 31%|████████████████▏                                   | 3030/9741 [00:05<00:09, 694.42it/s] 32%|████████████████▌                                   | 3100/9741 [00:05<00:09, 695.12it/s] 33%|████████████████▉                                   | 3170/9741 [00:05<00:09, 693.58it/s] 33%|█████████████████▎                                  | 3241/9741 [00:05<00:09, 695.93it/s] 34%|█████████████████▋                                  | 3312/9741 [00:05<00:09, 697.32it/s] 35%|██████████████████                                  | 3382/9741 [00:05<00:09, 694.78it/s] 35%|██████████████████▍                                 | 3452/9741 [00:05<00:09, 690.08it/s] 36%|██████████████████▊                                 | 3522/9741 [00:05<00:09, 690.94it/s] 37%|███████████████████▏                                | 3592/9741 [00:05<00:08, 689.99it/s] 38%|███████████████████▌                                | 3662/9741 [00:05<00:08, 688.15it/s] 38%|███████████████████▉                                | 3732/9741 [00:06<00:08, 688.88it/s] 39%|████████████████████▎                               | 3802/9741 [00:06<00:08, 691.71it/s] 40%|████████████████████▋                               | 3872/9741 [00:06<00:08, 691.28it/s] 40%|█████████████████████                               | 3942/9741 [00:06<00:08, 693.23it/s] 41%|█████████████████████▍                              | 4012/9741 [00:06<00:08, 694.49it/s] 42%|█████████████████████▊                              | 4082/9741 [00:06<00:08, 693.07it/s] 43%|██████████████████████▏                             | 4152/9741 [00:06<00:08, 694.06it/s] 43%|██████████████████████▌                             | 4222/9741 [00:06<00:07, 694.66it/s] 44%|██████████████████████▉                             | 4292/9741 [00:06<00:07, 692.59it/s] 45%|███████████████████████▎                            | 4362/9741 [00:06<00:07, 687.08it/s] 45%|███████████████████████▋                            | 4432/9741 [00:07<00:07, 690.21it/s] 46%|████████████████████████                            | 4502/9741 [00:07<00:07, 691.98it/s] 47%|████████████████████████▍                           | 4572/9741 [00:07<00:08, 637.23it/s] 48%|████████████████████████▊                           | 4642/9741 [00:07<00:07, 654.02it/s] 48%|█████████████████████████▏                          | 4712/9741 [00:07<00:07, 666.72it/s] 49%|█████████████████████████▌                          | 4780/9741 [00:07<00:10, 488.58it/s] 50%|█████████████████████████▉                          | 4850/9741 [00:07<00:09, 535.83it/s] 51%|██████████████████████████▎                         | 4920/9741 [00:07<00:08, 575.11it/s] 51%|██████████████████████████▋                         | 4989/9741 [00:08<00:07, 603.21it/s] 52%|███████████████████████████                         | 5059/9741 [00:08<00:07, 628.79it/s] 53%|███████████████████████████▍                        | 5129/9741 [00:08<00:07, 647.16it/s] 53%|███████████████████████████▋                        | 5197/9741 [00:08<00:06, 653.55it/s] 54%|████████████████████████████                        | 5267/9741 [00:08<00:06, 665.04it/s] 55%|████████████████████████████▍                       | 5337/9741 [00:08<00:06, 674.09it/s] 55%|████████████████████████████▊                       | 5406/9741 [00:08<00:06, 678.14it/s] 56%|█████████████████████████████▏                      | 5476/9741 [00:08<00:06, 683.94it/s] 57%|█████████████████████████████▌                      | 5549/9741 [00:08<00:06, 697.10it/s] 58%|██████████████████████████████                      | 5622/9741 [00:08<00:05, 704.97it/s] 58%|██████████████████████████████▍                     | 5694/9741 [00:09<00:05, 708.27it/s] 59%|██████████████████████████████▊                     | 5767/9741 [00:09<00:05, 711.88it/s] 60%|███████████████████████████████▏                    | 5839/9741 [00:09<00:05, 712.67it/s] 61%|███████████████████████████████▌                    | 5911/9741 [00:09<00:05, 714.68it/s] 61%|███████████████████████████████▉                    | 5984/9741 [00:09<00:05, 718.37it/s] 62%|████████████████████████████████▎                   | 6057/9741 [00:09<00:05, 721.16it/s] 63%|████████████████████████████████▋                   | 6130/9741 [00:09<00:05, 720.50it/s] 64%|█████████████████████████████████                   | 6203/9741 [00:09<00:04, 721.83it/s] 64%|█████████████████████████████████▌                  | 6276/9741 [00:09<00:04, 720.70it/s] 65%|█████████████████████████████████▉                  | 6349/9741 [00:09<00:04, 719.14it/s] 66%|██████████████████████████████████▎                 | 6421/9741 [00:10<00:04, 717.95it/s] 67%|██████████████████████████████████▋                 | 6494/9741 [00:10<00:04, 720.62it/s] 67%|███████████████████████████████████                 | 6567/9741 [00:10<00:04, 689.38it/s] 68%|███████████████████████████████████▍                | 6640/9741 [00:10<00:04, 700.17it/s] 69%|███████████████████████████████████▊                | 6713/9741 [00:10<00:04, 707.64it/s] 70%|████████████████████████████████████▏               | 6786/9741 [00:10<00:04, 711.91it/s] 70%|████████████████████████████████████▌               | 6859/9741 [00:10<00:04, 716.93it/s] 71%|█████████████████████████████████████               | 6932/9741 [00:10<00:03, 720.41it/s] 72%|█████████████████████████████████████▍              | 7005/9741 [00:10<00:03, 720.56it/s] 73%|█████████████████████████████████████▊              | 7078/9741 [00:10<00:03, 722.82it/s] 73%|██████████████████████████████████████▏             | 7151/9741 [00:11<00:03, 724.38it/s] 74%|██████████████████████████████████████▌             | 7224/9741 [00:11<00:03, 722.41it/s] 75%|██████████████████████████████████████▉             | 7297/9741 [00:11<00:03, 723.56it/s] 76%|███████████████████████████████████████▎            | 7370/9741 [00:11<00:03, 715.86it/s] 76%|███████████████████████████████████████▋            | 7442/9741 [00:11<00:03, 682.73it/s] 77%|████████████████████████████████████████            | 7515/9741 [00:11<00:03, 693.94it/s] 78%|████████████████████████████████████████▌           | 7588/9741 [00:11<00:03, 702.20it/s] 79%|████████████████████████████████████████▉           | 7661/9741 [00:11<00:02, 707.78it/s] 79%|█████████████████████████████████████████▎          | 7733/9741 [00:11<00:02, 710.78it/s] 80%|█████████████████████████████████████████▋          | 7806/9741 [00:12<00:02, 714.96it/s] 81%|██████████████████████████████████████████          | 7878/9741 [00:12<00:02, 714.35it/s] 82%|██████████████████████████████████████████▍         | 7950/9741 [00:12<00:02, 715.30it/s] 82%|██████████████████████████████████████████▊         | 8023/9741 [00:12<00:02, 717.89it/s] 83%|███████████████████████████████████████████▏        | 8096/9741 [00:12<00:02, 718.70it/s] 84%|███████████████████████████████████████████▌        | 8168/9741 [00:12<00:02, 716.99it/s] 85%|███████████████████████████████████████████▉        | 8241/9741 [00:12<00:02, 719.34it/s] 85%|████████████████████████████████████████████▍       | 8314/9741 [00:12<00:01, 720.11it/s] 86%|████████████████████████████████████████████▊       | 8387/9741 [00:12<00:01, 718.79it/s] 87%|█████████████████████████████████████████████▏      | 8460/9741 [00:12<00:01, 721.30it/s] 88%|█████████████████████████████████████████████▌      | 8533/9741 [00:13<00:01, 721.75it/s] 88%|█████████████████████████████████████████████▉      | 8606/9741 [00:13<00:01, 718.32it/s] 89%|██████████████████████████████████████████████▎     | 8678/9741 [00:13<00:01, 717.68it/s] 90%|██████████████████████████████████████████████▋     | 8751/9741 [00:13<00:01, 719.63it/s] 91%|███████████████████████████████████████████████     | 8823/9741 [00:13<00:01, 713.33it/s] 91%|███████████████████████████████████████████████▍    | 8895/9741 [00:13<00:01, 715.15it/s] 92%|███████████████████████████████████████████████▊    | 8968/9741 [00:13<00:01, 716.92it/s] 93%|████████████████████████████████████████████████▎   | 9040/9741 [00:13<00:00, 716.29it/s] 94%|████████████████████████████████████████████████▋   | 9112/9741 [00:13<00:00, 716.59it/s] 94%|█████████████████████████████████████████████████   | 9185/9741 [00:13<00:00, 719.09it/s] 95%|█████████████████████████████████████████████████▍  | 9257/9741 [00:14<00:00, 717.38it/s] 96%|█████████████████████████████████████████████████▊  | 9329/9741 [00:14<00:00, 715.43it/s] 97%|██████████████████████████████████████████████████▏ | 9402/9741 [00:14<00:00, 717.47it/s] 97%|██████████████████████████████████████████████████▌ | 9475/9741 [00:14<00:00, 718.77it/s] 98%|██████████████████████████████████████████████████▉ | 9547/9741 [00:14<00:00, 717.17it/s] 99%|███████████████████████████████████████████████████▎| 9620/9741 [00:14<00:00, 718.46it/s]100%|███████████████████████████████████████████████████▋| 9693/9741 [00:14<00:00, 719.45it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:14<00:00, 661.61it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.43s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.49s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.58s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.77s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.25s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.44s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.54s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.87s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.84s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.00s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.92s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.10s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.12s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.31s/it]
[2023-08-21 18:14:05,922] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 18:14:24,280] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 18:14:24,281] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 18:14:24,281] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 18:14:24,281] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 18:14:24,281] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 18:14:24,281] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f19e4d8dfd0>
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f19e4c95220>
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 18:14:24,282] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 18:14:24,283] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 18:14:24,283] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4397087097167969 seconds
Loading extension module utils...
Time to load utils op: 0.4045848846435547 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o11-tgsm8k-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.4043896198272705 seconds
Loading extension module utils...
Time to load utils op: 0.4045872688293457 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:44<36:21, 44.51s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:28<35:11, 43.99s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:12<34:30, 44.05s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:56<33:45, 44.02s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:39<32:56, 43.92s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:23<32:09, 43.86s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:07<31:25, 43.85s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:50<30:36, 43.72s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:34<29:50, 43.68s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:17<28:59, 43.50s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [08:01<28:21, 43.63s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:44<27:30, 43.44s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:27<26:41, 43.29s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:10<25:54, 43.18s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:44<23:33, 40.37s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:28<23:28, 41.44s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:12<23:14, 42.25s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:55<22:38, 42.47s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:38<22:05, 42.76s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:22<21:33, 43.10s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [15:07<21:01, 43.49s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:51<20:21, 43.63s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:35<19:42, 43.79s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [17:18<18:55, 43.67s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [18:02<18:15, 43.83s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:46<17:31, 43.79s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [19:30<16:46, 43.75s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [20:14<16:03, 43.81s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:58<15:21, 43.88s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [21:42<14:39, 43.98s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [22:25<13:51, 43.76s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [23:08<13:01, 43.43s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [23:51<12:17, 43.35s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [24:34<11:31, 43.23s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [25:01<09:36, 38.45s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [25:45<09:19, 39.94s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [26:29<08:55, 41.19s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [27:13<08:25, 42.12s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [27:55<07:44, 42.18s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [28:40<07:08, 42.84s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [29:24<06:29, 43.23s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [30:07<05:46, 43.25s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [30:51<05:04, 43.50s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [31:32<04:16, 42.74s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [32:15<03:33, 42.74s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [32:58<02:51, 42.94s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [33:42<02:09, 43.02s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [34:26<01:26, 43.46s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [35:08<00:42, 42.97s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [35:41<00:00, 40.00s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [35:41<00:00, 42.83s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.5985} | avg. gen lenth: 293.924
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o12-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 12
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 18:50:16,457] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o12-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 12
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o12-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 42/9741 [00:00<00:23, 419.19it/s]  1%|▍                                                     | 85/9741 [00:00<00:22, 420.23it/s]  1%|▋                                                    | 128/9741 [00:00<00:22, 421.90it/s]  2%|▉                                                    | 171/9741 [00:00<00:22, 422.16it/s]  2%|█▏                                                   | 214/9741 [00:00<00:22, 419.88it/s]  3%|█▍                                                   | 257/9741 [00:00<00:22, 420.75it/s]  3%|█▋                                                   | 300/9741 [00:00<00:22, 421.74it/s]  4%|█▊                                                   | 343/9741 [00:00<00:22, 413.33it/s]  4%|██                                                   | 386/9741 [00:00<00:22, 416.08it/s]  4%|██▎                                                  | 428/9741 [00:01<00:22, 414.92it/s]  5%|██▌                                                  | 471/9741 [00:01<00:22, 417.21it/s]  5%|██▊                                                  | 513/9741 [00:01<00:22, 418.02it/s]  6%|███                                                  | 556/9741 [00:01<00:21, 419.10it/s]  6%|███▎                                                 | 599/9741 [00:01<00:21, 419.89it/s]  7%|███▍                                                 | 642/9741 [00:01<00:21, 420.86it/s]  7%|███▋                                                 | 685/9741 [00:01<00:21, 420.09it/s]  7%|███▉                                                 | 728/9741 [00:01<00:21, 420.43it/s]  8%|████▏                                                | 771/9741 [00:01<00:21, 417.32it/s]  8%|████▍                                                | 814/9741 [00:01<00:21, 418.60it/s]  9%|████▋                                                | 857/9741 [00:02<00:21, 420.25it/s]  9%|████▉                                                | 900/9741 [00:02<00:21, 419.57it/s] 10%|█████▏                                               | 943/9741 [00:02<00:20, 420.45it/s] 10%|█████▎                                               | 986/9741 [00:02<00:20, 421.71it/s] 11%|█████▍                                              | 1029/9741 [00:02<00:20, 422.30it/s] 11%|█████▋                                              | 1072/9741 [00:02<00:20, 419.07it/s] 11%|█████▉                                              | 1114/9741 [00:02<00:20, 419.22it/s] 12%|██████▏                                             | 1157/9741 [00:02<00:20, 420.86it/s] 12%|██████▍                                             | 1200/9741 [00:02<00:20, 421.49it/s] 13%|██████▋                                             | 1243/9741 [00:02<00:20, 422.31it/s] 13%|██████▊                                             | 1286/9741 [00:03<00:20, 419.95it/s] 14%|███████                                             | 1329/9741 [00:03<00:19, 420.78it/s] 14%|███████▎                                            | 1372/9741 [00:03<00:19, 419.95it/s] 15%|███████▌                                            | 1415/9741 [00:03<00:19, 420.52it/s] 15%|███████▊                                            | 1458/9741 [00:03<00:19, 421.52it/s] 15%|████████                                            | 1501/9741 [00:03<00:19, 421.97it/s] 16%|████████▏                                           | 1544/9741 [00:03<00:19, 422.77it/s] 16%|████████▍                                           | 1587/9741 [00:03<00:19, 421.08it/s] 17%|████████▋                                           | 1630/9741 [00:03<00:19, 422.20it/s] 17%|████████▉                                           | 1673/9741 [00:03<00:19, 421.97it/s] 18%|█████████▏                                          | 1716/9741 [00:04<00:18, 422.72it/s] 18%|█████████▍                                          | 1759/9741 [00:04<00:18, 423.57it/s] 18%|█████████▌                                          | 1802/9741 [00:04<00:19, 403.93it/s] 19%|█████████▉                                          | 1856/9741 [00:04<00:17, 441.45it/s] 20%|██████████▏                                         | 1920/9741 [00:04<00:15, 498.30it/s] 20%|██████████▌                                         | 1984/9741 [00:04<00:14, 539.62it/s] 21%|██████████▉                                         | 2048/9741 [00:04<00:13, 566.93it/s] 22%|███████████▎                                        | 2112/9741 [00:04<00:12, 588.02it/s] 22%|███████████▌                                        | 2177/9741 [00:04<00:12, 603.75it/s] 23%|███████████▉                                        | 2241/9741 [00:05<00:12, 611.71it/s] 24%|████████████▎                                       | 2305/9741 [00:05<00:12, 617.50it/s] 24%|████████████▋                                       | 2370/9741 [00:05<00:11, 624.37it/s] 25%|████████████▉                                       | 2435/9741 [00:05<00:11, 629.62it/s] 26%|█████████████▎                                      | 2499/9741 [00:05<00:11, 630.53it/s] 26%|█████████████▋                                      | 2563/9741 [00:05<00:11, 632.83it/s] 27%|██████████████                                      | 2628/9741 [00:05<00:11, 635.61it/s] 28%|██████████████▍                                     | 2693/9741 [00:05<00:11, 637.13it/s] 28%|██████████████▋                                     | 2757/9741 [00:05<00:10, 635.76it/s] 29%|███████████████                                     | 2821/9741 [00:05<00:10, 636.04it/s] 30%|███████████████▍                                    | 2885/9741 [00:06<00:10, 636.98it/s] 30%|███████████████▋                                    | 2949/9741 [00:06<00:10, 635.30it/s] 31%|████████████████                                    | 3014/9741 [00:06<00:10, 637.36it/s] 32%|████████████████▍                                   | 3078/9741 [00:06<00:10, 637.03it/s] 32%|████████████████▊                                   | 3143/9741 [00:06<00:10, 638.24it/s] 33%|█████████████████                                   | 3207/9741 [00:06<00:10, 636.64it/s] 34%|█████████████████▍                                  | 3272/9741 [00:06<00:10, 637.53it/s] 34%|█████████████████▊                                  | 3336/9741 [00:06<00:10, 636.71it/s] 35%|██████████████████▏                                 | 3400/9741 [00:06<00:09, 634.53it/s] 36%|██████████████████▍                                 | 3464/9741 [00:06<00:09, 635.70it/s] 36%|██████████████████▊                                 | 3528/9741 [00:07<00:09, 633.43it/s] 37%|███████████████████▏                                | 3592/9741 [00:07<00:09, 634.63it/s] 38%|███████████████████▌                                | 3656/9741 [00:07<00:09, 633.47it/s] 38%|███████████████████▊                                | 3720/9741 [00:07<00:09, 635.22it/s] 39%|████████████████████▏                               | 3785/9741 [00:07<00:09, 636.64it/s] 40%|████████████████████▌                               | 3849/9741 [00:07<00:09, 635.54it/s] 40%|████████████████████▉                               | 3914/9741 [00:07<00:09, 637.52it/s] 41%|█████████████████████▏                              | 3978/9741 [00:07<00:09, 637.75it/s] 41%|█████████████████████▌                              | 4042/9741 [00:07<00:08, 636.01it/s] 42%|█████████████████████▉                              | 4106/9741 [00:07<00:08, 634.99it/s] 43%|██████████████████████▎                             | 4170/9741 [00:08<00:08, 635.68it/s] 43%|██████████████████████▌                             | 4234/9741 [00:08<00:08, 636.52it/s] 44%|██████████████████████▉                             | 4298/9741 [00:08<00:08, 636.14it/s] 45%|███████████████████████▎                            | 4362/9741 [00:08<00:08, 636.12it/s] 45%|███████████████████████▋                            | 4426/9741 [00:08<00:08, 636.21it/s] 46%|███████████████████████▉                            | 4490/9741 [00:08<00:08, 636.40it/s] 47%|████████████████████████▎                           | 4554/9741 [00:08<00:08, 606.53it/s] 47%|████████████████████████▋                           | 4618/9741 [00:08<00:08, 615.99it/s] 48%|████████████████████████▉                           | 4683/9741 [00:08<00:08, 623.50it/s] 49%|█████████████████████████▎                          | 4746/9741 [00:09<00:11, 451.79it/s] 49%|█████████████████████████▋                          | 4810/9741 [00:09<00:09, 495.39it/s] 50%|██████████████████████████                          | 4874/9741 [00:09<00:09, 531.07it/s] 51%|██████████████████████████▎                         | 4938/9741 [00:09<00:08, 558.80it/s] 51%|██████████████████████████▋                         | 5001/9741 [00:09<00:08, 575.88it/s] 52%|███████████████████████████                         | 5066/9741 [00:09<00:07, 594.46it/s] 53%|███████████████████████████▍                        | 5130/9741 [00:09<00:07, 607.36it/s] 53%|███████████████████████████▋                        | 5194/9741 [00:09<00:07, 614.88it/s] 54%|████████████████████████████                        | 5259/9741 [00:09<00:07, 622.36it/s] 55%|████████████████████████████▍                       | 5323/9741 [00:09<00:07, 627.28it/s] 55%|████████████████████████████▊                       | 5387/9741 [00:10<00:06, 630.78it/s] 56%|█████████████████████████████                       | 5451/9741 [00:10<00:06, 630.45it/s] 57%|█████████████████████████████▍                      | 5517/9741 [00:10<00:06, 638.70it/s] 57%|█████████████████████████████▊                      | 5584/9741 [00:10<00:06, 647.07it/s] 58%|██████████████████████████████▏                     | 5650/9741 [00:10<00:06, 649.78it/s] 59%|██████████████████████████████▌                     | 5717/9741 [00:10<00:06, 654.17it/s] 59%|██████████████████████████████▉                     | 5784/9741 [00:10<00:06, 657.80it/s] 60%|███████████████████████████████▏                    | 5850/9741 [00:10<00:05, 657.83it/s] 61%|███████████████████████████████▌                    | 5917/9741 [00:10<00:05, 660.33it/s] 61%|███████████████████████████████▉                    | 5984/9741 [00:11<00:05, 661.73it/s] 62%|████████████████████████████████▎                   | 6051/9741 [00:11<00:05, 660.56it/s] 63%|████████████████████████████████▋                   | 6118/9741 [00:11<00:05, 659.38it/s] 63%|█████████████████████████████████                   | 6185/9741 [00:11<00:05, 660.64it/s] 64%|█████████████████████████████████▎                  | 6252/9741 [00:11<00:05, 660.39it/s] 65%|█████████████████████████████████▋                  | 6319/9741 [00:11<00:05, 658.71it/s] 66%|██████████████████████████████████                  | 6386/9741 [00:11<00:05, 659.99it/s] 66%|██████████████████████████████████▍                 | 6453/9741 [00:11<00:04, 660.77it/s] 67%|██████████████████████████████████▊                 | 6520/9741 [00:11<00:04, 661.19it/s] 68%|███████████████████████████████████▏                | 6587/9741 [00:11<00:04, 659.78it/s] 68%|███████████████████████████████████▌                | 6654/9741 [00:12<00:04, 660.53it/s] 69%|███████████████████████████████████▉                | 6721/9741 [00:12<00:04, 661.05it/s] 70%|████████████████████████████████████▏               | 6788/9741 [00:12<00:04, 660.07it/s] 70%|████████████████████████████████████▌               | 6855/9741 [00:12<00:04, 661.35it/s] 71%|████████████████████████████████████▉               | 6922/9741 [00:12<00:04, 662.02it/s] 72%|█████████████████████████████████████▎              | 6989/9741 [00:12<00:04, 661.10it/s] 72%|█████████████████████████████████████▋              | 7056/9741 [00:12<00:04, 660.99it/s] 73%|██████████████████████████████████████              | 7123/9741 [00:12<00:03, 659.55it/s] 74%|██████████████████████████████████████▍             | 7190/9741 [00:12<00:03, 660.30it/s] 74%|██████████████████████████████████████▋             | 7257/9741 [00:12<00:03, 653.62it/s] 75%|███████████████████████████████████████             | 7324/9741 [00:13<00:03, 656.29it/s] 76%|███████████████████████████████████████▍            | 7390/9741 [00:13<00:03, 655.29it/s] 77%|███████████████████████████████████████▊            | 7456/9741 [00:13<00:03, 626.74it/s] 77%|████████████████████████████████████████▏           | 7522/9741 [00:13<00:03, 636.25it/s] 78%|████████████████████████████████████████▌           | 7589/9741 [00:13<00:03, 643.57it/s] 79%|████████████████████████████████████████▊           | 7656/9741 [00:13<00:03, 648.51it/s] 79%|█████████████████████████████████████████▏          | 7722/9741 [00:13<00:03, 649.97it/s] 80%|█████████████████████████████████████████▌          | 7788/9741 [00:13<00:03, 650.07it/s] 81%|█████████████████████████████████████████▉          | 7855/9741 [00:13<00:02, 653.44it/s] 81%|██████████████████████████████████████████▎         | 7921/9741 [00:13<00:02, 653.36it/s] 82%|██████████████████████████████████████████▋         | 7987/9741 [00:14<00:02, 655.32it/s] 83%|██████████████████████████████████████████▉         | 8053/9741 [00:14<00:02, 656.45it/s] 83%|███████████████████████████████████████████▎        | 8120/9741 [00:14<00:02, 656.67it/s] 84%|███████████████████████████████████████████▋        | 8186/9741 [00:14<00:02, 657.42it/s] 85%|████████████████████████████████████████████        | 8252/9741 [00:14<00:02, 658.14it/s] 85%|████████████████████████████████████████████▍       | 8318/9741 [00:14<00:02, 652.29it/s] 86%|████████████████████████████████████████████▊       | 8384/9741 [00:14<00:02, 650.86it/s] 87%|█████████████████████████████████████████████       | 8450/9741 [00:14<00:01, 653.00it/s] 87%|█████████████████████████████████████████████▍      | 8516/9741 [00:14<00:01, 654.07it/s] 88%|█████████████████████████████████████████████▊      | 8582/9741 [00:14<00:01, 652.63it/s] 89%|██████████████████████████████████████████████▏     | 8648/9741 [00:15<00:01, 653.60it/s] 89%|██████████████████████████████████████████████▌     | 8714/9741 [00:15<00:01, 652.80it/s] 90%|██████████████████████████████████████████████▊     | 8780/9741 [00:15<00:01, 654.77it/s] 91%|███████████████████████████████████████████████▏    | 8846/9741 [00:15<00:01, 653.22it/s] 91%|███████████████████████████████████████████████▌    | 8913/9741 [00:15<00:01, 655.37it/s] 92%|███████████████████████████████████████████████▉    | 8979/9741 [00:15<00:01, 656.51it/s] 93%|████████████████████████████████████████████████▎   | 9045/9741 [00:15<00:01, 654.39it/s] 94%|████████████████████████████████████████████████▋   | 9111/9741 [00:15<00:00, 655.58it/s] 94%|████████████████████████████████████████████████▉   | 9177/9741 [00:15<00:00, 656.36it/s] 95%|█████████████████████████████████████████████████▎  | 9243/9741 [00:15<00:00, 656.61it/s] 96%|█████████████████████████████████████████████████▋  | 9309/9741 [00:16<00:00, 654.46it/s] 96%|██████████████████████████████████████████████████  | 9375/9741 [00:16<00:00, 654.05it/s] 97%|██████████████████████████████████████████████████▍ | 9441/9741 [00:16<00:00, 647.31it/s] 98%|██████████████████████████████████████████████████▋ | 9506/9741 [00:16<00:00, 646.60it/s] 98%|███████████████████████████████████████████████████ | 9572/9741 [00:16<00:00, 650.11it/s] 99%|███████████████████████████████████████████████████▍| 9638/9741 [00:16<00:00, 651.72it/s]100%|███████████████████████████████████████████████████▊| 9704/9741 [00:16<00:00, 652.70it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:16<00:00, 581.65it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.93s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.94s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.34s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.02s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:09<00:18,  9.31s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.39s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.55s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.37s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.54s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.89s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.85s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.01s/it]
Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:17<00:08,  8.62s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:23<00:00,  7.47s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:23<00:00,  7.85s/it]
[2023-08-21 18:51:34,355] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 18:51:47,911] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 18:51:47,912] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fdc84268fd0>
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 18:51:47,913] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fdc83eee220>
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 18:51:47,914] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 18:51:47,914] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.564551830291748 seconds
Loading extension module utils...
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Time to load utils op: 0.504751443862915 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o12-tgsm8k-s10-rFalse
Loading extension module utils...
Loading extension module utils...Time to load utils op: 0.605461597442627 seconds

Time to load utils op: 0.6055707931518555 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:43<35:33, 43.53s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:14<28:48, 36.01s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:57<30:47, 39.31s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:40<31:10, 40.65s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:23<31:11, 41.59s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:06<30:50, 42.06s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:27<25:06, 35.03s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:01<24:22, 34.83s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:23<21:08, 30.94s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:02<22:13, 33.34s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [06:45<23:29, 36.15s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:28<24:21, 38.45s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:12<24:40, 40.01s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [08:55<24:38, 41.08s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:39<24:21, 41.76s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:22<23:51, 42.11s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:56<21:49, 39.67s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:35<21:09, 39.68s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:19<21:07, 40.88s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:03<20:50, 41.70s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:46<20:20, 42.09s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:29<19:49, 42.47s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:12<19:08, 42.55s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:54<18:27, 42.59s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:38<17:54, 42.97s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:22<17:15, 43.14s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [18:05<16:30, 43.07s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:48<15:46, 43.03s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:31<15:02, 43.00s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [20:14<14:24, 43.21s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:58<13:42, 43.28s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [21:41<12:56, 43.16s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [22:24<12:15, 43.28s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:05<11:20, 42.56s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [23:48<10:40, 42.69s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [24:31<09:56, 42.64s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [25:13<09:13, 42.58s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [25:35<07:18, 36.54s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [26:18<07:00, 38.24s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [27:00<06:35, 39.56s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [27:43<06:03, 40.42s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [28:26<05:29, 41.14s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [29:09<04:53, 41.91s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [29:51<04:11, 41.98s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [30:34<03:30, 42.12s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [31:18<02:51, 42.83s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [32:02<02:09, 43.01s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [32:25<01:14, 37.22s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [33:08<00:38, 38.92s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:52<00:00, 40.24s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:52<00:00, 40.64s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.9943} | avg. gen lenth: 272.464
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o13-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 13
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 19:26:34,554] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o13-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 13
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o13-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 41/9741 [00:00<00:24, 401.66it/s]  1%|▍                                                     | 82/9741 [00:00<00:24, 389.76it/s]  1%|▋                                                    | 123/9741 [00:00<00:24, 395.54it/s]  2%|▉                                                    | 164/9741 [00:00<00:24, 398.74it/s]  2%|█                                                    | 204/9741 [00:00<00:24, 396.89it/s]  3%|█▎                                                   | 245/9741 [00:00<00:23, 398.60it/s]  3%|█▌                                                   | 286/9741 [00:00<00:23, 399.58it/s]  3%|█▊                                                   | 327/9741 [00:00<00:23, 400.62it/s]  4%|██                                                   | 368/9741 [00:00<00:23, 400.73it/s]  4%|██▏                                                  | 409/9741 [00:01<00:23, 401.44it/s]  5%|██▍                                                  | 450/9741 [00:01<00:23, 399.90it/s]  5%|██▋                                                  | 490/9741 [00:01<00:23, 399.15it/s]  5%|██▉                                                  | 531/9741 [00:01<00:23, 399.86it/s]  6%|███                                                  | 572/9741 [00:01<00:22, 400.14it/s]  6%|███▎                                                 | 613/9741 [00:01<00:22, 401.07it/s]  7%|███▌                                                 | 654/9741 [00:01<00:22, 399.81it/s]  7%|███▊                                                 | 695/9741 [00:01<00:22, 400.86it/s]  8%|████                                                 | 736/9741 [00:01<00:22, 401.18it/s]  8%|████▏                                                | 777/9741 [00:01<00:22, 401.64it/s]  8%|████▍                                                | 818/9741 [00:02<00:22, 402.23it/s]  9%|████▋                                                | 859/9741 [00:02<00:22, 402.17it/s]  9%|████▉                                                | 900/9741 [00:02<00:22, 400.57it/s] 10%|█████                                                | 941/9741 [00:02<00:21, 401.02it/s] 10%|█████▎                                               | 982/9741 [00:02<00:21, 401.07it/s] 11%|█████▍                                              | 1023/9741 [00:02<00:21, 398.45it/s] 11%|█████▋                                              | 1065/9741 [00:02<00:21, 403.82it/s] 12%|██████                                              | 1125/9741 [00:02<00:18, 461.64it/s] 12%|██████▎                                             | 1186/9741 [00:02<00:16, 505.44it/s] 13%|██████▋                                             | 1247/9741 [00:02<00:15, 535.24it/s] 13%|██████▉                                             | 1308/9741 [00:03<00:15, 557.05it/s] 14%|███████▎                                            | 1369/9741 [00:03<00:14, 570.42it/s] 15%|███████▋                                            | 1430/9741 [00:03<00:14, 580.90it/s] 15%|███████▉                                            | 1491/9741 [00:03<00:14, 589.02it/s] 16%|████████▎                                           | 1552/9741 [00:03<00:13, 594.69it/s] 17%|████████▌                                           | 1612/9741 [00:03<00:13, 595.14it/s] 17%|████████▉                                           | 1673/9741 [00:03<00:13, 599.29it/s] 18%|█████████▎                                          | 1734/9741 [00:03<00:13, 600.88it/s] 18%|█████████▌                                          | 1795/9741 [00:03<00:14, 558.64it/s] 19%|█████████▉                                          | 1856/9741 [00:03<00:13, 571.72it/s] 20%|██████████▏                                         | 1917/9741 [00:04<00:13, 581.28it/s] 20%|██████████▌                                         | 1978/9741 [00:04<00:13, 588.74it/s] 21%|██████████▉                                         | 2038/9741 [00:04<00:13, 591.06it/s] 22%|███████████▏                                        | 2099/9741 [00:04<00:12, 595.14it/s] 22%|███████████▌                                        | 2160/9741 [00:04<00:12, 598.95it/s] 23%|███████████▊                                        | 2221/9741 [00:04<00:12, 601.66it/s] 23%|████████████▏                                       | 2282/9741 [00:04<00:12, 600.79it/s] 24%|████████████▌                                       | 2343/9741 [00:04<00:12, 602.07it/s] 25%|████████████▊                                       | 2404/9741 [00:04<00:12, 603.87it/s] 25%|█████████████▏                                      | 2465/9741 [00:05<00:12, 604.92it/s] 26%|█████████████▍                                      | 2526/9741 [00:05<00:11, 602.13it/s] 27%|█████████████▊                                      | 2587/9741 [00:05<00:11, 602.99it/s] 27%|██████████████▏                                     | 2648/9741 [00:05<00:11, 603.36it/s] 28%|██████████████▍                                     | 2709/9741 [00:05<00:11, 601.01it/s] 28%|██████████████▊                                     | 2770/9741 [00:05<00:11, 601.28it/s] 29%|███████████████                                     | 2831/9741 [00:05<00:11, 602.30it/s] 30%|███████████████▍                                    | 2892/9741 [00:05<00:11, 603.35it/s] 30%|███████████████▊                                    | 2953/9741 [00:05<00:11, 601.64it/s] 31%|████████████████                                    | 3014/9741 [00:05<00:11, 602.95it/s] 32%|████████████████▍                                   | 3075/9741 [00:06<00:11, 602.69it/s] 32%|████████████████▋                                   | 3136/9741 [00:06<00:10, 603.63it/s] 33%|█████████████████                                   | 3197/9741 [00:06<00:10, 602.20it/s] 33%|█████████████████▍                                  | 3258/9741 [00:06<00:10, 603.91it/s] 34%|█████████████████▋                                  | 3319/9741 [00:06<00:10, 604.83it/s] 35%|██████████████████                                  | 3380/9741 [00:06<00:10, 602.35it/s] 35%|██████████████████▎                                 | 3441/9741 [00:06<00:10, 603.25it/s] 36%|██████████████████▋                                 | 3502/9741 [00:06<00:10, 602.72it/s] 37%|███████████████████                                 | 3563/9741 [00:06<00:10, 600.80it/s] 37%|███████████████████▎                                | 3624/9741 [00:06<00:10, 598.83it/s] 38%|███████████████████▋                                | 3685/9741 [00:07<00:10, 600.51it/s] 38%|███████████████████▉                                | 3746/9741 [00:07<00:09, 602.52it/s] 39%|████████████████████▎                               | 3807/9741 [00:07<00:09, 603.13it/s] 40%|████████████████████▋                               | 3868/9741 [00:07<00:09, 600.91it/s] 40%|████████████████████▉                               | 3929/9741 [00:07<00:09, 601.49it/s] 41%|█████████████████████▎                              | 3990/9741 [00:07<00:09, 602.47it/s] 42%|█████████████████████▋                              | 4051/9741 [00:07<00:09, 603.85it/s] 42%|█████████████████████▉                              | 4112/9741 [00:07<00:09, 601.91it/s] 43%|██████████████████████▎                             | 4173/9741 [00:07<00:09, 602.71it/s] 43%|██████████████████████▌                             | 4234/9741 [00:07<00:09, 603.00it/s] 44%|██████████████████████▉                             | 4295/9741 [00:08<00:09, 602.02it/s] 45%|███████████████████████▎                            | 4356/9741 [00:08<00:08, 601.56it/s] 45%|███████████████████████▌                            | 4417/9741 [00:08<00:08, 602.07it/s] 46%|███████████████████████▉                            | 4478/9741 [00:08<00:08, 602.54it/s] 47%|████████████████████████▏                           | 4539/9741 [00:08<00:09, 572.80it/s] 47%|████████████████████████▌                           | 4599/9741 [00:08<00:08, 580.17it/s] 48%|████████████████████████▉                           | 4660/9741 [00:08<00:08, 587.40it/s] 48%|█████████████████████████▏                          | 4721/9741 [00:08<00:08, 593.09it/s] 49%|█████████████████████████▌                          | 4781/9741 [00:08<00:11, 432.17it/s] 50%|█████████████████████████▊                          | 4842/9741 [00:09<00:10, 472.02it/s] 50%|██████████████████████████▏                         | 4903/9741 [00:09<00:09, 505.16it/s] 51%|██████████████████████████▍                         | 4963/9741 [00:09<00:09, 528.52it/s] 52%|██████████████████████████▊                         | 5024/9741 [00:09<00:08, 549.65it/s] 52%|███████████████████████████▏                        | 5085/9741 [00:09<00:08, 565.08it/s] 53%|███████████████████████████▍                        | 5146/9741 [00:09<00:07, 576.20it/s] 53%|███████████████████████████▊                        | 5206/9741 [00:09<00:07, 581.53it/s] 54%|████████████████████████████                        | 5267/9741 [00:09<00:07, 588.10it/s] 55%|████████████████████████████▍                       | 5328/9741 [00:09<00:07, 593.19it/s] 55%|████████████████████████████▊                       | 5389/9741 [00:10<00:07, 596.28it/s] 56%|█████████████████████████████                       | 5449/9741 [00:10<00:07, 596.87it/s] 57%|█████████████████████████████▍                      | 5511/9741 [00:10<00:07, 603.27it/s] 57%|█████████████████████████████▊                      | 5574/9741 [00:10<00:06, 609.74it/s] 58%|██████████████████████████████                      | 5636/9741 [00:10<00:06, 610.98it/s] 59%|██████████████████████████████▍                     | 5699/9741 [00:10<00:06, 615.85it/s] 59%|██████████████████████████████▊                     | 5762/9741 [00:10<00:06, 619.47it/s] 60%|███████████████████████████████                     | 5825/9741 [00:10<00:06, 621.60it/s] 60%|███████████████████████████████▍                    | 5888/9741 [00:10<00:06, 620.41it/s] 61%|███████████████████████████████▊                    | 5951/9741 [00:10<00:06, 622.79it/s] 62%|████████████████████████████████                    | 6014/9741 [00:11<00:05, 623.57it/s] 62%|████████████████████████████████▍                   | 6077/9741 [00:11<00:05, 621.68it/s] 63%|████████████████████████████████▊                   | 6140/9741 [00:11<00:05, 622.54it/s] 64%|█████████████████████████████████                   | 6203/9741 [00:11<00:05, 623.44it/s] 64%|█████████████████████████████████▍                  | 6266/9741 [00:11<00:05, 623.81it/s] 65%|█████████████████████████████████▊                  | 6329/9741 [00:11<00:05, 622.52it/s] 66%|██████████████████████████████████                  | 6392/9741 [00:11<00:05, 624.06it/s] 66%|██████████████████████████████████▍                 | 6455/9741 [00:11<00:05, 602.49it/s] 67%|██████████████████████████████████▊                 | 6518/9741 [00:11<00:05, 607.83it/s] 68%|███████████████████████████████████▏                | 6580/9741 [00:11<00:05, 610.50it/s] 68%|███████████████████████████████████▍                | 6643/9741 [00:12<00:05, 615.05it/s] 69%|███████████████████████████████████▊                | 6706/9741 [00:12<00:04, 618.26it/s] 69%|████████████████████████████████████▏               | 6769/9741 [00:12<00:04, 619.50it/s] 70%|████████████████████████████████████▍               | 6832/9741 [00:12<00:04, 622.12it/s] 71%|████████████████████████████████████▊               | 6895/9741 [00:12<00:04, 624.32it/s] 71%|█████████████████████████████████████▏              | 6958/9741 [00:12<00:04, 624.19it/s] 72%|█████████████████████████████████████▍              | 7021/9741 [00:12<00:04, 622.46it/s] 73%|█████████████████████████████████████▊              | 7084/9741 [00:12<00:04, 624.08it/s] 73%|██████████████████████████████████████▏             | 7147/9741 [00:12<00:04, 624.84it/s] 74%|██████████████████████████████████████▍             | 7210/9741 [00:12<00:04, 625.70it/s] 75%|██████████████████████████████████████▊             | 7273/9741 [00:13<00:03, 623.60it/s] 75%|███████████████████████████████████████▏            | 7336/9741 [00:13<00:03, 624.50it/s] 76%|███████████████████████████████████████▍            | 7399/9741 [00:13<00:03, 624.97it/s] 77%|███████████████████████████████████████▊            | 7462/9741 [00:13<00:03, 593.92it/s] 77%|████████████████████████████████████████▏           | 7525/9741 [00:13<00:03, 602.63it/s] 78%|████████████████████████████████████████▌           | 7588/9741 [00:13<00:03, 609.09it/s] 79%|████████████████████████████████████████▊           | 7650/9741 [00:13<00:03, 609.40it/s] 79%|█████████████████████████████████████████▏          | 7712/9741 [00:13<00:03, 612.07it/s] 80%|█████████████████████████████████████████▌          | 7775/9741 [00:13<00:03, 616.46it/s] 80%|█████████████████████████████████████████▊          | 7838/9741 [00:13<00:03, 618.38it/s] 81%|██████████████████████████████████████████▏         | 7900/9741 [00:14<00:02, 618.07it/s] 82%|██████████████████████████████████████████▌         | 7963/9741 [00:14<00:02, 620.50it/s] 82%|██████████████████████████████████████████▊         | 8026/9741 [00:14<00:02, 622.52it/s] 83%|███████████████████████████████████████████▏        | 8089/9741 [00:14<00:02, 623.92it/s] 84%|███████████████████████████████████████████▌        | 8152/9741 [00:14<00:02, 623.33it/s] 84%|███████████████████████████████████████████▊        | 8215/9741 [00:14<00:02, 623.94it/s] 85%|████████████████████████████████████████████▏       | 8278/9741 [00:14<00:02, 624.03it/s] 86%|████████████████████████████████████████████▌       | 8341/9741 [00:14<00:02, 624.50it/s] 86%|████████████████████████████████████████████▊       | 8404/9741 [00:14<00:02, 621.92it/s] 87%|█████████████████████████████████████████████▏      | 8467/9741 [00:14<00:02, 620.18it/s] 88%|█████████████████████████████████████████████▌      | 8530/9741 [00:15<00:01, 618.23it/s] 88%|█████████████████████████████████████████████▊      | 8592/9741 [00:15<00:01, 614.96it/s] 89%|██████████████████████████████████████████████▏     | 8654/9741 [00:15<00:01, 609.36it/s] 89%|██████████████████████████████████████████████▌     | 8715/9741 [00:15<00:01, 609.50it/s] 90%|██████████████████████████████████████████████▊     | 8777/9741 [00:15<00:01, 610.70it/s] 91%|███████████████████████████████████████████████▏    | 8839/9741 [00:15<00:01, 608.10it/s] 91%|███████████████████████████████████████████████▌    | 8901/9741 [00:15<00:01, 610.02it/s] 92%|███████████████████████████████████████████████▊    | 8963/9741 [00:15<00:01, 611.16it/s] 93%|████████████████████████████████████████████████▏   | 9025/9741 [00:15<00:01, 611.85it/s] 93%|████████████████████████████████████████████████▌   | 9087/9741 [00:15<00:01, 609.27it/s] 94%|████████████████████████████████████████████████▊   | 9148/9741 [00:16<00:00, 608.58it/s] 95%|█████████████████████████████████████████████████▏  | 9210/9741 [00:16<00:00, 609.90it/s] 95%|█████████████████████████████████████████████████▍  | 9271/9741 [00:16<00:00, 608.73it/s] 96%|█████████████████████████████████████████████████▊  | 9333/9741 [00:16<00:00, 610.25it/s] 96%|██████████████████████████████████████████████████▏ | 9395/9741 [00:16<00:00, 611.09it/s] 97%|██████████████████████████████████████████████████▍ | 9457/9741 [00:16<00:00, 611.38it/s] 98%|██████████████████████████████████████████████████▊ | 9519/9741 [00:16<00:00, 609.20it/s] 98%|███████████████████████████████████████████████████▏| 9581/9741 [00:16<00:00, 609.78it/s] 99%|███████████████████████████████████████████████████▍| 9643/9741 [00:16<00:00, 610.15it/s]100%|███████████████████████████████████████████████████▊| 9705/9741 [00:17<00:00, 605.45it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:17<00:00, 570.72it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.02s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.28s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.15s/it]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.94s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.03s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.35s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.33s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]
[2023-08-21 19:27:42,968] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.41s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.59s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.87s/it]
Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.79s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.19s/it]
[2023-08-21 19:27:59,841] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 19:27:59,842] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 19:27:59,843] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 19:27:59,843] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 19:27:59,843] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 19:27:59,843] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 19:27:59,843] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 19:27:59,843] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 19:27:59,843] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 19:27:59,843] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 19:27:59,843] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 19:27:59,843] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fcb3aefcfd0>
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fcb3ad0d220>
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 19:27:59,844] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 19:27:59,845] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 19:27:59,845] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 19:27:59,845] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 19:27:59,845] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5388128757476807 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]Loading extension module utils...
############### Example ###############
Time to load utils op: 0.5049190521240234 seconds
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o13-tgsm8k-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.4046297073364258 seconds
Loading extension module utils...
Time to load utils op: 0.604954719543457 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:43<35:38, 43.64s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:25<34:10, 42.72s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:08<33:22, 42.60s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:51<32:55, 42.95s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:34<32:05, 42.79s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:16<31:16, 42.64s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:35<24:58, 34.84s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:17<26:03, 37.23s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:00<26:39, 39.02s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:43<26:48, 40.21s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:25<26:25, 40.65s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:06<25:56, 40.95s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:49<25:30, 41.36s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:32<25:06, 41.85s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:15<24:36, 42.19s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:58<24:06, 42.55s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:40<23:18, 42.39s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:18<21:57, 41.18s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:01<21:32, 41.69s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:37<19:55, 39.86s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:19<19:37, 40.62s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:01<19:10, 41.09s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:44<18:41, 41.52s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [16:27<18:09, 41.91s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:06<17:05, 41.02s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:44<16:04, 40.18s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [18:16<14:30, 37.85s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:58<14:18, 39.00s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:41<14:01, 40.09s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [20:05<11:44, 35.25s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:46<11:45, 37.11s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [21:28<11:37, 38.72s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [22:11<11:19, 39.95s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [22:53<10:48, 40.54s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [23:36<10:17, 41.19s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [24:18<09:38, 41.35s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [25:00<09:00, 41.60s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [25:41<08:18, 41.56s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [26:24<07:39, 41.81s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [26:48<06:06, 36.64s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [27:31<05:46, 38.47s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [28:14<05:18, 39.83s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [28:39<04:07, 35.35s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [29:20<03:43, 37.20s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [30:02<03:13, 38.61s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [30:44<02:38, 39.53s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [31:25<02:00, 40.12s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [32:08<01:21, 40.94s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [32:50<00:41, 41.28s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:33<00:00, 41.62s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:33<00:00, 40.27s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.1057} | avg. gen lenth: 280.168
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o14-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 14
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 20:01:43,652] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o14-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 14
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o14-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 37/9741 [00:00<00:26, 365.33it/s]  1%|▍                                                     | 74/9741 [00:00<00:26, 367.62it/s]  1%|▌                                                    | 112/9741 [00:00<00:26, 369.20it/s]  2%|▊                                                    | 150/9741 [00:00<00:25, 369.60it/s]  2%|█                                                    | 187/9741 [00:00<00:25, 369.20it/s]  2%|█▏                                                   | 224/9741 [00:00<00:25, 367.20it/s]  3%|█▍                                                   | 262/9741 [00:00<00:25, 368.21it/s]  3%|█▋                                                   | 299/9741 [00:00<00:25, 363.31it/s]  3%|█▊                                                   | 336/9741 [00:00<00:25, 364.35it/s]  4%|██                                                   | 373/9741 [00:01<00:25, 365.73it/s]  4%|██▏                                                  | 410/9741 [00:01<00:25, 366.90it/s]  5%|██▍                                                  | 447/9741 [00:01<00:25, 365.04it/s]  5%|██▋                                                  | 484/9741 [00:01<00:25, 366.18it/s]  5%|██▊                                                  | 521/9741 [00:01<00:25, 367.08it/s]  6%|███                                                  | 558/9741 [00:01<00:25, 367.22it/s]  6%|███▏                                                 | 595/9741 [00:01<00:24, 367.34it/s]  6%|███▍                                                 | 632/9741 [00:01<00:24, 367.56it/s]  7%|███▋                                                 | 669/9741 [00:01<00:24, 364.69it/s]  7%|███▊                                                 | 706/9741 [00:01<00:24, 365.94it/s]  8%|████                                                 | 743/9741 [00:02<00:24, 366.79it/s]  8%|████▎                                                | 782/9741 [00:02<00:24, 371.76it/s]  9%|████▌                                                | 838/9741 [00:02<00:20, 427.35it/s]  9%|████▊                                                | 893/9741 [00:02<00:19, 463.80it/s] 10%|█████▏                                               | 949/9741 [00:02<00:17, 491.68it/s] 10%|█████▎                                              | 1005/9741 [00:02<00:17, 510.72it/s] 11%|█████▋                                              | 1061/9741 [00:02<00:16, 524.33it/s] 11%|█████▉                                              | 1116/9741 [00:02<00:16, 531.56it/s] 12%|██████▎                                             | 1172/9741 [00:02<00:15, 539.06it/s] 13%|██████▌                                             | 1228/9741 [00:02<00:15, 543.41it/s] 13%|██████▊                                             | 1284/9741 [00:03<00:15, 546.45it/s] 14%|███████▏                                            | 1339/9741 [00:03<00:15, 543.12it/s] 14%|███████▍                                            | 1395/9741 [00:03<00:15, 546.46it/s] 15%|███████▋                                            | 1451/9741 [00:03<00:15, 549.05it/s] 15%|████████                                            | 1507/9741 [00:03<00:14, 549.80it/s] 16%|████████▎                                           | 1562/9741 [00:03<00:14, 549.38it/s] 17%|████████▋                                           | 1617/9741 [00:03<00:14, 549.50it/s] 17%|████████▉                                           | 1673/9741 [00:03<00:14, 551.39it/s] 18%|█████████▏                                          | 1729/9741 [00:03<00:14, 551.71it/s] 18%|█████████▌                                          | 1785/9741 [00:03<00:14, 552.81it/s] 19%|█████████▊                                          | 1841/9741 [00:04<00:14, 528.18it/s] 19%|██████████▏                                         | 1897/9741 [00:04<00:14, 535.12it/s] 20%|██████████▍                                         | 1953/9741 [00:04<00:14, 539.90it/s] 21%|██████████▋                                         | 2008/9741 [00:04<00:14, 538.79it/s] 21%|███████████                                         | 2062/9741 [00:04<00:14, 537.33it/s] 22%|███████████▎                                        | 2118/9741 [00:04<00:14, 541.29it/s] 22%|███████████▌                                        | 2174/9741 [00:04<00:13, 545.43it/s] 23%|███████████▉                                        | 2230/9741 [00:04<00:13, 547.68it/s] 23%|████████████▏                                       | 2285/9741 [00:04<00:13, 547.37it/s] 24%|████████████▍                                       | 2341/9741 [00:04<00:13, 549.46it/s] 25%|████████████▊                                       | 2397/9741 [00:05<00:13, 551.29it/s] 25%|█████████████                                       | 2453/9741 [00:05<00:13, 552.63it/s] 26%|█████████████▍                                      | 2509/9741 [00:05<00:13, 550.38it/s] 26%|█████████████▋                                      | 2565/9741 [00:05<00:13, 550.71it/s] 27%|█████████████▉                                      | 2621/9741 [00:05<00:12, 552.61it/s] 27%|██████████████▎                                     | 2677/9741 [00:05<00:12, 552.55it/s] 28%|██████████████▌                                     | 2733/9741 [00:05<00:12, 547.03it/s] 29%|██████████████▉                                     | 2788/9741 [00:05<00:12, 547.21it/s] 29%|███████████████▏                                    | 2844/9741 [00:05<00:12, 548.69it/s] 30%|███████████████▍                                    | 2900/9741 [00:05<00:12, 549.91it/s] 30%|███████████████▊                                    | 2955/9741 [00:06<00:12, 548.37it/s] 31%|████████████████                                    | 3011/9741 [00:06<00:12, 550.33it/s] 31%|████████████████▎                                   | 3067/9741 [00:06<00:12, 550.49it/s] 32%|████████████████▋                                   | 3123/9741 [00:06<00:12, 551.17it/s] 33%|████████████████▉                                   | 3179/9741 [00:06<00:11, 549.35it/s] 33%|█████████████████▎                                  | 3235/9741 [00:06<00:11, 550.76it/s] 34%|█████████████████▌                                  | 3291/9741 [00:06<00:11, 551.95it/s] 34%|█████████████████▊                                  | 3347/9741 [00:06<00:11, 552.26it/s] 35%|██████████████████▏                                 | 3403/9741 [00:06<00:11, 550.42it/s] 36%|██████████████████▍                                 | 3459/9741 [00:07<00:11, 550.15it/s] 36%|██████████████████▊                                 | 3515/9741 [00:07<00:11, 550.56it/s] 37%|███████████████████                                 | 3571/9741 [00:07<00:11, 550.56it/s] 37%|███████████████████▎                                | 3627/9741 [00:07<00:11, 549.10it/s] 38%|███████████████████▋                                | 3682/9741 [00:07<00:11, 548.09it/s] 38%|███████████████████▉                                | 3738/9741 [00:07<00:10, 549.79it/s] 39%|████████████████████▎                               | 3794/9741 [00:07<00:10, 550.65it/s] 40%|████████████████████▌                               | 3850/9741 [00:07<00:10, 548.94it/s] 40%|████████████████████▊                               | 3906/9741 [00:07<00:10, 550.55it/s] 41%|█████████████████████▏                              | 3962/9741 [00:07<00:10, 551.19it/s] 41%|█████████████████████▍                              | 4018/9741 [00:08<00:10, 552.19it/s] 42%|█████████████████████▋                              | 4074/9741 [00:08<00:10, 550.67it/s] 42%|██████████████████████                              | 4130/9741 [00:08<00:10, 551.71it/s] 43%|██████████████████████▎                             | 4186/9741 [00:08<00:10, 551.37it/s] 44%|██████████████████████▋                             | 4242/9741 [00:08<00:09, 551.88it/s] 44%|██████████████████████▉                             | 4298/9741 [00:08<00:09, 550.63it/s] 45%|███████████████████████▏                            | 4354/9741 [00:08<00:09, 551.77it/s] 45%|███████████████████████▌                            | 4410/9741 [00:08<00:09, 552.20it/s] 46%|███████████████████████▊                            | 4466/9741 [00:08<00:09, 552.25it/s] 46%|████████████████████████▏                           | 4522/9741 [00:08<00:09, 521.96it/s] 47%|████████████████████████▍                           | 4578/9741 [00:09<00:09, 530.34it/s] 48%|████████████████████████▋                           | 4633/9741 [00:09<00:09, 535.82it/s] 48%|█████████████████████████                           | 4689/9741 [00:09<00:09, 541.18it/s] 49%|█████████████████████████▎                          | 4744/9741 [00:09<00:11, 420.31it/s] 49%|█████████████████████████▌                          | 4800/9741 [00:09<00:10, 452.90it/s] 50%|█████████████████████████▉                          | 4855/9741 [00:09<00:10, 477.72it/s] 50%|██████████████████████████▏                         | 4910/9741 [00:09<00:09, 496.60it/s] 51%|██████████████████████████▌                         | 4965/9741 [00:09<00:09, 510.12it/s] 52%|██████████████████████████▊                         | 5021/9741 [00:09<00:09, 521.95it/s] 52%|███████████████████████████                         | 5076/9741 [00:10<00:08, 529.03it/s] 53%|███████████████████████████▍                        | 5132/9741 [00:10<00:08, 535.21it/s] 53%|███████████████████████████▋                        | 5187/9741 [00:10<00:08, 537.57it/s] 54%|███████████████████████████▉                        | 5243/9741 [00:10<00:08, 541.41it/s] 54%|████████████████████████████▎                       | 5299/9741 [00:10<00:08, 544.34it/s] 55%|████████████████████████████▌                       | 5355/9741 [00:10<00:08, 546.05it/s] 56%|████████████████████████████▉                       | 5410/9741 [00:10<00:07, 545.03it/s] 56%|█████████████████████████████▏                      | 5465/9741 [00:10<00:07, 546.30it/s] 57%|█████████████████████████████▍                      | 5522/9741 [00:10<00:07, 553.23it/s] 57%|█████████████████████████████▊                      | 5580/9741 [00:10<00:07, 559.33it/s] 58%|██████████████████████████████                      | 5637/9741 [00:11<00:07, 561.10it/s] 58%|██████████████████████████████▍                     | 5695/9741 [00:11<00:07, 565.95it/s] 59%|██████████████████████████████▋                     | 5753/9741 [00:11<00:07, 569.24it/s] 60%|███████████████████████████████                     | 5811/9741 [00:11<00:06, 570.49it/s] 60%|███████████████████████████████▎                    | 5869/9741 [00:11<00:06, 568.61it/s] 61%|███████████████████████████████▋                    | 5927/9741 [00:11<00:06, 570.48it/s] 61%|███████████████████████████████▉                    | 5985/9741 [00:11<00:06, 571.77it/s] 62%|████████████████████████████████▎                   | 6043/9741 [00:11<00:06, 572.81it/s] 63%|████████████████████████████████▌                   | 6101/9741 [00:11<00:06, 571.51it/s] 63%|████████████████████████████████▉                   | 6159/9741 [00:11<00:06, 571.36it/s] 64%|█████████████████████████████████▏                  | 6217/9741 [00:12<00:06, 572.70it/s] 64%|█████████████████████████████████▍                  | 6275/9741 [00:12<00:06, 571.46it/s] 65%|█████████████████████████████████▊                  | 6333/9741 [00:12<00:05, 569.46it/s] 66%|██████████████████████████████████                  | 6391/9741 [00:12<00:05, 570.97it/s] 66%|██████████████████████████████████▍                 | 6449/9741 [00:12<00:05, 566.21it/s] 67%|██████████████████████████████████▋                 | 6506/9741 [00:12<00:05, 567.25it/s] 67%|███████████████████████████████████                 | 6563/9741 [00:12<00:05, 565.73it/s] 68%|███████████████████████████████████▎                | 6621/9741 [00:12<00:05, 567.43it/s] 69%|███████████████████████████████████▋                | 6679/9741 [00:12<00:05, 569.30it/s] 69%|███████████████████████████████████▉                | 6737/9741 [00:12<00:05, 570.39it/s] 70%|████████████████████████████████████▎               | 6795/9741 [00:13<00:05, 568.97it/s] 70%|████████████████████████████████████▌               | 6853/9741 [00:13<00:05, 570.22it/s] 71%|████████████████████████████████████▉               | 6911/9741 [00:13<00:04, 571.27it/s] 72%|█████████████████████████████████████▏              | 6969/9741 [00:13<00:04, 571.92it/s] 72%|█████████████████████████████████████▌              | 7027/9741 [00:13<00:04, 569.65it/s] 73%|█████████████████████████████████████▊              | 7085/9741 [00:13<00:04, 570.68it/s] 73%|██████████████████████████████████████▏             | 7143/9741 [00:13<00:04, 571.37it/s] 74%|██████████████████████████████████████▍             | 7201/9741 [00:13<00:04, 571.70it/s] 75%|██████████████████████████████████████▊             | 7259/9741 [00:13<00:04, 569.15it/s] 75%|███████████████████████████████████████             | 7317/9741 [00:14<00:04, 570.03it/s] 76%|███████████████████████████████████████▎            | 7375/9741 [00:14<00:04, 571.63it/s] 76%|███████████████████████████████████████▋            | 7433/9741 [00:14<00:04, 566.30it/s] 77%|███████████████████████████████████████▉            | 7490/9741 [00:14<00:04, 534.82it/s] 77%|████████████████████████████████████████▎           | 7547/9741 [00:14<00:04, 544.21it/s] 78%|████████████████████████████████████████▌           | 7605/9741 [00:14<00:03, 551.96it/s] 79%|████████████████████████████████████████▉           | 7662/9741 [00:14<00:03, 556.85it/s] 79%|█████████████████████████████████████████▏          | 7719/9741 [00:14<00:03, 559.17it/s] 80%|█████████████████████████████████████████▌          | 7777/9741 [00:14<00:03, 562.68it/s] 80%|█████████████████████████████████████████▊          | 7835/9741 [00:14<00:03, 565.21it/s] 81%|██████████████████████████████████████████▏         | 7892/9741 [00:15<00:03, 566.53it/s] 82%|██████████████████████████████████████████▍         | 7949/9741 [00:15<00:03, 566.05it/s] 82%|██████████████████████████████████████████▋         | 8006/9741 [00:15<00:03, 567.21it/s] 83%|███████████████████████████████████████████         | 8063/9741 [00:15<00:02, 567.59it/s] 83%|███████████████████████████████████████████▎        | 8120/9741 [00:15<00:02, 566.81it/s] 84%|███████████████████████████████████████████▋        | 8178/9741 [00:15<00:02, 567.79it/s] 85%|███████████████████████████████████████████▉        | 8236/9741 [00:15<00:02, 568.90it/s] 85%|████████████████████████████████████████████▎       | 8293/9741 [00:15<00:02, 568.94it/s] 86%|████████████████████████████████████████████▌       | 8350/9741 [00:15<00:02, 558.58it/s] 86%|████████████████████████████████████████████▉       | 8407/9741 [00:15<00:02, 561.17it/s] 87%|█████████████████████████████████████████████▏      | 8465/9741 [00:16<00:02, 564.10it/s] 87%|█████████████████████████████████████████████▍      | 8522/9741 [00:16<00:02, 565.82it/s] 88%|█████████████████████████████████████████████▊      | 8579/9741 [00:16<00:02, 564.58it/s] 89%|██████████████████████████████████████████████      | 8636/9741 [00:16<00:01, 565.92it/s] 89%|██████████████████████████████████████████████▍     | 8693/9741 [00:16<00:01, 566.84it/s] 90%|██████████████████████████████████████████████▋     | 8750/9741 [00:16<00:01, 566.77it/s] 90%|███████████████████████████████████████████████     | 8807/9741 [00:16<00:01, 564.98it/s] 91%|███████████████████████████████████████████████▎    | 8864/9741 [00:16<00:01, 566.19it/s] 92%|███████████████████████████████████████████████▋    | 8922/9741 [00:16<00:01, 568.59it/s] 92%|███████████████████████████████████████████████▉    | 8979/9741 [00:16<00:01, 568.22it/s] 93%|████████████████████████████████████████████████▏   | 9036/9741 [00:17<00:01, 565.59it/s] 93%|████████████████████████████████████████████████▌   | 9094/9741 [00:17<00:01, 567.03it/s] 94%|████████████████████████████████████████████████▊   | 9151/9741 [00:17<00:01, 567.73it/s] 95%|█████████████████████████████████████████████████▏  | 9209/9741 [00:17<00:00, 568.70it/s] 95%|█████████████████████████████████████████████████▍  | 9266/9741 [00:17<00:00, 566.62it/s] 96%|█████████████████████████████████████████████████▊  | 9323/9741 [00:17<00:00, 562.53it/s] 96%|██████████████████████████████████████████████████  | 9380/9741 [00:17<00:00, 564.62it/s] 97%|██████████████████████████████████████████████████▍ | 9437/9741 [00:17<00:00, 565.58it/s] 97%|██████████████████████████████████████████████████▋ | 9494/9741 [00:17<00:00, 564.10it/s] 98%|██████████████████████████████████████████████████▉ | 9552/9741 [00:17<00:00, 566.20it/s] 99%|███████████████████████████████████████████████████▎| 9609/9741 [00:18<00:00, 566.16it/s] 99%|███████████████████████████████████████████████████▌| 9666/9741 [00:18<00:00, 565.71it/s]100%|███████████████████████████████████████████████████▉| 9723/9741 [00:18<00:00, 564.25it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:18<00:00, 531.82it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.12s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.07s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.50s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:04,  4.98s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.13s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.36s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.54s/it]
[2023-08-21 20:02:53,163] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.43s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.62s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.85s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.89s/it]
[2023-08-21 20:03:01,772] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 20:03:01,774] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 20:03:01,774] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 20:03:01,774] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 20:03:01,774] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 20:03:01,774] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fcfb4982fd0>
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 20:03:01,775] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fcfb4790220>
[2023-08-21 20:03:01,776] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 20:03:01,777] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 20:03:01,777] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.46432018280029297 seconds
Loading extension module utils...
Time to load utils op: 0.5047833919525146 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.40462327003479004 seconds
Time to load utils op: 0.40453171730041504 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input: Noah, who loves his Grammy, calls her every week to talk about his day. If each call lasts 30 minutes and he is charged $0.05 per call minute, how much would he be billed if he makes the calls for a year?
Output: 78

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o14-tgsm8k-s10-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:30<25:00, 30.63s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:11<29:24, 36.76s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:54<30:58, 39.55s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:21<26:31, 34.60s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:02<27:37, 36.84s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:43<28:03, 38.26s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:25<28:13, 39.40s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:06<27:55, 39.89s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:47<27:39, 40.48s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:29<27:08, 40.71s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:09<26:29, 40.76s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:51<25:58, 41.02s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:32<25:14, 40.94s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [08:48<20:03, 33.42s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:29<20:50, 35.72s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:11<21:14, 37.49s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:52<21:13, 38.58s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:33<21:02, 39.46s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:14<20:39, 39.99s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:57<20:19, 40.64s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:38<19:47, 40.94s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:19<19:06, 40.95s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:00<18:26, 40.99s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:41<17:47, 41.05s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:23<17:08, 41.14s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:04<16:31, 41.30s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:46<15:48, 41.25s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:27<15:08, 41.28s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:08<14:27, 41.31s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:50<13:45, 41.29s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:17<11:47, 37.23s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:59<11:33, 38.52s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:41<11:13, 39.61s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [22:22<10:42, 40.16s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:56<09:31, 38.13s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [23:38<09:08, 39.21s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [24:19<08:37, 39.83s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [24:52<07:32, 37.72s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [25:33<07:06, 38.80s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [25:50<05:22, 32.30s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [26:32<05:16, 35.18s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [27:14<04:56, 37.11s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [27:55<04:28, 38.37s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [28:37<03:56, 39.35s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [29:18<03:20, 40.08s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [29:51<02:31, 37.98s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [30:04<01:31, 30.50s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [30:47<01:08, 34.09s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [31:28<00:36, 36.28s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [32:10<00:00, 38.00s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [32:10<00:00, 38.62s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.1215} | avg. gen lenth: 301.46
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o15-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 15
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 20:37:02,227] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o15-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 15
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o15-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 34/9741 [00:00<00:28, 337.66it/s]  1%|▍                                                     | 69/9741 [00:00<00:28, 339.78it/s]  1%|▌                                                    | 104/9741 [00:00<00:28, 341.02it/s]  1%|▊                                                    | 139/9741 [00:00<00:28, 341.23it/s]  2%|▉                                                    | 174/9741 [00:00<00:28, 341.45it/s]  2%|█▏                                                   | 209/9741 [00:00<00:28, 339.29it/s]  3%|█▎                                                   | 244/9741 [00:00<00:27, 339.82it/s]  3%|█▌                                                   | 278/9741 [00:00<00:28, 334.17it/s]  3%|█▋                                                   | 312/9741 [00:00<00:28, 335.29it/s]  4%|█▉                                                   | 346/9741 [00:01<00:27, 336.50it/s]  4%|██                                                   | 381/9741 [00:01<00:27, 337.70it/s]  4%|██▎                                                  | 415/9741 [00:01<00:27, 338.28it/s]  5%|██▍                                                  | 449/9741 [00:01<00:27, 335.89it/s]  5%|██▋                                                  | 483/9741 [00:01<00:27, 336.94it/s]  5%|██▊                                                  | 517/9741 [00:01<00:27, 337.54it/s]  6%|██▉                                                  | 551/9741 [00:01<00:27, 338.03it/s]  6%|███▏                                                 | 586/9741 [00:01<00:27, 338.92it/s]  6%|███▎                                                 | 620/9741 [00:01<00:27, 336.95it/s]  7%|███▌                                                 | 654/9741 [00:01<00:27, 336.36it/s]  7%|███▋                                                 | 689/9741 [00:02<00:26, 338.58it/s]  7%|███▉                                                 | 724/9741 [00:02<00:26, 339.60it/s]  8%|████▏                                                | 759/9741 [00:02<00:26, 340.14it/s]  8%|████▎                                                | 794/9741 [00:02<00:26, 340.94it/s]  9%|████▌                                                | 829/9741 [00:02<00:26, 341.19it/s]  9%|████▋                                                | 869/9741 [00:02<00:24, 358.54it/s]  9%|█████                                                | 920/9741 [00:02<00:21, 402.63it/s] 10%|█████▎                                               | 972/9741 [00:02<00:20, 436.32it/s] 11%|█████▍                                              | 1024/9741 [00:02<00:18, 459.92it/s] 11%|█████▋                                              | 1076/9741 [00:02<00:18, 477.08it/s] 12%|██████                                              | 1127/9741 [00:03<00:17, 485.89it/s] 12%|██████▎                                             | 1179/9741 [00:03<00:17, 494.48it/s] 13%|██████▌                                             | 1231/9741 [00:03<00:17, 499.92it/s] 13%|██████▊                                             | 1283/9741 [00:03<00:16, 503.97it/s] 14%|███████▏                                            | 1335/9741 [00:03<00:16, 504.89it/s] 14%|███████▍                                            | 1387/9741 [00:03<00:16, 507.50it/s] 15%|███████▋                                            | 1439/9741 [00:03<00:16, 509.03it/s] 15%|███████▉                                            | 1491/9741 [00:03<00:16, 510.91it/s] 16%|████████▏                                           | 1543/9741 [00:03<00:16, 511.91it/s] 16%|████████▌                                           | 1595/9741 [00:03<00:15, 510.26it/s] 17%|████████▊                                           | 1647/9741 [00:04<00:15, 511.92it/s] 17%|█████████                                           | 1699/9741 [00:04<00:15, 513.02it/s] 18%|█████████▎                                          | 1751/9741 [00:04<00:15, 513.52it/s] 19%|█████████▌                                          | 1803/9741 [00:04<00:16, 491.27it/s] 19%|█████████▉                                          | 1855/9741 [00:04<00:15, 497.24it/s] 20%|██████████▏                                         | 1907/9741 [00:04<00:15, 501.90it/s] 20%|██████████▍                                         | 1958/9741 [00:04<00:15, 504.15it/s] 21%|██████████▋                                         | 2009/9741 [00:04<00:15, 503.88it/s] 21%|██████████▉                                         | 2060/9741 [00:04<00:15, 504.71it/s] 22%|███████████▎                                        | 2112/9741 [00:04<00:15, 507.09it/s] 22%|███████████▌                                        | 2164/9741 [00:05<00:14, 509.42it/s] 23%|███████████▊                                        | 2216/9741 [00:05<00:14, 510.46it/s] 23%|████████████                                        | 2268/9741 [00:05<00:14, 509.37it/s] 24%|████████████▍                                       | 2320/9741 [00:05<00:14, 510.55it/s] 24%|████████████▋                                       | 2372/9741 [00:05<00:14, 511.87it/s] 25%|████████████▉                                       | 2424/9741 [00:05<00:14, 512.57it/s] 25%|█████████████▏                                      | 2476/9741 [00:05<00:14, 507.50it/s] 26%|█████████████▍                                      | 2528/9741 [00:05<00:14, 508.53it/s] 26%|█████████████▊                                      | 2580/9741 [00:05<00:14, 509.49it/s] 27%|██████████████                                      | 2632/9741 [00:06<00:13, 510.82it/s] 28%|██████████████▎                                     | 2684/9741 [00:06<00:13, 510.16it/s] 28%|██████████████▌                                     | 2736/9741 [00:06<00:13, 508.10it/s] 29%|██████████████▉                                     | 2788/9741 [00:06<00:13, 509.49it/s] 29%|███████████████▏                                    | 2840/9741 [00:06<00:13, 510.99it/s] 30%|███████████████▍                                    | 2892/9741 [00:06<00:13, 511.52it/s] 30%|███████████████▋                                    | 2944/9741 [00:06<00:13, 509.64it/s] 31%|███████████████▉                                    | 2996/9741 [00:06<00:13, 510.88it/s] 31%|████████████████▎                                   | 3048/9741 [00:06<00:13, 511.62it/s] 32%|████████████████▌                                   | 3100/9741 [00:06<00:12, 511.20it/s] 32%|████████████████▊                                   | 3152/9741 [00:07<00:13, 504.45it/s] 33%|█████████████████                                   | 3204/9741 [00:07<00:12, 506.87it/s] 33%|█████████████████▍                                  | 3256/9741 [00:07<00:12, 509.21it/s] 34%|█████████████████▋                                  | 3308/9741 [00:07<00:12, 509.64it/s] 34%|█████████████████▉                                  | 3360/9741 [00:07<00:12, 510.71it/s] 35%|██████████████████▏                                 | 3412/9741 [00:07<00:12, 508.92it/s] 36%|██████████████████▍                                 | 3463/9741 [00:07<00:12, 506.88it/s] 36%|██████████████████▊                                 | 3515/9741 [00:07<00:12, 508.10it/s] 37%|███████████████████                                 | 3567/9741 [00:07<00:12, 509.54it/s] 37%|███████████████████▎                                | 3618/9741 [00:07<00:12, 507.83it/s] 38%|███████████████████▌                                | 3670/9741 [00:08<00:11, 509.13it/s] 38%|███████████████████▊                                | 3722/9741 [00:08<00:11, 509.59it/s] 39%|████████████████████▏                               | 3773/9741 [00:08<00:11, 508.97it/s] 39%|████████████████████▍                               | 3824/9741 [00:08<00:11, 505.06it/s] 40%|████████████████████▋                               | 3875/9741 [00:08<00:11, 500.76it/s] 40%|████████████████████▉                               | 3926/9741 [00:08<00:12, 483.26it/s] 41%|█████████████████████▏                              | 3975/9741 [00:08<00:13, 437.09it/s] 41%|█████████████████████▍                              | 4027/9741 [00:08<00:12, 457.90it/s] 42%|█████████████████████▊                              | 4078/9741 [00:08<00:12, 471.01it/s] 42%|██████████████████████                              | 4130/9741 [00:09<00:11, 482.56it/s] 43%|██████████████████████▎                             | 4179/9741 [00:09<00:11, 477.72it/s] 43%|██████████████████████▌                             | 4229/9741 [00:09<00:11, 482.01it/s] 44%|██████████████████████▊                             | 4281/9741 [00:09<00:11, 491.59it/s] 44%|███████████████████████▏                            | 4332/9741 [00:09<00:10, 495.67it/s] 45%|███████████████████████▍                            | 4382/9741 [00:09<00:10, 494.85it/s] 45%|███████████████████████▋                            | 4432/9741 [00:09<00:10, 495.55it/s] 46%|███████████████████████▉                            | 4484/9741 [00:09<00:10, 500.90it/s] 47%|████████████████████████▏                           | 4535/9741 [00:09<00:11, 448.59it/s] 47%|████████████████████████▍                           | 4587/9741 [00:09<00:11, 466.82it/s] 48%|████████████████████████▊                           | 4639/9741 [00:10<00:10, 480.38it/s] 48%|█████████████████████████                           | 4691/9741 [00:10<00:10, 489.74it/s] 49%|█████████████████████████▎                          | 4741/9741 [00:10<00:14, 351.16it/s] 49%|█████████████████████████▌                          | 4793/9741 [00:10<00:12, 388.71it/s] 50%|█████████████████████████▊                          | 4845/9741 [00:10<00:11, 419.47it/s] 50%|██████████████████████████▏                         | 4897/9741 [00:10<00:10, 443.71it/s] 51%|██████████████████████████▍                         | 4948/9741 [00:10<00:10, 460.52it/s] 51%|██████████████████████████▋                         | 5000/9741 [00:10<00:09, 475.49it/s] 52%|██████████████████████████▉                         | 5052/9741 [00:11<00:09, 485.87it/s] 52%|███████████████████████████▏                        | 5102/9741 [00:11<00:10, 450.71it/s] 53%|███████████████████████████▍                        | 5149/9741 [00:11<00:10, 429.92it/s] 53%|███████████████████████████▋                        | 5194/9741 [00:11<00:10, 419.65it/s] 54%|███████████████████████████▉                        | 5237/9741 [00:11<00:11, 376.04it/s] 54%|████████████████████████████▏                       | 5276/9741 [00:11<00:12, 365.61it/s] 55%|████████████████████████████▎                       | 5314/9741 [00:11<00:12, 358.96it/s] 55%|████████████████████████████▌                       | 5351/9741 [00:11<00:12, 353.53it/s] 55%|████████████████████████████▊                       | 5387/9741 [00:11<00:12, 349.62it/s] 56%|████████████████████████████▉                       | 5423/9741 [00:12<00:12, 345.24it/s] 56%|█████████████████████████████▏                      | 5458/9741 [00:12<00:12, 344.15it/s] 56%|█████████████████████████████▎                      | 5493/9741 [00:12<00:12, 342.01it/s] 57%|█████████████████████████████▌                      | 5529/9741 [00:12<00:12, 344.39it/s] 57%|█████████████████████████████▋                      | 5565/9741 [00:12<00:12, 346.21it/s] 57%|█████████████████████████████▉                      | 5600/9741 [00:12<00:11, 346.90it/s] 58%|██████████████████████████████                      | 5635/9741 [00:12<00:11, 345.82it/s] 58%|██████████████████████████████▎                     | 5670/9741 [00:12<00:11, 347.04it/s] 59%|██████████████████████████████▍                     | 5706/9741 [00:12<00:11, 347.98it/s] 59%|██████████████████████████████▋                     | 5742/9741 [00:12<00:11, 348.81it/s] 59%|██████████████████████████████▊                     | 5777/9741 [00:13<00:11, 349.02it/s] 60%|███████████████████████████████                     | 5812/9741 [00:13<00:11, 349.28it/s] 60%|███████████████████████████████▏                    | 5847/9741 [00:13<00:11, 348.94it/s] 60%|███████████████████████████████▍                    | 5882/9741 [00:13<00:11, 347.64it/s] 61%|███████████████████████████████▌                    | 5918/9741 [00:13<00:10, 348.49it/s] 61%|███████████████████████████████▊                    | 5957/9741 [00:13<00:10, 360.47it/s] 62%|████████████████████████████████                    | 6011/9741 [00:13<00:09, 412.00it/s] 62%|████████████████████████████████▍                   | 6065/9741 [00:13<00:08, 447.98it/s] 63%|████████████████████████████████▋                   | 6118/9741 [00:13<00:07, 469.78it/s] 63%|████████████████████████████████▉                   | 6171/9741 [00:14<00:07, 485.09it/s] 64%|█████████████████████████████████▏                  | 6224/9741 [00:14<00:07, 498.24it/s] 64%|█████████████████████████████████▌                  | 6277/9741 [00:14<00:06, 506.25it/s] 65%|█████████████████████████████████▊                  | 6330/9741 [00:14<00:06, 510.56it/s] 66%|██████████████████████████████████                  | 6383/9741 [00:14<00:06, 516.26it/s] 66%|██████████████████████████████████▎                 | 6436/9741 [00:14<00:06, 519.89it/s] 67%|██████████████████████████████████▋                 | 6489/9741 [00:14<00:06, 522.19it/s] 67%|██████████████████████████████████▉                 | 6542/9741 [00:14<00:06, 521.28it/s] 68%|███████████████████████████████████▏                | 6595/9741 [00:14<00:06, 523.09it/s] 68%|███████████████████████████████████▍                | 6648/9741 [00:14<00:05, 524.64it/s] 69%|███████████████████████████████████▊                | 6701/9741 [00:15<00:05, 525.29it/s] 69%|████████████████████████████████████                | 6755/9741 [00:15<00:05, 526.69it/s] 70%|████████████████████████████████████▎               | 6808/9741 [00:15<00:05, 524.62it/s] 70%|████████████████████████████████████▋               | 6861/9741 [00:15<00:05, 525.50it/s] 71%|████████████████████████████████████▉               | 6915/9741 [00:15<00:05, 526.92it/s] 72%|█████████████████████████████████████▏              | 6969/9741 [00:15<00:05, 527.78it/s] 72%|█████████████████████████████████████▍              | 7022/9741 [00:15<00:05, 524.32it/s] 73%|█████████████████████████████████████▊              | 7075/9741 [00:15<00:05, 525.94it/s] 73%|██████████████████████████████████████              | 7128/9741 [00:15<00:04, 526.82it/s] 74%|██████████████████████████████████████▎             | 7181/9741 [00:15<00:04, 526.80it/s] 74%|██████████████████████████████████████▌             | 7234/9741 [00:16<00:04, 525.02it/s] 75%|██████████████████████████████████████▉             | 7287/9741 [00:16<00:04, 525.64it/s] 75%|███████████████████████████████████████▏            | 7340/9741 [00:16<00:04, 524.83it/s] 76%|███████████████████████████████████████▍            | 7393/9741 [00:16<00:04, 526.16it/s] 76%|███████████████████████████████████████▋            | 7446/9741 [00:16<00:04, 497.48it/s] 77%|████████████████████████████████████████            | 7499/9741 [00:16<00:04, 505.68it/s] 78%|████████████████████████████████████████▎           | 7552/9741 [00:16<00:04, 510.35it/s] 78%|████████████████████████████████████████▌           | 7605/9741 [00:16<00:04, 514.50it/s] 79%|████████████████████████████████████████▉           | 7658/9741 [00:16<00:04, 517.14it/s] 79%|█████████████████████████████████████████▏          | 7710/9741 [00:16<00:03, 516.78it/s] 80%|█████████████████████████████████████████▍          | 7763/9741 [00:17<00:03, 518.49it/s] 80%|█████████████████████████████████████████▋          | 7816/9741 [00:17<00:03, 519.69it/s] 81%|██████████████████████████████████████████          | 7869/9741 [00:17<00:03, 521.62it/s] 81%|██████████████████████████████████████████▎         | 7922/9741 [00:17<00:03, 519.20it/s] 82%|██████████████████████████████████████████▌         | 7975/9741 [00:17<00:03, 520.05it/s] 82%|██████████████████████████████████████████▊         | 8028/9741 [00:17<00:03, 521.07it/s] 83%|███████████████████████████████████████████▏        | 8081/9741 [00:17<00:03, 521.28it/s] 84%|███████████████████████████████████████████▍        | 8134/9741 [00:17<00:03, 520.09it/s] 84%|███████████████████████████████████████████▋        | 8187/9741 [00:17<00:02, 520.98it/s] 85%|███████████████████████████████████████████▉        | 8240/9741 [00:17<00:02, 522.26it/s] 85%|████████████████████████████████████████████▎       | 8293/9741 [00:18<00:02, 522.70it/s] 86%|████████████████████████████████████████████▌       | 8346/9741 [00:18<00:02, 521.72it/s] 86%|████████████████████████████████████████████▊       | 8399/9741 [00:18<00:02, 518.82it/s] 87%|█████████████████████████████████████████████       | 8452/9741 [00:18<00:02, 520.32it/s] 87%|█████████████████████████████████████████████▍      | 8505/9741 [00:18<00:02, 521.49it/s] 88%|█████████████████████████████████████████████▋      | 8558/9741 [00:18<00:02, 521.30it/s] 88%|█████████████████████████████████████████████▉      | 8611/9741 [00:18<00:02, 518.75it/s] 89%|██████████████████████████████████████████████▎     | 8664/9741 [00:18<00:02, 519.90it/s] 89%|██████████████████████████████████████████████▌     | 8717/9741 [00:18<00:01, 521.12it/s] 90%|██████████████████████████████████████████████▊     | 8770/9741 [00:18<00:01, 521.40it/s] 91%|███████████████████████████████████████████████     | 8823/9741 [00:19<00:01, 515.70it/s] 91%|███████████████████████████████████████████████▍    | 8876/9741 [00:19<00:01, 518.02it/s] 92%|███████████████████████████████████████████████▋    | 8929/9741 [00:19<00:01, 519.76it/s] 92%|███████████████████████████████████████████████▉    | 8982/9741 [00:19<00:01, 520.70it/s] 93%|████████████████████████████████████████████████▏   | 9035/9741 [00:19<00:01, 518.38it/s] 93%|████████████████████████████████████████████████▌   | 9088/9741 [00:19<00:01, 519.02it/s] 94%|████████████████████████████████████████████████▊   | 9141/9741 [00:19<00:01, 520.41it/s] 94%|█████████████████████████████████████████████████   | 9194/9741 [00:19<00:01, 520.54it/s] 95%|█████████████████████████████████████████████████▎  | 9247/9741 [00:19<00:00, 520.86it/s] 95%|█████████████████████████████████████████████████▋  | 9300/9741 [00:20<00:00, 518.41it/s] 96%|█████████████████████████████████████████████████▉  | 9353/9741 [00:20<00:00, 518.91it/s] 97%|██████████████████████████████████████████████████▏ | 9405/9741 [00:20<00:00, 518.89it/s] 97%|██████████████████████████████████████████████████▍ | 9458/9741 [00:20<00:00, 519.59it/s] 98%|██████████████████████████████████████████████████▊ | 9510/9741 [00:20<00:00, 517.50it/s] 98%|███████████████████████████████████████████████████ | 9563/9741 [00:20<00:00, 518.97it/s] 99%|███████████████████████████████████████████████████▎| 9615/9741 [00:20<00:00, 518.94it/s] 99%|███████████████████████████████████████████████████▌| 9668/9741 [00:20<00:00, 519.54it/s]100%|███████████████████████████████████████████████████▉| 9720/9741 [00:20<00:00, 517.73it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:20<00:00, 466.87it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.32s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.48s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.51s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.78s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.23s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.54s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.57s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.94s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.96s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.11s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.98s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.14s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.56s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.65s/it]
[2023-08-21 20:38:17,658] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 20:38:32,599] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 20:38:32,600] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 20:38:32,600] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 20:38:32,600] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 20:38:32,600] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 20:38:32,600] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f1005f2afd0>
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 20:38:32,601] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f1005874220>
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 20:38:32,602] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 20:38:32,602] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5602025985717773 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input: Noah, who loves his Grammy, calls her every week to talk about his day. If each call lasts 30 minutes and he is charged $0.05 per call minute, how much would he be billed if he makes the calls for a year?
Output: 78

Input: A merchant bought 15 keyboards and 25 printers for a total of $2050. If a keyboard costs $20, how much does a printer cost?
Output: 70

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o15-tgsm8k-s10-rFalse
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.6053106784820557 seconds
Time to load utils op: 0.6050741672515869 seconds
Loading extension module utils...
Time to load utils op: 0.6050117015838623 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:40<32:45, 40.11s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:21<32:48, 41.00s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:03<32:21, 41.30s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:44<31:34, 41.18s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:20<29:36, 39.47s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:01<29:12, 39.82s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:31<26:17, 36.69s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:12<26:38, 38.06s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:53<26:38, 38.98s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:34<26:26, 39.67s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:16<26:12, 40.31s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:57<25:43, 40.61s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:21<21:47, 35.33s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:02<22:13, 37.04s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:43<22:20, 38.30s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:17<21:00, 37.08s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:58<21:04, 38.32s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:39<20:53, 39.18s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:20<20:31, 39.74s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:01<20:02, 40.07s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:42<19:30, 40.35s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:23<18:55, 40.56s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:05<18:22, 40.84s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:46<17:48, 41.10s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:28<17:12, 41.31s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:09<16:27, 41.13s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:45<15:13, 39.72s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:27<14:45, 40.24s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:09<14:16, 40.79s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:50<13:37, 40.86s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:31<12:56, 40.88s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [21:13<12:20, 41.14s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:54<11:39, 41.12s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [22:35<10:56, 41.06s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [23:16<10:17, 41.14s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [23:58<09:37, 41.28s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [24:39<08:58, 41.42s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [25:21<08:19, 41.62s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [26:03<07:36, 41.52s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [26:44<06:54, 41.44s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [27:26<06:13, 41.51s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [28:06<05:30, 41.29s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [28:48<04:49, 41.34s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [29:29<04:08, 41.39s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [30:07<03:21, 40.28s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [30:39<02:31, 37.75s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [31:21<01:56, 38.99s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [32:02<01:19, 39.71s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [32:29<00:35, 35.87s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:10<00:00, 37.45s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:10<00:00, 39.81s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.6905} | avg. gen lenth: 292.98
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o16-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 16
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 21:12:00,820] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o16-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 16
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o16-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 32/9741 [00:00<00:30, 317.93it/s]  1%|▎                                                     | 65/9741 [00:00<00:30, 319.50it/s]  1%|▌                                                     | 98/9741 [00:00<00:30, 320.57it/s]  1%|▋                                                    | 131/9741 [00:00<00:29, 320.59it/s]  2%|▉                                                    | 164/9741 [00:00<00:29, 320.60it/s]  2%|█                                                    | 197/9741 [00:00<00:29, 320.33it/s]  2%|█▎                                                   | 230/9741 [00:00<00:29, 318.58it/s]  3%|█▍                                                   | 262/9741 [00:00<00:30, 313.74it/s]  3%|█▌                                                   | 294/9741 [00:00<00:29, 315.40it/s]  3%|█▊                                                   | 327/9741 [00:01<00:29, 316.94it/s]  4%|█▉                                                   | 359/9741 [00:01<00:29, 317.63it/s]  4%|██▏                                                  | 392/9741 [00:01<00:29, 318.68it/s]  4%|██▎                                                  | 425/9741 [00:01<00:29, 319.12it/s]  5%|██▍                                                  | 457/9741 [00:01<00:29, 317.31it/s]  5%|██▋                                                  | 489/9741 [00:01<00:29, 318.07it/s]  5%|██▊                                                  | 522/9741 [00:01<00:28, 318.89it/s]  6%|███                                                  | 554/9741 [00:01<00:28, 319.17it/s]  6%|███▏                                                 | 586/9741 [00:01<00:28, 317.38it/s]  6%|███▎                                                 | 618/9741 [00:01<00:28, 317.89it/s]  7%|███▌                                                 | 651/9741 [00:02<00:28, 318.75it/s]  7%|███▊                                                 | 695/9741 [00:02<00:25, 353.87it/s]  8%|████                                                 | 744/9741 [00:02<00:22, 393.34it/s]  8%|████▎                                                | 793/9741 [00:02<00:21, 421.26it/s]  9%|████▌                                                | 842/9741 [00:02<00:20, 440.89it/s]  9%|████▊                                                | 890/9741 [00:02<00:19, 451.97it/s] 10%|█████                                                | 939/9741 [00:02<00:19, 460.98it/s] 10%|█████▍                                               | 988/9741 [00:02<00:18, 468.68it/s] 11%|█████▌                                              | 1037/9741 [00:02<00:18, 473.95it/s] 11%|█████▊                                              | 1086/9741 [00:02<00:18, 477.84it/s] 12%|██████                                              | 1134/9741 [00:03<00:18, 478.00it/s] 12%|██████▎                                             | 1182/9741 [00:03<00:17, 477.22it/s] 13%|██████▌                                             | 1231/9741 [00:03<00:17, 479.05it/s] 13%|██████▊                                             | 1280/9741 [00:03<00:17, 480.94it/s] 14%|███████                                             | 1329/9741 [00:03<00:17, 482.25it/s] 14%|███████▎                                            | 1378/9741 [00:03<00:17, 480.50it/s] 15%|███████▌                                            | 1427/9741 [00:03<00:17, 481.75it/s] 15%|███████▉                                            | 1476/9741 [00:03<00:17, 482.80it/s] 16%|████████▏                                           | 1525/9741 [00:03<00:17, 482.98it/s] 16%|████████▍                                           | 1574/9741 [00:03<00:16, 481.08it/s] 17%|████████▋                                           | 1623/9741 [00:04<00:16, 481.91it/s] 17%|████████▉                                           | 1672/9741 [00:04<00:16, 483.35it/s] 18%|█████████▏                                          | 1721/9741 [00:04<00:16, 484.33it/s] 18%|█████████▍                                          | 1770/9741 [00:04<00:16, 484.97it/s] 19%|█████████▋                                          | 1819/9741 [00:04<00:17, 444.81it/s] 19%|█████████▉                                          | 1868/9741 [00:04<00:17, 456.07it/s] 20%|██████████▏                                         | 1917/9741 [00:04<00:16, 464.56it/s] 20%|██████████▍                                         | 1966/9741 [00:04<00:16, 470.36it/s] 21%|██████████▊                                         | 2015/9741 [00:04<00:16, 475.23it/s] 21%|███████████                                         | 2063/9741 [00:05<00:16, 475.80it/s] 22%|███████████▎                                        | 2112/9741 [00:05<00:15, 478.10it/s] 22%|███████████▌                                        | 2161/9741 [00:05<00:15, 480.36it/s] 23%|███████████▊                                        | 2210/9741 [00:05<00:15, 482.27it/s] 23%|████████████                                        | 2259/9741 [00:05<00:15, 480.81it/s] 24%|████████████▎                                       | 2308/9741 [00:05<00:15, 482.31it/s] 24%|████████████▌                                       | 2357/9741 [00:05<00:15, 483.20it/s] 25%|████████████▊                                       | 2406/9741 [00:05<00:15, 482.22it/s] 25%|█████████████                                       | 2455/9741 [00:05<00:15, 483.07it/s] 26%|█████████████▎                                      | 2504/9741 [00:05<00:15, 481.20it/s] 26%|█████████████▋                                      | 2553/9741 [00:06<00:14, 481.95it/s] 27%|█████████████▉                                      | 2602/9741 [00:06<00:14, 483.46it/s] 27%|██████████████▏                                     | 2651/9741 [00:06<00:14, 483.89it/s] 28%|██████████████▍                                     | 2700/9741 [00:06<00:14, 481.60it/s] 28%|██████████████▋                                     | 2749/9741 [00:06<00:14, 482.43it/s] 29%|██████████████▉                                     | 2798/9741 [00:06<00:14, 482.84it/s] 29%|███████████████▏                                    | 2847/9741 [00:06<00:14, 483.34it/s] 30%|███████████████▍                                    | 2896/9741 [00:06<00:14, 484.37it/s] 30%|███████████████▋                                    | 2945/9741 [00:06<00:14, 482.23it/s] 31%|███████████████▉                                    | 2994/9741 [00:06<00:13, 483.12it/s] 31%|████████████████▏                                   | 3043/9741 [00:07<00:13, 483.99it/s] 32%|████████████████▌                                   | 3092/9741 [00:07<00:13, 484.07it/s] 32%|████████████████▊                                   | 3141/9741 [00:07<00:13, 484.41it/s] 33%|█████████████████                                   | 3190/9741 [00:07<00:13, 482.77it/s] 33%|█████████████████▎                                  | 3239/9741 [00:07<00:13, 481.90it/s] 34%|█████████████████▌                                  | 3288/9741 [00:07<00:13, 482.77it/s] 34%|█████████████████▊                                  | 3337/9741 [00:07<00:13, 483.34it/s] 35%|██████████████████                                  | 3386/9741 [00:07<00:13, 481.24it/s] 35%|██████████████████▎                                 | 3435/9741 [00:07<00:13, 482.34it/s] 36%|██████████████████▌                                 | 3484/9741 [00:07<00:12, 482.92it/s] 36%|██████████████████▊                                 | 3533/9741 [00:08<00:12, 482.77it/s] 37%|███████████████████                                 | 3582/9741 [00:08<00:12, 480.08it/s] 37%|███████████████████▍                                | 3631/9741 [00:08<00:12, 479.19it/s] 38%|███████████████████▋                                | 3680/9741 [00:08<00:12, 480.37it/s] 38%|███████████████████▉                                | 3729/9741 [00:08<00:12, 482.21it/s] 39%|████████████████████▏                               | 3778/9741 [00:08<00:12, 483.20it/s] 39%|████████████████████▍                               | 3827/9741 [00:08<00:12, 483.50it/s] 40%|████████████████████▋                               | 3876/9741 [00:08<00:12, 481.76it/s] 40%|████████████████████▉                               | 3925/9741 [00:08<00:12, 482.75it/s] 41%|█████████████████████▏                              | 3974/9741 [00:08<00:11, 483.27it/s] 41%|█████████████████████▍                              | 4023/9741 [00:09<00:11, 483.75it/s] 42%|█████████████████████▋                              | 4072/9741 [00:09<00:11, 479.71it/s] 42%|█████████████████████▉                              | 4121/9741 [00:09<00:11, 480.29it/s] 43%|██████████████████████▎                             | 4170/9741 [00:09<00:11, 481.03it/s] 43%|██████████████████████▌                             | 4219/9741 [00:09<00:11, 481.42it/s] 44%|██████████████████████▊                             | 4268/9741 [00:09<00:11, 482.56it/s] 44%|███████████████████████                             | 4317/9741 [00:09<00:11, 480.52it/s] 45%|███████████████████████▎                            | 4366/9741 [00:09<00:11, 474.79it/s] 45%|███████████████████████▌                            | 4414/9741 [00:09<00:11, 476.03it/s] 46%|███████████████████████▊                            | 4463/9741 [00:09<00:11, 477.85it/s] 46%|████████████████████████                            | 4512/9741 [00:10<00:11, 449.72it/s] 47%|████████████████████████▎                           | 4560/9741 [00:10<00:11, 458.26it/s] 47%|████████████████████████▌                           | 4609/9741 [00:10<00:11, 465.63it/s] 48%|████████████████████████▊                           | 4658/9741 [00:10<00:10, 471.53it/s] 48%|█████████████████████████▏                          | 4707/9741 [00:10<00:10, 474.51it/s] 49%|█████████████████████████▍                          | 4755/9741 [00:10<00:14, 353.81it/s] 49%|█████████████████████████▋                          | 4804/9741 [00:10<00:12, 384.80it/s] 50%|█████████████████████████▉                          | 4853/9741 [00:10<00:11, 409.96it/s] 50%|██████████████████████████▏                         | 4902/9741 [00:11<00:11, 428.87it/s] 51%|██████████████████████████▍                         | 4950/9741 [00:11<00:10, 441.41it/s] 51%|██████████████████████████▋                         | 4999/9741 [00:11<00:10, 452.96it/s] 52%|██████████████████████████▉                         | 5048/9741 [00:11<00:10, 461.61it/s] 52%|███████████████████████████▏                        | 5097/9741 [00:11<00:09, 467.83it/s] 53%|███████████████████████████▍                        | 5146/9741 [00:11<00:09, 472.21it/s] 53%|███████████████████████████▋                        | 5194/9741 [00:11<00:09, 473.03it/s] 54%|███████████████████████████▉                        | 5242/9741 [00:11<00:09, 474.34it/s] 54%|████████████████████████████▏                       | 5291/9741 [00:11<00:09, 476.78it/s] 55%|████████████████████████████▌                       | 5340/9741 [00:11<00:09, 478.05it/s] 55%|████████████████████████████▊                       | 5389/9741 [00:12<00:09, 479.35it/s] 56%|█████████████████████████████                       | 5438/9741 [00:12<00:08, 478.44it/s] 56%|█████████████████████████████▎                      | 5487/9741 [00:12<00:08, 481.19it/s] 57%|█████████████████████████████▌                      | 5538/9741 [00:12<00:08, 486.86it/s] 57%|█████████████████████████████▊                      | 5588/9741 [00:12<00:08, 490.62it/s] 58%|██████████████████████████████                      | 5638/9741 [00:12<00:08, 485.54it/s] 58%|██████████████████████████████▎                     | 5688/9741 [00:12<00:08, 489.41it/s] 59%|██████████████████████████████▋                     | 5739/9741 [00:12<00:08, 492.73it/s] 59%|██████████████████████████████▉                     | 5789/9741 [00:12<00:07, 494.19it/s] 60%|███████████████████████████████▏                    | 5839/9741 [00:12<00:07, 494.54it/s] 60%|███████████████████████████████▍                    | 5889/9741 [00:13<00:07, 493.26it/s] 61%|███████████████████████████████▋                    | 5939/9741 [00:13<00:07, 494.83it/s] 61%|███████████████████████████████▉                    | 5989/9741 [00:13<00:07, 496.34it/s] 62%|████████████████████████████████▏                   | 6039/9741 [00:13<00:07, 496.22it/s] 63%|████████████████████████████████▌                   | 6089/9741 [00:13<00:07, 494.40it/s] 63%|████████████████████████████████▊                   | 6139/9741 [00:13<00:07, 494.92it/s] 64%|█████████████████████████████████                   | 6189/9741 [00:13<00:07, 495.72it/s] 64%|█████████████████████████████████▎                  | 6239/9741 [00:13<00:07, 496.04it/s] 65%|█████████████████████████████████▌                  | 6289/9741 [00:13<00:06, 496.83it/s] 65%|█████████████████████████████████▊                  | 6339/9741 [00:13<00:06, 494.83it/s] 66%|██████████████████████████████████                  | 6389/9741 [00:14<00:06, 495.58it/s] 66%|██████████████████████████████████▎                 | 6439/9741 [00:14<00:06, 496.66it/s] 67%|██████████████████████████████████▋                 | 6489/9741 [00:14<00:06, 492.02it/s] 67%|██████████████████████████████████▉                 | 6539/9741 [00:14<00:06, 490.63it/s] 68%|███████████████████████████████████▏                | 6589/9741 [00:14<00:06, 492.28it/s] 68%|███████████████████████████████████▍                | 6639/9741 [00:14<00:06, 493.55it/s] 69%|███████████████████████████████████▋                | 6689/9741 [00:14<00:06, 494.56it/s] 69%|███████████████████████████████████▉                | 6739/9741 [00:14<00:06, 495.43it/s] 70%|████████████████████████████████████▏               | 6789/9741 [00:14<00:05, 493.94it/s] 70%|████████████████████████████████████▌               | 6839/9741 [00:14<00:05, 495.33it/s] 71%|████████████████████████████████████▊               | 6889/9741 [00:15<00:05, 495.89it/s] 71%|█████████████████████████████████████               | 6939/9741 [00:15<00:05, 496.08it/s] 72%|█████████████████████████████████████▎              | 6989/9741 [00:15<00:05, 493.87it/s] 72%|█████████████████████████████████████▌              | 7039/9741 [00:15<00:05, 494.62it/s] 73%|█████████████████████████████████████▊              | 7089/9741 [00:15<00:05, 495.71it/s] 73%|██████████████████████████████████████              | 7139/9741 [00:15<00:05, 496.14it/s] 74%|██████████████████████████████████████▍             | 7189/9741 [00:15<00:05, 495.98it/s] 74%|██████████████████████████████████████▋             | 7239/9741 [00:15<00:05, 493.51it/s] 75%|██████████████████████████████████████▉             | 7289/9741 [00:15<00:05, 489.34it/s] 75%|███████████████████████████████████████▏            | 7339/9741 [00:15<00:04, 490.86it/s] 76%|███████████████████████████████████████▍            | 7389/9741 [00:16<00:04, 492.79it/s] 76%|███████████████████████████████████████▋            | 7439/9741 [00:16<00:04, 493.93it/s] 77%|███████████████████████████████████████▉            | 7489/9741 [00:16<00:05, 440.87it/s] 77%|████████████████████████████████████████▏           | 7539/9741 [00:16<00:04, 455.72it/s] 78%|████████████████████████████████████████▌           | 7589/9741 [00:16<00:04, 466.95it/s] 78%|████████████████████████████████████████▊           | 7639/9741 [00:16<00:04, 475.09it/s] 79%|█████████████████████████████████████████           | 7688/9741 [00:16<00:04, 478.06it/s] 79%|█████████████████████████████████████████▎          | 7738/9741 [00:16<00:04, 483.88it/s] 80%|█████████████████████████████████████████▌          | 7788/9741 [00:16<00:04, 487.11it/s] 80%|█████████████████████████████████████████▊          | 7838/9741 [00:17<00:03, 489.54it/s] 81%|██████████████████████████████████████████          | 7888/9741 [00:17<00:03, 491.39it/s] 81%|██████████████████████████████████████████▍         | 7938/9741 [00:17<00:03, 490.67it/s] 82%|██████████████████████████████████████████▋         | 7988/9741 [00:17<00:03, 491.73it/s] 83%|██████████████████████████████████████████▉         | 8038/9741 [00:17<00:03, 493.17it/s] 83%|███████████████████████████████████████████▏        | 8088/9741 [00:17<00:03, 494.05it/s] 84%|███████████████████████████████████████████▍        | 8138/9741 [00:17<00:03, 486.96it/s] 84%|███████████████████████████████████████████▋        | 8188/9741 [00:17<00:03, 489.20it/s] 85%|███████████████████████████████████████████▉        | 8238/9741 [00:17<00:03, 491.41it/s] 85%|████████████████████████████████████████████▏       | 8288/9741 [00:17<00:02, 492.17it/s] 86%|████████████████████████████████████████████▌       | 8338/9741 [00:18<00:02, 492.62it/s] 86%|████████████████████████████████████████████▊       | 8388/9741 [00:18<00:02, 491.36it/s] 87%|█████████████████████████████████████████████       | 8438/9741 [00:18<00:02, 492.77it/s] 87%|█████████████████████████████████████████████▎      | 8488/9741 [00:18<00:02, 493.07it/s] 88%|█████████████████████████████████████████████▌      | 8538/9741 [00:18<00:02, 493.57it/s] 88%|█████████████████████████████████████████████▊      | 8588/9741 [00:18<00:02, 491.22it/s] 89%|██████████████████████████████████████████████      | 8638/9741 [00:18<00:02, 492.07it/s] 89%|██████████████████████████████████████████████▍     | 8688/9741 [00:18<00:02, 493.03it/s] 90%|██████████████████████████████████████████████▋     | 8738/9741 [00:18<00:02, 493.41it/s] 90%|██████████████████████████████████████████████▉     | 8788/9741 [00:18<00:01, 492.66it/s] 91%|███████████████████████████████████████████████▏    | 8838/9741 [00:19<00:01, 490.93it/s] 91%|███████████████████████████████████████████████▍    | 8888/9741 [00:19<00:01, 492.38it/s] 92%|███████████████████████████████████████████████▋    | 8938/9741 [00:19<00:01, 493.37it/s] 92%|███████████████████████████████████████████████▉    | 8988/9741 [00:19<00:01, 493.72it/s] 93%|████████████████████████████████████████████████▏   | 9038/9741 [00:19<00:01, 491.68it/s] 93%|████████████████████████████████████████████████▌   | 9088/9741 [00:19<00:01, 492.69it/s] 94%|████████████████████████████████████████████████▊   | 9138/9741 [00:19<00:01, 493.09it/s] 94%|█████████████████████████████████████████████████   | 9188/9741 [00:19<00:01, 491.55it/s] 95%|█████████████████████████████████████████████████▎  | 9238/9741 [00:19<00:01, 492.14it/s] 95%|█████████████████████████████████████████████████▌  | 9288/9741 [00:19<00:00, 490.45it/s] 96%|█████████████████████████████████████████████████▊  | 9338/9741 [00:20<00:00, 492.07it/s] 96%|██████████████████████████████████████████████████  | 9388/9741 [00:20<00:00, 493.21it/s] 97%|██████████████████████████████████████████████████▍ | 9438/9741 [00:20<00:00, 493.29it/s] 97%|██████████████████████████████████████████████████▋ | 9488/9741 [00:20<00:00, 491.56it/s] 98%|██████████████████████████████████████████████████▉ | 9538/9741 [00:20<00:00, 492.85it/s] 98%|███████████████████████████████████████████████████▏| 9588/9741 [00:20<00:00, 492.73it/s] 99%|███████████████████████████████████████████████████▍| 9638/9741 [00:20<00:00, 493.40it/s] 99%|███████████████████████████████████████████████████▋| 9688/9741 [00:20<00:00, 493.73it/s]100%|███████████████████████████████████████████████████▉| 9738/9741 [00:20<00:00, 491.85it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:20<00:00, 465.76it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.15s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.28s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.43s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.26s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.19s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.31s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.40s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.58s/it]
[2023-08-21 21:13:12,979] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.60s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.85s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.64s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
[2023-08-21 21:13:24,082] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 21:13:24,083] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 21:13:24,083] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fce2f8b1fd0>
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 21:13:24,084] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fce2f205220>
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 21:13:24,085] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 21:13:24,086] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 21:13:24,086] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5663809776306152 seconds
Loading extension module utils...
Time to load utils op: 0.6049003601074219 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input: Noah, who loves his Grammy, calls her every week to talk about his day. If each call lasts 30 minutes and he is charged $0.05 per call minute, how much would he be billed if he makes the calls for a year?
Output: 78

Input: A merchant bought 15 keyboards and 25 printers for a total of $2050. If a keyboard costs $20, how much does a printer cost?
Output: 70

Input: Gina has two bank accounts. Each account has a quarter of the balance in Betty's account. If Betty's account balance is $3,456, what is the combined balance of both Gina's accounts?
Output: 1728

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o16-tgsm8k-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.605074405670166 seconds
Loading extension module utils...
Time to load utils op: 0.5046238899230957 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:42<34:21, 42.08s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:12<28:05, 35.11s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:43<25:56, 33.12s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:24<27:46, 36.23s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:04<28:16, 37.70s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:44<28:17, 38.59s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:24<28:01, 39.11s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:05<27:44, 39.63s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:46<27:19, 39.99s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:27<26:50, 40.26s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:07<26:15, 40.40s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:49<25:43, 40.62s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:29<25:04, 40.65s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:10<24:24, 40.67s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:51<23:44, 40.70s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:31<23:03, 40.68s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:13<22:32, 40.98s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:54<21:49, 40.91s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:35<21:06, 40.84s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:15<20:25, 40.84s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:57<19:49, 41.01s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:28<17:45, 38.06s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:09<17:32, 38.98s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:50<17:05, 39.45s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:21<15:23, 36.95s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:02<15:16, 38.18s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:42<14:54, 38.88s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:23<14:26, 39.38s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:04<13:56, 39.85s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:45<13:23, 40.20s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:26<12:47, 40.40s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [21:06<12:08, 40.47s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:47<11:27, 40.46s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [22:28<10:48, 40.56s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [23:08<10:05, 40.38s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [23:48<09:26, 40.47s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [24:29<08:47, 40.55s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [25:09<08:04, 40.37s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [25:50<07:25, 40.48s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [26:31<06:46, 40.67s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [27:12<06:07, 40.83s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [27:53<05:27, 40.90s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [28:33<04:45, 40.75s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [29:14<04:04, 40.74s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [29:55<03:24, 40.88s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [30:36<02:42, 40.75s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [31:17<02:02, 40.75s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [31:48<01:15, 38.00s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [32:29<00:38, 38.93s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [32:46<00:00, 32.37s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [32:46<00:00, 39.34s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.1798} | avg. gen lenth: 285.36
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o17-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 17
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 21:46:19,341] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o17-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 17
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o17-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 31/9741 [00:00<00:31, 306.48it/s]  1%|▎                                                     | 62/9741 [00:00<00:31, 308.43it/s]  1%|▌                                                     | 93/9741 [00:00<00:31, 308.91it/s]  1%|▋                                                    | 124/9741 [00:00<00:31, 308.22it/s]  2%|▊                                                    | 155/9741 [00:00<00:31, 307.75it/s]  2%|█                                                    | 186/9741 [00:00<00:31, 306.60it/s]  2%|█▏                                                   | 217/9741 [00:00<00:31, 304.59it/s]  3%|█▎                                                   | 248/9741 [00:00<00:31, 300.80it/s]  3%|█▌                                                   | 279/9741 [00:00<00:31, 301.84it/s]  3%|█▋                                                   | 310/9741 [00:01<00:31, 302.88it/s]  4%|█▊                                                   | 341/9741 [00:01<00:30, 304.00it/s]  4%|██                                                   | 372/9741 [00:01<00:30, 304.80it/s]  4%|██▏                                                  | 403/9741 [00:01<00:30, 304.76it/s]  4%|██▎                                                  | 434/9741 [00:01<00:30, 303.03it/s]  5%|██▌                                                  | 465/9741 [00:01<00:30, 304.28it/s]  5%|██▋                                                  | 496/9741 [00:01<00:30, 305.23it/s]  5%|██▊                                                  | 527/9741 [00:01<00:30, 305.73it/s]  6%|███                                                  | 558/9741 [00:01<00:30, 302.77it/s]  6%|███▏                                                 | 589/9741 [00:01<00:30, 303.42it/s]  6%|███▎                                                 | 620/9741 [00:02<00:29, 304.43it/s]  7%|███▌                                                 | 656/9741 [00:02<00:28, 319.03it/s]  7%|███▊                                                 | 703/9741 [00:02<00:24, 362.11it/s]  8%|████                                                 | 750/9741 [00:02<00:22, 392.77it/s]  8%|████▎                                                | 797/9741 [00:02<00:21, 414.79it/s]  9%|████▌                                                | 844/9741 [00:02<00:20, 429.83it/s]  9%|████▊                                                | 890/9741 [00:02<00:20, 438.23it/s] 10%|█████                                                | 937/9741 [00:02<00:19, 446.15it/s] 10%|█████▎                                               | 984/9741 [00:02<00:19, 451.93it/s] 11%|█████▌                                              | 1031/9741 [00:02<00:19, 456.01it/s] 11%|█████▊                                              | 1078/9741 [00:03<00:18, 459.84it/s] 12%|██████                                              | 1124/9741 [00:03<00:18, 459.71it/s] 12%|██████▎                                             | 1171/9741 [00:03<00:18, 461.83it/s] 13%|██████▌                                             | 1218/9741 [00:03<00:18, 463.09it/s] 13%|██████▊                                             | 1265/9741 [00:03<00:18, 464.30it/s] 13%|███████                                             | 1312/9741 [00:03<00:18, 465.13it/s] 14%|███████▎                                            | 1359/9741 [00:03<00:18, 463.37it/s] 14%|███████▌                                            | 1406/9741 [00:03<00:17, 464.00it/s] 15%|███████▊                                            | 1453/9741 [00:03<00:17, 464.68it/s] 15%|████████                                            | 1500/9741 [00:03<00:17, 464.94it/s] 16%|████████▎                                           | 1547/9741 [00:04<00:17, 465.39it/s] 16%|████████▌                                           | 1594/9741 [00:04<00:17, 463.13it/s] 17%|████████▊                                           | 1641/9741 [00:04<00:17, 463.97it/s] 17%|█████████                                           | 1688/9741 [00:04<00:17, 464.32it/s] 18%|█████████▎                                          | 1735/9741 [00:04<00:17, 464.77it/s] 18%|█████████▌                                          | 1782/9741 [00:04<00:17, 465.33it/s] 19%|█████████▊                                          | 1829/9741 [00:04<00:17, 441.73it/s] 19%|██████████                                          | 1876/9741 [00:04<00:17, 448.56it/s] 20%|██████████▎                                         | 1923/9741 [00:04<00:17, 453.57it/s] 20%|██████████▌                                         | 1970/9741 [00:04<00:16, 457.25it/s] 21%|██████████▊                                         | 2016/9741 [00:05<00:16, 457.84it/s] 21%|███████████                                         | 2063/9741 [00:05<00:16, 460.08it/s] 22%|███████████▎                                        | 2110/9741 [00:05<00:16, 461.28it/s] 22%|███████████▌                                        | 2157/9741 [00:05<00:16, 462.61it/s] 23%|███████████▊                                        | 2204/9741 [00:05<00:16, 463.70it/s] 23%|████████████                                        | 2251/9741 [00:05<00:16, 462.18it/s] 24%|████████████▎                                       | 2298/9741 [00:05<00:16, 461.44it/s] 24%|████████████▌                                       | 2345/9741 [00:05<00:15, 462.36it/s] 25%|████████████▊                                       | 2392/9741 [00:05<00:15, 463.54it/s] 25%|█████████████                                       | 2439/9741 [00:05<00:15, 464.47it/s] 26%|█████████████▎                                      | 2486/9741 [00:06<00:15, 462.50it/s] 26%|█████████████▌                                      | 2533/9741 [00:06<00:15, 463.01it/s] 26%|█████████████▊                                      | 2580/9741 [00:06<00:15, 463.83it/s] 27%|██████████████                                      | 2627/9741 [00:06<00:15, 464.05it/s] 27%|██████████████▎                                     | 2674/9741 [00:06<00:15, 463.63it/s] 28%|██████████████▌                                     | 2721/9741 [00:06<00:15, 461.29it/s] 28%|██████████████▊                                     | 2768/9741 [00:06<00:15, 462.09it/s] 29%|███████████████                                     | 2815/9741 [00:06<00:14, 462.58it/s] 29%|███████████████▎                                    | 2862/9741 [00:06<00:14, 463.85it/s] 30%|███████████████▌                                    | 2909/9741 [00:07<00:14, 460.16it/s] 30%|███████████████▊                                    | 2956/9741 [00:07<00:14, 459.30it/s] 31%|████████████████                                    | 3003/9741 [00:07<00:14, 461.18it/s] 31%|████████████████▎                                   | 3050/9741 [00:07<00:14, 461.92it/s] 32%|████████████████▌                                   | 3097/9741 [00:07<00:14, 462.32it/s] 32%|████████████████▊                                   | 3144/9741 [00:07<00:14, 462.84it/s] 33%|█████████████████                                   | 3191/9741 [00:07<00:14, 460.94it/s] 33%|█████████████████▎                                  | 3238/9741 [00:07<00:14, 462.39it/s] 34%|█████████████████▌                                  | 3285/9741 [00:07<00:13, 463.06it/s] 34%|█████████████████▊                                  | 3332/9741 [00:07<00:13, 463.50it/s] 35%|██████████████████                                  | 3379/9741 [00:08<00:13, 461.67it/s] 35%|██████████████████▎                                 | 3426/9741 [00:08<00:13, 462.69it/s] 36%|██████████████████▌                                 | 3473/9741 [00:08<00:13, 462.99it/s] 36%|██████████████████▊                                 | 3520/9741 [00:08<00:13, 458.55it/s] 37%|███████████████████                                 | 3567/9741 [00:08<00:13, 459.93it/s] 37%|███████████████████▎                                | 3614/9741 [00:08<00:13, 458.72it/s] 38%|███████████████████▌                                | 3661/9741 [00:08<00:13, 460.15it/s] 38%|███████████████████▊                                | 3708/9741 [00:08<00:13, 461.53it/s] 39%|████████████████████                                | 3755/9741 [00:08<00:12, 462.59it/s] 39%|████████████████████▎                               | 3802/9741 [00:08<00:12, 462.87it/s] 40%|████████████████████▌                               | 3849/9741 [00:09<00:12, 461.09it/s] 40%|████████████████████▊                               | 3896/9741 [00:09<00:12, 462.46it/s] 40%|█████████████████████                               | 3943/9741 [00:09<00:12, 463.21it/s] 41%|█████████████████████▎                              | 3990/9741 [00:09<00:12, 463.72it/s] 41%|█████████████████████▌                              | 4037/9741 [00:09<00:12, 464.57it/s] 42%|█████████████████████▊                              | 4084/9741 [00:09<00:12, 462.73it/s] 42%|██████████████████████                              | 4131/9741 [00:09<00:12, 459.06it/s] 43%|██████████████████████▎                             | 4178/9741 [00:09<00:12, 460.58it/s] 43%|██████████████████████▌                             | 4225/9741 [00:09<00:11, 461.07it/s] 44%|██████████████████████▊                             | 4272/9741 [00:09<00:11, 462.40it/s] 44%|███████████████████████                             | 4319/9741 [00:10<00:11, 460.43it/s] 45%|███████████████████████▎                            | 4366/9741 [00:10<00:11, 461.75it/s] 45%|███████████████████████▌                            | 4413/9741 [00:10<00:11, 462.16it/s] 46%|███████████████████████▊                            | 4460/9741 [00:10<00:11, 462.82it/s] 46%|████████████████████████                            | 4507/9741 [00:10<00:11, 463.63it/s] 47%|████████████████████████▎                           | 4554/9741 [00:10<00:12, 413.35it/s] 47%|████████████████████████▌                           | 4601/9741 [00:10<00:12, 427.65it/s] 48%|████████████████████████▊                           | 4648/9741 [00:10<00:11, 438.01it/s] 48%|█████████████████████████                           | 4695/9741 [00:10<00:11, 446.02it/s] 49%|█████████████████████████▎                          | 4741/9741 [00:11<00:15, 326.27it/s] 49%|█████████████████████████▌                          | 4788/9741 [00:11<00:13, 358.47it/s] 50%|█████████████████████████▊                          | 4835/9741 [00:11<00:12, 384.82it/s] 50%|██████████████████████████                          | 4881/9741 [00:11<00:12, 404.32it/s] 51%|██████████████████████████▎                         | 4928/9741 [00:11<00:11, 420.97it/s] 51%|██████████████████████████▌                         | 4974/9741 [00:11<00:11, 431.50it/s] 52%|██████████████████████████▊                         | 5021/9741 [00:11<00:10, 441.18it/s] 52%|███████████████████████████                         | 5068/9741 [00:11<00:10, 448.19it/s] 53%|███████████████████████████▎                        | 5115/9741 [00:11<00:10, 453.00it/s] 53%|███████████████████████████▌                        | 5162/9741 [00:12<00:10, 456.60it/s] 53%|███████████████████████████▊                        | 5209/9741 [00:12<00:09, 456.73it/s] 54%|████████████████████████████                        | 5255/9741 [00:12<00:09, 455.55it/s] 54%|████████████████████████████▎                       | 5302/9741 [00:12<00:09, 457.67it/s] 55%|████████████████████████████▌                       | 5349/9741 [00:12<00:09, 458.80it/s] 55%|████████████████████████████▊                       | 5396/9741 [00:12<00:09, 459.61it/s] 56%|█████████████████████████████                       | 5443/9741 [00:12<00:09, 458.22it/s] 56%|█████████████████████████████▎                      | 5490/9741 [00:12<00:09, 461.10it/s] 57%|█████████████████████████████▌                      | 5538/9741 [00:12<00:09, 466.10it/s] 57%|█████████████████████████████▊                      | 5586/9741 [00:12<00:08, 468.96it/s] 58%|██████████████████████████████                      | 5633/9741 [00:13<00:08, 469.17it/s] 58%|██████████████████████████████▎                     | 5681/9741 [00:13<00:08, 471.81it/s] 59%|██████████████████████████████▌                     | 5729/9741 [00:13<00:08, 473.95it/s] 59%|██████████████████████████████▊                     | 5777/9741 [00:13<00:08, 475.13it/s] 60%|███████████████████████████████                     | 5825/9741 [00:13<00:08, 475.97it/s] 60%|███████████████████████████████▎                    | 5873/9741 [00:13<00:08, 473.47it/s] 61%|███████████████████████████████▌                    | 5921/9741 [00:13<00:08, 474.35it/s] 61%|███████████████████████████████▊                    | 5969/9741 [00:13<00:07, 475.69it/s] 62%|████████████████████████████████                    | 6017/9741 [00:13<00:07, 476.40it/s] 62%|████████████████████████████████▍                   | 6066/9741 [00:13<00:07, 477.60it/s] 63%|████████████████████████████████▋                   | 6114/9741 [00:14<00:07, 475.99it/s] 63%|████████████████████████████████▉                   | 6162/9741 [00:14<00:07, 476.66it/s] 64%|█████████████████████████████████▏                  | 6211/9741 [00:14<00:07, 477.75it/s] 64%|█████████████████████████████████▍                  | 6259/9741 [00:14<00:07, 477.80it/s] 65%|█████████████████████████████████▋                  | 6307/9741 [00:14<00:07, 475.92it/s] 65%|█████████████████████████████████▉                  | 6356/9741 [00:14<00:07, 477.13it/s] 66%|██████████████████████████████████▏                 | 6405/9741 [00:14<00:06, 478.06it/s] 66%|██████████████████████████████████▍                 | 6453/9741 [00:14<00:06, 478.53it/s] 67%|██████████████████████████████████▋                 | 6501/9741 [00:14<00:06, 478.55it/s] 67%|██████████████████████████████████▉                 | 6549/9741 [00:14<00:06, 476.39it/s] 68%|███████████████████████████████████▏                | 6597/9741 [00:15<00:06, 476.91it/s] 68%|███████████████████████████████████▍                | 6645/9741 [00:15<00:06, 477.73it/s] 69%|███████████████████████████████████▋                | 6693/9741 [00:15<00:06, 478.20it/s] 69%|███████████████████████████████████▉                | 6742/9741 [00:15<00:06, 478.80it/s] 70%|████████████████████████████████████▏               | 6790/9741 [00:15<00:06, 477.18it/s] 70%|████████████████████████████████████▌               | 6839/9741 [00:15<00:06, 478.07it/s] 71%|████████████████████████████████████▊               | 6888/9741 [00:15<00:05, 478.78it/s] 71%|█████████████████████████████████████               | 6937/9741 [00:15<00:05, 479.25it/s] 72%|█████████████████████████████████████▎              | 6986/9741 [00:15<00:05, 477.41it/s] 72%|█████████████████████████████████████▌              | 7034/9741 [00:16<00:05, 477.92it/s] 73%|█████████████████████████████████████▊              | 7083/9741 [00:16<00:05, 478.61it/s] 73%|██████████████████████████████████████              | 7132/9741 [00:16<00:05, 479.14it/s] 74%|██████████████████████████████████████▎             | 7180/9741 [00:16<00:05, 478.36it/s] 74%|██████████████████████████████████████▌             | 7228/9741 [00:16<00:05, 475.98it/s] 75%|██████████████████████████████████████▊             | 7276/9741 [00:16<00:05, 476.95it/s] 75%|███████████████████████████████████████             | 7324/9741 [00:16<00:05, 477.70it/s] 76%|███████████████████████████████████████▎            | 7373/9741 [00:16<00:04, 478.60it/s] 76%|███████████████████████████████████████▌            | 7421/9741 [00:16<00:04, 478.96it/s] 77%|███████████████████████████████████████▊            | 7469/9741 [00:16<00:05, 449.64it/s] 77%|████████████████████████████████████████▏           | 7517/9741 [00:17<00:04, 457.48it/s] 78%|████████████████████████████████████████▍           | 7565/9741 [00:17<00:04, 463.38it/s] 78%|████████████████████████████████████████▋           | 7613/9741 [00:17<00:04, 467.75it/s] 79%|████████████████████████████████████████▉           | 7660/9741 [00:17<00:04, 468.40it/s] 79%|█████████████████████████████████████████▏          | 7708/9741 [00:17<00:04, 469.14it/s] 80%|█████████████████████████████████████████▍          | 7756/9741 [00:17<00:04, 472.01it/s] 80%|█████████████████████████████████████████▋          | 7804/9741 [00:17<00:04, 473.40it/s] 81%|█████████████████████████████████████████▉          | 7852/9741 [00:17<00:03, 475.32it/s] 81%|██████████████████████████████████████████▏         | 7900/9741 [00:17<00:03, 474.41it/s] 82%|██████████████████████████████████████████▍         | 7948/9741 [00:17<00:03, 475.95it/s] 82%|██████████████████████████████████████████▋         | 7996/9741 [00:18<00:03, 476.94it/s] 83%|██████████████████████████████████████████▉         | 8044/9741 [00:18<00:03, 477.02it/s] 83%|███████████████████████████████████████████▏        | 8092/9741 [00:18<00:03, 477.20it/s] 84%|███████████████████████████████████████████▍        | 8140/9741 [00:18<00:03, 475.78it/s] 84%|███████████████████████████████████████████▋        | 8188/9741 [00:18<00:03, 476.78it/s] 85%|███████████████████████████████████████████▉        | 8236/9741 [00:18<00:03, 477.35it/s] 85%|████████████████████████████████████████████▏       | 8284/9741 [00:18<00:03, 477.66it/s] 86%|████████████████████████████████████████████▍       | 8332/9741 [00:18<00:02, 477.93it/s] 86%|████████████████████████████████████████████▋       | 8380/9741 [00:18<00:02, 476.08it/s] 87%|████████████████████████████████████████████▉       | 8428/9741 [00:18<00:02, 477.04it/s] 87%|█████████████████████████████████████████████▏      | 8476/9741 [00:19<00:02, 476.53it/s] 88%|█████████████████████████████████████████████▌      | 8524/9741 [00:19<00:02, 477.15it/s] 88%|█████████████████████████████████████████████▊      | 8572/9741 [00:19<00:02, 477.05it/s] 88%|██████████████████████████████████████████████      | 8620/9741 [00:19<00:02, 474.84it/s] 89%|██████████████████████████████████████████████▎     | 8668/9741 [00:19<00:02, 475.52it/s] 89%|██████████████████████████████████████████████▌     | 8716/9741 [00:19<00:02, 476.24it/s] 90%|██████████████████████████████████████████████▊     | 8764/9741 [00:19<00:02, 476.53it/s] 90%|███████████████████████████████████████████████     | 8812/9741 [00:19<00:01, 474.68it/s] 91%|███████████████████████████████████████████████▎    | 8860/9741 [00:19<00:01, 475.63it/s] 91%|███████████████████████████████████████████████▌    | 8908/9741 [00:19<00:01, 476.58it/s] 92%|███████████████████████████████████████████████▊    | 8956/9741 [00:20<00:01, 477.29it/s] 92%|████████████████████████████████████████████████    | 9004/9741 [00:20<00:01, 477.29it/s] 93%|████████████████████████████████████████████████▎   | 9052/9741 [00:20<00:01, 475.58it/s] 93%|████████████████████████████████████████████████▌   | 9100/9741 [00:20<00:01, 476.63it/s] 94%|████████████████████████████████████████████████▊   | 9148/9741 [00:20<00:01, 477.22it/s] 94%|█████████████████████████████████████████████████   | 9196/9741 [00:20<00:01, 477.64it/s] 95%|█████████████████████████████████████████████████▎  | 9244/9741 [00:20<00:01, 477.90it/s] 95%|█████████████████████████████████████████████████▌  | 9292/9741 [00:20<00:00, 474.91it/s] 96%|█████████████████████████████████████████████████▊  | 9340/9741 [00:20<00:00, 475.73it/s] 96%|██████████████████████████████████████████████████  | 9388/9741 [00:20<00:00, 476.34it/s] 97%|██████████████████████████████████████████████████▎ | 9436/9741 [00:21<00:00, 476.78it/s] 97%|██████████████████████████████████████████████████▋ | 9484/9741 [00:21<00:00, 475.16it/s] 98%|██████████████████████████████████████████████████▉ | 9532/9741 [00:21<00:00, 476.14it/s] 98%|███████████████████████████████████████████████████▏| 9580/9741 [00:21<00:00, 476.99it/s] 99%|███████████████████████████████████████████████████▍| 9628/9741 [00:21<00:00, 477.13it/s] 99%|███████████████████████████████████████████████████▋| 9676/9741 [00:21<00:00, 477.37it/s]100%|███████████████████████████████████████████████████▉| 9724/9741 [00:21<00:00, 475.23it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:21<00:00, 448.80it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.49s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.26s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.07s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.08s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.54s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.18s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.19s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.65s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.94s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.10s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.58s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]
[2023-08-21 21:47:36,568] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 21:47:44,601] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 21:47:44,602] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 21:47:44,602] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f35270e6fd0>
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 21:47:44,603] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f3525f3e220>
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 21:47:44,604] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 21:47:44,604] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.47106504440307617 seconds
Loading extension module utils...
Time to load utils op: 0.40475034713745117 seconds
Loading extension module utils...
Time to load utils op: 0.5047237873077393 seconds
Loading extension module utils...
Time to load utils op: 0.504669189453125 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input: Noah, who loves his Grammy, calls her every week to talk about his day. If each call lasts 30 minutes and he is charged $0.05 per call minute, how much would he be billed if he makes the calls for a year?
Output: 78

Input: A merchant bought 15 keyboards and 25 printers for a total of $2050. If a keyboard costs $20, how much does a printer cost?
Output: 70

Input: Gina has two bank accounts. Each account has a quarter of the balance in Betty's account. If Betty's account balance is $3,456, what is the combined balance of both Gina's accounts?
Output: 1728

Input: Zain has 10 more of each coin than Emerie. If Emerie has six quarters, seven dimes, and five nickels, how many coins does Zain have?
Output: 48

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o17-tgsm8k-s10-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:41<33:44, 41.31s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:21<32:30, 40.63s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:01<31:40, 40.43s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:41<30:58, 40.39s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:22<30:13, 40.31s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:02<29:36, 40.38s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:42<28:54, 40.34s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:23<28:11, 40.27s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:03<27:28, 40.21s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:43<26:48, 40.20s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:23<26:10, 40.26s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:03<25:29, 40.25s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:44<24:47, 40.22s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:24<24:08, 40.22s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:04<23:30, 40.29s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:45<22:54, 40.43s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:25<22:10, 40.31s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:06<21:32, 40.39s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:46<20:53, 40.44s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:27<20:18, 40.60s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:07<19:33, 40.47s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:47<18:45, 40.21s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:05<15:08, 33.66s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:45<15:23, 35.52s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:25<15:23, 36.96s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:06<15:12, 38.00s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:47<14:52, 38.79s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:10<12:29, 34.08s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:51<12:42, 36.31s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:32<12:31, 37.59s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:11<12:03, 38.06s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:29<09:34, 31.94s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:06<09:29, 33.51s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:46<09:29, 35.61s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:14<08:19, 33.29s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [22:44<07:32, 32.33s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:24<07:30, 34.68s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [24:04<07:15, 36.27s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [24:45<06:53, 37.57s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [25:11<05:41, 34.12s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [25:52<05:26, 36.27s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:32<04:59, 37.44s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [26:58<03:57, 33.89s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [27:38<03:34, 35.69s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:19<03:06, 37.21s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [28:56<02:28, 37.18s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [29:37<01:54, 38.25s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [30:17<01:17, 38.87s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [30:58<00:39, 39.44s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:38<00:00, 39.80s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:38<00:00, 37.98s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.1444} | avg. gen lenth: 276.404
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o18-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 18
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[2023-08-21 22:20:27,793] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o18-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 18
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o18-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 28/9741 [00:00<00:34, 277.67it/s]  1%|▎                                                     | 56/9741 [00:00<00:34, 278.96it/s]  1%|▍                                                     | 85/9741 [00:00<00:34, 279.71it/s]  1%|▌                                                    | 114/9741 [00:00<00:34, 280.07it/s]  1%|▊                                                    | 143/9741 [00:00<00:34, 279.96it/s]  2%|▉                                                    | 172/9741 [00:00<00:34, 280.11it/s]  2%|█                                                    | 201/9741 [00:00<00:34, 273.85it/s]  2%|█▏                                                   | 229/9741 [00:00<00:34, 275.26it/s]  3%|█▍                                                   | 257/9741 [00:00<00:34, 276.63it/s]  3%|█▌                                                   | 285/9741 [00:01<00:34, 277.57it/s]  3%|█▋                                                   | 314/9741 [00:01<00:33, 278.62it/s]  4%|█▊                                                   | 342/9741 [00:01<00:33, 278.84it/s]  4%|██                                                   | 370/9741 [00:01<00:33, 279.02it/s]  4%|██▏                                                  | 398/9741 [00:01<00:33, 279.24it/s]  4%|██▎                                                  | 426/9741 [00:01<00:33, 279.30it/s]  5%|██▍                                                  | 454/9741 [00:01<00:33, 277.53it/s]  5%|██▌                                                  | 482/9741 [00:01<00:33, 276.33it/s]  5%|██▊                                                  | 510/9741 [00:01<00:33, 277.09it/s]  6%|██▉                                                  | 538/9741 [00:01<00:33, 277.75it/s]  6%|███                                                  | 566/9741 [00:02<00:32, 278.06it/s]  6%|███▏                                                 | 594/9741 [00:02<00:32, 278.49it/s]  6%|███▍                                                 | 622/9741 [00:02<00:32, 278.74it/s]  7%|███▌                                                 | 650/9741 [00:02<00:32, 278.93it/s]  7%|███▋                                                 | 678/9741 [00:02<00:32, 277.56it/s]  7%|███▊                                                 | 706/9741 [00:02<00:32, 278.17it/s]  8%|████                                                 | 739/9741 [00:02<00:30, 293.42it/s]  8%|████▎                                                | 782/9741 [00:02<00:26, 333.17it/s]  8%|████▍                                                | 825/9741 [00:02<00:24, 360.75it/s]  9%|████▋                                                | 868/9741 [00:02<00:23, 379.86it/s]  9%|████▉                                                | 909/9741 [00:03<00:22, 388.75it/s] 10%|█████▏                                               | 952/9741 [00:03<00:22, 399.25it/s] 10%|█████▍                                               | 995/9741 [00:03<00:21, 406.15it/s] 11%|█████▌                                              | 1038/9741 [00:03<00:21, 411.54it/s] 11%|█████▊                                              | 1081/9741 [00:03<00:20, 415.36it/s] 12%|█████▉                                              | 1123/9741 [00:03<00:20, 415.51it/s] 12%|██████▏                                             | 1166/9741 [00:03<00:20, 417.83it/s] 12%|██████▍                                             | 1209/9741 [00:03<00:20, 419.18it/s] 13%|██████▋                                             | 1252/9741 [00:03<00:20, 419.84it/s] 13%|██████▉                                             | 1295/9741 [00:03<00:20, 420.22it/s] 14%|███████▏                                            | 1338/9741 [00:04<00:20, 418.15it/s] 14%|███████▎                                            | 1381/9741 [00:04<00:19, 419.10it/s] 15%|███████▌                                            | 1424/9741 [00:04<00:19, 419.69it/s] 15%|███████▊                                            | 1466/9741 [00:04<00:19, 415.39it/s] 15%|████████                                            | 1508/9741 [00:04<00:19, 416.68it/s] 16%|████████▎                                           | 1551/9741 [00:04<00:19, 418.15it/s] 16%|████████▌                                           | 1593/9741 [00:04<00:19, 415.05it/s] 17%|████████▋                                           | 1636/9741 [00:04<00:19, 417.03it/s] 17%|████████▉                                           | 1679/9741 [00:04<00:19, 418.34it/s] 18%|█████████▏                                          | 1722/9741 [00:04<00:19, 419.34it/s] 18%|█████████▍                                          | 1765/9741 [00:05<00:18, 420.00it/s] 19%|█████████▋                                          | 1808/9741 [00:05<00:20, 387.92it/s] 19%|█████████▉                                          | 1851/9741 [00:05<00:19, 397.08it/s] 19%|██████████                                          | 1894/9741 [00:05<00:19, 404.03it/s] 20%|██████████▎                                         | 1937/9741 [00:05<00:19, 408.83it/s] 20%|██████████▌                                         | 1980/9741 [00:05<00:18, 412.55it/s] 21%|██████████▊                                         | 2022/9741 [00:05<00:18, 411.19it/s] 21%|███████████                                         | 2064/9741 [00:05<00:18, 413.05it/s] 22%|███████████▏                                        | 2106/9741 [00:05<00:18, 414.33it/s] 22%|███████████▍                                        | 2148/9741 [00:06<00:18, 415.78it/s] 22%|███████████▋                                        | 2190/9741 [00:06<00:18, 416.74it/s] 23%|███████████▉                                        | 2232/9741 [00:06<00:17, 417.44it/s] 23%|████████████▏                                       | 2274/9741 [00:06<00:17, 415.59it/s] 24%|████████████▎                                       | 2316/9741 [00:06<00:17, 416.68it/s] 24%|████████████▌                                       | 2359/9741 [00:06<00:17, 417.84it/s] 25%|████████████▊                                       | 2401/9741 [00:06<00:17, 418.42it/s] 25%|█████████████                                       | 2444/9741 [00:06<00:17, 419.39it/s] 26%|█████████████▎                                      | 2486/9741 [00:06<00:17, 416.96it/s] 26%|█████████████▍                                      | 2528/9741 [00:06<00:17, 417.72it/s] 26%|█████████████▋                                      | 2570/9741 [00:07<00:17, 418.25it/s] 27%|█████████████▉                                      | 2613/9741 [00:07<00:16, 419.33it/s] 27%|██████████████▏                                     | 2655/9741 [00:07<00:16, 419.33it/s] 28%|██████████████▍                                     | 2697/9741 [00:07<00:16, 415.82it/s] 28%|██████████████▌                                     | 2739/9741 [00:07<00:16, 416.30it/s] 29%|██████████████▊                                     | 2781/9741 [00:07<00:16, 416.73it/s] 29%|███████████████                                     | 2823/9741 [00:07<00:16, 417.35it/s] 29%|███████████████▎                                    | 2866/9741 [00:07<00:16, 418.41it/s] 30%|███████████████▌                                    | 2908/9741 [00:07<00:16, 418.85it/s] 30%|███████████████▋                                    | 2950/9741 [00:07<00:16, 416.78it/s] 31%|███████████████▉                                    | 2993/9741 [00:08<00:16, 417.80it/s] 31%|████████████████▏                                   | 3035/9741 [00:08<00:16, 418.38it/s] 32%|████████████████▍                                   | 3078/9741 [00:08<00:15, 419.01it/s] 32%|████████████████▋                                   | 3121/9741 [00:08<00:15, 419.74it/s] 32%|████████████████▉                                   | 3163/9741 [00:08<00:15, 417.24it/s] 33%|█████████████████                                   | 3206/9741 [00:08<00:15, 418.65it/s] 33%|█████████████████▎                                  | 3249/9741 [00:08<00:15, 419.44it/s] 34%|█████████████████▌                                  | 3291/9741 [00:08<00:15, 419.53it/s] 34%|█████████████████▊                                  | 3333/9741 [00:08<00:15, 419.47it/s] 35%|██████████████████                                  | 3375/9741 [00:08<00:15, 419.07it/s] 35%|██████████████████▏                                 | 3417/9741 [00:09<00:15, 414.98it/s] 36%|██████████████████▍                                 | 3459/9741 [00:09<00:15, 415.85it/s] 36%|██████████████████▋                                 | 3501/9741 [00:09<00:14, 416.53it/s] 36%|██████████████████▉                                 | 3543/9741 [00:09<00:14, 417.44it/s] 37%|███████████████████▏                                | 3585/9741 [00:09<00:14, 417.58it/s] 37%|███████████████████▎                                | 3627/9741 [00:09<00:14, 415.88it/s] 38%|███████████████████▌                                | 3669/9741 [00:09<00:14, 416.78it/s] 38%|███████████████████▊                                | 3712/9741 [00:09<00:14, 418.03it/s] 39%|████████████████████                                | 3754/9741 [00:09<00:14, 418.51it/s] 39%|████████████████████▎                               | 3796/9741 [00:09<00:14, 417.40it/s] 39%|████████████████████▍                               | 3838/9741 [00:10<00:14, 415.75it/s] 40%|████████████████████▋                               | 3880/9741 [00:10<00:14, 416.73it/s] 40%|████████████████████▉                               | 3923/9741 [00:10<00:13, 417.87it/s] 41%|█████████████████████▏                              | 3965/9741 [00:10<00:13, 418.14it/s] 41%|█████████████████████▍                              | 4007/9741 [00:10<00:13, 418.64it/s] 42%|█████████████████████▌                              | 4049/9741 [00:10<00:13, 418.46it/s] 42%|█████████████████████▊                              | 4091/9741 [00:10<00:13, 416.53it/s] 42%|██████████████████████                              | 4133/9741 [00:10<00:13, 417.14it/s] 43%|██████████████████████▎                             | 4175/9741 [00:10<00:13, 417.93it/s] 43%|██████████████████████▌                             | 4217/9741 [00:10<00:13, 417.14it/s] 44%|██████████████████████▋                             | 4260/9741 [00:11<00:13, 418.05it/s] 44%|██████████████████████▉                             | 4302/9741 [00:11<00:13, 415.96it/s] 45%|███████████████████████▏                            | 4344/9741 [00:11<00:12, 416.72it/s] 45%|███████████████████████▍                            | 4386/9741 [00:11<00:12, 417.60it/s] 45%|███████████████████████▋                            | 4428/9741 [00:11<00:12, 417.49it/s] 46%|███████████████████████▊                            | 4470/9741 [00:11<00:12, 418.12it/s] 46%|████████████████████████                            | 4512/9741 [00:11<00:13, 389.32it/s] 47%|████████████████████████▎                           | 4554/9741 [00:11<00:13, 397.01it/s] 47%|████████████████████████▌                           | 4596/9741 [00:11<00:12, 402.70it/s] 48%|████████████████████████▊                           | 4638/9741 [00:12<00:12, 407.63it/s] 48%|████████████████████████▉                           | 4680/9741 [00:12<00:12, 411.09it/s] 48%|█████████████████████████▏                          | 4722/9741 [00:12<00:12, 413.44it/s] 49%|█████████████████████████▍                          | 4764/9741 [00:12<00:15, 315.84it/s] 49%|█████████████████████████▋                          | 4805/9741 [00:12<00:14, 337.52it/s] 50%|█████████████████████████▊                          | 4847/9741 [00:12<00:13, 358.33it/s] 50%|██████████████████████████                          | 4889/9741 [00:12<00:12, 374.48it/s] 51%|██████████████████████████▎                         | 4931/9741 [00:12<00:12, 386.58it/s] 51%|██████████████████████████▌                         | 4973/9741 [00:12<00:12, 394.39it/s] 51%|██████████████████████████▊                         | 5015/9741 [00:13<00:11, 401.68it/s] 52%|███████████████████████████                         | 5058/9741 [00:13<00:11, 407.27it/s] 52%|███████████████████████████▏                        | 5101/9741 [00:13<00:11, 411.19it/s] 53%|███████████████████████████▍                        | 5144/9741 [00:13<00:11, 413.90it/s] 53%|███████████████████████████▋                        | 5186/9741 [00:13<00:11, 413.48it/s] 54%|███████████████████████████▉                        | 5228/9741 [00:13<00:10, 415.38it/s] 54%|████████████████████████████▏                       | 5270/9741 [00:13<00:10, 416.49it/s] 55%|████████████████████████████▎                       | 5312/9741 [00:13<00:10, 416.55it/s] 55%|████████████████████████████▌                       | 5355/9741 [00:13<00:10, 417.59it/s] 55%|████████████████████████████▊                       | 5397/9741 [00:13<00:10, 416.24it/s] 56%|█████████████████████████████                       | 5440/9741 [00:14<00:10, 417.64it/s] 56%|█████████████████████████████▎                      | 5482/9741 [00:14<00:10, 415.70it/s] 57%|█████████████████████████████▍                      | 5526/9741 [00:14<00:09, 421.53it/s] 57%|█████████████████████████████▋                      | 5570/9741 [00:14<00:09, 425.76it/s] 58%|█████████████████████████████▉                      | 5614/9741 [00:14<00:09, 427.93it/s] 58%|██████████████████████████████▏                     | 5657/9741 [00:14<00:09, 427.32it/s] 59%|██████████████████████████████▍                     | 5701/9741 [00:14<00:09, 429.37it/s] 59%|██████████████████████████████▋                     | 5745/9741 [00:14<00:09, 430.83it/s] 59%|██████████████████████████████▉                     | 5789/9741 [00:14<00:09, 431.77it/s] 60%|███████████████████████████████▏                    | 5833/9741 [00:14<00:09, 431.81it/s] 60%|███████████████████████████████▎                    | 5877/9741 [00:15<00:08, 430.04it/s] 61%|███████████████████████████████▌                    | 5921/9741 [00:15<00:08, 430.91it/s] 61%|███████████████████████████████▊                    | 5965/9741 [00:15<00:08, 431.77it/s] 62%|████████████████████████████████                    | 6009/9741 [00:15<00:08, 431.90it/s] 62%|████████████████████████████████▎                   | 6053/9741 [00:15<00:08, 432.42it/s] 63%|████████████████████████████████▌                   | 6097/9741 [00:15<00:08, 430.60it/s] 63%|████████████████████████████████▊                   | 6141/9741 [00:15<00:08, 430.56it/s] 63%|█████████████████████████████████                   | 6185/9741 [00:15<00:08, 431.12it/s] 64%|█████████████████████████████████▎                  | 6229/9741 [00:15<00:08, 427.67it/s] 64%|█████████████████████████████████▍                  | 6273/9741 [00:15<00:08, 428.79it/s] 65%|█████████████████████████████████▋                  | 6316/9741 [00:16<00:08, 427.08it/s] 65%|█████████████████████████████████▉                  | 6360/9741 [00:16<00:07, 428.54it/s] 66%|██████████████████████████████████▏                 | 6404/9741 [00:16<00:07, 430.07it/s] 66%|██████████████████████████████████▍                 | 6448/9741 [00:16<00:07, 430.50it/s] 67%|██████████████████████████████████▋                 | 6492/9741 [00:16<00:07, 431.04it/s] 67%|██████████████████████████████████▉                 | 6536/9741 [00:16<00:07, 428.39it/s] 68%|███████████████████████████████████▏                | 6580/9741 [00:16<00:07, 429.01it/s] 68%|███████████████████████████████████▎                | 6624/9741 [00:16<00:07, 429.70it/s] 68%|███████████████████████████████████▌                | 6668/9741 [00:16<00:07, 430.51it/s] 69%|███████████████████████████████████▊                | 6712/9741 [00:16<00:07, 431.17it/s] 69%|████████████████████████████████████                | 6756/9741 [00:17<00:06, 431.74it/s] 70%|████████████████████████████████████▎               | 6800/9741 [00:17<00:06, 430.13it/s] 70%|████████████████████████████████████▌               | 6844/9741 [00:17<00:06, 430.68it/s] 71%|████████████████████████████████████▊               | 6888/9741 [00:17<00:06, 431.22it/s] 71%|█████████████████████████████████████               | 6932/9741 [00:17<00:06, 431.52it/s] 72%|█████████████████████████████████████▏              | 6976/9741 [00:17<00:06, 427.92it/s] 72%|█████████████████████████████████████▍              | 7019/9741 [00:17<00:06, 425.44it/s] 73%|█████████████████████████████████████▋              | 7063/9741 [00:17<00:06, 427.43it/s] 73%|█████████████████████████████████████▉              | 7107/9741 [00:17<00:06, 428.60it/s] 73%|██████████████████████████████████████▏             | 7151/9741 [00:18<00:06, 429.26it/s] 74%|██████████████████████████████████████▍             | 7195/9741 [00:18<00:05, 429.91it/s] 74%|██████████████████████████████████████▋             | 7238/9741 [00:18<00:05, 428.14it/s] 75%|██████████████████████████████████████▊             | 7282/9741 [00:18<00:05, 428.93it/s] 75%|███████████████████████████████████████             | 7326/9741 [00:18<00:05, 430.15it/s] 76%|███████████████████████████████████████▎            | 7370/9741 [00:18<00:05, 429.02it/s] 76%|███████████████████████████████████████▌            | 7414/9741 [00:18<00:05, 430.29it/s] 77%|███████████████████████████████████████▊            | 7458/9741 [00:18<00:05, 384.87it/s] 77%|████████████████████████████████████████            | 7501/9741 [00:18<00:05, 397.15it/s] 77%|████████████████████████████████████████▎           | 7544/9741 [00:18<00:05, 406.10it/s] 78%|████████████████████████████████████████▌           | 7588/9741 [00:19<00:05, 413.50it/s] 78%|████████████████████████████████████████▋           | 7632/9741 [00:19<00:05, 419.00it/s] 79%|████████████████████████████████████████▉           | 7675/9741 [00:19<00:04, 417.19it/s] 79%|█████████████████████████████████████████▏          | 7719/9741 [00:19<00:04, 421.61it/s] 80%|█████████████████████████████████████████▍          | 7763/9741 [00:19<00:04, 424.31it/s] 80%|█████████████████████████████████████████▋          | 7807/9741 [00:19<00:04, 426.50it/s] 81%|█████████████████████████████████████████▉          | 7851/9741 [00:19<00:04, 427.75it/s] 81%|██████████████████████████████████████████▏         | 7894/9741 [00:19<00:04, 426.50it/s] 81%|██████████████████████████████████████████▍         | 7938/9741 [00:19<00:04, 428.10it/s] 82%|██████████████████████████████████████████▌         | 7982/9741 [00:19<00:04, 428.80it/s] 82%|██████████████████████████████████████████▊         | 8026/9741 [00:20<00:03, 429.92it/s] 83%|███████████████████████████████████████████         | 8070/9741 [00:20<00:03, 429.99it/s] 83%|███████████████████████████████████████████▎        | 8114/9741 [00:20<00:03, 430.84it/s] 84%|███████████████████████████████████████████▌        | 8158/9741 [00:20<00:03, 428.67it/s] 84%|███████████████████████████████████████████▊        | 8202/9741 [00:20<00:03, 429.32it/s] 85%|████████████████████████████████████████████        | 8246/9741 [00:20<00:03, 430.01it/s] 85%|████████████████████████████████████████████▎       | 8290/9741 [00:20<00:03, 429.71it/s] 86%|████████████████████████████████████████████▍       | 8334/9741 [00:20<00:03, 430.19it/s] 86%|████████████████████████████████████████████▋       | 8378/9741 [00:20<00:03, 427.80it/s] 86%|████████████████████████████████████████████▉       | 8422/9741 [00:21<00:03, 428.93it/s] 87%|█████████████████████████████████████████████▏      | 8466/9741 [00:21<00:02, 429.51it/s] 87%|█████████████████████████████████████████████▍      | 8509/9741 [00:21<00:02, 429.02it/s] 88%|█████████████████████████████████████████████▋      | 8553/9741 [00:21<00:02, 429.37it/s] 88%|█████████████████████████████████████████████▉      | 8596/9741 [00:21<00:02, 425.26it/s] 89%|██████████████████████████████████████████████      | 8639/9741 [00:21<00:02, 426.04it/s] 89%|██████████████████████████████████████████████▎     | 8682/9741 [00:21<00:02, 427.20it/s] 90%|██████████████████████████████████████████████▌     | 8726/9741 [00:21<00:02, 428.49it/s] 90%|██████████████████████████████████████████████▊     | 8770/9741 [00:21<00:02, 429.08it/s] 90%|███████████████████████████████████████████████     | 8813/9741 [00:21<00:02, 426.63it/s] 91%|███████████████████████████████████████████████▎    | 8856/9741 [00:22<00:02, 427.41it/s] 91%|███████████████████████████████████████████████▌    | 8900/9741 [00:22<00:01, 428.73it/s] 92%|███████████████████████████████████████████████▋    | 8944/9741 [00:22<00:01, 429.66it/s] 92%|███████████████████████████████████████████████▉    | 8988/9741 [00:22<00:01, 429.96it/s] 93%|████████████████████████████████████████████████▏   | 9031/9741 [00:22<00:01, 427.65it/s] 93%|████████████████████████████████████████████████▍   | 9074/9741 [00:22<00:01, 428.22it/s] 94%|████████████████████████████████████████████████▋   | 9118/9741 [00:22<00:01, 428.89it/s] 94%|████████████████████████████████████████████████▉   | 9161/9741 [00:22<00:01, 428.95it/s] 94%|█████████████████████████████████████████████████▏  | 9205/9741 [00:22<00:01, 429.39it/s] 95%|█████████████████████████████████████████████████▎  | 9249/9741 [00:22<00:01, 429.59it/s] 95%|█████████████████████████████████████████████████▌  | 9292/9741 [00:23<00:01, 427.45it/s] 96%|█████████████████████████████████████████████████▊  | 9336/9741 [00:23<00:00, 428.49it/s] 96%|██████████████████████████████████████████████████  | 9380/9741 [00:23<00:00, 428.98it/s] 97%|██████████████████████████████████████████████████▎ | 9424/9741 [00:23<00:00, 429.53it/s] 97%|██████████████████████████████████████████████████▌ | 9467/9741 [00:23<00:00, 429.43it/s] 98%|██████████████████████████████████████████████████▊ | 9510/9741 [00:23<00:00, 427.21it/s] 98%|██████████████████████████████████████████████████▉ | 9553/9741 [00:23<00:00, 427.41it/s] 99%|███████████████████████████████████████████████████▏| 9596/9741 [00:23<00:00, 427.99it/s] 99%|███████████████████████████████████████████████████▍| 9639/9741 [00:23<00:00, 428.47it/s] 99%|███████████████████████████████████████████████████▋| 9682/9741 [00:24<00:00, 275.63it/s]100%|███████████████████████████████████████████████████▉| 9724/9741 [00:24<00:00, 306.43it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:24<00:00, 401.07it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.43s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.77s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:06<00:13,  6.53s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:07<00:15,  7.62s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.97s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:12<00:06,  6.29s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:13<00:06,  6.77s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:17<00:00,  5.59s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:17<00:00,  5.80s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:18<00:00,  6.18s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:18<00:00,  6.10s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:20<00:00,  6.53s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:20<00:00,  6.68s/it]
[2023-08-21 22:21:49,797] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 22:22:03,919] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 22:22:03,920] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f7ea66fefd0>
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 22:22:03,921] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f7ea5c16220>
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 22:22:03,922] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 22:22:03,922] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5443720817565918 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input: Noah, who loves his Grammy, calls her every week to talk about his day. If each call lasts 30 minutes and he is charged $0.05 per call minute, how much would he be billed if he makes the calls for a year?
Output: 78

Input: A merchant bought 15 keyboards and 25 printers for a total of $2050. If a keyboard costs $20, how much does a printer cost?
Output: 70

Input: Gina has two bank accounts. Each account has a quarter of the balance in Betty's account. If Betty's account balance is $3,456, what is the combined balance of both Gina's accounts?
Output: 1728

Input: Zain has 10 more of each coin than Emerie. If Emerie has six quarters, seven dimes, and five nickels, how many coins does Zain have?
Output: 48

Input: Adonis is playing a prank on his dad by replacing his shampoo with hot sauce. Every day, after his dad showers, Adonis replaces the shampoo with 1/2 an ounce of hot sauce. He knows his dad uses 1 oz of shampoo a day from a new 10 oz bottle that no one else uses. After 4 days, what percentage of the liquid in the bottle is hot sauce?
Output: 25

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o18-tgsm8k-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.40497756004333496 seconds
Loading extension module utils...
Time to load utils op: 0.5047075748443604 seconds
Loading extension module utils...
Time to load utils op: 0.6055209636688232 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:24<19:36, 24.02s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [00:50<20:18, 25.38s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:30<25:00, 31.92s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:09<26:53, 35.08s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [02:49<27:31, 36.70s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:28<27:32, 37.56s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:08<27:28, 38.34s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [04:48<27:07, 38.74s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:17<24:24, 35.73s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [05:56<24:34, 36.87s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [06:36<24:30, 37.71s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [06:56<20:29, 32.36s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [07:36<21:21, 34.63s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [08:16<21:48, 36.34s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [08:56<21:43, 37.24s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [09:27<20:09, 35.58s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:00<19:03, 34.64s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [10:39<19:12, 36.02s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [11:11<17:55, 34.68s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [11:50<18:02, 36.07s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [12:29<17:56, 37.12s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [13:09<17:42, 37.94s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [13:49<17:22, 38.61s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [14:29<16:52, 38.92s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [15:09<16:17, 39.08s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [15:49<15:44, 39.35s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [16:28<15:07, 39.44s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [17:08<14:29, 39.53s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [17:48<13:51, 39.59s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [18:27<13:13, 39.65s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:07<12:33, 39.66s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [19:47<11:52, 39.59s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [20:07<09:35, 33.85s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [20:46<09:27, 35.44s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [21:26<09:12, 36.81s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [22:06<08:49, 37.85s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [22:42<08:02, 37.08s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [23:21<07:33, 37.77s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [23:59<06:56, 37.84s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [24:38<06:21, 38.20s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [25:18<05:47, 38.62s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [25:57<05:10, 38.83s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [26:37<04:33, 39.09s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [27:16<03:55, 39.25s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [27:56<03:16, 39.37s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [28:28<02:28, 37.09s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [29:03<01:49, 36.53s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [29:43<01:14, 37.47s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [30:00<00:31, 31.37s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [30:39<00:00, 33.83s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [30:39<00:00, 36.80s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.2981} | avg. gen lenth: 289.388
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o19-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 19
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 22:54:16,321] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o19-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 19
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o19-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 26/9741 [00:00<00:38, 254.57it/s]  1%|▎                                                     | 52/9741 [00:00<00:37, 255.83it/s]  1%|▍                                                     | 78/9741 [00:00<00:37, 256.16it/s]  1%|▌                                                    | 104/9741 [00:00<00:37, 257.65it/s]  1%|▋                                                    | 130/9741 [00:00<00:37, 257.80it/s]  2%|▊                                                    | 156/9741 [00:00<00:37, 258.20it/s]  2%|▉                                                    | 182/9741 [00:00<00:37, 257.94it/s]  2%|█▏                                                   | 208/9741 [00:00<00:37, 252.18it/s]  2%|█▎                                                   | 234/9741 [00:00<00:37, 253.90it/s]  3%|█▍                                                   | 260/9741 [00:01<00:37, 254.83it/s]  3%|█▌                                                   | 286/9741 [00:01<00:37, 255.54it/s]  3%|█▋                                                   | 312/9741 [00:01<00:36, 256.23it/s]  3%|█▊                                                   | 338/9741 [00:01<00:36, 256.20it/s]  4%|█▉                                                   | 364/9741 [00:01<00:36, 256.46it/s]  4%|██▏                                                  | 391/9741 [00:01<00:36, 257.67it/s]  4%|██▎                                                  | 417/9741 [00:01<00:36, 257.90it/s]  5%|██▍                                                  | 443/9741 [00:01<00:36, 256.54it/s]  5%|██▌                                                  | 469/9741 [00:01<00:36, 254.42it/s]  5%|██▋                                                  | 495/9741 [00:01<00:36, 255.10it/s]  5%|██▊                                                  | 521/9741 [00:02<00:35, 256.29it/s]  6%|██▉                                                  | 547/9741 [00:02<00:35, 257.05it/s]  6%|███                                                  | 573/9741 [00:02<00:35, 257.15it/s]  6%|███▎                                                 | 599/9741 [00:02<00:35, 257.50it/s]  6%|███▍                                                 | 625/9741 [00:02<00:35, 257.59it/s]  7%|███▌                                                 | 651/9741 [00:02<00:35, 258.14it/s]  7%|███▋                                                 | 677/9741 [00:02<00:35, 256.42it/s]  7%|███▊                                                 | 710/9741 [00:02<00:32, 276.97it/s]  8%|████                                                 | 750/9741 [00:02<00:28, 311.89it/s]  8%|████▎                                                | 790/9741 [00:02<00:26, 336.18it/s]  9%|████▌                                                | 830/9741 [00:03<00:25, 353.08it/s]  9%|████▋                                                | 870/9741 [00:03<00:24, 365.11it/s]  9%|████▉                                                | 909/9741 [00:03<00:23, 371.03it/s] 10%|█████▏                                               | 948/9741 [00:03<00:23, 376.42it/s] 10%|█████▍                                               | 988/9741 [00:03<00:22, 380.93it/s] 11%|█████▍                                              | 1028/9741 [00:03<00:22, 384.71it/s] 11%|█████▋                                              | 1068/9741 [00:03<00:22, 387.39it/s] 11%|█████▉                                              | 1108/9741 [00:03<00:22, 386.87it/s] 12%|██████▏                                             | 1148/9741 [00:03<00:22, 388.61it/s] 12%|██████▎                                             | 1188/9741 [00:03<00:21, 389.48it/s] 13%|██████▌                                             | 1227/9741 [00:04<00:21, 389.57it/s] 13%|██████▊                                             | 1266/9741 [00:04<00:21, 389.55it/s] 13%|██████▉                                             | 1306/9741 [00:04<00:21, 389.81it/s] 14%|███████▏                                            | 1345/9741 [00:04<00:21, 388.01it/s] 14%|███████▍                                            | 1385/9741 [00:04<00:21, 388.67it/s] 15%|███████▌                                            | 1425/9741 [00:04<00:21, 389.51it/s] 15%|███████▊                                            | 1465/9741 [00:04<00:21, 389.84it/s] 15%|████████                                            | 1504/9741 [00:04<00:21, 388.53it/s] 16%|████████▏                                           | 1543/9741 [00:04<00:21, 387.70it/s] 16%|████████▍                                           | 1582/9741 [00:04<00:21, 384.70it/s] 17%|████████▋                                           | 1621/9741 [00:05<00:21, 385.89it/s] 17%|████████▊                                           | 1661/9741 [00:05<00:20, 387.37it/s] 17%|█████████                                           | 1700/9741 [00:05<00:20, 386.80it/s] 18%|█████████▎                                          | 1740/9741 [00:05<00:20, 387.95it/s] 18%|█████████▌                                          | 1780/9741 [00:05<00:20, 388.94it/s] 19%|█████████▋                                          | 1819/9741 [00:05<00:21, 367.56it/s] 19%|█████████▉                                          | 1858/9741 [00:05<00:21, 371.73it/s] 19%|██████████▏                                         | 1897/9741 [00:05<00:20, 376.81it/s] 20%|██████████▎                                         | 1937/9741 [00:05<00:20, 380.86it/s] 20%|██████████▌                                         | 1977/9741 [00:06<00:20, 383.83it/s] 21%|██████████▊                                         | 2016/9741 [00:06<00:20, 384.05it/s] 21%|██████████▉                                         | 2055/9741 [00:06<00:19, 385.60it/s] 21%|███████████▏                                        | 2094/9741 [00:06<00:19, 386.83it/s] 22%|███████████▍                                        | 2133/9741 [00:06<00:19, 387.62it/s] 22%|███████████▌                                        | 2172/9741 [00:06<00:19, 388.03it/s] 23%|███████████▊                                        | 2211/9741 [00:06<00:19, 388.46it/s] 23%|████████████                                        | 2250/9741 [00:06<00:19, 386.67it/s] 24%|████████████▏                                       | 2290/9741 [00:06<00:19, 387.83it/s] 24%|████████████▍                                       | 2329/9741 [00:06<00:19, 388.15it/s] 24%|████████████▋                                       | 2368/9741 [00:07<00:19, 385.67it/s] 25%|████████████▊                                       | 2408/9741 [00:07<00:18, 387.15it/s] 25%|█████████████                                       | 2447/9741 [00:07<00:18, 387.87it/s] 26%|█████████████▎                                      | 2486/9741 [00:07<00:18, 385.81it/s] 26%|█████████████▍                                      | 2525/9741 [00:07<00:18, 386.67it/s] 26%|█████████████▋                                      | 2564/9741 [00:07<00:18, 386.63it/s] 27%|█████████████▉                                      | 2603/9741 [00:07<00:18, 387.49it/s] 27%|██████████████                                      | 2642/9741 [00:07<00:18, 388.18it/s] 28%|██████████████▎                                     | 2682/9741 [00:07<00:18, 388.78it/s] 28%|██████████████▌                                     | 2721/9741 [00:07<00:18, 386.59it/s] 28%|██████████████▋                                     | 2760/9741 [00:08<00:18, 387.32it/s] 29%|██████████████▉                                     | 2799/9741 [00:08<00:17, 386.75it/s] 29%|███████████████▏                                    | 2839/9741 [00:08<00:17, 387.50it/s] 30%|███████████████▎                                    | 2878/9741 [00:08<00:17, 384.70it/s] 30%|███████████████▌                                    | 2917/9741 [00:08<00:17, 386.04it/s] 30%|███████████████▊                                    | 2956/9741 [00:08<00:17, 384.58it/s] 31%|███████████████▉                                    | 2995/9741 [00:08<00:17, 386.05it/s] 31%|████████████████▏                                   | 3034/9741 [00:08<00:17, 387.19it/s] 32%|████████████████▍                                   | 3073/9741 [00:08<00:17, 387.86it/s] 32%|████████████████▌                                   | 3113/9741 [00:08<00:17, 388.48it/s] 32%|████████████████▊                                   | 3152/9741 [00:09<00:17, 386.36it/s] 33%|█████████████████                                   | 3191/9741 [00:09<00:16, 387.36it/s] 33%|█████████████████▏                                  | 3230/9741 [00:09<00:16, 387.80it/s] 34%|█████████████████▍                                  | 3269/9741 [00:09<00:16, 387.85it/s] 34%|█████████████████▋                                  | 3309/9741 [00:09<00:16, 388.58it/s] 34%|█████████████████▊                                  | 3348/9741 [00:09<00:16, 388.28it/s] 35%|██████████████████                                  | 3387/9741 [00:09<00:16, 381.37it/s] 35%|██████████████████▎                                 | 3426/9741 [00:09<00:16, 383.54it/s] 36%|██████████████████▍                                 | 3465/9741 [00:09<00:16, 384.09it/s] 36%|██████████████████▋                                 | 3504/9741 [00:09<00:16, 384.46it/s] 36%|██████████████████▉                                 | 3544/9741 [00:10<00:16, 386.12it/s] 37%|███████████████████▏                                | 3583/9741 [00:10<00:15, 386.58it/s] 37%|███████████████████▎                                | 3622/9741 [00:10<00:15, 384.83it/s] 38%|███████████████████▌                                | 3661/9741 [00:10<00:15, 385.48it/s] 38%|███████████████████▊                                | 3700/9741 [00:10<00:15, 386.38it/s] 38%|███████████████████▉                                | 3739/9741 [00:10<00:15, 387.41it/s] 39%|████████████████████▏                               | 3778/9741 [00:10<00:15, 387.29it/s] 39%|████████████████████▍                               | 3817/9741 [00:10<00:15, 387.89it/s] 40%|████████████████████▌                               | 3856/9741 [00:10<00:15, 384.65it/s] 40%|████████████████████▊                               | 3895/9741 [00:10<00:15, 386.11it/s] 40%|█████████████████████                               | 3934/9741 [00:11<00:15, 386.94it/s] 41%|█████████████████████▏                              | 3973/9741 [00:11<00:14, 387.00it/s] 41%|█████████████████████▍                              | 4012/9741 [00:11<00:14, 387.38it/s] 42%|█████████████████████▋                              | 4051/9741 [00:11<00:14, 386.83it/s] 42%|█████████████████████▊                              | 4090/9741 [00:11<00:14, 384.53it/s] 42%|██████████████████████                              | 4129/9741 [00:11<00:14, 385.52it/s] 43%|██████████████████████▏                             | 4168/9741 [00:11<00:14, 386.32it/s] 43%|██████████████████████▍                             | 4207/9741 [00:11<00:14, 386.75it/s] 44%|██████████████████████▋                             | 4246/9741 [00:11<00:14, 387.06it/s] 44%|██████████████████████▊                             | 4285/9741 [00:11<00:14, 385.54it/s] 44%|███████████████████████                             | 4324/9741 [00:12<00:14, 386.19it/s] 45%|███████████████████████▎                            | 4363/9741 [00:12<00:13, 385.13it/s] 45%|███████████████████████▍                            | 4402/9741 [00:12<00:13, 386.17it/s] 46%|███████████████████████▋                            | 4441/9741 [00:12<00:13, 386.89it/s] 46%|███████████████████████▉                            | 4480/9741 [00:12<00:13, 387.34it/s] 46%|████████████████████████                            | 4519/9741 [00:12<00:14, 348.83it/s] 47%|████████████████████████▎                           | 4558/9741 [00:12<00:14, 359.36it/s] 47%|████████████████████████▌                           | 4597/9741 [00:12<00:13, 367.84it/s] 48%|████████████████████████▋                           | 4636/9741 [00:12<00:13, 373.93it/s] 48%|████████████████████████▉                           | 4675/9741 [00:13<00:13, 378.21it/s] 48%|█████████████████████████▏                          | 4714/9741 [00:13<00:13, 381.31it/s] 49%|█████████████████████████▎                          | 4753/9741 [00:13<00:19, 261.11it/s] 49%|█████████████████████████▌                          | 4792/9741 [00:13<00:17, 289.61it/s] 50%|█████████████████████████▊                          | 4831/9741 [00:13<00:15, 313.62it/s] 50%|█████████████████████████▉                          | 4870/9741 [00:13<00:14, 332.41it/s] 50%|██████████████████████████▏                         | 4909/9741 [00:13<00:13, 347.44it/s] 51%|██████████████████████████▍                         | 4947/9741 [00:13<00:13, 355.02it/s] 51%|██████████████████████████▌                         | 4986/9741 [00:13<00:13, 363.73it/s] 52%|██████████████████████████▊                         | 5025/9741 [00:14<00:12, 370.14it/s] 52%|███████████████████████████                         | 5064/9741 [00:14<00:12, 374.68it/s] 52%|███████████████████████████▏                        | 5103/9741 [00:14<00:12, 377.44it/s] 53%|███████████████████████████▍                        | 5142/9741 [00:14<00:12, 379.87it/s] 53%|███████████████████████████▋                        | 5181/9741 [00:14<00:12, 379.04it/s] 54%|███████████████████████████▊                        | 5220/9741 [00:14<00:11, 380.57it/s] 54%|████████████████████████████                        | 5259/9741 [00:14<00:11, 382.21it/s] 54%|████████████████████████████▎                       | 5298/9741 [00:14<00:11, 383.18it/s] 55%|████████████████████████████▍                       | 5337/9741 [00:14<00:11, 383.77it/s] 55%|████████████████████████████▋                       | 5376/9741 [00:15<00:11, 385.49it/s] 56%|████████████████████████████▉                       | 5415/9741 [00:15<00:11, 384.11it/s] 56%|█████████████████████████████                       | 5454/9741 [00:15<00:11, 385.46it/s] 56%|█████████████████████████████▎                      | 5494/9741 [00:15<00:10, 388.34it/s] 57%|█████████████████████████████▌                      | 5534/9741 [00:15<00:10, 391.20it/s] 57%|█████████████████████████████▊                      | 5575/9741 [00:15<00:10, 394.01it/s] 58%|█████████████████████████████▉                      | 5615/9741 [00:15<00:10, 381.64it/s] 58%|██████████████████████████████▏                     | 5655/9741 [00:15<00:10, 384.91it/s] 58%|██████████████████████████████▍                     | 5696/9741 [00:15<00:10, 389.65it/s] 59%|██████████████████████████████▋                     | 5737/9741 [00:15<00:10, 393.36it/s] 59%|██████████████████████████████▊                     | 5778/9741 [00:16<00:10, 395.53it/s] 60%|███████████████████████████████                     | 5819/9741 [00:16<00:09, 397.25it/s] 60%|███████████████████████████████▎                    | 5859/9741 [00:16<00:09, 395.94it/s] 61%|███████████████████████████████▍                    | 5900/9741 [00:16<00:09, 397.68it/s] 61%|███████████████████████████████▋                    | 5941/9741 [00:16<00:09, 398.96it/s] 61%|███████████████████████████████▉                    | 5982/9741 [00:16<00:09, 399.79it/s] 62%|████████████████████████████████▏                   | 6023/9741 [00:16<00:09, 400.34it/s] 62%|████████████████████████████████▎                   | 6064/9741 [00:16<00:09, 401.02it/s] 63%|████████████████████████████████▌                   | 6105/9741 [00:16<00:09, 399.23it/s] 63%|████████████████████████████████▊                   | 6146/9741 [00:16<00:08, 399.54it/s] 64%|█████████████████████████████████                   | 6187/9741 [00:17<00:08, 400.08it/s] 64%|█████████████████████████████████▏                  | 6228/9741 [00:17<00:08, 400.22it/s] 64%|█████████████████████████████████▍                  | 6269/9741 [00:17<00:08, 400.08it/s] 65%|█████████████████████████████████▋                  | 6310/9741 [00:17<00:08, 397.38it/s] 65%|█████████████████████████████████▉                  | 6350/9741 [00:17<00:08, 397.80it/s] 66%|██████████████████████████████████                  | 6391/9741 [00:17<00:08, 398.96it/s] 66%|██████████████████████████████████▎                 | 6432/9741 [00:17<00:08, 399.46it/s] 66%|██████████████████████████████████▌                 | 6473/9741 [00:17<00:08, 399.83it/s] 67%|██████████████████████████████████▊                 | 6514/9741 [00:17<00:08, 400.12it/s] 67%|██████████████████████████████████▉                 | 6555/9741 [00:17<00:08, 398.16it/s] 68%|███████████████████████████████████▏                | 6595/9741 [00:18<00:07, 398.59it/s] 68%|███████████████████████████████████▍                | 6636/9741 [00:18<00:07, 399.30it/s] 69%|███████████████████████████████████▋                | 6677/9741 [00:18<00:07, 399.49it/s] 69%|███████████████████████████████████▊                | 6717/9741 [00:18<00:07, 399.44it/s] 69%|████████████████████████████████████                | 6758/9741 [00:18<00:07, 399.81it/s] 70%|████████████████████████████████████▎               | 6798/9741 [00:18<00:07, 397.84it/s] 70%|████████████████████████████████████▌               | 6839/9741 [00:18<00:07, 398.89it/s] 71%|████████████████████████████████████▋               | 6880/9741 [00:18<00:07, 399.43it/s] 71%|████████████████████████████████████▉               | 6921/9741 [00:18<00:07, 399.78it/s] 71%|█████████████████████████████████████▏              | 6961/9741 [00:18<00:06, 398.39it/s] 72%|█████████████████████████████████████▎              | 7001/9741 [00:19<00:06, 396.80it/s] 72%|█████████████████████████████████████▌              | 7042/9741 [00:19<00:06, 397.80it/s] 73%|█████████████████████████████████████▊              | 7083/9741 [00:19<00:06, 398.60it/s] 73%|██████████████████████████████████████              | 7123/9741 [00:19<00:06, 398.44it/s] 74%|██████████████████████████████████████▏             | 7164/9741 [00:19<00:06, 399.03it/s] 74%|██████████████████████████████████████▍             | 7205/9741 [00:19<00:06, 399.56it/s] 74%|██████████████████████████████████████▋             | 7245/9741 [00:19<00:06, 397.72it/s] 75%|██████████████████████████████████████▉             | 7286/9741 [00:19<00:06, 398.52it/s] 75%|███████████████████████████████████████             | 7327/9741 [00:19<00:06, 399.01it/s] 76%|███████████████████████████████████████▎            | 7368/9741 [00:20<00:05, 399.56it/s] 76%|███████████████████████████████████████▌            | 7409/9741 [00:20<00:05, 399.94it/s] 76%|███████████████████████████████████████▊            | 7449/9741 [00:20<00:06, 372.90it/s] 77%|███████████████████████████████████████▉            | 7489/9741 [00:20<00:05, 380.18it/s] 77%|████████████████████████████████████████▏           | 7529/9741 [00:20<00:05, 385.41it/s] 78%|████████████████████████████████████████▍           | 7569/9741 [00:20<00:05, 389.63it/s] 78%|████████████████████████████████████████▌           | 7610/9741 [00:20<00:05, 392.71it/s] 79%|████████████████████████████████████████▊           | 7650/9741 [00:20<00:05, 392.08it/s] 79%|█████████████████████████████████████████           | 7690/9741 [00:20<00:05, 391.64it/s] 79%|█████████████████████████████████████████▎          | 7731/9741 [00:20<00:05, 394.47it/s] 80%|█████████████████████████████████████████▍          | 7771/9741 [00:21<00:04, 396.07it/s] 80%|█████████████████████████████████████████▋          | 7812/9741 [00:21<00:04, 397.38it/s] 81%|█████████████████████████████████████████▉          | 7852/9741 [00:21<00:04, 398.12it/s] 81%|██████████████████████████████████████████▏         | 7892/9741 [00:21<00:04, 398.40it/s] 81%|██████████████████████████████████████████▎         | 7932/9741 [00:21<00:04, 394.92it/s] 82%|██████████████████████████████████████████▌         | 7972/9741 [00:21<00:04, 396.35it/s] 82%|██████████████████████████████████████████▊         | 8012/9741 [00:21<00:04, 396.69it/s] 83%|██████████████████████████████████████████▉         | 8052/9741 [00:21<00:04, 397.43it/s] 83%|███████████████████████████████████████████▏        | 8093/9741 [00:21<00:04, 398.47it/s] 83%|███████████████████████████████████████████▍        | 8133/9741 [00:21<00:04, 397.24it/s] 84%|███████████████████████████████████████████▋        | 8173/9741 [00:22<00:03, 398.06it/s] 84%|███████████████████████████████████████████▊        | 8213/9741 [00:22<00:03, 398.55it/s] 85%|████████████████████████████████████████████        | 8253/9741 [00:22<00:03, 398.76it/s] 85%|████████████████████████████████████████████▎       | 8293/9741 [00:22<00:03, 398.65it/s] 86%|████████████████████████████████████████████▍       | 8333/9741 [00:22<00:03, 395.26it/s] 86%|████████████████████████████████████████████▋       | 8373/9741 [00:22<00:03, 392.90it/s] 86%|████████████████████████████████████████████▉       | 8413/9741 [00:22<00:03, 394.68it/s] 87%|█████████████████████████████████████████████       | 8453/9741 [00:22<00:03, 396.09it/s] 87%|█████████████████████████████████████████████▎      | 8493/9741 [00:22<00:03, 397.01it/s] 88%|█████████████████████████████████████████████▌      | 8533/9741 [00:22<00:03, 397.50it/s] 88%|█████████████████████████████████████████████▊      | 8573/9741 [00:23<00:02, 397.77it/s] 88%|█████████████████████████████████████████████▉      | 8613/9741 [00:23<00:02, 396.04it/s] 89%|██████████████████████████████████████████████▏     | 8653/9741 [00:23<00:02, 397.03it/s] 89%|██████████████████████████████████████████████▍     | 8693/9741 [00:23<00:02, 397.59it/s] 90%|██████████████████████████████████████████████▌     | 8733/9741 [00:23<00:02, 396.47it/s] 90%|██████████████████████████████████████████████▊     | 8773/9741 [00:23<00:02, 397.07it/s] 90%|███████████████████████████████████████████████     | 8813/9741 [00:23<00:02, 395.37it/s] 91%|███████████████████████████████████████████████▎    | 8853/9741 [00:23<00:02, 396.15it/s] 91%|███████████████████████████████████████████████▍    | 8893/9741 [00:23<00:02, 396.88it/s] 92%|███████████████████████████████████████████████▋    | 8933/9741 [00:23<00:02, 397.49it/s] 92%|███████████████████████████████████████████████▉    | 8973/9741 [00:24<00:01, 394.19it/s] 93%|████████████████████████████████████████████████    | 9013/9741 [00:24<00:01, 395.42it/s] 93%|████████████████████████████████████████████████▎   | 9053/9741 [00:24<00:01, 393.97it/s] 93%|████████████████████████████████████████████████▌   | 9093/9741 [00:24<00:01, 395.04it/s] 94%|████████████████████████████████████████████████▊   | 9133/9741 [00:24<00:01, 395.69it/s] 94%|████████████████████████████████████████████████▉   | 9173/9741 [00:24<00:01, 396.78it/s] 95%|█████████████████████████████████████████████████▏  | 9213/9741 [00:24<00:01, 397.17it/s] 95%|█████████████████████████████████████████████████▍  | 9253/9741 [00:24<00:01, 397.36it/s] 95%|█████████████████████████████████████████████████▌  | 9293/9741 [00:24<00:01, 395.16it/s] 96%|█████████████████████████████████████████████████▊  | 9333/9741 [00:24<00:01, 395.96it/s] 96%|██████████████████████████████████████████████████  | 9373/9741 [00:25<00:00, 396.50it/s] 97%|██████████████████████████████████████████████████▏ | 9413/9741 [00:25<00:00, 396.80it/s] 97%|██████████████████████████████████████████████████▍ | 9453/9741 [00:25<00:00, 397.15it/s] 97%|██████████████████████████████████████████████████▋ | 9493/9741 [00:25<00:00, 395.58it/s] 98%|██████████████████████████████████████████████████▉ | 9533/9741 [00:25<00:00, 395.55it/s] 98%|███████████████████████████████████████████████████ | 9573/9741 [00:25<00:00, 396.40it/s] 99%|███████████████████████████████████████████████████▎| 9613/9741 [00:25<00:00, 396.88it/s] 99%|███████████████████████████████████████████████████▌| 9653/9741 [00:25<00:00, 395.98it/s]100%|███████████████████████████████████████████████████▋| 9693/9741 [00:25<00:00, 396.75it/s]100%|███████████████████████████████████████████████████▉| 9733/9741 [00:26<00:00, 395.09it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:26<00:00, 374.31it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.95s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.14s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.35s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.44s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.07s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.06s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.35s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.41s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.58s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.41s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.60s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.89s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
[2023-08-21 22:55:34,717] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 22:55:43,165] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 22:55:43,165] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f60a1f77fd0>
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 22:55:43,166] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f609ef7b220>
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 22:55:43,167] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 22:55:43,167] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.46066904067993164 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input: Noah, who loves his Grammy, calls her every week to talk about his day. If each call lasts 30 minutes and he is charged $0.05 per call minute, how much would he be billed if he makes the calls for a year?
Output: 78

Input: A merchant bought 15 keyboards and 25 printers for a total of $2050. If a keyboard costs $20, how much does a printer cost?
Output: 70

Input: Gina has two bank accounts. Each account has a quarter of the balance in Betty's account. If Betty's account balance is $3,456, what is the combined balance of both Gina's accounts?
Output: 1728

Input: Zain has 10 more of each coin than Emerie. If Emerie has six quarters, seven dimes, and five nickels, how many coins does Zain have?
Output: 48

Input: Adonis is playing a prank on his dad by replacing his shampoo with hot sauce. Every day, after his dad showers, Adonis replaces the shampoo with 1/2 an ounce of hot sauce. He knows his dad uses 1 oz of shampoo a day from a new 10 oz bottle that no one else uses. After 4 days, what percentage of the liquid in the bottle is hot sauce?
Output: 25

Input: Lana and Mike are taking their dog and renting a cabin in the mountains for 2 weeks.  The daily rate is $125.00  There is a $100.00 pet fee.  There is also a 20% service/cleaning fee for the rental.  They need to pay 50% of the entire bill as a security deposit.  How much is their security deposit?
Output: 1110

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o19-tgsm8k-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.40436863899230957 seconds
Loading extension module utils...
Time to load utils op: 0.5047955513000488 seconds
Loading extension module utils...
Time to load utils op: 0.5074918270111084 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:39<32:23, 39.67s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:12<28:25, 35.54s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:51<29:07, 37.19s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:30<29:00, 37.84s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:08<28:36, 38.14s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:47<28:08, 38.38s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:26<27:41, 38.63s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:06<27:11, 38.85s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:45<26:36, 38.93s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:24<25:59, 38.99s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:03<25:22, 39.05s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:42<24:36, 38.87s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:21<24:01, 38.96s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:00<23:20, 38.89s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:39<22:43, 38.94s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:18<22:05, 38.98s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:49<20:14, 36.80s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:09<16:54, 31.71s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [11:48<17:29, 33.87s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:27<17:40, 35.35s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:06<17:35, 36.40s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [13:44<17:17, 37.07s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:24<16:56, 37.66s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:02<16:27, 37.97s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [15:41<15:54, 38.17s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:20<15:22, 38.43s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [16:58<14:44, 38.44s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [17:37<14:10, 38.66s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:17<13:34, 38.79s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [18:55<12:53, 38.70s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:34<12:16, 38.75s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:13<11:37, 38.76s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [20:52<11:00, 38.88s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:31<10:23, 38.94s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:01<09:04, 36.29s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [22:40<08:39, 37.11s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:19<08:09, 37.63s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [23:58<07:35, 37.99s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [24:37<07:00, 38.21s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [25:15<06:23, 38.34s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [25:54<05:45, 38.42s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:33<05:08, 38.58s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [27:12<04:31, 38.72s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [27:50<03:52, 38.71s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:29<03:13, 38.76s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [29:09<02:36, 39.09s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [29:48<01:57, 39.07s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [30:09<01:07, 33.68s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [30:48<00:35, 35.25s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:27<00:00, 36.38s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:27<00:00, 37.75s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.6474} | avg. gen lenth: 301.412
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o20-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 20
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 23:28:04,731] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o20-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 20
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o20-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 24/9741 [00:00<00:40, 239.50it/s]  1%|▎                                                     | 49/9741 [00:00<00:40, 239.98it/s]  1%|▍                                                     | 74/9741 [00:00<00:40, 240.02it/s]  1%|▌                                                     | 99/9741 [00:00<00:40, 239.62it/s]  1%|▋                                                    | 123/9741 [00:00<00:40, 239.22it/s]  2%|▊                                                    | 147/9741 [00:00<00:40, 239.06it/s]  2%|▉                                                    | 171/9741 [00:00<00:40, 238.71it/s]  2%|█                                                    | 195/9741 [00:00<00:40, 234.59it/s]  2%|█▏                                                   | 219/9741 [00:00<00:40, 233.07it/s]  2%|█▎                                                   | 243/9741 [00:01<00:40, 234.02it/s]  3%|█▍                                                   | 267/9741 [00:01<00:40, 234.73it/s]  3%|█▌                                                   | 291/9741 [00:01<00:40, 234.81it/s]  3%|█▋                                                   | 315/9741 [00:01<00:40, 235.05it/s]  3%|█▊                                                   | 339/9741 [00:01<00:40, 234.60it/s]  4%|█▉                                                   | 363/9741 [00:01<00:40, 233.12it/s]  4%|██                                                   | 387/9741 [00:01<00:40, 232.51it/s]  4%|██▏                                                  | 411/9741 [00:01<00:40, 229.47it/s]  4%|██▎                                                  | 434/9741 [00:01<00:41, 226.84it/s]  5%|██▍                                                  | 459/9741 [00:01<00:40, 231.31it/s]  5%|██▋                                                  | 484/9741 [00:02<00:39, 234.07it/s]  5%|██▊                                                  | 509/9741 [00:02<00:39, 236.37it/s]  5%|██▉                                                  | 534/9741 [00:02<00:38, 238.00it/s]  6%|███                                                  | 559/9741 [00:02<00:38, 238.71it/s]  6%|███▏                                                 | 592/9741 [00:02<00:34, 263.93it/s]  6%|███▍                                                 | 629/9741 [00:02<00:31, 293.92it/s]  7%|███▌                                                 | 665/9741 [00:02<00:28, 313.01it/s]  7%|███▊                                                 | 702/9741 [00:02<00:27, 328.92it/s]  8%|████                                                 | 739/9741 [00:02<00:26, 339.89it/s]  8%|████▏                                                | 776/9741 [00:02<00:25, 347.38it/s]  8%|████▍                                                | 813/9741 [00:03<00:25, 352.95it/s]  9%|████▌                                                | 850/9741 [00:03<00:24, 356.96it/s]  9%|████▊                                                | 886/9741 [00:03<00:24, 357.62it/s]  9%|█████                                                | 923/9741 [00:03<00:24, 360.09it/s] 10%|█████▏                                               | 960/9741 [00:03<00:24, 362.12it/s] 10%|█████▍                                               | 997/9741 [00:03<00:24, 363.51it/s] 11%|█████▌                                              | 1034/9741 [00:03<00:23, 364.19it/s] 11%|█████▋                                              | 1071/9741 [00:03<00:23, 365.00it/s] 11%|█████▉                                              | 1108/9741 [00:03<00:23, 363.02it/s] 12%|██████                                              | 1145/9741 [00:03<00:23, 363.89it/s] 12%|██████▎                                             | 1182/9741 [00:04<00:23, 364.64it/s] 13%|██████▌                                             | 1219/9741 [00:04<00:23, 364.92it/s] 13%|██████▋                                             | 1256/9741 [00:04<00:23, 365.31it/s] 13%|██████▉                                             | 1293/9741 [00:04<00:23, 365.48it/s] 14%|███████                                             | 1330/9741 [00:04<00:22, 365.79it/s] 14%|███████▎                                            | 1367/9741 [00:04<00:23, 363.49it/s] 14%|███████▍                                            | 1404/9741 [00:04<00:22, 364.16it/s] 15%|███████▋                                            | 1441/9741 [00:04<00:22, 364.65it/s] 15%|███████▉                                            | 1478/9741 [00:04<00:22, 363.84it/s] 16%|████████                                            | 1515/9741 [00:05<00:22, 361.37it/s] 16%|████████▎                                           | 1552/9741 [00:05<00:22, 362.82it/s] 16%|████████▍                                           | 1589/9741 [00:05<00:22, 361.40it/s] 17%|████████▋                                           | 1626/9741 [00:05<00:22, 362.52it/s] 17%|████████▉                                           | 1663/9741 [00:05<00:22, 363.68it/s] 17%|█████████                                           | 1700/9741 [00:05<00:22, 364.41it/s] 18%|█████████▎                                          | 1737/9741 [00:05<00:21, 364.91it/s] 18%|█████████▍                                          | 1774/9741 [00:05<00:21, 363.45it/s] 19%|█████████▋                                          | 1811/9741 [00:05<00:23, 342.82it/s] 19%|█████████▊                                          | 1848/9741 [00:05<00:22, 349.38it/s] 19%|██████████                                          | 1885/9741 [00:06<00:22, 354.25it/s] 20%|██████████▎                                         | 1922/9741 [00:06<00:21, 357.56it/s] 20%|██████████▍                                         | 1959/9741 [00:06<00:21, 359.78it/s] 20%|██████████▋                                         | 1996/9741 [00:06<00:21, 361.73it/s] 21%|██████████▊                                         | 2033/9741 [00:06<00:21, 360.47it/s] 21%|███████████                                         | 2070/9741 [00:06<00:21, 361.67it/s] 22%|███████████▏                                        | 2107/9741 [00:06<00:21, 362.53it/s] 22%|███████████▍                                        | 2144/9741 [00:06<00:20, 363.36it/s] 22%|███████████▋                                        | 2181/9741 [00:06<00:20, 364.00it/s] 23%|███████████▊                                        | 2218/9741 [00:06<00:20, 361.58it/s] 23%|████████████                                        | 2255/9741 [00:07<00:20, 359.94it/s] 24%|████████████▏                                       | 2292/9741 [00:07<00:20, 361.60it/s] 24%|████████████▍                                       | 2329/9741 [00:07<00:20, 362.36it/s] 24%|████████████▋                                       | 2366/9741 [00:07<00:20, 363.65it/s] 25%|████████████▊                                       | 2403/9741 [00:07<00:20, 364.46it/s] 25%|█████████████                                       | 2440/9741 [00:07<00:19, 365.18it/s] 25%|█████████████▏                                      | 2477/9741 [00:07<00:19, 363.23it/s] 26%|█████████████▍                                      | 2514/9741 [00:07<00:19, 364.00it/s] 26%|█████████████▌                                      | 2551/9741 [00:07<00:19, 364.12it/s] 27%|█████████████▊                                      | 2588/9741 [00:07<00:19, 364.85it/s] 27%|██████████████                                      | 2625/9741 [00:08<00:19, 365.18it/s] 27%|██████████████▏                                     | 2662/9741 [00:08<00:19, 365.00it/s] 28%|██████████████▍                                     | 2699/9741 [00:08<00:19, 359.83it/s] 28%|██████████████▌                                     | 2736/9741 [00:08<00:19, 361.41it/s] 28%|██████████████▊                                     | 2773/9741 [00:08<00:19, 362.73it/s] 29%|███████████████                                     | 2810/9741 [00:08<00:19, 363.66it/s] 29%|███████████████▏                                    | 2847/9741 [00:08<00:18, 364.48it/s] 30%|███████████████▍                                    | 2884/9741 [00:08<00:18, 365.10it/s] 30%|███████████████▌                                    | 2921/9741 [00:08<00:18, 365.52it/s] 30%|███████████████▊                                    | 2958/9741 [00:08<00:18, 362.18it/s] 31%|███████████████▉                                    | 2995/9741 [00:09<00:18, 363.07it/s] 31%|████████████████▏                                   | 3032/9741 [00:09<00:18, 363.39it/s] 32%|████████████████▍                                   | 3069/9741 [00:09<00:18, 363.67it/s] 32%|████████████████▌                                   | 3106/9741 [00:09<00:18, 352.23it/s] 32%|████████████████▊                                   | 3143/9741 [00:09<00:18, 355.94it/s] 33%|████████████████▉                                   | 3179/9741 [00:09<00:18, 353.85it/s] 33%|█████████████████▏                                  | 3216/9741 [00:09<00:18, 357.17it/s] 33%|█████████████████▎                                  | 3253/9741 [00:09<00:18, 359.95it/s] 34%|█████████████████▌                                  | 3290/9741 [00:09<00:17, 361.58it/s] 34%|█████████████████▊                                  | 3327/9741 [00:10<00:17, 361.80it/s] 35%|█████████████████▉                                  | 3364/9741 [00:10<00:17, 362.87it/s] 35%|██████████████████▏                                 | 3401/9741 [00:10<00:17, 361.39it/s] 35%|██████████████████▎                                 | 3438/9741 [00:10<00:17, 362.39it/s] 36%|██████████████████▌                                 | 3475/9741 [00:10<00:17, 363.11it/s] 36%|██████████████████▋                                 | 3512/9741 [00:10<00:17, 363.30it/s] 36%|██████████████████▉                                 | 3549/9741 [00:10<00:17, 364.05it/s] 37%|███████████████████▏                                | 3586/9741 [00:10<00:16, 364.15it/s] 37%|███████████████████▎                                | 3623/9741 [00:10<00:16, 362.22it/s] 38%|███████████████████▌                                | 3660/9741 [00:10<00:16, 362.99it/s] 38%|███████████████████▋                                | 3697/9741 [00:11<00:16, 362.80it/s] 38%|███████████████████▉                                | 3734/9741 [00:11<00:16, 363.91it/s] 39%|████████████████████▏                               | 3771/9741 [00:11<00:16, 364.34it/s] 39%|████████████████████▎                               | 3808/9741 [00:11<00:16, 364.65it/s] 39%|████████████████████▌                               | 3845/9741 [00:11<00:16, 362.68it/s] 40%|████████████████████▋                               | 3882/9741 [00:11<00:16, 363.60it/s] 40%|████████████████████▉                               | 3919/9741 [00:11<00:15, 364.16it/s] 41%|█████████████████████                               | 3956/9741 [00:11<00:15, 364.48it/s] 41%|█████████████████████▎                              | 3993/9741 [00:11<00:15, 364.86it/s] 41%|█████████████████████▌                              | 4030/9741 [00:11<00:15, 365.33it/s] 42%|█████████████████████▋                              | 4067/9741 [00:12<00:15, 363.16it/s] 42%|█████████████████████▉                              | 4104/9741 [00:12<00:15, 363.93it/s] 43%|██████████████████████                              | 4141/9741 [00:12<00:15, 362.65it/s] 43%|██████████████████████▎                             | 4178/9741 [00:12<00:15, 363.19it/s] 43%|██████████████████████▌                             | 4215/9741 [00:12<00:15, 363.37it/s] 44%|██████████████████████▋                             | 4252/9741 [00:12<00:15, 363.70it/s] 44%|██████████████████████▉                             | 4289/9741 [00:12<00:15, 361.85it/s] 44%|███████████████████████                             | 4326/9741 [00:12<00:14, 362.74it/s] 45%|███████████████████████▎                            | 4363/9741 [00:12<00:14, 363.42it/s] 45%|███████████████████████▍                            | 4400/9741 [00:12<00:14, 363.83it/s] 46%|███████████████████████▋                            | 4437/9741 [00:13<00:14, 363.12it/s] 46%|███████████████████████▉                            | 4474/9741 [00:13<00:14, 363.43it/s] 46%|████████████████████████                            | 4511/9741 [00:13<00:14, 363.82it/s] 47%|████████████████████████▎                           | 4548/9741 [00:13<00:15, 325.52it/s] 47%|████████████████████████▍                           | 4585/9741 [00:13<00:15, 336.32it/s] 47%|████████████████████████▋                           | 4622/9741 [00:13<00:14, 344.51it/s] 48%|████████████████████████▊                           | 4659/9741 [00:13<00:14, 350.28it/s] 48%|█████████████████████████                           | 4696/9741 [00:13<00:14, 354.40it/s] 49%|█████████████████████████▎                          | 4732/9741 [00:13<00:14, 355.76it/s] 49%|█████████████████████████▍                          | 4768/9741 [00:14<00:20, 243.80it/s] 49%|█████████████████████████▋                          | 4805/9741 [00:14<00:18, 270.91it/s] 50%|█████████████████████████▊                          | 4842/9741 [00:14<00:16, 293.66it/s] 50%|██████████████████████████                          | 4879/9741 [00:14<00:15, 311.70it/s] 50%|██████████████████████████▏                         | 4916/9741 [00:14<00:14, 326.04it/s] 51%|██████████████████████████▍                         | 4952/9741 [00:14<00:14, 334.10it/s] 51%|██████████████████████████▋                         | 4989/9741 [00:14<00:13, 342.94it/s] 52%|██████████████████████████▊                         | 5026/9741 [00:14<00:13, 349.24it/s] 52%|███████████████████████████                         | 5063/9741 [00:14<00:13, 354.01it/s] 52%|███████████████████████████▏                        | 5100/9741 [00:15<00:13, 356.92it/s] 53%|███████████████████████████▍                        | 5137/9741 [00:15<00:12, 359.33it/s] 53%|███████████████████████████▌                        | 5174/9741 [00:15<00:12, 359.14it/s] 53%|███████████████████████████▊                        | 5211/9741 [00:15<00:12, 360.82it/s] 54%|████████████████████████████                        | 5248/9741 [00:15<00:12, 362.16it/s] 54%|████████████████████████████▏                       | 5285/9741 [00:15<00:12, 362.61it/s] 55%|████████████████████████████▍                       | 5322/9741 [00:15<00:12, 363.29it/s] 55%|████████████████████████████▌                       | 5359/9741 [00:15<00:12, 363.55it/s] 55%|████████████████████████████▊                       | 5396/9741 [00:15<00:11, 364.18it/s] 56%|█████████████████████████████                       | 5433/9741 [00:16<00:11, 362.62it/s] 56%|█████████████████████████████▏                      | 5470/9741 [00:16<00:11, 363.50it/s] 57%|█████████████████████████████▍                      | 5508/9741 [00:16<00:11, 367.28it/s] 57%|█████████████████████████████▌                      | 5546/9741 [00:16<00:11, 370.30it/s] 57%|█████████████████████████████▊                      | 5584/9741 [00:16<00:11, 372.15it/s] 58%|██████████████████████████████                      | 5622/9741 [00:16<00:11, 373.35it/s] 58%|██████████████████████████████▏                     | 5660/9741 [00:16<00:10, 372.09it/s] 58%|██████████████████████████████▍                     | 5698/9741 [00:16<00:10, 373.40it/s] 59%|██████████████████████████████▌                     | 5736/9741 [00:16<00:10, 374.29it/s] 59%|██████████████████████████████▊                     | 5774/9741 [00:16<00:10, 374.96it/s] 60%|███████████████████████████████                     | 5812/9741 [00:17<00:10, 375.59it/s] 60%|███████████████████████████████▏                    | 5850/9741 [00:17<00:10, 375.16it/s] 60%|███████████████████████████████▍                    | 5888/9741 [00:17<00:10, 373.54it/s] 61%|███████████████████████████████▋                    | 5926/9741 [00:17<00:10, 373.86it/s] 61%|███████████████████████████████▊                    | 5964/9741 [00:17<00:10, 374.81it/s] 62%|████████████████████████████████                    | 6002/9741 [00:17<00:09, 375.23it/s] 62%|████████████████████████████████▏                   | 6040/9741 [00:17<00:09, 375.70it/s] 62%|████████████████████████████████▍                   | 6078/9741 [00:17<00:09, 373.77it/s] 63%|████████████████████████████████▋                   | 6116/9741 [00:17<00:09, 374.56it/s] 63%|████████████████████████████████▊                   | 6154/9741 [00:17<00:09, 374.67it/s] 64%|█████████████████████████████████                   | 6192/9741 [00:18<00:09, 375.30it/s] 64%|█████████████████████████████████▎                  | 6230/9741 [00:18<00:09, 375.18it/s] 64%|█████████████████████████████████▍                  | 6268/9741 [00:18<00:09, 375.10it/s] 65%|█████████████████████████████████▋                  | 6306/9741 [00:18<00:09, 373.26it/s] 65%|█████████████████████████████████▊                  | 6344/9741 [00:18<00:09, 374.11it/s] 66%|██████████████████████████████████                  | 6382/9741 [00:18<00:08, 374.76it/s] 66%|██████████████████████████████████▎                 | 6420/9741 [00:18<00:08, 375.07it/s] 66%|██████████████████████████████████▍                 | 6458/9741 [00:18<00:08, 375.19it/s] 67%|██████████████████████████████████▋                 | 6496/9741 [00:18<00:08, 375.16it/s] 67%|██████████████████████████████████▉                 | 6534/9741 [00:18<00:08, 372.83it/s] 67%|███████████████████████████████████                 | 6572/9741 [00:19<00:08, 371.08it/s] 68%|███████████████████████████████████▎                | 6610/9741 [00:19<00:08, 371.48it/s] 68%|███████████████████████████████████▍                | 6648/9741 [00:19<00:08, 372.48it/s] 69%|███████████████████████████████████▋                | 6686/9741 [00:19<00:08, 373.36it/s] 69%|███████████████████████████████████▉                | 6724/9741 [00:19<00:08, 373.67it/s] 69%|████████████████████████████████████                | 6762/9741 [00:19<00:07, 372.46it/s] 70%|████████████████████████████████████▎               | 6800/9741 [00:19<00:07, 373.42it/s] 70%|████████████████████████████████████▌               | 6838/9741 [00:19<00:07, 374.01it/s] 71%|████████████████████████████████████▋               | 6876/9741 [00:19<00:07, 374.42it/s] 71%|████████████████████████████████████▉               | 6914/9741 [00:19<00:07, 374.63it/s] 71%|█████████████████████████████████████               | 6952/9741 [00:20<00:07, 374.91it/s] 72%|█████████████████████████████████████▎              | 6990/9741 [00:20<00:07, 372.98it/s] 72%|█████████████████████████████████████▌              | 7028/9741 [00:20<00:07, 373.67it/s] 73%|█████████████████████████████████████▋              | 7066/9741 [00:20<00:07, 374.33it/s] 73%|█████████████████████████████████████▉              | 7104/9741 [00:20<00:07, 374.56it/s] 73%|██████████████████████████████████████▏             | 7142/9741 [00:20<00:06, 374.89it/s] 74%|██████████████████████████████████████▎             | 7180/9741 [00:20<00:06, 371.80it/s] 74%|██████████████████████████████████████▌             | 7218/9741 [00:20<00:06, 370.00it/s] 74%|██████████████████████████████████████▋             | 7256/9741 [00:20<00:06, 371.35it/s] 75%|██████████████████████████████████████▉             | 7294/9741 [00:20<00:06, 372.42it/s] 75%|███████████████████████████████████████▏            | 7332/9741 [00:21<00:06, 371.64it/s] 76%|███████████████████████████████████████▎            | 7370/9741 [00:21<00:06, 372.71it/s] 76%|███████████████████████████████████████▌            | 7408/9741 [00:21<00:06, 372.98it/s] 76%|███████████████████████████████████████▋            | 7446/9741 [00:21<00:06, 346.81it/s] 77%|███████████████████████████████████████▉            | 7484/9741 [00:21<00:06, 354.65it/s] 77%|████████████████████████████████████████▏           | 7522/9741 [00:21<00:06, 360.01it/s] 78%|████████████████████████████████████████▎           | 7560/9741 [00:21<00:05, 363.78it/s] 78%|████████████████████████████████████████▌           | 7598/9741 [00:21<00:05, 366.89it/s] 78%|████████████████████████████████████████▊           | 7636/9741 [00:21<00:05, 369.11it/s] 79%|████████████████████████████████████████▉           | 7674/9741 [00:22<00:05, 368.43it/s] 79%|█████████████████████████████████████████▏          | 7712/9741 [00:22<00:05, 370.48it/s] 80%|█████████████████████████████████████████▎          | 7750/9741 [00:22<00:05, 372.22it/s] 80%|█████████████████████████████████████████▌          | 7788/9741 [00:22<00:05, 372.72it/s] 80%|█████████████████████████████████████████▊          | 7826/9741 [00:22<00:05, 370.13it/s] 81%|█████████████████████████████████████████▉          | 7864/9741 [00:22<00:05, 371.14it/s] 81%|██████████████████████████████████████████▏         | 7902/9741 [00:22<00:04, 368.68it/s] 82%|██████████████████████████████████████████▍         | 7940/9741 [00:22<00:04, 370.31it/s] 82%|██████████████████████████████████████████▌         | 7978/9741 [00:22<00:04, 371.47it/s] 82%|██████████████████████████████████████████▊         | 8016/9741 [00:22<00:04, 372.30it/s] 83%|██████████████████████████████████████████▉         | 8054/9741 [00:23<00:04, 372.14it/s] 83%|███████████████████████████████████████████▏        | 8092/9741 [00:23<00:04, 372.56it/s] 83%|███████████████████████████████████████████▍        | 8130/9741 [00:23<00:04, 371.28it/s] 84%|███████████████████████████████████████████▌        | 8168/9741 [00:23<00:04, 372.24it/s] 84%|███████████████████████████████████████████▊        | 8206/9741 [00:23<00:04, 372.80it/s] 85%|████████████████████████████████████████████        | 8244/9741 [00:23<00:04, 373.45it/s] 85%|████████████████████████████████████████████▏       | 8282/9741 [00:23<00:03, 373.40it/s] 85%|████████████████████████████████████████████▍       | 8320/9741 [00:23<00:03, 372.89it/s] 86%|████████████████████████████████████████████▌       | 8358/9741 [00:23<00:03, 371.16it/s] 86%|████████████████████████████████████████████▊       | 8396/9741 [00:23<00:03, 371.96it/s] 87%|█████████████████████████████████████████████       | 8434/9741 [00:24<00:03, 370.34it/s] 87%|█████████████████████████████████████████████▏      | 8472/9741 [00:24<00:03, 371.31it/s] 87%|█████████████████████████████████████████████▍      | 8510/9741 [00:24<00:03, 372.38it/s] 88%|█████████████████████████████████████████████▋      | 8548/9741 [00:24<00:03, 372.70it/s] 88%|█████████████████████████████████████████████▊      | 8586/9741 [00:24<00:03, 371.12it/s] 89%|██████████████████████████████████████████████      | 8624/9741 [00:24<00:03, 371.84it/s] 89%|██████████████████████████████████████████████▏     | 8662/9741 [00:24<00:02, 372.45it/s] 89%|██████████████████████████████████████████████▍     | 8700/9741 [00:24<00:02, 373.16it/s] 90%|██████████████████████████████████████████████▋     | 8738/9741 [00:24<00:02, 373.26it/s] 90%|██████████████████████████████████████████████▊     | 8776/9741 [00:25<00:02, 373.44it/s] 90%|███████████████████████████████████████████████     | 8814/9741 [00:25<00:02, 370.96it/s] 91%|███████████████████████████████████████████████▎    | 8852/9741 [00:25<00:02, 371.20it/s] 91%|███████████████████████████████████████████████▍    | 8890/9741 [00:25<00:02, 372.27it/s] 92%|███████████████████████████████████████████████▋    | 8928/9741 [00:25<00:02, 373.32it/s] 92%|███████████████████████████████████████████████▊    | 8966/9741 [00:25<00:02, 373.71it/s] 92%|████████████████████████████████████████████████    | 9004/9741 [00:25<00:01, 373.84it/s] 93%|████████████████████████████████████████████████▎   | 9042/9741 [00:25<00:01, 371.94it/s] 93%|████████████████████████████████████████████████▍   | 9080/9741 [00:25<00:01, 370.62it/s] 94%|████████████████████████████████████████████████▋   | 9118/9741 [00:25<00:01, 371.61it/s] 94%|████████████████████████████████████████████████▉   | 9156/9741 [00:26<00:01, 372.50it/s] 94%|█████████████████████████████████████████████████   | 9194/9741 [00:26<00:01, 373.21it/s] 95%|█████████████████████████████████████████████████▎  | 9232/9741 [00:26<00:01, 373.19it/s] 95%|█████████████████████████████████████████████████▍  | 9270/9741 [00:26<00:01, 371.29it/s] 96%|█████████████████████████████████████████████████▋  | 9308/9741 [00:26<00:01, 372.12it/s] 96%|█████████████████████████████████████████████████▉  | 9346/9741 [00:26<00:01, 372.75it/s] 96%|██████████████████████████████████████████████████  | 9384/9741 [00:26<00:00, 373.38it/s] 97%|██████████████████████████████████████████████████▎ | 9422/9741 [00:26<00:00, 373.40it/s] 97%|██████████████████████████████████████████████████▍ | 9460/9741 [00:26<00:00, 373.54it/s] 98%|██████████████████████████████████████████████████▋ | 9498/9741 [00:26<00:00, 371.48it/s] 98%|██████████████████████████████████████████████████▉ | 9536/9741 [00:27<00:00, 372.37it/s] 98%|███████████████████████████████████████████████████ | 9574/9741 [00:27<00:00, 372.53it/s] 99%|███████████████████████████████████████████████████▎| 9612/9741 [00:27<00:00, 372.69it/s] 99%|███████████████████████████████████████████████████▌| 9650/9741 [00:27<00:00, 372.49it/s] 99%|███████████████████████████████████████████████████▋| 9688/9741 [00:27<00:00, 372.76it/s]100%|███████████████████████████████████████████████████▉| 9726/9741 [00:27<00:00, 370.11it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:27<00:00, 353.01it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.36s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.43s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.63s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:06<00:12,  6.38s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.26s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.53s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.50s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:12<00:06,  6.01s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.87s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.89s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.06s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.89s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.07s/it]
[2023-08-21 23:29:25,194] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.41s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.61s/it]
[2023-08-21 23:29:38,961] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 23:29:38,961] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 23:29:38,962] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 23:29:38,962] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 23:29:38,962] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 23:29:38,962] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fa353752fd0>
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fa34fdd8220>
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 23:29:38,963] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 23:29:38,964] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 23:29:38,964] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5895695686340332 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input: Noah, who loves his Grammy, calls her every week to talk about his day. If each call lasts 30 minutes and he is charged $0.05 per call minute, how much would he be billed if he makes the calls for a year?
Output: 78

Input: A merchant bought 15 keyboards and 25 printers for a total of $2050. If a keyboard costs $20, how much does a printer cost?
Output: 70

Input: Gina has two bank accounts. Each account has a quarter of the balance in Betty's account. If Betty's account balance is $3,456, what is the combined balance of both Gina's accounts?
Output: 1728

Input: Zain has 10 more of each coin than Emerie. If Emerie has six quarters, seven dimes, and five nickels, how many coins does Zain have?
Output: 48

Input: Adonis is playing a prank on his dad by replacing his shampoo with hot sauce. Every day, after his dad showers, Adonis replaces the shampoo with 1/2 an ounce of hot sauce. He knows his dad uses 1 oz of shampoo a day from a new 10 oz bottle that no one else uses. After 4 days, what percentage of the liquid in the bottle is hot sauce?
Output: 25

Input: Lana and Mike are taking their dog and renting a cabin in the mountains for 2 weeks.  The daily rate is $125.00  There is a $100.00 pet fee.  There is also a 20% service/cleaning fee for the rental.  They need to pay 50% of the entire bill as a security deposit.  How much is their security deposit?
Output: 1110

Input: Abigail is trying a new recipe for a cold drink. It uses 1/4 of a cup of iced tea and 1 and 1/4 of a cup of lemonade to make one drink. If she fills a pitcher with 18 total cups of this drink, how many cups of lemonade are in the pitcher?
Output: 15

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o20-tgsm8k-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.40396904945373535 seconds
Loading extension module utils...
Time to load utils op: 0.6048383712768555 seconds
Loading extension module utils...
Time to load utils op: 0.6045973300933838 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 3451647 closing signal SIGTERM
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3451646) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_23:29:47
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3451648)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-21_23:29:47
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3451649)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_23:29:47
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3451646)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o21-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 21
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[2023-08-21 23:29:51,597] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o21-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 21
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o21-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 35/9741 [00:00<00:27, 349.54it/s]  1%|▍                                                     | 71/9741 [00:00<00:27, 351.25it/s]  1%|▌                                                    | 107/9741 [00:00<00:27, 351.23it/s]  1%|▊                                                    | 143/9741 [00:00<00:27, 350.32it/s]  2%|▉                                                    | 179/9741 [00:00<00:27, 350.93it/s]  2%|█▏                                                   | 215/9741 [00:00<00:27, 349.06it/s]  3%|█▎                                                   | 251/9741 [00:00<00:27, 349.93it/s]  3%|█▌                                                   | 286/9741 [00:00<00:27, 346.14it/s]  3%|█▊                                                   | 322/9741 [00:00<00:27, 347.67it/s]  4%|█▉                                                   | 357/9741 [00:01<00:26, 347.87it/s]  4%|██▏                                                  | 393/9741 [00:01<00:26, 348.95it/s]  4%|██▎                                                  | 428/9741 [00:01<00:26, 347.05it/s]  5%|██▌                                                  | 464/9741 [00:01<00:26, 348.62it/s]  5%|██▋                                                  | 500/9741 [00:01<00:26, 349.23it/s]  5%|██▉                                                  | 535/9741 [00:01<00:26, 349.37it/s]  6%|███                                                  | 571/9741 [00:01<00:26, 349.64it/s]  6%|███▎                                                 | 607/9741 [00:01<00:26, 349.87it/s]  7%|███▍                                                 | 642/9741 [00:01<00:26, 346.66it/s]  7%|███▋                                                 | 677/9741 [00:01<00:26, 343.86it/s]  7%|███▉                                                 | 713/9741 [00:02<00:26, 345.86it/s]  8%|████                                                 | 749/9741 [00:02<00:25, 347.38it/s]  8%|████▎                                                | 785/9741 [00:02<00:25, 348.78it/s]  8%|████▍                                                | 821/9741 [00:02<00:25, 349.68it/s]  9%|████▋                                                | 857/9741 [00:02<00:25, 350.13it/s]  9%|████▊                                                | 893/9741 [00:02<00:26, 337.67it/s] 10%|█████                                                | 929/9741 [00:02<00:25, 341.63it/s] 10%|█████▎                                               | 965/9741 [00:02<00:25, 344.50it/s] 10%|█████▎                                              | 1001/9741 [00:02<00:25, 346.51it/s] 11%|█████▌                                              | 1037/9741 [00:02<00:25, 347.85it/s] 11%|█████▋                                              | 1072/9741 [00:03<00:24, 347.91it/s] 11%|█████▉                                              | 1107/9741 [00:03<00:24, 347.90it/s] 12%|██████                                              | 1142/9741 [00:03<00:24, 346.05it/s] 12%|██████▎                                             | 1177/9741 [00:03<00:24, 346.79it/s] 12%|██████▍                                             | 1212/9741 [00:03<00:24, 347.09it/s] 13%|██████▋                                             | 1247/9741 [00:03<00:24, 347.17it/s] 13%|██████▊                                             | 1282/9741 [00:03<00:24, 347.70it/s] 14%|███████                                             | 1318/9741 [00:03<00:24, 348.56it/s] 14%|███████▏                                            | 1353/9741 [00:03<00:24, 346.93it/s] 14%|███████▍                                            | 1388/9741 [00:03<00:24, 347.37it/s] 15%|███████▌                                            | 1424/9741 [00:04<00:23, 348.77it/s] 15%|███████▊                                            | 1460/9741 [00:04<00:23, 349.45it/s] 15%|███████▉                                            | 1496/9741 [00:04<00:23, 349.85it/s] 16%|████████▏                                           | 1532/9741 [00:04<00:23, 349.87it/s] 16%|████████▎                                           | 1567/9741 [00:04<00:23, 347.59it/s] 16%|████████▌                                           | 1602/9741 [00:04<00:23, 347.19it/s] 17%|████████▋                                           | 1637/9741 [00:04<00:23, 345.87it/s] 17%|████████▉                                           | 1672/9741 [00:04<00:23, 346.60it/s] 18%|█████████                                           | 1707/9741 [00:04<00:23, 346.72it/s] 18%|█████████▎                                          | 1742/9741 [00:05<00:23, 346.30it/s] 18%|█████████▍                                          | 1777/9741 [00:05<00:22, 346.68it/s] 19%|█████████▋                                          | 1812/9741 [00:05<00:24, 324.87it/s] 19%|█████████▊                                          | 1847/9741 [00:05<00:23, 330.80it/s] 19%|██████████                                          | 1882/9741 [00:05<00:23, 335.59it/s] 20%|██████████▏                                         | 1917/9741 [00:05<00:23, 339.18it/s] 20%|██████████▍                                         | 1952/9741 [00:05<00:22, 341.33it/s] 20%|██████████▌                                         | 1987/9741 [00:05<00:22, 340.67it/s] 21%|██████████▊                                         | 2022/9741 [00:05<00:22, 339.93it/s] 21%|██████████▉                                         | 2057/9741 [00:05<00:22, 341.42it/s] 21%|███████████▏                                        | 2092/9741 [00:06<00:22, 342.25it/s] 22%|███████████▎                                        | 2127/9741 [00:06<00:22, 343.04it/s] 22%|███████████▌                                        | 2162/9741 [00:06<00:22, 343.80it/s] 23%|███████████▋                                        | 2197/9741 [00:06<00:21, 344.28it/s] 23%|███████████▉                                        | 2232/9741 [00:06<00:21, 344.61it/s] 23%|████████████                                        | 2267/9741 [00:06<00:21, 342.50it/s] 24%|████████████▎                                       | 2302/9741 [00:06<00:21, 343.19it/s] 24%|████████████▍                                       | 2337/9741 [00:06<00:21, 343.24it/s] 24%|████████████▋                                       | 2372/9741 [00:06<00:21, 343.55it/s] 25%|████████████▊                                       | 2407/9741 [00:06<00:21, 344.24it/s] 25%|█████████████                                       | 2442/9741 [00:07<00:21, 341.70it/s] 25%|█████████████▏                                      | 2477/9741 [00:07<00:21, 340.70it/s] 26%|█████████████▍                                      | 2512/9741 [00:07<00:21, 342.27it/s] 26%|█████████████▌                                      | 2547/9741 [00:07<00:20, 342.86it/s] 27%|█████████████▊                                      | 2582/9741 [00:07<00:20, 344.07it/s] 27%|█████████████▉                                      | 2617/9741 [00:07<00:20, 345.04it/s] 27%|██████████████▏                                     | 2652/9741 [00:07<00:20, 345.36it/s] 28%|██████████████▎                                     | 2687/9741 [00:07<00:20, 345.15it/s] 28%|██████████████▌                                     | 2722/9741 [00:07<00:20, 343.30it/s] 28%|██████████████▋                                     | 2757/9741 [00:07<00:20, 344.50it/s] 29%|██████████████▉                                     | 2792/9741 [00:08<00:20, 345.20it/s] 29%|███████████████                                     | 2827/9741 [00:08<00:19, 345.92it/s] 29%|███████████████▎                                    | 2862/9741 [00:08<00:19, 346.53it/s] 30%|███████████████▍                                    | 2897/9741 [00:08<00:19, 344.31it/s] 30%|███████████████▋                                    | 2932/9741 [00:08<00:19, 343.30it/s] 30%|███████████████▊                                    | 2967/9741 [00:08<00:19, 344.49it/s] 31%|████████████████                                    | 3002/9741 [00:08<00:19, 345.81it/s] 31%|████████████████▏                                   | 3037/9741 [00:08<00:19, 346.44it/s] 32%|████████████████▍                                   | 3072/9741 [00:08<00:19, 346.60it/s] 32%|████████████████▌                                   | 3107/9741 [00:08<00:19, 346.66it/s] 32%|████████████████▊                                   | 3142/9741 [00:09<00:19, 346.48it/s] 33%|████████████████▉                                   | 3177/9741 [00:09<00:19, 344.77it/s] 33%|█████████████████▏                                  | 3212/9741 [00:09<00:18, 345.88it/s] 33%|█████████████████▎                                  | 3247/9741 [00:09<00:18, 346.86it/s] 34%|█████████████████▌                                  | 3282/9741 [00:09<00:18, 347.07it/s] 34%|█████████████████▋                                  | 3317/9741 [00:09<00:18, 347.29it/s] 34%|█████████████████▉                                  | 3352/9741 [00:09<00:18, 344.79it/s] 35%|██████████████████                                  | 3387/9741 [00:09<00:18, 341.65it/s] 35%|██████████████████▎                                 | 3422/9741 [00:09<00:18, 343.56it/s] 35%|██████████████████▍                                 | 3457/9741 [00:10<00:18, 343.24it/s] 36%|██████████████████▋                                 | 3492/9741 [00:10<00:18, 344.32it/s] 36%|██████████████████▊                                 | 3527/9741 [00:10<00:17, 345.32it/s] 37%|███████████████████                                 | 3563/9741 [00:10<00:17, 347.49it/s] 37%|███████████████████▏                                | 3599/9741 [00:10<00:17, 348.95it/s] 37%|███████████████████▍                                | 3634/9741 [00:10<00:17, 348.20it/s] 38%|███████████████████▌                                | 3670/9741 [00:10<00:17, 349.51it/s] 38%|███████████████████▊                                | 3706/9741 [00:10<00:17, 350.83it/s] 38%|███████████████████▉                                | 3742/9741 [00:10<00:17, 351.71it/s] 39%|████████████████████▏                               | 3778/9741 [00:10<00:16, 352.28it/s] 39%|████████████████████▎                               | 3814/9741 [00:11<00:16, 352.28it/s] 40%|████████████████████▌                               | 3850/9741 [00:11<00:16, 349.18it/s] 40%|████████████████████▋                               | 3886/9741 [00:11<00:16, 350.06it/s] 40%|████████████████████▉                               | 3922/9741 [00:11<00:16, 350.77it/s] 41%|█████████████████████▏                              | 3958/9741 [00:11<00:16, 351.46it/s] 41%|█████████████████████▎                              | 3994/9741 [00:11<00:16, 352.16it/s] 41%|█████████████████████▌                              | 4030/9741 [00:11<00:16, 352.75it/s] 42%|█████████████████████▋                              | 4066/9741 [00:11<00:16, 350.65it/s] 42%|█████████████████████▉                              | 4102/9741 [00:11<00:16, 351.64it/s] 42%|██████████████████████                              | 4138/9741 [00:11<00:15, 352.29it/s] 43%|██████████████████████▎                             | 4174/9741 [00:12<00:15, 352.27it/s] 43%|██████████████████████▍                             | 4210/9741 [00:12<00:15, 352.49it/s] 44%|██████████████████████▋                             | 4246/9741 [00:12<00:15, 350.36it/s] 44%|██████████████████████▊                             | 4282/9741 [00:12<00:15, 350.98it/s] 44%|███████████████████████                             | 4318/9741 [00:12<00:15, 349.47it/s] 45%|███████████████████████▏                            | 4354/9741 [00:12<00:15, 350.52it/s] 45%|███████████████████████▍                            | 4390/9741 [00:12<00:15, 351.30it/s] 45%|███████████████████████▋                            | 4426/9741 [00:12<00:15, 351.72it/s] 46%|███████████████████████▊                            | 4462/9741 [00:12<00:15, 351.93it/s] 46%|████████████████████████                            | 4498/9741 [00:12<00:14, 351.73it/s] 47%|████████████████████████▏                           | 4534/9741 [00:13<00:16, 312.61it/s] 47%|████████████████████████▍                           | 4570/9741 [00:13<00:16, 323.18it/s] 47%|████████████████████████▌                           | 4606/9741 [00:13<00:15, 331.44it/s] 48%|████████████████████████▊                           | 4642/9741 [00:13<00:15, 337.23it/s] 48%|████████████████████████▉                           | 4678/9741 [00:13<00:14, 341.59it/s] 48%|█████████████████████████▏                          | 4714/9741 [00:13<00:14, 344.82it/s] 49%|█████████████████████████▎                          | 4749/9741 [00:13<00:21, 237.39it/s] 49%|█████████████████████████▌                          | 4784/9741 [00:13<00:18, 261.44it/s] 49%|█████████████████████████▋                          | 4819/9741 [00:14<00:17, 282.69it/s] 50%|█████████████████████████▉                          | 4855/9741 [00:14<00:16, 300.58it/s] 50%|██████████████████████████                          | 4891/9741 [00:14<00:15, 314.03it/s] 51%|██████████████████████████▎                         | 4927/9741 [00:14<00:14, 324.51it/s] 51%|██████████████████████████▍                         | 4962/9741 [00:14<00:14, 330.13it/s] 51%|██████████████████████████▋                         | 4998/9741 [00:14<00:14, 336.64it/s] 52%|██████████████████████████▊                         | 5034/9741 [00:14<00:13, 341.35it/s] 52%|███████████████████████████                         | 5070/9741 [00:14<00:13, 344.14it/s] 52%|███████████████████████████▎                        | 5105/9741 [00:14<00:13, 345.80it/s] 53%|███████████████████████████▍                        | 5141/9741 [00:15<00:13, 347.73it/s] 53%|███████████████████████████▋                        | 5176/9741 [00:15<00:13, 346.67it/s] 54%|███████████████████████████▊                        | 5212/9741 [00:15<00:13, 348.38it/s] 54%|████████████████████████████                        | 5248/9741 [00:15<00:12, 348.94it/s] 54%|████████████████████████████▏                       | 5284/9741 [00:15<00:12, 349.86it/s] 55%|████████████████████████████▍                       | 5320/9741 [00:15<00:12, 350.04it/s] 55%|████████████████████████████▌                       | 5356/9741 [00:15<00:12, 349.97it/s] 55%|████████████████████████████▊                       | 5392/9741 [00:15<00:12, 349.59it/s] 56%|████████████████████████████▉                       | 5427/9741 [00:15<00:12, 347.79it/s] 56%|█████████████████████████████▏                      | 5463/9741 [00:15<00:12, 349.45it/s] 56%|█████████████████████████████▎                      | 5500/9741 [00:16<00:12, 352.79it/s] 57%|█████████████████████████████▌                      | 5537/9741 [00:16<00:11, 355.84it/s] 57%|█████████████████████████████▊                      | 5574/9741 [00:16<00:11, 357.78it/s] 58%|█████████████████████████████▉                      | 5611/9741 [00:16<00:11, 358.93it/s] 58%|██████████████████████████████▏                     | 5647/9741 [00:16<00:11, 356.97it/s] 58%|██████████████████████████████▎                     | 5684/9741 [00:16<00:11, 358.85it/s] 59%|██████████████████████████████▌                     | 5721/9741 [00:16<00:11, 360.41it/s] 59%|██████████████████████████████▋                     | 5758/9741 [00:16<00:11, 360.73it/s] 59%|██████████████████████████████▉                     | 5795/9741 [00:16<00:10, 361.17it/s] 60%|███████████████████████████████▏                    | 5832/9741 [00:16<00:10, 360.96it/s] 60%|███████████████████████████████▎                    | 5869/9741 [00:17<00:10, 358.97it/s] 61%|███████████████████████████████▌                    | 5906/9741 [00:17<00:10, 359.85it/s] 61%|███████████████████████████████▋                    | 5943/9741 [00:17<00:10, 360.75it/s] 61%|███████████████████████████████▉                    | 5980/9741 [00:17<00:10, 360.59it/s] 62%|████████████████████████████████                    | 6017/9741 [00:17<00:10, 361.22it/s] 62%|████████████████████████████████▎                   | 6054/9741 [00:17<00:10, 361.66it/s] 63%|████████████████████████████████▌                   | 6091/9741 [00:17<00:10, 359.06it/s] 63%|████████████████████████████████▋                   | 6128/9741 [00:17<00:10, 360.25it/s] 63%|████████████████████████████████▉                   | 6165/9741 [00:17<00:09, 360.28it/s] 64%|█████████████████████████████████                   | 6202/9741 [00:17<00:09, 360.90it/s] 64%|█████████████████████████████████▎                  | 6239/9741 [00:18<00:09, 360.66it/s] 64%|█████████████████████████████████▌                  | 6276/9741 [00:18<00:09, 357.91it/s] 65%|█████████████████████████████████▋                  | 6312/9741 [00:18<00:09, 346.05it/s] 65%|█████████████████████████████████▉                  | 6349/9741 [00:18<00:09, 350.57it/s] 66%|██████████████████████████████████                  | 6386/9741 [00:18<00:09, 353.46it/s] 66%|██████████████████████████████████▎                 | 6423/9741 [00:18<00:09, 355.97it/s] 66%|██████████████████████████████████▍                 | 6459/9741 [00:18<00:09, 357.03it/s] 67%|██████████████████████████████████▋                 | 6496/9741 [00:18<00:09, 358.57it/s] 67%|██████████████████████████████████▊                 | 6532/9741 [00:18<00:08, 356.68it/s] 67%|███████████████████████████████████                 | 6568/9741 [00:19<00:08, 356.90it/s] 68%|███████████████████████████████████▎                | 6604/9741 [00:19<00:08, 356.56it/s] 68%|███████████████████████████████████▍                | 6640/9741 [00:19<00:08, 357.14it/s] 69%|███████████████████████████████████▋                | 6677/9741 [00:19<00:08, 358.60it/s] 69%|███████████████████████████████████▊                | 6713/9741 [00:19<00:08, 358.86it/s] 69%|████████████████████████████████████                | 6750/9741 [00:19<00:08, 360.14it/s] 70%|████████████████████████████████████▏               | 6787/9741 [00:19<00:08, 358.02it/s] 70%|████████████████████████████████████▍               | 6824/9741 [00:19<00:08, 359.25it/s] 70%|████████████████████████████████████▌               | 6860/9741 [00:19<00:08, 359.03it/s] 71%|████████████████████████████████████▊               | 6897/9741 [00:19<00:07, 359.88it/s] 71%|█████████████████████████████████████               | 6933/9741 [00:20<00:07, 359.83it/s] 72%|█████████████████████████████████████▏              | 6970/9741 [00:20<00:07, 360.72it/s] 72%|█████████████████████████████████████▍              | 7007/9741 [00:20<00:07, 358.10it/s] 72%|█████████████████████████████████████▌              | 7044/9741 [00:20<00:07, 359.32it/s] 73%|█████████████████████████████████████▊              | 7081/9741 [00:20<00:07, 359.68it/s] 73%|█████████████████████████████████████▉              | 7118/9741 [00:20<00:07, 360.21it/s] 73%|██████████████████████████████████████▏             | 7155/9741 [00:20<00:07, 360.45it/s] 74%|██████████████████████████████████████▍             | 7192/9741 [00:20<00:07, 358.27it/s] 74%|██████████████████████████████████████▌             | 7228/9741 [00:20<00:07, 356.68it/s] 75%|██████████████████████████████████████▊             | 7265/9741 [00:20<00:06, 358.28it/s] 75%|██████████████████████████████████████▉             | 7302/9741 [00:21<00:06, 359.03it/s] 75%|███████████████████████████████████████▏            | 7338/9741 [00:21<00:06, 359.19it/s] 76%|███████████████████████████████████████▎            | 7375/9741 [00:21<00:06, 360.42it/s] 76%|███████████████████████████████████████▌            | 7412/9741 [00:21<00:06, 360.79it/s] 76%|███████████████████████████████████████▊            | 7449/9741 [00:21<00:06, 334.35it/s] 77%|███████████████████████████████████████▉            | 7486/9741 [00:21<00:06, 341.86it/s] 77%|████████████████████████████████████████▏           | 7523/9741 [00:21<00:06, 347.19it/s] 78%|████████████████████████████████████████▎           | 7560/9741 [00:21<00:06, 351.48it/s] 78%|████████████████████████████████████████▌           | 7597/9741 [00:21<00:06, 354.39it/s] 78%|████████████████████████████████████████▊           | 7634/9741 [00:22<00:05, 356.15it/s] 79%|████████████████████████████████████████▉           | 7670/9741 [00:22<00:05, 355.16it/s] 79%|█████████████████████████████████████████▏          | 7707/9741 [00:22<00:05, 356.73it/s] 79%|█████████████████████████████████████████▎          | 7743/9741 [00:22<00:05, 357.47it/s] 80%|█████████████████████████████████████████▌          | 7779/9741 [00:22<00:05, 357.47it/s] 80%|█████████████████████████████████████████▋          | 7815/9741 [00:22<00:05, 344.88it/s] 81%|█████████████████████████████████████████▉          | 7852/9741 [00:22<00:05, 349.56it/s] 81%|██████████████████████████████████████████          | 7889/9741 [00:22<00:05, 352.72it/s] 81%|██████████████████████████████████████████▎         | 7925/9741 [00:22<00:05, 352.05it/s] 82%|██████████████████████████████████████████▌         | 7962/9741 [00:22<00:05, 355.05it/s] 82%|██████████████████████████████████████████▋         | 7999/9741 [00:23<00:04, 356.64it/s] 82%|██████████████████████████████████████████▉         | 8035/9741 [00:23<00:04, 357.39it/s] 83%|███████████████████████████████████████████         | 8071/9741 [00:23<00:04, 357.47it/s] 83%|███████████████████████████████████████████▎        | 8108/9741 [00:23<00:04, 358.92it/s] 84%|███████████████████████████████████████████▍        | 8144/9741 [00:23<00:04, 357.34it/s] 84%|███████████████████████████████████████████▋        | 8181/9741 [00:23<00:04, 358.40it/s] 84%|███████████████████████████████████████████▊        | 8217/9741 [00:23<00:04, 358.64it/s] 85%|████████████████████████████████████████████        | 8254/9741 [00:23<00:04, 359.35it/s] 85%|████████████████████████████████████████████▎       | 8290/9741 [00:23<00:04, 359.01it/s] 85%|████████████████████████████████████████████▍       | 8326/9741 [00:23<00:03, 359.13it/s] 86%|████████████████████████████████████████████▋       | 8362/9741 [00:24<00:03, 356.94it/s] 86%|████████████████████████████████████████████▊       | 8398/9741 [00:24<00:03, 355.44it/s] 87%|█████████████████████████████████████████████       | 8435/9741 [00:24<00:03, 357.37it/s] 87%|█████████████████████████████████████████████▏      | 8472/9741 [00:24<00:03, 358.30it/s] 87%|█████████████████████████████████████████████▍      | 8508/9741 [00:24<00:03, 358.50it/s] 88%|█████████████████████████████████████████████▌      | 8544/9741 [00:24<00:03, 358.24it/s] 88%|█████████████████████████████████████████████▊      | 8580/9741 [00:24<00:03, 356.40it/s] 88%|█████████████████████████████████████████████▉      | 8617/9741 [00:24<00:03, 357.53it/s] 89%|██████████████████████████████████████████████▏     | 8653/9741 [00:24<00:03, 358.08it/s] 89%|██████████████████████████████████████████████▍     | 8689/9741 [00:24<00:02, 358.21it/s] 90%|██████████████████████████████████████████████▌     | 8725/9741 [00:25<00:02, 358.66it/s] 90%|██████████████████████████████████████████████▊     | 8761/9741 [00:25<00:02, 358.05it/s] 90%|██████████████████████████████████████████████▉     | 8797/9741 [00:25<00:02, 356.68it/s] 91%|███████████████████████████████████████████████▏    | 8833/9741 [00:25<00:02, 355.40it/s] 91%|███████████████████████████████████████████████▎    | 8869/9741 [00:25<00:02, 355.99it/s] 91%|███████████████████████████████████████████████▌    | 8906/9741 [00:25<00:02, 357.30it/s] 92%|███████████████████████████████████████████████▋    | 8943/9741 [00:25<00:02, 358.39it/s] 92%|███████████████████████████████████████████████▉    | 8979/9741 [00:25<00:02, 358.17it/s] 93%|████████████████████████████████████████████████    | 9015/9741 [00:25<00:02, 355.91it/s] 93%|████████████████████████████████████████████████▎   | 9051/9741 [00:25<00:01, 354.29it/s] 93%|████████████████████████████████████████████████▌   | 9087/9741 [00:26<00:01, 355.81it/s] 94%|████████████████████████████████████████████████▋   | 9123/9741 [00:26<00:01, 356.81it/s] 94%|████████████████████████████████████████████████▉   | 9160/9741 [00:26<00:01, 357.82it/s] 94%|█████████████████████████████████████████████████   | 9196/9741 [00:26<00:01, 358.34it/s] 95%|█████████████████████████████████████████████████▎  | 9232/9741 [00:26<00:01, 358.32it/s] 95%|█████████████████████████████████████████████████▍  | 9268/9741 [00:26<00:01, 355.98it/s] 96%|█████████████████████████████████████████████████▋  | 9304/9741 [00:26<00:01, 356.89it/s] 96%|█████████████████████████████████████████████████▊  | 9340/9741 [00:26<00:01, 357.39it/s] 96%|██████████████████████████████████████████████████  | 9376/9741 [00:26<00:01, 357.84it/s] 97%|██████████████████████████████████████████████████▏ | 9412/9741 [00:26<00:00, 358.00it/s] 97%|██████████████████████████████████████████████████▍ | 9448/9741 [00:27<00:00, 357.63it/s] 97%|██████████████████████████████████████████████████▋ | 9484/9741 [00:27<00:00, 355.42it/s] 98%|██████████████████████████████████████████████████▊ | 9520/9741 [00:27<00:00, 356.45it/s] 98%|███████████████████████████████████████████████████ | 9556/9741 [00:27<00:00, 357.20it/s] 98%|███████████████████████████████████████████████████▏| 9592/9741 [00:27<00:00, 357.36it/s] 99%|███████████████████████████████████████████████████▍| 9628/9741 [00:27<00:00, 357.24it/s] 99%|███████████████████████████████████████████████████▌| 9664/9741 [00:27<00:00, 357.66it/s]100%|███████████████████████████████████████████████████▊| 9700/9741 [00:27<00:00, 356.99it/s]100%|███████████████████████████████████████████████████▉| 9736/9741 [00:27<00:00, 353.06it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:27<00:00, 348.98it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.31s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.57s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.43s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.72s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.44s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.50s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.34s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.87s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.01s/it]
[2023-08-21 23:31:12,254] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.69s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.98s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.12s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.93s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.16s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.31s/it]
[2023-08-21 23:31:26,001] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 23:31:26,002] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f72fb02efd0>
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 23:31:26,003] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f72fab2c220>
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 23:31:26,004] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 23:31:26,005] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 23:31:26,005] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5180525779724121 seconds
Loading extension module utils...
Time to load utils op: 0.5045278072357178 seconds
Loading extension module utils...
Time to load utils op: 0.4047706127166748 seconds
Loading extension module utils...
Time to load utils op: 0.5046467781066895 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input: Noah, who loves his Grammy, calls her every week to talk about his day. If each call lasts 30 minutes and he is charged $0.05 per call minute, how much would he be billed if he makes the calls for a year?
Output: 78

Input: A merchant bought 15 keyboards and 25 printers for a total of $2050. If a keyboard costs $20, how much does a printer cost?
Output: 70

Input: Gina has two bank accounts. Each account has a quarter of the balance in Betty's account. If Betty's account balance is $3,456, what is the combined balance of both Gina's accounts?
Output: 1728

Input: Zain has 10 more of each coin than Emerie. If Emerie has six quarters, seven dimes, and five nickels, how many coins does Zain have?
Output: 48

Input: Adonis is playing a prank on his dad by replacing his shampoo with hot sauce. Every day, after his dad showers, Adonis replaces the shampoo with 1/2 an ounce of hot sauce. He knows his dad uses 1 oz of shampoo a day from a new 10 oz bottle that no one else uses. After 4 days, what percentage of the liquid in the bottle is hot sauce?
Output: 25

Input: Lana and Mike are taking their dog and renting a cabin in the mountains for 2 weeks.  The daily rate is $125.00  There is a $100.00 pet fee.  There is also a 20% service/cleaning fee for the rental.  They need to pay 50% of the entire bill as a security deposit.  How much is their security deposit?
Output: 1110

Input: Abigail is trying a new recipe for a cold drink. It uses 1/4 of a cup of iced tea and 1 and 1/4 of a cup of lemonade to make one drink. If she fills a pitcher with 18 total cups of this drink, how many cups of lemonade are in the pitcher?
Output: 15

Input: John buys a vacuum cleaner for $250 and a dishwasher for $450.  She has a $75 off coupon.  How much did he spend?
Output: 625

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o21-tgsm8k-s10-rFalse
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3452786) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_23:31:34
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3452787)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-21_23:31:34
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3452788)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-21_23:31:34
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3452789)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_23:31:34
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3452786)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o22-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 22
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 23:31:38,095] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o22-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 22
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o22-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 22/9741 [00:00<00:44, 218.47it/s]  0%|▏                                                     | 44/9741 [00:00<00:44, 219.16it/s]  1%|▎                                                     | 66/9741 [00:00<00:44, 219.38it/s]  1%|▍                                                     | 89/9741 [00:00<00:43, 219.90it/s]  1%|▌                                                    | 111/9741 [00:00<00:43, 219.84it/s]  1%|▋                                                    | 133/9741 [00:00<00:43, 219.47it/s]  2%|▊                                                    | 155/9741 [00:00<00:44, 215.66it/s]  2%|▉                                                    | 177/9741 [00:00<00:44, 216.36it/s]  2%|█                                                    | 199/9741 [00:00<00:44, 216.71it/s]  2%|█▏                                                   | 221/9741 [00:01<00:44, 215.18it/s]  2%|█▎                                                   | 243/9741 [00:01<00:43, 216.02it/s]  3%|█▍                                                   | 265/9741 [00:01<00:43, 216.73it/s]  3%|█▌                                                   | 287/9741 [00:01<00:43, 217.18it/s]  3%|█▋                                                   | 309/9741 [00:01<00:43, 217.60it/s]  3%|█▊                                                   | 331/9741 [00:01<00:43, 217.67it/s]  4%|█▉                                                   | 353/9741 [00:01<00:43, 217.72it/s]  4%|██                                                   | 375/9741 [00:01<00:43, 215.50it/s]  4%|██▏                                                  | 397/9741 [00:01<00:43, 216.29it/s]  4%|██▎                                                  | 419/9741 [00:01<00:43, 215.68it/s]  5%|██▍                                                  | 441/9741 [00:02<00:43, 213.74it/s]  5%|██▌                                                  | 463/9741 [00:02<00:43, 214.16it/s]  5%|██▋                                                  | 485/9741 [00:02<00:43, 214.31it/s]  5%|██▊                                                  | 515/9741 [00:02<00:38, 239.55it/s]  6%|██▉                                                  | 548/9741 [00:02<00:34, 265.49it/s]  6%|███▏                                                 | 581/9741 [00:02<00:32, 283.48it/s]  6%|███▎                                                 | 614/9741 [00:02<00:30, 296.12it/s]  7%|███▌                                                 | 647/9741 [00:02<00:29, 305.19it/s]  7%|███▋                                                 | 679/9741 [00:02<00:29, 309.25it/s]  7%|███▊                                                 | 712/9741 [00:02<00:28, 314.15it/s]  8%|████                                                 | 744/9741 [00:03<00:28, 315.52it/s]  8%|████▏                                                | 777/9741 [00:03<00:28, 318.91it/s]  8%|████▍                                                | 810/9741 [00:03<00:27, 320.46it/s]  9%|████▌                                                | 843/9741 [00:03<00:27, 322.08it/s]  9%|████▊                                                | 876/9741 [00:03<00:27, 323.19it/s]  9%|████▉                                                | 909/9741 [00:03<00:27, 321.82it/s] 10%|█████▏                                               | 942/9741 [00:03<00:27, 322.88it/s] 10%|█████▎                                               | 975/9741 [00:03<00:27, 323.78it/s] 10%|█████▍                                              | 1008/9741 [00:03<00:26, 324.38it/s] 11%|█████▌                                              | 1041/9741 [00:03<00:26, 324.85it/s] 11%|█████▋                                              | 1074/9741 [00:04<00:26, 325.25it/s] 11%|█████▉                                              | 1107/9741 [00:04<00:26, 324.91it/s] 12%|██████                                              | 1140/9741 [00:04<00:26, 322.52it/s] 12%|██████▎                                             | 1173/9741 [00:04<00:26, 319.27it/s] 12%|██████▍                                             | 1206/9741 [00:04<00:26, 320.49it/s] 13%|██████▌                                             | 1239/9741 [00:04<00:26, 321.39it/s] 13%|██████▊                                             | 1272/9741 [00:04<00:26, 322.25it/s] 13%|██████▉                                             | 1305/9741 [00:04<00:26, 322.81it/s] 14%|███████▏                                            | 1338/9741 [00:04<00:26, 320.57it/s] 14%|███████▎                                            | 1371/9741 [00:04<00:26, 321.49it/s] 14%|███████▍                                            | 1404/9741 [00:05<00:25, 322.00it/s] 15%|███████▋                                            | 1437/9741 [00:05<00:25, 322.40it/s] 15%|███████▊                                            | 1470/9741 [00:05<00:25, 322.69it/s] 15%|████████                                            | 1503/9741 [00:05<00:25, 322.46it/s] 16%|████████▏                                           | 1536/9741 [00:05<00:25, 322.82it/s] 16%|████████▍                                           | 1569/9741 [00:05<00:25, 320.86it/s] 16%|████████▌                                           | 1602/9741 [00:05<00:25, 320.47it/s] 17%|████████▋                                           | 1635/9741 [00:05<00:25, 321.32it/s] 17%|████████▉                                           | 1668/9741 [00:05<00:25, 321.93it/s] 17%|█████████                                           | 1701/9741 [00:06<00:24, 322.19it/s] 18%|█████████▎                                          | 1734/9741 [00:06<00:24, 322.52it/s] 18%|█████████▍                                          | 1767/9741 [00:06<00:24, 322.74it/s] 18%|█████████▌                                          | 1800/9741 [00:06<00:26, 295.22it/s] 19%|█████████▊                                          | 1833/9741 [00:06<00:26, 302.89it/s] 19%|█████████▉                                          | 1866/9741 [00:06<00:25, 308.94it/s] 19%|██████████▏                                         | 1899/9741 [00:06<00:25, 312.71it/s] 20%|██████████▎                                         | 1932/9741 [00:06<00:24, 315.37it/s] 20%|██████████▍                                         | 1965/9741 [00:06<00:24, 317.18it/s] 21%|██████████▋                                         | 1998/9741 [00:06<00:24, 319.04it/s] 21%|██████████▊                                         | 2030/9741 [00:07<00:24, 317.46it/s] 21%|███████████                                         | 2063/9741 [00:07<00:24, 318.58it/s] 22%|███████████▏                                        | 2096/9741 [00:07<00:23, 319.40it/s] 22%|███████████▎                                        | 2129/9741 [00:07<00:23, 319.76it/s] 22%|███████████▌                                        | 2162/9741 [00:07<00:23, 320.92it/s] 23%|███████████▋                                        | 2195/9741 [00:07<00:23, 321.03it/s] 23%|███████████▉                                        | 2228/9741 [00:07<00:23, 321.17it/s] 23%|████████████                                        | 2261/9741 [00:07<00:23, 319.13it/s] 24%|████████████▏                                       | 2294/9741 [00:07<00:23, 320.15it/s] 24%|████████████▍                                       | 2327/9741 [00:07<00:23, 320.64it/s] 24%|████████████▌                                       | 2360/9741 [00:08<00:22, 321.23it/s] 25%|████████████▊                                       | 2393/9741 [00:08<00:22, 321.39it/s] 25%|████████████▉                                       | 2426/9741 [00:08<00:22, 321.72it/s] 25%|█████████████▏                                      | 2459/9741 [00:08<00:22, 322.05it/s] 26%|█████████████▎                                      | 2492/9741 [00:08<00:22, 319.70it/s] 26%|█████████████▍                                      | 2525/9741 [00:08<00:22, 320.55it/s] 26%|█████████████▋                                      | 2558/9741 [00:08<00:22, 321.05it/s] 27%|█████████████▊                                      | 2591/9741 [00:08<00:22, 321.52it/s] 27%|██████████████                                      | 2624/9741 [00:08<00:22, 321.66it/s] 27%|██████████████▏                                     | 2657/9741 [00:09<00:22, 320.24it/s] 28%|██████████████▎                                     | 2690/9741 [00:09<00:22, 320.07it/s] 28%|██████████████▌                                     | 2723/9741 [00:09<00:22, 318.17it/s] 28%|██████████████▋                                     | 2755/9741 [00:09<00:21, 318.54it/s] 29%|██████████████▉                                     | 2787/9741 [00:09<00:21, 318.79it/s] 29%|███████████████                                     | 2819/9741 [00:09<00:21, 319.07it/s] 29%|███████████████▏                                    | 2852/9741 [00:09<00:21, 319.71it/s] 30%|███████████████▍                                    | 2885/9741 [00:09<00:21, 320.34it/s] 30%|███████████████▌                                    | 2918/9741 [00:09<00:21, 320.48it/s] 30%|███████████████▊                                    | 2951/9741 [00:09<00:21, 318.01it/s] 31%|███████████████▉                                    | 2984/9741 [00:10<00:21, 319.07it/s] 31%|████████████████                                    | 3017/9741 [00:10<00:21, 319.70it/s] 31%|████████████████▎                                   | 3050/9741 [00:10<00:20, 320.00it/s] 32%|████████████████▍                                   | 3083/9741 [00:10<00:20, 320.08it/s] 32%|████████████████▋                                   | 3116/9741 [00:10<00:20, 320.73it/s] 32%|████████████████▊                                   | 3149/9741 [00:10<00:20, 320.80it/s] 33%|████████████████▉                                   | 3182/9741 [00:10<00:20, 318.57it/s] 33%|█████████████████▏                                  | 3214/9741 [00:10<00:20, 318.77it/s] 33%|█████████████████▎                                  | 3247/9741 [00:10<00:20, 320.15it/s] 34%|█████████████████▌                                  | 3280/9741 [00:10<00:20, 320.45it/s] 34%|█████████████████▋                                  | 3313/9741 [00:11<00:20, 320.54it/s] 34%|█████████████████▊                                  | 3346/9741 [00:11<00:19, 320.11it/s] 35%|██████████████████                                  | 3379/9741 [00:11<00:19, 318.30it/s] 35%|██████████████████▏                                 | 3412/9741 [00:11<00:19, 319.08it/s] 35%|██████████████████▍                                 | 3445/9741 [00:11<00:19, 319.63it/s] 36%|██████████████████▌                                 | 3478/9741 [00:11<00:19, 320.93it/s] 36%|██████████████████▋                                 | 3511/9741 [00:11<00:19, 321.51it/s] 36%|██████████████████▉                                 | 3544/9741 [00:11<00:19, 322.82it/s] 37%|███████████████████                                 | 3577/9741 [00:11<00:19, 323.17it/s] 37%|███████████████████▎                                | 3610/9741 [00:11<00:19, 321.08it/s] 37%|███████████████████▍                                | 3643/9741 [00:12<00:18, 321.96it/s] 38%|███████████████████▌                                | 3676/9741 [00:12<00:18, 322.56it/s] 38%|███████████████████▊                                | 3709/9741 [00:12<00:18, 322.85it/s] 38%|███████████████████▉                                | 3742/9741 [00:12<00:18, 320.43it/s] 39%|████████████████████▏                               | 3775/9741 [00:12<00:18, 321.56it/s] 39%|████████████████████▎                               | 3808/9741 [00:12<00:18, 322.43it/s] 39%|████████████████████▌                               | 3841/9741 [00:12<00:18, 320.74it/s] 40%|████████████████████▋                               | 3874/9741 [00:12<00:18, 321.74it/s] 40%|████████████████████▊                               | 3907/9741 [00:12<00:18, 322.55it/s] 40%|█████████████████████                               | 3940/9741 [00:13<00:17, 323.18it/s] 41%|█████████████████████▏                              | 3973/9741 [00:13<00:17, 323.27it/s] 41%|█████████████████████▍                              | 4006/9741 [00:13<00:17, 323.71it/s] 41%|█████████████████████▌                              | 4039/9741 [00:13<00:17, 323.82it/s] 42%|█████████████████████▋                              | 4072/9741 [00:13<00:17, 321.89it/s] 42%|█████████████████████▉                              | 4105/9741 [00:13<00:17, 322.54it/s] 42%|██████████████████████                              | 4138/9741 [00:13<00:17, 323.29it/s] 43%|██████████████████████▎                             | 4171/9741 [00:13<00:17, 323.72it/s] 43%|██████████████████████▍                             | 4204/9741 [00:13<00:17, 324.08it/s] 43%|██████████████████████▌                             | 4237/9741 [00:13<00:16, 324.70it/s] 44%|██████████████████████▊                             | 4270/9741 [00:14<00:16, 324.93it/s] 44%|██████████████████████▉                             | 4303/9741 [00:14<00:17, 319.76it/s] 45%|███████████████████████▏                            | 4336/9741 [00:14<00:16, 321.14it/s] 45%|███████████████████████▎                            | 4369/9741 [00:14<00:16, 322.07it/s] 45%|███████████████████████▍                            | 4402/9741 [00:14<00:16, 322.81it/s] 46%|███████████████████████▋                            | 4435/9741 [00:14<00:16, 323.34it/s] 46%|███████████████████████▊                            | 4468/9741 [00:14<00:16, 323.31it/s] 46%|████████████████████████                            | 4501/9741 [00:14<00:16, 323.55it/s] 47%|████████████████████████▏                           | 4534/9741 [00:14<00:17, 293.66it/s] 47%|████████████████████████▍                           | 4567/9741 [00:14<00:17, 302.39it/s] 47%|████████████████████████▌                           | 4600/9741 [00:15<00:16, 308.85it/s] 48%|████████████████████████▋                           | 4633/9741 [00:15<00:16, 313.53it/s] 48%|████████████████████████▉                           | 4666/9741 [00:15<00:16, 316.80it/s] 48%|█████████████████████████                           | 4699/9741 [00:15<00:15, 319.27it/s] 49%|█████████████████████████▎                          | 4732/9741 [00:15<00:15, 320.62it/s] 49%|█████████████████████████▍                          | 4765/9741 [00:15<00:22, 224.44it/s] 49%|█████████████████████████▌                          | 4797/9741 [00:15<00:20, 245.04it/s] 50%|█████████████████████████▊                          | 4830/9741 [00:15<00:18, 264.54it/s] 50%|█████████████████████████▉                          | 4863/9741 [00:16<00:17, 279.77it/s] 50%|██████████████████████████▏                         | 4896/9741 [00:16<00:16, 291.89it/s] 51%|██████████████████████████▎                         | 4929/9741 [00:16<00:15, 301.05it/s] 51%|██████████████████████████▍                         | 4961/9741 [00:16<00:15, 305.95it/s] 51%|██████████████████████████▋                         | 4994/9741 [00:16<00:15, 311.31it/s] 52%|██████████████████████████▊                         | 5027/9741 [00:16<00:14, 315.27it/s] 52%|███████████████████████████                         | 5060/9741 [00:16<00:14, 318.03it/s] 52%|███████████████████████████▏                        | 5093/9741 [00:16<00:14, 319.78it/s] 53%|███████████████████████████▎                        | 5126/9741 [00:16<00:14, 321.19it/s] 53%|███████████████████████████▌                        | 5159/9741 [00:16<00:14, 322.75it/s] 53%|███████████████████████████▋                        | 5192/9741 [00:17<00:14, 320.96it/s] 54%|███████████████████████████▉                        | 5225/9741 [00:17<00:14, 321.83it/s] 54%|████████████████████████████                        | 5258/9741 [00:17<00:13, 322.47it/s] 54%|████████████████████████████▏                       | 5291/9741 [00:17<00:13, 322.79it/s] 55%|████████████████████████████▍                       | 5324/9741 [00:17<00:13, 323.17it/s] 55%|████████████████████████████▌                       | 5357/9741 [00:17<00:13, 320.39it/s] 55%|████████████████████████████▊                       | 5390/9741 [00:17<00:13, 321.24it/s] 56%|████████████████████████████▉                       | 5423/9741 [00:17<00:13, 317.76it/s] 56%|█████████████████████████████▏                      | 5456/9741 [00:17<00:13, 319.63it/s] 56%|█████████████████████████████▎                      | 5489/9741 [00:18<00:13, 322.26it/s] 57%|█████████████████████████████▍                      | 5523/9741 [00:18<00:12, 325.51it/s] 57%|█████████████████████████████▋                      | 5557/9741 [00:18<00:12, 328.06it/s] 57%|█████████████████████████████▊                      | 5591/9741 [00:18<00:12, 329.35it/s] 58%|██████████████████████████████                      | 5624/9741 [00:18<00:12, 328.94it/s] 58%|██████████████████████████████▏                     | 5658/9741 [00:18<00:12, 330.22it/s] 58%|██████████████████████████████▍                     | 5692/9741 [00:18<00:12, 331.51it/s] 59%|██████████████████████████████▌                     | 5726/9741 [00:18<00:12, 332.28it/s] 59%|██████████████████████████████▋                     | 5760/9741 [00:18<00:11, 332.43it/s] 59%|██████████████████████████████▉                     | 5794/9741 [00:18<00:11, 332.71it/s] 60%|███████████████████████████████                     | 5828/9741 [00:19<00:11, 333.03it/s] 60%|███████████████████████████████▎                    | 5862/9741 [00:19<00:11, 330.84it/s] 61%|███████████████████████████████▍                    | 5896/9741 [00:19<00:11, 328.68it/s] 61%|███████████████████████████████▋                    | 5930/9741 [00:19<00:11, 330.30it/s] 61%|███████████████████████████████▊                    | 5964/9741 [00:19<00:11, 331.79it/s] 62%|████████████████████████████████                    | 5998/9741 [00:19<00:11, 332.60it/s] 62%|████████████████████████████████▏                   | 6032/9741 [00:19<00:11, 333.01it/s] 62%|████████████████████████████████▍                   | 6066/9741 [00:19<00:11, 333.77it/s] 63%|████████████████████████████████▌                   | 6100/9741 [00:19<00:10, 331.86it/s] 63%|████████████████████████████████▋                   | 6134/9741 [00:19<00:10, 332.03it/s] 63%|████████████████████████████████▉                   | 6168/9741 [00:20<00:10, 332.27it/s] 64%|█████████████████████████████████                   | 6202/9741 [00:20<00:10, 332.63it/s] 64%|█████████████████████████████████▎                  | 6236/9741 [00:20<00:10, 332.44it/s] 64%|█████████████████████████████████▍                  | 6270/9741 [00:20<00:10, 332.40it/s] 65%|█████████████████████████████████▋                  | 6304/9741 [00:20<00:10, 330.76it/s] 65%|█████████████████████████████████▊                  | 6338/9741 [00:20<00:10, 331.58it/s] 65%|██████████████████████████████████                  | 6372/9741 [00:20<00:10, 332.18it/s] 66%|██████████████████████████████████▏                 | 6406/9741 [00:20<00:10, 332.59it/s] 66%|██████████████████████████████████▍                 | 6440/9741 [00:20<00:09, 332.88it/s] 66%|██████████████████████████████████▌                 | 6474/9741 [00:20<00:09, 331.71it/s] 67%|██████████████████████████████████▋                 | 6508/9741 [00:21<00:09, 331.94it/s] 67%|██████████████████████████████████▉                 | 6542/9741 [00:21<00:09, 329.97it/s] 68%|███████████████████████████████████                 | 6576/9741 [00:21<00:09, 330.27it/s] 68%|███████████████████████████████████▎                | 6610/9741 [00:21<00:09, 330.23it/s] 68%|███████████████████████████████████▍                | 6644/9741 [00:21<00:09, 330.97it/s] 69%|███████████████████████████████████▋                | 6678/9741 [00:21<00:09, 331.34it/s] 69%|███████████████████████████████████▊                | 6712/9741 [00:21<00:09, 331.48it/s] 69%|████████████████████████████████████                | 6746/9741 [00:21<00:09, 332.24it/s] 70%|████████████████████████████████████▏               | 6780/9741 [00:21<00:08, 330.63it/s] 70%|████████████████████████████████████▎               | 6814/9741 [00:21<00:08, 331.44it/s] 70%|████████████████████████████████████▌               | 6848/9741 [00:22<00:08, 332.07it/s] 71%|████████████████████████████████████▋               | 6882/9741 [00:22<00:08, 332.10it/s] 71%|████████████████████████████████████▉               | 6916/9741 [00:22<00:08, 332.20it/s] 71%|█████████████████████████████████████               | 6950/9741 [00:22<00:08, 332.34it/s] 72%|█████████████████████████████████████▎              | 6984/9741 [00:22<00:08, 332.28it/s] 72%|█████████████████████████████████████▍              | 7018/9741 [00:22<00:08, 330.01it/s] 72%|█████████████████████████████████████▋              | 7052/9741 [00:22<00:08, 331.12it/s] 73%|█████████████████████████████████████▊              | 7086/9741 [00:22<00:08, 331.65it/s] 73%|██████████████████████████████████████              | 7120/9741 [00:22<00:07, 332.15it/s] 73%|██████████████████████████████████████▏             | 7154/9741 [00:23<00:07, 332.46it/s] 74%|██████████████████████████████████████▎             | 7188/9741 [00:23<00:07, 331.07it/s] 74%|██████████████████████████████████████▌             | 7222/9741 [00:23<00:07, 329.40it/s] 74%|██████████████████████████████████████▋             | 7256/9741 [00:23<00:07, 330.60it/s] 75%|██████████████████████████████████████▉             | 7290/9741 [00:23<00:07, 331.22it/s] 75%|███████████████████████████████████████             | 7324/9741 [00:23<00:07, 331.28it/s] 76%|███████████████████████████████████████▎            | 7358/9741 [00:23<00:07, 331.88it/s] 76%|███████████████████████████████████████▍            | 7392/9741 [00:23<00:07, 332.23it/s] 76%|███████████████████████████████████████▋            | 7426/9741 [00:23<00:06, 332.19it/s] 77%|███████████████████████████████████████▊            | 7460/9741 [00:23<00:07, 301.96it/s] 77%|████████████████████████████████████████            | 7494/9741 [00:24<00:07, 310.35it/s] 77%|████████████████████████████████████████▏           | 7528/9741 [00:24<00:07, 316.13it/s] 78%|████████████████████████████████████████▎           | 7562/9741 [00:24<00:06, 320.36it/s] 78%|████████████████████████████████████████▌           | 7596/9741 [00:24<00:06, 323.57it/s] 78%|████████████████████████████████████████▋           | 7630/9741 [00:24<00:06, 325.71it/s] 79%|████████████████████████████████████████▉           | 7664/9741 [00:24<00:06, 327.24it/s] 79%|█████████████████████████████████████████           | 7697/9741 [00:24<00:06, 326.36it/s] 79%|█████████████████████████████████████████▎          | 7731/9741 [00:24<00:06, 328.13it/s] 80%|█████████████████████████████████████████▍          | 7765/9741 [00:24<00:06, 329.19it/s] 80%|█████████████████████████████████████████▋          | 7799/9741 [00:25<00:05, 329.73it/s] 80%|█████████████████████████████████████████▊          | 7833/9741 [00:25<00:05, 330.55it/s] 81%|█████████████████████████████████████████▉          | 7867/9741 [00:25<00:05, 331.01it/s] 81%|██████████████████████████████████████████▏         | 7901/9741 [00:25<00:05, 329.10it/s] 81%|██████████████████████████████████████████▎         | 7935/9741 [00:25<00:05, 330.00it/s] 82%|██████████████████████████████████████████▌         | 7969/9741 [00:25<00:05, 330.68it/s] 82%|██████████████████████████████████████████▋         | 8003/9741 [00:25<00:05, 331.19it/s] 83%|██████████████████████████████████████████▉         | 8037/9741 [00:25<00:05, 331.20it/s] 83%|███████████████████████████████████████████         | 8071/9741 [00:25<00:05, 331.50it/s] 83%|███████████████████████████████████████████▎        | 8105/9741 [00:25<00:04, 332.22it/s] 84%|███████████████████████████████████████████▍        | 8139/9741 [00:26<00:04, 330.60it/s] 84%|███████████████████████████████████████████▋        | 8173/9741 [00:26<00:04, 331.07it/s] 84%|███████████████████████████████████████████▊        | 8207/9741 [00:26<00:04, 331.30it/s] 85%|███████████████████████████████████████████▉        | 8241/9741 [00:26<00:04, 331.71it/s] 85%|████████████████████████████████████████████▏       | 8275/9741 [00:26<00:04, 331.33it/s] 85%|████████████████████████████████████████████▎       | 8309/9741 [00:26<00:04, 331.19it/s] 86%|████████████████████████████████████████████▌       | 8343/9741 [00:26<00:04, 331.50it/s] 86%|████████████████████████████████████████████▋       | 8377/9741 [00:26<00:04, 329.25it/s] 86%|████████████████████████████████████████████▉       | 8411/9741 [00:26<00:04, 329.69it/s] 87%|█████████████████████████████████████████████       | 8445/9741 [00:26<00:03, 330.00it/s] 87%|█████████████████████████████████████████████▎      | 8479/9741 [00:27<00:03, 330.10it/s] 87%|█████████████████████████████████████████████▍      | 8513/9741 [00:27<00:03, 330.79it/s] 88%|█████████████████████████████████████████████▋      | 8547/9741 [00:27<00:03, 330.70it/s] 88%|█████████████████████████████████████████████▊      | 8581/9741 [00:27<00:03, 328.84it/s] 88%|█████████████████████████████████████████████▉      | 8615/9741 [00:27<00:03, 329.29it/s] 89%|██████████████████████████████████████████████▏     | 8648/9741 [00:27<00:03, 329.34it/s] 89%|██████████████████████████████████████████████▎     | 8682/9741 [00:27<00:03, 329.77it/s] 89%|██████████████████████████████████████████████▌     | 8716/9741 [00:27<00:03, 330.39it/s] 90%|██████████████████████████████████████████████▋     | 8750/9741 [00:27<00:02, 330.73it/s] 90%|██████████████████████████████████████████████▉     | 8784/9741 [00:27<00:02, 330.92it/s] 91%|███████████████████████████████████████████████     | 8818/9741 [00:28<00:02, 328.64it/s] 91%|███████████████████████████████████████████████▎    | 8852/9741 [00:28<00:02, 329.25it/s] 91%|███████████████████████████████████████████████▍    | 8886/9741 [00:28<00:02, 329.98it/s] 92%|███████████████████████████████████████████████▌    | 8920/9741 [00:28<00:02, 330.25it/s] 92%|███████████████████████████████████████████████▊    | 8954/9741 [00:28<00:02, 330.41it/s] 92%|███████████████████████████████████████████████▉    | 8988/9741 [00:28<00:02, 330.57it/s] 93%|████████████████████████████████████████████████▏   | 9022/9741 [00:28<00:02, 330.83it/s] 93%|████████████████████████████████████████████████▎   | 9056/9741 [00:28<00:02, 328.74it/s] 93%|████████████████████████████████████████████████▌   | 9090/9741 [00:28<00:01, 329.34it/s] 94%|████████████████████████████████████████████████▋   | 9124/9741 [00:29<00:01, 329.76it/s] 94%|████████████████████████████████████████████████▉   | 9157/9741 [00:29<00:01, 329.72it/s] 94%|█████████████████████████████████████████████████   | 9191/9741 [00:29<00:01, 329.99it/s] 95%|█████████████████████████████████████████████████▏  | 9225/9741 [00:29<00:01, 329.93it/s] 95%|█████████████████████████████████████████████████▍  | 9258/9741 [00:29<00:01, 328.12it/s] 95%|█████████████████████████████████████████████████▌  | 9292/9741 [00:29<00:01, 329.17it/s] 96%|█████████████████████████████████████████████████▊  | 9326/9741 [00:29<00:01, 329.66it/s] 96%|█████████████████████████████████████████████████▉  | 9359/9741 [00:29<00:01, 329.70it/s] 96%|██████████████████████████████████████████████████▏ | 9393/9741 [00:29<00:01, 330.46it/s] 97%|██████████████████████████████████████████████████▎ | 9427/9741 [00:29<00:00, 330.85it/s] 97%|██████████████████████████████████████████████████▌ | 9461/9741 [00:30<00:00, 330.97it/s] 97%|██████████████████████████████████████████████████▋ | 9495/9741 [00:30<00:00, 328.84it/s] 98%|██████████████████████████████████████████████████▊ | 9529/9741 [00:30<00:00, 329.80it/s] 98%|███████████████████████████████████████████████████ | 9563/9741 [00:30<00:00, 330.69it/s] 99%|███████████████████████████████████████████████████▏| 9597/9741 [00:30<00:00, 330.61it/s] 99%|███████████████████████████████████████████████████▍| 9631/9741 [00:30<00:00, 330.64it/s] 99%|███████████████████████████████████████████████████▌| 9665/9741 [00:30<00:00, 331.16it/s]100%|███████████████████████████████████████████████████▊| 9699/9741 [00:30<00:00, 331.60it/s]100%|███████████████████████████████████████████████████▉| 9733/9741 [00:30<00:00, 329.92it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:30<00:00, 315.43it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.78s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.04s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:06<00:13,  6.90s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.95s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.60s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.65s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:12<00:06,  6.15s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.38s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.54s/it]
[2023-08-21 23:33:00,335] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.16s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.90s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.12s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:17<00:00,  5.76s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:17<00:00,  5.94s/it]
[2023-08-21 23:33:17,698] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 23:33:17,699] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 23:33:17,699] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 23:33:17,700] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 23:33:17,700] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 23:33:17,700] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 23:33:17,700] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 23:33:17,700] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 23:33:17,700] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 23:33:17,700] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 23:33:17,700] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f996a41cfd0>
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 23:33:17,701] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f99698d4220>
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 23:33:17,702] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 23:33:17,702] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5681247711181641 seconds
Loading extension module utils...
Time to load utils op: 0.5043883323669434 seconds
Loading extension module utils...
Time to load utils op: 0.6046228408813477 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]Time to load utils op: 0.604994535446167 seconds
############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input: Noah, who loves his Grammy, calls her every week to talk about his day. If each call lasts 30 minutes and he is charged $0.05 per call minute, how much would he be billed if he makes the calls for a year?
Output: 78

Input: A merchant bought 15 keyboards and 25 printers for a total of $2050. If a keyboard costs $20, how much does a printer cost?
Output: 70

Input: Gina has two bank accounts. Each account has a quarter of the balance in Betty's account. If Betty's account balance is $3,456, what is the combined balance of both Gina's accounts?
Output: 1728

Input: Zain has 10 more of each coin than Emerie. If Emerie has six quarters, seven dimes, and five nickels, how many coins does Zain have?
Output: 48

Input: Adonis is playing a prank on his dad by replacing his shampoo with hot sauce. Every day, after his dad showers, Adonis replaces the shampoo with 1/2 an ounce of hot sauce. He knows his dad uses 1 oz of shampoo a day from a new 10 oz bottle that no one else uses. After 4 days, what percentage of the liquid in the bottle is hot sauce?
Output: 25

Input: Lana and Mike are taking their dog and renting a cabin in the mountains for 2 weeks.  The daily rate is $125.00  There is a $100.00 pet fee.  There is also a 20% service/cleaning fee for the rental.  They need to pay 50% of the entire bill as a security deposit.  How much is their security deposit?
Output: 1110

Input: Abigail is trying a new recipe for a cold drink. It uses 1/4 of a cup of iced tea and 1 and 1/4 of a cup of lemonade to make one drink. If she fills a pitcher with 18 total cups of this drink, how many cups of lemonade are in the pitcher?
Output: 15

Input: John buys a vacuum cleaner for $250 and a dishwasher for $450.  She has a $75 off coupon.  How much did he spend?
Output: 625

Input: Dany owns a farm, in his farm he has 4 cows and 3 sheep that eat 2 bushels a day. He also has 7 chickens that eat 3 bushels a day. How many bushels should he have to suffice the animals for a day?
Output: 35

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o22-tgsm8k-s10-rFalse
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3453936) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_23:33:25
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3453937)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-21_23:33:25
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3453938)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-21_23:33:25
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3453939)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_23:33:25
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3453936)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o23-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 23
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 23:33:29,617] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o23-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 23
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o23-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 22/9741 [00:00<00:45, 211.75it/s]  0%|▏                                                     | 44/9741 [00:00<00:45, 212.10it/s]  1%|▎                                                     | 66/9741 [00:00<00:45, 212.14it/s]  1%|▍                                                     | 88/9741 [00:00<00:45, 212.56it/s]  1%|▌                                                    | 110/9741 [00:00<00:45, 212.87it/s]  1%|▋                                                    | 132/9741 [00:00<00:45, 212.71it/s]  2%|▊                                                    | 154/9741 [00:00<00:45, 209.87it/s]  2%|▉                                                    | 176/9741 [00:00<00:45, 210.33it/s]  2%|█                                                    | 198/9741 [00:00<00:45, 210.88it/s]  2%|█▏                                                   | 220/9741 [00:01<00:45, 209.23it/s]  2%|█▎                                                   | 242/9741 [00:01<00:45, 210.05it/s]  3%|█▍                                                   | 264/9741 [00:01<00:44, 210.66it/s]  3%|█▌                                                   | 286/9741 [00:01<00:44, 210.94it/s]  3%|█▋                                                   | 308/9741 [00:01<00:44, 211.35it/s]  3%|█▊                                                   | 330/9741 [00:01<00:44, 211.51it/s]  4%|█▉                                                   | 352/9741 [00:01<00:44, 209.49it/s]  4%|██                                                   | 374/9741 [00:01<00:44, 209.80it/s]  4%|██▏                                                  | 396/9741 [00:01<00:44, 210.62it/s]  4%|██▎                                                  | 419/9741 [00:01<00:43, 215.36it/s]  5%|██▍                                                  | 450/9741 [00:02<00:38, 243.03it/s]  5%|██▋                                                  | 483/9741 [00:02<00:34, 266.79it/s]  5%|██▊                                                  | 516/9741 [00:02<00:32, 283.37it/s]  6%|██▉                                                  | 549/9741 [00:02<00:31, 295.01it/s]  6%|███▏                                                 | 582/9741 [00:02<00:30, 303.06it/s]  6%|███▎                                                 | 615/9741 [00:02<00:29, 308.48it/s]  7%|███▌                                                 | 648/9741 [00:02<00:29, 312.57it/s]  7%|███▋                                                 | 680/9741 [00:02<00:28, 313.09it/s]  7%|███▊                                                 | 712/9741 [00:02<00:28, 314.65it/s]  8%|████                                                 | 744/9741 [00:02<00:28, 313.35it/s]  8%|████▏                                                | 776/9741 [00:03<00:28, 313.69it/s]  8%|████▍                                                | 809/9741 [00:03<00:28, 315.96it/s]  9%|████▌                                                | 842/9741 [00:03<00:28, 317.41it/s]  9%|████▊                                                | 875/9741 [00:03<00:27, 318.73it/s]  9%|████▉                                                | 907/9741 [00:03<00:27, 316.81it/s] 10%|█████                                                | 939/9741 [00:03<00:27, 317.60it/s] 10%|█████▎                                               | 971/9741 [00:03<00:27, 318.19it/s] 10%|█████▎                                              | 1003/9741 [00:03<00:27, 316.85it/s] 11%|█████▌                                              | 1035/9741 [00:03<00:27, 316.28it/s] 11%|█████▋                                              | 1067/9741 [00:04<00:27, 317.30it/s] 11%|█████▊                                              | 1099/9741 [00:04<00:27, 316.51it/s] 12%|██████                                              | 1131/9741 [00:04<00:27, 314.46it/s] 12%|██████▏                                             | 1163/9741 [00:04<00:27, 313.37it/s] 12%|██████▍                                             | 1196/9741 [00:04<00:27, 315.67it/s] 13%|██████▌                                             | 1229/9741 [00:04<00:26, 317.20it/s] 13%|██████▋                                             | 1262/9741 [00:04<00:26, 318.42it/s] 13%|██████▉                                             | 1295/9741 [00:04<00:26, 319.46it/s] 14%|███████                                             | 1328/9741 [00:04<00:26, 319.87it/s] 14%|███████▎                                            | 1360/9741 [00:04<00:26, 317.40it/s] 14%|███████▍                                            | 1392/9741 [00:05<00:26, 318.07it/s] 15%|███████▌                                            | 1425/9741 [00:05<00:26, 318.92it/s] 15%|███████▊                                            | 1458/9741 [00:05<00:25, 319.40it/s] 15%|███████▉                                            | 1491/9741 [00:05<00:25, 319.69it/s] 16%|████████▏                                           | 1524/9741 [00:05<00:25, 319.97it/s] 16%|████████▎                                           | 1557/9741 [00:05<00:25, 320.48it/s] 16%|████████▍                                           | 1590/9741 [00:05<00:25, 316.77it/s] 17%|████████▋                                           | 1622/9741 [00:05<00:25, 317.64it/s] 17%|████████▊                                           | 1655/9741 [00:05<00:25, 318.53it/s] 17%|█████████                                           | 1687/9741 [00:05<00:25, 318.57it/s] 18%|█████████▏                                          | 1719/9741 [00:06<00:25, 318.66it/s] 18%|█████████▎                                          | 1752/9741 [00:06<00:25, 319.10it/s] 18%|█████████▌                                          | 1785/9741 [00:06<00:24, 319.64it/s] 19%|█████████▋                                          | 1817/9741 [00:06<00:27, 290.49it/s] 19%|█████████▉                                          | 1850/9741 [00:06<00:26, 298.84it/s] 19%|██████████                                          | 1883/9741 [00:06<00:25, 305.05it/s] 20%|██████████▏                                         | 1916/9741 [00:06<00:25, 309.61it/s] 20%|██████████▍                                         | 1949/9741 [00:06<00:24, 312.70it/s] 20%|██████████▌                                         | 1982/9741 [00:06<00:24, 315.21it/s] 21%|██████████▊                                         | 2014/9741 [00:07<00:24, 316.00it/s] 21%|██████████▉                                         | 2046/9741 [00:07<00:24, 315.17it/s] 21%|███████████                                         | 2079/9741 [00:07<00:24, 316.68it/s] 22%|███████████▎                                        | 2111/9741 [00:07<00:24, 316.53it/s] 22%|███████████▍                                        | 2143/9741 [00:07<00:23, 316.87it/s] 22%|███████████▌                                        | 2176/9741 [00:07<00:23, 318.00it/s] 23%|███████████▊                                        | 2209/9741 [00:07<00:23, 318.74it/s] 23%|███████████▉                                        | 2242/9741 [00:07<00:23, 319.29it/s] 23%|████████████▏                                       | 2274/9741 [00:07<00:23, 317.15it/s] 24%|████████████▎                                       | 2307/9741 [00:07<00:23, 318.43it/s] 24%|████████████▍                                       | 2340/9741 [00:08<00:23, 319.01it/s] 24%|████████████▋                                       | 2373/9741 [00:08<00:23, 319.81it/s] 25%|████████████▊                                       | 2406/9741 [00:08<00:22, 320.41it/s] 25%|█████████████                                       | 2439/9741 [00:08<00:22, 320.68it/s] 25%|█████████████▏                                      | 2472/9741 [00:08<00:22, 318.46it/s] 26%|█████████████▎                                      | 2504/9741 [00:08<00:22, 318.80it/s] 26%|█████████████▌                                      | 2536/9741 [00:08<00:22, 319.09it/s] 26%|█████████████▋                                      | 2568/9741 [00:08<00:22, 319.07it/s] 27%|█████████████▉                                      | 2601/9741 [00:08<00:22, 319.72it/s] 27%|██████████████                                      | 2634/9741 [00:08<00:22, 319.98it/s] 27%|██████████████▏                                     | 2666/9741 [00:09<00:22, 319.37it/s] 28%|██████████████▍                                     | 2698/9741 [00:09<00:22, 317.30it/s] 28%|██████████████▌                                     | 2731/9741 [00:09<00:22, 318.18it/s] 28%|██████████████▊                                     | 2764/9741 [00:09<00:21, 318.75it/s] 29%|██████████████▉                                     | 2797/9741 [00:09<00:21, 319.21it/s] 29%|███████████████                                     | 2830/9741 [00:09<00:21, 319.67it/s] 29%|███████████████▎                                    | 2863/9741 [00:09<00:21, 320.16it/s] 30%|███████████████▍                                    | 2896/9741 [00:09<00:21, 320.51it/s] 30%|███████████████▋                                    | 2929/9741 [00:09<00:21, 318.57it/s] 30%|███████████████▊                                    | 2961/9741 [00:09<00:21, 318.86it/s] 31%|███████████████▉                                    | 2993/9741 [00:10<00:21, 318.84it/s] 31%|████████████████▏                                   | 3025/9741 [00:10<00:21, 318.99it/s] 31%|████████████████▎                                   | 3057/9741 [00:10<00:20, 319.11it/s] 32%|████████████████▍                                   | 3089/9741 [00:10<00:20, 319.33it/s] 32%|████████████████▋                                   | 3121/9741 [00:10<00:20, 319.48it/s] 32%|████████████████▊                                   | 3153/9741 [00:10<00:20, 317.15it/s] 33%|█████████████████                                   | 3186/9741 [00:10<00:20, 318.20it/s] 33%|█████████████████▏                                  | 3218/9741 [00:10<00:20, 318.69it/s] 33%|█████████████████▎                                  | 3251/9741 [00:10<00:20, 319.64it/s] 34%|█████████████████▌                                  | 3284/9741 [00:11<00:20, 320.02it/s] 34%|█████████████████▋                                  | 3317/9741 [00:11<00:20, 320.32it/s] 34%|█████████████████▉                                  | 3350/9741 [00:11<00:19, 320.47it/s] 35%|██████████████████                                  | 3383/9741 [00:11<00:19, 318.22it/s] 35%|██████████████████▏                                 | 3416/9741 [00:11<00:19, 319.09it/s] 35%|██████████████████▍                                 | 3449/9741 [00:11<00:19, 319.49it/s] 36%|██████████████████▌                                 | 3481/9741 [00:11<00:19, 319.60it/s] 36%|██████████████████▊                                 | 3513/9741 [00:11<00:19, 319.59it/s] 36%|██████████████████▉                                 | 3545/9741 [00:11<00:19, 319.15it/s] 37%|███████████████████                                 | 3578/9741 [00:11<00:19, 319.49it/s] 37%|███████████████████▎                                | 3610/9741 [00:12<00:19, 317.59it/s] 37%|███████████████████▍                                | 3643/9741 [00:12<00:19, 318.59it/s] 38%|███████████████████▌                                | 3676/9741 [00:12<00:19, 319.13it/s] 38%|███████████████████▊                                | 3709/9741 [00:12<00:18, 319.74it/s] 38%|███████████████████▉                                | 3741/9741 [00:12<00:18, 317.17it/s] 39%|████████████████████▏                               | 3774/9741 [00:12<00:18, 318.24it/s] 39%|████████████████████▎                               | 3807/9741 [00:12<00:18, 318.90it/s] 39%|████████████████████▍                               | 3839/9741 [00:12<00:18, 317.15it/s] 40%|████████████████████▋                               | 3871/9741 [00:12<00:18, 317.86it/s] 40%|████████████████████▊                               | 3904/9741 [00:12<00:18, 318.88it/s] 40%|█████████████████████                               | 3937/9741 [00:13<00:18, 319.31it/s] 41%|█████████████████████▏                              | 3970/9741 [00:13<00:18, 319.61it/s] 41%|█████████████████████▎                              | 4003/9741 [00:13<00:17, 320.03it/s] 41%|█████████████████████▌                              | 4036/9741 [00:13<00:17, 320.45it/s] 42%|█████████████████████▋                              | 4069/9741 [00:13<00:17, 317.45it/s] 42%|█████████████████████▉                              | 4101/9741 [00:13<00:17, 317.83it/s] 42%|██████████████████████                              | 4134/9741 [00:13<00:17, 318.61it/s] 43%|██████████████████████▏                             | 4167/9741 [00:13<00:17, 319.15it/s] 43%|██████████████████████▍                             | 4200/9741 [00:13<00:17, 319.48it/s] 43%|██████████████████████▌                             | 4233/9741 [00:13<00:17, 319.76it/s] 44%|██████████████████████▊                             | 4265/9741 [00:14<00:17, 317.54it/s] 44%|██████████████████████▉                             | 4297/9741 [00:14<00:17, 316.31it/s] 44%|███████████████████████                             | 4330/9741 [00:14<00:17, 317.46it/s] 45%|███████████████████████▎                            | 4362/9741 [00:14<00:16, 318.15it/s] 45%|███████████████████████▍                            | 4395/9741 [00:14<00:16, 318.87it/s] 45%|███████████████████████▋                            | 4427/9741 [00:14<00:16, 318.98it/s] 46%|███████████████████████▊                            | 4459/9741 [00:14<00:16, 319.14it/s] 46%|███████████████████████▉                            | 4492/9741 [00:14<00:16, 319.54it/s] 46%|████████████████████████▏                           | 4524/9741 [00:14<00:18, 288.54it/s] 47%|████████████████████████▎                           | 4556/9741 [00:15<00:17, 297.20it/s] 47%|████████████████████████▍                           | 4589/9741 [00:15<00:16, 303.97it/s] 47%|████████████████████████▋                           | 4622/9741 [00:15<00:16, 308.89it/s] 48%|████████████████████████▊                           | 4655/9741 [00:15<00:16, 312.47it/s] 48%|█████████████████████████                           | 4688/9741 [00:15<00:16, 314.73it/s] 48%|█████████████████████████▏                          | 4721/9741 [00:15<00:15, 316.34it/s] 49%|█████████████████████████▎                          | 4753/9741 [00:15<00:22, 226.19it/s] 49%|█████████████████████████▌                          | 4785/9741 [00:15<00:20, 247.38it/s] 49%|█████████████████████████▋                          | 4817/9741 [00:15<00:18, 265.15it/s] 50%|█████████████████████████▉                          | 4849/9741 [00:16<00:17, 279.30it/s] 50%|██████████████████████████                          | 4881/9741 [00:16<00:16, 290.05it/s] 50%|██████████████████████████▏                         | 4914/9741 [00:16<00:16, 298.64it/s] 51%|██████████████████████████▍                         | 4946/9741 [00:16<00:15, 302.98it/s] 51%|██████████████████████████▌                         | 4979/9741 [00:16<00:15, 308.06it/s] 51%|██████████████████████████▊                         | 5011/9741 [00:16<00:15, 311.42it/s] 52%|██████████████████████████▉                         | 5043/9741 [00:16<00:14, 313.64it/s] 52%|███████████████████████████                         | 5075/9741 [00:16<00:14, 315.33it/s] 52%|███████████████████████████▎                        | 5107/9741 [00:16<00:14, 316.70it/s] 53%|███████████████████████████▍                        | 5140/9741 [00:16<00:14, 317.74it/s] 53%|███████████████████████████▌                        | 5172/9741 [00:17<00:14, 316.36it/s] 53%|███████████████████████████▊                        | 5204/9741 [00:17<00:14, 317.27it/s] 54%|███████████████████████████▉                        | 5236/9741 [00:17<00:14, 318.02it/s] 54%|████████████████████████████                        | 5268/9741 [00:17<00:14, 318.33it/s] 54%|████████████████████████████▎                       | 5300/9741 [00:17<00:14, 316.42it/s] 55%|████████████████████████████▍                       | 5332/9741 [00:17<00:13, 317.18it/s] 55%|████████████████████████████▋                       | 5364/9741 [00:17<00:13, 317.77it/s] 55%|████████████████████████████▊                       | 5396/9741 [00:17<00:13, 318.07it/s] 56%|████████████████████████████▉                       | 5428/9741 [00:17<00:13, 315.95it/s] 56%|█████████████████████████████▏                      | 5460/9741 [00:18<00:13, 317.00it/s] 56%|█████████████████████████████▎                      | 5493/9741 [00:18<00:13, 319.95it/s] 57%|█████████████████████████████▌                      | 5527/9741 [00:18<00:13, 323.22it/s] 57%|█████████████████████████████▋                      | 5561/9741 [00:18<00:12, 325.51it/s] 57%|█████████████████████████████▊                      | 5594/9741 [00:18<00:12, 326.59it/s] 58%|██████████████████████████████                      | 5627/9741 [00:18<00:12, 325.53it/s] 58%|██████████████████████████████▏                     | 5661/9741 [00:18<00:12, 326.88it/s] 58%|██████████████████████████████▍                     | 5695/9741 [00:18<00:12, 327.91it/s] 59%|██████████████████████████████▌                     | 5729/9741 [00:18<00:12, 328.59it/s] 59%|██████████████████████████████▊                     | 5762/9741 [00:18<00:12, 328.85it/s] 60%|██████████████████████████████▉                     | 5796/9741 [00:19<00:11, 329.29it/s] 60%|███████████████████████████████                     | 5829/9741 [00:19<00:11, 329.31it/s] 60%|███████████████████████████████▎                    | 5862/9741 [00:19<00:12, 322.24it/s] 61%|███████████████████████████████▍                    | 5895/9741 [00:19<00:11, 324.44it/s] 61%|███████████████████████████████▋                    | 5928/9741 [00:19<00:11, 326.04it/s] 61%|███████████████████████████████▊                    | 5962/9741 [00:19<00:11, 327.39it/s] 62%|████████████████████████████████                    | 5995/9741 [00:19<00:11, 328.08it/s] 62%|████████████████████████████████▏                   | 6029/9741 [00:19<00:11, 328.68it/s] 62%|████████████████████████████████▎                   | 6063/9741 [00:19<00:11, 329.11it/s] 63%|████████████████████████████████▌                   | 6096/9741 [00:19<00:11, 326.34it/s] 63%|████████████████████████████████▋                   | 6129/9741 [00:20<00:11, 326.42it/s] 63%|████████████████████████████████▉                   | 6162/9741 [00:20<00:10, 327.16it/s] 64%|█████████████████████████████████                   | 6195/9741 [00:20<00:10, 327.93it/s] 64%|█████████████████████████████████▏                  | 6228/9741 [00:20<00:10, 328.14it/s] 64%|█████████████████████████████████▍                  | 6261/9741 [00:20<00:10, 328.13it/s] 65%|█████████████████████████████████▌                  | 6294/9741 [00:20<00:10, 328.51it/s] 65%|█████████████████████████████████▊                  | 6327/9741 [00:20<00:10, 326.03it/s] 65%|█████████████████████████████████▉                  | 6360/9741 [00:20<00:10, 327.02it/s] 66%|██████████████████████████████████▏                 | 6393/9741 [00:20<00:10, 327.54it/s] 66%|██████████████████████████████████▎                 | 6426/9741 [00:20<00:10, 324.80it/s] 66%|██████████████████████████████████▍                 | 6459/9741 [00:21<00:10, 325.55it/s] 67%|██████████████████████████████████▋                 | 6492/9741 [00:21<00:09, 326.49it/s] 67%|██████████████████████████████████▊                 | 6525/9741 [00:21<00:09, 326.98it/s] 67%|███████████████████████████████████                 | 6558/9741 [00:21<00:09, 325.45it/s] 68%|███████████████████████████████████▏                | 6591/9741 [00:21<00:09, 326.31it/s] 68%|███████████████████████████████████▎                | 6624/9741 [00:21<00:09, 327.05it/s] 68%|███████████████████████████████████▌                | 6657/9741 [00:21<00:09, 327.79it/s] 69%|███████████████████████████████████▋                | 6690/9741 [00:21<00:09, 328.14it/s] 69%|███████████████████████████████████▉                | 6723/9741 [00:21<00:09, 328.49it/s] 69%|████████████████████████████████████                | 6757/9741 [00:21<00:09, 329.05it/s] 70%|████████████████████████████████████▏               | 6790/9741 [00:22<00:09, 326.78it/s] 70%|████████████████████████████████████▍               | 6823/9741 [00:22<00:08, 327.52it/s] 70%|████████████████████████████████████▌               | 6856/9741 [00:22<00:08, 327.84it/s] 71%|████████████████████████████████████▊               | 6889/9741 [00:22<00:08, 328.22it/s] 71%|████████████████████████████████████▉               | 6922/9741 [00:22<00:08, 328.50it/s] 71%|█████████████████████████████████████▏              | 6955/9741 [00:22<00:08, 328.69it/s] 72%|█████████████████████████████████████▎              | 6988/9741 [00:22<00:08, 326.53it/s] 72%|█████████████████████████████████████▍              | 7021/9741 [00:22<00:08, 326.95it/s] 72%|█████████████████████████████████████▋              | 7055/9741 [00:22<00:08, 327.87it/s] 73%|█████████████████████████████████████▊              | 7088/9741 [00:22<00:08, 328.39it/s] 73%|██████████████████████████████████████              | 7121/9741 [00:23<00:08, 326.97it/s] 73%|██████████████████████████████████████▏             | 7154/9741 [00:23<00:07, 327.57it/s] 74%|██████████████████████████████████████▎             | 7187/9741 [00:23<00:07, 328.11it/s] 74%|██████████████████████████████████████▌             | 7220/9741 [00:23<00:07, 325.92it/s] 74%|██████████████████████████████████████▋             | 7253/9741 [00:23<00:07, 326.62it/s] 75%|██████████████████████████████████████▉             | 7286/9741 [00:23<00:07, 327.49it/s] 75%|███████████████████████████████████████             | 7319/9741 [00:23<00:07, 327.90it/s] 75%|███████████████████████████████████████▏            | 7352/9741 [00:23<00:07, 328.37it/s] 76%|███████████████████████████████████████▍            | 7385/9741 [00:23<00:07, 328.74it/s] 76%|███████████████████████████████████████▌            | 7418/9741 [00:23<00:07, 328.88it/s] 76%|███████████████████████████████████████▊            | 7451/9741 [00:24<00:07, 293.60it/s] 77%|███████████████████████████████████████▉            | 7484/9741 [00:24<00:07, 303.17it/s] 77%|████████████████████████████████████████▏           | 7517/9741 [00:24<00:07, 310.18it/s] 78%|████████████████████████████████████████▎           | 7550/9741 [00:24<00:06, 315.48it/s] 78%|████████████████████████████████████████▍           | 7583/9741 [00:24<00:06, 319.22it/s] 78%|████████████████████████████████████████▋           | 7616/9741 [00:24<00:06, 322.06it/s] 79%|████████████████████████████████████████▊           | 7649/9741 [00:24<00:06, 323.91it/s] 79%|█████████████████████████████████████████           | 7682/9741 [00:24<00:06, 323.02it/s] 79%|█████████████████████████████████████████▏          | 7715/9741 [00:24<00:06, 324.83it/s] 80%|█████████████████████████████████████████▎          | 7748/9741 [00:25<00:06, 325.87it/s] 80%|█████████████████████████████████████████▌          | 7781/9741 [00:25<00:06, 326.59it/s] 80%|█████████████████████████████████████████▋          | 7814/9741 [00:25<00:05, 327.14it/s] 81%|█████████████████████████████████████████▉          | 7847/9741 [00:25<00:05, 327.03it/s] 81%|██████████████████████████████████████████          | 7880/9741 [00:25<00:05, 327.21it/s] 81%|██████████████████████████████████████████▏         | 7913/9741 [00:25<00:05, 325.23it/s] 82%|██████████████████████████████████████████▍         | 7946/9741 [00:25<00:05, 326.06it/s] 82%|██████████████████████████████████████████▌         | 7979/9741 [00:25<00:05, 326.60it/s] 82%|██████████████████████████████████████████▊         | 8012/9741 [00:25<00:05, 326.88it/s] 83%|██████████████████████████████████████████▉         | 8045/9741 [00:25<00:05, 327.06it/s] 83%|███████████████████████████████████████████         | 8078/9741 [00:26<00:05, 326.99it/s] 83%|███████████████████████████████████████████▎        | 8111/9741 [00:26<00:04, 327.49it/s] 84%|███████████████████████████████████████████▍        | 8144/9741 [00:26<00:04, 325.58it/s] 84%|███████████████████████████████████████████▋        | 8177/9741 [00:26<00:04, 326.20it/s] 84%|███████████████████████████████████████████▊        | 8210/9741 [00:26<00:04, 326.69it/s] 85%|████████████████████████████████████████████        | 8243/9741 [00:26<00:04, 327.00it/s] 85%|████████████████████████████████████████████▏       | 8276/9741 [00:26<00:04, 326.91it/s] 85%|████████████████████████████████████████████▎       | 8309/9741 [00:26<00:04, 326.91it/s] 86%|████████████████████████████████████████████▌       | 8342/9741 [00:26<00:04, 327.28it/s] 86%|████████████████████████████████████████████▋       | 8375/9741 [00:26<00:04, 325.39it/s] 86%|████████████████████████████████████████████▉       | 8408/9741 [00:27<00:04, 325.88it/s] 87%|█████████████████████████████████████████████       | 8441/9741 [00:27<00:03, 326.75it/s] 87%|█████████████████████████████████████████████▏      | 8474/9741 [00:27<00:03, 326.87it/s] 87%|█████████████████████████████████████████████▍      | 8507/9741 [00:27<00:03, 327.31it/s] 88%|█████████████████████████████████████████████▌      | 8540/9741 [00:27<00:03, 327.07it/s] 88%|█████████████████████████████████████████████▊      | 8573/9741 [00:27<00:03, 326.59it/s] 88%|█████████████████████████████████████████████▉      | 8606/9741 [00:27<00:03, 324.37it/s] 89%|██████████████████████████████████████████████      | 8639/9741 [00:27<00:03, 325.14it/s] 89%|██████████████████████████████████████████████▎     | 8672/9741 [00:27<00:03, 325.67it/s] 89%|██████████████████████████████████████████████▍     | 8705/9741 [00:27<00:03, 326.27it/s] 90%|██████████████████████████████████████████████▋     | 8738/9741 [00:28<00:03, 326.45it/s] 90%|██████████████████████████████████████████████▊     | 8771/9741 [00:28<00:02, 326.71it/s] 90%|██████████████████████████████████████████████▉     | 8804/9741 [00:28<00:02, 324.73it/s] 91%|███████████████████████████████████████████████▏    | 8837/9741 [00:28<00:02, 325.55it/s] 91%|███████████████████████████████████████████████▎    | 8870/9741 [00:28<00:02, 326.16it/s] 91%|███████████████████████████████████████████████▌    | 8903/9741 [00:28<00:02, 326.76it/s] 92%|███████████████████████████████████████████████▋    | 8936/9741 [00:28<00:02, 326.45it/s] 92%|███████████████████████████████████████████████▉    | 8969/9741 [00:28<00:02, 325.10it/s] 92%|████████████████████████████████████████████████    | 9002/9741 [00:28<00:02, 324.93it/s] 93%|████████████████████████████████████████████████▏   | 9035/9741 [00:28<00:02, 323.45it/s] 93%|████████████████████████████████████████████████▍   | 9068/9741 [00:29<00:02, 324.52it/s] 93%|████████████████████████████████████████████████▌   | 9101/9741 [00:29<00:01, 325.35it/s] 94%|████████████████████████████████████████████████▊   | 9134/9741 [00:29<00:01, 325.84it/s] 94%|████████████████████████████████████████████████▉   | 9167/9741 [00:29<00:01, 326.24it/s] 94%|█████████████████████████████████████████████████   | 9200/9741 [00:29<00:01, 326.67it/s] 95%|█████████████████████████████████████████████████▎  | 9233/9741 [00:29<00:01, 326.60it/s] 95%|█████████████████████████████████████████████████▍  | 9266/9741 [00:29<00:01, 324.36it/s] 95%|█████████████████████████████████████████████████▋  | 9299/9741 [00:29<00:01, 323.37it/s] 96%|█████████████████████████████████████████████████▊  | 9332/9741 [00:29<00:01, 324.07it/s] 96%|█████████████████████████████████████████████████▉  | 9365/9741 [00:29<00:01, 324.89it/s] 96%|██████████████████████████████████████████████████▏ | 9398/9741 [00:30<00:01, 325.56it/s] 97%|██████████████████████████████████████████████████▎ | 9431/9741 [00:30<00:00, 326.11it/s] 97%|██████████████████████████████████████████████████▌ | 9464/9741 [00:30<00:00, 326.29it/s] 97%|██████████████████████████████████████████████████▋ | 9497/9741 [00:30<00:00, 324.28it/s] 98%|██████████████████████████████████████████████████▊ | 9530/9741 [00:30<00:00, 325.10it/s] 98%|███████████████████████████████████████████████████ | 9563/9741 [00:30<00:00, 325.57it/s] 99%|███████████████████████████████████████████████████▏| 9596/9741 [00:30<00:00, 325.90it/s] 99%|███████████████████████████████████████████████████▍| 9629/9741 [00:30<00:00, 326.27it/s] 99%|███████████████████████████████████████████████████▌| 9662/9741 [00:30<00:00, 326.30it/s]100%|███████████████████████████████████████████████████▊| 9695/9741 [00:30<00:00, 326.30it/s]100%|███████████████████████████████████████████████████▉| 9728/9741 [00:31<00:00, 323.84it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:31<00:00, 312.77it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.03s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.15s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.99s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:04,  4.99s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.09s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.30s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.41s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.42s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.57s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.58s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.52s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
[2023-08-21 23:34:52,566] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.85s/it]
[2023-08-21 23:35:01,740] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 23:35:01,742] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 23:35:01,742] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 23:35:01,742] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 23:35:01,742] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 23:35:01,742] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f0daab25fd0>
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 23:35:01,743] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f0daa93a220>
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 23:35:01,744] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 23:35:01,745] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 23:35:01,745] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 23:35:01,745] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5097558498382568 seconds
Loading extension module utils...
Time to load utils op: 0.5045599937438965 seconds
Loading extension module utils...
Time to load utils op: 0.40436673164367676 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]Time to load utils op: 0.40448832511901855 seconds
############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input: Noah, who loves his Grammy, calls her every week to talk about his day. If each call lasts 30 minutes and he is charged $0.05 per call minute, how much would he be billed if he makes the calls for a year?
Output: 78

Input: A merchant bought 15 keyboards and 25 printers for a total of $2050. If a keyboard costs $20, how much does a printer cost?
Output: 70

Input: Gina has two bank accounts. Each account has a quarter of the balance in Betty's account. If Betty's account balance is $3,456, what is the combined balance of both Gina's accounts?
Output: 1728

Input: Zain has 10 more of each coin than Emerie. If Emerie has six quarters, seven dimes, and five nickels, how many coins does Zain have?
Output: 48

Input: Adonis is playing a prank on his dad by replacing his shampoo with hot sauce. Every day, after his dad showers, Adonis replaces the shampoo with 1/2 an ounce of hot sauce. He knows his dad uses 1 oz of shampoo a day from a new 10 oz bottle that no one else uses. After 4 days, what percentage of the liquid in the bottle is hot sauce?
Output: 25

Input: Lana and Mike are taking their dog and renting a cabin in the mountains for 2 weeks.  The daily rate is $125.00  There is a $100.00 pet fee.  There is also a 20% service/cleaning fee for the rental.  They need to pay 50% of the entire bill as a security deposit.  How much is their security deposit?
Output: 1110

Input: Abigail is trying a new recipe for a cold drink. It uses 1/4 of a cup of iced tea and 1 and 1/4 of a cup of lemonade to make one drink. If she fills a pitcher with 18 total cups of this drink, how many cups of lemonade are in the pitcher?
Output: 15

Input: John buys a vacuum cleaner for $250 and a dishwasher for $450.  She has a $75 off coupon.  How much did he spend?
Output: 625

Input: Dany owns a farm, in his farm he has 4 cows and 3 sheep that eat 2 bushels a day. He also has 7 chickens that eat 3 bushels a day. How many bushels should he have to suffice the animals for a day?
Output: 35

Input: The town of Belize has 400 homes. One fourth of the town's homes are white. One fifth of the non-white homes have a fireplace. How many of the non-white homes do not have a fireplace?
Output: 240

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o23-tgsm8k-s10-rFalse
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3455544) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_23:35:07
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3455545)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-21_23:35:07
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3455546)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-21_23:35:07
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3455547)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_23:35:07
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3455544)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o24-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 24
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 23:35:11,129] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o24-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 24
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o24-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 20/9741 [00:00<00:48, 199.86it/s]  0%|▏                                                     | 41/9741 [00:00<00:48, 200.67it/s]  1%|▎                                                     | 62/9741 [00:00<00:48, 200.81it/s]  1%|▍                                                     | 83/9741 [00:00<00:48, 200.81it/s]  1%|▌                                                    | 104/9741 [00:00<00:47, 201.02it/s]  1%|▋                                                    | 125/9741 [00:00<00:47, 200.62it/s]  1%|▊                                                    | 146/9741 [00:00<00:48, 197.90it/s]  2%|▉                                                    | 166/9741 [00:00<00:48, 198.40it/s]  2%|█                                                    | 186/9741 [00:00<00:48, 198.41it/s]  2%|█                                                    | 206/9741 [00:01<00:48, 196.81it/s]  2%|█▏                                                   | 226/9741 [00:01<00:48, 197.52it/s]  3%|█▎                                                   | 246/9741 [00:01<00:47, 197.96it/s]  3%|█▍                                                   | 266/9741 [00:01<00:47, 198.26it/s]  3%|█▌                                                   | 286/9741 [00:01<00:47, 198.45it/s]  3%|█▋                                                   | 306/9741 [00:01<00:47, 198.72it/s]  3%|█▊                                                   | 326/9741 [00:01<00:47, 198.65it/s]  4%|█▉                                                   | 346/9741 [00:01<00:47, 196.66it/s]  4%|█▉                                                   | 366/9741 [00:01<00:47, 197.08it/s]  4%|██                                                   | 386/9741 [00:01<00:47, 197.76it/s]  4%|██▏                                                  | 406/9741 [00:02<00:47, 198.08it/s]  4%|██▎                                                  | 426/9741 [00:02<00:46, 198.40it/s]  5%|██▍                                                  | 446/9741 [00:02<00:47, 195.87it/s]  5%|██▌                                                  | 472/9741 [00:02<00:43, 214.32it/s]  5%|██▋                                                  | 502/9741 [00:02<00:38, 238.62it/s]  5%|██▉                                                  | 533/9741 [00:02<00:35, 258.99it/s]  6%|███                                                  | 564/9741 [00:02<00:33, 272.62it/s]  6%|███▏                                                 | 595/9741 [00:02<00:32, 282.05it/s]  6%|███▍                                                 | 626/9741 [00:02<00:31, 288.73it/s]  7%|███▌                                                 | 656/9741 [00:02<00:31, 291.14it/s]  7%|███▋                                                 | 687/9741 [00:03<00:30, 294.94it/s]  7%|███▉                                                 | 718/9741 [00:03<00:30, 297.63it/s]  8%|████                                                 | 749/9741 [00:03<00:30, 299.60it/s]  8%|████▏                                                | 780/9741 [00:03<00:29, 301.24it/s]  8%|████▍                                                | 811/9741 [00:03<00:29, 302.29it/s]  9%|████▌                                                | 842/9741 [00:03<00:29, 303.04it/s]  9%|████▋                                                | 873/9741 [00:03<00:29, 303.62it/s]  9%|████▉                                                | 904/9741 [00:03<00:29, 301.68it/s] 10%|█████                                                | 935/9741 [00:03<00:29, 302.45it/s] 10%|█████▎                                               | 966/9741 [00:03<00:28, 303.10it/s] 10%|█████▍                                               | 997/9741 [00:04<00:28, 303.41it/s] 11%|█████▍                                              | 1028/9741 [00:04<00:28, 303.79it/s] 11%|█████▋                                              | 1059/9741 [00:04<00:28, 304.02it/s] 11%|█████▊                                              | 1090/9741 [00:04<00:28, 304.11it/s] 12%|█████▉                                              | 1121/9741 [00:04<00:28, 301.95it/s] 12%|██████▏                                             | 1152/9741 [00:04<00:28, 302.73it/s] 12%|██████▎                                             | 1183/9741 [00:04<00:28, 303.16it/s] 12%|██████▍                                             | 1214/9741 [00:04<00:28, 303.17it/s] 13%|██████▋                                             | 1245/9741 [00:04<00:28, 303.32it/s] 13%|██████▊                                             | 1276/9741 [00:05<00:28, 300.96it/s] 13%|██████▉                                             | 1307/9741 [00:05<00:27, 301.88it/s] 14%|███████▏                                            | 1338/9741 [00:05<00:28, 299.89it/s] 14%|███████▎                                            | 1369/9741 [00:05<00:27, 301.19it/s] 14%|███████▍                                            | 1400/9741 [00:05<00:27, 299.53it/s] 15%|███████▋                                            | 1431/9741 [00:05<00:27, 300.31it/s] 15%|███████▊                                            | 1462/9741 [00:05<00:27, 301.12it/s] 15%|███████▉                                            | 1493/9741 [00:05<00:27, 301.74it/s] 16%|████████▏                                           | 1524/9741 [00:05<00:27, 302.13it/s] 16%|████████▎                                           | 1555/9741 [00:05<00:27, 302.72it/s] 16%|████████▍                                           | 1586/9741 [00:06<00:27, 298.91it/s] 17%|████████▋                                           | 1617/9741 [00:06<00:27, 300.05it/s] 17%|████████▊                                           | 1648/9741 [00:06<00:26, 301.23it/s] 17%|████████▉                                           | 1679/9741 [00:06<00:26, 301.93it/s] 18%|█████████▏                                          | 1710/9741 [00:06<00:26, 302.42it/s] 18%|█████████▎                                          | 1741/9741 [00:06<00:26, 302.76it/s] 18%|█████████▍                                          | 1772/9741 [00:06<00:26, 302.58it/s] 19%|█████████▌                                          | 1803/9741 [00:06<00:29, 273.01it/s] 19%|█████████▊                                          | 1834/9741 [00:06<00:28, 281.23it/s] 19%|█████████▉                                          | 1865/9741 [00:06<00:27, 287.21it/s] 19%|██████████                                          | 1896/9741 [00:07<00:26, 291.55it/s] 20%|██████████▎                                         | 1927/9741 [00:07<00:26, 294.37it/s] 20%|██████████▍                                         | 1958/9741 [00:07<00:26, 296.37it/s] 20%|██████████▌                                         | 1989/9741 [00:07<00:25, 298.27it/s] 21%|██████████▊                                         | 2019/9741 [00:07<00:25, 297.47it/s] 21%|██████████▉                                         | 2050/9741 [00:07<00:25, 298.92it/s] 21%|███████████                                         | 2081/9741 [00:07<00:25, 299.89it/s] 22%|███████████▎                                        | 2112/9741 [00:07<00:25, 300.76it/s] 22%|███████████▍                                        | 2143/9741 [00:07<00:25, 301.34it/s] 22%|███████████▌                                        | 2174/9741 [00:08<00:25, 301.50it/s] 23%|███████████▊                                        | 2205/9741 [00:08<00:24, 301.48it/s] 23%|███████████▉                                        | 2236/9741 [00:08<00:24, 301.30it/s] 23%|████████████                                        | 2267/9741 [00:08<00:24, 299.39it/s] 24%|████████████▎                                       | 2298/9741 [00:08<00:24, 300.25it/s] 24%|████████████▍                                       | 2329/9741 [00:08<00:24, 300.67it/s] 24%|████████████▌                                       | 2360/9741 [00:08<00:24, 301.29it/s] 25%|████████████▊                                       | 2391/9741 [00:08<00:24, 301.79it/s] 25%|████████████▉                                       | 2422/9741 [00:08<00:24, 302.22it/s] 25%|█████████████                                       | 2453/9741 [00:08<00:24, 302.39it/s] 26%|█████████████▎                                      | 2484/9741 [00:09<00:24, 300.24it/s] 26%|█████████████▍                                      | 2515/9741 [00:09<00:24, 300.78it/s] 26%|█████████████▌                                      | 2546/9741 [00:09<00:23, 300.79it/s] 26%|█████████████▊                                      | 2577/9741 [00:09<00:23, 301.19it/s] 27%|█████████████▉                                      | 2608/9741 [00:09<00:23, 301.70it/s] 27%|██████████████                                      | 2639/9741 [00:09<00:23, 301.70it/s] 27%|██████████████▎                                     | 2670/9741 [00:09<00:23, 302.05it/s] 28%|██████████████▍                                     | 2701/9741 [00:09<00:23, 299.47it/s] 28%|██████████████▌                                     | 2732/9741 [00:09<00:23, 299.98it/s] 28%|██████████████▋                                     | 2763/9741 [00:09<00:23, 300.61it/s] 29%|██████████████▉                                     | 2794/9741 [00:10<00:23, 300.88it/s] 29%|███████████████                                     | 2825/9741 [00:10<00:22, 301.27it/s] 29%|███████████████▏                                    | 2856/9741 [00:10<00:22, 301.74it/s] 30%|███████████████▍                                    | 2887/9741 [00:10<00:22, 301.92it/s] 30%|███████████████▌                                    | 2918/9741 [00:10<00:22, 302.22it/s] 30%|███████████████▋                                    | 2949/9741 [00:10<00:22, 299.94it/s] 31%|███████████████▉                                    | 2980/9741 [00:10<00:22, 300.72it/s] 31%|████████████████                                    | 3011/9741 [00:10<00:22, 301.38it/s] 31%|████████████████▏                                   | 3042/9741 [00:10<00:22, 301.57it/s] 32%|████████████████▍                                   | 3073/9741 [00:11<00:22, 301.24it/s] 32%|████████████████▌                                   | 3104/9741 [00:11<00:22, 301.34it/s] 32%|████████████████▋                                   | 3135/9741 [00:11<00:21, 301.55it/s] 33%|████████████████▉                                   | 3166/9741 [00:11<00:21, 299.45it/s] 33%|█████████████████                                   | 3197/9741 [00:11<00:21, 300.44it/s] 33%|█████████████████▏                                  | 3228/9741 [00:11<00:21, 300.90it/s] 33%|█████████████████▍                                  | 3259/9741 [00:11<00:21, 301.58it/s] 34%|█████████████████▌                                  | 3290/9741 [00:11<00:21, 301.58it/s] 34%|█████████████████▋                                  | 3321/9741 [00:11<00:21, 301.77it/s] 34%|█████████████████▉                                  | 3352/9741 [00:11<00:21, 301.75it/s] 35%|██████████████████                                  | 3383/9741 [00:12<00:21, 299.67it/s] 35%|██████████████████▏                                 | 3414/9741 [00:12<00:21, 300.52it/s] 35%|██████████████████▍                                 | 3445/9741 [00:12<00:21, 298.81it/s] 36%|██████████████████▌                                 | 3476/9741 [00:12<00:20, 299.56it/s] 36%|██████████████████▋                                 | 3506/9741 [00:12<00:20, 298.68it/s] 36%|██████████████████▉                                 | 3537/9741 [00:12<00:20, 299.24it/s] 37%|███████████████████                                 | 3568/9741 [00:12<00:20, 299.84it/s] 37%|███████████████████▏                                | 3598/9741 [00:12<00:20, 299.65it/s] 37%|███████████████████▎                                | 3628/9741 [00:12<00:20, 295.71it/s] 38%|███████████████████▌                                | 3659/9741 [00:12<00:20, 297.36it/s] 38%|███████████████████▋                                | 3690/9741 [00:13<00:20, 298.69it/s] 38%|███████████████████▊                                | 3721/9741 [00:13<00:20, 299.92it/s] 39%|████████████████████                                | 3752/9741 [00:13<00:19, 300.60it/s] 39%|████████████████████▏                               | 3783/9741 [00:13<00:19, 300.98it/s] 39%|████████████████████▎                               | 3814/9741 [00:13<00:19, 298.91it/s] 39%|████████████████████▌                               | 3844/9741 [00:13<00:19, 295.42it/s] 40%|████████████████████▋                               | 3875/9741 [00:13<00:19, 297.34it/s] 40%|████████████████████▊                               | 3906/9741 [00:13<00:19, 298.77it/s] 40%|█████████████████████                               | 3937/9741 [00:13<00:19, 299.68it/s] 41%|█████████████████████▏                              | 3967/9741 [00:13<00:19, 297.98it/s] 41%|█████████████████████▎                              | 3998/9741 [00:14<00:19, 299.04it/s] 41%|█████████████████████▌                              | 4029/9741 [00:14<00:19, 300.00it/s] 42%|█████████████████████▋                              | 4060/9741 [00:14<00:19, 298.38it/s] 42%|█████████████████████▊                              | 4091/9741 [00:14<00:18, 299.40it/s] 42%|██████████████████████                              | 4122/9741 [00:14<00:18, 299.89it/s] 43%|██████████████████████▏                             | 4153/9741 [00:14<00:18, 300.48it/s] 43%|██████████████████████▎                             | 4184/9741 [00:14<00:18, 299.59it/s] 43%|██████████████████████▌                             | 4215/9741 [00:14<00:18, 299.89it/s] 44%|██████████████████████▋                             | 4246/9741 [00:14<00:18, 300.37it/s] 44%|██████████████████████▊                             | 4277/9741 [00:15<00:18, 300.89it/s] 44%|██████████████████████▉                             | 4308/9741 [00:15<00:18, 299.09it/s] 45%|███████████████████████▏                            | 4339/9741 [00:15<00:18, 299.81it/s] 45%|███████████████████████▎                            | 4369/9741 [00:15<00:17, 299.66it/s] 45%|███████████████████████▍                            | 4400/9741 [00:15<00:17, 300.31it/s] 45%|███████████████████████▋                            | 4431/9741 [00:15<00:17, 300.00it/s] 46%|███████████████████████▊                            | 4462/9741 [00:15<00:17, 300.23it/s] 46%|███████████████████████▉                            | 4493/9741 [00:15<00:17, 300.69it/s] 46%|████████████████████████▏                           | 4524/9741 [00:15<00:20, 260.43it/s] 47%|████████████████████████▎                           | 4555/9741 [00:16<00:19, 271.43it/s] 47%|████████████████████████▍                           | 4586/9741 [00:16<00:18, 279.85it/s] 47%|████████████████████████▋                           | 4617/9741 [00:16<00:17, 285.90it/s] 48%|████████████████████████▊                           | 4648/9741 [00:16<00:17, 290.20it/s] 48%|████████████████████████▉                           | 4679/9741 [00:16<00:17, 293.56it/s] 48%|█████████████████████████▏                          | 4710/9741 [00:16<00:17, 295.54it/s] 49%|█████████████████████████▎                          | 4740/9741 [00:16<00:23, 214.93it/s] 49%|█████████████████████████▍                          | 4770/9741 [00:16<00:21, 234.44it/s] 49%|█████████████████████████▋                          | 4801/9741 [00:16<00:19, 251.13it/s] 50%|█████████████████████████▊                          | 4832/9741 [00:17<00:18, 264.38it/s] 50%|█████████████████████████▉                          | 4862/9741 [00:17<00:17, 273.84it/s] 50%|██████████████████████████                          | 4893/9741 [00:17<00:17, 281.58it/s] 51%|██████████████████████████▎                         | 4924/9741 [00:17<00:16, 287.18it/s] 51%|██████████████████████████▍                         | 4954/9741 [00:17<00:16, 289.11it/s] 51%|██████████████████████████▌                         | 4985/9741 [00:17<00:16, 292.74it/s] 51%|██████████████████████████▊                         | 5016/9741 [00:17<00:15, 295.32it/s] 52%|██████████████████████████▉                         | 5046/9741 [00:17<00:15, 295.96it/s] 52%|███████████████████████████                         | 5077/9741 [00:17<00:15, 297.50it/s] 52%|███████████████████████████▎                        | 5108/9741 [00:17<00:15, 298.63it/s] 53%|███████████████████████████▍                        | 5139/9741 [00:18<00:15, 299.28it/s] 53%|███████████████████████████▌                        | 5170/9741 [00:18<00:15, 298.04it/s] 53%|███████████████████████████▊                        | 5201/9741 [00:18<00:15, 298.95it/s] 54%|███████████████████████████▉                        | 5232/9741 [00:18<00:15, 299.70it/s] 54%|████████████████████████████                        | 5262/9741 [00:18<00:15, 297.77it/s] 54%|████████████████████████████▎                       | 5293/9741 [00:18<00:14, 298.63it/s] 55%|████████████████████████████▍                       | 5324/9741 [00:18<00:14, 299.70it/s] 55%|████████████████████████████▌                       | 5355/9741 [00:18<00:14, 300.49it/s] 55%|████████████████████████████▊                       | 5386/9741 [00:18<00:14, 301.44it/s] 56%|████████████████████████████▉                       | 5417/9741 [00:19<00:14, 299.92it/s] 56%|█████████████████████████████                       | 5448/9741 [00:19<00:14, 300.93it/s] 56%|█████████████████████████████▏                      | 5479/9741 [00:19<00:14, 299.28it/s] 57%|█████████████████████████████▍                      | 5511/9741 [00:19<00:13, 303.19it/s] 57%|█████████████████████████████▌                      | 5543/9741 [00:19<00:13, 306.03it/s] 57%|█████████████████████████████▊                      | 5575/9741 [00:19<00:13, 307.85it/s] 58%|█████████████████████████████▉                      | 5607/9741 [00:19<00:13, 308.99it/s] 58%|██████████████████████████████                      | 5638/9741 [00:19<00:13, 307.01it/s] 58%|██████████████████████████████▎                     | 5670/9741 [00:19<00:13, 308.42it/s] 59%|██████████████████████████████▍                     | 5702/9741 [00:19<00:13, 309.68it/s] 59%|██████████████████████████████▌                     | 5733/9741 [00:20<00:13, 307.41it/s] 59%|██████████████████████████████▊                     | 5765/9741 [00:20<00:12, 308.88it/s] 60%|██████████████████████████████▉                     | 5797/9741 [00:20<00:12, 309.97it/s] 60%|███████████████████████████████                     | 5829/9741 [00:20<00:12, 310.50it/s] 60%|███████████████████████████████▎                    | 5861/9741 [00:20<00:12, 308.85it/s] 60%|███████████████████████████████▍                    | 5893/9741 [00:20<00:12, 309.80it/s] 61%|███████████████████████████████▋                    | 5925/9741 [00:20<00:12, 310.68it/s] 61%|███████████████████████████████▊                    | 5957/9741 [00:20<00:12, 311.34it/s] 61%|███████████████████████████████▉                    | 5989/9741 [00:20<00:12, 311.84it/s] 62%|████████████████████████████████▏                   | 6021/9741 [00:20<00:11, 310.09it/s] 62%|████████████████████████████████▎                   | 6053/9741 [00:21<00:11, 310.85it/s] 62%|████████████████████████████████▍                   | 6085/9741 [00:21<00:11, 309.08it/s] 63%|████████████████████████████████▋                   | 6117/9741 [00:21<00:11, 309.94it/s] 63%|████████████████████████████████▊                   | 6149/9741 [00:21<00:11, 310.44it/s] 63%|████████████████████████████████▉                   | 6181/9741 [00:21<00:11, 311.18it/s] 64%|█████████████████████████████████▏                  | 6213/9741 [00:21<00:11, 311.23it/s] 64%|█████████████████████████████████▎                  | 6245/9741 [00:21<00:11, 311.07it/s] 64%|█████████████████████████████████▌                  | 6277/9741 [00:21<00:11, 311.30it/s] 65%|█████████████████████████████████▋                  | 6309/9741 [00:21<00:11, 308.88it/s] 65%|█████████████████████████████████▊                  | 6341/9741 [00:21<00:10, 309.99it/s] 65%|██████████████████████████████████                  | 6373/9741 [00:22<00:10, 310.37it/s] 66%|██████████████████████████████████▏                 | 6405/9741 [00:22<00:10, 310.81it/s] 66%|██████████████████████████████████▎                 | 6437/9741 [00:22<00:10, 311.14it/s] 66%|██████████████████████████████████▌                 | 6469/9741 [00:22<00:10, 310.89it/s] 67%|██████████████████████████████████▋                 | 6501/9741 [00:22<00:10, 310.99it/s] 67%|██████████████████████████████████▊                 | 6533/9741 [00:22<00:10, 309.05it/s] 67%|███████████████████████████████████                 | 6565/9741 [00:22<00:10, 309.92it/s] 68%|███████████████████████████████████▏                | 6597/9741 [00:22<00:10, 310.38it/s] 68%|███████████████████████████████████▍                | 6629/9741 [00:22<00:10, 310.14it/s] 68%|███████████████████████████████████▌                | 6661/9741 [00:23<00:09, 310.26it/s] 69%|███████████████████████████████████▋                | 6693/9741 [00:23<00:09, 310.58it/s] 69%|███████████████████████████████████▉                | 6725/9741 [00:23<00:09, 311.04it/s] 69%|████████████████████████████████████                | 6757/9741 [00:23<00:09, 310.82it/s] 70%|████████████████████████████████████▏               | 6789/9741 [00:23<00:09, 309.13it/s] 70%|████████████████████████████████████▍               | 6821/9741 [00:23<00:09, 310.01it/s] 70%|████████████████████████████████████▌               | 6853/9741 [00:23<00:09, 310.88it/s] 71%|████████████████████████████████████▊               | 6885/9741 [00:23<00:09, 311.06it/s] 71%|████████████████████████████████████▉               | 6917/9741 [00:23<00:09, 310.96it/s] 71%|█████████████████████████████████████               | 6949/9741 [00:23<00:08, 311.50it/s] 72%|█████████████████████████████████████▎              | 6981/9741 [00:24<00:08, 311.62it/s] 72%|█████████████████████████████████████▍              | 7013/9741 [00:24<00:08, 309.33it/s] 72%|█████████████████████████████████████▌              | 7045/9741 [00:24<00:08, 309.99it/s] 73%|█████████████████████████████████████▊              | 7077/9741 [00:24<00:08, 310.70it/s] 73%|█████████████████████████████████████▉              | 7109/9741 [00:24<00:08, 310.74it/s] 73%|██████████████████████████████████████              | 7141/9741 [00:24<00:08, 311.12it/s] 74%|██████████████████████████████████████▎             | 7173/9741 [00:24<00:08, 311.26it/s] 74%|██████████████████████████████████████▍             | 7205/9741 [00:24<00:08, 311.46it/s] 74%|██████████████████████████████████████▋             | 7237/9741 [00:24<00:08, 309.00it/s] 75%|██████████████████████████████████████▊             | 7269/9741 [00:24<00:07, 309.77it/s] 75%|██████████████████████████████████████▉             | 7301/9741 [00:25<00:07, 310.30it/s] 75%|███████████████████████████████████████▏            | 7333/9741 [00:25<00:07, 310.66it/s] 76%|███████████████████████████████████████▎            | 7365/9741 [00:25<00:07, 311.02it/s] 76%|███████████████████████████████████████▍            | 7397/9741 [00:25<00:07, 311.14it/s] 76%|███████████████████████████████████████▋            | 7429/9741 [00:25<00:07, 311.26it/s] 77%|███████████████████████████████████████▊            | 7461/9741 [00:25<00:08, 279.69it/s] 77%|███████████████████████████████████████▉            | 7493/9741 [00:25<00:07, 288.43it/s] 77%|████████████████████████████████████████▏           | 7524/9741 [00:25<00:07, 294.24it/s] 78%|████████████████████████████████████████▎           | 7556/9741 [00:25<00:07, 299.18it/s] 78%|████████████████████████████████████████▌           | 7588/9741 [00:26<00:07, 302.53it/s] 78%|████████████████████████████████████████▋           | 7620/9741 [00:26<00:06, 305.19it/s] 79%|████████████████████████████████████████▊           | 7652/9741 [00:26<00:06, 306.90it/s] 79%|█████████████████████████████████████████           | 7683/9741 [00:26<00:06, 306.09it/s] 79%|█████████████████████████████████████████▏          | 7715/9741 [00:26<00:06, 307.78it/s] 80%|█████████████████████████████████████████▎          | 7747/9741 [00:26<00:06, 308.93it/s] 80%|█████████████████████████████████████████▌          | 7779/9741 [00:26<00:06, 309.66it/s] 80%|█████████████████████████████████████████▋          | 7810/9741 [00:26<00:06, 307.74it/s] 81%|█████████████████████████████████████████▊          | 7842/9741 [00:26<00:06, 308.72it/s] 81%|██████████████████████████████████████████          | 7874/9741 [00:26<00:06, 309.32it/s] 81%|██████████████████████████████████████████▏         | 7905/9741 [00:27<00:05, 306.77it/s] 81%|██████████████████████████████████████████▎         | 7937/9741 [00:27<00:05, 308.11it/s] 82%|██████████████████████████████████████████▌         | 7969/9741 [00:27<00:05, 309.15it/s] 82%|██████████████████████████████████████████▋         | 8001/9741 [00:27<00:05, 309.96it/s] 82%|██████████████████████████████████████████▉         | 8033/9741 [00:27<00:05, 310.30it/s] 83%|███████████████████████████████████████████         | 8065/9741 [00:27<00:05, 310.50it/s] 83%|███████████████████████████████████████████▏        | 8097/9741 [00:27<00:05, 310.22it/s] 83%|███████████████████████████████████████████▍        | 8129/9741 [00:27<00:05, 308.76it/s] 84%|███████████████████████████████████████████▌        | 8161/9741 [00:27<00:05, 309.45it/s] 84%|███████████████████████████████████████████▋        | 8193/9741 [00:28<00:04, 309.96it/s] 84%|███████████████████████████████████████████▉        | 8225/9741 [00:28<00:04, 310.42it/s] 85%|████████████████████████████████████████████        | 8257/9741 [00:28<00:04, 310.75it/s] 85%|████████████████████████████████████████████▏       | 8289/9741 [00:28<00:04, 310.68it/s] 85%|████████████████████████████████████████████▍       | 8321/9741 [00:28<00:04, 310.75it/s] 86%|████████████████████████████████████████████▌       | 8353/9741 [00:28<00:04, 308.79it/s] 86%|████████████████████████████████████████████▊       | 8384/9741 [00:28<00:04, 308.87it/s] 86%|████████████████████████████████████████████▉       | 8415/9741 [00:28<00:04, 307.22it/s] 87%|█████████████████████████████████████████████       | 8447/9741 [00:28<00:04, 308.05it/s] 87%|█████████████████████████████████████████████▎      | 8479/9741 [00:28<00:04, 308.76it/s] 87%|█████████████████████████████████████████████▍      | 8511/9741 [00:29<00:03, 309.58it/s] 88%|█████████████████████████████████████████████▌      | 8543/9741 [00:29<00:03, 309.73it/s] 88%|█████████████████████████████████████████████▊      | 8574/9741 [00:29<00:03, 307.94it/s] 88%|█████████████████████████████████████████████▉      | 8606/9741 [00:29<00:03, 308.89it/s] 89%|██████████████████████████████████████████████      | 8638/9741 [00:29<00:03, 309.38it/s] 89%|██████████████████████████████████████████████▎     | 8670/9741 [00:29<00:03, 309.68it/s] 89%|██████████████████████████████████████████████▍     | 8702/9741 [00:29<00:03, 310.13it/s] 90%|██████████████████████████████████████████████▌     | 8734/9741 [00:29<00:03, 310.39it/s] 90%|██████████████████████████████████████████████▊     | 8766/9741 [00:29<00:03, 310.46it/s] 90%|██████████████████████████████████████████████▉     | 8798/9741 [00:29<00:03, 309.56it/s] 91%|███████████████████████████████████████████████▏    | 8829/9741 [00:30<00:02, 308.04it/s] 91%|███████████████████████████████████████████████▎    | 8860/9741 [00:30<00:02, 307.96it/s] 91%|███████████████████████████████████████████████▍    | 8892/9741 [00:30<00:02, 309.00it/s] 92%|███████████████████████████████████████████████▋    | 8924/9741 [00:30<00:02, 309.53it/s] 92%|███████████████████████████████████████████████▊    | 8956/9741 [00:30<00:02, 309.93it/s] 92%|███████████████████████████████████████████████▉    | 8988/9741 [00:30<00:02, 310.02it/s] 93%|████████████████████████████████████████████████▏   | 9020/9741 [00:30<00:02, 310.32it/s] 93%|████████████████████████████████████████████████▎   | 9052/9741 [00:30<00:02, 308.32it/s] 93%|████████████████████████████████████████████████▍   | 9084/9741 [00:30<00:02, 309.03it/s] 94%|████████████████████████████████████████████████▋   | 9116/9741 [00:30<00:02, 309.29it/s] 94%|████████████████████████████████████████████████▊   | 9148/9741 [00:31<00:01, 309.91it/s] 94%|████████████████████████████████████████████████▉   | 9179/9741 [00:31<00:01, 308.45it/s] 95%|█████████████████████████████████████████████████▏  | 9210/9741 [00:31<00:01, 301.61it/s] 95%|█████████████████████████████████████████████████▎  | 9242/9741 [00:31<00:01, 304.28it/s] 95%|█████████████████████████████████████████████████▌  | 9273/9741 [00:31<00:01, 304.43it/s] 96%|█████████████████████████████████████████████████▋  | 9305/9741 [00:31<00:01, 306.20it/s] 96%|█████████████████████████████████████████████████▊  | 9336/9741 [00:31<00:01, 307.24it/s] 96%|██████████████████████████████████████████████████  | 9368/9741 [00:31<00:01, 308.18it/s] 96%|██████████████████████████████████████████████████▏ | 9400/9741 [00:31<00:01, 309.00it/s] 97%|██████████████████████████████████████████████████▎ | 9431/9741 [00:32<00:01, 309.22it/s] 97%|██████████████████████████████████████████████████▌ | 9463/9741 [00:32<00:00, 309.61it/s] 97%|██████████████████████████████████████████████████▋ | 9494/9741 [00:32<00:00, 307.89it/s] 98%|██████████████████████████████████████████████████▊ | 9526/9741 [00:32<00:00, 308.79it/s] 98%|███████████████████████████████████████████████████ | 9557/9741 [00:32<00:00, 309.14it/s] 98%|███████████████████████████████████████████████████▏| 9589/9741 [00:32<00:00, 309.53it/s] 99%|███████████████████████████████████████████████████▎| 9621/9741 [00:32<00:00, 310.06it/s] 99%|███████████████████████████████████████████████████▌| 9653/9741 [00:32<00:00, 309.83it/s] 99%|███████████████████████████████████████████████████▋| 9685/9741 [00:32<00:00, 309.90it/s]100%|███████████████████████████████████████████████████▊| 9716/9741 [00:32<00:00, 307.68it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:33<00:00, 295.04it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.23s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.27s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.82s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.13s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.12s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.41s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.46s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.56s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
[2023-08-21 23:36:36,598] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.28s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.36s/it]
[2023-08-21 23:36:47,729] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 23:36:47,730] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 23:36:47,731] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 23:36:47,731] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 23:36:47,731] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 23:36:47,731] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fcb740cefd0>
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 23:36:47,732] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fcb73e8e220>
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 23:36:47,733] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 23:36:47,734] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 23:36:47,734] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5888633728027344 seconds
Loading extension module utils...
Time to load utils op: 0.5045280456542969 seconds
Loading extension module utils...
Time to load utils op: 0.5048813819885254 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]Loading extension module utils...
############### Example ###############
Time to load utils op: 0.6047444343566895 seconds
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input: Noah, who loves his Grammy, calls her every week to talk about his day. If each call lasts 30 minutes and he is charged $0.05 per call minute, how much would he be billed if he makes the calls for a year?
Output: 78

Input: A merchant bought 15 keyboards and 25 printers for a total of $2050. If a keyboard costs $20, how much does a printer cost?
Output: 70

Input: Gina has two bank accounts. Each account has a quarter of the balance in Betty's account. If Betty's account balance is $3,456, what is the combined balance of both Gina's accounts?
Output: 1728

Input: Zain has 10 more of each coin than Emerie. If Emerie has six quarters, seven dimes, and five nickels, how many coins does Zain have?
Output: 48

Input: Adonis is playing a prank on his dad by replacing his shampoo with hot sauce. Every day, after his dad showers, Adonis replaces the shampoo with 1/2 an ounce of hot sauce. He knows his dad uses 1 oz of shampoo a day from a new 10 oz bottle that no one else uses. After 4 days, what percentage of the liquid in the bottle is hot sauce?
Output: 25

Input: Lana and Mike are taking their dog and renting a cabin in the mountains for 2 weeks.  The daily rate is $125.00  There is a $100.00 pet fee.  There is also a 20% service/cleaning fee for the rental.  They need to pay 50% of the entire bill as a security deposit.  How much is their security deposit?
Output: 1110

Input: Abigail is trying a new recipe for a cold drink. It uses 1/4 of a cup of iced tea and 1 and 1/4 of a cup of lemonade to make one drink. If she fills a pitcher with 18 total cups of this drink, how many cups of lemonade are in the pitcher?
Output: 15

Input: John buys a vacuum cleaner for $250 and a dishwasher for $450.  She has a $75 off coupon.  How much did he spend?
Output: 625

Input: Dany owns a farm, in his farm he has 4 cows and 3 sheep that eat 2 bushels a day. He also has 7 chickens that eat 3 bushels a day. How many bushels should he have to suffice the animals for a day?
Output: 35

Input: The town of Belize has 400 homes. One fourth of the town's homes are white. One fifth of the non-white homes have a fireplace. How many of the non-white homes do not have a fireplace?
Output: 240

Input: In a race, there are eight runners. The first five runners finish the race in 8 hours, while the rest of the runners finish the race 2 hours later. Calculate the total time the eight runners took to finish the race.
Output: 70

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o24-tgsm8k-s10-rFalse
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3456703) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_23:36:54
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3456704)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-21_23:36:54
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3456705)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-21_23:36:54
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3456706)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_23:36:54
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3456703)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o25-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 25
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[2023-08-21 23:36:56,989] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o25-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 25
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o25-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 20/9741 [00:00<00:51, 190.29it/s]  0%|▏                                                     | 40/9741 [00:00<00:52, 185.99it/s]  1%|▎                                                     | 60/9741 [00:00<00:51, 188.07it/s]  1%|▍                                                     | 80/9741 [00:00<00:51, 189.38it/s]  1%|▌                                                    | 100/9741 [00:00<00:50, 190.03it/s]  1%|▋                                                    | 120/9741 [00:00<00:50, 190.39it/s]  1%|▊                                                    | 140/9741 [00:00<00:50, 190.67it/s]  2%|▊                                                    | 160/9741 [00:00<00:50, 190.67it/s]  2%|▉                                                    | 180/9741 [00:00<00:50, 189.83it/s]  2%|█                                                    | 199/9741 [00:01<00:50, 189.42it/s]  2%|█▏                                                   | 218/9741 [00:01<00:51, 185.47it/s]  2%|█▎                                                   | 237/9741 [00:01<00:51, 185.69it/s]  3%|█▍                                                   | 256/9741 [00:01<00:50, 186.18it/s]  3%|█▍                                                   | 275/9741 [00:01<00:50, 186.50it/s]  3%|█▌                                                   | 294/9741 [00:01<00:50, 186.89it/s]  3%|█▋                                                   | 313/9741 [00:01<00:50, 187.16it/s]  3%|█▊                                                   | 332/9741 [00:01<00:50, 187.14it/s]  4%|█▉                                                   | 351/9741 [00:01<00:50, 187.13it/s]  4%|██                                                   | 370/9741 [00:01<00:50, 187.21it/s]  4%|██                                                   | 389/9741 [00:02<00:49, 187.30it/s]  4%|██▏                                                  | 408/9741 [00:02<00:49, 187.21it/s]  4%|██▎                                                  | 427/9741 [00:02<00:50, 185.46it/s]  5%|██▍                                                  | 446/9741 [00:02<00:49, 185.93it/s]  5%|██▌                                                  | 465/9741 [00:02<00:49, 186.27it/s]  5%|██▋                                                  | 484/9741 [00:02<00:49, 186.49it/s]  5%|██▋                                                  | 503/9741 [00:02<00:49, 186.60it/s]  5%|██▊                                                  | 522/9741 [00:02<00:49, 186.44it/s]  6%|██▉                                                  | 542/9741 [00:02<00:48, 190.22it/s]  6%|███                                                  | 571/9741 [00:02<00:42, 217.95it/s]  6%|███▎                                                 | 600/9741 [00:03<00:38, 237.42it/s]  6%|███▍                                                 | 629/9741 [00:03<00:36, 250.97it/s]  7%|███▌                                                 | 657/9741 [00:03<00:35, 258.39it/s]  7%|███▋                                                 | 686/9741 [00:03<00:34, 265.94it/s]  7%|███▉                                                 | 715/9741 [00:03<00:33, 270.87it/s]  8%|████                                                 | 744/9741 [00:03<00:32, 274.57it/s]  8%|████▏                                                | 773/9741 [00:03<00:32, 276.96it/s]  8%|████▎                                                | 801/9741 [00:03<00:32, 277.44it/s]  9%|████▌                                                | 830/9741 [00:03<00:31, 279.13it/s]  9%|████▋                                                | 859/9741 [00:04<00:31, 280.33it/s]  9%|████▊                                                | 888/9741 [00:04<00:31, 279.09it/s]  9%|████▉                                                | 917/9741 [00:04<00:31, 280.05it/s] 10%|█████▏                                               | 946/9741 [00:04<00:31, 280.72it/s] 10%|█████▎                                               | 975/9741 [00:04<00:31, 281.38it/s] 10%|█████▎                                              | 1004/9741 [00:04<00:30, 283.14it/s] 11%|█████▌                                              | 1034/9741 [00:04<00:30, 285.46it/s] 11%|█████▋                                              | 1064/9741 [00:04<00:30, 286.89it/s] 11%|█████▊                                              | 1094/9741 [00:04<00:30, 288.17it/s] 12%|█████▉                                              | 1123/9741 [00:04<00:30, 286.53it/s] 12%|██████▏                                             | 1153/9741 [00:05<00:29, 288.05it/s] 12%|██████▎                                             | 1182/9741 [00:05<00:29, 286.58it/s] 12%|██████▍                                             | 1212/9741 [00:05<00:29, 287.85it/s] 13%|██████▋                                             | 1242/9741 [00:05<00:29, 288.64it/s] 13%|██████▊                                             | 1272/9741 [00:05<00:29, 289.54it/s] 13%|██████▉                                             | 1302/9741 [00:05<00:29, 290.07it/s] 14%|███████                                             | 1332/9741 [00:05<00:28, 290.35it/s] 14%|███████▎                                            | 1362/9741 [00:05<00:29, 287.86it/s] 14%|███████▍                                            | 1392/9741 [00:05<00:28, 288.66it/s] 15%|███████▌                                            | 1422/9741 [00:05<00:28, 289.52it/s] 15%|███████▋                                            | 1451/9741 [00:06<00:28, 289.58it/s] 15%|███████▉                                            | 1481/9741 [00:06<00:28, 289.77it/s] 16%|████████                                            | 1511/9741 [00:06<00:28, 289.87it/s] 16%|████████▏                                           | 1540/9741 [00:06<00:28, 289.07it/s] 16%|████████▍                                           | 1569/9741 [00:06<00:28, 286.84it/s] 16%|████████▌                                           | 1598/9741 [00:06<00:28, 287.42it/s] 17%|████████▋                                           | 1628/9741 [00:06<00:28, 288.33it/s] 17%|████████▊                                           | 1658/9741 [00:06<00:27, 289.23it/s] 17%|█████████                                           | 1688/9741 [00:06<00:27, 289.70it/s] 18%|█████████▏                                          | 1718/9741 [00:06<00:27, 290.21it/s] 18%|█████████▎                                          | 1748/9741 [00:07<00:27, 290.24it/s] 18%|█████████▍                                          | 1778/9741 [00:07<00:27, 290.53it/s] 19%|█████████▋                                          | 1808/9741 [00:07<00:30, 263.39it/s] 19%|█████████▊                                          | 1838/9741 [00:07<00:29, 270.96it/s] 19%|█████████▉                                          | 1867/9741 [00:07<00:28, 276.22it/s] 19%|██████████▏                                         | 1897/9741 [00:07<00:27, 280.39it/s] 20%|██████████▎                                         | 1927/9741 [00:07<00:27, 283.28it/s] 20%|██████████▍                                         | 1956/9741 [00:07<00:27, 285.20it/s] 20%|██████████▌                                         | 1986/9741 [00:07<00:27, 286.86it/s] 21%|██████████▊                                         | 2016/9741 [00:08<00:27, 285.82it/s] 21%|██████████▉                                         | 2045/9741 [00:08<00:26, 286.04it/s] 21%|███████████                                         | 2074/9741 [00:08<00:26, 287.06it/s] 22%|███████████▏                                        | 2103/9741 [00:08<00:26, 287.57it/s] 22%|███████████▍                                        | 2132/9741 [00:08<00:26, 288.24it/s] 22%|███████████▌                                        | 2161/9741 [00:08<00:26, 288.30it/s] 22%|███████████▋                                        | 2191/9741 [00:08<00:26, 288.94it/s] 23%|███████████▊                                        | 2221/9741 [00:08<00:25, 289.42it/s] 23%|████████████                                        | 2250/9741 [00:08<00:27, 275.36it/s] 23%|████████████▏                                       | 2280/9741 [00:08<00:26, 279.83it/s] 24%|████████████▎                                       | 2310/9741 [00:09<00:26, 283.02it/s] 24%|████████████▍                                       | 2339/9741 [00:09<00:25, 284.88it/s] 24%|████████████▋                                       | 2369/9741 [00:09<00:25, 286.54it/s] 25%|████████████▊                                       | 2399/9741 [00:09<00:25, 287.91it/s] 25%|████████████▉                                       | 2428/9741 [00:09<00:25, 288.40it/s] 25%|█████████████                                       | 2457/9741 [00:09<00:25, 288.69it/s] 26%|█████████████▎                                      | 2486/9741 [00:09<00:25, 285.83it/s] 26%|█████████████▍                                      | 2515/9741 [00:09<00:25, 286.01it/s] 26%|█████████████▌                                      | 2544/9741 [00:09<00:25, 285.86it/s] 26%|█████████████▋                                      | 2573/9741 [00:10<00:25, 286.05it/s] 27%|█████████████▉                                      | 2602/9741 [00:10<00:24, 286.23it/s] 27%|██████████████                                      | 2631/9741 [00:10<00:24, 285.95it/s] 27%|██████████████▏                                     | 2660/9741 [00:10<00:24, 285.98it/s] 28%|██████████████▎                                     | 2689/9741 [00:10<00:24, 285.85it/s] 28%|██████████████▌                                     | 2718/9741 [00:10<00:24, 283.78it/s] 28%|██████████████▋                                     | 2747/9741 [00:10<00:24, 284.02it/s] 28%|██████████████▊                                     | 2776/9741 [00:10<00:24, 284.48it/s] 29%|██████████████▉                                     | 2805/9741 [00:10<00:24, 284.97it/s] 29%|███████████████▏                                    | 2834/9741 [00:10<00:24, 285.24it/s] 29%|███████████████▎                                    | 2863/9741 [00:11<00:24, 285.62it/s] 30%|███████████████▍                                    | 2892/9741 [00:11<00:23, 285.75it/s] 30%|███████████████▌                                    | 2921/9741 [00:11<00:23, 285.98it/s] 30%|███████████████▋                                    | 2950/9741 [00:11<00:23, 283.49it/s] 31%|███████████████▉                                    | 2979/9741 [00:11<00:23, 284.33it/s] 31%|████████████████                                    | 3008/9741 [00:11<00:23, 285.06it/s] 31%|████████████████▏                                   | 3037/9741 [00:11<00:23, 284.97it/s] 31%|████████████████▎                                   | 3066/9741 [00:11<00:23, 283.29it/s] 32%|████████████████▌                                   | 3095/9741 [00:11<00:23, 284.10it/s] 32%|████████████████▋                                   | 3124/9741 [00:11<00:23, 284.91it/s] 32%|████████████████▊                                   | 3153/9741 [00:12<00:23, 283.12it/s] 33%|████████████████▉                                   | 3182/9741 [00:12<00:23, 284.16it/s] 33%|█████████████████▏                                  | 3211/9741 [00:12<00:22, 284.81it/s] 33%|█████████████████▎                                  | 3240/9741 [00:12<00:22, 285.23it/s] 34%|█████████████████▍                                  | 3269/9741 [00:12<00:22, 285.35it/s] 34%|█████████████████▌                                  | 3298/9741 [00:12<00:22, 285.13it/s] 34%|█████████████████▊                                  | 3327/9741 [00:12<00:22, 284.63it/s] 34%|█████████████████▉                                  | 3356/9741 [00:12<00:22, 285.50it/s] 35%|██████████████████                                  | 3385/9741 [00:12<00:22, 284.69it/s] 35%|██████████████████▏                                 | 3415/9741 [00:12<00:22, 286.45it/s] 35%|██████████████████▍                                 | 3445/9741 [00:13<00:21, 287.52it/s] 36%|██████████████████▌                                 | 3474/9741 [00:13<00:21, 287.75it/s] 36%|██████████████████▋                                 | 3503/9741 [00:13<00:21, 288.24it/s] 36%|██████████████████▊                                 | 3532/9741 [00:13<00:21, 287.29it/s] 37%|███████████████████                                 | 3562/9741 [00:13<00:21, 288.14it/s] 37%|███████████████████▏                                | 3591/9741 [00:13<00:21, 288.68it/s] 37%|███████████████████▎                                | 3620/9741 [00:13<00:21, 286.86it/s] 37%|███████████████████▍                                | 3650/9741 [00:13<00:21, 288.03it/s] 38%|███████████████████▋                                | 3680/9741 [00:13<00:20, 288.71it/s] 38%|███████████████████▊                                | 3710/9741 [00:13<00:20, 289.36it/s] 38%|███████████████████▉                                | 3740/9741 [00:14<00:20, 289.78it/s] 39%|████████████████████▏                               | 3770/9741 [00:14<00:20, 289.92it/s] 39%|████████████████████▎                               | 3799/9741 [00:14<00:20, 289.91it/s] 39%|████████████████████▍                               | 3829/9741 [00:14<00:20, 290.12it/s] 40%|████████████████████▌                               | 3859/9741 [00:14<00:20, 288.10it/s] 40%|████████████████████▊                               | 3888/9741 [00:14<00:20, 287.89it/s] 40%|████████████████████▉                               | 3918/9741 [00:14<00:20, 288.58it/s] 41%|█████████████████████                               | 3948/9741 [00:14<00:20, 289.11it/s] 41%|█████████████████████▏                              | 3977/9741 [00:14<00:20, 287.08it/s] 41%|█████████████████████▍                              | 4007/9741 [00:15<00:19, 288.14it/s] 41%|█████████████████████▌                              | 4037/9741 [00:15<00:19, 288.78it/s] 42%|█████████████████████▋                              | 4066/9741 [00:15<00:19, 287.03it/s] 42%|█████████████████████▊                              | 4096/9741 [00:15<00:19, 287.95it/s] 42%|██████████████████████                              | 4126/9741 [00:15<00:19, 288.60it/s] 43%|██████████████████████▏                             | 4155/9741 [00:15<00:19, 288.96it/s] 43%|██████████████████████▎                             | 4184/9741 [00:15<00:19, 280.22it/s] 43%|██████████████████████▍                             | 4213/9741 [00:15<00:19, 283.02it/s] 44%|██████████████████████▋                             | 4242/9741 [00:15<00:19, 285.03it/s] 44%|██████████████████████▊                             | 4272/9741 [00:15<00:19, 286.57it/s] 44%|██████████████████████▉                             | 4301/9741 [00:16<00:19, 285.71it/s] 44%|███████████████████████                             | 4331/9741 [00:16<00:18, 287.04it/s] 45%|███████████████████████▎                            | 4360/9741 [00:16<00:18, 287.81it/s] 45%|███████████████████████▍                            | 4389/9741 [00:16<00:18, 288.41it/s] 45%|███████████████████████▌                            | 4419/9741 [00:16<00:18, 289.04it/s] 46%|███████████████████████▋                            | 4448/9741 [00:16<00:18, 288.92it/s] 46%|███████████████████████▉                            | 4477/9741 [00:16<00:18, 286.35it/s] 46%|████████████████████████                            | 4507/9741 [00:16<00:18, 287.58it/s] 47%|████████████████████████▏                           | 4536/9741 [00:16<00:19, 260.61it/s] 47%|████████████████████████▎                           | 4565/9741 [00:16<00:19, 268.69it/s] 47%|████████████████████████▌                           | 4595/9741 [00:17<00:18, 275.02it/s] 47%|████████████████████████▋                           | 4625/9741 [00:17<00:18, 279.41it/s] 48%|████████████████████████▊                           | 4654/9741 [00:17<00:18, 282.40it/s] 48%|████████████████████████▉                           | 4683/9741 [00:17<00:17, 284.48it/s] 48%|█████████████████████████▏                          | 4712/9741 [00:17<00:17, 285.41it/s] 49%|█████████████████████████▎                          | 4741/9741 [00:17<00:25, 196.03it/s] 49%|█████████████████████████▍                          | 4770/9741 [00:17<00:22, 216.45it/s] 49%|█████████████████████████▌                          | 4799/9741 [00:17<00:21, 233.83it/s] 50%|█████████████████████████▊                          | 4828/9741 [00:18<00:19, 247.67it/s] 50%|█████████████████████████▉                          | 4857/9741 [00:18<00:18, 258.40it/s] 50%|██████████████████████████                          | 4885/9741 [00:18<00:18, 264.35it/s] 50%|██████████████████████████▏                         | 4914/9741 [00:18<00:17, 270.80it/s] 51%|██████████████████████████▍                         | 4943/9741 [00:18<00:17, 273.94it/s] 51%|██████████████████████████▌                         | 4972/9741 [00:18<00:17, 278.08it/s] 51%|██████████████████████████▋                         | 5001/9741 [00:18<00:16, 280.43it/s] 52%|██████████████████████████▊                         | 5030/9741 [00:18<00:16, 283.20it/s] 52%|███████████████████████████                         | 5060/9741 [00:18<00:16, 285.33it/s] 52%|███████████████████████████▏                        | 5089/9741 [00:18<00:16, 286.62it/s] 53%|███████████████████████████▎                        | 5118/9741 [00:19<00:16, 287.05it/s] 53%|███████████████████████████▍                        | 5147/9741 [00:19<00:15, 287.90it/s] 53%|███████████████████████████▋                        | 5176/9741 [00:19<00:15, 286.47it/s] 53%|███████████████████████████▊                        | 5205/9741 [00:19<00:15, 287.37it/s] 54%|███████████████████████████▉                        | 5234/9741 [00:19<00:15, 288.00it/s] 54%|████████████████████████████                        | 5263/9741 [00:19<00:15, 288.26it/s] 54%|████████████████████████████▎                       | 5293/9741 [00:19<00:15, 288.98it/s] 55%|████████████████████████████▍                       | 5323/9741 [00:19<00:15, 289.57it/s] 55%|████████████████████████████▌                       | 5353/9741 [00:19<00:15, 289.72it/s] 55%|████████████████████████████▋                       | 5382/9741 [00:19<00:15, 287.86it/s] 56%|████████████████████████████▉                       | 5411/9741 [00:20<00:15, 286.62it/s] 56%|█████████████████████████████                       | 5441/9741 [00:20<00:14, 287.88it/s] 56%|█████████████████████████████▏                      | 5471/9741 [00:20<00:14, 288.75it/s] 56%|█████████████████████████████▎                      | 5501/9741 [00:20<00:14, 291.47it/s] 57%|█████████████████████████████▌                      | 5531/9741 [00:20<00:14, 293.63it/s] 57%|█████████████████████████████▋                      | 5561/9741 [00:20<00:14, 295.33it/s] 57%|█████████████████████████████▊                      | 5591/9741 [00:20<00:14, 294.83it/s] 58%|██████████████████████████████                      | 5621/9741 [00:20<00:13, 296.07it/s] 58%|██████████████████████████████▏                     | 5651/9741 [00:20<00:13, 294.78it/s] 58%|██████████████████████████████▎                     | 5681/9741 [00:20<00:13, 296.11it/s] 59%|██████████████████████████████▍                     | 5711/9741 [00:21<00:13, 296.96it/s] 59%|██████████████████████████████▋                     | 5741/9741 [00:21<00:13, 297.47it/s] 59%|██████████████████████████████▊                     | 5771/9741 [00:21<00:13, 297.96it/s] 60%|██████████████████████████████▉                     | 5801/9741 [00:21<00:13, 298.16it/s] 60%|███████████████████████████████▏                    | 5831/9741 [00:21<00:13, 298.17it/s] 60%|███████████████████████████████▎                    | 5861/9741 [00:21<00:13, 295.92it/s] 60%|███████████████████████████████▍                    | 5891/9741 [00:21<00:13, 294.43it/s] 61%|███████████████████████████████▌                    | 5921/9741 [00:21<00:12, 295.69it/s] 61%|███████████████████████████████▊                    | 5951/9741 [00:21<00:12, 296.66it/s] 61%|███████████████████████████████▉                    | 5981/9741 [00:22<00:12, 297.33it/s] 62%|████████████████████████████████                    | 6011/9741 [00:22<00:12, 297.55it/s] 62%|████████████████████████████████▏                   | 6041/9741 [00:22<00:12, 297.75it/s] 62%|████████████████████████████████▍                   | 6071/9741 [00:22<00:12, 297.94it/s] 63%|████████████████████████████████▌                   | 6101/9741 [00:22<00:12, 295.53it/s] 63%|████████████████████████████████▋                   | 6131/9741 [00:22<00:12, 296.27it/s] 63%|████████████████████████████████▉                   | 6161/9741 [00:22<00:12, 296.77it/s] 64%|█████████████████████████████████                   | 6191/9741 [00:22<00:11, 296.41it/s] 64%|█████████████████████████████████▏                  | 6221/9741 [00:22<00:11, 296.97it/s] 64%|█████████████████████████████████▎                  | 6251/9741 [00:22<00:11, 297.02it/s] 64%|█████████████████████████████████▌                  | 6281/9741 [00:23<00:11, 297.49it/s] 65%|█████████████████████████████████▋                  | 6311/9741 [00:23<00:11, 295.84it/s] 65%|█████████████████████████████████▊                  | 6341/9741 [00:23<00:11, 296.61it/s] 65%|██████████████████████████████████                  | 6371/9741 [00:23<00:11, 297.07it/s] 66%|██████████████████████████████████▏                 | 6401/9741 [00:23<00:11, 295.42it/s] 66%|██████████████████████████████████▎                 | 6431/9741 [00:23<00:11, 296.25it/s] 66%|██████████████████████████████████▍                 | 6461/9741 [00:23<00:11, 296.30it/s] 67%|██████████████████████████████████▋                 | 6491/9741 [00:23<00:10, 296.65it/s] 67%|██████████████████████████████████▊                 | 6521/9741 [00:23<00:10, 296.81it/s] 67%|██████████████████████████████████▉                 | 6551/9741 [00:23<00:10, 295.07it/s] 68%|███████████████████████████████████▏                | 6581/9741 [00:24<00:10, 295.76it/s] 68%|███████████████████████████████████▎                | 6611/9741 [00:24<00:10, 296.25it/s] 68%|███████████████████████████████████▍                | 6641/9741 [00:24<00:10, 296.65it/s] 68%|███████████████████████████████████▌                | 6671/9741 [00:24<00:10, 297.21it/s] 69%|███████████████████████████████████▊                | 6701/9741 [00:24<00:10, 297.20it/s] 69%|███████████████████████████████████▉                | 6731/9741 [00:24<00:10, 297.64it/s] 69%|████████████████████████████████████                | 6761/9741 [00:24<00:10, 296.05it/s] 70%|████████████████████████████████████▎               | 6791/9741 [00:24<00:09, 295.74it/s] 70%|████████████████████████████████████▍               | 6821/9741 [00:24<00:09, 296.44it/s] 70%|████████████████████████████████████▌               | 6851/9741 [00:24<00:09, 296.95it/s] 71%|████████████████████████████████████▋               | 6881/9741 [00:25<00:09, 295.64it/s] 71%|████████████████████████████████████▉               | 6911/9741 [00:25<00:09, 296.08it/s] 71%|█████████████████████████████████████               | 6941/9741 [00:25<00:09, 296.62it/s] 72%|█████████████████████████████████████▏              | 6971/9741 [00:25<00:09, 296.97it/s] 72%|█████████████████████████████████████▎              | 7001/9741 [00:25<00:09, 295.31it/s] 72%|█████████████████████████████████████▌              | 7031/9741 [00:25<00:09, 295.94it/s] 72%|█████████████████████████████████████▋              | 7061/9741 [00:25<00:09, 296.54it/s] 73%|█████████████████████████████████████▊              | 7091/9741 [00:25<00:08, 296.83it/s] 73%|██████████████████████████████████████              | 7121/9741 [00:25<00:08, 296.96it/s] 73%|██████████████████████████████████████▏             | 7151/9741 [00:25<00:08, 297.21it/s] 74%|██████████████████████████████████████▎             | 7181/9741 [00:26<00:08, 297.30it/s] 74%|██████████████████████████████████████▍             | 7211/9741 [00:26<00:08, 297.38it/s] 74%|██████████████████████████████████████▋             | 7241/9741 [00:26<00:08, 295.50it/s] 75%|██████████████████████████████████████▊             | 7271/9741 [00:26<00:08, 296.00it/s] 75%|██████████████████████████████████████▉             | 7301/9741 [00:26<00:08, 296.47it/s] 75%|███████████████████████████████████████▏            | 7331/9741 [00:26<00:08, 296.80it/s] 76%|███████████████████████████████████████▎            | 7361/9741 [00:26<00:08, 296.87it/s] 76%|███████████████████████████████████████▍            | 7391/9741 [00:26<00:07, 296.91it/s] 76%|███████████████████████████████████████▌            | 7421/9741 [00:26<00:07, 297.06it/s] 76%|███████████████████████████████████████▊            | 7451/9741 [00:27<00:08, 263.72it/s] 77%|███████████████████████████████████████▉            | 7481/9741 [00:27<00:08, 271.37it/s] 77%|████████████████████████████████████████            | 7511/9741 [00:27<00:08, 278.46it/s] 77%|████████████████████████████████████████▎           | 7541/9741 [00:27<00:07, 283.77it/s] 78%|████████████████████████████████████████▍           | 7571/9741 [00:27<00:07, 287.78it/s] 78%|████████████████████████████████████████▌           | 7601/9741 [00:27<00:07, 290.61it/s] 78%|████████████████████████████████████████▋           | 7631/9741 [00:27<00:07, 292.61it/s] 79%|████████████████████████████████████████▉           | 7661/9741 [00:27<00:07, 293.76it/s] 79%|█████████████████████████████████████████           | 7691/9741 [00:27<00:07, 292.50it/s] 79%|█████████████████████████████████████████▏          | 7721/9741 [00:27<00:06, 294.03it/s] 80%|█████████████████████████████████████████▍          | 7751/9741 [00:28<00:06, 294.97it/s] 80%|█████████████████████████████████████████▌          | 7781/9741 [00:28<00:06, 295.57it/s] 80%|█████████████████████████████████████████▋          | 7811/9741 [00:28<00:06, 296.24it/s] 80%|█████████████████████████████████████████▊          | 7841/9741 [00:28<00:06, 296.52it/s] 81%|██████████████████████████████████████████          | 7871/9741 [00:28<00:06, 296.32it/s] 81%|██████████████████████████████████████████▏         | 7901/9741 [00:28<00:06, 294.60it/s] 81%|██████████████████████████████████████████▎         | 7931/9741 [00:28<00:06, 295.28it/s] 82%|██████████████████████████████████████████▍         | 7961/9741 [00:28<00:06, 295.09it/s] 82%|██████████████████████████████████████████▋         | 7991/9741 [00:28<00:05, 295.66it/s] 82%|██████████████████████████████████████████▊         | 8021/9741 [00:28<00:05, 296.22it/s] 83%|██████████████████████████████████████████▉         | 8051/9741 [00:29<00:05, 296.26it/s] 83%|███████████████████████████████████████████▏        | 8081/9741 [00:29<00:05, 295.95it/s] 83%|███████████████████████████████████████████▎        | 8111/9741 [00:29<00:05, 296.55it/s] 84%|███████████████████████████████████████████▍        | 8141/9741 [00:29<00:05, 294.55it/s] 84%|███████████████████████████████████████████▌        | 8171/9741 [00:29<00:05, 295.15it/s] 84%|███████████████████████████████████████████▊        | 8201/9741 [00:29<00:05, 295.75it/s] 84%|███████████████████████████████████████████▉        | 8231/9741 [00:29<00:05, 296.09it/s] 85%|████████████████████████████████████████████        | 8261/9741 [00:29<00:04, 296.54it/s] 85%|████████████████████████████████████████████▎       | 8291/9741 [00:29<00:04, 296.48it/s] 85%|████████████████████████████████████████████▍       | 8321/9741 [00:29<00:04, 296.50it/s] 86%|████████████████████████████████████████████▌       | 8351/9741 [00:30<00:04, 294.53it/s] 86%|████████████████████████████████████████████▋       | 8381/9741 [00:30<00:04, 295.35it/s] 86%|████████████████████████████████████████████▉       | 8411/9741 [00:30<00:04, 295.67it/s] 87%|█████████████████████████████████████████████       | 8441/9741 [00:30<00:04, 296.18it/s] 87%|█████████████████████████████████████████████▏      | 8471/9741 [00:30<00:04, 296.33it/s] 87%|█████████████████████████████████████████████▍      | 8501/9741 [00:30<00:04, 296.58it/s] 88%|█████████████████████████████████████████████▌      | 8531/9741 [00:30<00:04, 296.28it/s] 88%|█████████████████████████████████████████████▋      | 8561/9741 [00:30<00:03, 295.51it/s] 88%|█████████████████████████████████████████████▊      | 8591/9741 [00:30<00:03, 293.87it/s] 89%|██████████████████████████████████████████████      | 8621/9741 [00:30<00:03, 294.49it/s] 89%|██████████████████████████████████████████████▏     | 8651/9741 [00:31<00:03, 295.18it/s] 89%|██████████████████████████████████████████████▎     | 8681/9741 [00:31<00:03, 295.49it/s] 89%|██████████████████████████████████████████████▌     | 8711/9741 [00:31<00:03, 295.76it/s] 90%|██████████████████████████████████████████████▋     | 8741/9741 [00:31<00:03, 296.00it/s] 90%|██████████████████████████████████████████████▊     | 8771/9741 [00:31<00:03, 296.23it/s] 90%|██████████████████████████████████████████████▉     | 8801/9741 [00:31<00:03, 294.25it/s] 91%|███████████████████████████████████████████████▏    | 8831/9741 [00:31<00:03, 295.01it/s] 91%|███████████████████████████████████████████████▎    | 8861/9741 [00:31<00:02, 295.35it/s] 91%|███████████████████████████████████████████████▍    | 8891/9741 [00:31<00:02, 295.84it/s] 92%|███████████████████████████████████████████████▌    | 8921/9741 [00:31<00:02, 296.24it/s] 92%|███████████████████████████████████████████████▊    | 8951/9741 [00:32<00:02, 296.59it/s] 92%|███████████████████████████████████████████████▉    | 8981/9741 [00:32<00:02, 296.55it/s] 93%|████████████████████████████████████████████████    | 9011/9741 [00:32<00:02, 296.45it/s] 93%|████████████████████████████████████████████████▎   | 9041/9741 [00:32<00:02, 293.42it/s] 93%|████████████████████████████████████████████████▍   | 9071/9741 [00:32<00:02, 294.02it/s] 93%|████████████████████████████████████████████████▌   | 9101/9741 [00:32<00:02, 294.69it/s] 94%|████████████████████████████████████████████████▋   | 9131/9741 [00:32<00:02, 295.18it/s] 94%|████████████████████████████████████████████████▉   | 9161/9741 [00:32<00:01, 294.96it/s] 94%|█████████████████████████████████████████████████   | 9191/9741 [00:32<00:01, 295.37it/s] 95%|█████████████████████████████████████████████████▏  | 9221/9741 [00:32<00:01, 295.65it/s] 95%|█████████████████████████████████████████████████▍  | 9251/9741 [00:33<00:01, 295.93it/s] 95%|█████████████████████████████████████████████████▌  | 9281/9741 [00:33<00:01, 294.10it/s] 96%|█████████████████████████████████████████████████▋  | 9311/9741 [00:33<00:01, 294.76it/s] 96%|█████████████████████████████████████████████████▊  | 9341/9741 [00:33<00:01, 295.19it/s] 96%|██████████████████████████████████████████████████  | 9371/9741 [00:33<00:01, 295.32it/s] 97%|██████████████████████████████████████████████████▏ | 9401/9741 [00:33<00:01, 295.50it/s] 97%|██████████████████████████████████████████████████▎ | 9431/9741 [00:33<00:01, 295.73it/s] 97%|██████████████████████████████████████████████████▌ | 9461/9741 [00:33<00:00, 295.77it/s] 97%|██████████████████████████████████████████████████▋ | 9491/9741 [00:33<00:00, 293.99it/s] 98%|██████████████████████████████████████████████████▊ | 9521/9741 [00:34<00:00, 294.68it/s] 98%|██████████████████████████████████████████████████▉ | 9551/9741 [00:34<00:00, 295.10it/s] 98%|███████████████████████████████████████████████████▏| 9581/9741 [00:34<00:00, 295.49it/s] 99%|███████████████████████████████████████████████████▎| 9611/9741 [00:34<00:00, 295.60it/s] 99%|███████████████████████████████████████████████████▍| 9641/9741 [00:34<00:00, 295.65it/s] 99%|███████████████████████████████████████████████████▋| 9671/9741 [00:34<00:00, 295.66it/s]100%|███████████████████████████████████████████████████▊| 9701/9741 [00:34<00:00, 295.34it/s]100%|███████████████████████████████████████████████████▉| 9731/9741 [00:34<00:00, 292.95it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:34<00:00, 280.23it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.49s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.55s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.97s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.25s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.46s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.61s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.63s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.89s/it]
[2023-08-21 23:38:24,444] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
[2023-08-21 23:38:31,843] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 23:38:31,844] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fb60d67efd0>
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 23:38:31,844] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fb60b38a220>
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 23:38:31,845] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 23:38:31,845] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4932727813720703 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: 770

Input: Jodi starts off walking 1 mile a day for 6 days a week.  On the second week, she walks 2 miles a day, 6 days a week.  On the third week, she walks 3 miles a day, 6 days a week. Finally on the fourth week, she walks 4 miles a day, 6 days a week.  How many miles has she walked in 4 weeks?
Output: 60

Input: A club is going to get additional members so that they will have 5 more than twice their current number of their members. If the club has 10 members now, how many additional members do they need?
Output: 15

Input: Andrea buys herself a pony for her 30th birthday. She pays $500/month to rent a pasture for it, $10 a day for food, and $60/lesson for two lessons a week. How much does she spend on her pony in a year?
Output: 15890

Input: A pet shop has 2 puppies and some kittens. A puppy costs $20, and a kitten costs $15. If the stock is worth $100, how many kittens does the pet shop have?
Output: 4

Input: Noah, who loves his Grammy, calls her every week to talk about his day. If each call lasts 30 minutes and he is charged $0.05 per call minute, how much would he be billed if he makes the calls for a year?
Output: 78

Input: A merchant bought 15 keyboards and 25 printers for a total of $2050. If a keyboard costs $20, how much does a printer cost?
Output: 70

Input: Gina has two bank accounts. Each account has a quarter of the balance in Betty's account. If Betty's account balance is $3,456, what is the combined balance of both Gina's accounts?
Output: 1728

Input: Zain has 10 more of each coin than Emerie. If Emerie has six quarters, seven dimes, and five nickels, how many coins does Zain have?
Output: 48

Input: Adonis is playing a prank on his dad by replacing his shampoo with hot sauce. Every day, after his dad showers, Adonis replaces the shampoo with 1/2 an ounce of hot sauce. He knows his dad uses 1 oz of shampoo a day from a new 10 oz bottle that no one else uses. After 4 days, what percentage of the liquid in the bottle is hot sauce?
Output: 25

Input: Lana and Mike are taking their dog and renting a cabin in the mountains for 2 weeks.  The daily rate is $125.00  There is a $100.00 pet fee.  There is also a 20% service/cleaning fee for the rental.  They need to pay 50% of the entire bill as a security deposit.  How much is their security deposit?
Output: 1110

Input: Abigail is trying a new recipe for a cold drink. It uses 1/4 of a cup of iced tea and 1 and 1/4 of a cup of lemonade to make one drink. If she fills a pitcher with 18 total cups of this drink, how many cups of lemonade are in the pitcher?
Output: 15

Input: John buys a vacuum cleaner for $250 and a dishwasher for $450.  She has a $75 off coupon.  How much did he spend?
Output: 625

Input: Dany owns a farm, in his farm he has 4 cows and 3 sheep that eat 2 bushels a day. He also has 7 chickens that eat 3 bushels a day. How many bushels should he have to suffice the animals for a day?
Output: 35

Input: The town of Belize has 400 homes. One fourth of the town's homes are white. One fifth of the non-white homes have a fireplace. How many of the non-white homes do not have a fireplace?
Output: 240

Input: In a race, there are eight runners. The first five runners finish the race in 8 hours, while the rest of the runners finish the race 2 hours later. Calculate the total time the eight runners took to finish the race.
Output: 70

Input: Hannah is trying to figure out how much she'll get paid this week. She makes $30/hour and works 18 hours per week. Her pay is docked $5 each time she's late. If she was late 3 times this week, how much does she get paid?
Output: 525

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o25-tgsm8k-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.40441203117370605 seconds
Loading extension module utils...
Time to load utils op: 0.4044008255004883 seconds
Loading extension module utils...
Time to load utils op: 0.4045071601867676 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3457867) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_23:38:40
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3457868)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-21_23:38:40
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3457869)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-21_23:38:40
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3457870)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_23:38:40
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3457867)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o10-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 10
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

using world size: 4
[2023-08-21 23:38:43,331] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o10-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 10
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o10-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▎                                                     | 48/9741 [00:00<00:20, 474.80it/s]  1%|▌                                                     | 96/9741 [00:00<00:20, 460.38it/s]  1%|▊                                                    | 144/9741 [00:00<00:20, 466.55it/s]  2%|█                                                    | 192/9741 [00:00<00:20, 469.24it/s]  2%|█▎                                                   | 239/9741 [00:00<00:20, 468.61it/s]  3%|█▌                                                   | 287/9741 [00:00<00:20, 470.86it/s]  3%|█▊                                                   | 335/9741 [00:00<00:19, 472.35it/s]  4%|██                                                   | 383/9741 [00:00<00:19, 473.68it/s]  4%|██▎                                                  | 431/9741 [00:00<00:19, 472.36it/s]  5%|██▌                                                  | 479/9741 [00:01<00:19, 473.62it/s]  5%|██▊                                                  | 527/9741 [00:01<00:19, 473.87it/s]  6%|███▏                                                 | 575/9741 [00:01<00:19, 472.13it/s]  6%|███▍                                                 | 623/9741 [00:01<00:19, 469.73it/s]  7%|███▋                                                 | 670/9741 [00:01<00:19, 467.58it/s]  7%|███▉                                                 | 718/9741 [00:01<00:19, 470.21it/s]  8%|████▏                                                | 766/9741 [00:01<00:19, 471.60it/s]  8%|████▍                                                | 814/9741 [00:01<00:18, 473.27it/s]  9%|████▋                                                | 862/9741 [00:01<00:18, 474.72it/s]  9%|████▉                                                | 910/9741 [00:01<00:18, 473.25it/s] 10%|█████▏                                               | 958/9741 [00:02<00:18, 472.89it/s] 10%|█████▎                                              | 1006/9741 [00:02<00:18, 473.43it/s] 11%|█████▋                                              | 1054/9741 [00:02<00:18, 474.62it/s] 11%|█████▉                                              | 1102/9741 [00:02<00:18, 475.67it/s] 12%|██████▏                                             | 1150/9741 [00:02<00:18, 473.88it/s] 12%|██████▍                                             | 1198/9741 [00:02<00:18, 473.91it/s] 13%|██████▋                                             | 1246/9741 [00:02<00:17, 473.67it/s] 13%|██████▉                                             | 1294/9741 [00:02<00:17, 474.61it/s] 14%|███████▏                                            | 1342/9741 [00:02<00:17, 472.51it/s] 14%|███████▍                                            | 1390/9741 [00:02<00:17, 473.04it/s] 15%|███████▋                                            | 1438/9741 [00:03<00:17, 472.78it/s] 15%|███████▉                                            | 1486/9741 [00:03<00:17, 473.67it/s] 16%|████████▏                                           | 1534/9741 [00:03<00:17, 473.71it/s] 16%|████████▍                                           | 1582/9741 [00:03<00:17, 471.53it/s] 17%|████████▋                                           | 1630/9741 [00:03<00:17, 472.19it/s] 17%|████████▉                                           | 1678/9741 [00:03<00:17, 472.74it/s] 18%|█████████▎                                          | 1736/9741 [00:03<00:15, 503.89it/s] 18%|█████████▌                                          | 1801/9741 [00:03<00:14, 546.09it/s] 19%|█████████▉                                          | 1871/9741 [00:03<00:13, 591.58it/s] 20%|██████████▎                                         | 1943/9741 [00:03<00:12, 629.03it/s] 21%|██████████▊                                         | 2015/9741 [00:04<00:11, 655.86it/s] 21%|███████████▏                                        | 2086/9741 [00:04<00:11, 671.23it/s] 22%|███████████▌                                        | 2159/9741 [00:04<00:11, 685.64it/s] 23%|███████████▉                                        | 2231/9741 [00:04<00:10, 695.42it/s] 24%|████████████▎                                       | 2303/9741 [00:04<00:10, 700.40it/s] 24%|████████████▋                                       | 2375/9741 [00:04<00:10, 705.66it/s] 25%|█████████████                                       | 2448/9741 [00:04<00:10, 710.23it/s] 26%|█████████████▍                                      | 2520/9741 [00:04<00:10, 709.72it/s] 27%|█████████████▊                                      | 2593/9741 [00:04<00:10, 713.24it/s] 27%|██████████████▏                                     | 2665/9741 [00:04<00:09, 714.95it/s] 28%|██████████████▌                                     | 2737/9741 [00:05<00:09, 711.65it/s] 29%|██████████████▉                                     | 2809/9741 [00:05<00:09, 697.97it/s] 30%|███████████████▍                                    | 2881/9741 [00:05<00:09, 702.27it/s] 30%|███████████████▊                                    | 2952/9741 [00:05<00:09, 703.68it/s] 31%|████████████████▏                                   | 3025/9741 [00:05<00:09, 708.54it/s] 32%|████████████████▌                                   | 3097/9741 [00:05<00:09, 709.96it/s] 33%|████████████████▉                                   | 3169/9741 [00:05<00:09, 710.88it/s] 33%|█████████████████▎                                  | 3242/9741 [00:05<00:09, 713.95it/s] 34%|█████████████████▋                                  | 3314/9741 [00:05<00:08, 715.41it/s] 35%|██████████████████                                  | 3386/9741 [00:05<00:08, 713.80it/s] 35%|██████████████████▍                                 | 3458/9741 [00:06<00:08, 714.78it/s] 36%|██████████████████▊                                 | 3530/9741 [00:06<00:08, 714.93it/s] 37%|███████████████████▏                                | 3602/9741 [00:06<00:08, 715.49it/s] 38%|███████████████████▌                                | 3674/9741 [00:06<00:08, 713.06it/s] 38%|███████████████████▉                                | 3746/9741 [00:06<00:08, 711.38it/s] 39%|████████████████████▍                               | 3818/9741 [00:06<00:08, 713.08it/s] 40%|████████████████████▊                               | 3890/9741 [00:06<00:08, 712.58it/s] 41%|█████████████████████▏                              | 3962/9741 [00:06<00:08, 714.14it/s] 41%|█████████████████████▌                              | 4034/9741 [00:06<00:07, 715.33it/s] 42%|█████████████████████▉                              | 4106/9741 [00:06<00:07, 713.70it/s] 43%|██████████████████████▎                             | 4178/9741 [00:07<00:07, 714.75it/s] 44%|██████████████████████▋                             | 4250/9741 [00:07<00:07, 712.97it/s] 44%|███████████████████████                             | 4322/9741 [00:07<00:07, 711.72it/s] 45%|███████████████████████▍                            | 4394/9741 [00:07<00:07, 713.98it/s] 46%|███████████████████████▊                            | 4466/9741 [00:07<00:07, 714.49it/s] 47%|████████████████████████▏                           | 4538/9741 [00:07<00:07, 669.94it/s] 47%|████████████████████████▌                           | 4610/9741 [00:07<00:07, 682.78it/s] 48%|████████████████████████▉                           | 4682/9741 [00:07<00:07, 692.35it/s] 49%|█████████████████████████▎                          | 4752/9741 [00:08<00:09, 505.75it/s] 49%|█████████████████████████▋                          | 4820/9741 [00:08<00:09, 543.80it/s] 50%|██████████████████████████                          | 4888/9741 [00:08<00:08, 576.23it/s] 51%|██████████████████████████▍                         | 4959/9741 [00:08<00:07, 611.00it/s] 52%|██████████████████████████▊                         | 5031/9741 [00:08<00:07, 639.88it/s] 52%|███████████████████████████▏                        | 5103/9741 [00:08<00:07, 661.19it/s] 53%|███████████████████████████▋                        | 5175/9741 [00:08<00:06, 675.45it/s] 54%|████████████████████████████                        | 5247/9741 [00:08<00:06, 687.42it/s] 55%|████████████████████████████▍                       | 5319/9741 [00:08<00:06, 696.17it/s] 55%|████████████████████████████▊                       | 5391/9741 [00:08<00:06, 702.06it/s] 56%|█████████████████████████████▏                      | 5462/9741 [00:09<00:06, 703.80it/s] 57%|█████████████████████████████▌                      | 5536/9741 [00:09<00:05, 714.49it/s] 58%|█████████████████████████████▉                      | 5611/9741 [00:09<00:05, 722.91it/s] 58%|██████████████████████████████▎                     | 5685/9741 [00:09<00:05, 725.81it/s] 59%|██████████████████████████████▋                     | 5760/9741 [00:09<00:05, 731.08it/s] 60%|███████████████████████████████▏                    | 5835/9741 [00:09<00:05, 734.93it/s] 61%|███████████████████████████████▌                    | 5909/9741 [00:09<00:05, 735.49it/s] 61%|███████████████████████████████▉                    | 5984/9741 [00:09<00:05, 738.94it/s] 62%|████████████████████████████████▎                   | 6059/9741 [00:09<00:04, 741.42it/s] 63%|████████████████████████████████▋                   | 6134/9741 [00:09<00:04, 739.88it/s] 64%|█████████████████████████████████▏                  | 6209/9741 [00:10<00:04, 742.18it/s] 65%|█████████████████████████████████▌                  | 6284/9741 [00:10<00:04, 742.52it/s] 65%|█████████████████████████████████▉                  | 6359/9741 [00:10<00:04, 741.16it/s] 66%|██████████████████████████████████▎                 | 6434/9741 [00:10<00:04, 741.30it/s] 67%|██████████████████████████████████▋                 | 6509/9741 [00:10<00:04, 730.31it/s] 68%|███████████████████████████████████▏                | 6583/9741 [00:10<00:04, 729.69it/s] 68%|███████████████████████████████████▌                | 6657/9741 [00:10<00:04, 732.30it/s] 69%|███████████████████████████████████▉                | 6732/9741 [00:10<00:04, 735.32it/s] 70%|████████████████████████████████████▎               | 6806/9741 [00:10<00:03, 736.27it/s] 71%|████████████████████████████████████▋               | 6881/9741 [00:10<00:03, 737.90it/s] 71%|█████████████████████████████████████▏              | 6956/9741 [00:11<00:03, 739.43it/s] 72%|█████████████████████████████████████▌              | 7030/9741 [00:11<00:03, 735.59it/s] 73%|█████████████████████████████████████▉              | 7105/9741 [00:11<00:03, 737.44it/s] 74%|██████████████████████████████████████▎             | 7179/9741 [00:11<00:03, 707.72it/s] 74%|██████████████████████████████████████▋             | 7253/9741 [00:11<00:03, 714.88it/s] 75%|███████████████████████████████████████             | 7328/9741 [00:11<00:03, 722.85it/s] 76%|███████████████████████████████████████▌            | 7403/9741 [00:11<00:03, 729.29it/s] 77%|███████████████████████████████████████▉            | 7477/9741 [00:11<00:03, 699.43it/s] 78%|████████████████████████████████████████▎           | 7551/9741 [00:11<00:03, 709.41it/s] 78%|████████████████████████████████████████▋           | 7626/9741 [00:12<00:02, 719.54it/s] 79%|█████████████████████████████████████████           | 7700/9741 [00:12<00:02, 723.84it/s] 80%|█████████████████████████████████████████▍          | 7774/9741 [00:12<00:02, 728.04it/s] 81%|█████████████████████████████████████████▉          | 7849/9741 [00:12<00:02, 732.92it/s] 81%|██████████████████████████████████████████▎         | 7923/9741 [00:12<00:02, 733.49it/s] 82%|██████████████████████████████████████████▋         | 7997/9741 [00:12<00:02, 734.53it/s] 83%|███████████████████████████████████████████         | 8072/9741 [00:12<00:02, 737.00it/s] 84%|███████████████████████████████████████████▍        | 8147/9741 [00:12<00:02, 738.42it/s] 84%|███████████████████████████████████████████▉        | 8222/9741 [00:12<00:02, 740.38it/s] 85%|████████████████████████████████████████████▎       | 8297/9741 [00:12<00:01, 740.89it/s] 86%|████████████████████████████████████████████▋       | 8372/9741 [00:13<00:01, 737.09it/s] 87%|█████████████████████████████████████████████       | 8446/9741 [00:13<00:01, 736.43it/s] 87%|█████████████████████████████████████████████▍      | 8520/9741 [00:13<00:01, 732.68it/s] 88%|█████████████████████████████████████████████▉      | 8594/9741 [00:13<00:01, 732.48it/s] 89%|██████████████████████████████████████████████▎     | 8668/9741 [00:13<00:01, 732.82it/s] 90%|██████████████████████████████████████████████▋     | 8742/9741 [00:13<00:01, 733.39it/s] 91%|███████████████████████████████████████████████     | 8816/9741 [00:13<00:01, 730.18it/s] 91%|███████████████████████████████████████████████▍    | 8890/9741 [00:13<00:01, 730.98it/s] 92%|███████████████████████████████████████████████▊    | 8964/9741 [00:13<00:01, 732.00it/s] 93%|████████████████████████████████████████████████▏   | 9038/9741 [00:13<00:00, 730.87it/s] 94%|████████████████████████████████████████████████▋   | 9113/9741 [00:14<00:00, 734.28it/s] 94%|█████████████████████████████████████████████████   | 9188/9741 [00:14<00:00, 737.49it/s] 95%|█████████████████████████████████████████████████▍  | 9262/9741 [00:14<00:00, 737.30it/s] 96%|█████████████████████████████████████████████████▊  | 9337/9741 [00:14<00:00, 738.64it/s] 97%|██████████████████████████████████████████████████▏ | 9411/9741 [00:14<00:00, 738.58it/s] 97%|██████████████████████████████████████████████████▋ | 9485/9741 [00:14<00:00, 735.61it/s] 98%|███████████████████████████████████████████████████ | 9560/9741 [00:14<00:00, 737.05it/s] 99%|███████████████████████████████████████████████████▍| 9634/9741 [00:14<00:00, 737.48it/s]100%|███████████████████████████████████████████████████▊| 9708/9741 [00:14<00:00, 738.16it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:14<00:00, 654.36it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.15s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.30s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.28s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.15s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.03s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.22s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.31s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.51s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.42s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.60s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.51s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
[2023-08-21 23:39:50,612] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 23:39:57,264] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 23:39:57,265] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 23:39:57,265] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 23:39:57,265] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 23:39:57,265] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 23:39:57,265] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 23:39:57,265] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 23:39:57,265] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 23:39:57,265] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f309f536fd0>
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f309f049220>
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 23:39:57,266] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 23:39:57,267] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 23:39:57,267] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 23:39:57,267] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 23:39:57,267] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 23:39:57,267] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.41000962257385254 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.40444016456604004 seconds
Time to load utils op: 0.30487751960754395 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o10-tgsm8k-s20-rFalse
Loading extension module utils...
Time to load utils op: 0.4043433666229248 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:44<35:59, 44.07s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:27<35:03, 43.83s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:11<34:14, 43.71s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:56<33:54, 44.24s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:33<31:15, 41.68s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:16<31:00, 42.27s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:00<30:42, 42.86s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:44<30:07, 43.04s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:28<29:40, 43.42s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:12<29:07, 43.69s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:56<28:24, 43.70s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:37<27:03, 42.73s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:20<26:30, 42.99s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:48<23:06, 38.52s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:32<23:18, 39.95s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:16<23:27, 41.40s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:00<23:03, 41.93s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:42<22:28, 42.14s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:27<22:06, 42.78s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:01<20:08, 40.30s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:45<20:01, 41.43s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:28<19:32, 41.86s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:11<18:58, 42.15s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [16:54<18:23, 42.44s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:37<17:44, 42.60s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:21<17:12, 43.01s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [19:05<16:38, 43.43s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [19:49<15:54, 43.38s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:32<15:08, 43.25s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [21:15<14:28, 43.45s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [21:45<12:28, 39.39s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [22:30<12:17, 40.98s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [23:14<11:54, 42.01s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:57<11:16, 42.30s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [24:34<10:10, 40.70s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [25:18<09:43, 41.71s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [26:03<09:11, 42.45s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [26:47<08:35, 42.94s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [27:14<06:59, 38.15s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [27:58<06:40, 40.02s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [28:42<06:11, 41.28s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [29:26<05:36, 42.09s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [30:11<04:59, 42.74s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [30:54<04:18, 43.10s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [31:38<03:36, 43.21s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [32:01<02:28, 37.17s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [32:45<01:57, 39.15s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [33:28<01:20, 40.46s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [34:12<00:41, 41.43s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:56<00:00, 42.05s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:56<00:00, 41.92s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.6386} | avg. gen lenth: 274.444
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o11-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 11
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 00:15:47,301] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o11-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 11
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o11-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 45/9741 [00:00<00:21, 441.01it/s]  1%|▍                                                     | 90/9741 [00:00<00:21, 442.90it/s]  1%|▋                                                    | 135/9741 [00:00<00:21, 443.93it/s]  2%|▉                                                    | 180/9741 [00:00<00:21, 444.05it/s]  2%|█▏                                                   | 225/9741 [00:00<00:21, 441.91it/s]  3%|█▍                                                   | 270/9741 [00:00<00:21, 442.99it/s]  3%|█▋                                                   | 315/9741 [00:00<00:21, 443.62it/s]  4%|█▉                                                   | 360/9741 [00:00<00:21, 439.45it/s]  4%|██▏                                                  | 404/9741 [00:00<00:21, 438.88it/s]  5%|██▍                                                  | 448/9741 [00:01<00:21, 436.18it/s]  5%|██▋                                                  | 493/9741 [00:01<00:21, 438.42it/s]  6%|██▉                                                  | 538/9741 [00:01<00:20, 440.44it/s]  6%|███▏                                                 | 583/9741 [00:01<00:20, 441.48it/s]  6%|███▍                                                 | 628/9741 [00:01<00:20, 442.42it/s]  7%|███▋                                                 | 673/9741 [00:01<00:20, 440.92it/s]  7%|███▉                                                 | 718/9741 [00:01<00:20, 441.48it/s]  8%|████▏                                                | 763/9741 [00:01<00:20, 442.27it/s]  8%|████▍                                                | 808/9741 [00:01<00:20, 441.37it/s]  9%|████▋                                                | 853/9741 [00:01<00:20, 442.32it/s]  9%|████▉                                                | 898/9741 [00:02<00:20, 441.29it/s] 10%|█████▏                                               | 943/9741 [00:02<00:19, 442.22it/s] 10%|█████▍                                               | 988/9741 [00:02<00:19, 443.13it/s] 11%|█████▌                                              | 1033/9741 [00:02<00:19, 443.91it/s] 11%|█████▊                                              | 1078/9741 [00:02<00:19, 444.92it/s] 12%|█████▉                                              | 1123/9741 [00:02<00:19, 443.10it/s] 12%|██████▏                                             | 1168/9741 [00:02<00:19, 443.69it/s] 12%|██████▍                                             | 1213/9741 [00:02<00:19, 443.38it/s] 13%|██████▋                                             | 1259/9741 [00:02<00:18, 447.35it/s] 14%|███████                                             | 1327/9741 [00:02<00:16, 514.92it/s] 14%|███████▍                                            | 1393/9741 [00:03<00:14, 557.98it/s] 15%|███████▊                                            | 1461/9741 [00:03<00:13, 592.29it/s] 16%|████████▏                                           | 1529/9741 [00:03<00:13, 615.85it/s] 16%|████████▌                                           | 1596/9741 [00:03<00:12, 629.21it/s] 17%|████████▉                                           | 1664/9741 [00:03<00:12, 643.06it/s] 18%|█████████▏                                          | 1730/9741 [00:03<00:12, 647.59it/s] 18%|█████████▌                                          | 1795/9741 [00:03<00:12, 629.94it/s] 19%|█████████▉                                          | 1862/9741 [00:03<00:12, 641.46it/s] 20%|██████████▎                                         | 1930/9741 [00:03<00:12, 650.10it/s] 21%|██████████▋                                         | 1998/9741 [00:03<00:11, 656.36it/s] 21%|███████████                                         | 2064/9741 [00:04<00:11, 657.16it/s] 22%|███████████▍                                        | 2131/9741 [00:04<00:11, 659.77it/s] 23%|███████████▋                                        | 2198/9741 [00:04<00:11, 662.17it/s] 23%|████████████                                        | 2265/9741 [00:04<00:11, 661.88it/s] 24%|████████████▍                                       | 2332/9741 [00:04<00:11, 664.12it/s] 25%|████████████▊                                       | 2400/9741 [00:04<00:11, 666.25it/s] 25%|█████████████▏                                      | 2468/9741 [00:04<00:10, 668.03it/s] 26%|█████████████▌                                      | 2535/9741 [00:04<00:10, 665.57it/s] 27%|█████████████▉                                      | 2603/9741 [00:04<00:10, 667.07it/s] 27%|██████████████▎                                     | 2670/9741 [00:04<00:10, 667.06it/s] 28%|██████████████▌                                     | 2737/9741 [00:05<00:10, 663.48it/s] 29%|██████████████▉                                     | 2804/9741 [00:05<00:10, 664.33it/s] 29%|███████████████▎                                    | 2872/9741 [00:05<00:10, 666.57it/s] 30%|███████████████▋                                    | 2939/9741 [00:05<00:10, 664.60it/s] 31%|████████████████                                    | 3006/9741 [00:05<00:10, 665.85it/s] 32%|████████████████▍                                   | 3073/9741 [00:05<00:10, 665.42it/s] 32%|████████████████▊                                   | 3140/9741 [00:05<00:09, 666.65it/s] 33%|█████████████████                                   | 3207/9741 [00:05<00:09, 660.76it/s] 34%|█████████████████▍                                  | 3275/9741 [00:05<00:09, 663.54it/s] 34%|█████████████████▊                                  | 3342/9741 [00:05<00:09, 664.56it/s] 35%|██████████████████▏                                 | 3409/9741 [00:06<00:09, 663.17it/s] 36%|██████████████████▌                                 | 3476/9741 [00:06<00:09, 664.37it/s] 36%|██████████████████▉                                 | 3543/9741 [00:06<00:09, 664.70it/s] 37%|███████████████████▎                                | 3610/9741 [00:06<00:09, 662.01it/s] 38%|███████████████████▋                                | 3677/9741 [00:06<00:09, 663.62it/s] 38%|███████████████████▉                                | 3745/9741 [00:06<00:09, 665.95it/s] 39%|████████████████████▎                               | 3812/9741 [00:06<00:08, 666.62it/s] 40%|████████████████████▋                               | 3879/9741 [00:06<00:08, 664.62it/s] 41%|█████████████████████                               | 3946/9741 [00:06<00:08, 665.61it/s] 41%|█████████████████████▍                              | 4013/9741 [00:06<00:08, 666.90it/s] 42%|█████████████████████▊                              | 4080/9741 [00:07<00:08, 658.83it/s] 43%|██████████████████████▏                             | 4147/9741 [00:07<00:08, 660.70it/s] 43%|██████████████████████▍                             | 4214/9741 [00:07<00:08, 662.11it/s] 44%|██████████████████████▊                             | 4281/9741 [00:07<00:08, 663.38it/s] 45%|███████████████████████▏                            | 4348/9741 [00:07<00:08, 661.79it/s] 45%|███████████████████████▌                            | 4415/9741 [00:07<00:08, 663.19it/s] 46%|███████████████████████▉                            | 4482/9741 [00:07<00:07, 663.98it/s] 47%|████████████████████████▎                           | 4549/9741 [00:07<00:08, 628.30it/s] 47%|████████████████████████▋                           | 4616/9741 [00:07<00:08, 640.03it/s] 48%|████████████████████████▉                           | 4683/9741 [00:08<00:07, 648.05it/s] 49%|█████████████████████████▎                          | 4749/9741 [00:08<00:09, 522.51it/s] 49%|█████████████████████████▋                          | 4816/9741 [00:08<00:08, 558.50it/s] 50%|██████████████████████████                          | 4881/9741 [00:08<00:08, 580.95it/s] 51%|██████████████████████████▍                         | 4947/9741 [00:08<00:07, 601.85it/s] 51%|██████████████████████████▊                         | 5014/9741 [00:08<00:07, 620.13it/s] 52%|███████████████████████████                         | 5080/9741 [00:08<00:07, 630.19it/s] 53%|███████████████████████████▍                        | 5147/9741 [00:08<00:07, 639.22it/s] 54%|███████████████████████████▊                        | 5213/9741 [00:08<00:07, 645.24it/s] 54%|████████████████████████████▏                       | 5280/9741 [00:09<00:06, 651.43it/s] 55%|████████████████████████████▌                       | 5347/9741 [00:09<00:06, 656.36it/s] 56%|████████████████████████████▉                       | 5413/9741 [00:09<00:06, 657.02it/s] 56%|█████████████████████████████▎                      | 5481/9741 [00:09<00:06, 661.19it/s] 57%|█████████████████████████████▋                      | 5550/9741 [00:09<00:06, 668.41it/s] 58%|█████████████████████████████▉                      | 5619/9741 [00:09<00:06, 672.90it/s] 58%|██████████████████████████████▎                     | 5687/9741 [00:09<00:06, 671.86it/s] 59%|██████████████████████████████▋                     | 5755/9741 [00:09<00:05, 672.58it/s] 60%|███████████████████████████████                     | 5825/9741 [00:09<00:05, 678.29it/s] 60%|███████████████████████████████▍                    | 5893/9741 [00:09<00:05, 677.27it/s] 61%|███████████████████████████████▊                    | 5963/9741 [00:10<00:05, 681.97it/s] 62%|████████████████████████████████▏                   | 6033/9741 [00:10<00:05, 685.04it/s] 63%|████████████████████████████████▌                   | 6102/9741 [00:10<00:05, 685.10it/s] 63%|████████████████████████████████▉                   | 6172/9741 [00:10<00:05, 687.22it/s] 64%|█████████████████████████████████▎                  | 6242/9741 [00:10<00:05, 688.56it/s] 65%|█████████████████████████████████▋                  | 6311/9741 [00:10<00:04, 687.24it/s] 66%|██████████████████████████████████                  | 6381/9741 [00:10<00:04, 689.19it/s] 66%|██████████████████████████████████▍                 | 6451/9741 [00:10<00:04, 690.77it/s] 67%|██████████████████████████████████▊                 | 6521/9741 [00:10<00:04, 689.87it/s] 68%|███████████████████████████████████▏                | 6590/9741 [00:10<00:04, 687.53it/s] 68%|███████████████████████████████████▌                | 6660/9741 [00:11<00:04, 688.33it/s] 69%|███████████████████████████████████▉                | 6730/9741 [00:11<00:04, 688.89it/s] 70%|████████████████████████████████████▎               | 6799/9741 [00:11<00:04, 687.42it/s] 71%|████████████████████████████████████▋               | 6869/9741 [00:11<00:04, 688.83it/s] 71%|█████████████████████████████████████               | 6939/9741 [00:11<00:04, 689.20it/s] 72%|█████████████████████████████████████▍              | 7008/9741 [00:11<00:03, 687.53it/s] 73%|█████████████████████████████████████▊              | 7077/9741 [00:11<00:03, 687.02it/s] 73%|██████████████████████████████████████▏             | 7146/9741 [00:11<00:03, 685.62it/s] 74%|██████████████████████████████████████▌             | 7215/9741 [00:11<00:03, 684.09it/s] 75%|██████████████████████████████████████▉             | 7285/9741 [00:11<00:03, 686.52it/s] 76%|███████████████████████████████████████▎            | 7355/9741 [00:12<00:03, 688.82it/s] 76%|███████████████████████████████████████▋            | 7425/9741 [00:12<00:03, 689.99it/s] 77%|████████████████████████████████████████            | 7494/9741 [00:12<00:03, 643.69it/s] 78%|████████████████████████████████████████▎           | 7563/9741 [00:12<00:03, 656.07it/s] 78%|████████████████████████████████████████▋           | 7633/9741 [00:12<00:03, 666.09it/s] 79%|█████████████████████████████████████████           | 7702/9741 [00:12<00:03, 670.91it/s] 80%|█████████████████████████████████████████▍          | 7772/9741 [00:12<00:02, 678.19it/s] 81%|█████████████████████████████████████████▊          | 7842/9741 [00:12<00:02, 682.17it/s] 81%|██████████████████████████████████████████▏         | 7911/9741 [00:12<00:02, 682.60it/s] 82%|██████████████████████████████████████████▌         | 7981/9741 [00:12<00:02, 685.12it/s] 83%|██████████████████████████████████████████▉         | 8050/9741 [00:13<00:02, 686.35it/s] 83%|███████████████████████████████████████████▎        | 8120/9741 [00:13<00:02, 685.10it/s] 84%|███████████████████████████████████████████▋        | 8189/9741 [00:13<00:02, 685.95it/s] 85%|████████████████████████████████████████████        | 8259/9741 [00:13<00:02, 687.72it/s] 85%|████████████████████████████████████████████▍       | 8328/9741 [00:13<00:02, 687.67it/s] 86%|████████████████████████████████████████████▊       | 8397/9741 [00:13<00:01, 685.20it/s] 87%|█████████████████████████████████████████████▏      | 8467/9741 [00:13<00:01, 687.73it/s] 88%|█████████████████████████████████████████████▌      | 8536/9741 [00:13<00:01, 687.32it/s] 88%|█████████████████████████████████████████████▉      | 8605/9741 [00:13<00:01, 685.79it/s] 89%|██████████████████████████████████████████████▎     | 8674/9741 [00:13<00:01, 683.42it/s] 90%|██████████████████████████████████████████████▋     | 8743/9741 [00:14<00:01, 685.22it/s] 90%|███████████████████████████████████████████████     | 8812/9741 [00:14<00:01, 682.97it/s] 91%|███████████████████████████████████████████████▍    | 8881/9741 [00:14<00:01, 684.92it/s] 92%|███████████████████████████████████████████████▊    | 8950/9741 [00:14<00:01, 685.97it/s] 93%|████████████████████████████████████████████████▏   | 9019/9741 [00:14<00:01, 685.75it/s] 93%|████████████████████████████████████████████████▌   | 9088/9741 [00:14<00:00, 683.41it/s] 94%|████████████████████████████████████████████████▉   | 9158/9741 [00:14<00:00, 685.73it/s] 95%|█████████████████████████████████████████████████▎  | 9228/9741 [00:14<00:00, 687.11it/s] 95%|█████████████████████████████████████████████████▋  | 9297/9741 [00:14<00:00, 685.88it/s] 96%|█████████████████████████████████████████████████▉  | 9366/9741 [00:14<00:00, 687.07it/s] 97%|██████████████████████████████████████████████████▎ | 9435/9741 [00:15<00:00, 686.88it/s] 98%|██████████████████████████████████████████████████▋ | 9504/9741 [00:15<00:00, 683.44it/s] 98%|███████████████████████████████████████████████████ | 9573/9741 [00:15<00:00, 685.26it/s] 99%|███████████████████████████████████████████████████▍| 9642/9741 [00:15<00:00, 684.62it/s]100%|███████████████████████████████████████████████████▊| 9711/9741 [00:15<00:00, 680.47it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:15<00:00, 626.61it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.03s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.12s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.20s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:06<00:12,  6.09s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.09s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.28s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.28s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:12<00:06,  6.13s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.43s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.60s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.64s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
[2023-08-22 00:16:54,770] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:18<00:00,  6.10s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:18<00:00,  6.10s/it]
[2023-08-22 00:17:08,226] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 00:17:08,227] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f870d2e2fd0>
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 00:17:08,228] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f870ce67220>
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 00:17:08,229] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 00:17:08,230] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 00:17:08,230] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4419877529144287 seconds
Loading extension module utils...
Time to load utils op: 0.5046703815460205 seconds
Loading extension module utils...
Time to load utils op: 0.4043560028076172 seconds
Loading extension module utils...
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Time to load utils op: 0.404371976852417 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o11-tgsm8k-s20-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:43<35:53, 43.94s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:27<34:45, 43.45s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:10<33:53, 43.27s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:54<33:25, 43.59s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:37<32:44, 43.66s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:20<31:45, 43.31s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:03<31:01, 43.29s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:47<30:24, 43.45s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:25<28:30, 41.72s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:09<28:15, 42.40s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:52<27:44, 42.68s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:36<27:14, 43.01s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:19<26:29, 42.96s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:02<25:44, 42.91s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:45<25:07, 43.08s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:28<24:22, 43.00s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:11<23:39, 43.01s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:54<22:56, 43.03s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:38<22:18, 43.19s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:20<21:26, 42.88s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [15:02<20:36, 42.65s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:45<20:00, 42.88s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:28<19:17, 42.88s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [17:12<18:38, 43.03s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:34<15:23, 36.95s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:17<15:30, 38.78s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [18:28<11:39, 30.40s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [19:09<12:14, 33.39s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:44<11:55, 34.07s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [20:27<12:13, 36.67s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [21:06<11:49, 37.32s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [21:49<11:41, 38.96s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [22:32<11:23, 40.18s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:15<10:57, 41.12s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [23:58<10:25, 41.72s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [24:41<09:50, 42.21s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [25:08<08:08, 37.55s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [25:51<07:49, 39.11s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [26:34<07:22, 40.20s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [27:12<06:37, 39.72s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [27:56<06:08, 40.92s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [28:38<05:30, 41.34s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [29:03<04:13, 36.29s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [29:46<03:50, 38.44s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [30:29<03:19, 39.87s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [31:12<02:42, 40.74s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [31:55<02:04, 41.43s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [32:39<01:24, 42.01s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [33:21<00:42, 42.24s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:59<00:00, 40.81s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:59<00:00, 40.79s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.3023} | avg. gen lenth: 274.872
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o12-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 12
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 00:52:36,075] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o12-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 12
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o12-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 40/9741 [00:00<00:24, 399.47it/s]  1%|▍                                                     | 81/9741 [00:00<00:24, 400.91it/s]  1%|▋                                                    | 122/9741 [00:00<00:23, 402.28it/s]  2%|▉                                                    | 163/9741 [00:00<00:23, 403.28it/s]  2%|█                                                    | 204/9741 [00:00<00:23, 400.47it/s]  3%|█▎                                                   | 245/9741 [00:00<00:23, 401.10it/s]  3%|█▌                                                   | 286/9741 [00:00<00:23, 394.97it/s]  3%|█▊                                                   | 326/9741 [00:00<00:23, 396.52it/s]  4%|█▉                                                   | 366/9741 [00:00<00:23, 397.46it/s]  4%|██▏                                                  | 407/9741 [00:01<00:23, 398.94it/s]  5%|██▍                                                  | 447/9741 [00:01<00:23, 396.90it/s]  5%|██▋                                                  | 488/9741 [00:01<00:23, 398.30it/s]  5%|██▉                                                  | 529/9741 [00:01<00:23, 399.15it/s]  6%|███                                                  | 569/9741 [00:01<00:22, 399.14it/s]  6%|███▎                                                 | 610/9741 [00:01<00:22, 399.76it/s]  7%|███▌                                                 | 650/9741 [00:01<00:22, 399.67it/s]  7%|███▊                                                 | 690/9741 [00:01<00:22, 394.83it/s]  7%|███▉                                                 | 730/9741 [00:01<00:22, 395.57it/s]  8%|████▏                                                | 771/9741 [00:01<00:22, 397.38it/s]  8%|████▍                                                | 812/9741 [00:02<00:22, 398.59it/s]  9%|████▋                                                | 853/9741 [00:02<00:22, 399.22it/s]  9%|████▊                                                | 893/9741 [00:02<00:22, 397.84it/s] 10%|█████▏                                               | 944/9741 [00:02<00:20, 430.60it/s] 10%|█████▎                                              | 1005/9741 [00:02<00:18, 482.08it/s] 11%|█████▋                                              | 1066/9741 [00:02<00:16, 518.39it/s] 12%|██████                                              | 1126/9741 [00:02<00:15, 542.24it/s] 12%|██████▎                                             | 1187/9741 [00:02<00:15, 561.27it/s] 13%|██████▋                                             | 1248/9741 [00:02<00:14, 573.21it/s] 13%|██████▉                                             | 1309/9741 [00:02<00:14, 582.37it/s] 14%|███████▎                                            | 1369/9741 [00:03<00:14, 585.95it/s] 15%|███████▋                                            | 1430/9741 [00:03<00:14, 590.62it/s] 15%|███████▉                                            | 1491/9741 [00:03<00:13, 594.51it/s] 16%|████████▎                                           | 1552/9741 [00:03<00:13, 597.19it/s] 17%|████████▌                                           | 1612/9741 [00:03<00:13, 594.25it/s] 17%|████████▉                                           | 1672/9741 [00:03<00:13, 591.19it/s] 18%|█████████▎                                          | 1733/9741 [00:03<00:13, 593.89it/s] 18%|█████████▌                                          | 1793/9741 [00:03<00:13, 573.88it/s] 19%|█████████▉                                          | 1853/9741 [00:03<00:13, 579.17it/s] 20%|██████████▏                                         | 1913/9741 [00:03<00:13, 584.35it/s] 20%|██████████▌                                         | 1974/9741 [00:04<00:13, 589.12it/s] 21%|██████████▊                                         | 2034/9741 [00:04<00:13, 589.72it/s] 21%|███████████▏                                        | 2094/9741 [00:04<00:12, 592.55it/s] 22%|███████████▍                                        | 2154/9741 [00:04<00:12, 592.50it/s] 23%|███████████▊                                        | 2215/9741 [00:04<00:12, 595.59it/s] 23%|████████████▏                                       | 2275/9741 [00:04<00:12, 595.23it/s] 24%|████████████▍                                       | 2336/9741 [00:04<00:12, 597.11it/s] 25%|████████████▊                                       | 2397/9741 [00:04<00:12, 598.94it/s] 25%|█████████████                                       | 2457/9741 [00:04<00:12, 598.24it/s] 26%|█████████████▍                                      | 2517/9741 [00:04<00:12, 593.81it/s] 26%|█████████████▊                                      | 2577/9741 [00:05<00:12, 595.26it/s] 27%|██████████████                                      | 2638/9741 [00:05<00:11, 597.00it/s] 28%|██████████████▍                                     | 2698/9741 [00:05<00:11, 596.05it/s] 28%|██████████████▋                                     | 2758/9741 [00:05<00:11, 596.95it/s] 29%|███████████████                                     | 2818/9741 [00:05<00:11, 596.79it/s] 30%|███████████████▎                                    | 2879/9741 [00:05<00:11, 598.92it/s] 30%|███████████████▋                                    | 2939/9741 [00:05<00:11, 591.75it/s] 31%|████████████████                                    | 2999/9741 [00:05<00:11, 594.04it/s] 31%|████████████████▎                                   | 3059/9741 [00:05<00:11, 595.28it/s] 32%|████████████████▋                                   | 3119/9741 [00:05<00:11, 592.42it/s] 33%|████████████████▉                                   | 3179/9741 [00:06<00:11, 590.50it/s] 33%|█████████████████▎                                  | 3240/9741 [00:06<00:10, 593.74it/s] 34%|█████████████████▌                                  | 3301/9741 [00:06<00:10, 596.07it/s] 35%|█████████████████▉                                  | 3362/9741 [00:06<00:10, 597.62it/s] 35%|██████████████████▎                                 | 3422/9741 [00:06<00:10, 596.56it/s] 36%|██████████████████▌                                 | 3482/9741 [00:06<00:10, 595.08it/s] 36%|██████████████████▉                                 | 3542/9741 [00:06<00:10, 596.17it/s] 37%|███████████████████▏                                | 3602/9741 [00:06<00:10, 595.25it/s] 38%|███████████████████▌                                | 3662/9741 [00:06<00:10, 594.07it/s] 38%|███████████████████▊                                | 3722/9741 [00:07<00:10, 591.47it/s] 39%|████████████████████▏                               | 3782/9741 [00:07<00:10, 592.11it/s] 39%|████████████████████▌                               | 3842/9741 [00:07<00:09, 590.84it/s] 40%|████████████████████▊                               | 3903/9741 [00:07<00:09, 594.46it/s] 41%|█████████████████████▏                              | 3963/9741 [00:07<00:09, 595.53it/s] 41%|█████████████████████▍                              | 4023/9741 [00:07<00:09, 596.82it/s] 42%|█████████████████████▊                              | 4083/9741 [00:07<00:09, 595.41it/s] 43%|██████████████████████                              | 4143/9741 [00:07<00:09, 596.54it/s] 43%|██████████████████████▍                             | 4203/9741 [00:07<00:09, 597.33it/s] 44%|██████████████████████▊                             | 4264/9741 [00:07<00:09, 598.68it/s] 44%|███████████████████████                             | 4324/9741 [00:08<00:09, 595.04it/s] 45%|███████████████████████▍                            | 4384/9741 [00:08<00:08, 595.54it/s] 46%|███████████████████████▋                            | 4444/9741 [00:08<00:08, 594.11it/s] 46%|████████████████████████                            | 4504/9741 [00:08<00:08, 591.58it/s] 47%|████████████████████████▎                           | 4564/9741 [00:08<00:09, 545.74it/s] 47%|████████████████████████▋                           | 4624/9741 [00:08<00:09, 560.94it/s] 48%|█████████████████████████                           | 4684/9741 [00:08<00:08, 572.06it/s] 49%|█████████████████████████▎                          | 4742/9741 [00:08<00:12, 415.03it/s] 49%|█████████████████████████▋                          | 4802/9741 [00:08<00:10, 457.36it/s] 50%|█████████████████████████▉                          | 4862/9741 [00:09<00:09, 492.48it/s] 51%|██████████████████████████▎                         | 4923/9741 [00:09<00:09, 520.95it/s] 51%|██████████████████████████▌                         | 4983/9741 [00:09<00:08, 540.64it/s] 52%|██████████████████████████▉                         | 5044/9741 [00:09<00:08, 557.51it/s] 52%|███████████████████████████▎                        | 5105/9741 [00:09<00:08, 569.76it/s] 53%|███████████████████████████▌                        | 5165/9741 [00:09<00:07, 578.24it/s] 54%|███████████████████████████▉                        | 5225/9741 [00:09<00:07, 581.83it/s] 54%|████████████████████████████▏                       | 5285/9741 [00:09<00:07, 586.67it/s] 55%|████████████████████████████▌                       | 5345/9741 [00:09<00:07, 590.25it/s] 55%|████████████████████████████▊                       | 5405/9741 [00:10<00:07, 588.19it/s] 56%|█████████████████████████████▏                      | 5466/9741 [00:10<00:07, 591.98it/s] 57%|█████████████████████████████▌                      | 5528/9741 [00:10<00:07, 600.26it/s] 57%|█████████████████████████████▊                      | 5590/9741 [00:10<00:06, 605.72it/s] 58%|██████████████████████████████▏                     | 5651/9741 [00:10<00:06, 606.20it/s] 59%|██████████████████████████████▌                     | 5714/9741 [00:10<00:06, 611.52it/s] 59%|██████████████████████████████▊                     | 5776/9741 [00:10<00:06, 613.78it/s] 60%|███████████████████████████████▏                    | 5839/9741 [00:10<00:06, 615.91it/s] 61%|███████████████████████████████▌                    | 5901/9741 [00:10<00:06, 615.19it/s] 61%|███████████████████████████████▊                    | 5964/9741 [00:10<00:06, 617.27it/s] 62%|████████████████████████████████▏                   | 6026/9741 [00:11<00:06, 616.03it/s] 62%|████████████████████████████████▍                   | 6088/9741 [00:11<00:05, 614.83it/s] 63%|████████████████████████████████▊                   | 6150/9741 [00:11<00:05, 615.93it/s] 64%|█████████████████████████████████▏                  | 6212/9741 [00:11<00:05, 616.00it/s] 64%|█████████████████████████████████▍                  | 6274/9741 [00:11<00:05, 615.69it/s] 65%|█████████████████████████████████▊                  | 6336/9741 [00:11<00:05, 614.03it/s] 66%|██████████████████████████████████▏                 | 6398/9741 [00:11<00:05, 615.00it/s] 66%|██████████████████████████████████▍                 | 6460/9741 [00:11<00:05, 615.53it/s] 67%|██████████████████████████████████▊                 | 6523/9741 [00:11<00:05, 617.08it/s] 68%|███████████████████████████████████▏                | 6585/9741 [00:11<00:05, 615.49it/s] 68%|███████████████████████████████████▍                | 6647/9741 [00:12<00:05, 614.99it/s] 69%|███████████████████████████████████▊                | 6710/9741 [00:12<00:04, 616.58it/s] 70%|████████████████████████████████████▏               | 6772/9741 [00:12<00:04, 615.82it/s] 70%|████████████████████████████████████▍               | 6835/9741 [00:12<00:04, 617.50it/s] 71%|████████████████████████████████████▊               | 6898/9741 [00:12<00:04, 618.35it/s] 71%|█████████████████████████████████████▏              | 6960/9741 [00:12<00:04, 617.48it/s] 72%|█████████████████████████████████████▍              | 7022/9741 [00:12<00:04, 614.98it/s] 73%|█████████████████████████████████████▊              | 7084/9741 [00:12<00:04, 616.15it/s] 73%|██████████████████████████████████████▏             | 7146/9741 [00:12<00:04, 617.19it/s] 74%|██████████████████████████████████████▍             | 7208/9741 [00:12<00:04, 618.01it/s] 75%|██████████████████████████████████████▊             | 7270/9741 [00:13<00:04, 616.10it/s] 75%|███████████████████████████████████████▏            | 7332/9741 [00:13<00:03, 616.95it/s] 76%|███████████████████████████████████████▍            | 7395/9741 [00:13<00:03, 618.51it/s] 77%|███████████████████████████████████████▊            | 7457/9741 [00:13<00:03, 586.24it/s] 77%|████████████████████████████████████████▏           | 7518/9741 [00:13<00:03, 592.72it/s] 78%|████████████████████████████████████████▍           | 7579/9741 [00:13<00:03, 595.66it/s] 78%|████████████████████████████████████████▊           | 7640/9741 [00:13<00:03, 597.43it/s] 79%|█████████████████████████████████████████           | 7701/9741 [00:13<00:03, 600.23it/s] 80%|█████████████████████████████████████████▍          | 7763/9741 [00:13<00:03, 606.01it/s] 80%|█████████████████████████████████████████▊          | 7825/9741 [00:13<00:03, 609.92it/s] 81%|██████████████████████████████████████████          | 7887/9741 [00:14<00:03, 609.47it/s] 82%|██████████████████████████████████████████▍         | 7949/9741 [00:14<00:02, 609.66it/s] 82%|██████████████████████████████████████████▊         | 8011/9741 [00:14<00:02, 611.66it/s] 83%|███████████████████████████████████████████         | 8073/9741 [00:14<00:02, 613.76it/s] 84%|███████████████████████████████████████████▍        | 8135/9741 [00:14<00:02, 611.78it/s] 84%|███████████████████████████████████████████▊        | 8197/9741 [00:14<00:02, 612.83it/s] 85%|████████████████████████████████████████████        | 8259/9741 [00:14<00:02, 611.99it/s] 85%|████████████████████████████████████████████▍       | 8321/9741 [00:14<00:02, 612.38it/s] 86%|████████████████████████████████████████████▊       | 8383/9741 [00:14<00:02, 611.84it/s] 87%|█████████████████████████████████████████████       | 8446/9741 [00:14<00:02, 614.48it/s] 87%|█████████████████████████████████████████████▍      | 8508/9741 [00:15<00:02, 613.88it/s] 88%|█████████████████████████████████████████████▋      | 8570/9741 [00:15<00:01, 614.45it/s] 89%|██████████████████████████████████████████████      | 8632/9741 [00:15<00:01, 613.20it/s] 89%|██████████████████████████████████████████████▍     | 8694/9741 [00:15<00:01, 613.61it/s] 90%|██████████████████████████████████████████████▋     | 8756/9741 [00:15<00:01, 613.14it/s] 91%|███████████████████████████████████████████████     | 8818/9741 [00:15<00:01, 611.31it/s] 91%|███████████████████████████████████████████████▍    | 8880/9741 [00:15<00:01, 611.81it/s] 92%|███████████████████████████████████████████████▋    | 8942/9741 [00:15<00:01, 611.81it/s] 92%|████████████████████████████████████████████████    | 9004/9741 [00:15<00:01, 611.83it/s] 93%|████████████████████████████████████████████████▍   | 9066/9741 [00:15<00:01, 611.51it/s] 94%|████████████████████████████████████████████████▋   | 9128/9741 [00:16<00:01, 611.24it/s] 94%|█████████████████████████████████████████████████   | 9190/9741 [00:16<00:00, 612.54it/s] 95%|█████████████████████████████████████████████████▍  | 9252/9741 [00:16<00:00, 613.31it/s] 96%|█████████████████████████████████████████████████▋  | 9314/9741 [00:16<00:00, 612.65it/s] 96%|██████████████████████████████████████████████████  | 9376/9741 [00:16<00:00, 614.14it/s] 97%|██████████████████████████████████████████████████▍ | 9438/9741 [00:16<00:00, 614.51it/s] 98%|██████████████████████████████████████████████████▋ | 9500/9741 [00:16<00:00, 611.75it/s] 98%|███████████████████████████████████████████████████ | 9562/9741 [00:16<00:00, 610.08it/s] 99%|███████████████████████████████████████████████████▍| 9624/9741 [00:16<00:00, 610.59it/s] 99%|███████████████████████████████████████████████████▋| 9686/9741 [00:16<00:00, 607.66it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:17<00:00, 570.22it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.02s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.01s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.11s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.46s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.15s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.02s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.42s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.50s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.43s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.59s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.83s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.01s/it]
[2023-08-22 00:53:45,924] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 00:53:55,480] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 00:53:55,481] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f48cf944fa0>
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 00:53:55,482] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f48cf812220>
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 00:53:55,483] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 00:53:55,483] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4483320713043213 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o12-tgsm8k-s20-rFalse
Loading extension module utils...
Time to load utils op: 0.3052976131439209 seconds
Loading extension module utils...
Time to load utils op: 0.5044267177581787 seconds
Loading extension module utils...
Time to load utils op: 0.40415215492248535 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:44<36:10, 44.30s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:26<34:36, 43.26s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:09<33:41, 43.00s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:53<33:10, 43.26s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:36<32:22, 43.17s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:56<26:03, 35.53s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:39<27:13, 37.98s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:22<27:36, 39.44s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:52<25:02, 36.64s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:30<24:37, 36.94s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:13<25:07, 38.66s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:56<25:20, 40.01s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:28<23:13, 37.67s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:09<23:16, 38.78s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:52<23:14, 39.85s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:35<23:12, 40.97s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:18<22:53, 41.62s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:01<22:23, 41.99s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:44<21:51, 42.29s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:26<21:06, 42.21s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:09<20:28, 42.36s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:51<19:46, 42.37s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:18<16:57, 37.69s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [16:01<17:02, 39.34s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:44<16:46, 40.24s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:26<16:23, 40.98s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [18:09<15:54, 41.51s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:51<15:16, 41.68s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:33<14:38, 41.81s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [20:16<13:59, 42.00s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:57<13:11, 41.66s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [21:40<12:37, 42.11s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [22:22<11:58, 42.24s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:04<11:13, 42.12s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [23:37<09:49, 39.27s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [24:20<09:24, 40.33s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [25:02<08:54, 41.10s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [25:44<08:15, 41.32s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [26:27<07:37, 41.58s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [27:08<06:56, 41.69s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [27:30<05:21, 35.70s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [28:13<05:02, 37.78s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [28:56<04:36, 39.51s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [29:39<04:02, 40.48s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [30:21<03:24, 40.82s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [30:51<02:30, 37.60s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [31:33<01:57, 39.01s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [32:09<01:16, 38.13s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [32:52<00:39, 39.53s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:34<00:00, 40.28s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:34<00:00, 40.29s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.9251} | avg. gen lenth: 285.152
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o13-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 13
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 01:27:39,740] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o13-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 13
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o13-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 36/9741 [00:00<00:26, 359.52it/s]  1%|▍                                                     | 73/9741 [00:00<00:26, 360.61it/s]  1%|▌                                                    | 110/9741 [00:00<00:26, 361.54it/s]  2%|▊                                                    | 147/9741 [00:00<00:26, 362.29it/s]  2%|█                                                    | 184/9741 [00:00<00:26, 362.01it/s]  2%|█▏                                                   | 221/9741 [00:00<00:26, 361.05it/s]  3%|█▍                                                   | 258/9741 [00:00<00:26, 361.53it/s]  3%|█▌                                                   | 295/9741 [00:00<00:26, 355.99it/s]  3%|█▊                                                   | 331/9741 [00:00<00:26, 357.01it/s]  4%|█▉                                                   | 367/9741 [00:01<00:26, 357.90it/s]  4%|██▏                                                  | 404/9741 [00:01<00:25, 360.03it/s]  5%|██▍                                                  | 441/9741 [00:01<00:25, 358.04it/s]  5%|██▌                                                  | 478/9741 [00:01<00:25, 359.64it/s]  5%|██▊                                                  | 515/9741 [00:01<00:25, 360.06it/s]  6%|███                                                  | 552/9741 [00:01<00:25, 359.69it/s]  6%|███▏                                                 | 588/9741 [00:01<00:25, 359.67it/s]  6%|███▍                                                 | 624/9741 [00:01<00:25, 357.51it/s]  7%|███▌                                                 | 660/9741 [00:01<00:25, 357.47it/s]  7%|███▊                                                 | 697/9741 [00:01<00:25, 359.59it/s]  8%|███▉                                                 | 733/9741 [00:02<00:25, 359.18it/s]  8%|████▏                                                | 770/9741 [00:02<00:24, 360.54it/s]  8%|████▍                                                | 807/9741 [00:02<00:24, 360.61it/s]  9%|████▌                                                | 844/9741 [00:02<00:24, 361.03it/s]  9%|████▊                                                | 881/9741 [00:02<00:24, 360.02it/s] 10%|█████                                                | 928/9741 [00:02<00:22, 391.60it/s] 10%|█████▎                                               | 983/9741 [00:02<00:20, 437.72it/s] 11%|█████▌                                              | 1038/9741 [00:02<00:18, 470.24it/s] 11%|█████▊                                              | 1094/9741 [00:02<00:17, 494.35it/s] 12%|██████▏                                             | 1148/9741 [00:02<00:16, 507.02it/s] 12%|██████▍                                             | 1203/9741 [00:03<00:16, 517.89it/s] 13%|██████▋                                             | 1258/9741 [00:03<00:16, 525.11it/s] 13%|███████                                             | 1313/9741 [00:03<00:15, 530.91it/s] 14%|███████▎                                            | 1367/9741 [00:03<00:15, 532.40it/s] 15%|███████▌                                            | 1422/9741 [00:03<00:15, 536.17it/s] 15%|███████▉                                            | 1477/9741 [00:03<00:15, 539.26it/s] 16%|████████▏                                           | 1532/9741 [00:03<00:15, 540.05it/s] 16%|████████▍                                           | 1587/9741 [00:03<00:15, 539.81it/s] 17%|████████▊                                           | 1642/9741 [00:03<00:14, 542.10it/s] 17%|█████████                                           | 1697/9741 [00:03<00:14, 543.42it/s] 18%|█████████▎                                          | 1752/9741 [00:04<00:14, 543.91it/s] 19%|█████████▋                                          | 1807/9741 [00:04<00:15, 521.71it/s] 19%|█████████▉                                          | 1861/9741 [00:04<00:14, 526.91it/s] 20%|██████████▏                                         | 1915/9741 [00:04<00:14, 527.91it/s] 20%|██████████▌                                         | 1970/9741 [00:04<00:14, 532.76it/s] 21%|██████████▊                                         | 2024/9741 [00:04<00:14, 534.29it/s] 21%|███████████                                         | 2079/9741 [00:04<00:14, 536.04it/s] 22%|███████████▍                                        | 2134/9741 [00:04<00:14, 538.44it/s] 22%|███████████▋                                        | 2189/9741 [00:04<00:13, 540.98it/s] 23%|███████████▉                                        | 2244/9741 [00:04<00:13, 539.56it/s] 24%|████████████▎                                       | 2299/9741 [00:05<00:13, 541.13it/s] 24%|████████████▌                                       | 2354/9741 [00:05<00:13, 542.37it/s] 25%|████████████▊                                       | 2409/9741 [00:05<00:13, 543.88it/s] 25%|█████████████▏                                      | 2464/9741 [00:05<00:13, 545.07it/s] 26%|█████████████▍                                      | 2519/9741 [00:05<00:13, 541.46it/s] 26%|█████████████▋                                      | 2574/9741 [00:05<00:13, 542.05it/s] 27%|██████████████                                      | 2629/9741 [00:05<00:13, 538.02it/s] 28%|██████████████▎                                     | 2684/9741 [00:05<00:13, 539.47it/s] 28%|██████████████▌                                     | 2738/9741 [00:05<00:13, 537.77it/s] 29%|██████████████▉                                     | 2793/9741 [00:06<00:12, 539.55it/s] 29%|███████████████▏                                    | 2848/9741 [00:06<00:12, 539.99it/s] 30%|███████████████▍                                    | 2903/9741 [00:06<00:12, 541.67it/s] 30%|███████████████▊                                    | 2958/9741 [00:06<00:12, 539.94it/s] 31%|████████████████                                    | 3013/9741 [00:06<00:12, 541.76it/s] 31%|████████████████▍                                   | 3068/9741 [00:06<00:12, 541.51it/s] 32%|████████████████▋                                   | 3123/9741 [00:06<00:12, 543.09it/s] 33%|████████████████▉                                   | 3178/9741 [00:06<00:12, 540.44it/s] 33%|█████████████████▎                                  | 3233/9741 [00:06<00:11, 542.37it/s] 34%|█████████████████▌                                  | 3288/9741 [00:06<00:11, 543.20it/s] 34%|█████████████████▊                                  | 3343/9741 [00:07<00:11, 539.59it/s] 35%|██████████████████▏                                 | 3397/9741 [00:07<00:11, 537.30it/s] 35%|██████████████████▍                                 | 3451/9741 [00:07<00:11, 538.05it/s] 36%|██████████████████▋                                 | 3506/9741 [00:07<00:11, 538.93it/s] 37%|███████████████████                                 | 3561/9741 [00:07<00:11, 540.83it/s] 37%|███████████████████▎                                | 3616/9741 [00:07<00:11, 539.56it/s] 38%|███████████████████▌                                | 3671/9741 [00:07<00:11, 540.40it/s] 38%|███████████████████▉                                | 3726/9741 [00:07<00:11, 542.15it/s] 39%|████████████████████▏                               | 3781/9741 [00:07<00:10, 543.59it/s] 39%|████████████████████▍                               | 3836/9741 [00:07<00:10, 541.69it/s] 40%|████████████████████▊                               | 3891/9741 [00:08<00:10, 543.66it/s] 41%|█████████████████████                               | 3946/9741 [00:08<00:10, 543.82it/s] 41%|█████████████████████▎                              | 4001/9741 [00:08<00:10, 544.13it/s] 42%|█████████████████████▋                              | 4056/9741 [00:08<00:10, 541.86it/s] 42%|█████████████████████▉                              | 4111/9741 [00:08<00:10, 539.65it/s] 43%|██████████████████████▏                             | 4166/9741 [00:08<00:10, 541.31it/s] 43%|██████████████████████▌                             | 4221/9741 [00:08<00:10, 541.63it/s] 44%|██████████████████████▊                             | 4276/9741 [00:08<00:10, 542.58it/s] 44%|███████████████████████                             | 4331/9741 [00:08<00:09, 541.61it/s] 45%|███████████████████████▍                            | 4386/9741 [00:08<00:09, 542.18it/s] 46%|███████████████████████▋                            | 4441/9741 [00:09<00:09, 542.42it/s] 46%|████████████████████████                            | 4496/9741 [00:09<00:09, 542.55it/s] 47%|████████████████████████▎                           | 4551/9741 [00:09<00:10, 498.53it/s] 47%|████████████████████████▌                           | 4606/9741 [00:09<00:10, 511.84it/s] 48%|████████████████████████▉                           | 4661/9741 [00:09<00:09, 521.01it/s] 48%|█████████████████████████▏                          | 4716/9741 [00:09<00:09, 528.45it/s] 49%|█████████████████████████▍                          | 4770/9741 [00:09<00:13, 375.46it/s] 50%|█████████████████████████▊                          | 4825/9741 [00:09<00:11, 413.97it/s] 50%|██████████████████████████                          | 4879/9741 [00:10<00:10, 444.62it/s] 51%|██████████████████████████▎                         | 4934/9741 [00:10<00:10, 470.79it/s] 51%|██████████████████████████▋                         | 4988/9741 [00:10<00:09, 489.16it/s] 52%|██████████████████████████▉                         | 5043/9741 [00:10<00:09, 504.89it/s] 52%|███████████████████████████▏                        | 5098/9741 [00:10<00:09, 515.74it/s] 53%|███████████████████████████▌                        | 5153/9741 [00:10<00:08, 524.42it/s] 53%|███████████████████████████▊                        | 5207/9741 [00:10<00:08, 527.83it/s] 54%|████████████████████████████                        | 5262/9741 [00:10<00:08, 532.48it/s] 55%|████████████████████████████▍                       | 5316/9741 [00:10<00:08, 534.33it/s] 55%|████████████████████████████▋                       | 5371/9741 [00:10<00:08, 536.73it/s] 56%|████████████████████████████▉                       | 5425/9741 [00:11<00:08, 535.64it/s] 56%|█████████████████████████████▎                      | 5480/9741 [00:11<00:07, 539.17it/s] 57%|█████████████████████████████▌                      | 5537/9741 [00:11<00:07, 546.73it/s] 57%|█████████████████████████████▊                      | 5594/9741 [00:11<00:07, 551.75it/s] 58%|██████████████████████████████▏                     | 5650/9741 [00:11<00:07, 552.50it/s] 59%|██████████████████████████████▍                     | 5707/9741 [00:11<00:07, 556.02it/s] 59%|██████████████████████████████▊                     | 5764/9741 [00:11<00:07, 558.57it/s] 60%|███████████████████████████████                     | 5821/9741 [00:11<00:07, 559.02it/s] 60%|███████████████████████████████▎                    | 5877/9741 [00:11<00:06, 557.30it/s] 61%|███████████████████████████████▋                    | 5934/9741 [00:11<00:06, 558.40it/s] 61%|███████████████████████████████▉                    | 5990/9741 [00:12<00:06, 536.81it/s] 62%|████████████████████████████████▎                   | 6047/9741 [00:12<00:06, 544.57it/s] 63%|████████████████████████████████▌                   | 6103/9741 [00:12<00:06, 547.87it/s] 63%|████████████████████████████████▉                   | 6159/9741 [00:12<00:06, 549.70it/s] 64%|█████████████████████████████████▏                  | 6216/9741 [00:12<00:06, 553.74it/s] 64%|█████████████████████████████████▍                  | 6272/9741 [00:12<00:06, 554.16it/s] 65%|█████████████████████████████████▊                  | 6328/9741 [00:12<00:06, 553.86it/s] 66%|██████████████████████████████████                  | 6385/9741 [00:12<00:06, 556.57it/s] 66%|██████████████████████████████████▍                 | 6442/9741 [00:12<00:05, 558.37it/s] 67%|██████████████████████████████████▋                 | 6498/9741 [00:12<00:05, 557.98it/s] 67%|██████████████████████████████████▉                 | 6554/9741 [00:13<00:05, 554.15it/s] 68%|███████████████████████████████████▎                | 6610/9741 [00:13<00:05, 555.77it/s] 68%|███████████████████████████████████▌                | 6667/9741 [00:13<00:05, 558.02it/s] 69%|███████████████████████████████████▉                | 6723/9741 [00:13<00:05, 555.74it/s] 70%|████████████████████████████████████▏               | 6779/9741 [00:13<00:05, 555.32it/s] 70%|████████████████████████████████████▍               | 6836/9741 [00:13<00:05, 557.11it/s] 71%|████████████████████████████████████▊               | 6892/9741 [00:13<00:05, 557.84it/s] 71%|█████████████████████████████████████               | 6949/9741 [00:13<00:04, 559.53it/s] 72%|█████████████████████████████████████▍              | 7005/9741 [00:13<00:04, 557.31it/s] 72%|█████████████████████████████████████▋              | 7062/9741 [00:13<00:04, 558.74it/s] 73%|█████████████████████████████████████▉              | 7118/9741 [00:14<00:04, 558.81it/s] 74%|██████████████████████████████████████▎             | 7174/9741 [00:14<00:04, 559.05it/s] 74%|██████████████████████████████████████▌             | 7230/9741 [00:14<00:04, 555.82it/s] 75%|██████████████████████████████████████▉             | 7286/9741 [00:14<00:04, 556.72it/s] 75%|███████████████████████████████████████▏            | 7342/9741 [00:14<00:04, 557.55it/s] 76%|███████████████████████████████████████▍            | 7399/9741 [00:14<00:04, 559.24it/s] 77%|███████████████████████████████████████▊            | 7455/9741 [00:14<00:04, 527.68it/s] 77%|████████████████████████████████████████            | 7511/9741 [00:14<00:04, 536.29it/s] 78%|████████████████████████████████████████▍           | 7568/9741 [00:14<00:03, 543.40it/s] 78%|████████████████████████████████████████▋           | 7624/9741 [00:15<00:03, 548.03it/s] 79%|████████████████████████████████████████▉           | 7679/9741 [00:15<00:03, 547.02it/s] 79%|█████████████████████████████████████████▎          | 7736/9741 [00:15<00:03, 551.45it/s] 80%|█████████████████████████████████████████▌          | 7793/9741 [00:15<00:03, 554.20it/s] 81%|█████████████████████████████████████████▉          | 7849/9741 [00:15<00:03, 555.66it/s] 81%|██████████████████████████████████████████▏         | 7905/9741 [00:15<00:03, 554.32it/s] 82%|██████████████████████████████████████████▍         | 7961/9741 [00:15<00:03, 555.68it/s] 82%|██████████████████████████████████████████▊         | 8017/9741 [00:15<00:03, 556.84it/s] 83%|███████████████████████████████████████████         | 8073/9741 [00:15<00:02, 557.09it/s] 83%|███████████████████████████████████████████▍        | 8129/9741 [00:15<00:02, 556.34it/s] 84%|███████████████████████████████████████████▋        | 8186/9741 [00:16<00:02, 557.61it/s] 85%|███████████████████████████████████████████▉        | 8242/9741 [00:16<00:02, 558.18it/s] 85%|████████████████████████████████████████████▎       | 8298/9741 [00:16<00:02, 556.85it/s] 86%|████████████████████████████████████████████▌       | 8354/9741 [00:16<00:02, 554.30it/s] 86%|████████████████████████████████████████████▉       | 8410/9741 [00:16<00:02, 555.97it/s] 87%|█████████████████████████████████████████████▏      | 8467/9741 [00:16<00:02, 557.72it/s] 87%|█████████████████████████████████████████████▍      | 8523/9741 [00:16<00:02, 557.78it/s] 88%|█████████████████████████████████████████████▊      | 8579/9741 [00:16<00:02, 554.52it/s] 89%|██████████████████████████████████████████████      | 8635/9741 [00:16<00:01, 553.49it/s] 89%|██████████████████████████████████████████████▍     | 8691/9741 [00:16<00:01, 554.42it/s] 90%|██████████████████████████████████████████████▋     | 8747/9741 [00:17<00:01, 555.51it/s] 90%|██████████████████████████████████████████████▉     | 8803/9741 [00:17<00:01, 552.77it/s] 91%|███████████████████████████████████████████████▎    | 8859/9741 [00:17<00:01, 554.14it/s] 92%|███████████████████████████████████████████████▌    | 8915/9741 [00:17<00:01, 555.46it/s] 92%|███████████████████████████████████████████████▉    | 8971/9741 [00:17<00:01, 556.08it/s] 93%|████████████████████████████████████████████████▏   | 9027/9741 [00:17<00:01, 556.15it/s] 93%|████████████████████████████████████████████████▍   | 9083/9741 [00:17<00:01, 553.15it/s] 94%|████████████████████████████████████████████████▊   | 9139/9741 [00:17<00:01, 554.86it/s] 94%|█████████████████████████████████████████████████   | 9195/9741 [00:17<00:00, 555.39it/s] 95%|█████████████████████████████████████████████████▍  | 9251/9741 [00:17<00:00, 555.79it/s] 96%|█████████████████████████████████████████████████▋  | 9307/9741 [00:18<00:00, 554.05it/s] 96%|█████████████████████████████████████████████████▉  | 9364/9741 [00:18<00:00, 555.92it/s] 97%|██████████████████████████████████████████████████▎ | 9420/9741 [00:18<00:00, 556.37it/s] 97%|██████████████████████████████████████████████████▌ | 9476/9741 [00:18<00:00, 556.43it/s] 98%|██████████████████████████████████████████████████▉ | 9532/9741 [00:18<00:00, 549.80it/s] 98%|███████████████████████████████████████████████████▏| 9588/9741 [00:18<00:00, 550.32it/s] 99%|███████████████████████████████████████████████████▍| 9644/9741 [00:18<00:00, 552.23it/s]100%|███████████████████████████████████████████████████▊| 9700/9741 [00:18<00:00, 553.20it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:18<00:00, 517.48it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.15s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.06s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.06s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.24s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.09s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.09s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.20s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.17s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.49s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.62s/it]
[2023-08-22 01:28:49,775] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.55s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.58s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]
[2023-08-22 01:28:58,974] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 01:28:58,974] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f3df2d38fd0>
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 01:28:58,975] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f3df2a4e220>
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 01:28:58,976] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 01:28:58,977] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4620170593261719 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o13-tgsm8k-s20-rFalse
Loading extension module utils...
Time to load utils op: 0.5045535564422607 seconds
Loading extension module utils...
Time to load utils op: 0.404510498046875 seconds
Loading extension module utils...
Time to load utils op: 0.40453028678894043 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:42<34:59, 42.84s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:24<33:32, 41.93s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:06<32:55, 42.03s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:27<25:47, 33.65s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:08<27:26, 36.58s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:50<28:07, 38.35s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:31<28:04, 39.17s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:13<27:57, 39.94s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:55<27:44, 40.59s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:36<27:18, 40.97s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:18<26:39, 41.00s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:55<25:14, 39.85s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:37<25:04, 40.67s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:19<24:33, 40.93s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:01<24:00, 41.17s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:42<23:20, 41.19s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:24<22:50, 41.54s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:06<22:10, 41.59s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:20<17:11, 33.28s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:02<17:57, 35.90s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:44<18:15, 37.76s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:26<18:10, 38.95s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:03<17:18, 38.47s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:45<17:05, 39.46s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:27<16:48, 40.35s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:09<16:19, 40.82s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:51<15:43, 41.03s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:16<13:17, 36.26s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:57<13:14, 37.84s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:39<12:57, 38.89s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:20<12:36, 39.80s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [21:02<12:05, 40.31s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:43<11:29, 40.58s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [22:17<10:16, 38.54s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:58<09:51, 39.42s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [23:40<09:20, 40.01s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [24:21<08:46, 40.49s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [25:03<08:10, 40.89s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [25:45<07:31, 41.09s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [26:26<06:51, 41.16s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [27:08<06:13, 41.45s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [27:50<05:31, 41.44s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [28:31<04:50, 41.47s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [29:14<04:10, 41.80s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [29:56<03:29, 41.85s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [30:37<02:46, 41.68s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [31:19<02:05, 41.67s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [32:01<01:23, 41.78s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [32:15<00:33, 33.48s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [32:56<00:00, 35.80s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [32:56<00:00, 39.53s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.9127} | avg. gen lenth: 300.38
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o14-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 14
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 02:02:53,343] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o14-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 14
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o14-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 33/9741 [00:00<00:29, 326.02it/s]  1%|▎                                                     | 66/9741 [00:00<00:29, 327.47it/s]  1%|▌                                                     | 99/9741 [00:00<00:29, 328.50it/s]  1%|▋                                                    | 132/9741 [00:00<00:29, 328.91it/s]  2%|▉                                                    | 165/9741 [00:00<00:29, 329.02it/s]  2%|█                                                    | 198/9741 [00:00<00:29, 328.66it/s]  2%|█▎                                                   | 231/9741 [00:00<00:29, 326.92it/s]  3%|█▍                                                   | 264/9741 [00:00<00:29, 321.73it/s]  3%|█▌                                                   | 297/9741 [00:00<00:29, 323.60it/s]  3%|█▊                                                   | 331/9741 [00:01<00:28, 325.53it/s]  4%|█▉                                                   | 364/9741 [00:01<00:28, 326.56it/s]  4%|██▏                                                  | 398/9741 [00:01<00:28, 327.85it/s]  4%|██▎                                                  | 431/9741 [00:01<00:28, 325.86it/s]  5%|██▌                                                  | 465/9741 [00:01<00:28, 327.35it/s]  5%|██▋                                                  | 499/9741 [00:01<00:28, 328.26it/s]  5%|██▉                                                  | 532/9741 [00:01<00:28, 328.64it/s]  6%|███                                                  | 565/9741 [00:01<00:27, 328.71it/s]  6%|███▎                                                 | 598/9741 [00:01<00:28, 326.27it/s]  6%|███▍                                                 | 631/9741 [00:01<00:27, 326.59it/s]  7%|███▌                                                 | 664/9741 [00:02<00:27, 325.85it/s]  7%|███▊                                                 | 698/9741 [00:02<00:27, 327.29it/s]  8%|███▉                                                 | 731/9741 [00:02<00:27, 327.61it/s]  8%|████▏                                                | 765/9741 [00:02<00:27, 328.42it/s]  8%|████▎                                                | 799/9741 [00:02<00:27, 328.91it/s]  9%|████▌                                                | 849/9741 [00:02<00:23, 378.65it/s]  9%|████▉                                                | 899/9741 [00:02<00:21, 413.01it/s] 10%|█████▏                                               | 950/9741 [00:02<00:20, 439.20it/s] 10%|█████▎                                              | 1001/9741 [00:02<00:19, 457.51it/s] 11%|█████▌                                              | 1052/9741 [00:02<00:18, 470.38it/s] 11%|█████▉                                              | 1103/9741 [00:03<00:18, 479.50it/s] 12%|██████▏                                             | 1153/9741 [00:03<00:17, 483.27it/s] 12%|██████▍                                             | 1203/9741 [00:03<00:17, 487.86it/s] 13%|██████▋                                             | 1253/9741 [00:03<00:17, 490.77it/s] 13%|██████▉                                             | 1303/9741 [00:03<00:17, 493.20it/s] 14%|███████▏                                            | 1353/9741 [00:03<00:17, 492.78it/s] 14%|███████▍                                            | 1403/9741 [00:03<00:16, 494.52it/s] 15%|███████▊                                            | 1453/9741 [00:03<00:16, 495.99it/s] 15%|████████                                            | 1503/9741 [00:03<00:16, 496.40it/s] 16%|████████▎                                           | 1553/9741 [00:03<00:16, 497.00it/s] 16%|████████▌                                           | 1603/9741 [00:04<00:16, 495.00it/s] 17%|████████▊                                           | 1653/9741 [00:04<00:16, 495.34it/s] 17%|█████████                                           | 1703/9741 [00:04<00:16, 496.66it/s] 18%|█████████▎                                          | 1754/9741 [00:04<00:16, 497.72it/s] 19%|█████████▋                                          | 1804/9741 [00:04<00:16, 475.55it/s] 19%|█████████▉                                          | 1854/9741 [00:04<00:16, 481.92it/s] 20%|██████████▏                                         | 1904/9741 [00:04<00:16, 486.98it/s] 20%|██████████▍                                         | 1954/9741 [00:04<00:15, 490.32it/s] 21%|██████████▋                                         | 2005/9741 [00:04<00:15, 493.21it/s] 21%|██████████▉                                         | 2055/9741 [00:04<00:15, 492.22it/s] 22%|███████████▏                                        | 2105/9741 [00:05<00:15, 493.54it/s] 22%|███████████▌                                        | 2155/9741 [00:05<00:15, 495.25it/s] 23%|███████████▊                                        | 2205/9741 [00:05<00:15, 495.89it/s] 23%|████████████                                        | 2255/9741 [00:05<00:15, 494.49it/s] 24%|████████████▎                                       | 2305/9741 [00:05<00:15, 495.58it/s] 24%|████████████▌                                       | 2355/9741 [00:05<00:14, 496.22it/s] 25%|████████████▊                                       | 2405/9741 [00:05<00:14, 494.76it/s] 25%|█████████████                                       | 2455/9741 [00:05<00:14, 495.76it/s] 26%|█████████████▎                                      | 2505/9741 [00:05<00:14, 493.87it/s] 26%|█████████████▋                                      | 2555/9741 [00:05<00:14, 494.52it/s] 27%|█████████████▉                                      | 2606/9741 [00:06<00:14, 496.24it/s] 27%|██████████████▏                                     | 2656/9741 [00:06<00:14, 495.26it/s] 28%|██████████████▍                                     | 2706/9741 [00:06<00:14, 493.93it/s] 28%|██████████████▋                                     | 2756/9741 [00:06<00:14, 495.09it/s] 29%|██████████████▉                                     | 2806/9741 [00:06<00:13, 495.65it/s] 29%|███████████████▏                                    | 2856/9741 [00:06<00:14, 475.55it/s] 30%|███████████████▌                                    | 2906/9741 [00:06<00:14, 482.33it/s] 30%|███████████████▊                                    | 2956/9741 [00:06<00:13, 485.04it/s] 31%|████████████████                                    | 3006/9741 [00:06<00:13, 489.34it/s] 31%|████████████████▎                                   | 3056/9741 [00:07<00:13, 487.88it/s] 32%|████████████████▌                                   | 3106/9741 [00:07<00:13, 490.78it/s] 32%|████████████████▊                                   | 3156/9741 [00:07<00:13, 490.66it/s] 33%|█████████████████                                   | 3206/9741 [00:07<00:13, 493.36it/s] 33%|█████████████████▍                                  | 3257/9741 [00:07<00:13, 495.42it/s] 34%|█████████████████▋                                  | 3307/9741 [00:07<00:12, 496.30it/s] 34%|█████████████████▉                                  | 3357/9741 [00:07<00:12, 496.26it/s] 35%|██████████████████▏                                 | 3407/9741 [00:07<00:12, 494.11it/s] 35%|██████████████████▍                                 | 3457/9741 [00:07<00:12, 494.80it/s] 36%|██████████████████▋                                 | 3507/9741 [00:07<00:12, 492.86it/s] 37%|██████████████████▉                                 | 3557/9741 [00:08<00:12, 494.06it/s] 37%|███████████████████▎                                | 3607/9741 [00:08<00:12, 489.59it/s] 38%|███████████████████▌                                | 3657/9741 [00:08<00:12, 490.83it/s] 38%|███████████████████▊                                | 3707/9741 [00:08<00:12, 488.75it/s] 39%|████████████████████                                | 3756/9741 [00:08<00:12, 488.35it/s] 39%|████████████████████▎                               | 3806/9741 [00:08<00:12, 490.56it/s] 40%|████████████████████▌                               | 3856/9741 [00:08<00:12, 490.28it/s] 40%|████████████████████▊                               | 3906/9741 [00:08<00:11, 492.34it/s] 41%|█████████████████████                               | 3956/9741 [00:08<00:11, 493.64it/s] 41%|█████████████████████▍                              | 4006/9741 [00:08<00:11, 495.11it/s] 42%|█████████████████████▋                              | 4056/9741 [00:09<00:11, 495.72it/s] 42%|█████████████████████▉                              | 4106/9741 [00:09<00:11, 493.52it/s] 43%|██████████████████████▏                             | 4156/9741 [00:09<00:11, 493.81it/s] 43%|██████████████████████▍                             | 4206/9741 [00:09<00:11, 491.81it/s] 44%|██████████████████████▋                             | 4256/9741 [00:09<00:11, 486.76it/s] 44%|██████████████████████▉                             | 4305/9741 [00:09<00:11, 482.12it/s] 45%|███████████████████████▏                            | 4354/9741 [00:09<00:11, 482.16it/s] 45%|███████████████████████▌                            | 4403/9741 [00:09<00:11, 483.79it/s] 46%|███████████████████████▊                            | 4453/9741 [00:09<00:10, 487.64it/s] 46%|████████████████████████                            | 4502/9741 [00:09<00:10, 487.17it/s] 47%|████████████████████████▎                           | 4551/9741 [00:10<00:11, 433.88it/s] 47%|████████████████████████▌                           | 4599/9741 [00:10<00:11, 445.78it/s] 48%|████████████████████████▊                           | 4649/9741 [00:10<00:11, 460.24it/s] 48%|█████████████████████████                           | 4699/9741 [00:10<00:10, 470.99it/s] 49%|█████████████████████████▎                          | 4747/9741 [00:10<00:14, 339.73it/s] 49%|█████████████████████████▌                          | 4797/9741 [00:10<00:13, 375.74it/s] 50%|█████████████████████████▊                          | 4847/9741 [00:10<00:12, 405.82it/s] 50%|██████████████████████████▏                         | 4896/9741 [00:10<00:11, 427.30it/s] 51%|██████████████████████████▍                         | 4946/9741 [00:11<00:10, 444.37it/s] 51%|██████████████████████████▋                         | 4993/9741 [00:11<00:10, 435.43it/s] 52%|██████████████████████████▉                         | 5043/9741 [00:11<00:10, 452.07it/s] 52%|███████████████████████████▏                        | 5093/9741 [00:11<00:10, 464.33it/s] 53%|███████████████████████████▍                        | 5143/9741 [00:11<00:09, 473.94it/s] 53%|███████████████████████████▋                        | 5192/9741 [00:11<00:09, 477.85it/s] 54%|███████████████████████████▉                        | 5241/9741 [00:11<00:09, 465.63it/s] 54%|████████████████████████████▏                       | 5291/9741 [00:11<00:09, 474.68it/s] 55%|████████████████████████████▌                       | 5341/9741 [00:11<00:09, 481.46it/s] 55%|████████████████████████████▊                       | 5390/9741 [00:11<00:09, 479.70it/s] 56%|█████████████████████████████                       | 5440/9741 [00:12<00:08, 482.92it/s] 56%|█████████████████████████████▎                      | 5491/9741 [00:12<00:08, 488.60it/s] 57%|█████████████████████████████▌                      | 5541/9741 [00:12<00:08, 491.80it/s] 57%|█████████████████████████████▊                      | 5593/9741 [00:12<00:08, 497.86it/s] 58%|██████████████████████████████▏                     | 5644/9741 [00:12<00:08, 500.43it/s] 58%|██████████████████████████████▍                     | 5696/9741 [00:12<00:08, 504.54it/s] 59%|██████████████████████████████▋                     | 5748/9741 [00:12<00:07, 507.46it/s] 60%|██████████████████████████████▉                     | 5800/9741 [00:12<00:07, 509.04it/s] 60%|███████████████████████████████▏                    | 5852/9741 [00:12<00:07, 509.82it/s] 61%|███████████████████████████████▌                    | 5903/9741 [00:12<00:07, 508.85it/s] 61%|███████████████████████████████▊                    | 5955/9741 [00:13<00:07, 510.52it/s] 62%|████████████████████████████████                    | 6007/9741 [00:13<00:07, 482.07it/s] 62%|████████████████████████████████▎                   | 6056/9741 [00:13<00:07, 478.67it/s] 63%|████████████████████████████████▌                   | 6107/9741 [00:13<00:07, 486.95it/s] 63%|████████████████████████████████▉                   | 6159/9741 [00:13<00:07, 494.46it/s] 64%|█████████████████████████████████▏                  | 6209/9741 [00:13<00:07, 461.73it/s] 64%|█████████████████████████████████▍                  | 6256/9741 [00:13<00:07, 461.64it/s] 65%|█████████████████████████████████▋                  | 6307/9741 [00:13<00:07, 473.92it/s] 65%|█████████████████████████████████▉                  | 6358/9741 [00:13<00:07, 482.96it/s] 66%|██████████████████████████████████▏                 | 6410/9741 [00:14<00:06, 491.99it/s] 66%|██████████████████████████████████▍                 | 6462/9741 [00:14<00:06, 497.86it/s] 67%|██████████████████████████████████▊                 | 6514/9741 [00:14<00:06, 501.85it/s] 67%|███████████████████████████████████                 | 6565/9741 [00:14<00:06, 502.59it/s] 68%|███████████████████████████████████▎                | 6617/9741 [00:14<00:06, 504.94it/s] 68%|███████████████████████████████████▌                | 6669/9741 [00:14<00:06, 507.18it/s] 69%|███████████████████████████████████▉                | 6721/9741 [00:14<00:05, 508.51it/s] 70%|████████████████████████████████████▏               | 6772/9741 [00:14<00:05, 507.60it/s] 70%|████████████████████████████████████▍               | 6824/9741 [00:14<00:05, 509.19it/s] 71%|████████████████████████████████████▋               | 6876/9741 [00:14<00:05, 510.17it/s] 71%|████████████████████████████████████▉               | 6928/9741 [00:15<00:05, 510.89it/s] 72%|█████████████████████████████████████▎              | 6980/9741 [00:15<00:05, 511.03it/s] 72%|█████████████████████████████████████▌              | 7032/9741 [00:15<00:05, 509.13it/s] 73%|█████████████████████████████████████▊              | 7084/9741 [00:15<00:05, 509.88it/s] 73%|██████████████████████████████████████              | 7136/9741 [00:15<00:05, 510.20it/s] 74%|██████████████████████████████████████▎             | 7188/9741 [00:15<00:04, 510.65it/s] 74%|██████████████████████████████████████▋             | 7240/9741 [00:15<00:04, 507.69it/s] 75%|██████████████████████████████████████▉             | 7292/9741 [00:15<00:04, 508.83it/s] 75%|███████████████████████████████████████▏            | 7344/9741 [00:15<00:04, 509.29it/s] 76%|███████████████████████████████████████▍            | 7396/9741 [00:15<00:04, 509.87it/s] 76%|███████████████████████████████████████▊            | 7447/9741 [00:16<00:04, 481.06it/s] 77%|████████████████████████████████████████            | 7498/9741 [00:16<00:04, 489.10it/s] 78%|████████████████████████████████████████▎           | 7550/9741 [00:16<00:04, 495.28it/s] 78%|████████████████████████████████████████▌           | 7601/9741 [00:16<00:04, 497.29it/s] 79%|████████████████████████████████████████▊           | 7653/9741 [00:16<00:04, 501.55it/s] 79%|█████████████████████████████████████████▏          | 7704/9741 [00:16<00:04, 502.37it/s] 80%|█████████████████████████████████████████▍          | 7756/9741 [00:16<00:03, 505.45it/s] 80%|█████████████████████████████████████████▋          | 7808/9741 [00:16<00:03, 507.03it/s] 81%|█████████████████████████████████████████▉          | 7860/9741 [00:16<00:03, 508.50it/s] 81%|██████████████████████████████████████████▏         | 7911/9741 [00:17<00:03, 507.73it/s] 82%|██████████████████████████████████████████▌         | 7963/9741 [00:17<00:03, 509.00it/s] 82%|██████████████████████████████████████████▊         | 8015/9741 [00:17<00:03, 509.72it/s] 83%|███████████████████████████████████████████         | 8066/9741 [00:17<00:03, 509.32it/s] 83%|███████████████████████████████████████████▎        | 8118/9741 [00:17<00:03, 510.62it/s] 84%|███████████████████████████████████████████▌        | 8170/9741 [00:17<00:03, 509.11it/s] 84%|███████████████████████████████████████████▉        | 8222/9741 [00:17<00:02, 510.07it/s] 85%|████████████████████████████████████████████▏       | 8274/9741 [00:17<00:02, 510.56it/s] 85%|████████████████████████████████████████████▍       | 8326/9741 [00:17<00:02, 510.58it/s] 86%|████████████████████████████████████████████▋       | 8378/9741 [00:17<00:02, 508.99it/s] 87%|█████████████████████████████████████████████       | 8430/9741 [00:18<00:02, 509.93it/s] 87%|█████████████████████████████████████████████▎      | 8482/9741 [00:18<00:02, 510.52it/s] 88%|█████████████████████████████████████████████▌      | 8534/9741 [00:18<00:02, 510.37it/s] 88%|█████████████████████████████████████████████▊      | 8586/9741 [00:18<00:02, 508.60it/s] 89%|██████████████████████████████████████████████      | 8637/9741 [00:18<00:02, 508.91it/s] 89%|██████████████████████████████████████████████▍     | 8689/9741 [00:18<00:02, 509.41it/s] 90%|██████████████████████████████████████████████▋     | 8741/9741 [00:18<00:01, 510.15it/s] 90%|██████████████████████████████████████████████▉     | 8793/9741 [00:18<00:01, 510.23it/s] 91%|███████████████████████████████████████████████▏    | 8845/9741 [00:18<00:01, 508.18it/s] 91%|███████████████████████████████████████████████▍    | 8897/9741 [00:18<00:01, 509.06it/s] 92%|███████████████████████████████████████████████▊    | 8948/9741 [00:19<00:01, 507.26it/s] 92%|████████████████████████████████████████████████    | 8999/9741 [00:19<00:01, 508.05it/s] 93%|████████████████████████████████████████████████▎   | 9050/9741 [00:19<00:01, 506.54it/s] 93%|████████████████████████████████████████████████▌   | 9102/9741 [00:19<00:01, 507.99it/s] 94%|████████████████████████████████████████████████▊   | 9154/9741 [00:19<00:01, 509.15it/s] 95%|█████████████████████████████████████████████████▏  | 9206/9741 [00:19<00:01, 509.73it/s] 95%|█████████████████████████████████████████████████▍  | 9258/9741 [00:19<00:00, 508.24it/s] 96%|█████████████████████████████████████████████████▋  | 9310/9741 [00:19<00:00, 509.34it/s] 96%|█████████████████████████████████████████████████▉  | 9362/9741 [00:19<00:00, 509.84it/s] 97%|██████████████████████████████████████████████████▎ | 9414/9741 [00:19<00:00, 510.29it/s] 97%|██████████████████████████████████████████████████▌ | 9466/9741 [00:20<00:00, 510.54it/s] 98%|██████████████████████████████████████████████████▊ | 9518/9741 [00:20<00:00, 508.85it/s] 98%|███████████████████████████████████████████████████ | 9570/9741 [00:20<00:00, 509.45it/s] 99%|███████████████████████████████████████████████████▎| 9621/9741 [00:20<00:00, 509.37it/s] 99%|███████████████████████████████████████████████████▋| 9672/9741 [00:20<00:00, 509.30it/s]100%|███████████████████████████████████████████████████▉| 9723/9741 [00:20<00:00, 507.58it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:20<00:00, 472.66it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.30s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.28s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.18s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.21s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.20s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.40s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.58s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.57s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.73s/it]
[2023-08-22 02:04:05,735] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.60s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.59s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]
[2023-08-22 02:04:13,261] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 02:04:13,262] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 02:04:13,262] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 02:04:13,262] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 02:04:13,262] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 02:04:13,262] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 02:04:13,262] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 02:04:13,262] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 02:04:13,262] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 02:04:13,262] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 02:04:13,262] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 02:04:13,262] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f2d6698bfd0>
[2023-08-22 02:04:13,262] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f2d6629e220>
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 02:04:13,263] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 02:04:13,264] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 02:04:13,264] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 02:04:13,264] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 02:04:13,264] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4608011245727539 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input: Sam, Sid, and Steve brought popsicle sticks for their group activity in their Art class. Sam has thrice as many as Sid, and Sid has twice as many as Steve. If Steve has 12 popsicle sticks, how many popsicle sticks can they use for their Art class activity?
Output: 108

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o14-tgsm8k-s20-rFalse
Loading extension module utils...
Time to load utils op: 0.5048856735229492 seconds
Loading extension module utils...
Time to load utils op: 0.5048894882202148 seconds
Loading extension module utils...
Time to load utils op: 0.5038692951202393 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:41<34:16, 41.97s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:22<33:00, 41.26s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:03<32:14, 41.17s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:21<24:27, 31.90s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:03<26:36, 35.48s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:43<27:16, 37.20s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:08<23:40, 33.04s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [04:49<24:57, 35.66s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:31<25:39, 37.54s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:11<25:37, 38.44s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [06:53<25:33, 39.33s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:34<25:14, 39.85s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:14<24:41, 40.05s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [08:55<24:11, 40.33s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:36<23:36, 40.48s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:16<22:57, 40.51s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:57<22:16, 40.49s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:38<21:43, 40.73s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:20<21:08, 40.92s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:01<20:29, 40.98s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:41<19:46, 40.90s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:22<19:04, 40.86s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:03<18:26, 40.99s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:45<17:46, 41.03s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:26<17:05, 41.04s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:06<16:23, 40.97s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:47<15:39, 40.86s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:28<14:58, 40.85s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:09<14:20, 40.97s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:51<13:42, 41.15s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:32<13:02, 41.18s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [21:07<11:49, 39.42s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:49<11:19, 39.99s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [22:29<10:43, 40.24s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [23:10<10:06, 40.46s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [23:52<09:29, 40.66s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [24:32<08:48, 40.64s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [25:13<08:08, 40.72s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [25:45<07:00, 38.19s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [26:26<06:29, 38.99s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [27:07<05:56, 39.57s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [27:48<05:20, 40.09s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [28:30<04:43, 40.52s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [29:11<04:04, 40.72s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [29:52<03:24, 40.88s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [30:34<02:44, 41.04s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [31:15<02:03, 41.17s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [31:56<01:22, 41.11s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [32:38<00:41, 41.20s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:19<00:00, 41.11s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:19<00:00, 39.98s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.173} | avg. gen lenth: 295.144
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o15-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 15
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 02:38:37,004] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o15-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 15
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o15-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 31/9741 [00:00<00:31, 309.42it/s]  1%|▎                                                     | 63/9741 [00:00<00:31, 311.14it/s]  1%|▌                                                     | 95/9741 [00:00<00:31, 311.10it/s]  1%|▋                                                    | 127/9741 [00:00<00:30, 311.84it/s]  2%|▊                                                    | 159/9741 [00:00<00:30, 312.49it/s]  2%|█                                                    | 191/9741 [00:00<00:30, 312.10it/s]  2%|█▏                                                   | 223/9741 [00:00<00:31, 306.35it/s]  3%|█▍                                                   | 255/9741 [00:00<00:30, 307.80it/s]  3%|█▌                                                   | 287/9741 [00:00<00:30, 308.93it/s]  3%|█▋                                                   | 318/9741 [00:01<00:30, 308.42it/s]  4%|█▉                                                   | 350/9741 [00:01<00:30, 309.37it/s]  4%|██                                                   | 382/9741 [00:01<00:30, 310.44it/s]  4%|██▎                                                  | 414/9741 [00:01<00:30, 310.79it/s]  5%|██▍                                                  | 446/9741 [00:01<00:30, 308.83it/s]  5%|██▌                                                  | 478/9741 [00:01<00:29, 309.32it/s]  5%|██▊                                                  | 510/9741 [00:01<00:29, 309.59it/s]  6%|██▉                                                  | 541/9741 [00:01<00:30, 306.16it/s]  6%|███                                                  | 572/9741 [00:01<00:29, 306.03it/s]  6%|███▎                                                 | 603/9741 [00:01<00:29, 307.06it/s]  7%|███▍                                                 | 634/9741 [00:02<00:29, 307.50it/s]  7%|███▌                                                 | 665/9741 [00:02<00:29, 306.84it/s]  7%|███▊                                                 | 696/9741 [00:02<00:29, 307.57it/s]  7%|███▉                                                 | 727/9741 [00:02<00:29, 307.43it/s]  8%|████                                                 | 758/9741 [00:02<00:29, 308.01it/s]  8%|████▎                                                | 789/9741 [00:02<00:29, 308.49it/s]  8%|████▍                                                | 820/9741 [00:02<00:28, 308.64it/s]  9%|████▋                                                | 851/9741 [00:02<00:28, 307.78it/s]  9%|████▊                                                | 882/9741 [00:02<00:28, 305.72it/s]  9%|████▉                                                | 913/9741 [00:02<00:28, 306.12it/s] 10%|█████▏                                               | 958/9741 [00:03<00:25, 347.41it/s] 10%|█████▎                                              | 1005/9741 [00:03<00:22, 382.69it/s] 11%|█████▌                                              | 1052/9741 [00:03<00:21, 407.75it/s] 11%|█████▊                                              | 1099/9741 [00:03<00:20, 425.39it/s] 12%|██████                                              | 1145/9741 [00:03<00:19, 434.73it/s] 12%|██████▎                                             | 1192/9741 [00:03<00:19, 443.36it/s] 13%|██████▌                                             | 1239/9741 [00:03<00:18, 449.63it/s] 13%|██████▊                                             | 1286/9741 [00:03<00:18, 454.68it/s] 14%|███████                                             | 1333/9741 [00:03<00:18, 457.02it/s] 14%|███████▎                                            | 1379/9741 [00:03<00:18, 456.89it/s] 15%|███████▌                                            | 1426/9741 [00:04<00:18, 458.82it/s] 15%|███████▊                                            | 1473/9741 [00:04<00:17, 459.34it/s] 16%|████████                                            | 1520/9741 [00:04<00:17, 459.97it/s] 16%|████████▎                                           | 1566/9741 [00:04<00:17, 457.02it/s] 17%|████████▌                                           | 1613/9741 [00:04<00:17, 458.55it/s] 17%|████████▊                                           | 1660/9741 [00:04<00:17, 460.75it/s] 18%|█████████                                           | 1707/9741 [00:04<00:17, 459.00it/s] 18%|█████████▎                                          | 1754/9741 [00:04<00:17, 460.44it/s] 18%|█████████▌                                          | 1801/9741 [00:04<00:18, 438.76it/s] 19%|█████████▊                                          | 1848/9741 [00:05<00:17, 445.86it/s] 19%|██████████                                          | 1895/9741 [00:05<00:17, 450.87it/s] 20%|██████████▎                                         | 1942/9741 [00:05<00:17, 454.26it/s] 20%|██████████▌                                         | 1989/9741 [00:05<00:16, 456.79it/s] 21%|██████████▊                                         | 2035/9741 [00:05<00:16, 453.99it/s] 21%|███████████                                         | 2081/9741 [00:05<00:16, 454.16it/s] 22%|███████████▎                                        | 2127/9741 [00:05<00:16, 452.00it/s] 22%|███████████▌                                        | 2174/9741 [00:05<00:16, 454.55it/s] 23%|███████████▊                                        | 2220/9741 [00:05<00:16, 455.92it/s] 23%|████████████                                        | 2266/9741 [00:05<00:16, 454.09it/s] 24%|████████████▎                                       | 2312/9741 [00:06<00:16, 455.68it/s] 24%|████████████▌                                       | 2358/9741 [00:06<00:16, 456.59it/s] 25%|████████████▊                                       | 2405/9741 [00:06<00:16, 458.17it/s] 25%|█████████████                                       | 2451/9741 [00:06<00:15, 458.52it/s] 26%|█████████████▎                                      | 2497/9741 [00:06<00:15, 455.39it/s] 26%|█████████████▌                                      | 2543/9741 [00:06<00:15, 455.83it/s] 27%|█████████████▊                                      | 2590/9741 [00:06<00:15, 457.23it/s] 27%|██████████████                                      | 2636/9741 [00:06<00:15, 457.82it/s] 28%|██████████████▎                                     | 2682/9741 [00:06<00:15, 456.15it/s] 28%|██████████████▌                                     | 2728/9741 [00:06<00:15, 450.12it/s] 28%|██████████████▊                                     | 2774/9741 [00:07<00:15, 452.33it/s] 29%|███████████████                                     | 2820/9741 [00:07<00:15, 454.08it/s] 29%|███████████████▎                                    | 2866/9741 [00:07<00:15, 455.81it/s] 30%|███████████████▌                                    | 2912/9741 [00:07<00:14, 456.69it/s] 30%|███████████████▊                                    | 2958/9741 [00:07<00:14, 454.85it/s] 31%|████████████████                                    | 3004/9741 [00:07<00:14, 455.03it/s] 31%|████████████████▎                                   | 3050/9741 [00:07<00:14, 454.96it/s] 32%|████████████████▌                                   | 3096/9741 [00:07<00:14, 455.54it/s] 32%|████████████████▊                                   | 3142/9741 [00:07<00:14, 456.27it/s] 33%|█████████████████                                   | 3188/9741 [00:07<00:14, 452.81it/s] 33%|█████████████████▎                                  | 3234/9741 [00:08<00:14, 453.48it/s] 34%|█████████████████▌                                  | 3280/9741 [00:08<00:14, 454.63it/s] 34%|█████████████████▊                                  | 3326/9741 [00:08<00:14, 454.47it/s] 35%|██████████████████                                  | 3372/9741 [00:08<00:13, 455.01it/s] 35%|██████████████████▏                                 | 3418/9741 [00:08<00:13, 453.38it/s] 36%|██████████████████▍                                 | 3464/9741 [00:08<00:13, 453.53it/s] 36%|██████████████████▋                                 | 3510/9741 [00:08<00:13, 454.16it/s] 37%|██████████████████▉                                 | 3556/9741 [00:08<00:13, 455.24it/s] 37%|███████████████████▏                                | 3602/9741 [00:08<00:13, 455.86it/s] 37%|███████████████████▍                                | 3648/9741 [00:08<00:13, 453.25it/s] 38%|███████████████████▋                                | 3694/9741 [00:09<00:13, 452.57it/s] 38%|███████████████████▉                                | 3740/9741 [00:09<00:13, 453.83it/s] 39%|████████████████████▏                               | 3786/9741 [00:09<00:13, 454.59it/s] 39%|████████████████████▍                               | 3832/9741 [00:09<00:13, 452.86it/s] 40%|████████████████████▋                               | 3878/9741 [00:09<00:12, 453.91it/s] 40%|████████████████████▉                               | 3924/9741 [00:09<00:12, 453.61it/s] 41%|█████████████████████▏                              | 3970/9741 [00:09<00:12, 454.14it/s] 41%|█████████████████████▍                              | 4016/9741 [00:09<00:12, 454.65it/s] 42%|█████████████████████▋                              | 4062/9741 [00:09<00:12, 452.88it/s] 42%|█████████████████████▉                              | 4108/9741 [00:09<00:12, 454.08it/s] 43%|██████████████████████▏                             | 4154/9741 [00:10<00:12, 454.47it/s] 43%|██████████████████████▍                             | 4201/9741 [00:10<00:12, 456.23it/s] 44%|██████████████████████▋                             | 4248/9741 [00:10<00:12, 457.39it/s] 44%|██████████████████████▉                             | 4294/9741 [00:10<00:11, 455.95it/s] 45%|███████████████████████▏                            | 4340/9741 [00:10<00:11, 456.78it/s] 45%|███████████████████████▍                            | 4386/9741 [00:10<00:11, 456.85it/s] 46%|███████████████████████▋                            | 4433/9741 [00:10<00:11, 457.85it/s] 46%|███████████████████████▉                            | 4479/9741 [00:10<00:11, 457.20it/s] 46%|████████████████████████▏                           | 4525/9741 [00:10<00:12, 422.73it/s] 47%|████████████████████████▍                           | 4571/9741 [00:11<00:11, 432.84it/s] 47%|████████████████████████▋                           | 4617/9741 [00:11<00:11, 439.83it/s] 48%|████████████████████████▉                           | 4663/9741 [00:11<00:11, 444.24it/s] 48%|█████████████████████████▏                          | 4710/9741 [00:11<00:11, 449.39it/s] 49%|█████████████████████████▍                          | 4756/9741 [00:11<00:15, 315.66it/s] 49%|█████████████████████████▋                          | 4803/9741 [00:11<00:14, 349.17it/s] 50%|█████████████████████████▉                          | 4850/9741 [00:11<00:12, 376.78it/s] 50%|██████████████████████████▏                         | 4896/9741 [00:11<00:12, 397.63it/s] 51%|██████████████████████████▍                         | 4943/9741 [00:11<00:11, 413.27it/s] 51%|██████████████████████████▋                         | 4990/9741 [00:12<00:11, 426.73it/s] 52%|██████████████████████████▉                         | 5036/9741 [00:12<00:10, 435.51it/s] 52%|███████████████████████████▏                        | 5082/9741 [00:12<00:10, 441.53it/s] 53%|███████████████████████████▍                        | 5129/9741 [00:12<00:10, 447.14it/s] 53%|███████████████████████████▋                        | 5175/9741 [00:12<00:10, 449.42it/s] 54%|███████████████████████████▉                        | 5222/9741 [00:12<00:09, 452.62it/s] 54%|████████████████████████████                        | 5268/9741 [00:12<00:09, 454.58it/s] 55%|████████████████████████████▎                       | 5315/9741 [00:12<00:09, 457.02it/s] 55%|████████████████████████████▌                       | 5362/9741 [00:12<00:09, 458.08it/s] 56%|████████████████████████████▊                       | 5408/9741 [00:12<00:09, 456.53it/s] 56%|█████████████████████████████                       | 5454/9741 [00:13<00:09, 456.41it/s] 56%|█████████████████████████████▎                      | 5501/9741 [00:13<00:09, 459.54it/s] 57%|█████████████████████████████▌                      | 5548/9741 [00:13<00:09, 462.35it/s] 57%|█████████████████████████████▊                      | 5595/9741 [00:13<00:08, 463.02it/s] 58%|██████████████████████████████                      | 5642/9741 [00:13<00:08, 462.13it/s] 58%|██████████████████████████████▎                     | 5690/9741 [00:13<00:08, 465.30it/s] 59%|██████████████████████████████▋                     | 5739/9741 [00:13<00:08, 469.90it/s] 59%|██████████████████████████████▉                     | 5787/9741 [00:13<00:08, 472.10it/s] 60%|███████████████████████████████▏                    | 5835/9741 [00:13<00:08, 473.47it/s] 60%|███████████████████████████████▍                    | 5883/9741 [00:13<00:08, 472.05it/s] 61%|███████████████████████████████▋                    | 5931/9741 [00:14<00:08, 473.82it/s] 61%|███████████████████████████████▉                    | 5979/9741 [00:14<00:07, 475.51it/s] 62%|████████████████████████████████▏                   | 6027/9741 [00:14<00:07, 476.42it/s] 62%|████████████████████████████████▍                   | 6075/9741 [00:14<00:07, 476.94it/s] 63%|████████████████████████████████▋                   | 6123/9741 [00:14<00:07, 473.71it/s] 63%|████████████████████████████████▉                   | 6171/9741 [00:14<00:07, 474.52it/s] 64%|█████████████████████████████████▏                  | 6219/9741 [00:14<00:07, 475.85it/s] 64%|█████████████████████████████████▍                  | 6267/9741 [00:14<00:07, 476.10it/s] 65%|█████████████████████████████████▋                  | 6315/9741 [00:14<00:07, 474.75it/s] 65%|█████████████████████████████████▉                  | 6363/9741 [00:15<00:07, 475.01it/s] 66%|██████████████████████████████████▏                 | 6411/9741 [00:15<00:06, 476.10it/s] 66%|██████████████████████████████████▍                 | 6459/9741 [00:15<00:06, 476.76it/s] 67%|██████████████████████████████████▋                 | 6507/9741 [00:15<00:06, 477.55it/s] 67%|██████████████████████████████████▉                 | 6555/9741 [00:15<00:06, 474.97it/s] 68%|███████████████████████████████████▏                | 6603/9741 [00:15<00:06, 475.99it/s] 68%|███████████████████████████████████▌                | 6651/9741 [00:15<00:06, 476.03it/s] 69%|███████████████████████████████████▊                | 6699/9741 [00:15<00:06, 477.10it/s] 69%|████████████████████████████████████                | 6748/9741 [00:15<00:06, 478.22it/s] 70%|████████████████████████████████████▎               | 6796/9741 [00:15<00:06, 476.25it/s] 70%|████████████████████████████████████▌               | 6845/9741 [00:16<00:06, 477.47it/s] 71%|████████████████████████████████████▊               | 6894/9741 [00:16<00:05, 478.27it/s] 71%|█████████████████████████████████████               | 6942/9741 [00:16<00:05, 478.28it/s] 72%|█████████████████████████████████████▎              | 6990/9741 [00:16<00:05, 476.52it/s] 72%|█████████████████████████████████████▌              | 7038/9741 [00:16<00:05, 477.17it/s] 73%|█████████████████████████████████████▊              | 7086/9741 [00:16<00:05, 477.51it/s] 73%|██████████████████████████████████████              | 7134/9741 [00:16<00:05, 477.85it/s] 74%|██████████████████████████████████████▎             | 7182/9741 [00:16<00:05, 475.15it/s] 74%|██████████████████████████████████████▌             | 7230/9741 [00:16<00:05, 473.15it/s] 75%|██████████████████████████████████████▊             | 7278/9741 [00:16<00:05, 474.51it/s] 75%|███████████████████████████████████████             | 7326/9741 [00:17<00:05, 476.02it/s] 76%|███████████████████████████████████████▎            | 7374/9741 [00:17<00:04, 476.62it/s] 76%|███████████████████████████████████████▌            | 7422/9741 [00:17<00:04, 476.69it/s] 77%|███████████████████████████████████████▉            | 7470/9741 [00:17<00:05, 448.64it/s] 77%|████████████████████████████████████████▏           | 7518/9741 [00:17<00:04, 456.84it/s] 78%|████████████████████████████████████████▍           | 7566/9741 [00:17<00:04, 461.39it/s] 78%|████████████████████████████████████████▋           | 7614/9741 [00:17<00:04, 465.99it/s] 79%|████████████████████████████████████████▉           | 7662/9741 [00:17<00:04, 467.88it/s] 79%|█████████████████████████████████████████▏          | 7709/9741 [00:17<00:04, 467.34it/s] 80%|█████████████████████████████████████████▍          | 7757/9741 [00:17<00:04, 469.84it/s] 80%|█████████████████████████████████████████▋          | 7805/9741 [00:18<00:04, 472.14it/s] 81%|█████████████████████████████████████████▉          | 7853/9741 [00:18<00:03, 473.54it/s] 81%|██████████████████████████████████████████▏         | 7901/9741 [00:18<00:03, 471.71it/s] 82%|██████████████████████████████████████████▍         | 7949/9741 [00:18<00:03, 473.03it/s] 82%|██████████████████████████████████████████▋         | 7997/9741 [00:18<00:03, 470.78it/s] 83%|██████████████████████████████████████████▉         | 8045/9741 [00:18<00:03, 472.36it/s] 83%|███████████████████████████████████████████▏        | 8093/9741 [00:18<00:03, 473.69it/s] 84%|███████████████████████████████████████████▍        | 8141/9741 [00:18<00:03, 472.21it/s] 84%|███████████████████████████████████████████▋        | 8189/9741 [00:18<00:03, 474.02it/s] 85%|███████████████████████████████████████████▉        | 8237/9741 [00:18<00:03, 475.01it/s] 85%|████████████████████████████████████████████▏       | 8285/9741 [00:19<00:03, 475.61it/s] 86%|████████████████████████████████████████████▍       | 8333/9741 [00:19<00:02, 475.75it/s] 86%|████████████████████████████████████████████▋       | 8381/9741 [00:19<00:02, 472.76it/s] 87%|████████████████████████████████████████████▉       | 8429/9741 [00:19<00:02, 473.15it/s] 87%|█████████████████████████████████████████████▎      | 8477/9741 [00:19<00:02, 474.15it/s] 88%|█████████████████████████████████████████████▌      | 8525/9741 [00:19<00:02, 474.21it/s] 88%|█████████████████████████████████████████████▊      | 8573/9741 [00:19<00:02, 474.13it/s] 89%|██████████████████████████████████████████████      | 8621/9741 [00:19<00:02, 472.05it/s] 89%|██████████████████████████████████████████████▎     | 8669/9741 [00:19<00:02, 472.96it/s] 89%|██████████████████████████████████████████████▌     | 8717/9741 [00:19<00:02, 474.16it/s] 90%|██████████████████████████████████████████████▊     | 8765/9741 [00:20<00:02, 470.01it/s] 90%|███████████████████████████████████████████████     | 8813/9741 [00:20<00:01, 467.56it/s] 91%|███████████████████████████████████████████████▎    | 8861/9741 [00:20<00:01, 470.56it/s] 91%|███████████████████████████████████████████████▌    | 8909/9741 [00:20<00:01, 472.50it/s] 92%|███████████████████████████████████████████████▊    | 8957/9741 [00:20<00:01, 473.62it/s] 92%|████████████████████████████████████████████████    | 9005/9741 [00:20<00:01, 473.82it/s] 93%|████████████████████████████████████████████████▎   | 9053/9741 [00:20<00:01, 472.37it/s] 93%|████████████████████████████████████████████████▌   | 9101/9741 [00:20<00:01, 472.05it/s] 94%|████████████████████████████████████████████████▊   | 9149/9741 [00:20<00:01, 471.95it/s] 94%|█████████████████████████████████████████████████   | 9197/9741 [00:21<00:01, 472.53it/s] 95%|█████████████████████████████████████████████████▎  | 9245/9741 [00:21<00:01, 473.29it/s] 95%|█████████████████████████████████████████████████▌  | 9293/9741 [00:21<00:00, 471.31it/s] 96%|█████████████████████████████████████████████████▊  | 9341/9741 [00:21<00:00, 472.77it/s] 96%|██████████████████████████████████████████████████  | 9389/9741 [00:21<00:00, 473.57it/s] 97%|██████████████████████████████████████████████████▍ | 9437/9741 [00:21<00:00, 474.63it/s] 97%|██████████████████████████████████████████████████▋ | 9485/9741 [00:21<00:00, 471.03it/s] 98%|██████████████████████████████████████████████████▉ | 9533/9741 [00:21<00:00, 472.50it/s] 98%|███████████████████████████████████████████████████▏| 9581/9741 [00:21<00:00, 469.08it/s] 99%|███████████████████████████████████████████████████▍| 9628/9741 [00:21<00:00, 468.56it/s] 99%|███████████████████████████████████████████████████▋| 9675/9741 [00:22<00:00, 468.51it/s]100%|███████████████████████████████████████████████████▉| 9722/9741 [00:22<00:00, 467.60it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:22<00:00, 439.64it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.71s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.76s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.53s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.73s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.34s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.46s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.83s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.56s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.81s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.94s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.13s/it]
[2023-08-22 02:39:52,087] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.38s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.49s/it]
[2023-08-22 02:40:06,153] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 02:40:06,154] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f2f86e30fd0>
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 02:40:06,155] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f2f84289220>
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 02:40:06,156] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 02:40:06,157] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4642207622528076 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]Time to load utils op: 0.404390811920166 seconds
############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input: Sam, Sid, and Steve brought popsicle sticks for their group activity in their Art class. Sam has thrice as many as Sid, and Sid has twice as many as Steve. If Steve has 12 popsicle sticks, how many popsicle sticks can they use for their Art class activity?
Output: 108

Input: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.
Output: 720

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o15-tgsm8k-s20-rFalse
Loading extension module utils...
Time to load utils op: 0.5048325061798096 seconds
Loading extension module utils...
Time to load utils op: 0.40462207794189453 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:17<14:18, 17.53s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [00:37<15:21, 19.20s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:18<22:39, 28.92s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [01:58<25:36, 33.40s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [02:39<27:01, 36.02s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:20<27:34, 37.61s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [03:56<26:36, 37.13s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [04:36<26:48, 38.31s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:17<26:37, 38.97s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [05:58<26:20, 39.52s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [06:38<25:49, 39.73s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:19<25:25, 40.14s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [07:59<24:48, 40.22s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [08:40<24:07, 40.20s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:20<23:30, 40.29s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:01<22:52, 40.35s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:41<22:10, 40.32s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:08<19:27, 36.48s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [11:49<19:33, 37.86s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:30<19:16, 38.55s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:10<18:53, 39.07s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [13:38<16:40, 35.73s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:18<16:40, 37.06s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [14:59<16:31, 38.13s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [15:39<16:08, 38.75s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:19<15:43, 39.31s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:00<15:12, 39.70s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [17:41<14:39, 39.98s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:21<14:03, 40.18s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:02<13:26, 40.33s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:43<12:47, 40.41s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:23<12:06, 40.39s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:03<11:26, 40.37s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:43<10:45, 40.32s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:24<10:04, 40.27s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [23:03<09:22, 40.18s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:44<08:41, 40.13s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [24:24<08:02, 40.23s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [25:04<07:22, 40.20s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [25:33<06:08, 36.84s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [26:14<05:41, 37.98s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:54<05:08, 38.61s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [27:35<04:35, 39.33s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [28:15<03:58, 39.68s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:48<03:07, 37.54s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [29:28<02:33, 38.31s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [29:51<01:41, 33.76s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [30:32<01:11, 35.86s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [31:12<00:37, 37.27s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:53<00:00, 38.23s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:53<00:00, 38.27s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.2478} | avg. gen lenth: 290.496
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o16-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 16
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 03:13:20,623] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o16-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 16
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o16-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 30/9741 [00:00<00:33, 292.43it/s]  1%|▎                                                     | 60/9741 [00:00<00:33, 293.18it/s]  1%|▍                                                     | 90/9741 [00:00<00:32, 293.05it/s]  1%|▋                                                    | 120/9741 [00:00<00:34, 275.49it/s]  2%|▊                                                    | 150/9741 [00:00<00:34, 280.85it/s]  2%|▉                                                    | 180/9741 [00:00<00:33, 285.21it/s]  2%|█▏                                                   | 209/9741 [00:00<00:34, 278.45it/s]  2%|█▎                                                   | 238/9741 [00:00<00:33, 281.86it/s]  3%|█▍                                                   | 268/9741 [00:00<00:33, 284.73it/s]  3%|█▌                                                   | 298/9741 [00:01<00:32, 286.97it/s]  3%|█▊                                                   | 328/9741 [00:01<00:32, 288.56it/s]  4%|█▉                                                   | 358/9741 [00:01<00:32, 289.85it/s]  4%|██                                                   | 388/9741 [00:01<00:32, 290.70it/s]  4%|██▎                                                  | 418/9741 [00:01<00:32, 291.07it/s]  5%|██▍                                                  | 448/9741 [00:01<00:32, 289.83it/s]  5%|██▌                                                  | 478/9741 [00:01<00:31, 290.24it/s]  5%|██▊                                                  | 508/9741 [00:01<00:32, 285.86it/s]  6%|██▉                                                  | 537/9741 [00:01<00:32, 286.65it/s]  6%|███                                                  | 566/9741 [00:01<00:31, 287.47it/s]  6%|███▏                                                 | 596/9741 [00:02<00:31, 288.28it/s]  6%|███▍                                                 | 625/9741 [00:02<00:31, 288.43it/s]  7%|███▌                                                 | 654/9741 [00:02<00:31, 287.57it/s]  7%|███▋                                                 | 684/9741 [00:02<00:31, 289.71it/s]  7%|███▉                                                 | 714/9741 [00:02<00:31, 290.96it/s]  8%|████                                                 | 744/9741 [00:02<00:30, 291.97it/s]  8%|████▎                                                | 786/9741 [00:02<00:27, 328.53it/s]  9%|████▌                                                | 831/9741 [00:02<00:24, 363.50it/s]  9%|████▊                                                | 876/9741 [00:02<00:22, 388.19it/s]  9%|█████                                                | 920/9741 [00:02<00:21, 402.77it/s] 10%|█████▎                                               | 965/9741 [00:03<00:21, 415.62it/s] 10%|█████▍                                              | 1010/9741 [00:03<00:20, 424.41it/s] 11%|█████▋                                              | 1055/9741 [00:03<00:20, 430.35it/s] 11%|█████▊                                              | 1100/9741 [00:03<00:19, 435.02it/s] 12%|██████                                              | 1144/9741 [00:03<00:19, 436.08it/s] 12%|██████▎                                             | 1189/9741 [00:03<00:19, 438.81it/s] 13%|██████▌                                             | 1234/9741 [00:03<00:19, 439.88it/s] 13%|██████▊                                             | 1279/9741 [00:03<00:19, 441.13it/s] 14%|███████                                             | 1324/9741 [00:03<00:19, 442.39it/s] 14%|███████▎                                            | 1369/9741 [00:04<00:18, 440.77it/s] 15%|███████▌                                            | 1414/9741 [00:04<00:18, 441.21it/s] 15%|███████▊                                            | 1459/9741 [00:04<00:18, 441.76it/s] 15%|████████                                            | 1504/9741 [00:04<00:18, 442.04it/s] 16%|████████▎                                           | 1549/9741 [00:04<00:18, 441.81it/s] 16%|████████▌                                           | 1594/9741 [00:04<00:18, 440.14it/s] 17%|████████▋                                           | 1639/9741 [00:04<00:18, 441.41it/s] 17%|████████▉                                           | 1684/9741 [00:04<00:18, 442.20it/s] 18%|█████████▏                                          | 1729/9741 [00:04<00:18, 442.65it/s] 18%|█████████▍                                          | 1774/9741 [00:04<00:17, 443.29it/s] 19%|█████████▋                                          | 1819/9741 [00:05<00:18, 417.11it/s] 19%|█████████▉                                          | 1864/9741 [00:05<00:18, 424.70it/s] 20%|██████████▏                                         | 1909/9741 [00:05<00:18, 430.22it/s] 20%|██████████▍                                         | 1954/9741 [00:05<00:17, 433.65it/s] 21%|██████████▋                                         | 1999/9741 [00:05<00:17, 436.19it/s] 21%|██████████▉                                         | 2043/9741 [00:05<00:17, 435.87it/s] 21%|███████████▏                                        | 2087/9741 [00:05<00:17, 435.40it/s] 22%|███████████▍                                        | 2132/9741 [00:05<00:17, 437.76it/s] 22%|███████████▌                                        | 2177/9741 [00:05<00:17, 439.13it/s] 23%|███████████▊                                        | 2222/9741 [00:05<00:17, 440.09it/s] 23%|████████████                                        | 2267/9741 [00:06<00:17, 438.55it/s] 24%|████████████▎                                       | 2312/9741 [00:06<00:16, 440.11it/s] 24%|████████████▌                                       | 2357/9741 [00:06<00:16, 440.70it/s] 25%|████████████▊                                       | 2402/9741 [00:06<00:16, 440.86it/s] 25%|█████████████                                       | 2447/9741 [00:06<00:16, 441.70it/s] 26%|█████████████▎                                      | 2492/9741 [00:06<00:16, 439.67it/s] 26%|█████████████▌                                      | 2537/9741 [00:06<00:16, 440.35it/s] 27%|█████████████▊                                      | 2582/9741 [00:06<00:16, 440.99it/s] 27%|██████████████                                      | 2627/9741 [00:06<00:16, 441.84it/s] 27%|██████████████▎                                     | 2672/9741 [00:06<00:16, 437.84it/s] 28%|██████████████▍                                     | 2716/9741 [00:07<00:16, 436.69it/s] 28%|██████████████▋                                     | 2761/9741 [00:07<00:15, 437.79it/s] 29%|██████████████▉                                     | 2806/9741 [00:07<00:15, 439.10it/s] 29%|███████████████▏                                    | 2850/9741 [00:07<00:15, 439.14it/s] 30%|███████████████▍                                    | 2895/9741 [00:07<00:15, 440.55it/s] 30%|███████████████▋                                    | 2940/9741 [00:07<00:15, 438.84it/s] 31%|███████████████▉                                    | 2985/9741 [00:07<00:15, 439.69it/s] 31%|████████████████▏                                   | 3030/9741 [00:07<00:15, 440.75it/s] 32%|████████████████▍                                   | 3075/9741 [00:07<00:15, 441.33it/s] 32%|████████████████▋                                   | 3120/9741 [00:07<00:14, 441.66it/s] 32%|████████████████▉                                   | 3165/9741 [00:08<00:14, 439.55it/s] 33%|█████████████████▏                                  | 3210/9741 [00:08<00:14, 440.72it/s] 33%|█████████████████▍                                  | 3255/9741 [00:08<00:14, 437.75it/s] 34%|█████████████████▌                                  | 3299/9741 [00:08<00:14, 438.11it/s] 34%|█████████████████▊                                  | 3343/9741 [00:08<00:14, 438.63it/s] 35%|██████████████████                                  | 3387/9741 [00:08<00:14, 437.66it/s] 35%|██████████████████▎                                 | 3432/9741 [00:08<00:14, 439.37it/s] 36%|██████████████████▌                                 | 3477/9741 [00:08<00:14, 440.08it/s] 36%|██████████████████▊                                 | 3522/9741 [00:08<00:14, 440.15it/s] 37%|███████████████████                                 | 3567/9741 [00:09<00:14, 440.68it/s] 37%|███████████████████▎                                | 3612/9741 [00:09<00:13, 438.89it/s] 38%|███████████████████▌                                | 3657/9741 [00:09<00:13, 439.83it/s] 38%|███████████████████▊                                | 3702/9741 [00:09<00:13, 440.57it/s] 38%|████████████████████                                | 3747/9741 [00:09<00:13, 441.32it/s] 39%|████████████████████▏                               | 3792/9741 [00:09<00:13, 441.58it/s] 39%|████████████████████▍                               | 3837/9741 [00:09<00:13, 433.83it/s] 40%|████████████████████▋                               | 3882/9741 [00:09<00:13, 436.56it/s] 40%|████████████████████▉                               | 3927/9741 [00:09<00:13, 438.43it/s] 41%|█████████████████████▏                              | 3972/9741 [00:09<00:13, 438.88it/s] 41%|█████████████████████▍                              | 4017/9741 [00:10<00:13, 439.92it/s] 42%|█████████████████████▋                              | 4062/9741 [00:10<00:12, 438.29it/s] 42%|█████████████████████▉                              | 4107/9741 [00:10<00:12, 439.65it/s] 43%|██████████████████████▏                             | 4152/9741 [00:10<00:12, 440.50it/s] 43%|██████████████████████▍                             | 4197/9741 [00:10<00:12, 439.77it/s] 44%|██████████████████████▋                             | 4242/9741 [00:10<00:12, 440.20it/s] 44%|██████████████████████▉                             | 4287/9741 [00:10<00:12, 438.99it/s] 44%|███████████████████████▏                            | 4332/9741 [00:10<00:12, 440.09it/s] 45%|███████████████████████▎                            | 4377/9741 [00:10<00:12, 440.82it/s] 45%|███████████████████████▌                            | 4422/9741 [00:10<00:12, 440.89it/s] 46%|███████████████████████▊                            | 4467/9741 [00:11<00:11, 440.63it/s] 46%|████████████████████████                            | 4512/9741 [00:11<00:13, 396.89it/s] 47%|████████████████████████▎                           | 4556/9741 [00:11<00:12, 408.52it/s] 47%|████████████████████████▌                           | 4601/9741 [00:11<00:12, 418.17it/s] 48%|████████████████████████▊                           | 4646/9741 [00:11<00:11, 425.06it/s] 48%|█████████████████████████                           | 4690/9741 [00:11<00:11, 429.11it/s] 49%|█████████████████████████▎                          | 4735/9741 [00:11<00:11, 433.18it/s] 49%|█████████████████████████▌                          | 4779/9741 [00:11<00:17, 283.15it/s] 50%|█████████████████████████▊                          | 4824/9741 [00:12<00:15, 317.68it/s] 50%|█████████████████████████▉                          | 4868/9741 [00:12<00:14, 344.65it/s] 50%|██████████████████████████▏                         | 4913/9741 [00:12<00:13, 368.89it/s] 51%|██████████████████████████▍                         | 4957/9741 [00:12<00:12, 386.27it/s] 51%|██████████████████████████▋                         | 5002/9741 [00:12<00:11, 401.28it/s] 52%|██████████████████████████▉                         | 5047/9741 [00:12<00:11, 412.67it/s] 52%|███████████████████████████▏                        | 5092/9741 [00:12<00:11, 420.88it/s] 53%|███████████████████████████▍                        | 5137/9741 [00:12<00:10, 427.26it/s] 53%|███████████████████████████▋                        | 5181/9741 [00:12<00:10, 429.59it/s] 54%|███████████████████████████▉                        | 5226/9741 [00:13<00:10, 432.97it/s] 54%|████████████████████████████▏                       | 5271/9741 [00:13<00:10, 435.40it/s] 55%|████████████████████████████▍                       | 5316/9741 [00:13<00:10, 437.64it/s] 55%|████████████████████████████▌                       | 5361/9741 [00:13<00:09, 439.11it/s] 55%|████████████████████████████▊                       | 5406/9741 [00:13<00:09, 438.24it/s] 56%|█████████████████████████████                       | 5451/9741 [00:13<00:09, 439.22it/s] 56%|█████████████████████████████▎                      | 5497/9741 [00:13<00:09, 442.55it/s] 57%|█████████████████████████████▌                      | 5543/9741 [00:13<00:09, 447.31it/s] 57%|█████████████████████████████▊                      | 5589/9741 [00:13<00:09, 450.21it/s] 58%|██████████████████████████████                      | 5635/9741 [00:13<00:09, 449.80it/s] 58%|██████████████████████████████▎                     | 5681/9741 [00:14<00:08, 452.19it/s] 59%|██████████████████████████████▌                     | 5727/9741 [00:14<00:08, 454.01it/s] 59%|██████████████████████████████▊                     | 5773/9741 [00:14<00:08, 454.90it/s] 60%|███████████████████████████████                     | 5819/9741 [00:14<00:08, 455.32it/s] 60%|███████████████████████████████▎                    | 5865/9741 [00:14<00:08, 452.29it/s] 61%|███████████████████████████████▌                    | 5911/9741 [00:14<00:08, 454.06it/s] 61%|███████████████████████████████▊                    | 5957/9741 [00:14<00:08, 455.47it/s] 62%|████████████████████████████████                    | 6003/9741 [00:14<00:08, 455.14it/s] 62%|████████████████████████████████▎                   | 6049/9741 [00:14<00:08, 454.31it/s] 63%|████████████████████████████████▌                   | 6095/9741 [00:14<00:08, 452.05it/s] 63%|████████████████████████████████▊                   | 6141/9741 [00:15<00:07, 453.22it/s] 64%|█████████████████████████████████                   | 6187/9741 [00:15<00:07, 454.31it/s] 64%|█████████████████████████████████▎                  | 6233/9741 [00:15<00:07, 454.34it/s] 64%|█████████████████████████████████▌                  | 6279/9741 [00:15<00:07, 455.05it/s] 65%|█████████████████████████████████▊                  | 6325/9741 [00:15<00:07, 453.59it/s] 65%|██████████████████████████████████                  | 6371/9741 [00:15<00:07, 454.75it/s] 66%|██████████████████████████████████▎                 | 6417/9741 [00:15<00:07, 455.11it/s] 66%|██████████████████████████████████▌                 | 6463/9741 [00:15<00:07, 455.44it/s] 67%|██████████████████████████████████▋                 | 6509/9741 [00:15<00:07, 455.66it/s] 67%|██████████████████████████████████▉                 | 6555/9741 [00:15<00:07, 452.71it/s] 68%|███████████████████████████████████▏                | 6601/9741 [00:16<00:06, 452.76it/s] 68%|███████████████████████████████████▍                | 6647/9741 [00:16<00:06, 453.68it/s] 69%|███████████████████████████████████▋                | 6693/9741 [00:16<00:06, 454.44it/s] 69%|███████████████████████████████████▉                | 6739/9741 [00:16<00:06, 455.08it/s] 70%|████████████████████████████████████▏               | 6785/9741 [00:16<00:06, 451.87it/s] 70%|████████████████████████████████████▍               | 6831/9741 [00:16<00:06, 453.22it/s] 71%|████████████████████████████████████▋               | 6877/9741 [00:16<00:06, 454.25it/s] 71%|████████████████████████████████████▉               | 6923/9741 [00:16<00:06, 455.14it/s] 72%|█████████████████████████████████████▏              | 6969/9741 [00:16<00:06, 455.04it/s] 72%|█████████████████████████████████████▍              | 7015/9741 [00:16<00:06, 452.77it/s] 72%|█████████████████████████████████████▋              | 7061/9741 [00:17<00:05, 452.46it/s] 73%|█████████████████████████████████████▉              | 7107/9741 [00:17<00:05, 453.47it/s] 73%|██████████████████████████████████████▏             | 7153/9741 [00:17<00:05, 452.08it/s] 74%|██████████████████████████████████████▍             | 7199/9741 [00:17<00:05, 453.25it/s] 74%|██████████████████████████████████████▋             | 7245/9741 [00:17<00:05, 451.67it/s] 75%|██████████████████████████████████████▉             | 7291/9741 [00:17<00:05, 452.88it/s] 75%|███████████████████████████████████████▏            | 7337/9741 [00:17<00:05, 453.33it/s] 76%|███████████████████████████████████████▍            | 7383/9741 [00:17<00:05, 454.14it/s] 76%|███████████████████████████████████████▋            | 7429/9741 [00:17<00:05, 454.74it/s] 77%|███████████████████████████████████████▉            | 7475/9741 [00:17<00:05, 426.36it/s] 77%|████████████████████████████████████████▏           | 7520/9741 [00:18<00:05, 432.75it/s] 78%|████████████████████████████████████████▍           | 7565/9741 [00:18<00:04, 437.65it/s] 78%|████████████████████████████████████████▋           | 7611/9741 [00:18<00:04, 442.87it/s] 79%|████████████████████████████████████████▉           | 7657/9741 [00:18<00:04, 445.72it/s] 79%|█████████████████████████████████████████           | 7702/9741 [00:18<00:04, 445.33it/s] 80%|█████████████████████████████████████████▎          | 7748/9741 [00:18<00:04, 448.81it/s] 80%|█████████████████████████████████████████▌          | 7794/9741 [00:18<00:04, 450.78it/s] 80%|█████████████████████████████████████████▊          | 7840/9741 [00:18<00:04, 452.69it/s] 81%|██████████████████████████████████████████          | 7886/9741 [00:18<00:04, 453.06it/s] 81%|██████████████████████████████████████████▎         | 7932/9741 [00:19<00:04, 450.98it/s] 82%|██████████████████████████████████████████▌         | 7978/9741 [00:19<00:03, 452.60it/s] 82%|██████████████████████████████████████████▊         | 8024/9741 [00:19<00:03, 453.80it/s] 83%|███████████████████████████████████████████         | 8070/9741 [00:19<00:03, 453.89it/s] 83%|███████████████████████████████████████████▎        | 8116/9741 [00:19<00:03, 454.04it/s] 84%|███████████████████████████████████████████▌        | 8162/9741 [00:19<00:03, 452.44it/s] 84%|███████████████████████████████████████████▊        | 8208/9741 [00:19<00:03, 453.30it/s] 85%|████████████████████████████████████████████        | 8254/9741 [00:19<00:03, 453.44it/s] 85%|████████████████████████████████████████████▎       | 8300/9741 [00:19<00:03, 453.62it/s] 86%|████████████████████████████████████████████▌       | 8346/9741 [00:19<00:03, 454.20it/s] 86%|████████████████████████████████████████████▊       | 8392/9741 [00:20<00:02, 452.05it/s] 87%|█████████████████████████████████████████████       | 8438/9741 [00:20<00:02, 452.78it/s] 87%|█████████████████████████████████████████████▎      | 8484/9741 [00:20<00:02, 453.19it/s] 88%|█████████████████████████████████████████████▌      | 8530/9741 [00:20<00:02, 453.72it/s] 88%|█████████████████████████████████████████████▊      | 8576/9741 [00:20<00:02, 451.18it/s] 89%|██████████████████████████████████████████████      | 8622/9741 [00:20<00:02, 450.66it/s] 89%|██████████████████████████████████████████████▎     | 8668/9741 [00:20<00:02, 451.88it/s] 89%|██████████████████████████████████████████████▌     | 8714/9741 [00:20<00:02, 453.27it/s] 90%|██████████████████████████████████████████████▊     | 8760/9741 [00:20<00:02, 453.62it/s] 90%|███████████████████████████████████████████████     | 8806/9741 [00:20<00:02, 450.72it/s] 91%|███████████████████████████████████████████████▎    | 8852/9741 [00:21<00:01, 451.84it/s] 91%|███████████████████████████████████████████████▍    | 8898/9741 [00:21<00:01, 452.64it/s] 92%|███████████████████████████████████████████████▋    | 8944/9741 [00:21<00:01, 452.66it/s] 92%|███████████████████████████████████████████████▉    | 8990/9741 [00:21<00:01, 452.49it/s] 93%|████████████████████████████████████████████████▏   | 9036/9741 [00:21<00:01, 450.85it/s] 93%|████████████████████████████████████████████████▍   | 9082/9741 [00:21<00:01, 451.97it/s] 94%|████████████████████████████████████████████████▋   | 9128/9741 [00:21<00:01, 452.75it/s] 94%|████████████████████████████████████████████████▉   | 9174/9741 [00:21<00:01, 453.04it/s] 95%|█████████████████████████████████████████████████▏  | 9220/9741 [00:21<00:01, 453.17it/s] 95%|█████████████████████████████████████████████████▍  | 9266/9741 [00:21<00:01, 451.74it/s] 96%|█████████████████████████████████████████████████▋  | 9312/9741 [00:22<00:00, 452.83it/s] 96%|█████████████████████████████████████████████████▉  | 9358/9741 [00:22<00:00, 453.14it/s] 97%|██████████████████████████████████████████████████▏ | 9404/9741 [00:22<00:00, 453.51it/s] 97%|██████████████████████████████████████████████████▍ | 9450/9741 [00:22<00:00, 452.11it/s] 97%|██████████████████████████████████████████████████▋ | 9496/9741 [00:22<00:00, 450.35it/s] 98%|██████████████████████████████████████████████████▉ | 9542/9741 [00:22<00:00, 449.90it/s] 98%|███████████████████████████████████████████████████▏| 9588/9741 [00:22<00:00, 450.84it/s] 99%|███████████████████████████████████████████████████▍| 9634/9741 [00:22<00:00, 451.47it/s] 99%|███████████████████████████████████████████████████▋| 9680/9741 [00:22<00:00, 451.81it/s]100%|███████████████████████████████████████████████████▉| 9726/9741 [00:22<00:00, 449.79it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:23<00:00, 423.40it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.94s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.31s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.50s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.61s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.06s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.27s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:13<00:06,  6.66s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.40s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.56s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.89s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.93s/it]
[2023-08-22 03:14:36,003] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:18<00:00,  5.98s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:18<00:00,  6.06s/it]
[2023-08-22 03:14:52,747] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 03:14:52,748] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 03:14:52,749] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 03:14:52,749] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 03:14:52,749] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 03:14:52,749] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 03:14:52,749] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7ff46b4a7fd0>
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 03:14:52,750] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7ff46acf0220>
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 03:14:52,751] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 03:14:52,751] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5297162532806396 seconds
Loading extension module utils...
Time to load utils op: 0.3050057888031006 seconds
Loading extension module utils...
Time to load utils op: 0.5050108432769775 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]Time to load utils op: 0.5047733783721924 seconds
############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input: Sam, Sid, and Steve brought popsicle sticks for their group activity in their Art class. Sam has thrice as many as Sid, and Sid has twice as many as Steve. If Steve has 12 popsicle sticks, how many popsicle sticks can they use for their Art class activity?
Output: 108

Input: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.
Output: 720

Input: John uses a 75-watt electric fan for 8 hours a day. How much kWh of electric energy does he consume per month (30 days) for using the electric fan?
Output: 18

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o16-tgsm8k-s20-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:35<29:11, 35.74s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:15<30:39, 38.33s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:55<30:30, 38.94s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:36<30:26, 39.71s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:02<25:58, 34.63s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:42<26:48, 36.55s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:22<26:58, 37.65s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:02<26:52, 38.39s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:38<25:51, 37.85s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:19<25:45, 38.63s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [06:59<25:23, 39.06s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:39<24:54, 39.34s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:19<24:26, 39.65s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [08:59<23:52, 39.79s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:39<23:16, 39.89s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:02<19:40, 34.72s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:42<19:59, 36.33s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:22<19:59, 37.49s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:03<19:50, 38.40s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:43<19:30, 39.03s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:05<16:19, 33.78s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [13:45<16:38, 35.65s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:25<16:39, 37.03s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:06<16:28, 38.03s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [15:33<14:29, 34.79s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:09<14:02, 35.10s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [16:47<13:47, 35.96s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [17:27<13:41, 37.35s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:07<13:21, 38.16s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [18:47<12:51, 38.59s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:27<12:21, 39.03s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:08<11:53, 39.63s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [20:48<11:14, 39.69s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:28<10:36, 39.76s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:08<09:57, 39.83s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [22:48<09:19, 39.99s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:28<08:40, 40.07s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [24:08<08:00, 40.01s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [24:48<07:20, 40.08s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [25:23<06:24, 38.44s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [26:03<05:50, 38.96s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:43<05:13, 39.21s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [27:23<04:35, 39.39s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [28:03<03:58, 39.71s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:41<03:15, 39.09s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [29:21<02:37, 39.40s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [30:02<01:59, 39.77s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [30:42<01:19, 39.96s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [31:23<00:40, 40.16s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [32:03<00:00, 40.27s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [32:03<00:00, 38.47s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.8576} | avg. gen lenth: 288.696
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o17-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 17
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 03:47:29,095] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o17-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 17
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o17-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 28/9741 [00:00<00:35, 270.75it/s]  1%|▎                                                     | 56/9741 [00:00<00:35, 271.19it/s]  1%|▍                                                     | 84/9741 [00:00<00:35, 271.61it/s]  1%|▌                                                    | 112/9741 [00:00<00:35, 272.30it/s]  1%|▊                                                    | 140/9741 [00:00<00:35, 272.36it/s]  2%|▉                                                    | 168/9741 [00:00<00:35, 272.49it/s]  2%|█                                                    | 196/9741 [00:00<00:35, 268.44it/s]  2%|█▏                                                   | 223/9741 [00:00<00:35, 267.27it/s]  3%|█▎                                                   | 251/9741 [00:00<00:35, 268.61it/s]  3%|█▌                                                   | 279/9741 [00:01<00:35, 269.88it/s]  3%|█▋                                                   | 307/9741 [00:01<00:34, 270.59it/s]  3%|█▊                                                   | 335/9741 [00:01<00:34, 270.85it/s]  4%|█▉                                                   | 363/9741 [00:01<00:34, 270.79it/s]  4%|██▏                                                  | 391/9741 [00:01<00:34, 271.52it/s]  4%|██▎                                                  | 419/9741 [00:01<00:34, 271.50it/s]  5%|██▍                                                  | 459/9741 [00:01<00:30, 307.55it/s]  5%|██▋                                                  | 500/9741 [00:01<00:27, 335.45it/s]  6%|██▉                                                  | 542/9741 [00:01<00:25, 358.51it/s]  6%|███▏                                                 | 584/9741 [00:01<00:24, 374.66it/s]  6%|███▍                                                 | 626/9741 [00:02<00:23, 386.08it/s]  7%|███▋                                                 | 667/9741 [00:02<00:23, 391.29it/s]  7%|███▊                                                 | 709/9741 [00:02<00:22, 397.79it/s]  8%|████                                                 | 750/9741 [00:02<00:22, 401.19it/s]  8%|████▎                                                | 791/9741 [00:02<00:22, 403.58it/s]  9%|████▌                                                | 832/9741 [00:02<00:21, 405.32it/s]  9%|████▋                                                | 873/9741 [00:02<00:21, 406.16it/s]  9%|████▉                                                | 914/9741 [00:02<00:21, 404.73it/s] 10%|█████▏                                               | 955/9741 [00:02<00:21, 405.68it/s] 10%|█████▍                                               | 996/9741 [00:02<00:21, 406.43it/s] 11%|█████▌                                              | 1037/9741 [00:03<00:21, 407.02it/s] 11%|█████▊                                              | 1078/9741 [00:03<00:21, 407.30it/s] 11%|█████▉                                              | 1119/9741 [00:03<00:21, 405.06it/s] 12%|██████▏                                             | 1160/9741 [00:03<00:21, 406.03it/s] 12%|██████▍                                             | 1201/9741 [00:03<00:21, 406.32it/s] 13%|██████▋                                             | 1242/9741 [00:03<00:20, 406.24it/s] 13%|██████▊                                             | 1283/9741 [00:03<00:20, 407.06it/s] 14%|███████                                             | 1324/9741 [00:03<00:20, 407.40it/s] 14%|███████▎                                            | 1365/9741 [00:03<00:20, 404.95it/s] 14%|███████▌                                            | 1406/9741 [00:03<00:20, 405.29it/s] 15%|███████▋                                            | 1447/9741 [00:04<00:20, 405.86it/s] 15%|███████▉                                            | 1488/9741 [00:04<00:20, 404.80it/s] 16%|████████▏                                           | 1529/9741 [00:04<00:20, 404.43it/s] 16%|████████▍                                           | 1570/9741 [00:04<00:20, 400.30it/s] 17%|████████▌                                           | 1611/9741 [00:04<00:20, 401.47it/s] 17%|████████▊                                           | 1652/9741 [00:04<00:20, 402.68it/s] 17%|█████████                                           | 1693/9741 [00:04<00:19, 403.76it/s] 18%|█████████▎                                          | 1734/9741 [00:04<00:19, 404.53it/s] 18%|█████████▍                                          | 1775/9741 [00:04<00:19, 405.03it/s] 19%|█████████▋                                          | 1816/9741 [00:05<00:20, 383.99it/s] 19%|█████████▉                                          | 1857/9741 [00:05<00:20, 389.52it/s] 19%|██████████▏                                         | 1898/9741 [00:05<00:19, 393.77it/s] 20%|██████████▎                                         | 1939/9741 [00:05<00:19, 397.17it/s] 20%|██████████▌                                         | 1980/9741 [00:05<00:19, 399.59it/s] 21%|██████████▊                                         | 2021/9741 [00:05<00:19, 399.27it/s] 21%|███████████                                         | 2061/9741 [00:05<00:19, 397.56it/s] 22%|███████████▏                                        | 2102/9741 [00:05<00:19, 398.88it/s] 22%|███████████▍                                        | 2143/9741 [00:05<00:18, 400.24it/s] 22%|███████████▋                                        | 2184/9741 [00:05<00:18, 400.73it/s] 23%|███████████▉                                        | 2225/9741 [00:06<00:18, 402.06it/s] 23%|████████████                                        | 2266/9741 [00:06<00:18, 399.66it/s] 24%|████████████▎                                       | 2307/9741 [00:06<00:18, 400.48it/s] 24%|████████████▌                                       | 2348/9741 [00:06<00:18, 401.45it/s] 25%|████████████▊                                       | 2389/9741 [00:06<00:18, 401.93it/s] 25%|████████████▉                                       | 2430/9741 [00:06<00:18, 402.25it/s] 25%|█████████████▏                                      | 2471/9741 [00:06<00:18, 399.87it/s] 26%|█████████████▍                                      | 2512/9741 [00:06<00:18, 400.54it/s] 26%|█████████████▋                                      | 2553/9741 [00:06<00:17, 400.64it/s] 27%|█████████████▊                                      | 2594/9741 [00:06<00:17, 398.60it/s] 27%|██████████████                                      | 2635/9741 [00:07<00:17, 399.86it/s] 27%|██████████████▎                                     | 2676/9741 [00:07<00:17, 402.25it/s] 28%|██████████████▌                                     | 2717/9741 [00:07<00:17, 401.61it/s] 28%|██████████████▋                                     | 2759/9741 [00:07<00:17, 404.41it/s] 29%|██████████████▉                                     | 2801/9741 [00:07<00:17, 406.53it/s] 29%|███████████████▏                                    | 2843/9741 [00:07<00:16, 407.61it/s] 30%|███████████████▍                                    | 2885/9741 [00:07<00:16, 408.43it/s] 30%|███████████████▌                                    | 2926/9741 [00:07<00:16, 406.59it/s] 30%|███████████████▊                                    | 2968/9741 [00:07<00:16, 408.39it/s] 31%|████████████████                                    | 3010/9741 [00:07<00:16, 409.73it/s] 31%|████████████████▎                                   | 3052/9741 [00:08<00:16, 410.73it/s] 32%|████████████████▌                                   | 3094/9741 [00:08<00:16, 409.69it/s] 32%|████████████████▋                                   | 3135/9741 [00:08<00:16, 408.43it/s] 33%|████████████████▉                                   | 3176/9741 [00:08<00:16, 407.18it/s] 33%|█████████████████▏                                  | 3218/9741 [00:08<00:15, 409.00it/s] 33%|█████████████████▍                                  | 3260/9741 [00:08<00:15, 410.37it/s] 34%|█████████████████▋                                  | 3302/9741 [00:08<00:15, 410.72it/s] 34%|█████████████████▊                                  | 3344/9741 [00:08<00:15, 410.34it/s] 35%|██████████████████                                  | 3386/9741 [00:08<00:15, 407.95it/s] 35%|██████████████████▎                                 | 3428/9741 [00:08<00:15, 409.07it/s] 36%|██████████████████▌                                 | 3470/9741 [00:09<00:15, 409.89it/s] 36%|██████████████████▋                                 | 3512/9741 [00:09<00:15, 409.97it/s] 36%|██████████████████▉                                 | 3554/9741 [00:09<00:15, 410.86it/s] 37%|███████████████████▏                                | 3596/9741 [00:09<00:14, 410.67it/s] 37%|███████████████████▍                                | 3638/9741 [00:09<00:14, 407.34it/s] 38%|███████████████████▋                                | 3680/9741 [00:09<00:14, 408.26it/s] 38%|███████████████████▊                                | 3722/9741 [00:09<00:14, 408.91it/s] 39%|████████████████████                                | 3763/9741 [00:09<00:14, 409.03it/s] 39%|████████████████████▎                               | 3804/9741 [00:09<00:14, 409.28it/s] 39%|████████████████████▌                               | 3845/9741 [00:10<00:14, 407.91it/s] 40%|████████████████████▋                               | 3887/9741 [00:10<00:14, 409.26it/s] 40%|████████████████████▉                               | 3928/9741 [00:10<00:14, 407.90it/s] 41%|█████████████████████▏                              | 3970/9741 [00:10<00:14, 408.85it/s] 41%|█████████████████████▍                              | 4012/9741 [00:10<00:13, 409.52it/s] 42%|█████████████████████▋                              | 4054/9741 [00:10<00:13, 410.14it/s] 42%|█████████████████████▊                              | 4096/9741 [00:10<00:13, 408.63it/s] 42%|██████████████████████                              | 4138/9741 [00:10<00:13, 409.74it/s] 43%|██████████████████████▎                             | 4180/9741 [00:10<00:13, 409.88it/s] 43%|██████████████████████▌                             | 4222/9741 [00:10<00:13, 410.06it/s] 44%|██████████████████████▊                             | 4264/9741 [00:11<00:13, 410.90it/s] 44%|██████████████████████▉                             | 4306/9741 [00:11<00:13, 409.19it/s] 45%|███████████████████████▏                            | 4348/9741 [00:11<00:13, 409.70it/s] 45%|███████████████████████▍                            | 4390/9741 [00:11<00:13, 410.13it/s] 45%|███████████████████████▋                            | 4432/9741 [00:11<00:12, 410.52it/s] 46%|███████████████████████▉                            | 4474/9741 [00:11<00:12, 410.94it/s] 46%|████████████████████████                            | 4516/9741 [00:11<00:13, 377.85it/s] 47%|████████████████████████▎                           | 4558/9741 [00:11<00:13, 387.13it/s] 47%|████████████████████████▌                           | 4600/9741 [00:11<00:13, 394.34it/s] 48%|████████████████████████▊                           | 4642/9741 [00:11<00:12, 399.34it/s] 48%|█████████████████████████                           | 4684/9741 [00:12<00:12, 402.96it/s] 49%|█████████████████████████▏                          | 4725/9741 [00:12<00:12, 404.58it/s] 49%|█████████████████████████▍                          | 4766/9741 [00:12<00:17, 284.25it/s] 49%|█████████████████████████▋                          | 4808/9741 [00:12<00:15, 313.66it/s] 50%|█████████████████████████▉                          | 4849/9741 [00:12<00:14, 337.00it/s] 50%|██████████████████████████                          | 4890/9741 [00:12<00:13, 355.76it/s] 51%|██████████████████████████▎                         | 4932/9741 [00:12<00:12, 371.16it/s] 51%|██████████████████████████▌                         | 4973/9741 [00:12<00:12, 380.48it/s] 51%|██████████████████████████▊                         | 5015/9741 [00:13<00:12, 389.31it/s] 52%|██████████████████████████▉                         | 5057/9741 [00:13<00:11, 395.96it/s] 52%|███████████████████████████▏                        | 5099/9741 [00:13<00:11, 400.66it/s] 53%|███████████████████████████▍                        | 5140/9741 [00:13<00:11, 400.94it/s] 53%|███████████████████████████▋                        | 5181/9741 [00:13<00:11, 400.43it/s] 54%|███████████████████████████▉                        | 5222/9741 [00:13<00:11, 402.86it/s] 54%|████████████████████████████                        | 5264/9741 [00:13<00:11, 405.23it/s] 54%|████████████████████████████▎                       | 5306/9741 [00:13<00:10, 407.21it/s] 55%|████████████████████████████▌                       | 5347/9741 [00:13<00:10, 407.82it/s] 55%|████████████████████████████▊                       | 5389/9741 [00:13<00:10, 409.05it/s] 56%|████████████████████████████▉                       | 5430/9741 [00:14<00:10, 407.74it/s] 56%|█████████████████████████████▏                      | 5472/9741 [00:14<00:10, 409.02it/s] 57%|█████████████████████████████▍                      | 5514/9741 [00:14<00:10, 411.83it/s] 57%|█████████████████████████████▋                      | 5557/9741 [00:14<00:10, 415.51it/s] 57%|█████████████████████████████▉                      | 5600/9741 [00:14<00:09, 417.57it/s] 58%|██████████████████████████████                      | 5642/9741 [00:14<00:09, 417.42it/s] 58%|██████████████████████████████▎                     | 5685/9741 [00:14<00:09, 420.02it/s] 59%|██████████████████████████████▌                     | 5728/9741 [00:14<00:09, 421.55it/s] 59%|██████████████████████████████▊                     | 5771/9741 [00:14<00:09, 422.31it/s] 60%|███████████████████████████████                     | 5814/9741 [00:14<00:09, 423.44it/s] 60%|███████████████████████████████▎                    | 5857/9741 [00:15<00:09, 421.74it/s] 61%|███████████████████████████████▍                    | 5900/9741 [00:15<00:09, 422.53it/s] 61%|███████████████████████████████▋                    | 5943/9741 [00:15<00:08, 423.45it/s] 61%|███████████████████████████████▉                    | 5986/9741 [00:15<00:08, 424.05it/s] 62%|████████████████████████████████▏                   | 6029/9741 [00:15<00:08, 423.88it/s] 62%|████████████████████████████████▍                   | 6072/9741 [00:15<00:08, 423.60it/s] 63%|████████████████████████████████▋                   | 6115/9741 [00:15<00:08, 422.09it/s] 63%|████████████████████████████████▊                   | 6158/9741 [00:15<00:08, 422.83it/s] 64%|█████████████████████████████████                   | 6201/9741 [00:15<00:08, 423.55it/s] 64%|█████████████████████████████████▎                  | 6244/9741 [00:15<00:08, 423.35it/s] 65%|█████████████████████████████████▌                  | 6287/9741 [00:16<00:08, 423.82it/s] 65%|█████████████████████████████████▊                  | 6330/9741 [00:16<00:08, 421.53it/s] 65%|██████████████████████████████████                  | 6373/9741 [00:16<00:07, 421.33it/s] 66%|██████████████████████████████████▎                 | 6416/9741 [00:16<00:07, 422.42it/s] 66%|██████████████████████████████████▍                 | 6459/9741 [00:16<00:07, 423.14it/s] 67%|██████████████████████████████████▋                 | 6502/9741 [00:16<00:07, 423.25it/s] 67%|██████████████████████████████████▉                 | 6545/9741 [00:16<00:07, 421.23it/s] 68%|███████████████████████████████████▏                | 6588/9741 [00:16<00:07, 421.72it/s] 68%|███████████████████████████████████▍                | 6631/9741 [00:16<00:07, 422.21it/s] 69%|███████████████████████████████████▋                | 6674/9741 [00:16<00:07, 423.26it/s] 69%|███████████████████████████████████▊                | 6717/9741 [00:17<00:07, 423.83it/s] 69%|████████████████████████████████████                | 6760/9741 [00:17<00:07, 422.80it/s] 70%|████████████████████████████████████▎               | 6803/9741 [00:17<00:06, 423.79it/s] 70%|████████████████████████████████████▌               | 6846/9741 [00:17<00:06, 423.98it/s] 71%|████████████████████████████████████▊               | 6889/9741 [00:17<00:06, 423.94it/s] 71%|█████████████████████████████████████               | 6932/9741 [00:17<00:06, 423.29it/s] 72%|█████████████████████████████████████▏              | 6975/9741 [00:17<00:06, 422.95it/s] 72%|█████████████████████████████████████▍              | 7018/9741 [00:17<00:06, 421.49it/s] 72%|█████████████████████████████████████▋              | 7061/9741 [00:17<00:06, 422.77it/s] 73%|█████████████████████████████████████▉              | 7104/9741 [00:18<00:06, 423.56it/s] 73%|██████████████████████████████████████▏             | 7147/9741 [00:18<00:06, 424.41it/s] 74%|██████████████████████████████████████▍             | 7190/9741 [00:18<00:06, 424.01it/s] 74%|██████████████████████████████████████▌             | 7233/9741 [00:18<00:05, 420.40it/s] 75%|██████████████████████████████████████▊             | 7276/9741 [00:18<00:05, 420.96it/s] 75%|███████████████████████████████████████             | 7319/9741 [00:18<00:05, 422.25it/s] 76%|███████████████████████████████████████▎            | 7362/9741 [00:18<00:05, 423.46it/s] 76%|███████████████████████████████████████▌            | 7405/9741 [00:18<00:05, 424.36it/s] 76%|███████████████████████████████████████▊            | 7448/9741 [00:18<00:05, 397.68it/s] 77%|███████████████████████████████████████▉            | 7491/9741 [00:18<00:05, 404.95it/s] 77%|████████████████████████████████████████▏           | 7534/9741 [00:19<00:05, 409.76it/s] 78%|████████████████████████████████████████▍           | 7577/9741 [00:19<00:05, 414.30it/s] 78%|████████████████████████████████████████▋           | 7620/9741 [00:19<00:05, 417.41it/s] 79%|████████████████████████████████████████▉           | 7663/9741 [00:19<00:04, 419.38it/s] 79%|█████████████████████████████████████████▏          | 7706/9741 [00:19<00:04, 418.87it/s] 80%|█████████████████████████████████████████▎          | 7749/9741 [00:19<00:04, 420.51it/s] 80%|█████████████████████████████████████████▌          | 7792/9741 [00:19<00:04, 421.20it/s] 80%|█████████████████████████████████████████▊          | 7835/9741 [00:19<00:04, 421.60it/s] 81%|██████████████████████████████████████████          | 7878/9741 [00:19<00:04, 422.39it/s] 81%|██████████████████████████████████████████▎         | 7921/9741 [00:19<00:04, 420.90it/s] 82%|██████████████████████████████████████████▌         | 7964/9741 [00:20<00:04, 421.81it/s] 82%|██████████████████████████████████████████▋         | 8007/9741 [00:20<00:04, 421.16it/s] 83%|██████████████████████████████████████████▉         | 8050/9741 [00:20<00:04, 420.67it/s] 83%|███████████████████████████████████████████▏        | 8093/9741 [00:20<00:03, 421.82it/s] 84%|███████████████████████████████████████████▍        | 8136/9741 [00:20<00:03, 420.17it/s] 84%|███████████████████████████████████████████▋        | 8179/9741 [00:20<00:03, 421.52it/s] 84%|███████████████████████████████████████████▉        | 8222/9741 [00:20<00:03, 422.61it/s] 85%|████████████████████████████████████████████        | 8265/9741 [00:20<00:03, 423.29it/s] 85%|████████████████████████████████████████████▎       | 8308/9741 [00:20<00:03, 423.24it/s] 86%|████████████████████████████████████████████▌       | 8351/9741 [00:20<00:03, 421.06it/s] 86%|████████████████████████████████████████████▊       | 8394/9741 [00:21<00:03, 422.01it/s] 87%|█████████████████████████████████████████████       | 8437/9741 [00:21<00:03, 423.31it/s] 87%|█████████████████████████████████████████████▎      | 8480/9741 [00:21<00:02, 423.64it/s] 87%|█████████████████████████████████████████████▍      | 8523/9741 [00:21<00:02, 423.63it/s] 88%|█████████████████████████████████████████████▋      | 8566/9741 [00:21<00:02, 423.22it/s] 88%|█████████████████████████████████████████████▉      | 8609/9741 [00:21<00:02, 420.76it/s] 89%|██████████████████████████████████████████████▏     | 8652/9741 [00:21<00:02, 421.33it/s] 89%|██████████████████████████████████████████████▍     | 8695/9741 [00:21<00:02, 419.54it/s] 90%|██████████████████████████████████████████████▋     | 8738/9741 [00:21<00:02, 421.08it/s] 90%|██████████████████████████████████████████████▉     | 8781/9741 [00:22<00:02, 421.76it/s] 91%|███████████████████████████████████████████████     | 8824/9741 [00:22<00:02, 419.54it/s] 91%|███████████████████████████████████████████████▎    | 8867/9741 [00:22<00:02, 420.30it/s] 91%|███████████████████████████████████████████████▌    | 8910/9741 [00:22<00:01, 420.69it/s] 92%|███████████████████████████████████████████████▊    | 8953/9741 [00:22<00:01, 422.06it/s] 92%|████████████████████████████████████████████████    | 8996/9741 [00:22<00:01, 422.42it/s] 93%|████████████████████████████████████████████████▎   | 9039/9741 [00:22<00:01, 419.82it/s] 93%|████████████████████████████████████████████████▍   | 9082/9741 [00:22<00:01, 420.77it/s] 94%|████████████████████████████████████████████████▋   | 9125/9741 [00:22<00:01, 421.33it/s] 94%|████████████████████████████████████████████████▉   | 9168/9741 [00:22<00:01, 422.24it/s] 95%|█████████████████████████████████████████████████▏  | 9211/9741 [00:23<00:01, 422.73it/s] 95%|█████████████████████████████████████████████████▍  | 9254/9741 [00:23<00:01, 423.14it/s] 95%|█████████████████████████████████████████████████▋  | 9297/9741 [00:23<00:01, 420.58it/s] 96%|█████████████████████████████████████████████████▊  | 9340/9741 [00:23<00:00, 421.05it/s] 96%|██████████████████████████████████████████████████  | 9383/9741 [00:23<00:00, 421.21it/s] 97%|██████████████████████████████████████████████████▎ | 9426/9741 [00:23<00:00, 418.72it/s] 97%|██████████████████████████████████████████████████▌ | 9469/9741 [00:23<00:00, 419.15it/s] 98%|██████████████████████████████████████████████████▊ | 9511/9741 [00:23<00:00, 417.55it/s] 98%|███████████████████████████████████████████████████ | 9554/9741 [00:23<00:00, 419.11it/s] 99%|███████████████████████████████████████████████████▏| 9597/9741 [00:23<00:00, 419.84it/s] 99%|███████████████████████████████████████████████████▍| 9640/9741 [00:24<00:00, 420.54it/s] 99%|███████████████████████████████████████████████████▋| 9683/9741 [00:24<00:00, 421.08it/s]100%|███████████████████████████████████████████████████▉| 9726/9741 [00:24<00:00, 418.43it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:24<00:00, 400.97it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.30s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.33s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.06s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.26s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.90s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.21s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.36s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.87s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.31s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.49s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
[2023-08-22 03:48:45,492] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.43s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.49s/it]
[2023-08-22 03:49:00,277] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 03:49:00,278] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 03:49:00,279] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 03:49:00,279] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 03:49:00,279] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 03:49:00,279] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 03:49:00,279] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 03:49:00,279] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 03:49:00,279] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 03:49:00,279] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 03:49:00,279] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 03:49:00,279] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f999eb2bfd0>
[2023-08-22 03:49:00,279] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f999e7f5220>
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 03:49:00,280] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 03:49:00,281] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 03:49:00,281] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.49309706687927246 seconds
Loading extension module utils...
Time to load utils op: 0.4047122001647949 seconds
Loading extension module utils...
Time to load utils op: 0.5046765804290771 seconds
Loading extension module utils...
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Time to load utils op: 0.5048601627349854 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input: Sam, Sid, and Steve brought popsicle sticks for their group activity in their Art class. Sam has thrice as many as Sid, and Sid has twice as many as Steve. If Steve has 12 popsicle sticks, how many popsicle sticks can they use for their Art class activity?
Output: 108

Input: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.
Output: 720

Input: John uses a 75-watt electric fan for 8 hours a day. How much kWh of electric energy does he consume per month (30 days) for using the electric fan?
Output: 18

Input: Barbara Blackburn can type 212 words per minute.  Due to Carpal tunnel syndrome, Barbara cannot use her left hand for a while so her typing speed is now 40 words less per minute. If she is supposed to type a document with 3440 words, how many minutes will it take her to finish typing the document?
Output: 20

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o17-tgsm8k-s20-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:40<33:08, 40.59s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:20<31:56, 39.92s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:59<31:10, 39.79s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:39<30:30, 39.79s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:19<29:50, 39.78s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:59<29:10, 39.78s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:38<28:28, 39.73s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:18<27:49, 39.75s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:58<27:07, 39.70s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:37<26:25, 39.64s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:17<25:45, 39.63s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:56<25:06, 39.64s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:36<24:31, 39.76s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:16<23:54, 39.85s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:56<23:13, 39.81s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:36<22:29, 39.70s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:59<19:03, 34.66s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:38<19:16, 36.14s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:18<19:12, 37.17s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:57<18:57, 37.93s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:37<18:35, 38.45s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:17<18:10, 38.96s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:57<17:37, 39.18s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:36<17:00, 39.26s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:16<16:25, 39.40s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:55<15:45, 39.40s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:35<15:07, 39.44s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:14<14:27, 39.43s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:54<13:47, 39.41s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:33<13:08, 39.42s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:46<09:55, 31.32s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:26<10:10, 33.94s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:06<10:07, 35.74s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:45<09:49, 36.86s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:25<09:24, 37.65s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [23:05<08:56, 38.35s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:44<08:24, 38.78s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [24:24<07:47, 39.00s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [25:04<07:11, 39.26s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [25:43<06:33, 39.36s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [26:22<05:53, 39.31s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:39<04:19, 32.46s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [27:18<04:02, 34.58s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [27:32<02:50, 28.35s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:12<02:38, 31.74s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [28:52<02:16, 34.20s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [29:32<01:47, 35.97s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [30:12<01:14, 37.14s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [30:52<00:38, 38.15s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:32<00:00, 38.67s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:32<00:00, 37.85s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.9327} | avg. gen lenth: 293.264
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o18-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 18
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[2023-08-22 04:22:07,450] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o18-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 18
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o18-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 25/9741 [00:00<00:39, 248.50it/s]  1%|▎                                                     | 50/9741 [00:00<00:38, 249.31it/s]  1%|▍                                                     | 75/9741 [00:00<00:38, 249.53it/s]  1%|▌                                                    | 100/9741 [00:00<00:38, 249.57it/s]  1%|▋                                                    | 125/9741 [00:00<00:38, 249.55it/s]  2%|▊                                                    | 151/9741 [00:00<00:38, 249.80it/s]  2%|▉                                                    | 176/9741 [00:00<00:38, 246.37it/s]  2%|█                                                    | 201/9741 [00:00<00:38, 244.96it/s]  2%|█▏                                                   | 226/9741 [00:00<00:38, 246.18it/s]  3%|█▎                                                   | 251/9741 [00:01<00:38, 247.07it/s]  3%|█▌                                                   | 276/9741 [00:01<00:38, 247.81it/s]  3%|█▋                                                   | 302/9741 [00:01<00:37, 248.53it/s]  3%|█▊                                                   | 327/9741 [00:01<00:37, 248.77it/s]  4%|█▉                                                   | 352/9741 [00:01<00:37, 248.92it/s]  4%|██                                                   | 377/9741 [00:01<00:37, 249.10it/s]  4%|██▏                                                  | 402/9741 [00:01<00:37, 249.25it/s]  4%|██▎                                                  | 427/9741 [00:01<00:38, 243.38it/s]  5%|██▍                                                  | 452/9741 [00:01<00:38, 244.10it/s]  5%|██▌                                                  | 477/9741 [00:01<00:37, 245.45it/s]  5%|██▋                                                  | 502/9741 [00:02<00:37, 246.59it/s]  5%|██▊                                                  | 527/9741 [00:02<00:37, 247.26it/s]  6%|███                                                  | 552/9741 [00:02<00:37, 247.81it/s]  6%|███▏                                                 | 577/9741 [00:02<00:36, 247.94it/s]  6%|███▎                                                 | 604/9741 [00:02<00:36, 253.74it/s]  7%|███▍                                                 | 642/9741 [00:02<00:31, 291.03it/s]  7%|███▋                                                 | 680/9741 [00:02<00:28, 315.42it/s]  7%|███▉                                                 | 718/9741 [00:02<00:26, 334.31it/s]  8%|████                                                 | 756/9741 [00:02<00:25, 347.61it/s]  8%|████▎                                                | 794/9741 [00:02<00:25, 356.99it/s]  9%|████▌                                                | 832/9741 [00:03<00:24, 362.11it/s]  9%|████▋                                                | 870/9741 [00:03<00:24, 367.11it/s]  9%|████▉                                                | 907/9741 [00:03<00:24, 367.93it/s] 10%|█████▏                                               | 945/9741 [00:03<00:23, 370.90it/s] 10%|█████▎                                               | 983/9741 [00:03<00:23, 372.85it/s] 10%|█████▍                                              | 1021/9741 [00:03<00:23, 374.31it/s] 11%|█████▋                                              | 1059/9741 [00:03<00:23, 375.28it/s] 11%|█████▊                                              | 1097/9741 [00:03<00:22, 376.33it/s] 12%|██████                                              | 1135/9741 [00:03<00:22, 374.56it/s] 12%|██████▎                                             | 1173/9741 [00:03<00:22, 374.95it/s] 12%|██████▍                                             | 1211/9741 [00:04<00:22, 375.49it/s] 13%|██████▋                                             | 1249/9741 [00:04<00:22, 375.77it/s] 13%|██████▊                                             | 1287/9741 [00:04<00:22, 375.30it/s] 14%|███████                                             | 1325/9741 [00:04<00:22, 375.82it/s] 14%|███████▎                                            | 1363/9741 [00:04<00:22, 373.83it/s] 14%|███████▍                                            | 1401/9741 [00:04<00:22, 373.98it/s] 15%|███████▋                                            | 1439/9741 [00:04<00:22, 374.41it/s] 15%|███████▉                                            | 1477/9741 [00:04<00:22, 375.18it/s] 16%|████████                                            | 1515/9741 [00:04<00:21, 375.26it/s] 16%|████████▎                                           | 1553/9741 [00:04<00:21, 376.00it/s] 16%|████████▍                                           | 1591/9741 [00:05<00:21, 373.90it/s] 17%|████████▋                                           | 1629/9741 [00:05<00:21, 374.41it/s] 17%|████████▉                                           | 1667/9741 [00:05<00:21, 374.89it/s] 18%|█████████                                           | 1705/9741 [00:05<00:21, 375.15it/s] 18%|█████████▎                                          | 1743/9741 [00:05<00:21, 375.31it/s] 18%|█████████▌                                          | 1781/9741 [00:05<00:21, 362.20it/s] 19%|█████████▋                                          | 1818/9741 [00:05<00:22, 345.95it/s] 19%|█████████▉                                          | 1856/9741 [00:05<00:22, 354.16it/s] 19%|██████████                                          | 1894/9741 [00:05<00:21, 360.53it/s] 20%|██████████▎                                         | 1932/9741 [00:05<00:21, 364.90it/s] 20%|██████████▌                                         | 1970/9741 [00:06<00:21, 367.90it/s] 21%|██████████▋                                         | 2008/9741 [00:06<00:20, 370.25it/s] 21%|██████████▉                                         | 2046/9741 [00:06<00:20, 368.41it/s] 21%|███████████                                         | 2084/9741 [00:06<00:20, 369.72it/s] 22%|███████████▎                                        | 2122/9741 [00:06<00:20, 371.36it/s] 22%|███████████▌                                        | 2160/9741 [00:06<00:20, 372.75it/s] 23%|███████████▋                                        | 2198/9741 [00:06<00:20, 373.75it/s] 23%|███████████▉                                        | 2236/9741 [00:06<00:20, 374.44it/s] 23%|████████████▏                                       | 2274/9741 [00:06<00:20, 372.68it/s] 24%|████████████▎                                       | 2312/9741 [00:07<00:20, 370.20it/s] 24%|████████████▌                                       | 2350/9741 [00:07<00:19, 371.66it/s] 25%|████████████▋                                       | 2388/9741 [00:07<00:19, 373.08it/s] 25%|████████████▉                                       | 2426/9741 [00:07<00:19, 374.35it/s] 25%|█████████████▏                                      | 2464/9741 [00:07<00:19, 374.92it/s] 26%|█████████████▎                                      | 2502/9741 [00:07<00:19, 372.86it/s] 26%|█████████████▌                                      | 2540/9741 [00:07<00:19, 373.66it/s] 26%|█████████████▊                                      | 2578/9741 [00:07<00:19, 374.64it/s] 27%|█████████████▉                                      | 2616/9741 [00:07<00:18, 375.35it/s] 27%|██████████████▏                                     | 2654/9741 [00:07<00:18, 375.60it/s] 28%|██████████████▎                                     | 2692/9741 [00:08<00:18, 375.32it/s] 28%|██████████████▌                                     | 2730/9741 [00:08<00:18, 373.31it/s] 28%|██████████████▊                                     | 2768/9741 [00:08<00:18, 370.84it/s] 29%|██████████████▉                                     | 2806/9741 [00:08<00:18, 370.83it/s] 29%|███████████████▏                                    | 2844/9741 [00:08<00:18, 372.05it/s] 30%|███████████████▍                                    | 2882/9741 [00:08<00:18, 373.46it/s] 30%|███████████████▌                                    | 2920/9741 [00:08<00:18, 373.94it/s] 30%|███████████████▊                                    | 2958/9741 [00:08<00:18, 371.72it/s] 31%|███████████████▉                                    | 2996/9741 [00:08<00:18, 373.06it/s] 31%|████████████████▏                                   | 3034/9741 [00:08<00:17, 373.41it/s] 32%|████████████████▍                                   | 3072/9741 [00:09<00:17, 373.46it/s] 32%|████████████████▌                                   | 3110/9741 [00:09<00:17, 374.12it/s] 32%|████████████████▊                                   | 3148/9741 [00:09<00:17, 374.53it/s] 33%|█████████████████                                   | 3186/9741 [00:09<00:17, 373.07it/s] 33%|█████████████████▏                                  | 3224/9741 [00:09<00:17, 373.90it/s] 33%|█████████████████▍                                  | 3262/9741 [00:09<00:17, 371.92it/s] 34%|█████████████████▌                                  | 3300/9741 [00:09<00:17, 372.79it/s] 34%|█████████████████▊                                  | 3338/9741 [00:09<00:17, 373.07it/s] 35%|██████████████████                                  | 3376/9741 [00:09<00:17, 373.86it/s] 35%|██████████████████▏                                 | 3414/9741 [00:09<00:17, 371.49it/s] 35%|██████████████████▍                                 | 3452/9741 [00:10<00:16, 372.14it/s] 36%|██████████████████▋                                 | 3490/9741 [00:10<00:16, 372.86it/s] 36%|██████████████████▊                                 | 3528/9741 [00:10<00:16, 372.04it/s] 37%|███████████████████                                 | 3566/9741 [00:10<00:16, 372.88it/s] 37%|███████████████████▏                                | 3604/9741 [00:10<00:16, 371.39it/s] 37%|███████████████████▍                                | 3642/9741 [00:10<00:16, 372.70it/s] 38%|███████████████████▋                                | 3680/9741 [00:10<00:16, 373.44it/s] 38%|███████████████████▊                                | 3718/9741 [00:10<00:16, 374.07it/s] 39%|████████████████████                                | 3756/9741 [00:10<00:15, 374.59it/s] 39%|████████████████████▎                               | 3794/9741 [00:10<00:15, 374.77it/s] 39%|████████████████████▍                               | 3832/9741 [00:11<00:15, 372.97it/s] 40%|████████████████████▋                               | 3870/9741 [00:11<00:15, 373.86it/s] 40%|████████████████████▊                               | 3908/9741 [00:11<00:15, 374.54it/s] 41%|█████████████████████                               | 3946/9741 [00:11<00:15, 374.81it/s] 41%|█████████████████████▎                              | 3984/9741 [00:11<00:15, 374.67it/s] 41%|█████████████████████▍                              | 4022/9741 [00:11<00:15, 374.56it/s] 42%|█████████████████████▋                              | 4060/9741 [00:11<00:15, 372.55it/s] 42%|█████████████████████▉                              | 4098/9741 [00:11<00:15, 373.19it/s] 42%|██████████████████████                              | 4136/9741 [00:11<00:15, 373.58it/s] 43%|██████████████████████▎                             | 4174/9741 [00:12<00:14, 373.26it/s] 43%|██████████████████████▍                             | 4212/9741 [00:12<00:14, 373.34it/s] 44%|██████████████████████▋                             | 4250/9741 [00:12<00:14, 371.19it/s] 44%|██████████████████████▉                             | 4288/9741 [00:12<00:14, 369.19it/s] 44%|███████████████████████                             | 4326/9741 [00:12<00:14, 370.81it/s] 45%|███████████████████████▎                            | 4364/9741 [00:12<00:14, 372.02it/s] 45%|███████████████████████▍                            | 4402/9741 [00:12<00:14, 373.01it/s] 46%|███████████████████████▋                            | 4440/9741 [00:12<00:14, 373.06it/s] 46%|███████████████████████▉                            | 4478/9741 [00:12<00:14, 373.88it/s] 46%|████████████████████████                            | 4516/9741 [00:12<00:15, 336.89it/s] 47%|████████████████████████▎                           | 4554/9741 [00:13<00:14, 347.39it/s] 47%|████████████████████████▌                           | 4592/9741 [00:13<00:14, 354.95it/s] 48%|████████████████████████▋                           | 4630/9741 [00:13<00:14, 360.93it/s] 48%|████████████████████████▉                           | 4668/9741 [00:13<00:13, 364.55it/s] 48%|█████████████████████████                           | 4706/9741 [00:13<00:13, 367.25it/s] 49%|█████████████████████████▎                          | 4743/9741 [00:13<00:18, 265.84it/s] 49%|█████████████████████████▌                          | 4781/9741 [00:13<00:17, 290.78it/s] 49%|█████████████████████████▋                          | 4818/9741 [00:13<00:15, 309.24it/s] 50%|█████████████████████████▉                          | 4856/9741 [00:14<00:14, 326.04it/s] 50%|██████████████████████████▏                         | 4894/9741 [00:14<00:14, 339.02it/s] 51%|██████████████████████████▎                         | 4932/9741 [00:14<00:13, 348.88it/s] 51%|██████████████████████████▌                         | 4969/9741 [00:14<00:13, 353.41it/s] 51%|██████████████████████████▋                         | 5007/9741 [00:14<00:13, 359.66it/s] 52%|██████████████████████████▉                         | 5045/9741 [00:14<00:12, 363.88it/s] 52%|███████████████████████████▏                        | 5083/9741 [00:14<00:12, 366.93it/s] 53%|███████████████████████████▎                        | 5121/9741 [00:14<00:12, 369.40it/s] 53%|███████████████████████████▌                        | 5159/9741 [00:14<00:12, 370.69it/s] 53%|███████████████████████████▋                        | 5197/9741 [00:14<00:12, 368.88it/s] 54%|███████████████████████████▉                        | 5235/9741 [00:15<00:12, 370.27it/s] 54%|████████████████████████████▏                       | 5273/9741 [00:15<00:12, 370.94it/s] 55%|████████████████████████████▎                       | 5311/9741 [00:15<00:11, 372.23it/s] 55%|████████████████████████████▌                       | 5349/9741 [00:15<00:11, 372.39it/s] 55%|████████████████████████████▊                       | 5387/9741 [00:15<00:11, 372.93it/s] 56%|████████████████████████████▉                       | 5425/9741 [00:15<00:11, 371.21it/s] 56%|█████████████████████████████▏                      | 5463/9741 [00:15<00:11, 372.29it/s] 56%|█████████████████████████████▎                      | 5502/9741 [00:15<00:11, 375.63it/s] 57%|█████████████████████████████▌                      | 5541/9741 [00:15<00:11, 378.62it/s] 57%|█████████████████████████████▊                      | 5580/9741 [00:15<00:10, 379.78it/s] 58%|█████████████████████████████▉                      | 5619/9741 [00:16<00:10, 381.24it/s] 58%|██████████████████████████████▏                     | 5658/9741 [00:16<00:10, 380.73it/s] 58%|██████████████████████████████▍                     | 5697/9741 [00:16<00:10, 382.74it/s] 59%|██████████████████████████████▌                     | 5736/9741 [00:16<00:10, 383.21it/s] 59%|██████████████████████████████▊                     | 5775/9741 [00:16<00:10, 384.37it/s] 60%|███████████████████████████████                     | 5814/9741 [00:16<00:10, 385.20it/s] 60%|███████████████████████████████▏                    | 5853/9741 [00:16<00:10, 383.39it/s] 60%|███████████████████████████████▍                    | 5892/9741 [00:16<00:10, 383.81it/s] 61%|███████████████████████████████▋                    | 5931/9741 [00:16<00:09, 384.64it/s] 61%|███████████████████████████████▊                    | 5970/9741 [00:16<00:09, 385.14it/s] 62%|████████████████████████████████                    | 6009/9741 [00:17<00:09, 385.45it/s] 62%|████████████████████████████████▎                   | 6048/9741 [00:17<00:09, 386.09it/s] 62%|████████████████████████████████▍                   | 6087/9741 [00:17<00:09, 383.95it/s] 63%|████████████████████████████████▋                   | 6126/9741 [00:17<00:09, 384.46it/s] 63%|████████████████████████████████▉                   | 6165/9741 [00:17<00:09, 385.27it/s] 64%|█████████████████████████████████                   | 6204/9741 [00:17<00:09, 385.38it/s] 64%|█████████████████████████████████▎                  | 6243/9741 [00:17<00:09, 385.24it/s] 64%|█████████████████████████████████▌                  | 6282/9741 [00:17<00:08, 385.66it/s] 65%|█████████████████████████████████▋                  | 6321/9741 [00:17<00:08, 383.77it/s] 65%|█████████████████████████████████▉                  | 6360/9741 [00:17<00:08, 384.45it/s] 66%|██████████████████████████████████▏                 | 6399/9741 [00:18<00:08, 384.86it/s] 66%|██████████████████████████████████▎                 | 6438/9741 [00:18<00:08, 385.57it/s] 66%|██████████████████████████████████▌                 | 6477/9741 [00:18<00:08, 385.26it/s] 67%|██████████████████████████████████▊                 | 6516/9741 [00:18<00:08, 385.18it/s] 67%|██████████████████████████████████▉                 | 6555/9741 [00:18<00:08, 383.40it/s] 68%|███████████████████████████████████▏                | 6594/9741 [00:18<00:08, 384.22it/s] 68%|███████████████████████████████████▍                | 6633/9741 [00:18<00:08, 385.06it/s] 68%|███████████████████████████████████▌                | 6672/9741 [00:18<00:07, 385.34it/s] 69%|███████████████████████████████████▊                | 6711/9741 [00:18<00:07, 385.50it/s] 69%|████████████████████████████████████                | 6750/9741 [00:18<00:07, 385.56it/s] 70%|████████████████████████████████████▏               | 6789/9741 [00:19<00:07, 383.41it/s] 70%|████████████████████████████████████▍               | 6828/9741 [00:19<00:07, 383.93it/s] 70%|████████████████████████████████████▋               | 6867/9741 [00:19<00:07, 384.74it/s] 71%|████████████████████████████████████▊               | 6906/9741 [00:19<00:07, 385.12it/s] 71%|█████████████████████████████████████               | 6945/9741 [00:19<00:07, 385.32it/s] 72%|█████████████████████████████████████▎              | 6984/9741 [00:19<00:07, 385.79it/s] 72%|█████████████████████████████████████▍              | 7023/9741 [00:19<00:07, 383.66it/s] 72%|█████████████████████████████████████▋              | 7062/9741 [00:19<00:06, 384.59it/s] 73%|█████████████████████████████████████▉              | 7101/9741 [00:19<00:06, 385.31it/s] 73%|██████████████████████████████████████              | 7140/9741 [00:19<00:06, 385.48it/s] 74%|██████████████████████████████████████▎             | 7179/9741 [00:20<00:06, 385.04it/s] 74%|██████████████████████████████████████▌             | 7218/9741 [00:20<00:06, 382.73it/s] 74%|██████████████████████████████████████▋             | 7257/9741 [00:20<00:06, 383.24it/s] 75%|██████████████████████████████████████▉             | 7296/9741 [00:20<00:06, 382.78it/s] 75%|███████████████████████████████████████▏            | 7335/9741 [00:20<00:06, 383.58it/s] 76%|███████████████████████████████████████▎            | 7374/9741 [00:20<00:06, 384.37it/s] 76%|███████████████████████████████████████▌            | 7413/9741 [00:20<00:06, 384.99it/s] 77%|███████████████████████████████████████▊            | 7452/9741 [00:20<00:06, 359.41it/s] 77%|███████████████████████████████████████▉            | 7491/9741 [00:20<00:06, 367.19it/s] 77%|████████████████████████████████████████▏           | 7530/9741 [00:21<00:05, 372.13it/s] 78%|████████████████████████████████████████▍           | 7569/9741 [00:21<00:05, 376.26it/s] 78%|████████████████████████████████████████▌           | 7608/9741 [00:21<00:05, 379.16it/s] 79%|████████████████████████████████████████▊           | 7647/9741 [00:21<00:05, 380.61it/s] 79%|█████████████████████████████████████████           | 7686/9741 [00:21<00:05, 379.75it/s] 79%|█████████████████████████████████████████▏          | 7725/9741 [00:21<00:05, 381.31it/s] 80%|█████████████████████████████████████████▍          | 7764/9741 [00:21<00:05, 382.70it/s] 80%|█████████████████████████████████████████▋          | 7803/9741 [00:21<00:05, 383.65it/s] 81%|█████████████████████████████████████████▊          | 7842/9741 [00:21<00:04, 384.53it/s] 81%|██████████████████████████████████████████          | 7881/9741 [00:21<00:04, 384.86it/s] 81%|██████████████████████████████████████████▎         | 7920/9741 [00:22<00:04, 383.56it/s] 82%|██████████████████████████████████████████▍         | 7959/9741 [00:22<00:04, 384.48it/s] 82%|██████████████████████████████████████████▋         | 7998/9741 [00:22<00:04, 384.65it/s] 83%|██████████████████████████████████████████▉         | 8037/9741 [00:22<00:04, 385.04it/s] 83%|███████████████████████████████████████████         | 8076/9741 [00:22<00:04, 384.69it/s] 83%|███████████████████████████████████████████▎        | 8115/9741 [00:22<00:04, 385.24it/s] 84%|███████████████████████████████████████████▌        | 8154/9741 [00:22<00:04, 383.24it/s] 84%|███████████████████████████████████████████▋        | 8193/9741 [00:22<00:04, 383.72it/s] 85%|███████████████████████████████████████████▉        | 8232/9741 [00:22<00:03, 384.08it/s] 85%|████████████████████████████████████████████▏       | 8271/9741 [00:22<00:03, 384.44it/s] 85%|████████████████████████████████████████████▎       | 8310/9741 [00:23<00:03, 384.62it/s] 86%|████████████████████████████████████████████▌       | 8349/9741 [00:23<00:03, 383.24it/s] 86%|████████████████████████████████████████████▊       | 8388/9741 [00:23<00:03, 384.10it/s] 87%|████████████████████████████████████████████▉       | 8427/9741 [00:23<00:03, 385.01it/s] 87%|█████████████████████████████████████████████▏      | 8466/9741 [00:23<00:03, 385.43it/s] 87%|█████████████████████████████████████████████▍      | 8505/9741 [00:23<00:03, 385.62it/s] 88%|█████████████████████████████████████████████▌      | 8544/9741 [00:23<00:03, 385.44it/s] 88%|█████████████████████████████████████████████▊      | 8583/9741 [00:23<00:03, 383.48it/s] 89%|██████████████████████████████████████████████      | 8622/9741 [00:23<00:02, 383.98it/s] 89%|██████████████████████████████████████████████▏     | 8661/9741 [00:23<00:02, 384.54it/s] 89%|██████████████████████████████████████████████▍     | 8700/9741 [00:24<00:02, 383.85it/s] 90%|██████████████████████████████████████████████▋     | 8739/9741 [00:24<00:02, 384.20it/s] 90%|██████████████████████████████████████████████▊     | 8778/9741 [00:24<00:02, 384.62it/s] 91%|███████████████████████████████████████████████     | 8817/9741 [00:24<00:02, 381.28it/s] 91%|███████████████████████████████████████████████▎    | 8856/9741 [00:24<00:02, 382.32it/s] 91%|███████████████████████████████████████████████▍    | 8895/9741 [00:24<00:02, 383.05it/s] 92%|███████████████████████████████████████████████▋    | 8934/9741 [00:24<00:02, 383.81it/s] 92%|███████████████████████████████████████████████▉    | 8973/9741 [00:24<00:01, 384.55it/s] 93%|████████████████████████████████████████████████    | 9012/9741 [00:24<00:01, 385.02it/s] 93%|████████████████████████████████████████████████▎   | 9051/9741 [00:24<00:01, 382.95it/s] 93%|████████████████████████████████████████████████▌   | 9090/9741 [00:25<00:01, 383.73it/s] 94%|████████████████████████████████████████████████▋   | 9129/9741 [00:25<00:01, 384.55it/s] 94%|████████████████████████████████████████████████▉   | 9168/9741 [00:25<00:01, 384.86it/s] 95%|█████████████████████████████████████████████████▏  | 9207/9741 [00:25<00:01, 385.16it/s] 95%|█████████████████████████████████████████████████▎  | 9246/9741 [00:25<00:01, 385.15it/s] 95%|█████████████████████████████████████████████████▌  | 9285/9741 [00:25<00:01, 383.14it/s] 96%|█████████████████████████████████████████████████▊  | 9324/9741 [00:25<00:01, 383.54it/s] 96%|█████████████████████████████████████████████████▉  | 9363/9741 [00:25<00:00, 382.79it/s] 97%|██████████████████████████████████████████████████▏ | 9402/9741 [00:25<00:00, 383.49it/s] 97%|██████████████████████████████████████████████████▍ | 9441/9741 [00:26<00:00, 383.95it/s] 97%|██████████████████████████████████████████████████▌ | 9480/9741 [00:26<00:00, 384.61it/s] 98%|██████████████████████████████████████████████████▊ | 9519/9741 [00:26<00:00, 382.76it/s] 98%|███████████████████████████████████████████████████ | 9558/9741 [00:26<00:00, 383.62it/s] 99%|███████████████████████████████████████████████████▏| 9597/9741 [00:26<00:00, 383.04it/s] 99%|███████████████████████████████████████████████████▍| 9636/9741 [00:26<00:00, 383.46it/s] 99%|███████████████████████████████████████████████████▋| 9675/9741 [00:26<00:00, 383.74it/s]100%|███████████████████████████████████████████████████▊| 9714/9741 [00:26<00:00, 380.58it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:26<00:00, 363.58it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.35s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.65s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.69s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.73s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.23s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.61s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.66s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.61s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.65s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.92s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.12s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.98s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.16s/it]
[2023-08-22 04:23:27,460] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.95s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.14s/it]
[2023-08-22 04:23:37,696] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 04:23:37,698] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 04:23:37,698] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 04:23:37,698] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 04:23:37,698] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 04:23:37,698] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fc29ec9cfd0>
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 04:23:37,699] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fc29e92b220>
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 04:23:37,700] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 04:23:37,701] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 04:23:37,701] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5667030811309814 seconds
Loading extension module utils...
Time to load utils op: 0.6048262119293213 seconds
Loading extension module utils...
Time to load utils op: 0.5048732757568359 seconds
Loading extension module utils...
Time to load utils op: 0.5049147605895996 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input: Sam, Sid, and Steve brought popsicle sticks for their group activity in their Art class. Sam has thrice as many as Sid, and Sid has twice as many as Steve. If Steve has 12 popsicle sticks, how many popsicle sticks can they use for their Art class activity?
Output: 108

Input: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.
Output: 720

Input: John uses a 75-watt electric fan for 8 hours a day. How much kWh of electric energy does he consume per month (30 days) for using the electric fan?
Output: 18

Input: Barbara Blackburn can type 212 words per minute.  Due to Carpal tunnel syndrome, Barbara cannot use her left hand for a while so her typing speed is now 40 words less per minute. If she is supposed to type a document with 3440 words, how many minutes will it take her to finish typing the document?
Output: 20

Input: Max fills up water balloons for 30 minutes at a rate of 2 water balloons every minute. Max’s friend Zach fills up water balloons for 40 minutes at a rate of 3 water balloons every minute. In the process, 10 of the water balloons pop on the ground. How many filled water balloons do Max and Zach have in total?
Output: 170

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o18-tgsm8k-s20-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:39<32:32, 39.85s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:18<31:32, 39.42s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:58<30:49, 39.34s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:37<30:14, 39.45s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:17<29:32, 39.38s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:56<28:46, 39.24s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:28<26:26, 36.89s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:07<26:21, 37.66s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:46<26:07, 38.22s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:26<25:41, 38.55s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:05<25:14, 38.83s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:44<24:34, 38.82s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:23<24:00, 38.95s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [08:49<21:02, 35.08s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:29<21:13, 36.38s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:08<21:04, 37.20s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:47<20:47, 37.81s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:09<17:34, 32.94s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [11:48<17:58, 34.79s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:27<18:01, 36.06s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:06<17:52, 36.97s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [13:45<17:36, 37.73s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:24<17:09, 38.15s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:03<16:38, 38.41s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [15:43<16:05, 38.62s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:22<15:31, 38.80s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:02<14:59, 39.12s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [17:41<14:20, 39.13s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:06<12:11, 34.85s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [18:45<12:03, 36.15s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:24<11:45, 37.14s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:04<11:22, 37.89s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [20:43<10:51, 38.32s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:22<10:17, 38.56s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:02<09:42, 38.82s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [22:41<09:03, 38.81s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:20<08:28, 39.10s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [24:00<07:49, 39.14s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [24:39<07:11, 39.19s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [25:18<06:31, 39.16s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [25:57<05:51, 39.08s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:36<05:12, 39.11s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [27:16<04:34, 39.20s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [27:55<03:55, 39.25s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:34<03:16, 39.22s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [29:14<02:37, 39.34s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [29:51<01:56, 38.87s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [30:31<01:18, 39.08s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [31:10<00:39, 39.15s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:29<00:00, 33.01s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:29<00:00, 37.79s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.0454} | avg. gen lenth: 285.936
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o19-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 19
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 04:55:16,079] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o19-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 19
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o19-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 24/9741 [00:00<00:41, 235.78it/s]  0%|▎                                                     | 48/9741 [00:00<00:40, 236.71it/s]  1%|▍                                                     | 72/9741 [00:00<00:40, 237.18it/s]  1%|▌                                                     | 96/9741 [00:00<00:40, 237.53it/s]  1%|▋                                                    | 120/9741 [00:00<00:40, 237.81it/s]  1%|▊                                                    | 144/9741 [00:00<00:40, 237.73it/s]  2%|▉                                                    | 168/9741 [00:00<00:40, 233.87it/s]  2%|█                                                    | 192/9741 [00:00<00:40, 234.05it/s]  2%|█▏                                                   | 216/9741 [00:00<00:40, 233.11it/s]  2%|█▎                                                   | 240/9741 [00:01<00:40, 234.48it/s]  3%|█▍                                                   | 264/9741 [00:01<00:40, 235.33it/s]  3%|█▌                                                   | 288/9741 [00:01<00:40, 235.97it/s]  3%|█▋                                                   | 312/9741 [00:01<00:39, 236.60it/s]  3%|█▊                                                   | 336/9741 [00:01<00:39, 236.57it/s]  4%|█▉                                                   | 360/9741 [00:01<00:39, 236.81it/s]  4%|██                                                   | 384/9741 [00:01<00:39, 237.05it/s]  4%|██▏                                                  | 408/9741 [00:01<00:39, 234.50it/s]  4%|██▎                                                  | 432/9741 [00:01<00:40, 231.76it/s]  5%|██▍                                                  | 456/9741 [00:01<00:39, 233.49it/s]  5%|██▌                                                  | 482/9741 [00:02<00:38, 239.86it/s]  5%|██▊                                                  | 518/9741 [00:02<00:33, 275.24it/s]  6%|███                                                  | 554/9741 [00:02<00:30, 300.32it/s]  6%|███▏                                                 | 590/9741 [00:02<00:28, 317.71it/s]  6%|███▍                                                 | 626/9741 [00:02<00:27, 329.87it/s]  7%|███▌                                                 | 662/9741 [00:02<00:26, 337.00it/s]  7%|███▊                                                 | 699/9741 [00:02<00:26, 344.16it/s]  8%|███▉                                                 | 735/9741 [00:02<00:25, 348.73it/s]  8%|████▏                                                | 772/9741 [00:02<00:25, 352.28it/s]  8%|████▍                                                | 809/9741 [00:02<00:25, 354.78it/s]  9%|████▌                                                | 845/9741 [00:03<00:24, 355.94it/s]  9%|████▊                                                | 881/9741 [00:03<00:24, 354.95it/s]  9%|████▉                                                | 917/9741 [00:03<00:24, 356.41it/s] 10%|█████▏                                               | 953/9741 [00:03<00:24, 357.01it/s] 10%|█████▍                                               | 989/9741 [00:03<00:24, 356.86it/s] 11%|█████▍                                              | 1025/9741 [00:03<00:24, 357.71it/s] 11%|█████▋                                              | 1061/9741 [00:03<00:24, 358.10it/s] 11%|█████▊                                              | 1097/9741 [00:03<00:24, 358.52it/s] 12%|██████                                              | 1133/9741 [00:03<00:24, 356.71it/s] 12%|██████▏                                             | 1169/9741 [00:03<00:23, 357.34it/s] 12%|██████▍                                             | 1205/9741 [00:04<00:23, 357.87it/s] 13%|██████▌                                             | 1241/9741 [00:04<00:23, 358.06it/s] 13%|██████▊                                             | 1277/9741 [00:04<00:23, 356.97it/s] 13%|███████                                             | 1313/9741 [00:04<00:23, 357.66it/s] 14%|███████▏                                            | 1349/9741 [00:04<00:23, 356.08it/s] 14%|███████▍                                            | 1385/9741 [00:04<00:23, 356.26it/s] 15%|███████▌                                            | 1421/9741 [00:04<00:23, 356.94it/s] 15%|███████▊                                            | 1457/9741 [00:04<00:23, 357.22it/s] 15%|███████▉                                            | 1493/9741 [00:04<00:23, 357.36it/s] 16%|████████▏                                           | 1529/9741 [00:04<00:22, 357.37it/s] 16%|████████▎                                           | 1565/9741 [00:05<00:22, 355.90it/s] 16%|████████▌                                           | 1601/9741 [00:05<00:22, 356.50it/s] 17%|████████▋                                           | 1637/9741 [00:05<00:22, 357.19it/s] 17%|████████▉                                           | 1673/9741 [00:05<00:22, 357.42it/s] 18%|█████████                                           | 1709/9741 [00:05<00:22, 356.96it/s] 18%|█████████▎                                          | 1745/9741 [00:05<00:22, 354.10it/s] 18%|█████████▌                                          | 1781/9741 [00:05<00:22, 355.29it/s] 19%|█████████▋                                          | 1817/9741 [00:05<00:23, 333.76it/s] 19%|█████████▉                                          | 1853/9741 [00:05<00:23, 340.42it/s] 19%|██████████                                          | 1889/9741 [00:05<00:22, 345.21it/s] 20%|██████████▎                                         | 1925/9741 [00:06<00:22, 348.75it/s] 20%|██████████▍                                         | 1961/9741 [00:06<00:22, 351.23it/s] 21%|██████████▋                                         | 1997/9741 [00:06<00:21, 353.34it/s] 21%|██████████▊                                         | 2033/9741 [00:06<00:21, 352.57it/s] 21%|███████████                                         | 2069/9741 [00:06<00:21, 354.18it/s] 22%|███████████▏                                        | 2105/9741 [00:06<00:21, 354.97it/s] 22%|███████████▍                                        | 2141/9741 [00:06<00:21, 355.88it/s] 22%|███████████▌                                        | 2177/9741 [00:06<00:21, 356.36it/s] 23%|███████████▊                                        | 2213/9741 [00:06<00:21, 353.80it/s] 23%|████████████                                        | 2249/9741 [00:07<00:21, 351.05it/s] 23%|████████████▏                                       | 2285/9741 [00:07<00:21, 353.16it/s] 24%|████████████▍                                       | 2321/9741 [00:07<00:20, 354.26it/s] 24%|████████████▌                                       | 2357/9741 [00:07<00:20, 355.47it/s] 25%|████████████▊                                       | 2393/9741 [00:07<00:20, 355.42it/s] 25%|████████████▉                                       | 2429/9741 [00:07<00:20, 356.41it/s] 25%|█████████████▏                                      | 2465/9741 [00:07<00:20, 357.00it/s] 26%|█████████████▎                                      | 2501/9741 [00:07<00:20, 354.78it/s] 26%|█████████████▌                                      | 2537/9741 [00:07<00:20, 355.52it/s] 26%|█████████████▋                                      | 2573/9741 [00:07<00:20, 356.26it/s] 27%|█████████████▉                                      | 2609/9741 [00:08<00:19, 357.11it/s] 27%|██████████████                                      | 2645/9741 [00:08<00:19, 357.12it/s] 28%|██████████████▎                                     | 2681/9741 [00:08<00:19, 355.15it/s] 28%|██████████████▌                                     | 2717/9741 [00:08<00:19, 353.49it/s] 28%|██████████████▋                                     | 2753/9741 [00:08<00:19, 354.48it/s] 29%|██████████████▉                                     | 2789/9741 [00:08<00:19, 355.17it/s] 29%|███████████████                                     | 2825/9741 [00:08<00:19, 355.78it/s] 29%|███████████████▎                                    | 2861/9741 [00:08<00:19, 356.82it/s] 30%|███████████████▍                                    | 2897/9741 [00:08<00:19, 357.01it/s] 30%|███████████████▋                                    | 2933/9741 [00:08<00:19, 355.30it/s] 30%|███████████████▊                                    | 2969/9741 [00:09<00:19, 356.07it/s] 31%|████████████████                                    | 3005/9741 [00:09<00:18, 356.90it/s] 31%|████████████████▏                                   | 3041/9741 [00:09<00:18, 357.06it/s] 32%|████████████████▍                                   | 3077/9741 [00:09<00:18, 357.03it/s] 32%|████████████████▌                                   | 3113/9741 [00:09<00:18, 356.69it/s] 32%|████████████████▊                                   | 3149/9741 [00:09<00:18, 357.13it/s] 33%|█████████████████                                   | 3185/9741 [00:09<00:18, 355.52it/s] 33%|█████████████████▏                                  | 3221/9741 [00:09<00:18, 356.30it/s] 33%|█████████████████▍                                  | 3257/9741 [00:09<00:18, 357.09it/s] 34%|█████████████████▌                                  | 3293/9741 [00:09<00:18, 357.15it/s] 34%|█████████████████▊                                  | 3329/9741 [00:10<00:17, 356.41it/s] 35%|█████████████████▉                                  | 3365/9741 [00:10<00:17, 357.03it/s] 35%|██████████████████▏                                 | 3401/9741 [00:10<00:17, 355.26it/s] 35%|██████████████████▎                                 | 3437/9741 [00:10<00:17, 356.05it/s] 36%|██████████████████▌                                 | 3473/9741 [00:10<00:17, 356.45it/s] 36%|██████████████████▋                                 | 3509/9741 [00:10<00:17, 356.47it/s] 36%|██████████████████▉                                 | 3545/9741 [00:10<00:17, 357.16it/s] 37%|███████████████████                                 | 3581/9741 [00:10<00:17, 356.92it/s] 37%|███████████████████▎                                | 3617/9741 [00:10<00:17, 355.22it/s] 38%|███████████████████▌                                | 3653/9741 [00:10<00:17, 356.06it/s] 38%|███████████████████▋                                | 3689/9741 [00:11<00:16, 356.40it/s] 38%|███████████████████▉                                | 3725/9741 [00:11<00:16, 356.98it/s] 39%|████████████████████                                | 3761/9741 [00:11<00:16, 357.32it/s] 39%|████████████████████▎                               | 3797/9741 [00:11<00:16, 357.29it/s] 39%|████████████████████▍                               | 3833/9741 [00:11<00:16, 354.85it/s] 40%|████████████████████▋                               | 3869/9741 [00:11<00:16, 355.74it/s] 40%|████████████████████▊                               | 3905/9741 [00:11<00:16, 356.58it/s] 40%|█████████████████████                               | 3941/9741 [00:11<00:16, 356.59it/s] 41%|█████████████████████▏                              | 3977/9741 [00:11<00:16, 356.69it/s] 41%|█████████████████████▍                              | 4013/9741 [00:11<00:16, 357.03it/s] 42%|█████████████████████▌                              | 4049/9741 [00:12<00:15, 356.08it/s] 42%|█████████████████████▊                              | 4085/9741 [00:12<00:15, 354.46it/s] 42%|█████████████████████▉                              | 4121/9741 [00:12<00:15, 355.18it/s] 43%|██████████████████████▏                             | 4157/9741 [00:12<00:15, 355.63it/s] 43%|██████████████████████▍                             | 4193/9741 [00:12<00:15, 356.21it/s] 43%|██████████████████████▌                             | 4229/9741 [00:12<00:15, 356.45it/s] 44%|██████████████████████▊                             | 4265/9741 [00:12<00:15, 356.93it/s] 44%|██████████████████████▉                             | 4301/9741 [00:12<00:15, 355.27it/s] 45%|███████████████████████▏                            | 4337/9741 [00:12<00:15, 356.02it/s] 45%|███████████████████████▎                            | 4373/9741 [00:12<00:15, 356.50it/s] 45%|███████████████████████▌                            | 4409/9741 [00:13<00:14, 356.75it/s] 46%|███████████████████████▋                            | 4445/9741 [00:13<00:14, 356.80it/s] 46%|███████████████████████▉                            | 4481/9741 [00:13<00:14, 354.92it/s] 46%|████████████████████████                            | 4517/9741 [00:13<00:15, 327.58it/s] 47%|████████████████████████▎                           | 4553/9741 [00:13<00:15, 334.98it/s] 47%|████████████████████████▍                           | 4589/9741 [00:13<00:15, 341.32it/s] 47%|████████████████████████▋                           | 4625/9741 [00:13<00:14, 345.78it/s] 48%|████████████████████████▉                           | 4661/9741 [00:13<00:14, 348.74it/s] 48%|█████████████████████████                           | 4697/9741 [00:13<00:14, 351.44it/s] 49%|█████████████████████████▎                          | 4733/9741 [00:14<00:14, 353.30it/s] 49%|█████████████████████████▍                          | 4769/9741 [00:14<00:19, 254.37it/s] 49%|█████████████████████████▋                          | 4805/9741 [00:14<00:17, 278.37it/s] 50%|█████████████████████████▊                          | 4841/9741 [00:14<00:16, 297.61it/s] 50%|██████████████████████████                          | 4877/9741 [00:14<00:15, 312.60it/s] 50%|██████████████████████████▏                         | 4913/9741 [00:14<00:14, 324.50it/s] 51%|██████████████████████████▍                         | 4949/9741 [00:14<00:14, 331.83it/s] 51%|██████████████████████████▌                         | 4985/9741 [00:14<00:14, 339.17it/s] 52%|██████████████████████████▊                         | 5021/9741 [00:14<00:13, 343.66it/s] 52%|██████████████████████████▉                         | 5057/9741 [00:15<00:13, 347.57it/s] 52%|███████████████████████████▏                        | 5093/9741 [00:15<00:13, 350.11it/s] 53%|███████████████████████████▍                        | 5129/9741 [00:15<00:13, 352.15it/s] 53%|███████████████████████████▌                        | 5165/9741 [00:15<00:12, 353.81it/s] 53%|███████████████████████████▊                        | 5201/9741 [00:15<00:12, 352.65it/s] 54%|███████████████████████████▉                        | 5237/9741 [00:15<00:12, 352.77it/s] 54%|████████████████████████████▏                       | 5273/9741 [00:15<00:12, 353.70it/s] 55%|████████████████████████████▎                       | 5309/9741 [00:15<00:12, 354.88it/s] 55%|████████████████████████████▌                       | 5345/9741 [00:15<00:12, 355.13it/s] 55%|████████████████████████████▋                       | 5381/9741 [00:15<00:12, 355.56it/s] 56%|████████████████████████████▉                       | 5417/9741 [00:16<00:12, 353.70it/s] 56%|█████████████████████████████                       | 5453/9741 [00:16<00:12, 354.31it/s] 56%|█████████████████████████████▎                      | 5490/9741 [00:16<00:11, 356.56it/s] 57%|█████████████████████████████▌                      | 5527/9741 [00:16<00:11, 360.08it/s] 57%|█████████████████████████████▋                      | 5564/9741 [00:16<00:11, 362.48it/s] 57%|█████████████████████████████▉                      | 5601/9741 [00:16<00:11, 364.00it/s] 58%|██████████████████████████████                      | 5638/9741 [00:16<00:11, 362.22it/s] 58%|██████████████████████████████▎                     | 5675/9741 [00:16<00:11, 353.26it/s] 59%|██████████████████████████████▍                     | 5712/9741 [00:16<00:11, 357.85it/s] 59%|██████████████████████████████▋                     | 5749/9741 [00:16<00:11, 361.19it/s] 59%|██████████████████████████████▉                     | 5786/9741 [00:17<00:10, 363.51it/s] 60%|███████████████████████████████                     | 5823/9741 [00:17<00:10, 364.83it/s] 60%|███████████████████████████████▎                    | 5860/9741 [00:17<00:10, 363.96it/s] 61%|███████████████████████████████▍                    | 5897/9741 [00:17<00:10, 365.45it/s] 61%|███████████████████████████████▋                    | 5934/9741 [00:17<00:10, 365.82it/s] 61%|███████████████████████████████▊                    | 5971/9741 [00:17<00:10, 367.05it/s] 62%|████████████████████████████████                    | 6008/9741 [00:17<00:10, 367.51it/s] 62%|████████████████████████████████▎                   | 6045/9741 [00:17<00:10, 367.86it/s] 62%|████████████████████████████████▍                   | 6082/9741 [00:17<00:09, 366.29it/s] 63%|████████████████████████████████▋                   | 6119/9741 [00:18<00:09, 366.93it/s] 63%|████████████████████████████████▊                   | 6156/9741 [00:18<00:09, 367.14it/s] 64%|█████████████████████████████████                   | 6193/9741 [00:18<00:09, 367.65it/s] 64%|█████████████████████████████████▎                  | 6230/9741 [00:18<00:09, 367.71it/s] 64%|█████████████████████████████████▍                  | 6267/9741 [00:18<00:09, 364.92it/s] 65%|█████████████████████████████████▋                  | 6304/9741 [00:18<00:09, 365.79it/s] 65%|█████████████████████████████████▊                  | 6341/9741 [00:18<00:09, 364.72it/s] 65%|██████████████████████████████████                  | 6378/9741 [00:18<00:09, 366.07it/s] 66%|██████████████████████████████████▏                 | 6415/9741 [00:18<00:09, 366.86it/s] 66%|██████████████████████████████████▍                 | 6452/9741 [00:18<00:08, 367.52it/s] 67%|██████████████████████████████████▋                 | 6489/9741 [00:19<00:08, 367.83it/s] 67%|██████████████████████████████████▊                 | 6526/9741 [00:19<00:08, 367.93it/s] 67%|███████████████████████████████████                 | 6563/9741 [00:19<00:08, 365.96it/s] 68%|███████████████████████████████████▏                | 6600/9741 [00:19<00:08, 366.62it/s] 68%|███████████████████████████████████▍                | 6637/9741 [00:19<00:08, 367.33it/s] 69%|███████████████████████████████████▋                | 6674/9741 [00:19<00:08, 366.78it/s] 69%|███████████████████████████████████▊                | 6711/9741 [00:19<00:08, 367.08it/s] 69%|████████████████████████████████████                | 6748/9741 [00:19<00:08, 367.72it/s] 70%|████████████████████████████████████▏               | 6785/9741 [00:19<00:08, 366.29it/s] 70%|████████████████████████████████████▍               | 6822/9741 [00:19<00:07, 367.22it/s] 70%|████████████████████████████████████▌               | 6859/9741 [00:20<00:07, 367.73it/s] 71%|████████████████████████████████████▊               | 6896/9741 [00:20<00:07, 365.29it/s] 71%|█████████████████████████████████████               | 6933/9741 [00:20<00:07, 366.12it/s] 72%|█████████████████████████████████████▏              | 6970/9741 [00:20<00:07, 366.48it/s] 72%|█████████████████████████████████████▍              | 7007/9741 [00:20<00:07, 365.11it/s] 72%|█████████████████████████████████████▌              | 7044/9741 [00:20<00:07, 366.21it/s] 73%|█████████████████████████████████████▊              | 7081/9741 [00:20<00:07, 367.01it/s] 73%|█████████████████████████████████████▉              | 7118/9741 [00:20<00:07, 367.60it/s] 73%|██████████████████████████████████████▏             | 7155/9741 [00:20<00:07, 368.08it/s] 74%|██████████████████████████████████████▍             | 7192/9741 [00:20<00:06, 368.20it/s] 74%|██████████████████████████████████████▌             | 7229/9741 [00:21<00:06, 366.13it/s] 75%|██████████████████████████████████████▊             | 7266/9741 [00:21<00:06, 366.72it/s] 75%|██████████████████████████████████████▉             | 7303/9741 [00:21<00:06, 366.95it/s] 75%|███████████████████████████████████████▏            | 7340/9741 [00:21<00:06, 367.19it/s] 76%|███████████████████████████████████████▍            | 7377/9741 [00:21<00:06, 367.76it/s] 76%|███████████████████████████████████████▌            | 7414/9741 [00:21<00:06, 366.55it/s] 76%|███████████████████████████████████████▊            | 7451/9741 [00:21<00:06, 341.53it/s] 77%|███████████████████████████████████████▉            | 7487/9741 [00:21<00:06, 346.22it/s] 77%|████████████████████████████████████████▏           | 7524/9741 [00:21<00:06, 352.07it/s] 78%|████████████████████████████████████████▎           | 7561/9741 [00:21<00:06, 356.84it/s] 78%|████████████████████████████████████████▌           | 7598/9741 [00:22<00:05, 360.10it/s] 78%|████████████████████████████████████████▊           | 7635/9741 [00:22<00:05, 362.28it/s] 79%|████████████████████████████████████████▉           | 7672/9741 [00:22<00:05, 361.79it/s] 79%|█████████████████████████████████████████▏          | 7709/9741 [00:22<00:05, 363.59it/s] 80%|█████████████████████████████████████████▎          | 7746/9741 [00:22<00:05, 364.99it/s] 80%|█████████████████████████████████████████▌          | 7783/9741 [00:22<00:05, 365.97it/s] 80%|█████████████████████████████████████████▋          | 7820/9741 [00:22<00:05, 366.54it/s] 81%|█████████████████████████████████████████▉          | 7857/9741 [00:22<00:05, 367.22it/s] 81%|██████████████████████████████████████████▏         | 7894/9741 [00:22<00:05, 365.61it/s] 81%|██████████████████████████████████████████▎         | 7931/9741 [00:22<00:04, 366.64it/s] 82%|██████████████████████████████████████████▌         | 7968/9741 [00:23<00:04, 367.37it/s] 82%|██████████████████████████████████████████▋         | 8005/9741 [00:23<00:04, 367.62it/s] 83%|██████████████████████████████████████████▉         | 8042/9741 [00:23<00:04, 367.82it/s] 83%|███████████████████████████████████████████▏        | 8079/9741 [00:23<00:04, 367.91it/s] 83%|███████████████████████████████████████████▎        | 8116/9741 [00:23<00:04, 365.82it/s] 84%|███████████████████████████████████████████▌        | 8153/9741 [00:23<00:04, 364.21it/s] 84%|███████████████████████████████████████████▋        | 8190/9741 [00:23<00:04, 365.11it/s] 84%|███████████████████████████████████████████▉        | 8227/9741 [00:23<00:04, 366.01it/s] 85%|████████████████████████████████████████████        | 8264/9741 [00:23<00:04, 366.71it/s] 85%|████████████████████████████████████████████▎       | 8301/9741 [00:23<00:03, 366.65it/s] 86%|████████████████████████████████████████████▌       | 8338/9741 [00:24<00:03, 366.95it/s] 86%|████████████████████████████████████████████▋       | 8375/9741 [00:24<00:03, 365.70it/s] 86%|████████████████████████████████████████████▉       | 8412/9741 [00:24<00:03, 366.24it/s] 87%|█████████████████████████████████████████████       | 8449/9741 [00:24<00:03, 366.90it/s] 87%|█████████████████████████████████████████████▎      | 8486/9741 [00:24<00:03, 367.37it/s] 87%|█████████████████████████████████████████████▍      | 8523/9741 [00:24<00:03, 367.44it/s] 88%|█████████████████████████████████████████████▋      | 8560/9741 [00:24<00:03, 367.43it/s] 88%|█████████████████████████████████████████████▉      | 8597/9741 [00:24<00:03, 365.62it/s] 89%|██████████████████████████████████████████████      | 8634/9741 [00:24<00:03, 366.17it/s] 89%|██████████████████████████████████████████████▎     | 8671/9741 [00:24<00:02, 366.62it/s] 89%|██████████████████████████████████████████████▍     | 8708/9741 [00:25<00:02, 367.06it/s] 90%|██████████████████████████████████████████████▋     | 8745/9741 [00:25<00:02, 364.20it/s] 90%|██████████████████████████████████████████████▉     | 8782/9741 [00:25<00:02, 364.87it/s] 91%|███████████████████████████████████████████████     | 8819/9741 [00:25<00:02, 362.02it/s] 91%|███████████████████████████████████████████████▎    | 8856/9741 [00:25<00:02, 363.68it/s] 91%|███████████████████████████████████████████████▍    | 8893/9741 [00:25<00:02, 364.26it/s] 92%|███████████████████████████████████████████████▋    | 8930/9741 [00:25<00:02, 365.55it/s] 92%|███████████████████████████████████████████████▊    | 8967/9741 [00:25<00:02, 366.02it/s] 92%|████████████████████████████████████████████████    | 9004/9741 [00:25<00:02, 366.38it/s] 93%|████████████████████████████████████████████████▎   | 9041/9741 [00:26<00:01, 365.16it/s] 93%|████████████████████████████████████████████████▍   | 9078/9741 [00:26<00:01, 365.78it/s] 94%|████████████████████████████████████████████████▋   | 9115/9741 [00:26<00:01, 366.37it/s] 94%|████████████████████████████████████████████████▊   | 9152/9741 [00:26<00:01, 366.78it/s] 94%|█████████████████████████████████████████████████   | 9189/9741 [00:26<00:01, 367.15it/s] 95%|█████████████████████████████████████████████████▎  | 9226/9741 [00:26<00:01, 367.01it/s] 95%|█████████████████████████████████████████████████▍  | 9263/9741 [00:26<00:01, 365.31it/s] 95%|█████████████████████████████████████████████████▋  | 9300/9741 [00:26<00:01, 365.95it/s] 96%|█████████████████████████████████████████████████▊  | 9337/9741 [00:26<00:01, 366.62it/s] 96%|██████████████████████████████████████████████████  | 9374/9741 [00:26<00:00, 367.13it/s] 97%|██████████████████████████████████████████████████▏ | 9411/9741 [00:27<00:00, 367.30it/s] 97%|██████████████████████████████████████████████████▍ | 9448/9741 [00:27<00:00, 367.16it/s] 97%|██████████████████████████████████████████████████▋ | 9485/9741 [00:27<00:00, 362.98it/s] 98%|██████████████████████████████████████████████████▊ | 9522/9741 [00:27<00:00, 364.17it/s] 98%|███████████████████████████████████████████████████ | 9559/9741 [00:27<00:00, 365.34it/s] 99%|███████████████████████████████████████████████████▏| 9596/9741 [00:27<00:00, 366.13it/s] 99%|███████████████████████████████████████████████████▍| 9633/9741 [00:27<00:00, 365.64it/s] 99%|███████████████████████████████████████████████████▌| 9670/9741 [00:27<00:00, 366.28it/s]100%|███████████████████████████████████████████████████▊| 9707/9741 [00:27<00:00, 366.32it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:27<00:00, 348.94it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.50s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.07s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.04s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.16s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.41s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.43s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.60s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.44s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.62s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.64s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]
[2023-08-22 04:56:36,165] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.83s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.99s/it]
[2023-08-22 04:56:45,961] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 04:56:45,962] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 04:56:45,963] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 04:56:45,963] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 04:56:45,963] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 04:56:45,963] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 04:56:45,963] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 04:56:45,963] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 04:56:45,963] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 04:56:45,963] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 04:56:45,963] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 04:56:45,963] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f0b59ad3fd0>
[2023-08-22 04:56:45,963] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 04:56:45,963] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f0b59822220>
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 04:56:45,964] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 04:56:45,965] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 04:56:45,965] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5446939468383789 seconds
Loading extension module utils...
Time to load utils op: 0.5046067237854004 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input: Sam, Sid, and Steve brought popsicle sticks for their group activity in their Art class. Sam has thrice as many as Sid, and Sid has twice as many as Steve. If Steve has 12 popsicle sticks, how many popsicle sticks can they use for their Art class activity?
Output: 108

Input: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.
Output: 720

Input: John uses a 75-watt electric fan for 8 hours a day. How much kWh of electric energy does he consume per month (30 days) for using the electric fan?
Output: 18

Input: Barbara Blackburn can type 212 words per minute.  Due to Carpal tunnel syndrome, Barbara cannot use her left hand for a while so her typing speed is now 40 words less per minute. If she is supposed to type a document with 3440 words, how many minutes will it take her to finish typing the document?
Output: 20

Input: Max fills up water balloons for 30 minutes at a rate of 2 water balloons every minute. Max’s friend Zach fills up water balloons for 40 minutes at a rate of 3 water balloons every minute. In the process, 10 of the water balloons pop on the ground. How many filled water balloons do Max and Zach have in total?
Output: 170

Input: John has 54 pieces of gum, Cole has 45 pieces of gum and Aubrey has no pieces of gum. They decide to share the gum equally between the 3 of them. How many pieces of gum will each one get?
Output: 33

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o19-tgsm8k-s20-rFalse
Time to load utils op: 0.5047729015350342 seconds
Loading extension module utils...
Time to load utils op: 0.6046905517578125 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:39<32:27, 39.74s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:18<31:13, 39.03s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:57<30:28, 38.89s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:36<29:53, 38.98s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:15<29:13, 38.97s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:53<28:29, 38.86s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:32<27:52, 38.90s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:11<27:10, 38.83s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:50<26:34, 38.89s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:29<25:52, 38.82s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:07<25:12, 38.78s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:46<24:34, 38.81s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:25<23:58, 38.88s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:04<23:19, 38.88s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:43<22:41, 38.91s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:21<21:58, 38.77s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:00<21:19, 38.77s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:40<20:45, 38.92s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:18<20:04, 38.87s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:57<19:24, 38.81s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:36<18:45, 38.80s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:14<18:05, 38.76s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:30<14:17, 31.78s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:09<14:40, 33.88s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [15:47<14:41, 35.26s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:26<14:29, 36.21s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:04<14:10, 36.98s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [17:43<13:45, 37.54s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:13<12:17, 35.11s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [18:51<12:04, 36.22s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:30<11:40, 36.88s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:08<11:12, 37.36s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [20:47<10:41, 37.74s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:26<10:08, 38.02s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:05<09:34, 38.27s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [22:43<08:57, 38.39s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:22<08:21, 38.58s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [24:01<07:44, 38.71s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [24:40<07:05, 38.69s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [25:18<06:26, 38.68s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [25:57<05:47, 38.61s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:36<05:09, 38.65s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [27:14<04:30, 38.66s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [27:53<03:52, 38.74s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:32<03:13, 38.80s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [29:11<02:35, 38.76s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [29:40<01:47, 35.91s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [30:19<01:13, 36.77s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [30:45<00:33, 33.57s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:24<00:00, 35.17s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:24<00:00, 37.69s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.5901} | avg. gen lenth: 312.904
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o20-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 20
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 05:28:54,534] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o20-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 20
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o20-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 23/9741 [00:00<00:43, 225.43it/s]  0%|▎                                                     | 46/9741 [00:00<00:42, 225.81it/s]  1%|▍                                                     | 69/9741 [00:00<00:42, 226.46it/s]  1%|▌                                                     | 92/9741 [00:00<00:42, 227.04it/s]  1%|▋                                                    | 115/9741 [00:00<00:42, 227.14it/s]  1%|▊                                                    | 138/9741 [00:00<00:42, 223.49it/s]  2%|▉                                                    | 161/9741 [00:00<00:42, 223.65it/s]  2%|█                                                    | 184/9741 [00:00<00:42, 224.19it/s]  2%|█▏                                                   | 207/9741 [00:00<00:42, 222.89it/s]  2%|█▎                                                   | 230/9741 [00:01<00:42, 223.71it/s]  3%|█▍                                                   | 253/9741 [00:01<00:42, 224.39it/s]  3%|█▌                                                   | 276/9741 [00:01<00:42, 225.05it/s]  3%|█▋                                                   | 299/9741 [00:01<00:41, 225.85it/s]  3%|█▊                                                   | 322/9741 [00:01<00:41, 225.92it/s]  4%|█▉                                                   | 355/9741 [00:01<00:36, 254.97it/s]  4%|██                                                   | 389/9741 [00:01<00:33, 278.95it/s]  4%|██▎                                                  | 424/9741 [00:01<00:31, 297.73it/s]  5%|██▍                                                  | 458/9741 [00:01<00:30, 307.71it/s]  5%|██▋                                                  | 493/9741 [00:01<00:29, 318.27it/s]  5%|██▊                                                  | 528/9741 [00:02<00:28, 325.90it/s]  6%|███                                                  | 563/9741 [00:02<00:27, 331.12it/s]  6%|███▎                                                 | 598/9741 [00:02<00:27, 335.11it/s]  6%|███▍                                                 | 633/9741 [00:02<00:26, 338.45it/s]  7%|███▋                                                 | 667/9741 [00:02<00:26, 338.90it/s]  7%|███▊                                                 | 702/9741 [00:02<00:26, 341.06it/s]  8%|████                                                 | 737/9741 [00:02<00:26, 342.29it/s]  8%|████▏                                                | 772/9741 [00:02<00:26, 343.57it/s]  8%|████▍                                                | 807/9741 [00:02<00:25, 344.47it/s]  9%|████▌                                                | 842/9741 [00:02<00:25, 345.20it/s]  9%|████▊                                                | 877/9741 [00:03<00:25, 345.70it/s]  9%|████▉                                                | 912/9741 [00:03<00:25, 343.71it/s] 10%|█████▏                                               | 947/9741 [00:03<00:25, 344.57it/s] 10%|█████▎                                               | 982/9741 [00:03<00:25, 345.02it/s] 10%|█████▍                                              | 1017/9741 [00:03<00:25, 345.11it/s] 11%|█████▌                                              | 1052/9741 [00:03<00:25, 345.41it/s] 11%|█████▊                                              | 1087/9741 [00:03<00:25, 345.73it/s] 12%|█████▉                                              | 1122/9741 [00:03<00:25, 343.53it/s] 12%|██████▏                                             | 1157/9741 [00:03<00:24, 344.08it/s] 12%|██████▎                                             | 1192/9741 [00:03<00:24, 344.51it/s] 13%|██████▌                                             | 1227/9741 [00:04<00:24, 344.60it/s] 13%|██████▋                                             | 1262/9741 [00:04<00:24, 344.73it/s] 13%|██████▉                                             | 1297/9741 [00:04<00:24, 343.61it/s] 14%|███████                                             | 1332/9741 [00:04<00:24, 344.05it/s] 14%|███████▎                                            | 1367/9741 [00:04<00:24, 342.08it/s] 14%|███████▍                                            | 1402/9741 [00:04<00:24, 342.87it/s] 15%|███████▋                                            | 1437/9741 [00:04<00:24, 343.42it/s] 15%|███████▊                                            | 1472/9741 [00:04<00:24, 343.22it/s] 15%|████████                                            | 1507/9741 [00:04<00:23, 343.44it/s] 16%|████████▏                                           | 1542/9741 [00:04<00:23, 343.96it/s] 16%|████████▍                                           | 1577/9741 [00:05<00:23, 342.01it/s] 17%|████████▌                                           | 1612/9741 [00:05<00:23, 342.18it/s] 17%|████████▊                                           | 1647/9741 [00:05<00:23, 342.08it/s] 17%|████████▉                                           | 1682/9741 [00:05<00:23, 341.71it/s] 18%|█████████▏                                          | 1717/9741 [00:05<00:23, 341.50it/s] 18%|█████████▎                                          | 1752/9741 [00:05<00:23, 337.99it/s] 18%|█████████▌                                          | 1787/9741 [00:05<00:23, 338.71it/s] 19%|█████████▋                                          | 1821/9741 [00:05<00:24, 317.13it/s] 19%|█████████▉                                          | 1856/9741 [00:05<00:24, 323.83it/s] 19%|██████████                                          | 1891/9741 [00:06<00:23, 328.98it/s] 20%|██████████▎                                         | 1926/9741 [00:06<00:23, 332.26it/s] 20%|██████████▍                                         | 1961/9741 [00:06<00:23, 334.81it/s] 20%|██████████▋                                         | 1996/9741 [00:06<00:23, 336.60it/s] 21%|██████████▊                                         | 2030/9741 [00:06<00:22, 335.51it/s] 21%|███████████                                         | 2064/9741 [00:06<00:22, 336.81it/s] 22%|███████████▏                                        | 2098/9741 [00:06<00:22, 337.19it/s] 22%|███████████▍                                        | 2133/9741 [00:06<00:22, 339.30it/s] 22%|███████████▌                                        | 2167/9741 [00:06<00:22, 338.06it/s] 23%|███████████▊                                        | 2202/9741 [00:06<00:22, 340.35it/s] 23%|███████████▉                                        | 2237/9741 [00:07<00:21, 341.98it/s] 23%|████████████▏                                       | 2272/9741 [00:07<00:22, 339.25it/s] 24%|████████████▎                                       | 2307/9741 [00:07<00:21, 341.26it/s] 24%|████████████▌                                       | 2342/9741 [00:07<00:21, 342.24it/s] 24%|████████████▋                                       | 2377/9741 [00:07<00:21, 343.31it/s] 25%|████████████▉                                       | 2412/9741 [00:07<00:21, 344.19it/s] 25%|█████████████                                       | 2447/9741 [00:07<00:21, 344.65it/s] 25%|█████████████▏                                      | 2482/9741 [00:07<00:21, 342.46it/s] 26%|█████████████▍                                      | 2517/9741 [00:07<00:21, 343.05it/s] 26%|█████████████▌                                      | 2552/9741 [00:07<00:20, 343.39it/s] 27%|█████████████▊                                      | 2587/9741 [00:08<00:20, 342.91it/s] 27%|█████████████▉                                      | 2622/9741 [00:08<00:20, 341.18it/s] 27%|██████████████▏                                     | 2657/9741 [00:08<00:20, 341.96it/s] 28%|██████████████▎                                     | 2692/9741 [00:08<00:20, 342.79it/s] 28%|██████████████▌                                     | 2727/9741 [00:08<00:20, 341.19it/s] 28%|██████████████▋                                     | 2762/9741 [00:08<00:20, 342.18it/s] 29%|██████████████▉                                     | 2797/9741 [00:08<00:20, 343.03it/s] 29%|███████████████                                     | 2832/9741 [00:08<00:20, 343.70it/s] 29%|███████████████▎                                    | 2867/9741 [00:08<00:19, 344.07it/s] 30%|███████████████▍                                    | 2902/9741 [00:08<00:19, 344.25it/s] 30%|███████████████▋                                    | 2937/9741 [00:09<00:19, 342.49it/s] 31%|███████████████▊                                    | 2972/9741 [00:09<00:19, 343.14it/s] 31%|████████████████                                    | 3007/9741 [00:09<00:19, 343.85it/s] 31%|████████████████▏                                   | 3042/9741 [00:09<00:19, 343.94it/s] 32%|████████████████▍                                   | 3077/9741 [00:09<00:19, 343.87it/s] 32%|████████████████▌                                   | 3112/9741 [00:09<00:19, 344.50it/s] 32%|████████████████▊                                   | 3147/9741 [00:09<00:19, 344.67it/s] 33%|████████████████▉                                   | 3182/9741 [00:09<00:19, 342.78it/s] 33%|█████████████████▏                                  | 3217/9741 [00:09<00:18, 343.48it/s] 33%|█████████████████▎                                  | 3252/9741 [00:10<00:18, 344.30it/s] 34%|█████████████████▌                                  | 3287/9741 [00:10<00:18, 344.46it/s] 34%|█████████████████▋                                  | 3322/9741 [00:10<00:18, 344.59it/s] 34%|█████████████████▉                                  | 3357/9741 [00:10<00:18, 344.29it/s] 35%|██████████████████                                  | 3392/9741 [00:10<00:18, 342.07it/s] 35%|██████████████████▎                                 | 3427/9741 [00:10<00:18, 342.76it/s] 36%|██████████████████▍                                 | 3462/9741 [00:10<00:18, 343.21it/s] 36%|██████████████████▋                                 | 3497/9741 [00:10<00:18, 343.21it/s] 36%|██████████████████▊                                 | 3532/9741 [00:10<00:18, 343.05it/s] 37%|███████████████████                                 | 3567/9741 [00:10<00:17, 343.28it/s] 37%|███████████████████▏                                | 3602/9741 [00:11<00:17, 343.68it/s] 37%|███████████████████▍                                | 3637/9741 [00:11<00:17, 341.96it/s] 38%|███████████████████▌                                | 3672/9741 [00:11<00:17, 342.45it/s] 38%|███████████████████▊                                | 3707/9741 [00:11<00:17, 343.28it/s] 38%|███████████████████▉                                | 3742/9741 [00:11<00:17, 343.83it/s] 39%|████████████████████▏                               | 3777/9741 [00:11<00:17, 344.31it/s] 39%|████████████████████▎                               | 3812/9741 [00:11<00:17, 344.47it/s] 39%|████████████████████▌                               | 3847/9741 [00:11<00:17, 342.38it/s] 40%|████████████████████▋                               | 3882/9741 [00:11<00:17, 343.29it/s] 40%|████████████████████▉                               | 3917/9741 [00:11<00:16, 343.57it/s] 41%|█████████████████████                               | 3952/9741 [00:12<00:16, 343.82it/s] 41%|█████████████████████▎                              | 3987/9741 [00:12<00:16, 343.83it/s] 41%|█████████████████████▍                              | 4022/9741 [00:12<00:16, 344.43it/s] 42%|█████████████████████▋                              | 4057/9741 [00:12<00:16, 344.38it/s] 42%|█████████████████████▊                              | 4092/9741 [00:12<00:16, 342.32it/s] 42%|██████████████████████                              | 4127/9741 [00:12<00:16, 342.79it/s] 43%|██████████████████████▏                             | 4162/9741 [00:12<00:16, 343.21it/s] 43%|██████████████████████▍                             | 4197/9741 [00:12<00:16, 343.44it/s] 43%|██████████████████████▌                             | 4232/9741 [00:12<00:16, 343.75it/s] 44%|██████████████████████▊                             | 4267/9741 [00:12<00:15, 343.32it/s] 44%|██████████████████████▉                             | 4302/9741 [00:13<00:15, 341.21it/s] 45%|███████████████████████▏                            | 4337/9741 [00:13<00:15, 342.18it/s] 45%|███████████████████████▎                            | 4372/9741 [00:13<00:15, 341.28it/s] 45%|███████████████████████▌                            | 4407/9741 [00:13<00:15, 342.09it/s] 46%|███████████████████████▋                            | 4442/9741 [00:13<00:15, 342.38it/s] 46%|███████████████████████▉                            | 4477/9741 [00:13<00:15, 342.86it/s] 46%|████████████████████████                            | 4512/9741 [00:13<00:16, 315.25it/s] 47%|████████████████████████▎                           | 4547/9741 [00:13<00:16, 322.87it/s] 47%|████████████████████████▍                           | 4582/9741 [00:13<00:15, 328.98it/s] 47%|████████████████████████▋                           | 4617/9741 [00:14<00:15, 333.09it/s] 48%|████████████████████████▊                           | 4652/9741 [00:14<00:15, 336.29it/s] 48%|█████████████████████████                           | 4687/9741 [00:14<00:14, 338.66it/s] 48%|█████████████████████████▏                          | 4722/9741 [00:14<00:14, 340.42it/s] 49%|█████████████████████████▍                          | 4757/9741 [00:14<00:21, 235.38it/s] 49%|█████████████████████████▌                          | 4792/9741 [00:14<00:19, 259.83it/s] 50%|█████████████████████████▊                          | 4827/9741 [00:14<00:17, 280.00it/s] 50%|█████████████████████████▉                          | 4862/9741 [00:14<00:16, 296.00it/s] 50%|██████████████████████████▏                         | 4896/9741 [00:14<00:15, 307.06it/s] 51%|██████████████████████████▎                         | 4930/9741 [00:15<00:15, 315.92it/s] 51%|██████████████████████████▍                         | 4964/9741 [00:15<00:14, 320.92it/s] 51%|██████████████████████████▋                         | 4999/9741 [00:15<00:14, 327.12it/s] 52%|██████████████████████████▊                         | 5034/9741 [00:15<00:14, 331.92it/s] 52%|███████████████████████████                         | 5069/9741 [00:15<00:13, 335.12it/s] 52%|███████████████████████████▏                        | 5104/9741 [00:15<00:13, 337.77it/s] 53%|███████████████████████████▍                        | 5139/9741 [00:15<00:13, 339.61it/s] 53%|███████████████████████████▌                        | 5174/9741 [00:15<00:13, 339.08it/s] 53%|███████████████████████████▊                        | 5209/9741 [00:15<00:13, 340.46it/s] 54%|███████████████████████████▉                        | 5244/9741 [00:16<00:13, 341.38it/s] 54%|████████████████████████████▏                       | 5279/9741 [00:16<00:13, 341.83it/s] 55%|████████████████████████████▎                       | 5314/9741 [00:16<00:12, 342.74it/s] 55%|████████████████████████████▌                       | 5349/9741 [00:16<00:12, 342.14it/s] 55%|████████████████████████████▋                       | 5384/9741 [00:16<00:12, 342.93it/s] 56%|████████████████████████████▉                       | 5419/9741 [00:16<00:12, 341.33it/s] 56%|█████████████████████████████                       | 5454/9741 [00:16<00:12, 341.53it/s] 56%|█████████████████████████████▎                      | 5489/9741 [00:16<00:12, 343.78it/s] 57%|█████████████████████████████▍                      | 5525/9741 [00:16<00:12, 346.88it/s] 57%|█████████████████████████████▋                      | 5561/9741 [00:16<00:11, 349.48it/s] 57%|█████████████████████████████▉                      | 5597/9741 [00:17<00:11, 350.55it/s] 58%|██████████████████████████████                      | 5633/9741 [00:17<00:11, 349.96it/s] 58%|██████████████████████████████▎                     | 5669/9741 [00:17<00:11, 351.41it/s] 59%|██████████████████████████████▍                     | 5705/9741 [00:17<00:11, 352.75it/s] 59%|██████████████████████████████▋                     | 5741/9741 [00:17<00:11, 353.49it/s] 59%|██████████████████████████████▊                     | 5777/9741 [00:17<00:11, 353.88it/s] 60%|███████████████████████████████                     | 5813/9741 [00:17<00:11, 354.46it/s] 60%|███████████████████████████████▏                    | 5849/9741 [00:17<00:10, 354.54it/s] 60%|███████████████████████████████▍                    | 5885/9741 [00:17<00:10, 352.83it/s] 61%|███████████████████████████████▌                    | 5921/9741 [00:17<00:10, 353.37it/s] 61%|███████████████████████████████▊                    | 5957/9741 [00:18<00:10, 353.95it/s] 62%|███████████████████████████████▉                    | 5993/9741 [00:18<00:10, 354.18it/s] 62%|████████████████████████████████▏                   | 6029/9741 [00:18<00:10, 354.47it/s] 62%|████████████████████████████████▍                   | 6065/9741 [00:18<00:10, 351.71it/s] 63%|████████████████████████████████▌                   | 6101/9741 [00:18<00:10, 350.62it/s] 63%|████████████████████████████████▊                   | 6137/9741 [00:18<00:10, 351.87it/s] 63%|████████████████████████████████▉                   | 6173/9741 [00:18<00:10, 352.82it/s] 64%|█████████████████████████████████▏                  | 6209/9741 [00:18<00:09, 353.46it/s] 64%|█████████████████████████████████▎                  | 6245/9741 [00:18<00:09, 353.39it/s] 64%|█████████████████████████████████▌                  | 6281/9741 [00:18<00:09, 354.03it/s] 65%|█████████████████████████████████▋                  | 6317/9741 [00:19<00:09, 352.59it/s] 65%|█████████████████████████████████▉                  | 6353/9741 [00:19<00:09, 353.52it/s] 66%|██████████████████████████████████                  | 6389/9741 [00:19<00:09, 354.37it/s] 66%|██████████████████████████████████▎                 | 6425/9741 [00:19<00:09, 354.47it/s] 66%|██████████████████████████████████▍                 | 6461/9741 [00:19<00:09, 354.29it/s] 67%|██████████████████████████████████▋                 | 6497/9741 [00:19<00:09, 354.68it/s] 67%|██████████████████████████████████▊                 | 6533/9741 [00:19<00:09, 352.90it/s] 67%|███████████████████████████████████                 | 6569/9741 [00:19<00:08, 353.75it/s] 68%|███████████████████████████████████▎                | 6605/9741 [00:19<00:08, 354.02it/s] 68%|███████████████████████████████████▍                | 6641/9741 [00:19<00:08, 354.59it/s] 69%|███████████████████████████████████▋                | 6677/9741 [00:20<00:08, 351.32it/s] 69%|███████████████████████████████████▊                | 6713/9741 [00:20<00:08, 352.07it/s] 69%|████████████████████████████████████                | 6749/9741 [00:20<00:08, 353.18it/s] 70%|████████████████████████████████████▏               | 6785/9741 [00:20<00:08, 351.91it/s] 70%|████████████████████████████████████▍               | 6821/9741 [00:20<00:08, 353.01it/s] 70%|████████████████████████████████████▌               | 6857/9741 [00:20<00:08, 353.95it/s] 71%|████████████████████████████████████▊               | 6893/9741 [00:20<00:08, 353.95it/s] 71%|████████████████████████████████████▉               | 6929/9741 [00:20<00:07, 354.34it/s] 72%|█████████████████████████████████████▏              | 6965/9741 [00:20<00:07, 354.57it/s] 72%|█████████████████████████████████████▎              | 7001/9741 [00:21<00:07, 352.82it/s] 72%|█████████████████████████████████████▌              | 7037/9741 [00:21<00:07, 353.55it/s] 73%|█████████████████████████████████████▊              | 7073/9741 [00:21<00:07, 354.23it/s] 73%|█████████████████████████████████████▉              | 7109/9741 [00:21<00:07, 354.27it/s] 73%|██████████████████████████████████████▏             | 7145/9741 [00:21<00:07, 354.48it/s] 74%|██████████████████████████████████████▎             | 7181/9741 [00:21<00:07, 354.58it/s] 74%|██████████████████████████████████████▌             | 7217/9741 [00:21<00:07, 352.83it/s] 74%|██████████████████████████████████████▋             | 7253/9741 [00:21<00:07, 353.46it/s] 75%|██████████████████████████████████████▉             | 7289/9741 [00:21<00:06, 351.08it/s] 75%|███████████████████████████████████████             | 7325/9741 [00:21<00:06, 352.09it/s] 76%|███████████████████████████████████████▎            | 7361/9741 [00:22<00:06, 352.81it/s] 76%|███████████████████████████████████████▍            | 7397/9741 [00:22<00:06, 353.48it/s] 76%|███████████████████████████████████████▋            | 7433/9741 [00:22<00:06, 353.92it/s] 77%|███████████████████████████████████████▊            | 7469/9741 [00:22<00:06, 326.66it/s] 77%|████████████████████████████████████████            | 7505/9741 [00:22<00:06, 334.44it/s] 77%|████████████████████████████████████████▎           | 7541/9741 [00:22<00:06, 339.73it/s] 78%|████████████████████████████████████████▍           | 7577/9741 [00:22<00:06, 343.82it/s] 78%|████████████████████████████████████████▋           | 7613/9741 [00:22<00:06, 347.11it/s] 79%|████████████████████████████████████████▊           | 7649/9741 [00:22<00:05, 348.90it/s] 79%|█████████████████████████████████████████           | 7684/9741 [00:22<00:05, 348.39it/s] 79%|█████████████████████████████████████████▏          | 7720/9741 [00:23<00:05, 350.63it/s] 80%|█████████████████████████████████████████▍          | 7756/9741 [00:23<00:05, 351.98it/s] 80%|█████████████████████████████████████████▌          | 7792/9741 [00:23<00:05, 352.69it/s] 80%|█████████████████████████████████████████▊          | 7828/9741 [00:23<00:05, 353.35it/s] 81%|█████████████████████████████████████████▉          | 7864/9741 [00:23<00:05, 349.41it/s] 81%|██████████████████████████████████████████▏         | 7899/9741 [00:23<00:05, 345.71it/s] 81%|██████████████████████████████████████████▎         | 7934/9741 [00:23<00:05, 346.92it/s] 82%|██████████████████████████████████████████▌         | 7970/9741 [00:23<00:05, 347.85it/s] 82%|██████████████████████████████████████████▋         | 8005/9741 [00:23<00:04, 347.94it/s] 83%|██████████████████████████████████████████▉         | 8040/9741 [00:23<00:04, 348.34it/s] 83%|███████████████████████████████████████████         | 8075/9741 [00:24<00:04, 348.56it/s] 83%|███████████████████████████████████████████▎        | 8111/9741 [00:24<00:04, 349.31it/s] 84%|███████████████████████████████████████████▍        | 8146/9741 [00:24<00:04, 347.39it/s] 84%|███████████████████████████████████████████▋        | 8181/9741 [00:24<00:04, 347.81it/s] 84%|███████████████████████████████████████████▊        | 8216/9741 [00:24<00:04, 348.31it/s] 85%|████████████████████████████████████████████        | 8252/9741 [00:24<00:04, 349.90it/s] 85%|████████████████████████████████████████████▏       | 8288/9741 [00:24<00:04, 351.04it/s] 85%|████████████████████████████████████████████▍       | 8324/9741 [00:24<00:04, 351.96it/s] 86%|████████████████████████████████████████████▋       | 8360/9741 [00:24<00:03, 350.89it/s] 86%|████████████████████████████████████████████▊       | 8396/9741 [00:24<00:03, 352.00it/s] 87%|█████████████████████████████████████████████       | 8432/9741 [00:25<00:03, 351.98it/s] 87%|█████████████████████████████████████████████▏      | 8468/9741 [00:25<00:03, 347.44it/s] 87%|█████████████████████████████████████████████▍      | 8503/9741 [00:25<00:03, 347.97it/s] 88%|█████████████████████████████████████████████▌      | 8538/9741 [00:25<00:03, 348.17it/s] 88%|█████████████████████████████████████████████▊      | 8573/9741 [00:25<00:03, 348.38it/s] 88%|█████████████████████████████████████████████▉      | 8608/9741 [00:25<00:03, 346.74it/s] 89%|██████████████████████████████████████████████▏     | 8643/9741 [00:25<00:03, 347.41it/s] 89%|██████████████████████████████████████████████▎     | 8678/9741 [00:25<00:03, 347.74it/s] 89%|██████████████████████████████████████████████▌     | 8713/9741 [00:25<00:02, 348.29it/s] 90%|██████████████████████████████████████████████▋     | 8748/9741 [00:26<00:02, 348.61it/s] 90%|██████████████████████████████████████████████▉     | 8783/9741 [00:26<00:02, 348.88it/s] 91%|███████████████████████████████████████████████     | 8818/9741 [00:26<00:02, 347.13it/s] 91%|███████████████████████████████████████████████▎    | 8853/9741 [00:26<00:02, 347.80it/s] 91%|███████████████████████████████████████████████▍    | 8888/9741 [00:26<00:02, 348.17it/s] 92%|███████████████████████████████████████████████▋    | 8923/9741 [00:26<00:02, 348.56it/s] 92%|███████████████████████████████████████████████▊    | 8959/9741 [00:26<00:02, 349.03it/s] 92%|████████████████████████████████████████████████    | 8994/9741 [00:26<00:02, 349.27it/s] 93%|████████████████████████████████████████████████▏   | 9029/9741 [00:26<00:02, 347.31it/s] 93%|████████████████████████████████████████████████▍   | 9064/9741 [00:26<00:01, 347.74it/s] 93%|████████████████████████████████████████████████▌   | 9099/9741 [00:27<00:01, 347.91it/s] 94%|████████████████████████████████████████████████▊   | 9134/9741 [00:27<00:01, 348.26it/s] 94%|████████████████████████████████████████████████▉   | 9169/9741 [00:27<00:01, 346.76it/s] 94%|█████████████████████████████████████████████████▏  | 9204/9741 [00:27<00:01, 347.66it/s] 95%|█████████████████████████████████████████████████▎  | 9240/9741 [00:27<00:01, 348.41it/s] 95%|█████████████████████████████████████████████████▌  | 9275/9741 [00:27<00:01, 347.12it/s] 96%|█████████████████████████████████████████████████▋  | 9310/9741 [00:27<00:01, 347.57it/s] 96%|█████████████████████████████████████████████████▉  | 9345/9741 [00:27<00:01, 348.18it/s] 96%|██████████████████████████████████████████████████  | 9380/9741 [00:27<00:01, 348.65it/s] 97%|██████████████████████████████████████████████████▎ | 9415/9741 [00:27<00:00, 348.73it/s] 97%|██████████████████████████████████████████████████▍ | 9450/9741 [00:28<00:00, 348.98it/s] 97%|██████████████████████████████████████████████████▋ | 9485/9741 [00:28<00:00, 346.93it/s] 98%|██████████████████████████████████████████████████▊ | 9520/9741 [00:28<00:00, 347.65it/s] 98%|███████████████████████████████████████████████████ | 9556/9741 [00:28<00:00, 348.63it/s] 98%|███████████████████████████████████████████████████▏| 9592/9741 [00:28<00:00, 350.20it/s] 99%|███████████████████████████████████████████████████▍| 9628/9741 [00:28<00:00, 351.62it/s] 99%|███████████████████████████████████████████████████▌| 9664/9741 [00:28<00:00, 352.49it/s]100%|███████████████████████████████████████████████████▊| 9700/9741 [00:28<00:00, 352.71it/s]100%|███████████████████████████████████████████████████▉| 9736/9741 [00:28<00:00, 350.98it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:28<00:00, 337.57it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.22s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.34s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.35s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.25s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.12s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.14s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.20s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.12s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.51s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.49s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.57s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]
[2023-08-22 05:30:15,669] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.49s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
[2023-08-22 05:30:23,507] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 05:30:23,507] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fb8f15aafd0>
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 05:30:23,508] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fb8f12b0220>
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 05:30:23,509] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 05:30:23,509] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5361073017120361 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.6052951812744141 seconds
Loading extension module utils...
Time to load utils op: 0.6048483848571777 seconds
Time to load utils op: 0.604694128036499 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input: Sam, Sid, and Steve brought popsicle sticks for their group activity in their Art class. Sam has thrice as many as Sid, and Sid has twice as many as Steve. If Steve has 12 popsicle sticks, how many popsicle sticks can they use for their Art class activity?
Output: 108

Input: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.
Output: 720

Input: John uses a 75-watt electric fan for 8 hours a day. How much kWh of electric energy does he consume per month (30 days) for using the electric fan?
Output: 18

Input: Barbara Blackburn can type 212 words per minute.  Due to Carpal tunnel syndrome, Barbara cannot use her left hand for a while so her typing speed is now 40 words less per minute. If she is supposed to type a document with 3440 words, how many minutes will it take her to finish typing the document?
Output: 20

Input: Max fills up water balloons for 30 minutes at a rate of 2 water balloons every minute. Max’s friend Zach fills up water balloons for 40 minutes at a rate of 3 water balloons every minute. In the process, 10 of the water balloons pop on the ground. How many filled water balloons do Max and Zach have in total?
Output: 170

Input: John has 54 pieces of gum, Cole has 45 pieces of gum and Aubrey has no pieces of gum. They decide to share the gum equally between the 3 of them. How many pieces of gum will each one get?
Output: 33

Input: Mira jogs every morning. She jogs 5 miles per hour. If she jogs for 2 hours every morning, how many miles can she jog for five days?
Output: 50

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o20-tgsm8k-s20-rFalse
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3566612) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-22_05:30:32
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3566613)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-22_05:30:32
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3566614)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-22_05:30:32
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3566615)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-22_05:30:32
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3566612)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o21-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 21
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 05:30:36,119] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o21-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 21
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o21-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 22/9741 [00:00<00:44, 218.58it/s]  0%|▏                                                     | 45/9741 [00:00<00:44, 219.56it/s]  1%|▍                                                     | 68/9741 [00:00<00:43, 220.03it/s]  1%|▌                                                     | 91/9741 [00:00<00:43, 220.48it/s]  1%|▌                                                    | 114/9741 [00:00<00:43, 220.53it/s]  1%|▋                                                    | 137/9741 [00:00<00:43, 220.53it/s]  2%|▊                                                    | 160/9741 [00:00<00:44, 217.68it/s]  2%|▉                                                    | 182/9741 [00:00<00:43, 217.97it/s]  2%|█                                                    | 204/9741 [00:00<00:44, 216.05it/s]  2%|█▏                                                   | 226/9741 [00:01<00:44, 215.68it/s]  3%|█▎                                                   | 248/9741 [00:01<00:44, 214.52it/s]  3%|█▍                                                   | 270/9741 [00:01<00:44, 213.00it/s]  3%|█▌                                                   | 292/9741 [00:01<00:44, 212.56it/s]  3%|█▋                                                   | 314/9741 [00:01<00:44, 211.42it/s]  3%|█▊                                                   | 336/9741 [00:01<00:46, 204.42it/s]  4%|█▉                                                   | 357/9741 [00:01<00:47, 196.96it/s]  4%|██                                                   | 379/9741 [00:01<00:46, 201.71it/s]  4%|██▏                                                  | 401/9741 [00:01<00:45, 205.52it/s]  4%|██▎                                                  | 423/9741 [00:01<00:44, 208.26it/s]  5%|██▍                                                  | 444/9741 [00:02<00:54, 171.94it/s]  5%|██▌                                                  | 466/9741 [00:02<00:50, 182.97it/s]  5%|██▋                                                  | 488/9741 [00:02<00:48, 191.82it/s]  5%|██▊                                                  | 510/9741 [00:02<00:46, 197.73it/s]  5%|██▉                                                  | 532/9741 [00:02<00:45, 202.65it/s]  6%|███                                                  | 554/9741 [00:02<00:45, 203.81it/s]  6%|███▏                                                 | 575/9741 [00:02<00:58, 156.58it/s]  6%|███▏                                                 | 593/9741 [00:03<01:06, 137.48it/s]  6%|███▎                                                 | 611/9741 [00:03<01:02, 146.47it/s]  6%|███▍                                                 | 628/9741 [00:03<01:01, 149.27it/s]  7%|███▌                                                 | 644/9741 [00:03<00:59, 151.75it/s]  7%|███▌                                                 | 660/9741 [00:03<01:05, 137.94it/s]  7%|███▋                                                 | 675/9741 [00:03<01:13, 124.11it/s]  7%|███▊                                                 | 694/9741 [00:03<01:05, 138.52it/s]  7%|███▉                                                 | 716/9741 [00:03<00:57, 158.31it/s]  8%|████                                                 | 738/9741 [00:03<00:51, 173.78it/s]  8%|████▏                                                | 760/9741 [00:04<00:48, 185.52it/s]  8%|████▎                                                | 782/9741 [00:04<00:46, 194.31it/s]  8%|████▎                                                | 804/9741 [00:04<00:44, 200.44it/s]  8%|████▍                                                | 826/9741 [00:04<00:43, 204.97it/s]  9%|████▌                                                | 848/9741 [00:04<00:42, 208.20it/s]  9%|████▋                                                | 870/9741 [00:04<00:42, 210.64it/s]  9%|████▊                                                | 892/9741 [00:04<00:42, 210.56it/s]  9%|████▉                                                | 914/9741 [00:04<00:42, 207.65it/s] 10%|█████                                                | 936/9741 [00:04<00:41, 210.17it/s] 10%|█████▏                                               | 958/9741 [00:05<00:41, 212.37it/s] 10%|█████▎                                               | 980/9741 [00:05<00:40, 213.94it/s] 10%|█████▎                                              | 1002/9741 [00:05<00:40, 214.09it/s] 11%|█████▍                                              | 1024/9741 [00:05<00:40, 215.19it/s] 11%|█████▌                                              | 1053/9741 [00:05<00:36, 235.60it/s] 11%|█████▊                                              | 1087/9741 [00:05<00:32, 264.58it/s] 11%|█████▉                                              | 1119/9741 [00:05<00:30, 280.81it/s] 12%|██████▏                                             | 1153/9741 [00:05<00:28, 296.14it/s] 12%|██████▎                                             | 1187/9741 [00:05<00:27, 307.02it/s] 13%|██████▌                                             | 1221/9741 [00:05<00:27, 314.29it/s] 13%|██████▋                                             | 1254/9741 [00:06<00:26, 318.82it/s] 13%|██████▉                                             | 1288/9741 [00:06<00:26, 322.81it/s] 14%|███████                                             | 1321/9741 [00:06<00:25, 324.84it/s] 14%|███████▏                                            | 1354/9741 [00:06<00:25, 324.70it/s] 14%|███████▍                                            | 1387/9741 [00:06<00:25, 325.49it/s] 15%|███████▌                                            | 1420/9741 [00:06<00:26, 319.81it/s] 15%|███████▊                                            | 1453/9741 [00:06<00:26, 318.61it/s] 15%|███████▉                                            | 1485/9741 [00:06<00:26, 315.49it/s] 16%|████████                                            | 1517/9741 [00:06<00:26, 315.58it/s] 16%|████████▎                                           | 1549/9741 [00:06<00:25, 316.69it/s] 16%|████████▍                                           | 1581/9741 [00:07<00:30, 265.48it/s] 17%|████████▌                                           | 1609/9741 [00:07<00:46, 173.14it/s] 17%|████████▋                                           | 1632/9741 [00:07<00:57, 139.91it/s] 17%|████████▊                                           | 1651/9741 [00:07<00:56, 143.48it/s] 17%|████████▉                                           | 1685/9741 [00:07<00:44, 180.40it/s] 18%|█████████▏                                          | 1719/9741 [00:08<00:37, 213.45it/s] 18%|█████████▎                                          | 1753/9741 [00:08<00:33, 241.63it/s] 18%|█████████▌                                          | 1786/9741 [00:08<00:30, 263.28it/s] 19%|█████████▋                                          | 1816/9741 [00:08<00:32, 243.63it/s] 19%|█████████▊                                          | 1849/9741 [00:08<00:29, 265.13it/s] 19%|██████████                                          | 1883/9741 [00:08<00:27, 282.74it/s] 20%|██████████▏                                         | 1916/9741 [00:08<00:26, 294.79it/s] 20%|██████████▍                                         | 1950/9741 [00:08<00:25, 304.86it/s] 20%|██████████▌                                         | 1984/9741 [00:08<00:24, 312.32it/s] 21%|██████████▊                                         | 2016/9741 [00:08<00:24, 313.59it/s] 21%|██████████▉                                         | 2049/9741 [00:09<00:24, 318.14it/s] 21%|███████████                                         | 2083/9741 [00:09<00:23, 321.69it/s] 22%|███████████▎                                        | 2117/9741 [00:09<00:23, 324.55it/s] 22%|███████████▍                                        | 2150/9741 [00:09<00:23, 321.29it/s] 22%|███████████▋                                        | 2184/9741 [00:09<00:23, 324.51it/s] 23%|███████████▊                                        | 2218/9741 [00:09<00:23, 326.81it/s] 23%|████████████                                        | 2251/9741 [00:09<00:22, 326.23it/s] 23%|████████████▏                                       | 2285/9741 [00:09<00:22, 328.09it/s] 24%|████████████▍                                       | 2319/9741 [00:09<00:22, 329.03it/s] 24%|████████████▌                                       | 2352/9741 [00:10<00:22, 328.75it/s] 24%|████████████▋                                       | 2385/9741 [00:10<00:22, 328.58it/s] 25%|████████████▉                                       | 2418/9741 [00:10<00:22, 327.87it/s] 25%|█████████████                                       | 2451/9741 [00:10<00:22, 328.09it/s] 26%|█████████████▎                                      | 2484/9741 [00:10<00:22, 325.83it/s] 26%|█████████████▍                                      | 2517/9741 [00:10<00:22, 326.93it/s] 26%|█████████████▌                                      | 2551/9741 [00:10<00:21, 327.89it/s] 27%|█████████████▊                                      | 2584/9741 [00:10<00:21, 325.64it/s] 27%|█████████████▉                                      | 2617/9741 [00:10<00:21, 324.06it/s] 27%|██████████████▏                                     | 2650/9741 [00:10<00:22, 321.76it/s] 28%|██████████████▎                                     | 2683/9741 [00:11<00:21, 320.82it/s] 28%|██████████████▍                                     | 2716/9741 [00:11<00:21, 320.36it/s] 28%|██████████████▋                                     | 2750/9741 [00:11<00:21, 323.53it/s] 29%|██████████████▊                                     | 2783/9741 [00:11<00:21, 323.34it/s] 29%|███████████████                                     | 2816/9741 [00:11<00:21, 321.84it/s] 29%|███████████████▏                                    | 2849/9741 [00:11<00:21, 319.25it/s] 30%|███████████████▍                                    | 2881/9741 [00:11<00:21, 318.20it/s] 30%|███████████████▌                                    | 2914/9741 [00:11<00:21, 320.83it/s] 30%|███████████████▋                                    | 2947/9741 [00:11<00:21, 320.25it/s] 31%|███████████████▉                                    | 2980/9741 [00:12<00:40, 168.46it/s] 31%|████████████████                                    | 3005/9741 [00:12<00:49, 136.42it/s] 31%|████████████████▏                                   | 3025/9741 [00:12<00:46, 145.67it/s] 31%|████████████████▎                                   | 3046/9741 [00:12<00:42, 156.64it/s] 31%|████████████████▎                                   | 3066/9741 [00:12<00:41, 159.58it/s] 32%|████████████████▍                                   | 3088/9741 [00:12<00:38, 171.99it/s] 32%|████████████████▌                                   | 3108/9741 [00:13<00:40, 165.76it/s] 32%|████████████████▋                                   | 3130/9741 [00:13<00:37, 177.80it/s] 32%|████████████████▊                                   | 3151/9741 [00:13<00:35, 183.66it/s] 33%|████████████████▉                                   | 3173/9741 [00:13<00:34, 191.91it/s] 33%|█████████████████                                   | 3195/9741 [00:13<00:32, 198.67it/s] 33%|█████████████████▏                                  | 3217/9741 [00:13<00:32, 203.24it/s] 33%|█████████████████▎                                  | 3239/9741 [00:13<00:31, 206.65it/s] 33%|█████████████████▍                                  | 3261/9741 [00:13<00:31, 208.75it/s] 34%|█████████████████▌                                  | 3283/9741 [00:13<00:30, 209.59it/s] 34%|█████████████████▋                                  | 3305/9741 [00:14<00:30, 210.50it/s] 34%|█████████████████▊                                  | 3327/9741 [00:14<00:30, 210.86it/s] 34%|█████████████████▉                                  | 3349/9741 [00:14<00:30, 211.49it/s] 35%|█████████████████▉                                  | 3371/9741 [00:14<00:30, 211.71it/s] 35%|██████████████████                                  | 3393/9741 [00:14<00:31, 199.34it/s] 35%|██████████████████▎                                 | 3425/9741 [00:14<00:27, 232.48it/s] 35%|██████████████████▍                                 | 3457/9741 [00:14<00:24, 256.94it/s] 36%|██████████████████▌                                 | 3484/9741 [00:15<00:40, 152.65it/s] 36%|██████████████████▋                                 | 3505/9741 [00:15<00:49, 126.49it/s] 36%|██████████████████▉                                 | 3538/9741 [00:15<00:38, 162.05it/s] 37%|███████████████████                                 | 3572/9741 [00:15<00:31, 196.75it/s] 37%|███████████████████▏                                | 3605/9741 [00:15<00:27, 225.29it/s] 37%|███████████████████▍                                | 3639/9741 [00:15<00:24, 251.28it/s] 38%|███████████████████▌                                | 3672/9741 [00:15<00:22, 271.02it/s] 38%|███████████████████▊                                | 3706/9741 [00:15<00:21, 287.17it/s] 38%|███████████████████▉                                | 3740/9741 [00:15<00:20, 299.23it/s] 39%|████████████████████▏                               | 3773/9741 [00:16<00:19, 307.63it/s] 39%|████████████████████▎                               | 3806/9741 [00:16<00:19, 310.43it/s] 39%|████████████████████▍                               | 3838/9741 [00:16<00:18, 312.26it/s] 40%|████████████████████▋                               | 3871/9741 [00:16<00:18, 316.88it/s] 40%|████████████████████▊                               | 3904/9741 [00:16<00:18, 320.20it/s] 40%|█████████████████████                               | 3937/9741 [00:16<00:18, 321.92it/s] 41%|█████████████████████▏                              | 3970/9741 [00:16<00:17, 323.26it/s] 41%|█████████████████████▎                              | 4003/9741 [00:16<00:17, 323.19it/s] 41%|█████████████████████▌                              | 4036/9741 [00:16<00:17, 324.01it/s] 42%|█████████████████████▋                              | 4069/9741 [00:17<00:17, 322.32it/s] 42%|█████████████████████▉                              | 4102/9741 [00:17<00:17, 321.55it/s] 42%|██████████████████████                              | 4135/9741 [00:17<00:17, 322.92it/s] 43%|██████████████████████▏                             | 4168/9741 [00:17<00:17, 323.55it/s] 43%|██████████████████████▍                             | 4201/9741 [00:17<00:17, 324.47it/s] 43%|██████████████████████▌                             | 4234/9741 [00:17<00:16, 324.31it/s] 44%|██████████████████████▊                             | 4267/9741 [00:17<00:16, 324.59it/s] 44%|██████████████████████▉                             | 4300/9741 [00:17<00:16, 320.91it/s] 44%|███████████████████████▏                            | 4333/9741 [00:17<00:16, 322.05it/s] 45%|███████████████████████▎                            | 4366/9741 [00:17<00:16, 319.07it/s] 45%|███████████████████████▍                            | 4399/9741 [00:18<00:16, 320.68it/s] 45%|███████████████████████▋                            | 4432/9741 [00:18<00:16, 321.17it/s] 46%|███████████████████████▊                            | 4465/9741 [00:18<00:16, 319.63it/s] 46%|████████████████████████                            | 4498/9741 [00:18<00:16, 320.72it/s] 47%|████████████████████████▏                           | 4531/9741 [00:18<00:19, 261.68it/s] 47%|████████████████████████▎                           | 4564/9741 [00:18<00:18, 278.59it/s] 47%|████████████████████████▌                           | 4597/9741 [00:18<00:17, 290.60it/s] 48%|████████████████████████▋                           | 4630/9741 [00:18<00:16, 300.85it/s] 48%|████████████████████████▉                           | 4663/9741 [00:18<00:16, 308.44it/s] 48%|█████████████████████████                           | 4696/9741 [00:19<00:16, 313.37it/s] 49%|█████████████████████████▏                          | 4729/9741 [00:19<00:15, 317.69it/s] 49%|█████████████████████████▍                          | 4762/9741 [00:19<00:23, 214.12it/s] 49%|█████████████████████████▌                          | 4795/9741 [00:19<00:20, 238.40it/s] 50%|█████████████████████████▊                          | 4827/9741 [00:19<00:19, 257.42it/s] 50%|█████████████████████████▉                          | 4860/9741 [00:19<00:17, 273.76it/s] 50%|██████████████████████████                          | 4893/9741 [00:19<00:16, 287.58it/s] 51%|██████████████████████████▎                         | 4926/9741 [00:19<00:16, 297.73it/s] 51%|██████████████████████████▍                         | 4959/9741 [00:20<00:15, 304.35it/s] 51%|██████████████████████████▋                         | 4991/9741 [00:20<00:17, 272.93it/s] 52%|██████████████████████████▊                         | 5020/9741 [00:20<00:18, 251.90it/s] 52%|██████████████████████████▉                         | 5047/9741 [00:20<00:19, 238.18it/s] 52%|███████████████████████████                         | 5072/9741 [00:20<00:20, 232.02it/s] 52%|███████████████████████████▏                        | 5096/9741 [00:20<00:20, 223.18it/s] 53%|███████████████████████████▍                        | 5129/9741 [00:20<00:18, 249.20it/s] 53%|███████████████████████████▌                        | 5160/9741 [00:20<00:17, 264.89it/s] 53%|███████████████████████████▋                        | 5188/9741 [00:21<00:18, 242.23it/s] 54%|███████████████████████████▊                        | 5213/9741 [00:21<00:20, 224.83it/s] 54%|███████████████████████████▉                        | 5237/9741 [00:21<00:20, 221.90it/s] 54%|████████████████████████████                        | 5260/9741 [00:21<00:20, 220.34it/s] 54%|████████████████████████████▏                       | 5283/9741 [00:21<00:20, 218.71it/s] 54%|████████████████████████████▎                       | 5306/9741 [00:21<00:20, 217.11it/s] 55%|████████████████████████████▍                       | 5328/9741 [00:21<00:20, 216.96it/s] 55%|████████████████████████████▌                       | 5350/9741 [00:21<00:20, 215.68it/s] 55%|████████████████████████████▋                       | 5372/9741 [00:21<00:20, 215.76it/s] 55%|████████████████████████████▊                       | 5394/9741 [00:21<00:20, 215.98it/s] 56%|████████████████████████████▉                       | 5416/9741 [00:22<00:20, 212.74it/s] 56%|█████████████████████████████                       | 5438/9741 [00:22<00:20, 214.00it/s] 56%|█████████████████████████████▏                      | 5460/9741 [00:22<00:19, 214.63it/s] 56%|█████████████████████████████▎                      | 5483/9741 [00:22<00:19, 216.39it/s] 57%|█████████████████████████████▍                      | 5506/9741 [00:22<00:19, 218.07it/s] 57%|█████████████████████████████▌                      | 5529/9741 [00:22<00:19, 219.77it/s] 57%|█████████████████████████████▋                      | 5552/9741 [00:22<00:18, 220.76it/s] 57%|█████████████████████████████▊                      | 5586/9741 [00:22<00:16, 255.31it/s] 58%|██████████████████████████████                      | 5620/9741 [00:22<00:14, 280.21it/s] 58%|██████████████████████████████▏                     | 5654/9741 [00:23<00:13, 295.56it/s] 58%|██████████████████████████████▎                     | 5688/9741 [00:23<00:13, 308.63it/s] 59%|██████████████████████████████▌                     | 5722/9741 [00:23<00:12, 317.18it/s] 59%|██████████████████████████████▋                     | 5756/9741 [00:23<00:12, 323.54it/s] 59%|██████████████████████████████▉                     | 5790/9741 [00:23<00:12, 327.17it/s] 60%|███████████████████████████████                     | 5824/9741 [00:23<00:11, 330.54it/s] 60%|███████████████████████████████▎                    | 5858/9741 [00:23<00:11, 328.40it/s] 60%|███████████████████████████████▍                    | 5892/9741 [00:23<00:11, 331.46it/s] 61%|███████████████████████████████▋                    | 5926/9741 [00:23<00:11, 333.28it/s] 61%|███████████████████████████████▊                    | 5960/9741 [00:23<00:11, 335.13it/s] 62%|███████████████████████████████▉                    | 5994/9741 [00:24<00:11, 336.31it/s] 62%|████████████████████████████████▏                   | 6028/9741 [00:24<00:11, 336.30it/s] 62%|████████████████████████████████▎                   | 6063/9741 [00:24<00:10, 337.46it/s] 63%|████████████████████████████████▌                   | 6097/9741 [00:24<00:10, 334.60it/s] 63%|████████████████████████████████▋                   | 6131/9741 [00:24<00:10, 335.44it/s] 63%|████████████████████████████████▉                   | 6165/9741 [00:24<00:10, 336.78it/s] 64%|█████████████████████████████████                   | 6199/9741 [00:24<00:10, 337.04it/s] 64%|█████████████████████████████████▎                  | 6233/9741 [00:24<00:10, 337.42it/s] 64%|█████████████████████████████████▍                  | 6267/9741 [00:24<00:10, 338.03it/s] 65%|█████████████████████████████████▋                  | 6301/9741 [00:24<00:10, 338.04it/s] 65%|█████████████████████████████████▊                  | 6335/9741 [00:25<00:10, 336.18it/s] 65%|█████████████████████████████████▉                  | 6369/9741 [00:25<00:10, 336.83it/s] 66%|██████████████████████████████████▏                 | 6403/9741 [00:25<00:09, 337.28it/s] 66%|██████████████████████████████████▎                 | 6437/9741 [00:25<00:09, 337.89it/s] 66%|██████████████████████████████████▌                 | 6471/9741 [00:25<00:09, 337.08it/s] 67%|██████████████████████████████████▋                 | 6505/9741 [00:25<00:09, 337.39it/s] 67%|██████████████████████████████████▉                 | 6539/9741 [00:25<00:09, 333.89it/s] 67%|███████████████████████████████████                 | 6573/9741 [00:25<00:09, 333.85it/s] 68%|███████████████████████████████████▎                | 6607/9741 [00:25<00:09, 335.00it/s] 68%|███████████████████████████████████▍                | 6641/9741 [00:25<00:09, 336.06it/s] 69%|███████████████████████████████████▋                | 6675/9741 [00:26<00:09, 336.30it/s] 69%|███████████████████████████████████▊                | 6709/9741 [00:26<00:09, 336.66it/s] 69%|████████████████████████████████████                | 6744/9741 [00:26<00:08, 337.76it/s] 70%|████████████████████████████████████▏               | 6778/9741 [00:26<00:08, 335.60it/s] 70%|████████████████████████████████████▎               | 6812/9741 [00:26<00:08, 336.41it/s] 70%|████████████████████████████████████▌               | 6846/9741 [00:26<00:08, 337.29it/s] 71%|████████████████████████████████████▋               | 6880/9741 [00:26<00:08, 338.02it/s] 71%|████████████████████████████████████▉               | 6914/9741 [00:26<00:08, 337.67it/s] 71%|█████████████████████████████████████               | 6948/9741 [00:26<00:08, 338.18it/s] 72%|█████████████████████████████████████▎              | 6982/9741 [00:26<00:08, 338.29it/s] 72%|█████████████████████████████████████▍              | 7016/9741 [00:27<00:08, 335.63it/s] 72%|█████████████████████████████████████▋              | 7050/9741 [00:27<00:07, 336.84it/s] 73%|█████████████████████████████████████▊              | 7085/9741 [00:27<00:07, 337.76it/s] 73%|██████████████████████████████████████              | 7119/9741 [00:27<00:07, 338.18it/s] 73%|██████████████████████████████████████▏             | 7153/9741 [00:27<00:07, 337.90it/s] 74%|██████████████████████████████████████▎             | 7187/9741 [00:27<00:07, 338.12it/s] 74%|██████████████████████████████████████▌             | 7221/9741 [00:27<00:07, 336.06it/s] 74%|██████████████████████████████████████▋             | 7255/9741 [00:27<00:07, 336.44it/s] 75%|██████████████████████████████████████▉             | 7290/9741 [00:27<00:07, 337.62it/s] 75%|███████████████████████████████████████             | 7324/9741 [00:27<00:07, 338.02it/s] 76%|███████████████████████████████████████▎            | 7358/9741 [00:28<00:07, 338.54it/s] 76%|███████████████████████████████████████▍            | 7392/9741 [00:28<00:06, 337.43it/s] 76%|███████████████████████████████████████▋            | 7426/9741 [00:28<00:06, 337.09it/s] 77%|███████████████████████████████████████▊            | 7460/9741 [00:28<00:07, 285.55it/s] 77%|████████████████████████████████████████            | 7494/9741 [00:28<00:07, 299.20it/s] 77%|████████████████████████████████████████▏           | 7528/9741 [00:28<00:07, 309.82it/s] 78%|████████████████████████████████████████▎           | 7562/9741 [00:28<00:06, 317.97it/s] 78%|████████████████████████████████████████▌           | 7596/9741 [00:28<00:06, 323.94it/s] 78%|████████████████████████████████████████▋           | 7630/9741 [00:28<00:06, 327.93it/s] 79%|████████████████████████████████████████▉           | 7664/9741 [00:29<00:06, 330.99it/s] 79%|█████████████████████████████████████████           | 7698/9741 [00:29<00:06, 330.81it/s] 79%|█████████████████████████████████████████▎          | 7732/9741 [00:29<00:06, 333.27it/s] 80%|█████████████████████████████████████████▍          | 7766/9741 [00:29<00:05, 334.60it/s] 80%|█████████████████████████████████████████▋          | 7800/9741 [00:29<00:05, 336.03it/s] 80%|█████████████████████████████████████████▊          | 7834/9741 [00:29<00:05, 337.16it/s] 81%|██████████████████████████████████████████          | 7868/9741 [00:29<00:05, 337.88it/s] 81%|██████████████████████████████████████████▏         | 7902/9741 [00:29<00:05, 336.51it/s] 81%|██████████████████████████████████████████▎         | 7936/9741 [00:29<00:05, 337.46it/s] 82%|██████████████████████████████████████████▌         | 7970/9741 [00:29<00:05, 338.09it/s] 82%|██████████████████████████████████████████▋         | 8004/9741 [00:30<00:05, 338.34it/s] 83%|██████████████████████████████████████████▉         | 8038/9741 [00:30<00:05, 338.09it/s] 83%|███████████████████████████████████████████         | 8072/9741 [00:30<00:04, 338.13it/s] 83%|███████████████████████████████████████████▎        | 8106/9741 [00:30<00:04, 337.96it/s] 84%|███████████████████████████████████████████▍        | 8140/9741 [00:30<00:04, 335.97it/s] 84%|███████████████████████████████████████████▋        | 8174/9741 [00:30<00:04, 336.54it/s] 84%|███████████████████████████████████████████▊        | 8208/9741 [00:30<00:04, 336.90it/s] 85%|███████████████████████████████████████████▉        | 8242/9741 [00:30<00:04, 337.48it/s] 85%|████████████████████████████████████████████▏       | 8276/9741 [00:30<00:04, 337.18it/s] 85%|████████████████████████████████████████████▎       | 8310/9741 [00:30<00:04, 336.94it/s] 86%|████████████████████████████████████████████▌       | 8344/9741 [00:31<00:04, 337.10it/s] 86%|████████████████████████████████████████████▋       | 8378/9741 [00:31<00:04, 335.02it/s] 86%|████████████████████████████████████████████▉       | 8412/9741 [00:31<00:03, 335.63it/s] 87%|█████████████████████████████████████████████       | 8446/9741 [00:31<00:03, 336.59it/s] 87%|█████████████████████████████████████████████▎      | 8480/9741 [00:31<00:03, 336.72it/s] 87%|█████████████████████████████████████████████▍      | 8514/9741 [00:31<00:03, 336.56it/s] 88%|█████████████████████████████████████████████▋      | 8548/9741 [00:31<00:03, 336.13it/s] 88%|█████████████████████████████████████████████▊      | 8582/9741 [00:31<00:03, 334.27it/s] 88%|█████████████████████████████████████████████▉      | 8616/9741 [00:31<00:03, 335.10it/s] 89%|██████████████████████████████████████████████▏     | 8650/9741 [00:31<00:03, 336.03it/s] 89%|██████████████████████████████████████████████▎     | 8684/9741 [00:32<00:03, 336.71it/s] 89%|██████████████████████████████████████████████▌     | 8718/9741 [00:32<00:03, 337.24it/s] 90%|██████████████████████████████████████████████▋     | 8752/9741 [00:32<00:02, 337.43it/s] 90%|██████████████████████████████████████████████▉     | 8786/9741 [00:32<00:02, 336.64it/s] 91%|███████████████████████████████████████████████     | 8820/9741 [00:32<00:02, 334.64it/s] 91%|███████████████████████████████████████████████▎    | 8854/9741 [00:32<00:02, 335.74it/s] 91%|███████████████████████████████████████████████▍    | 8888/9741 [00:32<00:02, 336.66it/s] 92%|███████████████████████████████████████████████▋    | 8922/9741 [00:32<00:02, 337.16it/s] 92%|███████████████████████████████████████████████▊    | 8956/9741 [00:32<00:02, 337.83it/s] 92%|███████████████████████████████████████████████▉    | 8990/9741 [00:32<00:02, 334.19it/s] 93%|████████████████████████████████████████████████▏   | 9024/9741 [00:33<00:02, 334.73it/s] 93%|████████████████████████████████████████████████▎   | 9058/9741 [00:33<00:02, 333.50it/s] 93%|████████████████████████████████████████████████▌   | 9092/9741 [00:33<00:01, 335.00it/s] 94%|████████████████████████████████████████████████▋   | 9126/9741 [00:33<00:01, 336.16it/s] 94%|████████████████████████████████████████████████▉   | 9160/9741 [00:33<00:01, 336.90it/s] 94%|█████████████████████████████████████████████████   | 9194/9741 [00:33<00:01, 337.54it/s] 95%|█████████████████████████████████████████████████▎  | 9228/9741 [00:33<00:01, 337.56it/s] 95%|█████████████████████████████████████████████████▍  | 9262/9741 [00:33<00:01, 335.25it/s] 95%|█████████████████████████████████████████████████▌  | 9296/9741 [00:33<00:01, 336.29it/s] 96%|█████████████████████████████████████████████████▊  | 9330/9741 [00:33<00:01, 336.87it/s] 96%|█████████████████████████████████████████████████▉  | 9364/9741 [00:34<00:01, 337.02it/s] 96%|██████████████████████████████████████████████████▏ | 9398/9741 [00:34<00:01, 337.02it/s] 97%|██████████████████████████████████████████████████▎ | 9432/9741 [00:34<00:00, 337.21it/s] 97%|██████████████████████████████████████████████████▌ | 9466/9741 [00:34<00:00, 336.21it/s] 98%|██████████████████████████████████████████████████▋ | 9500/9741 [00:34<00:00, 334.61it/s] 98%|██████████████████████████████████████████████████▉ | 9534/9741 [00:34<00:00, 335.76it/s] 98%|███████████████████████████████████████████████████ | 9568/9741 [00:34<00:00, 336.02it/s] 99%|███████████████████████████████████████████████████▎| 9602/9741 [00:34<00:00, 336.60it/s] 99%|███████████████████████████████████████████████████▍| 9636/9741 [00:34<00:00, 337.29it/s] 99%|███████████████████████████████████████████████████▌| 9670/9741 [00:34<00:00, 337.54it/s]100%|███████████████████████████████████████████████████▊| 9704/9741 [00:35<00:00, 337.21it/s]100%|███████████████████████████████████████████████████▉| 9738/9741 [00:35<00:00, 335.50it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:35<00:00, 276.71it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.50s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.20s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.02s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.35s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:06<00:12,  6.00s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.39s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.40s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.58s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.73s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.18s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.22s/it]
Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.78s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.05s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.27s/it]
[2023-08-22 05:32:05,133] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 05:32:14,066] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 05:32:14,067] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 05:32:14,068] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 05:32:14,068] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 05:32:14,068] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 05:32:14,068] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f6620236fd0>
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 05:32:14,069] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f661f370220>
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 05:32:14,070] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 05:32:14,071] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 05:32:14,071] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 05:32:14,071] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 05:32:14,071] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 05:32:14,071] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 05:32:14,071] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 05:32:14,071] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 05:32:14,071] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 05:32:14,071] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 05:32:14,071] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5873355865478516 seconds
Loading extension module utils...
Time to load utils op: 0.5048964023590088 seconds
Loading extension module utils...
Time to load utils op: 0.5041120052337646 seconds
Loading extension module utils...
Time to load utils op: 0.5056130886077881 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input: Sam, Sid, and Steve brought popsicle sticks for their group activity in their Art class. Sam has thrice as many as Sid, and Sid has twice as many as Steve. If Steve has 12 popsicle sticks, how many popsicle sticks can they use for their Art class activity?
Output: 108

Input: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.
Output: 720

Input: John uses a 75-watt electric fan for 8 hours a day. How much kWh of electric energy does he consume per month (30 days) for using the electric fan?
Output: 18

Input: Barbara Blackburn can type 212 words per minute.  Due to Carpal tunnel syndrome, Barbara cannot use her left hand for a while so her typing speed is now 40 words less per minute. If she is supposed to type a document with 3440 words, how many minutes will it take her to finish typing the document?
Output: 20

Input: Max fills up water balloons for 30 minutes at a rate of 2 water balloons every minute. Max’s friend Zach fills up water balloons for 40 minutes at a rate of 3 water balloons every minute. In the process, 10 of the water balloons pop on the ground. How many filled water balloons do Max and Zach have in total?
Output: 170

Input: John has 54 pieces of gum, Cole has 45 pieces of gum and Aubrey has no pieces of gum. They decide to share the gum equally between the 3 of them. How many pieces of gum will each one get?
Output: 33

Input: Mira jogs every morning. She jogs 5 miles per hour. If she jogs for 2 hours every morning, how many miles can she jog for five days?
Output: 50

Input: Rita is reading a five-chapter book with 95 pages. Each chapter has three pages more than the previous one. How many pages does the first chapter have?
Output: 13

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o21-tgsm8k-s20-rFalse
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 3568397 closing signal SIGTERM
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 3568399 closing signal SIGTERM
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 3568400 closing signal SIGTERM
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 1 (pid: 3568398) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
  <NO_OTHER_FAILURES>
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-22_05:32:18
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3568398)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o22-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 22
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 05:32:23,028] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o22-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 22
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o22-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 21/9741 [00:00<00:47, 202.64it/s]  0%|▏                                                     | 42/9741 [00:00<00:47, 202.96it/s]  1%|▎                                                     | 63/9741 [00:00<00:47, 203.17it/s]  1%|▍                                                     | 84/9741 [00:00<00:47, 204.42it/s]  1%|▌                                                    | 105/9741 [00:00<00:46, 205.47it/s]  1%|▋                                                    | 126/9741 [00:00<00:46, 205.85it/s]  2%|▊                                                    | 147/9741 [00:00<00:47, 202.79it/s]  2%|▉                                                    | 168/9741 [00:00<00:46, 203.79it/s]  2%|█                                                    | 189/9741 [00:00<00:46, 204.28it/s]  2%|█▏                                                   | 210/9741 [00:01<00:46, 203.21it/s]  2%|█▎                                                   | 231/9741 [00:01<00:46, 204.14it/s]  3%|█▎                                                   | 252/9741 [00:01<00:46, 204.75it/s]  3%|█▍                                                   | 273/9741 [00:01<00:46, 205.17it/s]  3%|█▌                                                   | 294/9741 [00:01<00:45, 205.42it/s]  3%|█▋                                                   | 315/9741 [00:01<00:45, 205.72it/s]  3%|█▊                                                   | 336/9741 [00:01<00:45, 205.77it/s]  4%|█▉                                                   | 364/9741 [00:01<00:41, 226.53it/s]  4%|██▏                                                  | 396/9741 [00:01<00:36, 252.90it/s]  4%|██▎                                                  | 427/9741 [00:01<00:34, 267.58it/s]  5%|██▍                                                  | 459/9741 [00:02<00:32, 281.32it/s]  5%|██▋                                                  | 491/9741 [00:02<00:31, 290.46it/s]  5%|██▊                                                  | 523/9741 [00:02<00:30, 297.36it/s]  6%|███                                                  | 555/9741 [00:02<00:30, 302.24it/s]  6%|███▏                                                 | 587/9741 [00:02<00:29, 305.64it/s]  6%|███▎                                                 | 619/9741 [00:02<00:29, 307.90it/s]  7%|███▌                                                 | 651/9741 [00:02<00:29, 309.76it/s]  7%|███▋                                                 | 682/9741 [00:02<00:29, 308.34it/s]  7%|███▉                                                 | 714/9741 [00:02<00:29, 309.45it/s]  8%|████                                                 | 746/9741 [00:02<00:28, 310.45it/s]  8%|████▏                                                | 778/9741 [00:03<00:28, 311.22it/s]  8%|████▍                                                | 810/9741 [00:03<00:28, 311.63it/s]  9%|████▌                                                | 842/9741 [00:03<00:28, 311.78it/s]  9%|████▊                                                | 874/9741 [00:03<00:28, 312.06it/s]  9%|████▉                                                | 906/9741 [00:03<00:28, 310.02it/s] 10%|█████                                                | 938/9741 [00:03<00:28, 310.64it/s] 10%|█████▎                                               | 970/9741 [00:03<00:28, 310.99it/s] 10%|█████▎                                              | 1002/9741 [00:03<00:28, 311.17it/s] 11%|█████▌                                              | 1034/9741 [00:03<00:27, 311.60it/s] 11%|█████▋                                              | 1066/9741 [00:03<00:27, 311.93it/s] 11%|█████▊                                              | 1098/9741 [00:04<00:27, 311.32it/s] 12%|██████                                              | 1130/9741 [00:04<00:27, 309.77it/s] 12%|██████▏                                             | 1162/9741 [00:04<00:27, 310.53it/s] 12%|██████▎                                             | 1194/9741 [00:04<00:27, 311.05it/s] 13%|██████▌                                             | 1226/9741 [00:04<00:27, 310.92it/s] 13%|██████▋                                             | 1258/9741 [00:04<00:27, 311.42it/s] 13%|██████▉                                             | 1290/9741 [00:04<00:27, 311.77it/s] 14%|███████                                             | 1322/9741 [00:04<00:26, 312.08it/s] 14%|███████▏                                            | 1354/9741 [00:04<00:27, 310.17it/s] 14%|███████▍                                            | 1386/9741 [00:05<00:26, 310.65it/s] 15%|███████▌                                            | 1418/9741 [00:05<00:26, 310.91it/s] 15%|███████▋                                            | 1450/9741 [00:05<00:26, 311.11it/s] 15%|███████▉                                            | 1482/9741 [00:05<00:26, 309.30it/s] 16%|████████                                            | 1514/9741 [00:05<00:26, 309.97it/s] 16%|████████▎                                           | 1546/9741 [00:05<00:26, 310.86it/s] 16%|████████▍                                           | 1578/9741 [00:05<00:26, 308.73it/s] 17%|████████▌                                           | 1610/9741 [00:05<00:26, 309.18it/s] 17%|████████▊                                           | 1642/9741 [00:05<00:26, 310.22it/s] 17%|████████▉                                           | 1674/9741 [00:05<00:25, 310.95it/s] 18%|█████████                                           | 1706/9741 [00:06<00:25, 311.40it/s] 18%|█████████▎                                          | 1738/9741 [00:06<00:25, 311.43it/s] 18%|█████████▍                                          | 1770/9741 [00:06<00:25, 311.72it/s] 18%|█████████▌                                          | 1802/9741 [00:06<00:27, 291.24it/s] 19%|█████████▊                                          | 1834/9741 [00:06<00:26, 297.10it/s] 19%|█████████▉                                          | 1866/9741 [00:06<00:26, 301.16it/s] 19%|██████████▏                                         | 1897/9741 [00:06<00:26, 301.15it/s] 20%|██████████▎                                         | 1928/9741 [00:06<00:25, 303.56it/s] 20%|██████████▍                                         | 1959/9741 [00:06<00:25, 305.21it/s] 20%|██████████▋                                         | 1991/9741 [00:07<00:25, 306.82it/s] 21%|██████████▊                                         | 2022/9741 [00:07<00:25, 305.02it/s] 21%|██████████▉                                         | 2053/9741 [00:07<00:25, 306.29it/s] 21%|███████████                                         | 2084/9741 [00:07<00:24, 307.23it/s] 22%|███████████▎                                        | 2116/9741 [00:07<00:24, 308.14it/s] 22%|███████████▍                                        | 2147/9741 [00:07<00:24, 308.60it/s] 22%|███████████▋                                        | 2179/9741 [00:07<00:24, 309.22it/s] 23%|███████████▊                                        | 2210/9741 [00:07<00:24, 309.42it/s] 23%|███████████▉                                        | 2242/9741 [00:07<00:24, 309.69it/s] 23%|████████████▏                                       | 2273/9741 [00:07<00:24, 307.87it/s] 24%|████████████▎                                       | 2304/9741 [00:08<00:24, 306.84it/s] 24%|████████████▍                                       | 2335/9741 [00:08<00:24, 306.95it/s] 24%|████████████▋                                       | 2367/9741 [00:08<00:23, 307.97it/s] 25%|████████████▊                                       | 2399/9741 [00:08<00:23, 308.70it/s] 25%|████████████▉                                       | 2431/9741 [00:08<00:23, 309.39it/s] 25%|█████████████▏                                      | 2463/9741 [00:08<00:23, 309.76it/s] 26%|█████████████▎                                      | 2494/9741 [00:08<00:23, 307.29it/s] 26%|█████████████▍                                      | 2525/9741 [00:08<00:23, 307.99it/s] 26%|█████████████▋                                      | 2556/9741 [00:08<00:23, 308.43it/s] 27%|█████████████▊                                      | 2588/9741 [00:08<00:23, 309.27it/s] 27%|█████████████▉                                      | 2620/9741 [00:09<00:22, 309.62it/s] 27%|██████████████▏                                     | 2651/9741 [00:09<00:22, 309.55it/s] 28%|██████████████▎                                     | 2682/9741 [00:09<00:22, 309.50it/s] 28%|██████████████▍                                     | 2713/9741 [00:09<00:22, 307.37it/s] 28%|██████████████▋                                     | 2744/9741 [00:09<00:22, 308.02it/s] 28%|██████████████▊                                     | 2775/9741 [00:09<00:22, 308.48it/s] 29%|██████████████▉                                     | 2806/9741 [00:09<00:22, 308.13it/s] 29%|███████████████▏                                    | 2837/9741 [00:09<00:22, 308.51it/s] 29%|███████████████▎                                    | 2869/9741 [00:09<00:22, 309.04it/s] 30%|███████████████▍                                    | 2900/9741 [00:09<00:22, 309.21it/s] 30%|███████████████▋                                    | 2931/9741 [00:10<00:22, 307.47it/s] 30%|███████████████▊                                    | 2962/9741 [00:10<00:22, 307.21it/s] 31%|███████████████▉                                    | 2994/9741 [00:10<00:21, 308.12it/s] 31%|████████████████▏                                   | 3025/9741 [00:10<00:21, 308.59it/s] 31%|████████████████▎                                   | 3056/9741 [00:10<00:21, 308.72it/s] 32%|████████████████▍                                   | 3087/9741 [00:10<00:21, 308.94it/s] 32%|████████████████▋                                   | 3118/9741 [00:10<00:21, 309.13it/s] 32%|████████████████▊                                   | 3149/9741 [00:10<00:21, 308.95it/s] 33%|████████████████▉                                   | 3180/9741 [00:10<00:21, 307.26it/s] 33%|█████████████████▏                                  | 3211/9741 [00:10<00:21, 308.04it/s] 33%|█████████████████▎                                  | 3243/9741 [00:11<00:21, 308.76it/s] 34%|█████████████████▍                                  | 3275/9741 [00:11<00:20, 309.21it/s] 34%|█████████████████▋                                  | 3306/9741 [00:11<00:20, 309.22it/s] 34%|█████████████████▊                                  | 3337/9741 [00:11<00:20, 309.11it/s] 35%|█████████████████▉                                  | 3368/9741 [00:11<00:20, 309.36it/s] 35%|██████████████████▏                                 | 3399/9741 [00:11<00:20, 307.41it/s] 35%|██████████████████▎                                 | 3430/9741 [00:11<00:20, 308.14it/s] 36%|██████████████████▍                                 | 3461/9741 [00:11<00:20, 308.48it/s] 36%|██████████████████▋                                 | 3492/9741 [00:11<00:20, 308.60it/s] 36%|██████████████████▊                                 | 3523/9741 [00:11<00:20, 308.72it/s] 36%|██████████████████▉                                 | 3554/9741 [00:12<00:20, 308.96it/s] 37%|███████████████████▏                                | 3585/9741 [00:12<00:19, 308.41it/s] 37%|███████████████████▎                                | 3616/9741 [00:12<00:19, 306.55it/s] 37%|███████████████████▍                                | 3647/9741 [00:12<00:19, 307.43it/s] 38%|███████████████████▋                                | 3678/9741 [00:12<00:19, 307.92it/s] 38%|███████████████████▊                                | 3709/9741 [00:12<00:19, 308.45it/s] 38%|███████████████████▉                                | 3741/9741 [00:12<00:19, 308.87it/s] 39%|████████████████████▏                               | 3772/9741 [00:12<00:19, 309.17it/s] 39%|████████████████████▎                               | 3803/9741 [00:12<00:19, 309.24it/s] 39%|████████████████████▍                               | 3834/9741 [00:12<00:19, 307.34it/s] 40%|████████████████████▋                               | 3865/9741 [00:13<00:19, 307.48it/s] 40%|████████████████████▊                               | 3897/9741 [00:13<00:18, 308.31it/s] 40%|████████████████████▉                               | 3928/9741 [00:13<00:18, 308.49it/s] 41%|█████████████████████▏                              | 3959/9741 [00:13<00:18, 308.66it/s] 41%|█████████████████████▎                              | 3990/9741 [00:13<00:18, 308.75it/s] 41%|█████████████████████▍                              | 4021/9741 [00:13<00:18, 309.12it/s] 42%|█████████████████████▋                              | 4052/9741 [00:13<00:18, 309.15it/s] 42%|█████████████████████▊                              | 4083/9741 [00:13<00:18, 307.29it/s] 42%|█████████████████████▉                              | 4114/9741 [00:13<00:18, 307.98it/s] 43%|██████████████████████▏                             | 4145/9741 [00:13<00:18, 308.40it/s] 43%|██████████████████████▎                             | 4176/9741 [00:14<00:18, 308.51it/s] 43%|██████████████████████▍                             | 4207/9741 [00:14<00:17, 307.86it/s] 44%|██████████████████████▌                             | 4238/9741 [00:14<00:17, 308.25it/s] 44%|██████████████████████▊                             | 4269/9741 [00:14<00:17, 308.66it/s] 44%|██████████████████████▉                             | 4300/9741 [00:14<00:17, 306.97it/s] 44%|███████████████████████                             | 4331/9741 [00:14<00:17, 307.73it/s] 45%|███████████████████████▎                            | 4362/9741 [00:14<00:17, 308.04it/s] 45%|███████████████████████▍                            | 4393/9741 [00:14<00:17, 307.76it/s] 45%|███████████████████████▌                            | 4424/9741 [00:14<00:17, 308.10it/s] 46%|███████████████████████▊                            | 4455/9741 [00:14<00:17, 308.15it/s] 46%|███████████████████████▉                            | 4486/9741 [00:15<00:17, 308.35it/s] 46%|████████████████████████                            | 4517/9741 [00:15<00:18, 282.60it/s] 47%|████████████████████████▎                           | 4548/9741 [00:15<00:17, 290.01it/s] 47%|████████████████████████▍                           | 4579/9741 [00:15<00:17, 294.78it/s] 47%|████████████████████████▌                           | 4610/9741 [00:15<00:17, 299.02it/s] 48%|████████████████████████▊                           | 4641/9741 [00:15<00:16, 301.84it/s] 48%|████████████████████████▉                           | 4672/9741 [00:15<00:16, 303.74it/s] 48%|█████████████████████████                           | 4703/9741 [00:15<00:16, 305.37it/s] 49%|█████████████████████████▎                          | 4734/9741 [00:15<00:16, 306.38it/s] 49%|█████████████████████████▍                          | 4765/9741 [00:16<00:24, 204.13it/s] 49%|█████████████████████████▌                          | 4796/9741 [00:16<00:21, 227.22it/s] 50%|█████████████████████████▊                          | 4827/9741 [00:16<00:19, 246.60it/s] 50%|█████████████████████████▉                          | 4857/9741 [00:16<00:18, 259.49it/s] 50%|██████████████████████████                          | 4888/9741 [00:16<00:17, 272.30it/s] 50%|██████████████████████████▎                         | 4919/9741 [00:16<00:17, 282.40it/s] 51%|██████████████████████████▍                         | 4950/9741 [00:16<00:16, 288.15it/s] 51%|██████████████████████████▌                         | 4981/9741 [00:16<00:16, 293.95it/s] 51%|██████████████████████████▊                         | 5012/9741 [00:17<00:15, 298.17it/s] 52%|██████████████████████████▉                         | 5043/9741 [00:17<00:15, 301.41it/s] 52%|███████████████████████████                         | 5074/9741 [00:17<00:15, 303.32it/s] 52%|███████████████████████████▎                        | 5105/9741 [00:17<00:15, 304.83it/s] 53%|███████████████████████████▍                        | 5136/9741 [00:17<00:15, 305.85it/s] 53%|███████████████████████████▌                        | 5167/9741 [00:17<00:14, 306.81it/s] 53%|███████████████████████████▋                        | 5198/9741 [00:17<00:14, 304.96it/s] 54%|███████████████████████████▉                        | 5229/9741 [00:17<00:14, 305.93it/s] 54%|████████████████████████████                        | 5260/9741 [00:17<00:14, 306.81it/s] 54%|████████████████████████████▏                       | 5291/9741 [00:17<00:14, 307.32it/s] 55%|████████████████████████████▍                       | 5322/9741 [00:18<00:14, 307.65it/s] 55%|████████████████████████████▌                       | 5353/9741 [00:18<00:14, 305.22it/s] 55%|████████████████████████████▋                       | 5384/9741 [00:18<00:14, 305.57it/s] 56%|████████████████████████████▉                       | 5415/9741 [00:18<00:14, 304.22it/s] 56%|█████████████████████████████                       | 5446/9741 [00:18<00:14, 305.41it/s] 56%|█████████████████████████████▏                      | 5478/9741 [00:18<00:13, 306.85it/s] 57%|█████████████████████████████▍                      | 5510/9741 [00:18<00:13, 310.09it/s] 57%|█████████████████████████████▌                      | 5542/9741 [00:18<00:13, 312.27it/s] 57%|█████████████████████████████▊                      | 5574/9741 [00:18<00:13, 313.87it/s] 58%|█████████████████████████████▉                      | 5606/9741 [00:18<00:13, 314.58it/s] 58%|██████████████████████████████                      | 5638/9741 [00:19<00:13, 313.65it/s] 58%|██████████████████████████████▎                     | 5670/9741 [00:19<00:12, 314.81it/s] 59%|██████████████████████████████▍                     | 5702/9741 [00:19<00:12, 315.59it/s] 59%|██████████████████████████████▌                     | 5734/9741 [00:19<00:12, 316.30it/s] 59%|██████████████████████████████▊                     | 5766/9741 [00:19<00:12, 316.46it/s] 60%|██████████████████████████████▉                     | 5798/9741 [00:19<00:12, 316.97it/s] 60%|███████████████████████████████                     | 5830/9741 [00:19<00:12, 317.00it/s] 60%|███████████████████████████████▎                    | 5862/9741 [00:19<00:12, 314.64it/s] 61%|███████████████████████████████▍                    | 5894/9741 [00:19<00:12, 312.97it/s] 61%|███████████████████████████████▋                    | 5926/9741 [00:19<00:12, 314.42it/s] 61%|███████████████████████████████▊                    | 5959/9741 [00:20<00:11, 316.26it/s] 62%|███████████████████████████████▉                    | 5992/9741 [00:20<00:11, 317.48it/s] 62%|████████████████████████████████▏                   | 6024/9741 [00:20<00:11, 317.13it/s] 62%|████████████████████████████████▎                   | 6057/9741 [00:20<00:11, 318.08it/s] 63%|████████████████████████████████▌                   | 6089/9741 [00:20<00:11, 316.44it/s] 63%|████████████████████████████████▋                   | 6122/9741 [00:20<00:11, 317.60it/s] 63%|████████████████████████████████▊                   | 6154/9741 [00:20<00:11, 318.09it/s] 64%|█████████████████████████████████                   | 6187/9741 [00:20<00:11, 318.71it/s] 64%|█████████████████████████████████▏                  | 6219/9741 [00:20<00:11, 318.89it/s] 64%|█████████████████████████████████▎                  | 6251/9741 [00:20<00:10, 318.69it/s] 65%|█████████████████████████████████▌                  | 6283/9741 [00:21<00:10, 318.98it/s] 65%|█████████████████████████████████▋                  | 6315/9741 [00:21<00:10, 317.14it/s] 65%|█████████████████████████████████▉                  | 6348/9741 [00:21<00:10, 318.15it/s] 66%|██████████████████████████████████                  | 6381/9741 [00:21<00:10, 318.80it/s] 66%|██████████████████████████████████▏                 | 6414/9741 [00:21<00:10, 319.17it/s] 66%|██████████████████████████████████▍                 | 6446/9741 [00:21<00:10, 316.55it/s] 67%|██████████████████████████████████▌                 | 6478/9741 [00:21<00:10, 317.11it/s] 67%|██████████████████████████████████▊                 | 6510/9741 [00:21<00:10, 317.82it/s] 67%|██████████████████████████████████▉                 | 6542/9741 [00:21<00:10, 315.06it/s] 67%|███████████████████████████████████                 | 6574/9741 [00:21<00:10, 316.48it/s] 68%|███████████████████████████████████▎                | 6606/9741 [00:22<00:09, 317.26it/s] 68%|███████████████████████████████████▍                | 6639/9741 [00:22<00:09, 318.15it/s] 68%|███████████████████████████████████▌                | 6671/9741 [00:22<00:09, 318.06it/s] 69%|███████████████████████████████████▊                | 6703/9741 [00:22<00:09, 318.32it/s] 69%|███████████████████████████████████▉                | 6736/9741 [00:22<00:09, 318.91it/s] 69%|████████████████████████████████████▏               | 6768/9741 [00:22<00:09, 317.29it/s] 70%|████████████████████████████████████▎               | 6800/9741 [00:22<00:09, 317.97it/s] 70%|████████████████████████████████████▍               | 6833/9741 [00:22<00:09, 318.71it/s] 70%|████████████████████████████████████▋               | 6866/9741 [00:22<00:09, 319.31it/s] 71%|████████████████████████████████████▊               | 6899/9741 [00:22<00:08, 319.72it/s] 71%|████████████████████████████████████▉               | 6931/9741 [00:23<00:08, 319.72it/s] 71%|█████████████████████████████████████▏              | 6964/9741 [00:23<00:08, 319.94it/s] 72%|█████████████████████████████████████▎              | 6996/9741 [00:23<00:08, 314.54it/s] 72%|█████████████████████████████████████▌              | 7028/9741 [00:23<00:08, 315.70it/s] 72%|█████████████████████████████████████▋              | 7060/9741 [00:23<00:08, 316.94it/s] 73%|█████████████████████████████████████▊              | 7093/9741 [00:23<00:08, 318.04it/s] 73%|██████████████████████████████████████              | 7125/9741 [00:23<00:08, 318.58it/s] 73%|██████████████████████████████████████▏             | 7158/9741 [00:23<00:08, 319.19it/s] 74%|██████████████████████████████████████▍             | 7191/9741 [00:23<00:07, 319.45it/s] 74%|██████████████████████████████████████▌             | 7223/9741 [00:24<00:07, 317.53it/s] 74%|██████████████████████████████████████▋             | 7256/9741 [00:24<00:07, 318.37it/s] 75%|██████████████████████████████████████▉             | 7289/9741 [00:24<00:07, 318.84it/s] 75%|███████████████████████████████████████             | 7321/9741 [00:24<00:07, 318.61it/s] 75%|███████████████████████████████████████▎            | 7353/9741 [00:24<00:07, 318.71it/s] 76%|███████████████████████████████████████▍            | 7385/9741 [00:24<00:07, 319.00it/s] 76%|███████████████████████████████████████▌            | 7417/9741 [00:24<00:07, 318.95it/s] 76%|███████████████████████████████████████▊            | 7449/9741 [00:24<00:08, 280.28it/s] 77%|███████████████████████████████████████▉            | 7481/9741 [00:24<00:07, 290.74it/s] 77%|████████████████████████████████████████            | 7513/9741 [00:24<00:07, 298.00it/s] 77%|████████████████████████████████████████▎           | 7545/9741 [00:25<00:07, 303.84it/s] 78%|████████████████████████████████████████▍           | 7577/9741 [00:25<00:07, 308.43it/s] 78%|████████████████████████████████████████▌           | 7609/9741 [00:25<00:06, 311.72it/s] 78%|████████████████████████████████████████▊           | 7641/9741 [00:25<00:06, 314.10it/s] 79%|████████████████████████████████████████▉           | 7673/9741 [00:25<00:06, 313.45it/s] 79%|█████████████████████████████████████████▏          | 7706/9741 [00:25<00:06, 315.56it/s] 79%|█████████████████████████████████████████▎          | 7739/9741 [00:25<00:06, 316.97it/s] 80%|█████████████████████████████████████████▍          | 7771/9741 [00:25<00:06, 316.71it/s] 80%|█████████████████████████████████████████▋          | 7803/9741 [00:25<00:06, 317.43it/s] 80%|█████████████████████████████████████████▊          | 7836/9741 [00:25<00:05, 318.23it/s] 81%|██████████████████████████████████████████          | 7868/9741 [00:26<00:05, 318.74it/s] 81%|██████████████████████████████████████████▏         | 7900/9741 [00:26<00:05, 317.11it/s] 81%|██████████████████████████████████████████▎         | 7932/9741 [00:26<00:05, 317.37it/s] 82%|██████████████████████████████████████████▌         | 7965/9741 [00:26<00:05, 318.48it/s] 82%|██████████████████████████████████████████▋         | 7997/9741 [00:26<00:05, 318.74it/s] 82%|██████████████████████████████████████████▊         | 8029/9741 [00:26<00:05, 319.11it/s] 83%|███████████████████████████████████████████         | 8061/9741 [00:26<00:05, 319.22it/s] 83%|███████████████████████████████████████████▏        | 8094/9741 [00:26<00:05, 319.69it/s] 83%|███████████████████████████████████████████▍        | 8126/9741 [00:26<00:05, 317.85it/s] 84%|███████████████████████████████████████████▌        | 8159/9741 [00:27<00:04, 318.54it/s] 84%|███████████████████████████████████████████▋        | 8191/9741 [00:27<00:04, 318.54it/s] 84%|███████████████████████████████████████████▉        | 8223/9741 [00:27<00:04, 317.10it/s] 85%|████████████████████████████████████████████        | 8255/9741 [00:27<00:04, 317.82it/s] 85%|████████████████████████████████████████████▏       | 8287/9741 [00:27<00:04, 317.96it/s] 85%|████████████████████████████████████████████▍       | 8319/9741 [00:27<00:04, 318.51it/s] 86%|████████████████████████████████████████████▌       | 8351/9741 [00:27<00:04, 316.80it/s] 86%|████████████████████████████████████████████▊       | 8384/9741 [00:27<00:04, 317.71it/s] 86%|████████████████████████████████████████████▉       | 8416/9741 [00:27<00:04, 318.30it/s] 87%|█████████████████████████████████████████████       | 8449/9741 [00:27<00:04, 318.90it/s] 87%|█████████████████████████████████████████████▎      | 8482/9741 [00:28<00:03, 319.39it/s] 87%|█████████████████████████████████████████████▍      | 8514/9741 [00:28<00:03, 319.54it/s] 88%|█████████████████████████████████████████████▌      | 8546/9741 [00:28<00:03, 319.54it/s] 88%|█████████████████████████████████████████████▊      | 8578/9741 [00:28<00:03, 316.48it/s] 88%|█████████████████████████████████████████████▉      | 8610/9741 [00:28<00:03, 317.28it/s] 89%|██████████████████████████████████████████████▏     | 8642/9741 [00:28<00:03, 317.83it/s] 89%|██████████████████████████████████████████████▎     | 8674/9741 [00:28<00:03, 318.37it/s] 89%|██████████████████████████████████████████████▍     | 8706/9741 [00:28<00:03, 318.80it/s] 90%|██████████████████████████████████████████████▋     | 8738/9741 [00:28<00:03, 319.13it/s] 90%|██████████████████████████████████████████████▊     | 8770/9741 [00:28<00:03, 319.30it/s] 90%|██████████████████████████████████████████████▉     | 8802/9741 [00:29<00:02, 317.06it/s] 91%|███████████████████████████████████████████████▏    | 8834/9741 [00:29<00:02, 317.55it/s] 91%|███████████████████████████████████████████████▎    | 8866/9741 [00:29<00:02, 318.22it/s] 91%|███████████████████████████████████████████████▍    | 8898/9741 [00:29<00:02, 318.25it/s] 92%|███████████████████████████████████████████████▋    | 8931/9741 [00:29<00:02, 318.85it/s] 92%|███████████████████████████████████████████████▊    | 8963/9741 [00:29<00:02, 318.90it/s] 92%|████████████████████████████████████████████████    | 8996/9741 [00:29<00:02, 319.22it/s] 93%|████████████████████████████████████████████████▏   | 9028/9741 [00:29<00:02, 316.93it/s] 93%|████████████████████████████████████████████████▎   | 9060/9741 [00:29<00:02, 317.39it/s] 93%|████████████████████████████████████████████████▌   | 9092/9741 [00:29<00:02, 318.10it/s] 94%|████████████████████████████████████████████████▋   | 9124/9741 [00:30<00:01, 318.53it/s] 94%|████████████████████████████████████████████████▉   | 9156/9741 [00:30<00:01, 318.87it/s] 94%|█████████████████████████████████████████████████   | 9189/9741 [00:30<00:01, 319.45it/s] 95%|█████████████████████████████████████████████████▏  | 9221/9741 [00:30<00:01, 319.16it/s] 95%|█████████████████████████████████████████████████▍  | 9253/9741 [00:30<00:01, 319.25it/s] 95%|█████████████████████████████████████████████████▌  | 9285/9741 [00:30<00:01, 317.28it/s] 96%|█████████████████████████████████████████████████▋  | 9317/9741 [00:30<00:01, 317.81it/s] 96%|█████████████████████████████████████████████████▉  | 9349/9741 [00:30<00:01, 318.03it/s] 96%|██████████████████████████████████████████████████  | 9382/9741 [00:30<00:01, 318.56it/s] 97%|██████████████████████████████████████████████████▎ | 9414/9741 [00:30<00:01, 318.62it/s] 97%|██████████████████████████████████████████████████▍ | 9446/9741 [00:31<00:00, 318.48it/s] 97%|██████████████████████████████████████████████████▌ | 9478/9741 [00:31<00:00, 318.46it/s] 98%|██████████████████████████████████████████████████▊ | 9510/9741 [00:31<00:00, 316.54it/s] 98%|██████████████████████████████████████████████████▉ | 9542/9741 [00:31<00:00, 317.34it/s] 98%|███████████████████████████████████████████████████ | 9574/9741 [00:31<00:00, 318.05it/s] 99%|███████████████████████████████████████████████████▎| 9606/9741 [00:31<00:00, 317.74it/s] 99%|███████████████████████████████████████████████████▍| 9638/9741 [00:31<00:00, 318.04it/s] 99%|███████████████████████████████████████████████████▌| 9670/9741 [00:31<00:00, 318.15it/s]100%|███████████████████████████████████████████████████▊| 9702/9741 [00:31<00:00, 318.38it/s]100%|███████████████████████████████████████████████████▉| 9734/9741 [00:31<00:00, 316.16it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:31<00:00, 304.63it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.03s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.45s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.60s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.64s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.91s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.27s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.44s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.48s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.30s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.65s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.99s/it]
[2023-08-22 05:33:47,855] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.83s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]
[2023-08-22 05:33:58,865] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 05:33:58,867] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 05:33:58,867] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 05:33:58,867] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 05:33:58,867] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 05:33:58,867] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f0add0e0fd0>
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 05:33:58,868] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f0adc7bb220>
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 05:33:58,869] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 05:33:58,870] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 05:33:58,870] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 05:33:58,870] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 05:33:58,870] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.649655818939209 seconds
Loading extension module utils...
Time to load utils op: 0.6049308776855469 seconds
Loading extension module utils...
Time to load utils op: 0.6048102378845215 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input: Sam, Sid, and Steve brought popsicle sticks for their group activity in their Art class. Sam has thrice as many as Sid, and Sid has twice as many as Steve. If Steve has 12 popsicle sticks, how many popsicle sticks can they use for their Art class activity?
Output: 108

Input: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.
Output: 720

Input: John uses a 75-watt electric fan for 8 hours a day. How much kWh of electric energy does he consume per month (30 days) for using the electric fan?
Output: 18

Input: Barbara Blackburn can type 212 words per minute.  Due to Carpal tunnel syndrome, Barbara cannot use her left hand for a while so her typing speed is now 40 words less per minute. If she is supposed to type a document with 3440 words, how many minutes will it take her to finish typing the document?
Output: 20

Input: Max fills up water balloons for 30 minutes at a rate of 2 water balloons every minute. Max’s friend Zach fills up water balloons for 40 minutes at a rate of 3 water balloons every minute. In the process, 10 of the water balloons pop on the ground. How many filled water balloons do Max and Zach have in total?
Output: 170

Input: John has 54 pieces of gum, Cole has 45 pieces of gum and Aubrey has no pieces of gum. They decide to share the gum equally between the 3 of them. How many pieces of gum will each one get?
Output: 33

Input: Mira jogs every morning. She jogs 5 miles per hour. If she jogs for 2 hours every morning, how many miles can she jog for five days?
Output: 50

Input: Rita is reading a five-chapter book with 95 pages. Each chapter has three pages more than the previous one. How many pages does the first chapter have?
Output: 13

Input: Nancy and Jason are learning to dance for the first time. Nancy steps on her partner's feet 3 times as often as Jason. If together they step on each other's feet 32 times, how many times does Jason step on his partner's feet?
Output: 8

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o22-tgsm8k-s20-rFalse
Loading extension module utils...
Time to load utils op: 0.7049968242645264 seconds
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3569687) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-22_05:34:06
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3569688)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-22_05:34:06
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3569689)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-22_05:34:06
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3569690)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-22_05:34:06
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3569687)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o23-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 23
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 05:34:09,765] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o23-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 23
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o23-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 20/9741 [00:00<00:50, 191.82it/s]  0%|▏                                                     | 40/9741 [00:00<00:50, 192.34it/s]  1%|▎                                                     | 60/9741 [00:00<00:50, 192.52it/s]  1%|▍                                                     | 80/9741 [00:00<00:50, 192.60it/s]  1%|▌                                                    | 100/9741 [00:00<00:49, 193.14it/s]  1%|▋                                                    | 120/9741 [00:00<00:50, 190.85it/s]  1%|▊                                                    | 140/9741 [00:00<00:50, 191.83it/s]  2%|▊                                                    | 160/9741 [00:00<00:49, 192.34it/s]  2%|▉                                                    | 180/9741 [00:00<00:49, 192.46it/s]  2%|█                                                    | 200/9741 [00:01<00:49, 191.28it/s]  2%|█▏                                                   | 220/9741 [00:01<00:49, 191.99it/s]  2%|█▎                                                   | 240/9741 [00:01<00:49, 192.52it/s]  3%|█▍                                                   | 260/9741 [00:01<00:49, 192.95it/s]  3%|█▌                                                   | 280/9741 [00:01<00:48, 193.26it/s]  3%|█▋                                                   | 300/9741 [00:01<00:48, 193.40it/s]  3%|█▋                                                   | 320/9741 [00:01<00:49, 191.35it/s]  3%|█▊                                                   | 340/9741 [00:01<00:48, 191.99it/s]  4%|█▉                                                   | 360/9741 [00:01<00:49, 188.98it/s]  4%|██                                                   | 380/9741 [00:01<00:49, 190.38it/s]  4%|██▏                                                  | 400/9741 [00:02<00:48, 191.48it/s]  4%|██▎                                                  | 420/9741 [00:02<00:48, 192.03it/s]  5%|██▍                                                  | 440/9741 [00:02<00:48, 190.00it/s]  5%|██▌                                                  | 460/9741 [00:02<00:48, 191.24it/s]  5%|██▌                                                  | 480/9741 [00:02<00:48, 191.91it/s]  5%|██▋                                                  | 500/9741 [00:02<00:48, 190.91it/s]  5%|██▊                                                  | 520/9741 [00:02<00:48, 191.60it/s]  6%|██▉                                                  | 540/9741 [00:02<00:47, 192.09it/s]  6%|███                                                  | 560/9741 [00:02<00:47, 192.45it/s]  6%|███▏                                                 | 580/9741 [00:03<00:47, 192.81it/s]  6%|███▎                                                 | 600/9741 [00:03<00:47, 193.10it/s]  6%|███▎                                                 | 620/9741 [00:03<00:47, 193.20it/s]  7%|███▍                                                 | 640/9741 [00:03<00:47, 193.22it/s]  7%|███▌                                                 | 660/9741 [00:03<00:47, 191.85it/s]  7%|███▋                                                 | 680/9741 [00:03<00:47, 192.48it/s]  7%|███▊                                                 | 700/9741 [00:03<00:46, 192.88it/s]  7%|███▉                                                 | 720/9741 [00:03<00:46, 193.00it/s]  8%|████                                                 | 740/9741 [00:03<00:46, 193.15it/s]  8%|████▏                                                | 760/9741 [00:03<00:46, 193.00it/s]  8%|████▏                                                | 780/9741 [00:04<00:46, 193.55it/s]  8%|████▎                                                | 800/9741 [00:04<00:46, 193.81it/s]  8%|████▍                                                | 820/9741 [00:04<00:45, 194.28it/s]  9%|████▌                                                | 840/9741 [00:04<00:45, 194.23it/s]  9%|████▋                                                | 860/9741 [00:04<00:45, 194.43it/s]  9%|████▊                                                | 880/9741 [00:04<00:45, 194.49it/s]  9%|████▉                                                | 900/9741 [00:04<00:45, 192.77it/s] 10%|█████                                                | 929/9741 [00:04<00:40, 219.59it/s] 10%|█████▏                                               | 959/9741 [00:04<00:36, 241.99it/s] 10%|█████▍                                               | 989/9741 [00:04<00:33, 257.92it/s] 10%|█████▍                                              | 1019/9741 [00:05<00:32, 269.34it/s] 11%|█████▌                                              | 1049/9741 [00:05<00:31, 277.28it/s] 11%|█████▊                                              | 1078/9741 [00:05<00:30, 280.79it/s] 11%|█████▉                                              | 1108/9741 [00:05<00:30, 283.02it/s] 12%|██████                                              | 1138/9741 [00:05<00:30, 286.67it/s] 12%|██████▏                                             | 1168/9741 [00:05<00:29, 289.13it/s] 12%|██████▍                                             | 1198/9741 [00:05<00:29, 290.77it/s] 13%|██████▌                                             | 1228/9741 [00:05<00:29, 291.95it/s] 13%|██████▋                                             | 1258/9741 [00:05<00:28, 292.98it/s] 13%|██████▉                                             | 1288/9741 [00:06<00:28, 293.47it/s] 14%|███████                                             | 1318/9741 [00:06<00:28, 293.83it/s] 14%|███████▏                                            | 1348/9741 [00:06<00:28, 291.99it/s] 14%|███████▎                                            | 1378/9741 [00:06<00:28, 292.91it/s] 14%|███████▌                                            | 1408/9741 [00:06<00:28, 293.55it/s] 15%|███████▋                                            | 1438/9741 [00:06<00:28, 294.07it/s] 15%|███████▊                                            | 1468/9741 [00:06<00:28, 291.26it/s] 15%|███████▉                                            | 1498/9741 [00:06<00:28, 292.23it/s] 16%|████████▏                                           | 1528/9741 [00:06<00:28, 292.83it/s] 16%|████████▎                                           | 1558/9741 [00:06<00:27, 293.55it/s] 16%|████████▍                                           | 1588/9741 [00:07<00:28, 290.41it/s] 17%|████████▋                                           | 1618/9741 [00:07<00:27, 291.60it/s] 17%|████████▊                                           | 1648/9741 [00:07<00:27, 292.69it/s] 17%|████████▉                                           | 1678/9741 [00:07<00:27, 293.32it/s] 18%|█████████                                           | 1708/9741 [00:07<00:27, 293.90it/s] 18%|█████████▎                                          | 1738/9741 [00:07<00:27, 293.71it/s] 18%|█████████▍                                          | 1768/9741 [00:07<00:27, 294.09it/s] 18%|█████████▌                                          | 1798/9741 [00:07<00:29, 265.82it/s] 19%|█████████▊                                          | 1828/9741 [00:07<00:28, 273.48it/s] 19%|█████████▉                                          | 1858/9741 [00:07<00:28, 279.34it/s] 19%|██████████                                          | 1888/9741 [00:08<00:27, 283.69it/s] 20%|██████████▏                                         | 1918/9741 [00:08<00:27, 286.75it/s] 20%|██████████▍                                         | 1948/9741 [00:08<00:26, 289.19it/s] 20%|██████████▌                                         | 1978/9741 [00:08<00:26, 290.73it/s] 21%|██████████▋                                         | 2008/9741 [00:08<00:26, 291.87it/s] 21%|██████████▉                                         | 2038/9741 [00:08<00:26, 290.25it/s] 21%|███████████                                         | 2068/9741 [00:08<00:26, 291.31it/s] 22%|███████████▏                                        | 2098/9741 [00:08<00:26, 291.35it/s] 22%|███████████▎                                        | 2128/9741 [00:08<00:26, 291.32it/s] 22%|███████████▌                                        | 2158/9741 [00:09<00:26, 291.51it/s] 22%|███████████▋                                        | 2188/9741 [00:09<00:25, 291.65it/s] 23%|███████████▊                                        | 2218/9741 [00:09<00:25, 291.80it/s] 23%|████████████                                        | 2248/9741 [00:09<00:25, 289.70it/s] 23%|████████████▏                                       | 2278/9741 [00:09<00:25, 290.14it/s] 24%|████████████▎                                       | 2308/9741 [00:09<00:25, 290.60it/s] 24%|████████████▍                                       | 2338/9741 [00:09<00:25, 289.87it/s] 24%|████████████▋                                       | 2368/9741 [00:09<00:25, 290.55it/s] 25%|████████████▊                                       | 2398/9741 [00:09<00:25, 291.11it/s] 25%|████████████▉                                       | 2428/9741 [00:09<00:25, 291.68it/s] 25%|█████████████                                       | 2458/9741 [00:10<00:24, 291.63it/s] 26%|█████████████▎                                      | 2488/9741 [00:10<00:25, 289.65it/s] 26%|█████████████▍                                      | 2518/9741 [00:10<00:24, 290.17it/s] 26%|█████████████▌                                      | 2548/9741 [00:10<00:24, 290.77it/s] 26%|█████████████▊                                      | 2578/9741 [00:10<00:24, 291.30it/s] 27%|█████████████▉                                      | 2608/9741 [00:10<00:24, 291.57it/s] 27%|██████████████                                      | 2638/9741 [00:10<00:24, 291.36it/s] 27%|██████████████▏                                     | 2668/9741 [00:10<00:24, 291.39it/s] 28%|██████████████▍                                     | 2698/9741 [00:10<00:24, 289.08it/s] 28%|██████████████▌                                     | 2728/9741 [00:10<00:24, 289.57it/s] 28%|██████████████▋                                     | 2758/9741 [00:11<00:24, 290.14it/s] 29%|██████████████▉                                     | 2788/9741 [00:11<00:23, 290.14it/s] 29%|███████████████                                     | 2818/9741 [00:11<00:23, 290.45it/s] 29%|███████████████▏                                    | 2848/9741 [00:11<00:23, 290.94it/s] 30%|███████████████▎                                    | 2878/9741 [00:11<00:23, 291.49it/s] 30%|███████████████▌                                    | 2908/9741 [00:11<00:23, 291.52it/s] 30%|███████████████▋                                    | 2938/9741 [00:11<00:23, 289.16it/s] 30%|███████████████▊                                    | 2968/9741 [00:11<00:23, 289.90it/s] 31%|████████████████                                    | 2998/9741 [00:11<00:23, 290.60it/s] 31%|████████████████▏                                   | 3028/9741 [00:12<00:23, 290.92it/s] 31%|████████████████▎                                   | 3058/9741 [00:12<00:22, 290.95it/s] 32%|████████████████▍                                   | 3088/9741 [00:12<00:22, 291.03it/s] 32%|████████████████▋                                   | 3118/9741 [00:12<00:22, 291.14it/s] 32%|████████████████▊                                   | 3148/9741 [00:12<00:22, 291.18it/s] 33%|████████████████▉                                   | 3178/9741 [00:12<00:22, 289.00it/s] 33%|█████████████████▏                                  | 3208/9741 [00:12<00:22, 289.87it/s] 33%|█████████████████▎                                  | 3238/9741 [00:12<00:22, 290.27it/s] 34%|█████████████████▍                                  | 3268/9741 [00:12<00:22, 290.78it/s] 34%|█████████████████▌                                  | 3298/9741 [00:12<00:22, 290.85it/s] 34%|█████████████████▊                                  | 3328/9741 [00:13<00:22, 290.43it/s] 34%|█████████████████▉                                  | 3358/9741 [00:13<00:21, 291.00it/s] 35%|██████████████████                                  | 3388/9741 [00:13<00:21, 289.21it/s] 35%|██████████████████▏                                 | 3418/9741 [00:13<00:21, 290.55it/s] 35%|██████████████████▍                                 | 3448/9741 [00:13<00:21, 291.52it/s] 36%|██████████████████▌                                 | 3478/9741 [00:13<00:21, 292.25it/s] 36%|██████████████████▋                                 | 3508/9741 [00:13<00:21, 292.64it/s] 36%|██████████████████▉                                 | 3538/9741 [00:13<00:21, 293.10it/s] 37%|███████████████████                                 | 3568/9741 [00:13<00:21, 293.15it/s] 37%|███████████████████▏                                | 3598/9741 [00:13<00:20, 293.43it/s] 37%|███████████████████▎                                | 3628/9741 [00:14<00:20, 291.51it/s] 38%|███████████████████▌                                | 3658/9741 [00:14<00:20, 292.01it/s] 38%|███████████████████▋                                | 3688/9741 [00:14<00:20, 292.74it/s] 38%|███████████████████▊                                | 3718/9741 [00:14<00:20, 293.30it/s] 38%|████████████████████                                | 3748/9741 [00:14<00:20, 293.69it/s] 39%|████████████████████▏                               | 3778/9741 [00:14<00:20, 293.72it/s] 39%|████████████████████▎                               | 3808/9741 [00:14<00:20, 292.21it/s] 39%|████████████████████▍                               | 3838/9741 [00:14<00:20, 290.81it/s] 40%|████████████████████▋                               | 3868/9741 [00:14<00:20, 291.58it/s] 40%|████████████████████▊                               | 3898/9741 [00:14<00:19, 292.51it/s] 40%|████████████████████▉                               | 3928/9741 [00:15<00:19, 293.33it/s] 41%|█████████████████████▏                              | 3958/9741 [00:15<00:19, 293.34it/s] 41%|█████████████████████▎                              | 3988/9741 [00:15<00:19, 293.50it/s] 41%|█████████████████████▍                              | 4018/9741 [00:15<00:19, 293.89it/s] 42%|█████████████████████▌                              | 4048/9741 [00:15<00:19, 293.62it/s] 42%|█████████████████████▊                              | 4078/9741 [00:15<00:19, 291.84it/s] 42%|█████████████████████▉                              | 4108/9741 [00:15<00:19, 292.28it/s] 42%|██████████████████████                              | 4138/9741 [00:15<00:19, 292.89it/s] 43%|██████████████████████▏                             | 4168/9741 [00:15<00:19, 293.13it/s] 43%|██████████████████████▍                             | 4198/9741 [00:16<00:18, 293.42it/s] 43%|██████████████████████▌                             | 4228/9741 [00:16<00:18, 293.50it/s] 44%|██████████████████████▋                             | 4258/9741 [00:16<00:18, 293.77it/s] 44%|██████████████████████▉                             | 4288/9741 [00:16<00:18, 292.29it/s] 44%|███████████████████████                             | 4318/9741 [00:16<00:18, 289.75it/s] 45%|███████████████████████▏                            | 4348/9741 [00:16<00:18, 291.11it/s] 45%|███████████████████████▎                            | 4378/9741 [00:16<00:18, 291.86it/s] 45%|███████████████████████▌                            | 4408/9741 [00:16<00:18, 292.33it/s] 46%|███████████████████████▋                            | 4438/9741 [00:16<00:18, 292.60it/s] 46%|███████████████████████▊                            | 4468/9741 [00:16<00:17, 292.96it/s] 46%|████████████████████████                            | 4498/9741 [00:17<00:17, 293.49it/s] 46%|████████████████████████▏                           | 4528/9741 [00:17<00:19, 266.58it/s] 47%|████████████████████████▎                           | 4558/9741 [00:17<00:18, 273.99it/s] 47%|████████████████████████▍                           | 4588/9741 [00:17<00:18, 279.49it/s] 47%|████████████████████████▋                           | 4618/9741 [00:17<00:18, 283.26it/s] 48%|████████████████████████▊                           | 4648/9741 [00:17<00:17, 286.23it/s] 48%|████████████████████████▉                           | 4678/9741 [00:17<00:17, 288.32it/s] 48%|█████████████████████████▏                          | 4708/9741 [00:17<00:17, 289.82it/s] 49%|█████████████████████████▎                          | 4738/9741 [00:17<00:17, 291.42it/s] 49%|█████████████████████████▍                          | 4768/9741 [00:18<00:23, 215.66it/s] 49%|█████████████████████████▌                          | 4798/9741 [00:18<00:21, 234.45it/s] 50%|█████████████████████████▊                          | 4828/9741 [00:18<00:19, 249.64it/s] 50%|█████████████████████████▉                          | 4858/9741 [00:18<00:18, 261.15it/s] 50%|██████████████████████████                          | 4888/9741 [00:18<00:17, 270.16it/s] 50%|██████████████████████████▎                         | 4918/9741 [00:18<00:17, 276.86it/s] 51%|██████████████████████████▍                         | 4947/9741 [00:18<00:17, 280.15it/s] 51%|██████████████████████████▌                         | 4977/9741 [00:18<00:16, 284.25it/s] 51%|██████████████████████████▋                         | 5007/9741 [00:18<00:16, 287.06it/s] 52%|██████████████████████████▉                         | 5037/9741 [00:19<00:16, 289.11it/s] 52%|███████████████████████████                         | 5067/9741 [00:19<00:16, 290.51it/s] 52%|███████████████████████████▏                        | 5097/9741 [00:19<00:15, 291.35it/s] 53%|███████████████████████████▎                        | 5127/9741 [00:19<00:15, 292.11it/s] 53%|███████████████████████████▌                        | 5157/9741 [00:19<00:15, 292.65it/s] 53%|███████████████████████████▋                        | 5187/9741 [00:19<00:15, 290.77it/s] 54%|███████████████████████████▊                        | 5217/9741 [00:19<00:15, 291.70it/s] 54%|████████████████████████████                        | 5247/9741 [00:19<00:15, 289.84it/s] 54%|████████████████████████████▏                       | 5277/9741 [00:19<00:15, 291.00it/s] 54%|████████████████████████████▎                       | 5307/9741 [00:19<00:15, 292.10it/s] 55%|████████████████████████████▍                       | 5337/9741 [00:20<00:15, 292.21it/s] 55%|████████████████████████████▋                       | 5367/9741 [00:20<00:14, 292.68it/s] 55%|████████████████████████████▊                       | 5397/9741 [00:20<00:14, 290.97it/s] 56%|████████████████████████████▉                       | 5427/9741 [00:20<00:14, 291.89it/s] 56%|█████████████████████████████▏                      | 5457/9741 [00:20<00:14, 292.58it/s] 56%|█████████████████████████████▎                      | 5487/9741 [00:20<00:14, 294.27it/s] 57%|█████████████████████████████▍                      | 5518/9741 [00:20<00:14, 296.85it/s] 57%|█████████████████████████████▌                      | 5549/9741 [00:20<00:14, 298.60it/s] 57%|█████████████████████████████▊                      | 5580/9741 [00:20<00:13, 299.61it/s] 58%|█████████████████████████████▉                      | 5611/9741 [00:20<00:13, 300.29it/s] 58%|██████████████████████████████                      | 5642/9741 [00:21<00:13, 298.84it/s] 58%|██████████████████████████████▎                     | 5673/9741 [00:21<00:13, 299.98it/s] 59%|██████████████████████████████▍                     | 5704/9741 [00:21<00:13, 300.55it/s] 59%|██████████████████████████████▌                     | 5735/9741 [00:21<00:13, 301.33it/s] 59%|██████████████████████████████▊                     | 5766/9741 [00:21<00:13, 299.10it/s] 60%|██████████████████████████████▉                     | 5797/9741 [00:21<00:13, 299.92it/s] 60%|███████████████████████████████                     | 5828/9741 [00:21<00:13, 300.34it/s] 60%|███████████████████████████████▎                    | 5859/9741 [00:21<00:13, 297.63it/s] 60%|███████████████████████████████▍                    | 5890/9741 [00:21<00:12, 299.05it/s] 61%|███████████████████████████████▌                    | 5921/9741 [00:22<00:12, 300.15it/s] 61%|███████████████████████████████▊                    | 5952/9741 [00:22<00:12, 300.83it/s] 61%|███████████████████████████████▉                    | 5983/9741 [00:22<00:12, 301.48it/s] 62%|████████████████████████████████                    | 6014/9741 [00:22<00:12, 301.83it/s] 62%|████████████████████████████████▎                   | 6045/9741 [00:22<00:12, 301.99it/s] 62%|████████████████████████████████▍                   | 6076/9741 [00:22<00:12, 302.02it/s] 63%|████████████████████████████████▌                   | 6107/9741 [00:22<00:12, 300.21it/s] 63%|████████████████████████████████▊                   | 6138/9741 [00:22<00:11, 300.66it/s] 63%|████████████████████████████████▉                   | 6169/9741 [00:22<00:11, 301.08it/s] 64%|█████████████████████████████████                   | 6200/9741 [00:22<00:11, 301.56it/s] 64%|█████████████████████████████████▎                  | 6231/9741 [00:23<00:11, 301.71it/s] 64%|█████████████████████████████████▍                  | 6262/9741 [00:23<00:11, 299.30it/s] 65%|█████████████████████████████████▌                  | 6293/9741 [00:23<00:11, 300.07it/s] 65%|█████████████████████████████████▊                  | 6324/9741 [00:23<00:11, 298.56it/s] 65%|█████████████████████████████████▉                  | 6355/9741 [00:23<00:11, 299.50it/s] 66%|██████████████████████████████████                  | 6386/9741 [00:23<00:11, 299.88it/s] 66%|██████████████████████████████████▎                 | 6417/9741 [00:23<00:11, 300.77it/s] 66%|██████████████████████████████████▍                 | 6448/9741 [00:23<00:10, 301.33it/s] 67%|██████████████████████████████████▌                 | 6479/9741 [00:23<00:10, 301.48it/s] 67%|██████████████████████████████████▊                 | 6510/9741 [00:23<00:10, 301.63it/s] 67%|██████████████████████████████████▉                 | 6541/9741 [00:24<00:10, 299.69it/s] 67%|███████████████████████████████████                 | 6572/9741 [00:24<00:10, 300.45it/s] 68%|███████████████████████████████████▏                | 6603/9741 [00:24<00:10, 300.76it/s] 68%|███████████████████████████████████▍                | 6634/9741 [00:24<00:10, 301.47it/s] 68%|███████████████████████████████████▌                | 6665/9741 [00:24<00:10, 302.06it/s] 69%|███████████████████████████████████▋                | 6696/9741 [00:24<00:10, 302.20it/s] 69%|███████████████████████████████████▉                | 6727/9741 [00:24<00:09, 302.02it/s] 69%|████████████████████████████████████                | 6758/9741 [00:24<00:09, 300.24it/s] 70%|████████████████████████████████████▏               | 6789/9741 [00:24<00:09, 298.69it/s] 70%|████████████████████████████████████▍               | 6820/9741 [00:24<00:09, 299.39it/s] 70%|████████████████████████████████████▌               | 6851/9741 [00:25<00:09, 300.35it/s] 71%|████████████████████████████████████▋               | 6882/9741 [00:25<00:09, 300.99it/s] 71%|████████████████████████████████████▉               | 6913/9741 [00:25<00:09, 301.30it/s] 71%|█████████████████████████████████████               | 6944/9741 [00:25<00:09, 301.71it/s] 72%|█████████████████████████████████████▏              | 6975/9741 [00:25<00:09, 301.82it/s] 72%|█████████████████████████████████████▍              | 7006/9741 [00:25<00:09, 300.06it/s] 72%|█████████████████████████████████████▌              | 7037/9741 [00:25<00:08, 300.71it/s] 73%|█████████████████████████████████████▋              | 7068/9741 [00:25<00:08, 301.29it/s] 73%|█████████████████████████████████████▉              | 7099/9741 [00:25<00:08, 301.66it/s] 73%|██████████████████████████████████████              | 7130/9741 [00:26<00:08, 302.04it/s] 74%|██████████████████████████████████████▏             | 7161/9741 [00:26<00:08, 302.26it/s] 74%|██████████████████████████████████████▍             | 7192/9741 [00:26<00:08, 302.05it/s] 74%|██████████████████████████████████████▌             | 7223/9741 [00:26<00:08, 299.88it/s] 74%|██████████████████████████████████████▋             | 7254/9741 [00:26<00:08, 300.48it/s] 75%|██████████████████████████████████████▉             | 7285/9741 [00:26<00:08, 301.00it/s] 75%|███████████████████████████████████████             | 7316/9741 [00:26<00:08, 301.37it/s] 75%|███████████████████████████████████████▏            | 7347/9741 [00:26<00:07, 301.91it/s] 76%|███████████████████████████████████████▍            | 7378/9741 [00:26<00:07, 302.13it/s] 76%|███████████████████████████████████████▌            | 7409/9741 [00:26<00:07, 302.14it/s] 76%|███████████████████████████████████████▋            | 7440/9741 [00:27<00:08, 268.85it/s] 77%|███████████████████████████████████████▉            | 7471/9741 [00:27<00:08, 277.83it/s] 77%|████████████████████████████████████████            | 7502/9741 [00:27<00:07, 284.71it/s] 77%|████████████████████████████████████████▏           | 7533/9741 [00:27<00:07, 289.54it/s] 78%|████████████████████████████████████████▍           | 7564/9741 [00:27<00:07, 293.23it/s] 78%|████████████████████████████████████████▌           | 7595/9741 [00:27<00:07, 295.91it/s] 78%|████████████████████████████████████████▋           | 7626/9741 [00:27<00:07, 297.68it/s] 79%|████████████████████████████████████████▉           | 7657/9741 [00:27<00:06, 298.76it/s] 79%|█████████████████████████████████████████           | 7687/9741 [00:27<00:06, 297.64it/s] 79%|█████████████████████████████████████████▏          | 7718/9741 [00:28<00:06, 299.11it/s] 80%|█████████████████████████████████████████▎          | 7749/9741 [00:28<00:06, 300.24it/s] 80%|█████████████████████████████████████████▌          | 7780/9741 [00:28<00:06, 300.85it/s] 80%|█████████████████████████████████████████▋          | 7811/9741 [00:28<00:06, 301.31it/s] 81%|█████████████████████████████████████████▊          | 7842/9741 [00:28<00:06, 301.48it/s] 81%|██████████████████████████████████████████          | 7873/9741 [00:28<00:06, 301.68it/s] 81%|██████████████████████████████████████████▏         | 7904/9741 [00:28<00:06, 300.08it/s] 81%|██████████████████████████████████████████▎         | 7935/9741 [00:28<00:06, 300.78it/s] 82%|██████████████████████████████████████████▌         | 7966/9741 [00:28<00:05, 301.32it/s] 82%|██████████████████████████████████████████▋         | 7997/9741 [00:28<00:05, 301.54it/s] 82%|██████████████████████████████████████████▊         | 8028/9741 [00:29<00:05, 301.75it/s] 83%|███████████████████████████████████████████         | 8059/9741 [00:29<00:05, 301.56it/s] 83%|███████████████████████████████████████████▏        | 8090/9741 [00:29<00:05, 301.40it/s] 83%|███████████████████████████████████████████▎        | 8121/9741 [00:29<00:05, 299.88it/s] 84%|███████████████████████████████████████████▌        | 8152/9741 [00:29<00:05, 300.58it/s] 84%|███████████████████████████████████████████▋        | 8183/9741 [00:29<00:05, 300.96it/s] 84%|███████████████████████████████████████████▊        | 8214/9741 [00:29<00:05, 301.34it/s] 85%|████████████████████████████████████████████        | 8245/9741 [00:29<00:04, 301.72it/s] 85%|████████████████████████████████████████████▏       | 8276/9741 [00:29<00:04, 301.66it/s] 85%|████████████████████████████████████████████▎       | 8307/9741 [00:29<00:04, 301.38it/s] 86%|████████████████████████████████████████████▌       | 8338/9741 [00:30<00:04, 301.80it/s] 86%|████████████████████████████████████████████▋       | 8369/9741 [00:30<00:04, 300.06it/s] 86%|████████████████████████████████████████████▊       | 8400/9741 [00:30<00:04, 300.66it/s] 87%|█████████████████████████████████████████████       | 8431/9741 [00:30<00:04, 301.37it/s] 87%|█████████████████████████████████████████████▏      | 8462/9741 [00:30<00:04, 301.81it/s] 87%|█████████████████████████████████████████████▎      | 8493/9741 [00:30<00:04, 301.72it/s] 88%|█████████████████████████████████████████████▌      | 8524/9741 [00:30<00:04, 301.91it/s] 88%|█████████████████████████████████████████████▋      | 8555/9741 [00:30<00:03, 301.84it/s] 88%|█████████████████████████████████████████████▊      | 8586/9741 [00:30<00:03, 299.91it/s] 88%|█████████████████████████████████████████████▉      | 8617/9741 [00:31<00:03, 300.57it/s] 89%|██████████████████████████████████████████████▏     | 8648/9741 [00:31<00:03, 300.85it/s] 89%|██████████████████████████████████████████████▎     | 8679/9741 [00:31<00:03, 301.17it/s] 89%|██████████████████████████████████████████████▍     | 8710/9741 [00:31<00:03, 301.58it/s] 90%|██████████████████████████████████████████████▋     | 8741/9741 [00:31<00:03, 301.66it/s] 90%|██████████████████████████████████████████████▊     | 8772/9741 [00:31<00:03, 300.56it/s] 90%|██████████████████████████████████████████████▉     | 8803/9741 [00:31<00:03, 298.99it/s] 91%|███████████████████████████████████████████████▏    | 8834/9741 [00:31<00:03, 299.83it/s] 91%|███████████████████████████████████████████████▎    | 8865/9741 [00:31<00:02, 300.52it/s] 91%|███████████████████████████████████████████████▍    | 8896/9741 [00:31<00:02, 301.15it/s] 92%|███████████████████████████████████████████████▋    | 8927/9741 [00:32<00:02, 300.91it/s] 92%|███████████████████████████████████████████████▊    | 8958/9741 [00:32<00:02, 301.23it/s] 92%|███████████████████████████████████████████████▉    | 8989/9741 [00:32<00:02, 301.51it/s] 93%|████████████████████████████████████████████████▏   | 9020/9741 [00:32<00:02, 301.77it/s] 93%|████████████████████████████████████████████████▎   | 9051/9741 [00:32<00:02, 299.84it/s] 93%|████████████████████████████████████████████████▍   | 9082/9741 [00:32<00:02, 300.55it/s] 94%|████████████████████████████████████████████████▋   | 9113/9741 [00:32<00:02, 301.00it/s] 94%|████████████████████████████████████████████████▊   | 9144/9741 [00:32<00:01, 301.31it/s] 94%|████████████████████████████████████████████████▉   | 9175/9741 [00:32<00:01, 301.38it/s] 95%|█████████████████████████████████████████████████▏  | 9206/9741 [00:32<00:01, 301.35it/s] 95%|█████████████████████████████████████████████████▎  | 9237/9741 [00:33<00:01, 301.77it/s] 95%|█████████████████████████████████████████████████▍  | 9268/9741 [00:33<00:01, 300.24it/s] 95%|█████████████████████████████████████████████████▋  | 9299/9741 [00:33<00:01, 300.86it/s] 96%|█████████████████████████████████████████████████▊  | 9330/9741 [00:33<00:01, 301.41it/s] 96%|█████████████████████████████████████████████████▉  | 9361/9741 [00:33<00:01, 301.48it/s] 96%|██████████████████████████████████████████████████▏ | 9392/9741 [00:33<00:01, 301.67it/s] 97%|██████████████████████████████████████████████████▎ | 9423/9741 [00:33<00:01, 301.42it/s] 97%|██████████████████████████████████████████████████▍ | 9454/9741 [00:33<00:00, 301.47it/s] 97%|██████████████████████████████████████████████████▋ | 9485/9741 [00:33<00:00, 300.02it/s] 98%|██████████████████████████████████████████████████▊ | 9516/9741 [00:33<00:00, 300.65it/s] 98%|██████████████████████████████████████████████████▉ | 9547/9741 [00:34<00:00, 301.06it/s] 98%|███████████████████████████████████████████████████▏| 9578/9741 [00:34<00:00, 301.09it/s] 99%|███████████████████████████████████████████████████▎| 9609/9741 [00:34<00:00, 301.05it/s] 99%|███████████████████████████████████████████████████▍| 9640/9741 [00:34<00:00, 301.01it/s] 99%|███████████████████████████████████████████████████▋| 9671/9741 [00:34<00:00, 301.01it/s]100%|███████████████████████████████████████████████████▊| 9702/9741 [00:34<00:00, 301.10it/s]100%|███████████████████████████████████████████████████▉| 9733/9741 [00:34<00:00, 299.27it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:34<00:00, 280.42it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.14s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.89s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.05s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.46s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.05s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.92s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.08s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.36s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.44s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.61s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.32s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]
[2023-08-22 05:35:35,707] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.60s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.94s/it]
[2023-08-22 05:35:46,976] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 05:35:46,977] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f171507afd0>
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 05:35:46,977] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f17147df220>
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 05:35:46,978] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 05:35:46,978] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5687038898468018 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input: Sam, Sid, and Steve brought popsicle sticks for their group activity in their Art class. Sam has thrice as many as Sid, and Sid has twice as many as Steve. If Steve has 12 popsicle sticks, how many popsicle sticks can they use for their Art class activity?
Output: 108

Input: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.
Output: 720

Input: John uses a 75-watt electric fan for 8 hours a day. How much kWh of electric energy does he consume per month (30 days) for using the electric fan?
Output: 18

Input: Barbara Blackburn can type 212 words per minute.  Due to Carpal tunnel syndrome, Barbara cannot use her left hand for a while so her typing speed is now 40 words less per minute. If she is supposed to type a document with 3440 words, how many minutes will it take her to finish typing the document?
Output: 20

Input: Max fills up water balloons for 30 minutes at a rate of 2 water balloons every minute. Max’s friend Zach fills up water balloons for 40 minutes at a rate of 3 water balloons every minute. In the process, 10 of the water balloons pop on the ground. How many filled water balloons do Max and Zach have in total?
Output: 170

Input: John has 54 pieces of gum, Cole has 45 pieces of gum and Aubrey has no pieces of gum. They decide to share the gum equally between the 3 of them. How many pieces of gum will each one get?
Output: 33

Input: Mira jogs every morning. She jogs 5 miles per hour. If she jogs for 2 hours every morning, how many miles can she jog for five days?
Output: 50

Input: Rita is reading a five-chapter book with 95 pages. Each chapter has three pages more than the previous one. How many pages does the first chapter have?
Output: 13

Input: Nancy and Jason are learning to dance for the first time. Nancy steps on her partner's feet 3 times as often as Jason. If together they step on each other's feet 32 times, how many times does Jason step on his partner's feet?
Output: 8

Input: Maisie and Donna dropped off flyers for a neighborhood clean-up day at houses around their neighborhood. Maisie walked down the shorter left street and dropped off 33 flyers. Donna took the long right street on her bicycle and dropped off five more than twice as many flyers as Maisie. How many flyers did Donna drop off?
Output: 71

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o23-tgsm8k-s20-rFalse
Loading extension module utils...
Time to load utils op: 0.30440282821655273 seconds
Loading extension module utils...
Time to load utils op: 0.6050856113433838 seconds
Loading extension module utils...
Time to load utils op: 0.4047255516052246 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3570829) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-22_05:35:52
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3570830)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-22_05:35:52
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3570831)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-22_05:35:52
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3570832)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-22_05:35:52
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3570829)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o24-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 24
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 05:35:55,650] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o24-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 24
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o24-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 18/9741 [00:00<00:56, 172.76it/s]  0%|▏                                                     | 37/9741 [00:00<00:53, 179.76it/s]  1%|▎                                                     | 56/9741 [00:00<00:53, 182.31it/s]  1%|▍                                                     | 75/9741 [00:00<00:52, 183.49it/s]  1%|▌                                                     | 94/9741 [00:00<00:52, 183.92it/s]  1%|▌                                                    | 113/9741 [00:00<00:52, 184.42it/s]  1%|▋                                                    | 132/9741 [00:00<00:52, 184.62it/s]  2%|▊                                                    | 151/9741 [00:00<00:51, 184.77it/s]  2%|▉                                                    | 170/9741 [00:00<00:51, 184.86it/s]  2%|█                                                    | 189/9741 [00:01<00:51, 184.52it/s]  2%|█▏                                                   | 208/9741 [00:01<00:53, 178.12it/s]  2%|█▏                                                   | 227/9741 [00:01<00:53, 179.25it/s]  3%|█▎                                                   | 246/9741 [00:01<00:52, 180.48it/s]  3%|█▍                                                   | 265/9741 [00:01<00:52, 181.48it/s]  3%|█▌                                                   | 284/9741 [00:01<00:51, 182.22it/s]  3%|█▋                                                   | 303/9741 [00:01<00:51, 182.82it/s]  3%|█▊                                                   | 322/9741 [00:01<00:51, 183.26it/s]  4%|█▊                                                   | 341/9741 [00:01<00:51, 183.60it/s]  4%|█▉                                                   | 360/9741 [00:01<00:51, 183.93it/s]  4%|██                                                   | 379/9741 [00:02<00:50, 183.91it/s]  4%|██▏                                                  | 398/9741 [00:02<00:50, 183.84it/s]  4%|██▎                                                  | 417/9741 [00:02<00:50, 183.60it/s]  4%|██▎                                                  | 436/9741 [00:02<00:51, 182.19it/s]  5%|██▍                                                  | 455/9741 [00:02<00:50, 182.66it/s]  5%|██▌                                                  | 474/9741 [00:02<00:50, 182.89it/s]  5%|██▋                                                  | 500/9741 [00:02<00:45, 204.75it/s]  5%|██▊                                                  | 528/9741 [00:02<00:40, 226.81it/s]  6%|███                                                  | 556/9741 [00:02<00:37, 242.42it/s]  6%|███▏                                                 | 584/9741 [00:02<00:36, 253.47it/s]  6%|███▎                                                 | 612/9741 [00:03<00:34, 261.17it/s]  7%|███▍                                                 | 640/9741 [00:03<00:34, 266.44it/s]  7%|███▋                                                 | 668/9741 [00:03<00:33, 268.46it/s]  7%|███▊                                                 | 696/9741 [00:03<00:33, 271.69it/s]  7%|███▉                                                 | 724/9741 [00:03<00:32, 273.83it/s]  8%|████                                                 | 752/9741 [00:03<00:32, 275.38it/s]  8%|████▏                                                | 780/9741 [00:03<00:32, 275.95it/s]  8%|████▍                                                | 808/9741 [00:03<00:32, 277.06it/s]  9%|████▌                                                | 837/9741 [00:03<00:32, 278.08it/s]  9%|████▋                                                | 865/9741 [00:04<00:31, 278.48it/s]  9%|████▊                                                | 893/9741 [00:04<00:31, 276.63it/s]  9%|█████                                                | 921/9741 [00:04<00:31, 277.26it/s] 10%|█████▏                                               | 949/9741 [00:04<00:31, 277.27it/s] 10%|█████▎                                               | 977/9741 [00:04<00:31, 277.47it/s] 10%|█████▎                                              | 1005/9741 [00:04<00:31, 277.86it/s] 11%|█████▌                                              | 1033/9741 [00:04<00:31, 278.27it/s] 11%|█████▋                                              | 1061/9741 [00:04<00:31, 278.33it/s] 11%|█████▊                                              | 1089/9741 [00:04<00:31, 278.49it/s] 11%|█████▉                                              | 1117/9741 [00:04<00:31, 276.36it/s] 12%|██████                                              | 1145/9741 [00:05<00:31, 273.78it/s] 12%|██████▎                                             | 1173/9741 [00:05<00:31, 274.79it/s] 12%|██████▍                                             | 1201/9741 [00:05<00:30, 275.49it/s] 13%|██████▌                                             | 1229/9741 [00:05<00:30, 275.46it/s] 13%|██████▋                                             | 1257/9741 [00:05<00:30, 276.14it/s] 13%|██████▊                                             | 1285/9741 [00:05<00:30, 277.15it/s] 13%|███████                                             | 1314/9741 [00:05<00:30, 278.55it/s] 14%|███████▏                                            | 1342/9741 [00:05<00:30, 277.08it/s] 14%|███████▎                                            | 1371/9741 [00:05<00:30, 278.02it/s] 14%|███████▍                                            | 1399/9741 [00:05<00:29, 278.49it/s] 15%|███████▌                                            | 1428/9741 [00:06<00:29, 279.34it/s] 15%|███████▊                                            | 1457/9741 [00:06<00:29, 280.26it/s] 15%|███████▉                                            | 1486/9741 [00:06<00:29, 280.37it/s] 16%|████████                                            | 1515/9741 [00:06<00:29, 276.99it/s] 16%|████████▏                                           | 1544/9741 [00:06<00:29, 278.14it/s] 16%|████████▍                                           | 1572/9741 [00:06<00:29, 275.08it/s] 16%|████████▌                                           | 1600/9741 [00:06<00:29, 276.35it/s] 17%|████████▋                                           | 1629/9741 [00:06<00:29, 277.61it/s] 17%|████████▊                                           | 1658/9741 [00:06<00:29, 278.60it/s] 17%|█████████                                           | 1687/9741 [00:06<00:28, 279.10it/s] 18%|█████████▏                                          | 1715/9741 [00:07<00:28, 279.23it/s] 18%|█████████▎                                          | 1743/9741 [00:07<00:28, 279.42it/s] 18%|█████████▍                                          | 1772/9741 [00:07<00:28, 279.66it/s] 18%|█████████▌                                          | 1800/9741 [00:07<00:31, 249.66it/s] 19%|█████████▊                                          | 1828/9741 [00:07<00:30, 257.94it/s] 19%|█████████▉                                          | 1856/9741 [00:07<00:29, 263.51it/s] 19%|██████████                                          | 1884/9741 [00:07<00:29, 268.10it/s] 20%|██████████▏                                         | 1913/9741 [00:07<00:28, 272.12it/s] 20%|██████████▎                                         | 1942/9741 [00:07<00:28, 274.48it/s] 20%|██████████▌                                         | 1970/9741 [00:08<00:28, 276.05it/s] 21%|██████████▋                                         | 1999/9741 [00:08<00:27, 277.35it/s] 21%|██████████▊                                         | 2027/9741 [00:08<00:27, 275.96it/s] 21%|██████████▉                                         | 2056/9741 [00:08<00:27, 277.21it/s] 21%|███████████                                         | 2084/9741 [00:08<00:27, 277.71it/s] 22%|███████████▎                                        | 2113/9741 [00:08<00:27, 278.42it/s] 22%|███████████▍                                        | 2142/9741 [00:08<00:27, 278.90it/s] 22%|███████████▌                                        | 2171/9741 [00:08<00:27, 279.31it/s] 23%|███████████▋                                        | 2200/9741 [00:08<00:26, 279.62it/s] 23%|███████████▉                                        | 2229/9741 [00:08<00:26, 279.80it/s] 23%|████████████                                        | 2257/9741 [00:09<00:26, 277.55it/s] 23%|████████████▏                                       | 2286/9741 [00:09<00:26, 278.31it/s] 24%|████████████▎                                       | 2314/9741 [00:09<00:26, 278.74it/s] 24%|████████████▌                                       | 2342/9741 [00:09<00:26, 279.07it/s] 24%|████████████▋                                       | 2371/9741 [00:09<00:26, 279.65it/s] 25%|████████████▊                                       | 2400/9741 [00:09<00:26, 279.92it/s] 25%|████████████▉                                       | 2429/9741 [00:09<00:26, 280.10it/s] 25%|█████████████                                       | 2458/9741 [00:09<00:25, 280.16it/s] 26%|█████████████▎                                      | 2487/9741 [00:09<00:26, 277.82it/s] 26%|█████████████▍                                      | 2515/9741 [00:09<00:25, 278.21it/s] 26%|█████████████▌                                      | 2543/9741 [00:10<00:25, 278.55it/s] 26%|█████████████▋                                      | 2571/9741 [00:10<00:25, 278.87it/s] 27%|█████████████▉                                      | 2600/9741 [00:10<00:25, 279.37it/s] 27%|██████████████                                      | 2628/9741 [00:10<00:25, 279.36it/s] 27%|██████████████▏                                     | 2656/9741 [00:10<00:25, 279.46it/s] 28%|██████████████▎                                     | 2684/9741 [00:10<00:25, 279.43it/s] 28%|██████████████▍                                     | 2712/9741 [00:10<00:25, 276.97it/s] 28%|██████████████▋                                     | 2740/9741 [00:10<00:25, 277.51it/s] 28%|██████████████▊                                     | 2768/9741 [00:10<00:25, 278.15it/s] 29%|██████████████▉                                     | 2796/9741 [00:10<00:24, 278.52it/s] 29%|███████████████                                     | 2824/9741 [00:11<00:24, 278.76it/s] 29%|███████████████▏                                    | 2852/9741 [00:11<00:24, 279.08it/s] 30%|███████████████▎                                    | 2880/9741 [00:11<00:24, 279.24it/s] 30%|███████████████▌                                    | 2908/9741 [00:11<00:24, 279.04it/s] 30%|███████████████▋                                    | 2936/9741 [00:11<00:24, 276.83it/s] 30%|███████████████▊                                    | 2964/9741 [00:11<00:24, 277.18it/s] 31%|███████████████▉                                    | 2993/9741 [00:11<00:24, 278.10it/s] 31%|████████████████▏                                   | 3021/9741 [00:11<00:24, 278.61it/s] 31%|████████████████▎                                   | 3049/9741 [00:11<00:23, 278.87it/s] 32%|████████████████▍                                   | 3077/9741 [00:11<00:23, 278.90it/s] 32%|████████████████▌                                   | 3106/9741 [00:12<00:23, 279.26it/s] 32%|████████████████▋                                   | 3134/9741 [00:12<00:23, 279.27it/s] 32%|████████████████▉                                   | 3162/9741 [00:12<00:23, 276.95it/s] 33%|█████████████████                                   | 3191/9741 [00:12<00:23, 277.99it/s] 33%|█████████████████▏                                  | 3219/9741 [00:12<00:23, 278.28it/s] 33%|█████████████████▎                                  | 3248/9741 [00:12<00:23, 279.29it/s] 34%|█████████████████▍                                  | 3276/9741 [00:12<00:23, 278.81it/s] 34%|█████████████████▋                                  | 3305/9741 [00:12<00:23, 279.24it/s] 34%|█████████████████▊                                  | 3333/9741 [00:12<00:22, 279.45it/s] 35%|█████████████████▉                                  | 3362/9741 [00:13<00:22, 279.74it/s] 35%|██████████████████                                  | 3390/9741 [00:13<00:22, 277.69it/s] 35%|██████████████████▎                                 | 3419/9741 [00:13<00:22, 278.53it/s] 35%|██████████████████▍                                 | 3447/9741 [00:13<00:22, 278.70it/s] 36%|██████████████████▌                                 | 3476/9741 [00:13<00:22, 279.39it/s] 36%|██████████████████▋                                 | 3504/9741 [00:13<00:22, 277.72it/s] 36%|██████████████████▊                                 | 3533/9741 [00:13<00:22, 278.73it/s] 37%|███████████████████                                 | 3562/9741 [00:13<00:22, 279.47it/s] 37%|███████████████████▏                                | 3590/9741 [00:13<00:22, 279.37it/s] 37%|███████████████████▎                                | 3618/9741 [00:13<00:22, 277.60it/s] 37%|███████████████████▍                                | 3647/9741 [00:14<00:21, 278.71it/s] 38%|███████████████████▌                                | 3675/9741 [00:14<00:21, 278.97it/s] 38%|███████████████████▊                                | 3703/9741 [00:14<00:21, 279.17it/s] 38%|███████████████████▉                                | 3731/9741 [00:14<00:21, 279.36it/s] 39%|████████████████████                                | 3759/9741 [00:14<00:21, 278.79it/s] 39%|████████████████████▏                               | 3787/9741 [00:14<00:21, 278.75it/s] 39%|████████████████████▎                               | 3815/9741 [00:14<00:21, 278.67it/s] 39%|████████████████████▌                               | 3843/9741 [00:14<00:21, 276.05it/s] 40%|████████████████████▋                               | 3871/9741 [00:14<00:21, 277.21it/s] 40%|████████████████████▊                               | 3900/9741 [00:14<00:21, 278.08it/s] 40%|████████████████████▉                               | 3928/9741 [00:15<00:20, 278.41it/s] 41%|█████████████████████                               | 3956/9741 [00:15<00:20, 278.70it/s] 41%|█████████████████████▎                              | 3984/9741 [00:15<00:20, 278.64it/s] 41%|█████████████████████▍                              | 4013/9741 [00:15<00:20, 279.08it/s] 41%|█████████████████████▌                              | 4041/9741 [00:15<00:20, 279.11it/s] 42%|█████████████████████▋                              | 4069/9741 [00:15<00:20, 277.14it/s] 42%|█████████████████████▊                              | 4097/9741 [00:15<00:20, 277.83it/s] 42%|██████████████████████                              | 4125/9741 [00:15<00:20, 278.41it/s] 43%|██████████████████████▏                             | 4153/9741 [00:15<00:20, 278.55it/s] 43%|██████████████████████▎                             | 4182/9741 [00:15<00:19, 278.98it/s] 43%|██████████████████████▍                             | 4210/9741 [00:16<00:19, 278.86it/s] 44%|██████████████████████▌                             | 4238/9741 [00:16<00:19, 277.76it/s] 44%|██████████████████████▊                             | 4266/9741 [00:16<00:19, 278.34it/s] 44%|██████████████████████▉                             | 4294/9741 [00:16<00:19, 276.74it/s] 44%|███████████████████████                             | 4322/9741 [00:16<00:19, 277.45it/s] 45%|███████████████████████▏                            | 4350/9741 [00:16<00:19, 278.02it/s] 45%|███████████████████████▎                            | 4378/9741 [00:16<00:19, 278.47it/s] 45%|███████████████████████▌                            | 4406/9741 [00:16<00:19, 278.46it/s] 46%|███████████████████████▋                            | 4434/9741 [00:16<00:19, 278.68it/s] 46%|███████████████████████▊                            | 4462/9741 [00:16<00:18, 278.97it/s] 46%|███████████████████████▉                            | 4490/9741 [00:17<00:18, 278.84it/s] 46%|████████████████████████                            | 4518/9741 [00:17<00:20, 253.38it/s] 47%|████████████████████████▎                           | 4546/9741 [00:17<00:19, 260.18it/s] 47%|████████████████████████▍                           | 4574/9741 [00:17<00:19, 265.36it/s] 47%|████████████████████████▌                           | 4602/9741 [00:17<00:19, 269.13it/s] 48%|████████████████████████▋                           | 4630/9741 [00:17<00:18, 271.99it/s] 48%|████████████████████████▊                           | 4658/9741 [00:17<00:18, 274.18it/s] 48%|█████████████████████████                           | 4686/9741 [00:17<00:18, 273.08it/s] 48%|█████████████████████████▏                          | 4714/9741 [00:17<00:18, 274.94it/s] 49%|█████████████████████████▎                          | 4742/9741 [00:18<00:27, 180.71it/s] 49%|█████████████████████████▍                          | 4770/9741 [00:18<00:24, 201.95it/s] 49%|█████████████████████████▌                          | 4798/9741 [00:18<00:22, 220.14it/s] 50%|█████████████████████████▊                          | 4826/9741 [00:18<00:20, 235.03it/s] 50%|█████████████████████████▉                          | 4854/9741 [00:18<00:19, 246.65it/s] 50%|██████████████████████████                          | 4882/9741 [00:18<00:19, 255.44it/s] 50%|██████████████████████████▏                         | 4910/9741 [00:18<00:18, 262.07it/s] 51%|██████████████████████████▎                         | 4938/9741 [00:18<00:17, 267.05it/s] 51%|██████████████████████████▌                         | 4966/9741 [00:18<00:17, 268.80it/s] 51%|██████████████████████████▋                         | 4994/9741 [00:19<00:17, 271.72it/s] 52%|██████████████████████████▊                         | 5023/9741 [00:19<00:17, 274.20it/s] 52%|██████████████████████████▉                         | 5051/9741 [00:19<00:17, 275.61it/s] 52%|███████████████████████████                         | 5079/9741 [00:19<00:16, 276.67it/s] 52%|███████████████████████████▎                        | 5107/9741 [00:19<00:16, 274.73it/s] 53%|███████████████████████████▍                        | 5135/9741 [00:19<00:16, 275.98it/s] 53%|███████████████████████████▌                        | 5163/9741 [00:19<00:16, 276.95it/s] 53%|███████████████████████████▋                        | 5191/9741 [00:19<00:16, 275.27it/s] 54%|███████████████████████████▊                        | 5219/9741 [00:19<00:16, 276.35it/s] 54%|████████████████████████████                        | 5247/9741 [00:20<00:16, 277.27it/s] 54%|████████████████████████████▏                       | 5275/9741 [00:20<00:16, 277.81it/s] 54%|████████████████████████████▎                       | 5304/9741 [00:20<00:15, 278.73it/s] 55%|████████████████████████████▍                       | 5332/9741 [00:20<00:15, 278.88it/s] 55%|████████████████████████████▌                       | 5360/9741 [00:20<00:15, 278.84it/s] 55%|████████████████████████████▊                       | 5388/9741 [00:20<00:15, 278.87it/s] 56%|████████████████████████████▉                       | 5416/9741 [00:20<00:15, 276.74it/s] 56%|█████████████████████████████                       | 5444/9741 [00:20<00:15, 277.53it/s] 56%|█████████████████████████████▏                      | 5472/9741 [00:20<00:15, 278.25it/s] 56%|█████████████████████████████▎                      | 5501/9741 [00:20<00:15, 280.91it/s] 57%|█████████████████████████████▌                      | 5530/9741 [00:21<00:14, 283.18it/s] 57%|█████████████████████████████▋                      | 5559/9741 [00:21<00:14, 284.63it/s] 57%|█████████████████████████████▊                      | 5588/9741 [00:21<00:14, 281.91it/s] 58%|█████████████████████████████▉                      | 5617/9741 [00:21<00:14, 283.47it/s] 58%|██████████████████████████████▏                     | 5646/9741 [00:21<00:14, 282.63it/s] 58%|██████████████████████████████▎                     | 5675/9741 [00:21<00:14, 284.44it/s] 59%|██████████████████████████████▍                     | 5704/9741 [00:21<00:14, 285.70it/s] 59%|██████████████████████████████▌                     | 5733/9741 [00:21<00:13, 286.87it/s] 59%|██████████████████████████████▊                     | 5762/9741 [00:21<00:13, 287.44it/s] 59%|██████████████████████████████▉                     | 5791/9741 [00:21<00:13, 287.71it/s] 60%|███████████████████████████████                     | 5820/9741 [00:22<00:13, 287.97it/s] 60%|███████████████████████████████▏                    | 5849/9741 [00:22<00:13, 288.15it/s] 60%|███████████████████████████████▍                    | 5878/9741 [00:22<00:13, 286.55it/s] 61%|███████████████████████████████▌                    | 5907/9741 [00:22<00:13, 287.28it/s] 61%|███████████████████████████████▋                    | 5936/9741 [00:22<00:13, 287.70it/s] 61%|███████████████████████████████▊                    | 5965/9741 [00:22<00:13, 288.25it/s] 62%|███████████████████████████████▉                    | 5994/9741 [00:22<00:12, 288.50it/s] 62%|████████████████████████████████▏                   | 6023/9741 [00:22<00:12, 288.48it/s] 62%|████████████████████████████████▎                   | 6052/9741 [00:22<00:12, 288.67it/s] 62%|████████████████████████████████▍                   | 6081/9741 [00:22<00:12, 284.15it/s] 63%|████████████████████████████████▌                   | 6110/9741 [00:23<00:12, 285.67it/s] 63%|████████████████████████████████▊                   | 6139/9741 [00:23<00:12, 286.46it/s] 63%|████████████████████████████████▉                   | 6168/9741 [00:23<00:12, 287.20it/s] 64%|█████████████████████████████████                   | 6197/9741 [00:23<00:12, 287.60it/s] 64%|█████████████████████████████████▏                  | 6226/9741 [00:23<00:12, 287.45it/s] 64%|█████████████████████████████████▍                  | 6255/9741 [00:23<00:12, 287.58it/s] 65%|█████████████████████████████████▌                  | 6284/9741 [00:23<00:12, 288.00it/s] 65%|█████████████████████████████████▋                  | 6313/9741 [00:23<00:11, 286.14it/s] 65%|█████████████████████████████████▊                  | 6342/9741 [00:23<00:11, 286.97it/s] 65%|██████████████████████████████████                  | 6371/9741 [00:23<00:11, 287.55it/s] 66%|██████████████████████████████████▏                 | 6400/9741 [00:24<00:11, 288.06it/s] 66%|██████████████████████████████████▎                 | 6429/9741 [00:24<00:11, 288.13it/s] 66%|██████████████████████████████████▍                 | 6458/9741 [00:24<00:11, 288.27it/s] 67%|██████████████████████████████████▋                 | 6487/9741 [00:24<00:11, 288.20it/s] 67%|██████████████████████████████████▊                 | 6516/9741 [00:24<00:11, 288.24it/s] 67%|██████████████████████████████████▉                 | 6545/9741 [00:24<00:11, 286.42it/s] 67%|███████████████████████████████████                 | 6574/9741 [00:24<00:11, 284.43it/s] 68%|███████████████████████████████████▏                | 6603/9741 [00:24<00:10, 285.36it/s] 68%|███████████████████████████████████▍                | 6632/9741 [00:24<00:10, 286.31it/s] 68%|███████████████████████████████████▌                | 6661/9741 [00:24<00:10, 287.20it/s] 69%|███████████████████████████████████▋                | 6690/9741 [00:25<00:10, 287.71it/s] 69%|███████████████████████████████████▊                | 6719/9741 [00:25<00:10, 287.95it/s] 69%|████████████████████████████████████                | 6748/9741 [00:25<00:10, 288.26it/s] 70%|████████████████████████████████████▏               | 6777/9741 [00:25<00:10, 286.27it/s] 70%|████████████████████████████████████▎               | 6806/9741 [00:25<00:10, 286.93it/s] 70%|████████████████████████████████████▍               | 6835/9741 [00:25<00:10, 287.61it/s] 70%|████████████████████████████████████▋               | 6864/9741 [00:25<00:09, 288.02it/s] 71%|████████████████████████████████████▊               | 6893/9741 [00:25<00:09, 288.26it/s] 71%|████████████████████████████████████▉               | 6922/9741 [00:25<00:09, 288.44it/s] 71%|█████████████████████████████████████               | 6952/9741 [00:25<00:09, 288.89it/s] 72%|█████████████████████████████████████▎              | 6981/9741 [00:26<00:09, 289.13it/s] 72%|█████████████████████████████████████▍              | 7010/9741 [00:26<00:09, 287.10it/s] 72%|█████████████████████████████████████▌              | 7039/9741 [00:26<00:09, 284.45it/s] 73%|█████████████████████████████████████▋              | 7068/9741 [00:26<00:09, 285.56it/s] 73%|█████████████████████████████████████▉              | 7097/9741 [00:26<00:09, 286.49it/s] 73%|██████████████████████████████████████              | 7126/9741 [00:26<00:09, 287.25it/s] 73%|██████████████████████████████████████▏             | 7155/9741 [00:26<00:08, 287.79it/s] 74%|██████████████████████████████████████▎             | 7184/9741 [00:26<00:08, 287.88it/s] 74%|██████████████████████████████████████▌             | 7213/9741 [00:26<00:08, 285.78it/s] 74%|██████████████████████████████████████▋             | 7242/9741 [00:26<00:08, 286.57it/s] 75%|██████████████████████████████████████▊             | 7271/9741 [00:27<00:08, 287.23it/s] 75%|██████████████████████████████████████▉             | 7300/9741 [00:27<00:08, 287.67it/s] 75%|███████████████████████████████████████             | 7329/9741 [00:27<00:08, 288.07it/s] 76%|███████████████████████████████████████▎            | 7358/9741 [00:27<00:08, 288.43it/s] 76%|███████████████████████████████████████▍            | 7387/9741 [00:27<00:08, 288.63it/s] 76%|███████████████████████████████████████▌            | 7416/9741 [00:27<00:08, 288.52it/s] 76%|███████████████████████████████████████▋            | 7445/9741 [00:27<00:09, 248.78it/s] 77%|███████████████████████████████████████▉            | 7474/9741 [00:27<00:08, 259.49it/s] 77%|████████████████████████████████████████            | 7503/9741 [00:27<00:08, 267.50it/s] 77%|████████████████████████████████████████▏           | 7532/9741 [00:28<00:08, 273.23it/s] 78%|████████████████████████████████████████▎           | 7561/9741 [00:28<00:07, 277.77it/s] 78%|████████████████████████████████████████▌           | 7590/9741 [00:28<00:07, 280.87it/s] 78%|████████████████████████████████████████▋           | 7619/9741 [00:28<00:07, 281.62it/s] 79%|████████████████████████████████████████▊           | 7648/9741 [00:28<00:07, 283.48it/s] 79%|████████████████████████████████████████▉           | 7677/9741 [00:28<00:07, 282.83it/s] 79%|█████████████████████████████████████████▏          | 7706/9741 [00:28<00:07, 284.73it/s] 79%|█████████████████████████████████████████▎          | 7735/9741 [00:28<00:07, 286.14it/s] 80%|█████████████████████████████████████████▍          | 7764/9741 [00:28<00:06, 286.76it/s] 80%|█████████████████████████████████████████▌          | 7793/9741 [00:28<00:06, 287.11it/s] 80%|█████████████████████████████████████████▊          | 7822/9741 [00:29<00:06, 287.72it/s] 81%|█████████████████████████████████████████▉          | 7851/9741 [00:29<00:06, 288.23it/s] 81%|██████████████████████████████████████████          | 7880/9741 [00:29<00:06, 287.71it/s] 81%|██████████████████████████████████████████▏         | 7909/9741 [00:29<00:06, 286.48it/s] 81%|██████████████████████████████████████████▍         | 7938/9741 [00:29<00:06, 287.16it/s] 82%|██████████████████████████████████████████▌         | 7967/9741 [00:29<00:06, 287.47it/s] 82%|██████████████████████████████████████████▋         | 7996/9741 [00:29<00:06, 287.60it/s] 82%|██████████████████████████████████████████▊         | 8025/9741 [00:29<00:05, 288.02it/s] 83%|██████████████████████████████████████████▉         | 8054/9741 [00:29<00:05, 287.84it/s] 83%|███████████████████████████████████████████▏        | 8083/9741 [00:29<00:05, 285.90it/s] 83%|███████████████████████████████████████████▎        | 8112/9741 [00:30<00:05, 284.78it/s] 84%|███████████████████████████████████████████▍        | 8141/9741 [00:30<00:05, 283.79it/s] 84%|███████████████████████████████████████████▌        | 8170/9741 [00:30<00:05, 285.18it/s] 84%|███████████████████████████████████████████▊        | 8199/9741 [00:30<00:05, 283.40it/s] 84%|███████████████████████████████████████████▉        | 8228/9741 [00:30<00:05, 284.90it/s] 85%|████████████████████████████████████████████        | 8257/9741 [00:30<00:05, 283.41it/s] 85%|████████████████████████████████████████████▏       | 8286/9741 [00:30<00:05, 284.44it/s] 85%|████████████████████████████████████████████▍       | 8315/9741 [00:30<00:05, 285.18it/s] 86%|████████████████████████████████████████████▌       | 8344/9741 [00:30<00:04, 286.19it/s] 86%|████████████████████████████████████████████▋       | 8373/9741 [00:30<00:04, 284.63it/s] 86%|████████████████████████████████████████████▊       | 8402/9741 [00:31<00:04, 285.46it/s] 87%|█████████████████████████████████████████████       | 8431/9741 [00:31<00:04, 286.56it/s] 87%|█████████████████████████████████████████████▏      | 8460/9741 [00:31<00:04, 287.28it/s] 87%|█████████████████████████████████████████████▎      | 8489/9741 [00:31<00:04, 287.63it/s] 87%|█████████████████████████████████████████████▍      | 8518/9741 [00:31<00:04, 288.11it/s] 88%|█████████████████████████████████████████████▋      | 8547/9741 [00:31<00:04, 287.80it/s] 88%|█████████████████████████████████████████████▊      | 8576/9741 [00:31<00:04, 285.69it/s] 88%|█████████████████████████████████████████████▉      | 8605/9741 [00:31<00:03, 286.37it/s] 89%|██████████████████████████████████████████████      | 8634/9741 [00:31<00:03, 286.85it/s] 89%|██████████████████████████████████████████████▏     | 8663/9741 [00:31<00:03, 287.33it/s] 89%|██████████████████████████████████████████████▍     | 8692/9741 [00:32<00:03, 287.87it/s] 90%|██████████████████████████████████████████████▌     | 8721/9741 [00:32<00:03, 288.19it/s] 90%|██████████████████████████████████████████████▋     | 8750/9741 [00:32<00:03, 287.91it/s] 90%|██████████████████████████████████████████████▊     | 8779/9741 [00:32<00:03, 287.49it/s] 90%|███████████████████████████████████████████████     | 8808/9741 [00:32<00:03, 285.56it/s] 91%|███████████████████████████████████████████████▏    | 8837/9741 [00:32<00:03, 286.49it/s] 91%|███████████████████████████████████████████████▎    | 8866/9741 [00:32<00:03, 286.96it/s] 91%|███████████████████████████████████████████████▍    | 8895/9741 [00:32<00:02, 287.33it/s] 92%|███████████████████████████████████████████████▋    | 8924/9741 [00:32<00:02, 287.83it/s] 92%|███████████████████████████████████████████████▊    | 8953/9741 [00:32<00:02, 288.00it/s] 92%|███████████████████████████████████████████████▉    | 8982/9741 [00:33<00:02, 287.99it/s] 93%|████████████████████████████████████████████████    | 9011/9741 [00:33<00:02, 288.04it/s] 93%|████████████████████████████████████████████████▎   | 9040/9741 [00:33<00:02, 286.03it/s] 93%|████████████████████████████████████████████████▍   | 9069/9741 [00:33<00:02, 286.79it/s] 93%|████████████████████████████████████████████████▌   | 9098/9741 [00:33<00:02, 287.20it/s] 94%|████████████████████████████████████████████████▋   | 9127/9741 [00:33<00:02, 287.42it/s] 94%|████████████████████████████████████████████████▉   | 9156/9741 [00:33<00:02, 287.57it/s] 94%|█████████████████████████████████████████████████   | 9185/9741 [00:33<00:01, 287.52it/s] 95%|█████████████████████████████████████████████████▏  | 9214/9741 [00:33<00:01, 287.91it/s] 95%|█████████████████████████████████████████████████▎  | 9243/9741 [00:33<00:01, 288.30it/s] 95%|█████████████████████████████████████████████████▍  | 9272/9741 [00:34<00:01, 286.60it/s] 95%|█████████████████████████████████████████████████▋  | 9301/9741 [00:34<00:01, 287.06it/s] 96%|█████████████████████████████████████████████████▊  | 9330/9741 [00:34<00:01, 287.62it/s] 96%|█████████████████████████████████████████████████▉  | 9359/9741 [00:34<00:01, 287.64it/s] 96%|██████████████████████████████████████████████████  | 9388/9741 [00:34<00:01, 287.45it/s] 97%|██████████████████████████████████████████████████▎ | 9417/9741 [00:34<00:01, 287.53it/s] 97%|██████████████████████████████████████████████████▍ | 9446/9741 [00:34<00:01, 287.69it/s] 97%|██████████████████████████████████████████████████▌ | 9475/9741 [00:34<00:00, 287.61it/s] 98%|██████████████████████████████████████████████████▋ | 9504/9741 [00:34<00:00, 285.70it/s] 98%|██████████████████████████████████████████████████▉ | 9533/9741 [00:35<00:00, 286.33it/s] 98%|███████████████████████████████████████████████████ | 9562/9741 [00:35<00:00, 286.87it/s] 98%|███████████████████████████████████████████████████▏| 9591/9741 [00:35<00:00, 287.12it/s] 99%|███████████████████████████████████████████████████▎| 9620/9741 [00:35<00:00, 287.39it/s] 99%|███████████████████████████████████████████████████▌| 9649/9741 [00:35<00:00, 287.63it/s] 99%|███████████████████████████████████████████████████▋| 9678/9741 [00:35<00:00, 287.98it/s]100%|███████████████████████████████████████████████████▊| 9707/9741 [00:35<00:00, 287.83it/s]100%|███████████████████████████████████████████████████▉| 9736/9741 [00:35<00:00, 285.71it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:35<00:00, 272.58it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.37s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.49s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:04,  5.00s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.23s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.86s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.37s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.55s/it]
[2023-08-22 05:37:23,282] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.63s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.98s/it]
[2023-08-22 05:37:32,108] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 05:37:32,108] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f6adff7bfd0>
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 05:37:32,109] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f6adcd23220>
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 05:37:32,110] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 05:37:32,111] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.582606315612793 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input: Sam, Sid, and Steve brought popsicle sticks for their group activity in their Art class. Sam has thrice as many as Sid, and Sid has twice as many as Steve. If Steve has 12 popsicle sticks, how many popsicle sticks can they use for their Art class activity?
Output: 108

Input: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.
Output: 720

Input: John uses a 75-watt electric fan for 8 hours a day. How much kWh of electric energy does he consume per month (30 days) for using the electric fan?
Output: 18

Input: Barbara Blackburn can type 212 words per minute.  Due to Carpal tunnel syndrome, Barbara cannot use her left hand for a while so her typing speed is now 40 words less per minute. If she is supposed to type a document with 3440 words, how many minutes will it take her to finish typing the document?
Output: 20

Input: Max fills up water balloons for 30 minutes at a rate of 2 water balloons every minute. Max’s friend Zach fills up water balloons for 40 minutes at a rate of 3 water balloons every minute. In the process, 10 of the water balloons pop on the ground. How many filled water balloons do Max and Zach have in total?
Output: 170

Input: John has 54 pieces of gum, Cole has 45 pieces of gum and Aubrey has no pieces of gum. They decide to share the gum equally between the 3 of them. How many pieces of gum will each one get?
Output: 33

Input: Mira jogs every morning. She jogs 5 miles per hour. If she jogs for 2 hours every morning, how many miles can she jog for five days?
Output: 50

Input: Rita is reading a five-chapter book with 95 pages. Each chapter has three pages more than the previous one. How many pages does the first chapter have?
Output: 13

Input: Nancy and Jason are learning to dance for the first time. Nancy steps on her partner's feet 3 times as often as Jason. If together they step on each other's feet 32 times, how many times does Jason step on his partner's feet?
Output: 8

Input: Maisie and Donna dropped off flyers for a neighborhood clean-up day at houses around their neighborhood. Maisie walked down the shorter left street and dropped off 33 flyers. Donna took the long right street on her bicycle and dropped off five more than twice as many flyers as Maisie. How many flyers did Donna drop off?
Output: 71

Input: In a show, there can be 5 actors at a time. Every actor is in the show for about 15 minutes, and then another 5 actors come in. How many actors can there be on the show in 1 hour?
Output: 20

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o24-tgsm8k-s20-rFalse
Loading extension module utils...
Time to load utils op: 0.5047013759613037 seconds
Loading extension module utils...
Time to load utils op: 0.6046295166015625 seconds
Loading extension module utils...
Time to load utils op: 0.40458035469055176 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3571948) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-22_05:37:39
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3571949)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-22_05:37:39
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3571950)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-22_05:37:39
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3571951)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-22_05:37:39
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3571948)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o25-tgsm8k-s20-rFalse --seed 20 --max-prompt-length 2048 --num-out-domain 25
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 05:37:42,765] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o25-tgsm8k-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 25
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o25-tgsm8k-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|                                                      | 18/9741 [00:00<00:54, 176.94it/s]  0%|▏                                                     | 36/9741 [00:00<00:54, 177.33it/s]  1%|▎                                                     | 54/9741 [00:00<00:54, 177.92it/s]  1%|▍                                                     | 72/9741 [00:00<00:54, 178.09it/s]  1%|▍                                                     | 90/9741 [00:00<00:54, 178.28it/s]  1%|▌                                                    | 108/9741 [00:00<00:53, 178.62it/s]  1%|▋                                                    | 126/9741 [00:00<00:54, 175.78it/s]  1%|▊                                                    | 144/9741 [00:00<00:54, 176.44it/s]  2%|▉                                                    | 162/9741 [00:00<00:54, 177.16it/s]  2%|▉                                                    | 180/9741 [00:01<00:53, 177.48it/s]  2%|█                                                    | 198/9741 [00:01<00:53, 177.94it/s]  2%|█▏                                                   | 216/9741 [00:01<00:53, 176.69it/s]  2%|█▎                                                   | 234/9741 [00:01<00:53, 177.40it/s]  3%|█▎                                                   | 252/9741 [00:01<00:53, 177.77it/s]  3%|█▍                                                   | 270/9741 [00:01<00:53, 178.12it/s]  3%|█▌                                                   | 288/9741 [00:01<00:53, 176.08it/s]  3%|█▋                                                   | 306/9741 [00:01<00:53, 176.83it/s]  3%|█▊                                                   | 324/9741 [00:01<00:53, 177.38it/s]  4%|█▊                                                   | 342/9741 [00:01<00:52, 177.86it/s]  4%|█▉                                                   | 360/9741 [00:02<00:52, 178.12it/s]  4%|██                                                   | 378/9741 [00:02<00:52, 178.37it/s]  4%|██▏                                                  | 396/9741 [00:02<00:52, 178.62it/s]  4%|██▎                                                  | 421/9741 [00:02<00:47, 198.25it/s]  5%|██▍                                                  | 448/9741 [00:02<00:42, 217.75it/s]  5%|██▌                                                  | 476/9741 [00:02<00:39, 234.33it/s]  5%|██▋                                                  | 504/9741 [00:02<00:37, 245.42it/s]  5%|██▉                                                  | 532/9741 [00:02<00:36, 253.51it/s]  6%|███                                                  | 560/9741 [00:02<00:35, 258.68it/s]  6%|███▏                                                 | 588/9741 [00:02<00:34, 262.77it/s]  6%|███▎                                                 | 616/9741 [00:03<00:34, 265.64it/s]  7%|███▌                                                 | 644/9741 [00:03<00:33, 267.76it/s]  7%|███▋                                                 | 671/9741 [00:03<00:33, 267.28it/s]  7%|███▊                                                 | 699/9741 [00:03<00:33, 268.99it/s]  7%|███▉                                                 | 727/9741 [00:03<00:33, 269.81it/s]  8%|████                                                 | 755/9741 [00:03<00:33, 270.51it/s]  8%|████▎                                                | 783/9741 [00:03<00:33, 270.84it/s]  8%|████▍                                                | 811/9741 [00:03<00:32, 271.26it/s]  9%|████▌                                                | 839/9741 [00:03<00:32, 271.51it/s]  9%|████▋                                                | 867/9741 [00:03<00:32, 271.15it/s]  9%|████▊                                                | 895/9741 [00:04<00:32, 269.39it/s]  9%|█████                                                | 923/9741 [00:04<00:32, 270.06it/s] 10%|█████▏                                               | 951/9741 [00:04<00:32, 270.55it/s] 10%|█████▎                                               | 979/9741 [00:04<00:32, 270.85it/s] 10%|█████▍                                              | 1007/9741 [00:04<00:32, 271.14it/s] 11%|█████▌                                              | 1035/9741 [00:04<00:32, 271.58it/s] 11%|█████▋                                              | 1063/9741 [00:04<00:31, 271.74it/s] 11%|█████▊                                              | 1091/9741 [00:04<00:31, 271.91it/s] 11%|█████▉                                              | 1119/9741 [00:04<00:32, 268.75it/s] 12%|██████                                              | 1146/9741 [00:05<00:31, 269.01it/s] 12%|██████▎                                             | 1173/9741 [00:05<00:31, 269.25it/s] 12%|██████▍                                             | 1201/9741 [00:05<00:31, 269.87it/s] 13%|██████▌                                             | 1228/9741 [00:05<00:31, 268.62it/s] 13%|██████▋                                             | 1256/9741 [00:05<00:31, 269.66it/s] 13%|██████▊                                             | 1284/9741 [00:05<00:31, 270.06it/s] 13%|███████                                             | 1312/9741 [00:05<00:31, 270.53it/s] 14%|███████▏                                            | 1340/9741 [00:05<00:31, 268.80it/s] 14%|███████▎                                            | 1368/9741 [00:05<00:31, 269.69it/s] 14%|███████▍                                            | 1396/9741 [00:05<00:30, 270.01it/s] 15%|███████▌                                            | 1424/9741 [00:06<00:30, 270.44it/s] 15%|███████▊                                            | 1452/9741 [00:06<00:30, 270.44it/s] 15%|███████▉                                            | 1480/9741 [00:06<00:30, 269.45it/s] 15%|████████                                            | 1507/9741 [00:06<00:30, 269.45it/s] 16%|████████▏                                           | 1535/9741 [00:06<00:30, 270.06it/s] 16%|████████▎                                           | 1563/9741 [00:06<00:30, 264.52it/s] 16%|████████▍                                           | 1591/9741 [00:06<00:30, 266.36it/s] 17%|████████▋                                           | 1619/9741 [00:06<00:30, 267.71it/s] 17%|████████▊                                           | 1647/9741 [00:06<00:30, 268.67it/s] 17%|████████▉                                           | 1675/9741 [00:06<00:29, 269.31it/s] 17%|█████████                                           | 1703/9741 [00:07<00:29, 269.92it/s] 18%|█████████▏                                          | 1731/9741 [00:07<00:29, 270.33it/s] 18%|█████████▍                                          | 1759/9741 [00:07<00:29, 270.75it/s] 18%|█████████▌                                          | 1787/9741 [00:07<00:29, 270.34it/s] 19%|█████████▋                                          | 1815/9741 [00:07<00:32, 246.34it/s] 19%|█████████▊                                          | 1843/9741 [00:07<00:31, 253.02it/s] 19%|█████████▉                                          | 1871/9741 [00:07<00:30, 258.18it/s] 19%|██████████▏                                         | 1899/9741 [00:07<00:29, 261.93it/s] 20%|██████████▎                                         | 1926/9741 [00:07<00:29, 263.00it/s] 20%|██████████▍                                         | 1954/9741 [00:08<00:29, 265.30it/s] 20%|██████████▌                                         | 1982/9741 [00:08<00:29, 267.03it/s] 21%|██████████▋                                         | 2010/9741 [00:08<00:28, 268.15it/s] 21%|██████████▊                                         | 2037/9741 [00:08<00:28, 266.70it/s] 21%|███████████                                         | 2065/9741 [00:08<00:28, 267.88it/s] 21%|███████████▏                                        | 2092/9741 [00:08<00:28, 268.09it/s] 22%|███████████▎                                        | 2119/9741 [00:08<00:28, 268.28it/s] 22%|███████████▍                                        | 2147/9741 [00:08<00:28, 268.89it/s] 22%|███████████▌                                        | 2175/9741 [00:08<00:28, 269.48it/s] 23%|███████████▊                                        | 2202/9741 [00:08<00:27, 269.33it/s] 23%|███████████▉                                        | 2230/9741 [00:09<00:27, 269.93it/s] 23%|████████████                                        | 2257/9741 [00:09<00:27, 268.13it/s] 23%|████████████▏                                       | 2285/9741 [00:09<00:27, 269.02it/s] 24%|████████████▎                                       | 2313/9741 [00:09<00:27, 269.74it/s] 24%|████████████▍                                       | 2341/9741 [00:09<00:27, 269.91it/s] 24%|████████████▋                                       | 2368/9741 [00:09<00:27, 269.54it/s] 25%|████████████▊                                       | 2396/9741 [00:09<00:27, 270.09it/s] 25%|████████████▉                                       | 2424/9741 [00:09<00:27, 270.19it/s] 25%|█████████████                                       | 2452/9741 [00:09<00:26, 270.59it/s] 25%|█████████████▏                                      | 2480/9741 [00:09<00:27, 268.63it/s] 26%|█████████████▍                                      | 2507/9741 [00:10<00:26, 269.01it/s] 26%|█████████████▌                                      | 2535/9741 [00:10<00:26, 269.32it/s] 26%|█████████████▋                                      | 2563/9741 [00:10<00:26, 269.81it/s] 27%|█████████████▊                                      | 2591/9741 [00:10<00:26, 269.93it/s] 27%|█████████████▉                                      | 2618/9741 [00:10<00:26, 269.74it/s] 27%|██████████████                                      | 2645/9741 [00:10<00:26, 269.33it/s] 27%|██████████████▎                                     | 2673/9741 [00:10<00:26, 269.81it/s] 28%|██████████████▍                                     | 2700/9741 [00:10<00:26, 267.92it/s] 28%|██████████████▌                                     | 2727/9741 [00:10<00:26, 268.29it/s] 28%|██████████████▋                                     | 2755/9741 [00:11<00:25, 269.06it/s] 29%|██████████████▊                                     | 2782/9741 [00:11<00:25, 269.31it/s] 29%|███████████████                                     | 2810/9741 [00:11<00:25, 269.71it/s] 29%|███████████████▏                                    | 2838/9741 [00:11<00:25, 269.96it/s] 29%|███████████████▎                                    | 2866/9741 [00:11<00:25, 270.01it/s] 30%|███████████████▍                                    | 2894/9741 [00:11<00:25, 270.36it/s] 30%|███████████████▌                                    | 2922/9741 [00:11<00:25, 270.84it/s] 30%|███████████████▋                                    | 2950/9741 [00:11<00:25, 268.89it/s] 31%|███████████████▉                                    | 2977/9741 [00:11<00:25, 269.20it/s] 31%|████████████████                                    | 3005/9741 [00:11<00:24, 269.69it/s] 31%|████████████████▏                                   | 3033/9741 [00:12<00:24, 270.13it/s] 31%|████████████████▎                                   | 3061/9741 [00:12<00:24, 270.19it/s] 32%|████████████████▍                                   | 3089/9741 [00:12<00:24, 270.50it/s] 32%|████████████████▋                                   | 3117/9741 [00:12<00:24, 270.77it/s] 32%|████████████████▊                                   | 3145/9741 [00:12<00:24, 270.87it/s] 33%|████████████████▉                                   | 3173/9741 [00:12<00:24, 269.09it/s] 33%|█████████████████                                   | 3201/9741 [00:12<00:24, 269.93it/s] 33%|█████████████████▏                                  | 3229/9741 [00:12<00:24, 270.14it/s] 33%|█████████████████▍                                  | 3257/9741 [00:12<00:23, 270.50it/s] 34%|█████████████████▌                                  | 3285/9741 [00:12<00:23, 269.80it/s] 34%|█████████████████▋                                  | 3313/9741 [00:13<00:23, 270.20it/s] 34%|█████████████████▊                                  | 3341/9741 [00:13<00:23, 270.27it/s] 35%|█████████████████▉                                  | 3369/9741 [00:13<00:23, 270.22it/s] 35%|██████████████████▏                                 | 3397/9741 [00:13<00:23, 268.50it/s] 35%|██████████████████▎                                 | 3425/9741 [00:13<00:23, 269.32it/s] 35%|██████████████████▍                                 | 3453/9741 [00:13<00:23, 269.71it/s] 36%|██████████████████▌                                 | 3481/9741 [00:13<00:23, 270.14it/s] 36%|██████████████████▋                                 | 3509/9741 [00:13<00:23, 270.09it/s] 36%|██████████████████▉                                 | 3537/9741 [00:13<00:22, 270.27it/s] 37%|███████████████████                                 | 3565/9741 [00:14<00:22, 270.33it/s] 37%|███████████████████▏                                | 3593/9741 [00:14<00:22, 270.38it/s] 37%|███████████████████▎                                | 3621/9741 [00:14<00:22, 268.63it/s] 37%|███████████████████▍                                | 3649/9741 [00:14<00:22, 269.31it/s] 38%|███████████████████▌                                | 3676/9741 [00:14<00:22, 269.44it/s] 38%|███████████████████▊                                | 3704/9741 [00:14<00:22, 269.87it/s] 38%|███████████████████▉                                | 3732/9741 [00:14<00:22, 270.36it/s] 39%|████████████████████                                | 3760/9741 [00:14<00:22, 269.70it/s] 39%|████████████████████▏                               | 3788/9741 [00:14<00:22, 270.12it/s] 39%|████████████████████▎                               | 3816/9741 [00:14<00:21, 270.09it/s] 39%|████████████████████▌                               | 3844/9741 [00:15<00:21, 268.22it/s] 40%|████████████████████▋                               | 3872/9741 [00:15<00:21, 269.04it/s] 40%|████████████████████▊                               | 3900/9741 [00:15<00:21, 269.84it/s] 40%|████████████████████▉                               | 3928/9741 [00:15<00:21, 270.13it/s] 41%|█████████████████████                               | 3956/9741 [00:15<00:21, 270.29it/s] 41%|█████████████████████▎                              | 3984/9741 [00:15<00:21, 270.33it/s] 41%|█████████████████████▍                              | 4012/9741 [00:15<00:21, 270.72it/s] 41%|█████████████████████▌                              | 4040/9741 [00:15<00:21, 270.77it/s] 42%|█████████████████████▋                              | 4068/9741 [00:15<00:21, 268.83it/s] 42%|█████████████████████▊                              | 4096/9741 [00:15<00:20, 269.49it/s] 42%|██████████████████████                              | 4124/9741 [00:16<00:20, 269.77it/s] 43%|██████████████████████▏                             | 4152/9741 [00:16<00:20, 270.04it/s] 43%|██████████████████████▎                             | 4180/9741 [00:16<00:20, 270.34it/s] 43%|██████████████████████▍                             | 4208/9741 [00:16<00:20, 268.26it/s] 43%|██████████████████████▌                             | 4236/9741 [00:16<00:20, 269.06it/s] 44%|██████████████████████▊                             | 4264/9741 [00:16<00:20, 269.56it/s] 44%|██████████████████████▉                             | 4291/9741 [00:16<00:20, 268.00it/s] 44%|███████████████████████                             | 4319/9741 [00:16<00:20, 268.70it/s] 45%|███████████████████████▏                            | 4346/9741 [00:16<00:20, 268.11it/s] 45%|███████████████████████▎                            | 4373/9741 [00:17<00:20, 266.95it/s] 45%|███████████████████████▍                            | 4400/9741 [00:17<00:20, 266.73it/s] 45%|███████████████████████▋                            | 4427/9741 [00:17<00:19, 266.66it/s] 46%|███████████████████████▊                            | 4454/9741 [00:17<00:19, 266.81it/s] 46%|███████████████████████▉                            | 4481/9741 [00:17<00:19, 266.89it/s] 46%|████████████████████████                            | 4508/9741 [00:17<00:19, 266.87it/s] 47%|████████████████████████▏                           | 4535/9741 [00:17<00:21, 241.46it/s] 47%|████████████████████████▎                           | 4562/9741 [00:17<00:20, 248.49it/s] 47%|████████████████████████▍                           | 4589/9741 [00:17<00:20, 253.85it/s] 47%|████████████████████████▋                           | 4616/9741 [00:17<00:19, 257.59it/s] 48%|████████████████████████▊                           | 4642/9741 [00:18<00:19, 257.92it/s] 48%|████████████████████████▉                           | 4669/9741 [00:18<00:19, 260.70it/s] 48%|█████████████████████████                           | 4696/9741 [00:18<00:19, 262.69it/s] 48%|█████████████████████████▏                          | 4723/9741 [00:18<00:19, 264.06it/s] 49%|█████████████████████████▎                          | 4750/9741 [00:18<00:27, 180.52it/s] 49%|█████████████████████████▌                          | 4777/9741 [00:18<00:24, 199.86it/s] 49%|█████████████████████████▋                          | 4804/9741 [00:18<00:22, 216.05it/s] 50%|█████████████████████████▊                          | 4831/9741 [00:18<00:21, 228.95it/s] 50%|█████████████████████████▉                          | 4858/9741 [00:19<00:20, 238.53it/s] 50%|██████████████████████████                          | 4885/9741 [00:19<00:19, 245.99it/s] 50%|██████████████████████████▏                         | 4912/9741 [00:19<00:19, 251.74it/s] 51%|██████████████████████████▎                         | 4939/9741 [00:19<00:18, 255.99it/s] 51%|██████████████████████████▌                         | 4966/9741 [00:19<00:18, 257.51it/s] 51%|██████████████████████████▋                         | 4993/9741 [00:19<00:18, 260.14it/s] 52%|██████████████████████████▊                         | 5020/9741 [00:19<00:18, 262.07it/s] 52%|██████████████████████████▉                         | 5047/9741 [00:19<00:17, 261.31it/s] 52%|███████████████████████████                         | 5074/9741 [00:19<00:17, 262.86it/s] 52%|███████████████████████████▏                        | 5101/9741 [00:19<00:17, 264.02it/s] 53%|███████████████████████████▎                        | 5128/9741 [00:20<00:17, 264.83it/s] 53%|███████████████████████████▌                        | 5155/9741 [00:20<00:17, 265.24it/s] 53%|███████████████████████████▋                        | 5182/9741 [00:20<00:17, 263.60it/s] 53%|███████████████████████████▊                        | 5209/9741 [00:20<00:17, 264.56it/s] 54%|███████████████████████████▉                        | 5236/9741 [00:20<00:16, 265.18it/s] 54%|████████████████████████████                        | 5263/9741 [00:20<00:16, 265.53it/s] 54%|████████████████████████████▏                       | 5290/9741 [00:20<00:16, 265.81it/s] 55%|████████████████████████████▍                       | 5317/9741 [00:20<00:16, 266.03it/s] 55%|████████████████████████████▌                       | 5344/9741 [00:20<00:16, 266.94it/s] 55%|████████████████████████████▋                       | 5372/9741 [00:20<00:16, 268.08it/s] 55%|████████████████████████████▊                       | 5399/9741 [00:21<00:16, 265.94it/s] 56%|████████████████████████████▉                       | 5427/9741 [00:21<00:16, 267.25it/s] 56%|█████████████████████████████                       | 5455/9741 [00:21<00:15, 268.23it/s] 56%|█████████████████████████████▎                      | 5483/9741 [00:21<00:15, 269.65it/s] 57%|█████████████████████████████▍                      | 5511/9741 [00:21<00:15, 269.92it/s] 57%|█████████████████████████████▌                      | 5539/9741 [00:21<00:15, 272.55it/s] 57%|█████████████████████████████▋                      | 5567/9741 [00:21<00:15, 274.43it/s] 57%|█████████████████████████████▊                      | 5595/9741 [00:21<00:15, 275.40it/s] 58%|██████████████████████████████                      | 5623/9741 [00:21<00:15, 274.46it/s] 58%|██████████████████████████████▏                     | 5651/9741 [00:21<00:14, 275.46it/s] 58%|██████████████████████████████▎                     | 5679/9741 [00:22<00:14, 276.18it/s] 59%|██████████████████████████████▍                     | 5707/9741 [00:22<00:14, 276.74it/s] 59%|██████████████████████████████▌                     | 5735/9741 [00:22<00:14, 277.33it/s] 59%|██████████████████████████████▊                     | 5763/9741 [00:22<00:14, 277.44it/s] 59%|██████████████████████████████▉                     | 5791/9741 [00:22<00:14, 277.71it/s] 60%|███████████████████████████████                     | 5819/9741 [00:22<00:14, 277.93it/s] 60%|███████████████████████████████▏                    | 5847/9741 [00:22<00:14, 277.72it/s] 60%|███████████████████████████████▎                    | 5875/9741 [00:22<00:14, 275.95it/s] 61%|███████████████████████████████▌                    | 5903/9741 [00:22<00:13, 276.56it/s] 61%|███████████████████████████████▋                    | 5931/9741 [00:22<00:13, 276.92it/s] 61%|███████████████████████████████▊                    | 5959/9741 [00:23<00:13, 277.22it/s] 61%|███████████████████████████████▉                    | 5987/9741 [00:23<00:13, 275.24it/s] 62%|████████████████████████████████                    | 6015/9741 [00:23<00:13, 276.10it/s] 62%|████████████████████████████████▎                   | 6043/9741 [00:23<00:13, 276.71it/s] 62%|████████████████████████████████▍                   | 6071/9741 [00:23<00:13, 276.94it/s] 63%|████████████████████████████████▌                   | 6099/9741 [00:23<00:13, 274.12it/s] 63%|████████████████████████████████▋                   | 6127/9741 [00:23<00:13, 275.16it/s] 63%|████████████████████████████████▊                   | 6155/9741 [00:23<00:12, 276.04it/s] 63%|█████████████████████████████████                   | 6183/9741 [00:23<00:12, 276.71it/s] 64%|█████████████████████████████████▏                  | 6211/9741 [00:24<00:12, 276.98it/s] 64%|█████████████████████████████████▎                  | 6239/9741 [00:24<00:12, 277.04it/s] 64%|█████████████████████████████████▍                  | 6267/9741 [00:24<00:12, 277.29it/s] 65%|█████████████████████████████████▌                  | 6295/9741 [00:24<00:12, 277.59it/s] 65%|█████████████████████████████████▊                  | 6323/9741 [00:24<00:12, 275.78it/s] 65%|█████████████████████████████████▉                  | 6351/9741 [00:24<00:12, 276.67it/s] 65%|██████████████████████████████████                  | 6379/9741 [00:24<00:12, 276.95it/s] 66%|██████████████████████████████████▏                 | 6407/9741 [00:24<00:12, 277.29it/s] 66%|██████████████████████████████████▎                 | 6435/9741 [00:24<00:11, 277.58it/s] 66%|██████████████████████████████████▌                 | 6463/9741 [00:24<00:11, 274.46it/s] 67%|██████████████████████████████████▋                 | 6491/9741 [00:25<00:11, 275.49it/s] 67%|██████████████████████████████████▊                 | 6519/9741 [00:25<00:11, 276.08it/s] 67%|██████████████████████████████████▉                 | 6547/9741 [00:25<00:11, 274.58it/s] 67%|███████████████████████████████████                 | 6575/9741 [00:25<00:11, 275.58it/s] 68%|███████████████████████████████████▏                | 6603/9741 [00:25<00:11, 276.18it/s] 68%|███████████████████████████████████▍                | 6631/9741 [00:25<00:11, 276.96it/s] 68%|███████████████████████████████████▌                | 6659/9741 [00:25<00:11, 277.15it/s] 69%|███████████████████████████████████▋                | 6687/9741 [00:25<00:11, 277.45it/s] 69%|███████████████████████████████████▊                | 6715/9741 [00:25<00:10, 277.66it/s] 69%|███████████████████████████████████▉                | 6743/9741 [00:25<00:10, 277.87it/s] 70%|████████████████████████████████████▏               | 6771/9741 [00:26<00:10, 276.21it/s] 70%|████████████████████████████████████▎               | 6799/9741 [00:26<00:10, 276.75it/s] 70%|████████████████████████████████████▍               | 6827/9741 [00:26<00:10, 277.33it/s] 70%|████████████████████████████████████▌               | 6855/9741 [00:26<00:10, 277.65it/s] 71%|████████████████████████████████████▋               | 6883/9741 [00:26<00:10, 277.94it/s] 71%|████████████████████████████████████▉               | 6911/9741 [00:26<00:10, 278.09it/s] 71%|█████████████████████████████████████               | 6939/9741 [00:26<00:10, 278.20it/s] 72%|█████████████████████████████████████▏              | 6967/9741 [00:26<00:10, 276.34it/s] 72%|█████████████████████████████████████▎              | 6995/9741 [00:26<00:09, 275.18it/s] 72%|█████████████████████████████████████▍              | 7023/9741 [00:26<00:09, 276.00it/s] 72%|█████████████████████████████████████▋              | 7051/9741 [00:27<00:09, 275.04it/s] 73%|█████████████████████████████████████▊              | 7079/9741 [00:27<00:09, 275.87it/s] 73%|█████████████████████████████████████▉              | 7107/9741 [00:27<00:09, 276.60it/s] 73%|██████████████████████████████████████              | 7135/9741 [00:27<00:09, 277.15it/s] 74%|██████████████████████████████████████▏             | 7163/9741 [00:27<00:09, 277.45it/s] 74%|██████████████████████████████████████▍             | 7191/9741 [00:27<00:09, 277.80it/s] 74%|██████████████████████████████████████▌             | 7219/9741 [00:27<00:09, 275.91it/s] 74%|██████████████████████████████████████▋             | 7247/9741 [00:27<00:09, 276.43it/s] 75%|██████████████████████████████████████▊             | 7275/9741 [00:27<00:08, 276.81it/s] 75%|██████████████████████████████████████▉             | 7303/9741 [00:27<00:08, 277.24it/s] 75%|███████████████████████████████████████▏            | 7331/9741 [00:28<00:08, 277.52it/s] 76%|███████████████████████████████████████▎            | 7359/9741 [00:28<00:08, 277.90it/s] 76%|███████████████████████████████████████▍            | 7387/9741 [00:28<00:08, 278.23it/s] 76%|███████████████████████████████████████▌            | 7415/9741 [00:28<00:08, 278.28it/s] 76%|███████████████████████████████████████▋            | 7443/9741 [00:28<00:09, 244.45it/s] 77%|███████████████████████████████████████▉            | 7471/9741 [00:28<00:08, 253.66it/s] 77%|████████████████████████████████████████            | 7499/9741 [00:28<00:08, 260.40it/s] 77%|████████████████████████████████████████▏           | 7527/9741 [00:28<00:08, 265.22it/s] 78%|████████████████████████████████████████▎           | 7555/9741 [00:28<00:08, 268.94it/s] 78%|████████████████████████████████████████▍           | 7583/9741 [00:29<00:07, 271.47it/s] 78%|████████████████████████████████████████▋           | 7611/9741 [00:29<00:07, 273.10it/s] 78%|████████████████████████████████████████▊           | 7639/9741 [00:29<00:07, 274.73it/s] 79%|████████████████████████████████████████▉           | 7667/9741 [00:29<00:07, 273.38it/s] 79%|█████████████████████████████████████████           | 7695/9741 [00:29<00:07, 274.67it/s] 79%|█████████████████████████████████████████▏          | 7723/9741 [00:29<00:07, 275.72it/s] 80%|█████████████████████████████████████████▍          | 7751/9741 [00:29<00:07, 276.52it/s] 80%|█████████████████████████████████████████▌          | 7779/9741 [00:29<00:07, 276.90it/s] 80%|█████████████████████████████████████████▋          | 7807/9741 [00:29<00:06, 277.27it/s] 80%|█████████████████████████████████████████▊          | 7835/9741 [00:29<00:06, 277.55it/s] 81%|█████████████████████████████████████████▉          | 7863/9741 [00:30<00:06, 277.65it/s] 81%|██████████████████████████████████████████          | 7891/9741 [00:30<00:06, 277.67it/s] 81%|██████████████████████████████████████████▎         | 7919/9741 [00:30<00:06, 275.99it/s] 82%|██████████████████████████████████████████▍         | 7947/9741 [00:30<00:06, 276.49it/s] 82%|██████████████████████████████████████████▌         | 7975/9741 [00:30<00:06, 276.82it/s] 82%|██████████████████████████████████████████▋         | 8003/9741 [00:30<00:06, 277.25it/s] 82%|██████████████████████████████████████████▊         | 8031/9741 [00:30<00:06, 277.42it/s] 83%|███████████████████████████████████████████         | 8059/9741 [00:30<00:06, 277.55it/s] 83%|███████████████████████████████████████████▏        | 8087/9741 [00:30<00:05, 277.92it/s] 83%|███████████████████████████████████████████▎        | 8115/9741 [00:30<00:05, 278.15it/s] 84%|███████████████████████████████████████████▍        | 8143/9741 [00:31<00:05, 276.47it/s] 84%|███████████████████████████████████████████▌        | 8171/9741 [00:31<00:05, 276.55it/s] 84%|███████████████████████████████████████████▊        | 8199/9741 [00:31<00:05, 277.11it/s] 84%|███████████████████████████████████████████▉        | 8227/9741 [00:31<00:05, 277.39it/s] 85%|████████████████████████████████████████████        | 8255/9741 [00:31<00:05, 277.76it/s] 85%|████████████████████████████████████████████▏       | 8283/9741 [00:31<00:05, 277.43it/s] 85%|████████████████████████████████████████████▎       | 8311/9741 [00:31<00:05, 277.44it/s] 86%|████████████████████████████████████████████▌       | 8339/9741 [00:31<00:05, 277.57it/s] 86%|████████████████████████████████████████████▋       | 8367/9741 [00:31<00:04, 275.63it/s] 86%|████████████████████████████████████████████▊       | 8395/9741 [00:31<00:04, 275.93it/s] 86%|████████████████████████████████████████████▉       | 8423/9741 [00:32<00:04, 276.61it/s] 87%|█████████████████████████████████████████████       | 8451/9741 [00:32<00:04, 277.03it/s] 87%|█████████████████████████████████████████████▎      | 8479/9741 [00:32<00:04, 277.27it/s] 87%|█████████████████████████████████████████████▍      | 8507/9741 [00:32<00:04, 277.73it/s] 88%|█████████████████████████████████████████████▌      | 8535/9741 [00:32<00:04, 277.60it/s] 88%|█████████████████████████████████████████████▋      | 8563/9741 [00:32<00:04, 277.71it/s] 88%|█████████████████████████████████████████████▊      | 8591/9741 [00:32<00:04, 275.88it/s] 88%|██████████████████████████████████████████████      | 8619/9741 [00:32<00:04, 276.16it/s] 89%|██████████████████████████████████████████████▏     | 8647/9741 [00:32<00:03, 276.53it/s] 89%|██████████████████████████████████████████████▎     | 8675/9741 [00:32<00:03, 276.73it/s] 89%|██████████████████████████████████████████████▍     | 8703/9741 [00:33<00:03, 277.17it/s] 90%|██████████████████████████████████████████████▌     | 8731/9741 [00:33<00:03, 276.70it/s] 90%|██████████████████████████████████████████████▊     | 8759/9741 [00:33<00:03, 277.04it/s] 90%|██████████████████████████████████████████████▉     | 8787/9741 [00:33<00:03, 277.30it/s] 90%|███████████████████████████████████████████████     | 8815/9741 [00:33<00:03, 275.35it/s] 91%|███████████████████████████████████████████████▏    | 8843/9741 [00:33<00:03, 275.86it/s] 91%|███████████████████████████████████████████████▎    | 8871/9741 [00:33<00:03, 276.07it/s] 91%|███████████████████████████████████████████████▌    | 8899/9741 [00:33<00:03, 276.44it/s] 92%|███████████████████████████████████████████████▋    | 8927/9741 [00:33<00:02, 277.03it/s] 92%|███████████████████████████████████████████████▊    | 8955/9741 [00:33<00:02, 277.49it/s] 92%|███████████████████████████████████████████████▉    | 8983/9741 [00:34<00:02, 277.44it/s] 93%|████████████████████████████████████████████████    | 9011/9741 [00:34<00:02, 277.39it/s] 93%|████████████████████████████████████████████████▎   | 9039/9741 [00:34<00:02, 275.37it/s] 93%|████████████████████████████████████████████████▍   | 9067/9741 [00:34<00:02, 276.20it/s] 93%|████████████████████████████████████████████████▌   | 9095/9741 [00:34<00:02, 276.67it/s] 94%|████████████████████████████████████████████████▋   | 9123/9741 [00:34<00:02, 276.99it/s] 94%|████████████████████████████████████████████████▊   | 9151/9741 [00:34<00:02, 277.28it/s] 94%|████████████████████████████████████████████████▉   | 9179/9741 [00:34<00:02, 277.58it/s] 95%|█████████████████████████████████████████████████▏  | 9207/9741 [00:34<00:01, 277.73it/s] 95%|█████████████████████████████████████████████████▎  | 9235/9741 [00:34<00:01, 277.85it/s] 95%|█████████████████████████████████████████████████▍  | 9263/9741 [00:35<00:01, 275.73it/s] 95%|█████████████████████████████████████████████████▌  | 9291/9741 [00:35<00:01, 275.72it/s] 96%|█████████████████████████████████████████████████▋  | 9319/9741 [00:35<00:01, 276.08it/s] 96%|█████████████████████████████████████████████████▉  | 9347/9741 [00:35<00:01, 276.74it/s] 96%|██████████████████████████████████████████████████  | 9375/9741 [00:35<00:01, 277.18it/s] 97%|██████████████████████████████████████████████████▏ | 9403/9741 [00:35<00:01, 277.39it/s] 97%|██████████████████████████████████████████████████▎ | 9431/9741 [00:35<00:01, 277.70it/s] 97%|██████████████████████████████████████████████████▍ | 9459/9741 [00:35<00:01, 277.69it/s] 97%|██████████████████████████████████████████████████▋ | 9487/9741 [00:35<00:00, 275.50it/s] 98%|██████████████████████████████████████████████████▊ | 9515/9741 [00:35<00:00, 276.04it/s] 98%|██████████████████████████████████████████████████▉ | 9543/9741 [00:36<00:00, 276.60it/s] 98%|███████████████████████████████████████████████████ | 9571/9741 [00:36<00:00, 277.03it/s] 99%|███████████████████████████████████████████████████▏| 9599/9741 [00:36<00:00, 277.13it/s] 99%|███████████████████████████████████████████████████▍| 9627/9741 [00:36<00:00, 276.65it/s] 99%|███████████████████████████████████████████████████▌| 9655/9741 [00:36<00:00, 276.32it/s] 99%|███████████████████████████████████████████████████▋| 9683/9741 [00:36<00:00, 276.99it/s]100%|███████████████████████████████████████████████████▊| 9711/9741 [00:36<00:00, 275.38it/s]100%|███████████████████████████████████████████████████▉| 9739/9741 [00:36<00:00, 275.90it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:36<00:00, 264.65it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.51s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.41s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.51s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.30s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.42s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.09s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.41s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.96s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.65s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.97s/it]
[2023-08-22 05:39:12,362] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.26s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.41s/it]
[2023-08-22 05:39:26,376] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 05:39:26,377] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 05:39:26,377] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7feb4d6fdfd0>
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 05:39:26,378] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7feb4ca3a220>
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 05:39:26,379] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 05:39:26,380] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 05:39:26,380] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 05:39:26,380] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 05:39:26,380] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 05:39:26,380] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 05:39:26,380] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 05:39:26,380] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 05:39:26,380] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 05:39:26,380] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 05:39:26,380] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 05:39:26,380] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.6001856327056885 seconds
Loading extension module utils...
Time to load utils op: 0.5046267509460449 seconds
Loading extension module utils...
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Time to load utils op: 0.6048502922058105 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Tapanga and Corey have 66 candies together. However, Tapanga has 8 more candies than Corey. How many candies does Corey have?
Output: 29

Input: Freddy is calling his family on New Year's Eve. He calls his dad, who lives in the same city as him, and they talk for 45 minutes. Then he calls his brother, who lives on the other side of the world, and they talk for 31 minutes. Local calls cost 5 cents a minute, while international calls cost 25 cents a minute. How many dollars did Freddy spend calling his family on New Year's Eve?
Output: 10

Input: Lawrence worked 8 hours each day on Monday, Tuesday and Friday. He worked 5.5 hours on both Wednesday and Thursday. How many hours would Lawrence work each day if he worked the same number of hours each day?
Output: 5

Input: Ali had a stock of 800 books in his Room. He sold 60 on Monday, 10 on Tuesday, 20 on Wednesday, 44 on Thursday and 66 on Friday. How many books were not sold?
Output: 600

Input: Michael makes birdhouses to sell at craft shows. He charges $22 for each large birdhouse, $16 for each medium birdhouse, and $7 for each small birdhouse. This week, he sold 2 large birdhouses, 2 medium birdhouses, and 3 small birdhouses. How much money, in dollars, did he make this week?
Output: 97

Input: Nalani had two female dogs that were expecting and after a month gave birth to 10 puppies each. She then sold 3/4 of the puppies after they came of age, each at $200. Calculate the total amount of money she received from the sale of the puppies.
Output: 3000

Input: Boris has 24 books and he donates a fourth of his books to the library. Cameron has 30 books and he donates a third of his books to the library. After donating their books, how many books in total do Boris and Cameron have together?
Output: 38

Input: There are 3 boxes of cereal. One box holds 14 ounces of cereal. Another box holds half the amount of the first box and 5 ounces less than the third box. How much cereal is there in all 3 cereal boxes?
Output: 33

Input: A jug needs 40 cups of water to be full. A custodian at Truman Elementary School has to fill water jugs for 200 students, who drink 10 cups of water in a day. How many water jugs will the custodian fill with cups of water to provide the students with all the water they need in a day?
Output: 50

Input: It takes 1 hour for refrigerated dough to come to room temperature.  It takes 15 minutes to shape the dough and 2 hours to proof.  The bread takes 30 minutes to bake and 15 minutes to cool.  If the bakery opens at 6:00 am, what is the latest time the head baker can make it to the store to start working?
Output: 2

Input: Geric had twice as many bills as Kyla who has 2 fewer bills than Jessa.  After giving 3 bills to Geric, Jessa has 7 bills left. How many bills did Geric have at the beginning?
Output: 16

Input: They say the first year of a dog's life equals 15 human years. The second year of a dog's life equals 9 human years and after that, every year of a dog's life equals 5 human years. According to this logic, how many human years has my 10-year-old dog lived?
Output: 64

Input: Company A and Company B merge. Company A receives 60% of the combined profits under the new merger, and company B receives 40% of the profits. If company B gets a total of $60000 in profit, how much does company A get?
Output: 90000

Input: Sam, Sid, and Steve brought popsicle sticks for their group activity in their Art class. Sam has thrice as many as Sid, and Sid has twice as many as Steve. If Steve has 12 popsicle sticks, how many popsicle sticks can they use for their Art class activity?
Output: 108

Input: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.
Output: 720

Input: John uses a 75-watt electric fan for 8 hours a day. How much kWh of electric energy does he consume per month (30 days) for using the electric fan?
Output: 18

Input: Barbara Blackburn can type 212 words per minute.  Due to Carpal tunnel syndrome, Barbara cannot use her left hand for a while so her typing speed is now 40 words less per minute. If she is supposed to type a document with 3440 words, how many minutes will it take her to finish typing the document?
Output: 20

Input: Max fills up water balloons for 30 minutes at a rate of 2 water balloons every minute. Max’s friend Zach fills up water balloons for 40 minutes at a rate of 3 water balloons every minute. In the process, 10 of the water balloons pop on the ground. How many filled water balloons do Max and Zach have in total?
Output: 170

Input: John has 54 pieces of gum, Cole has 45 pieces of gum and Aubrey has no pieces of gum. They decide to share the gum equally between the 3 of them. How many pieces of gum will each one get?
Output: 33

Input: Mira jogs every morning. She jogs 5 miles per hour. If she jogs for 2 hours every morning, how many miles can she jog for five days?
Output: 50

Input: Rita is reading a five-chapter book with 95 pages. Each chapter has three pages more than the previous one. How many pages does the first chapter have?
Output: 13

Input: Nancy and Jason are learning to dance for the first time. Nancy steps on her partner's feet 3 times as often as Jason. If together they step on each other's feet 32 times, how many times does Jason step on his partner's feet?
Output: 8

Input: Maisie and Donna dropped off flyers for a neighborhood clean-up day at houses around their neighborhood. Maisie walked down the shorter left street and dropped off 33 flyers. Donna took the long right street on her bicycle and dropped off five more than twice as many flyers as Maisie. How many flyers did Donna drop off?
Output: 71

Input: In a show, there can be 5 actors at a time. Every actor is in the show for about 15 minutes, and then another 5 actors come in. How many actors can there be on the show in 1 hour?
Output: 20

Input: Rafael works 10 hours on Monday and 8 hours on Tuesday on his delivery job. With 20 hours left to work in the week, how much money does Rafael make if he is paid $20 per hour?
Output: 760

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o25-tgsm8k-s20-rFalse
Loading extension module utils...
Time to load utils op: 0.604910135269165 seconds
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:03<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 3573138) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-22_05:39:35
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 3573139)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-22_05:39:35
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 3573140)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-22_05:39:35
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 3573141)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-22_05:39:35
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 3573138)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o10-tgsm8k-s30-rFalse --seed 30 --max-prompt-length 2048 --num-out-domain 10
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 05:39:39,323] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o10-tgsm8k-s30-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 10
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o10-tgsm8k-s30-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▎                                                     | 48/9741 [00:00<00:20, 477.63it/s]  1%|▌                                                     | 97/9741 [00:00<00:20, 480.05it/s]  1%|▊                                                    | 146/9741 [00:00<00:19, 481.46it/s]  2%|█                                                    | 195/9741 [00:00<00:19, 481.18it/s]  3%|█▎                                                   | 244/9741 [00:00<00:19, 479.11it/s]  3%|█▌                                                   | 293/9741 [00:00<00:19, 479.98it/s]  4%|█▊                                                   | 342/9741 [00:00<00:19, 480.72it/s]  4%|██▏                                                  | 391/9741 [00:00<00:19, 474.75it/s]  5%|██▍                                                  | 439/9741 [00:00<00:19, 473.40it/s]  5%|██▋                                                  | 487/9741 [00:01<00:19, 465.49it/s]  5%|██▉                                                  | 535/9741 [00:01<00:19, 469.69it/s]  6%|███▏                                                 | 583/9741 [00:01<00:19, 472.37it/s]  6%|███▍                                                 | 631/9741 [00:01<00:19, 474.47it/s]  7%|███▋                                                 | 679/9741 [00:01<00:19, 474.38it/s]  7%|███▉                                                 | 727/9741 [00:01<00:18, 476.01it/s]  8%|████▏                                                | 776/9741 [00:01<00:18, 477.46it/s]  8%|████▍                                                | 825/9741 [00:01<00:18, 478.63it/s]  9%|████▋                                                | 873/9741 [00:01<00:18, 475.30it/s]  9%|█████                                                | 921/9741 [00:01<00:18, 473.70it/s] 10%|█████▎                                               | 969/9741 [00:02<00:18, 475.52it/s] 10%|█████▍                                              | 1017/9741 [00:02<00:18, 466.03it/s] 11%|█████▋                                              | 1069/9741 [00:02<00:18, 480.85it/s] 12%|██████                                              | 1142/9741 [00:02<00:15, 552.18it/s] 12%|██████▍                                             | 1215/9741 [00:02<00:14, 603.73it/s] 13%|██████▉                                             | 1288/9741 [00:02<00:13, 640.77it/s] 14%|███████▎                                            | 1360/9741 [00:02<00:12, 664.26it/s] 15%|███████▋                                            | 1433/9741 [00:02<00:12, 682.60it/s] 15%|████████                                            | 1506/9741 [00:02<00:11, 695.65it/s] 16%|████████▍                                           | 1578/9741 [00:02<00:11, 701.88it/s] 17%|████████▊                                           | 1651/9741 [00:03<00:11, 709.71it/s] 18%|█████████▏                                          | 1723/9741 [00:03<00:11, 704.04it/s] 18%|█████████▌                                          | 1794/9741 [00:03<00:11, 679.48it/s] 19%|█████████▉                                          | 1867/9741 [00:03<00:11, 691.62it/s] 20%|██████████▎                                         | 1940/9741 [00:03<00:11, 701.62it/s] 21%|██████████▋                                         | 2013/9741 [00:03<00:10, 708.58it/s] 21%|███████████▏                                        | 2085/9741 [00:03<00:10, 710.08it/s] 22%|███████████▌                                        | 2158/9741 [00:03<00:10, 714.71it/s] 23%|███████████▉                                        | 2231/9741 [00:03<00:10, 718.07it/s] 24%|████████████▎                                       | 2303/9741 [00:03<00:10, 717.45it/s] 24%|████████████▋                                       | 2376/9741 [00:04<00:10, 719.44it/s] 25%|█████████████                                       | 2449/9741 [00:04<00:10, 721.58it/s] 26%|█████████████▍                                      | 2522/9741 [00:04<00:10, 719.20it/s] 27%|█████████████▊                                      | 2595/9741 [00:04<00:09, 721.01it/s] 27%|██████████████▏                                     | 2668/9741 [00:04<00:09, 714.69it/s] 28%|██████████████▋                                     | 2740/9741 [00:04<00:09, 712.38it/s] 29%|███████████████                                     | 2813/9741 [00:04<00:09, 715.16it/s] 30%|███████████████▍                                    | 2886/9741 [00:04<00:09, 718.58it/s] 30%|███████████████▊                                    | 2958/9741 [00:04<00:09, 717.54it/s] 31%|████████████████▏                                   | 3031/9741 [00:04<00:09, 719.69it/s] 32%|████████████████▌                                   | 3104/9741 [00:05<00:09, 720.96it/s] 33%|████████████████▉                                   | 3177/9741 [00:05<00:09, 719.69it/s] 33%|█████████████████▎                                  | 3250/9741 [00:05<00:08, 721.27it/s] 34%|█████████████████▋                                  | 3323/9741 [00:05<00:09, 711.83it/s] 35%|██████████████████                                  | 3395/9741 [00:05<00:08, 712.87it/s] 36%|██████████████████▌                                 | 3468/9741 [00:05<00:08, 715.99it/s] 36%|██████████████████▉                                 | 3541/9741 [00:05<00:08, 717.44it/s] 37%|███████████████████▎                                | 3613/9741 [00:05<00:08, 711.51it/s] 38%|███████████████████▋                                | 3686/9741 [00:05<00:08, 714.36it/s] 39%|████████████████████                                | 3759/9741 [00:06<00:08, 717.28it/s] 39%|████████████████████▍                               | 3832/9741 [00:06<00:08, 716.05it/s] 40%|████████████████████▊                               | 3905/9741 [00:06<00:08, 717.23it/s] 41%|█████████████████████▏                              | 3978/9741 [00:06<00:08, 719.14it/s] 42%|█████████████████████▌                              | 4050/9741 [00:06<00:08, 711.14it/s] 42%|██████████████████████                              | 4122/9741 [00:06<00:07, 710.88it/s] 43%|██████████████████████▍                             | 4195/9741 [00:06<00:07, 713.80it/s] 44%|██████████████████████▊                             | 4268/9741 [00:06<00:07, 716.72it/s] 45%|███████████████████████▏                            | 4340/9741 [00:06<00:07, 716.52it/s] 45%|███████████████████████▌                            | 4413/9741 [00:06<00:07, 718.68it/s] 46%|███████████████████████▉                            | 4486/9741 [00:07<00:07, 719.91it/s] 47%|████████████████████████▎                           | 4558/9741 [00:07<00:07, 680.29it/s] 48%|████████████████████████▋                           | 4631/9741 [00:07<00:07, 693.59it/s] 48%|█████████████████████████                           | 4704/9741 [00:07<00:07, 702.86it/s] 49%|█████████████████████████▍                          | 4775/9741 [00:07<00:09, 534.81it/s] 50%|█████████████████████████▉                          | 4848/9741 [00:07<00:08, 580.24it/s] 51%|██████████████████████████▎                         | 4921/9741 [00:07<00:07, 616.75it/s] 51%|██████████████████████████▋                         | 4993/9741 [00:07<00:07, 643.27it/s] 52%|███████████████████████████                         | 5066/9741 [00:07<00:07, 665.55it/s] 53%|███████████████████████████▍                        | 5139/9741 [00:08<00:06, 681.93it/s] 53%|███████████████████████████▊                        | 5211/9741 [00:08<00:06, 691.61it/s] 54%|████████████████████████████▏                       | 5284/9741 [00:08<00:06, 700.56it/s] 55%|████████████████████████████▌                       | 5357/9741 [00:08<00:06, 707.03it/s] 56%|████████████████████████████▉                       | 5429/9741 [00:08<00:06, 709.43it/s] 56%|█████████████████████████████▍                      | 5503/9741 [00:08<00:05, 717.58it/s] 57%|█████████████████████████████▊                      | 5579/9741 [00:08<00:05, 728.13it/s] 58%|██████████████████████████████▏                     | 5654/9741 [00:08<00:05, 731.75it/s] 59%|██████████████████████████████▌                     | 5730/9741 [00:08<00:05, 737.66it/s] 60%|██████████████████████████████▉                     | 5806/9741 [00:08<00:05, 742.62it/s] 60%|███████████████████████████████▍                    | 5881/9741 [00:09<00:05, 743.14it/s] 61%|███████████████████████████████▊                    | 5956/9741 [00:09<00:05, 744.39it/s] 62%|████████████████████████████████▏                   | 6032/9741 [00:09<00:04, 747.36it/s] 63%|████████████████████████████████▌                   | 6107/9741 [00:09<00:04, 746.66it/s] 63%|█████████████████████████████████                   | 6183/9741 [00:09<00:04, 748.17it/s] 64%|█████████████████████████████████▍                  | 6259/9741 [00:09<00:04, 749.08it/s] 65%|█████████████████████████████████▊                  | 6334/9741 [00:09<00:04, 747.43it/s] 66%|██████████████████████████████████▏                 | 6410/9741 [00:09<00:04, 749.44it/s] 67%|██████████████████████████████████▌                 | 6485/9741 [00:09<00:04, 747.75it/s] 67%|███████████████████████████████████                 | 6560/9741 [00:09<00:04, 742.12it/s] 68%|███████████████████████████████████▍                | 6636/9741 [00:10<00:04, 744.73it/s] 69%|███████████████████████████████████▊                | 6712/9741 [00:10<00:04, 747.65it/s] 70%|████████████████████████████████████▏               | 6787/9741 [00:10<00:03, 747.74it/s] 70%|████████████████████████████████████▋               | 6863/9741 [00:10<00:03, 749.78it/s] 71%|█████████████████████████████████████               | 6939/9741 [00:10<00:03, 751.07it/s] 72%|█████████████████████████████████████▍              | 7015/9741 [00:10<00:03, 748.28it/s] 73%|█████████████████████████████████████▊              | 7091/9741 [00:10<00:03, 750.25it/s] 74%|██████████████████████████████████████▎             | 7167/9741 [00:10<00:03, 752.07it/s] 74%|██████████████████████████████████████▋             | 7243/9741 [00:10<00:03, 749.78it/s] 75%|███████████████████████████████████████             | 7319/9741 [00:10<00:03, 749.89it/s] 76%|███████████████████████████████████████▍            | 7395/9741 [00:11<00:03, 750.98it/s] 77%|███████████████████████████████████████▉            | 7471/9741 [00:11<00:03, 718.34it/s] 77%|████████████████████████████████████████▎           | 7547/9741 [00:11<00:03, 728.26it/s] 78%|████████████████████████████████████████▋           | 7623/9741 [00:11<00:02, 735.71it/s] 79%|█████████████████████████████████████████           | 7698/9741 [00:11<00:02, 738.05it/s] 80%|█████████████████████████████████████████▍          | 7774/9741 [00:11<00:02, 743.18it/s] 81%|█████████████████████████████████████████▉          | 7850/9741 [00:11<00:02, 746.93it/s] 81%|██████████████████████████████████████████▎         | 7925/9741 [00:11<00:02, 746.26it/s] 82%|██████████████████████████████████████████▋         | 8001/9741 [00:11<00:02, 748.30it/s] 83%|███████████████████████████████████████████         | 8077/9741 [00:12<00:02, 749.46it/s] 84%|███████████████████████████████████████████▌        | 8152/9741 [00:12<00:02, 749.26it/s] 84%|███████████████████████████████████████████▉        | 8228/9741 [00:12<00:02, 749.57it/s] 85%|████████████████████████████████████████████▎       | 8304/9741 [00:12<00:01, 749.82it/s] 86%|████████████████████████████████████████████▋       | 8379/9741 [00:12<00:01, 748.21it/s] 87%|█████████████████████████████████████████████▏      | 8454/9741 [00:12<00:01, 742.27it/s] 88%|█████████████████████████████████████████████▌      | 8530/9741 [00:12<00:01, 745.36it/s] 88%|█████████████████████████████████████████████▉      | 8605/9741 [00:12<00:01, 744.23it/s] 89%|██████████████████████████████████████████████▎     | 8681/9741 [00:12<00:01, 746.61it/s] 90%|██████████████████████████████████████████████▋     | 8757/9741 [00:12<00:01, 748.21it/s] 91%|███████████████████████████████████████████████▏    | 8832/9741 [00:13<00:01, 746.16it/s] 91%|███████████████████████████████████████████████▌    | 8908/9741 [00:13<00:01, 747.72it/s] 92%|███████████████████████████████████████████████▉    | 8984/9741 [00:13<00:01, 749.32it/s] 93%|████████████████████████████████████████████████▎   | 9059/9741 [00:13<00:00, 747.17it/s] 94%|████████████████████████████████████████████████▊   | 9135/9741 [00:13<00:00, 748.65it/s] 95%|█████████████████████████████████████████████████▏  | 9211/9741 [00:13<00:00, 749.52it/s] 95%|█████████████████████████████████████████████████▌  | 9286/9741 [00:13<00:00, 748.47it/s] 96%|█████████████████████████████████████████████████▉  | 9362/9741 [00:13<00:00, 749.71it/s] 97%|██████████████████████████████████████████████████▍ | 9438/9741 [00:13<00:00, 750.30it/s] 98%|██████████████████████████████████████████████████▊ | 9514/9741 [00:13<00:00, 747.87it/s] 98%|███████████████████████████████████████████████████▏| 9590/9741 [00:14<00:00, 749.06it/s] 99%|███████████████████████████████████████████████████▌| 9665/9741 [00:14<00:00, 745.56it/s]100%|███████████████████████████████████████████████████▉| 9740/9741 [00:14<00:00, 731.03it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:14<00:00, 684.16it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.23s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.26s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.30s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.23s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.15s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.19s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.21s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.15s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.54s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.49s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.56s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]
[2023-08-22 05:40:45,160] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.63s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
[2023-08-22 05:40:52,949] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 05:40:52,950] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fd9cc910fd0>
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 05:40:52,951] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fd9cc7f0220>
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 05:40:52,952] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 05:40:52,952] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4402611255645752 seconds
Loading extension module utils...
Time to load utils op: 0.30414772033691406 seconds
Loading extension module utils...
Time to load utils op: 0.5047693252563477 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Time to load utils op: 0.4050443172454834 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: The car-rental agency charges $30/day for a car, or $190 for the first week for a rental that lasts an entire week or longer. Jennie rented a car for 11 days. How much, in dollars, did she pay for the rental?
Output: 310

Input: A hurricane is approaching the southern coast of Texas, and a rancher is planning to move 400 head of cattle 60 miles to higher ground to protect them from possible inland flooding that might occur.  His animal transport truck holds 20 head of cattle.  Traveling at 60 miles per hour, what is the total driving time, in hours, it will take to transport all of his cattle to higher ground?
Output: 40

Input: Jason has a carriage house that he rents out.  He’s charging $50.00 per day or $500.00 for 14 days.  Eric wants to rent the house for 20 days.  How much will it cost him?
Output: 800

Input: Melissa works on a poultry farm. She drives to town twice each month to buy supplies. If it takes her 3 hours to drive to town and back, how many hours does Melissa spend driving in a year?
Output: 72

Input: The ratio of boys to girls in a family is 5:7. The total number of children in the family is 180. If the boys are given $3900 to share, how much money does each boy receive?
Output: 52

Input: Josephine receives a bill from the hospital for 5000$.  50 percent of the bill is for medication.  25 percent of the remaining bill is for overnight stays, and 175$ is for food.  The rest of the bill is for the ambulance ride.  How much did the ambulance ride cost?
Output: 1700

Input: It was time for Kelly to harvest her carrots that she had planted in three different beds.  In the first bed she pulled out 55 carrots.  In the second bed she pulled out 101 carrots and in the third bed she pulled out 78 carrots.  She found that 6 carrots weighed one pound.  How many pounds of carrots did Kelly harvest?
Output: 39

Input: Iris’ family is planning a surprise birthday party for her. The party will include her 3 uncles and 4 aunts who have a son and daughter each as well as her brother and mother. In total, how many people are coming to Iris’ birthday party?
Output: 23

Input: Lyra bought a pair of shoes at a 20% discount.  If she paid $480, how much was the original price of the pair of shoes?
Output: 600

Input: Rhett has been late on two of his monthly rent payments, but his landlord does not charge late fees and so he will be able to pay their total cost with 3/5 of his next month's salary after taxes. If he is currently paid $5000 per month and has to pay 10% tax, calculate his rent expense per month?
Output: 1350

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o10-tgsm8k-s30-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:44<36:06, 44.22s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:28<35:19, 44.15s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:12<34:42, 44.30s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:56<33:51, 44.16s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:40<33:04, 44.11s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:15<29:57, 40.85s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:41<25:54, 36.15s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:25<26:55, 38.48s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:09<27:27, 40.17s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:52<27:24, 41.10s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:25<25:12, 38.78s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:08<25:20, 40.00s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:53<25:34, 41.46s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:37<25:22, 42.28s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:21<24:55, 42.74s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:04<24:21, 42.99s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:49<23:52, 43.41s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:33<23:16, 43.65s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:02<20:12, 39.12s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:19<16:15, 32.50s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:04<17:31, 36.27s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:48<18:02, 38.66s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:32<18:08, 40.30s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [16:16<17:54, 41.34s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:00<17:34, 42.18s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:44<17:04, 42.69s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [18:27<16:26, 42.89s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [19:12<15:53, 43.32s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:55<15:09, 43.29s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [20:38<14:26, 43.35s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [21:22<13:48, 43.59s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [22:08<13:12, 44.05s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [22:52<12:29, 44.09s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:35<11:42, 43.93s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [24:19<10:57, 43.81s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [25:03<10:13, 43.79s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [25:47<09:31, 43.93s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [26:21<08:11, 40.96s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [27:05<07:40, 41.90s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [27:49<07:05, 42.58s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [28:33<06:26, 42.92s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [29:17<05:45, 43.22s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [30:01<05:04, 43.53s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [30:45<04:22, 43.72s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [31:27<03:35, 43.02s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [32:10<02:53, 43.25s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [32:35<01:53, 37.78s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [33:19<01:19, 39.52s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [33:59<00:39, 39.81s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:43<00:00, 41.03s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:43<00:00, 41.68s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.8771} | avg. gen lenth: 277.284
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o11-tgsm8k-s30-rFalse --seed 30 --max-prompt-length 2048 --num-out-domain 11
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...

[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 06:15:52,948] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o11-tgsm8k-s30-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 11
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o11-tgsm8k-s30-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 43/9741 [00:00<00:22, 428.64it/s]  1%|▍                                                     | 86/9741 [00:00<00:22, 429.05it/s]  1%|▋                                                    | 130/9741 [00:00<00:22, 430.52it/s]  2%|▉                                                    | 174/9741 [00:00<00:22, 431.15it/s]  2%|█▏                                                   | 218/9741 [00:00<00:22, 428.52it/s]  3%|█▍                                                   | 262/9741 [00:00<00:22, 429.69it/s]  3%|█▋                                                   | 306/9741 [00:00<00:21, 430.59it/s]  4%|█▉                                                   | 350/9741 [00:00<00:22, 423.24it/s]  4%|██▏                                                  | 393/9741 [00:00<00:21, 425.11it/s]  4%|██▎                                                  | 436/9741 [00:01<00:22, 419.39it/s]  5%|██▌                                                  | 480/9741 [00:01<00:21, 423.20it/s]  5%|██▊                                                  | 524/9741 [00:01<00:21, 425.90it/s]  6%|███                                                  | 568/9741 [00:01<00:21, 427.41it/s]  6%|███▎                                                 | 612/9741 [00:01<00:21, 428.50it/s]  7%|███▌                                                 | 655/9741 [00:01<00:21, 427.29it/s]  7%|███▊                                                 | 699/9741 [00:01<00:21, 428.77it/s]  8%|████                                                 | 743/9741 [00:01<00:20, 429.19it/s]  8%|████▎                                                | 786/9741 [00:01<00:21, 426.04it/s]  9%|████▌                                                | 830/9741 [00:01<00:20, 427.55it/s]  9%|████▊                                                | 874/9741 [00:02<00:20, 429.10it/s]  9%|████▉                                                | 917/9741 [00:02<00:20, 428.13it/s] 10%|█████▏                                               | 961/9741 [00:02<00:20, 429.42it/s] 10%|█████▎                                              | 1005/9741 [00:02<00:20, 430.33it/s] 11%|█████▌                                              | 1049/9741 [00:02<00:20, 431.21it/s] 11%|█████▊                                              | 1093/9741 [00:02<00:20, 431.95it/s] 12%|██████                                              | 1137/9741 [00:02<00:19, 430.25it/s] 12%|██████▎                                             | 1181/9741 [00:02<00:19, 431.01it/s] 13%|██████▌                                             | 1225/9741 [00:02<00:19, 431.21it/s] 13%|██████▉                                             | 1290/9741 [00:02<00:17, 494.49it/s] 14%|███████▏                                            | 1355/9741 [00:03<00:15, 539.23it/s] 15%|███████▌                                            | 1421/9741 [00:03<00:14, 573.06it/s] 15%|███████▉                                            | 1487/9741 [00:03<00:13, 596.65it/s] 16%|████████▎                                           | 1553/9741 [00:03<00:13, 613.13it/s] 17%|████████▋                                           | 1617/9741 [00:03<00:13, 620.19it/s] 17%|████████▉                                           | 1683/9741 [00:03<00:12, 630.28it/s] 18%|█████████▎                                          | 1748/9741 [00:03<00:12, 636.10it/s] 19%|█████████▋                                          | 1812/9741 [00:03<00:12, 615.82it/s] 19%|██████████                                          | 1877/9741 [00:03<00:12, 625.41it/s] 20%|██████████▎                                         | 1943/9741 [00:03<00:12, 632.87it/s] 21%|██████████▋                                         | 2009/9741 [00:04<00:12, 638.17it/s] 21%|███████████                                         | 2074/9741 [00:04<00:12, 638.83it/s] 22%|███████████▍                                        | 2139/9741 [00:04<00:11, 641.36it/s] 23%|███████████▊                                        | 2205/9741 [00:04<00:11, 644.15it/s] 23%|████████████                                        | 2270/9741 [00:04<00:11, 643.30it/s] 24%|████████████▍                                       | 2335/9741 [00:04<00:11, 644.40it/s] 25%|████████████▊                                       | 2401/9741 [00:04<00:11, 646.49it/s] 25%|█████████████▏                                      | 2466/9741 [00:04<00:11, 647.51it/s] 26%|█████████████▌                                      | 2531/9741 [00:04<00:11, 644.74it/s] 27%|█████████████▊                                      | 2596/9741 [00:04<00:11, 644.62it/s] 27%|██████████████▏                                     | 2661/9741 [00:05<00:10, 645.14it/s] 28%|██████████████▌                                     | 2726/9741 [00:05<00:10, 643.25it/s] 29%|██████████████▉                                     | 2791/9741 [00:05<00:10, 643.87it/s] 29%|███████████████▏                                    | 2856/9741 [00:05<00:10, 645.66it/s] 30%|███████████████▌                                    | 2921/9741 [00:05<00:10, 646.92it/s] 31%|███████████████▉                                    | 2986/9741 [00:05<00:10, 643.05it/s] 31%|████████████████▎                                   | 3051/9741 [00:05<00:10, 640.76it/s] 32%|████████████████▋                                   | 3116/9741 [00:05<00:10, 641.82it/s] 33%|████████████████▉                                   | 3181/9741 [00:05<00:10, 641.26it/s] 33%|█████████████████▎                                  | 3246/9741 [00:06<00:10, 623.12it/s] 34%|█████████████████▋                                  | 3311/9741 [00:06<00:10, 629.56it/s] 35%|██████████████████                                  | 3376/9741 [00:06<00:10, 633.35it/s] 35%|██████████████████▎                                 | 3440/9741 [00:06<00:09, 634.46it/s] 36%|██████████████████▋                                 | 3505/9741 [00:06<00:09, 637.06it/s] 37%|███████████████████                                 | 3570/9741 [00:06<00:09, 639.81it/s] 37%|███████████████████▍                                | 3635/9741 [00:06<00:09, 638.86it/s] 38%|███████████████████▊                                | 3700/9741 [00:06<00:09, 640.18it/s] 39%|████████████████████                                | 3765/9741 [00:06<00:09, 642.29it/s] 39%|████████████████████▍                               | 3830/9741 [00:06<00:09, 643.13it/s] 40%|████████████████████▊                               | 3895/9741 [00:07<00:09, 635.99it/s] 41%|█████████████████████▏                              | 3960/9741 [00:07<00:09, 638.70it/s] 41%|█████████████████████▍                              | 4025/9741 [00:07<00:08, 641.76it/s] 42%|█████████████████████▊                              | 4090/9741 [00:07<00:08, 640.78it/s] 43%|██████████████████████▏                             | 4155/9741 [00:07<00:08, 642.52it/s] 43%|██████████████████████▌                             | 4220/9741 [00:07<00:08, 642.60it/s] 44%|██████████████████████▊                             | 4285/9741 [00:07<00:08, 644.28it/s] 45%|███████████████████████▏                            | 4350/9741 [00:07<00:08, 641.01it/s] 45%|███████████████████████▌                            | 4415/9741 [00:07<00:08, 640.73it/s] 46%|███████████████████████▉                            | 4480/9741 [00:07<00:08, 641.92it/s] 47%|████████████████████████▎                           | 4545/9741 [00:08<00:08, 611.10it/s] 47%|████████████████████████▌                           | 4610/9741 [00:08<00:08, 621.39it/s] 48%|████████████████████████▉                           | 4675/9741 [00:08<00:08, 628.66it/s] 49%|█████████████████████████▎                          | 4740/9741 [00:08<00:10, 456.05it/s] 49%|█████████████████████████▋                          | 4805/9741 [00:08<00:09, 499.89it/s] 50%|█████████████████████████▉                          | 4870/9741 [00:08<00:09, 536.28it/s] 51%|██████████████████████████▎                         | 4935/9741 [00:08<00:08, 565.20it/s] 51%|██████████████████████████▋                         | 4999/9741 [00:08<00:08, 585.35it/s] 52%|███████████████████████████                         | 5064/9741 [00:08<00:07, 602.88it/s] 53%|███████████████████████████▎                        | 5128/9741 [00:09<00:07, 612.73it/s] 53%|███████████████████████████▋                        | 5193/9741 [00:09<00:07, 620.85it/s] 54%|████████████████████████████                        | 5258/9741 [00:09<00:07, 628.73it/s] 55%|████████████████████████████▍                       | 5323/9741 [00:09<00:06, 634.09it/s] 55%|████████████████████████████▊                       | 5388/9741 [00:09<00:06, 637.46it/s] 56%|█████████████████████████████                       | 5453/9741 [00:09<00:06, 638.14it/s] 57%|█████████████████████████████▍                      | 5520/9741 [00:09<00:06, 645.28it/s] 57%|█████████████████████████████▊                      | 5587/9741 [00:09<00:06, 650.50it/s] 58%|██████████████████████████████▏                     | 5653/9741 [00:09<00:06, 651.48it/s] 59%|██████████████████████████████▌                     | 5720/9741 [00:09<00:06, 656.85it/s] 59%|██████████████████████████████▉                     | 5788/9741 [00:10<00:05, 662.13it/s] 60%|███████████████████████████████▎                    | 5855/9741 [00:10<00:05, 662.62it/s] 61%|███████████████████████████████▌                    | 5923/9741 [00:10<00:05, 665.50it/s] 62%|███████████████████████████████▉                    | 5991/9741 [00:10<00:05, 668.69it/s] 62%|████████████████████████████████▎                   | 6059/9741 [00:10<00:05, 669.72it/s] 63%|████████████████████████████████▋                   | 6126/9741 [00:10<00:05, 667.27it/s] 64%|█████████████████████████████████                   | 6193/9741 [00:10<00:05, 667.70it/s] 64%|█████████████████████████████████▍                  | 6260/9741 [00:10<00:05, 667.23it/s] 65%|█████████████████████████████████▊                  | 6327/9741 [00:10<00:05, 665.67it/s] 66%|██████████████████████████████████▏                 | 6395/9741 [00:11<00:05, 667.91it/s] 66%|██████████████████████████████████▍                 | 6462/9741 [00:11<00:04, 664.97it/s] 67%|██████████████████████████████████▊                 | 6530/9741 [00:11<00:04, 667.22it/s] 68%|███████████████████████████████████▏                | 6597/9741 [00:11<00:04, 664.40it/s] 68%|███████████████████████████████████▌                | 6665/9741 [00:11<00:04, 666.41it/s] 69%|███████████████████████████████████▉                | 6733/9741 [00:11<00:04, 667.50it/s] 70%|████████████████████████████████████▎               | 6800/9741 [00:11<00:04, 666.74it/s] 71%|████████████████████████████████████▋               | 6868/9741 [00:11<00:04, 668.18it/s] 71%|█████████████████████████████████████               | 6936/9741 [00:11<00:04, 669.05it/s] 72%|█████████████████████████████████████▍              | 7003/9741 [00:11<00:04, 666.53it/s] 73%|█████████████████████████████████████▋              | 7071/9741 [00:12<00:03, 667.89it/s] 73%|██████████████████████████████████████              | 7139/9741 [00:12<00:03, 668.75it/s] 74%|██████████████████████████████████████▍             | 7207/9741 [00:12<00:03, 669.95it/s] 75%|██████████████████████████████████████▊             | 7274/9741 [00:12<00:03, 668.22it/s] 75%|███████████████████████████████████████▏            | 7341/9741 [00:12<00:03, 662.47it/s] 76%|███████████████████████████████████████▌            | 7408/9741 [00:12<00:03, 664.23it/s] 77%|███████████████████████████████████████▉            | 7475/9741 [00:12<00:03, 613.07it/s] 77%|████████████████████████████████████████▎           | 7542/9741 [00:12<00:03, 628.81it/s] 78%|████████████████████████████████████████▌           | 7610/9741 [00:12<00:03, 641.19it/s] 79%|████████████████████████████████████████▉           | 7677/9741 [00:12<00:03, 647.33it/s] 79%|█████████████████████████████████████████▎          | 7744/9741 [00:13<00:03, 651.58it/s] 80%|█████████████████████████████████████████▋          | 7811/9741 [00:13<00:02, 655.99it/s] 81%|██████████████████████████████████████████          | 7878/9741 [00:13<00:02, 659.45it/s] 82%|██████████████████████████████████████████▍         | 7945/9741 [00:13<00:02, 661.16it/s] 82%|██████████████████████████████████████████▊         | 8012/9741 [00:13<00:02, 663.43it/s] 83%|███████████████████████████████████████████▏        | 8080/9741 [00:13<00:02, 665.78it/s] 84%|███████████████████████████████████████████▍        | 8147/9741 [00:13<00:02, 665.80it/s] 84%|███████████████████████████████████████████▊        | 8214/9741 [00:13<00:02, 659.97it/s] 85%|████████████████████████████████████████████▏       | 8281/9741 [00:13<00:02, 636.98it/s] 86%|████████████████████████████████████████████▌       | 8348/9741 [00:13<00:02, 645.12it/s] 86%|████████████████████████████████████████████▉       | 8416/9741 [00:14<00:02, 654.01it/s] 87%|█████████████████████████████████████████████▎      | 8484/9741 [00:14<00:01, 659.65it/s] 88%|█████████████████████████████████████████████▋      | 8552/9741 [00:14<00:01, 663.07it/s] 88%|██████████████████████████████████████████████      | 8619/9741 [00:14<00:01, 664.28it/s] 89%|██████████████████████████████████████████████▎     | 8687/9741 [00:14<00:01, 667.49it/s] 90%|██████████████████████████████████████████████▋     | 8754/9741 [00:14<00:01, 668.17it/s] 91%|███████████████████████████████████████████████     | 8821/9741 [00:14<00:01, 666.86it/s] 91%|███████████████████████████████████████████████▍    | 8889/9741 [00:14<00:01, 667.89it/s] 92%|███████████████████████████████████████████████▊    | 8957/9741 [00:14<00:01, 670.22it/s] 93%|████████████████████████████████████████████████▏   | 9025/9741 [00:14<00:01, 671.20it/s] 93%|████████████████████████████████████████████████▌   | 9093/9741 [00:15<00:00, 666.02it/s] 94%|████████████████████████████████████████████████▉   | 9161/9741 [00:15<00:00, 668.31it/s] 95%|█████████████████████████████████████████████████▎  | 9228/9741 [00:15<00:00, 668.78it/s] 95%|█████████████████████████████████████████████████▌  | 9295/9741 [00:15<00:00, 664.19it/s] 96%|█████████████████████████████████████████████████▉  | 9362/9741 [00:15<00:00, 665.66it/s] 97%|██████████████████████████████████████████████████▎ | 9430/9741 [00:15<00:00, 667.44it/s] 97%|██████████████████████████████████████████████████▋ | 9497/9741 [00:15<00:00, 665.66it/s] 98%|███████████████████████████████████████████████████ | 9564/9741 [00:15<00:00, 666.00it/s] 99%|███████████████████████████████████████████████████▍| 9631/9741 [00:15<00:00, 666.11it/s]100%|███████████████████████████████████████████████████▊| 9698/9741 [00:16<00:00, 666.60it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:16<00:00, 606.22it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.29s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.05s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:06<00:12,  6.00s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.49s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.28s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:13<00:06,  6.98s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.46s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.61s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.94s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.85s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:21<00:00,  7.44s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:21<00:00,  7.22s/it]
[2023-08-22 06:17:08,346] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 06:17:18,228] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 06:17:18,229] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f1626106fd0>
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 06:17:18,230] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f1625c2d220>
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 06:17:18,231] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 06:17:18,231] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.47622179985046387 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
### Instruction:Answer the following multiple choice question.

Input: The car-rental agency charges $30/day for a car, or $190 for the first week for a rental that lasts an entire week or longer. Jennie rented a car for 11 days. How much, in dollars, did she pay for the rental?
Output: 310

Input: A hurricane is approaching the southern coast of Texas, and a rancher is planning to move 400 head of cattle 60 miles to higher ground to protect them from possible inland flooding that might occur.  His animal transport truck holds 20 head of cattle.  Traveling at 60 miles per hour, what is the total driving time, in hours, it will take to transport all of his cattle to higher ground?
Output: 40

Input: Jason has a carriage house that he rents out.  He’s charging $50.00 per day or $500.00 for 14 days.  Eric wants to rent the house for 20 days.  How much will it cost him?
Output: 800

Input: Melissa works on a poultry farm. She drives to town twice each month to buy supplies. If it takes her 3 hours to drive to town and back, how many hours does Melissa spend driving in a year?
Output: 72

Input: The ratio of boys to girls in a family is 5:7. The total number of children in the family is 180. If the boys are given $3900 to share, how much money does each boy receive?
Output: 52

Input: Josephine receives a bill from the hospital for 5000$.  50 percent of the bill is for medication.  25 percent of the remaining bill is for overnight stays, and 175$ is for food.  The rest of the bill is for the ambulance ride.  How much did the ambulance ride cost?
Output: 1700

Input: It was time for Kelly to harvest her carrots that she had planted in three different beds.  In the first bed she pulled out 55 carrots.  In the second bed she pulled out 101 carrots and in the third bed she pulled out 78 carrots.  She found that 6 carrots weighed one pound.  How many pounds of carrots did Kelly harvest?
Output: 39

Input: Iris’ family is planning a surprise birthday party for her. The party will include her 3 uncles and 4 aunts who have a son and daughter each as well as her brother and mother. In total, how many people are coming to Iris’ birthday party?
Output: 23

Input: Lyra bought a pair of shoes at a 20% discount.  If she paid $480, how much was the original price of the pair of shoes?
Output: 600

Input: Rhett has been late on two of his monthly rent payments, but his landlord does not charge late fees and so he will be able to pay their total cost with 3/5 of his next month's salary after taxes. If he is currently paid $5000 per month and has to pay 10% tax, calculate his rent expense per month?
Output: 1350

Input: Ten friends decide to get an end-of-year gift for their teacher. They plan to split the cost of the gift equally. But four of the group drop out. The remaining friends split the cost equally among themselves. If each share is now $8 more, how much does the gift cost, in dollars?
Output: 120

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o11-tgsm8k-s30-rFalse
Time to load utils op: 0.40433168411254883 seconds
Loading extension module utils...
Time to load utils op: 0.30423784255981445 seconds
Loading extension module utils...
Time to load utils op: 0.304243803024292 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:44<36:39, 44.89s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:29<35:37, 44.52s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:51<27:04, 34.56s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:36<29:25, 38.39s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:02<25:26, 33.91s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:45<27:17, 37.22s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:29<28:05, 39.20s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:06<27:03, 38.66s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:48<27:01, 39.56s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:31<27:04, 40.62s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:14<26:55, 41.42s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:58<26:43, 42.21s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:41<26:11, 42.47s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:25<25:42, 42.86s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:08<25:02, 42.93s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:50<24:14, 42.77s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:07<19:15, 35.03s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:50<19:59, 37.48s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:34<20:16, 39.24s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:16<20:08, 40.27s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:44<17:36, 36.42s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:27<17:55, 38.43s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:11<18:03, 40.13s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:54<17:44, 40.93s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:36<17:15, 41.43s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:04<14:55, 37.30s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:47<14:56, 38.99s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:31<14:48, 40.40s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:14<14:24, 41.19s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:57<13:54, 41.75s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:41<13:25, 42.41s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [21:14<11:53, 39.64s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:57<11:29, 40.55s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [22:39<11:00, 41.27s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [23:04<09:03, 36.25s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [23:47<08:57, 38.38s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [24:30<08:36, 39.73s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [25:14<08:10, 40.87s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [25:57<07:38, 41.70s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [26:41<07:03, 42.32s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [27:24<06:23, 42.57s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [28:08<05:42, 42.86s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [28:51<04:59, 42.85s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [29:25<04:01, 40.18s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [30:08<03:25, 41.01s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [30:51<02:46, 41.70s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [31:35<02:07, 42.47s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [32:19<01:25, 42.77s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [33:02<00:43, 43.08s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:46<00:00, 43.30s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:46<00:00, 40.54s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.1785} | avg. gen lenth: 272.496
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o12-tgsm8k-s30-rFalse --seed 30 --max-prompt-length 2048 --num-out-domain 12
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 06:51:41,568] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o12-tgsm8k-s30-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 12
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o12-tgsm8k-s30-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 40/9741 [00:00<00:24, 393.92it/s]  1%|▍                                                     | 80/9741 [00:00<00:24, 396.09it/s]  1%|▋                                                    | 120/9741 [00:00<00:25, 374.64it/s]  2%|▊                                                    | 160/9741 [00:00<00:24, 383.60it/s]  2%|█                                                    | 200/9741 [00:00<00:24, 386.26it/s]  2%|█▎                                                   | 240/9741 [00:00<00:24, 390.03it/s]  3%|█▌                                                   | 280/9741 [00:00<00:24, 392.39it/s]  3%|█▋                                                   | 320/9741 [00:00<00:24, 388.01it/s]  4%|█▉                                                   | 360/9741 [00:00<00:24, 389.81it/s]  4%|██▏                                                  | 400/9741 [00:01<00:23, 392.17it/s]  5%|██▍                                                  | 440/9741 [00:01<00:23, 390.90it/s]  5%|██▌                                                  | 480/9741 [00:01<00:23, 392.31it/s]  5%|██▊                                                  | 520/9741 [00:01<00:23, 393.55it/s]  6%|███                                                  | 560/9741 [00:01<00:23, 394.20it/s]  6%|███▎                                                 | 600/9741 [00:01<00:23, 394.35it/s]  7%|███▍                                                 | 640/9741 [00:01<00:23, 394.96it/s]  7%|███▋                                                 | 680/9741 [00:01<00:23, 393.89it/s]  7%|███▉                                                 | 720/9741 [00:01<00:23, 390.87it/s]  8%|████▏                                                | 760/9741 [00:01<00:22, 391.66it/s]  8%|████▎                                                | 800/9741 [00:02<00:22, 392.77it/s]  9%|████▌                                                | 840/9741 [00:02<00:22, 393.63it/s]  9%|████▊                                                | 880/9741 [00:02<00:22, 394.73it/s]  9%|█████                                                | 921/9741 [00:02<00:22, 398.83it/s] 10%|█████▎                                               | 978/9741 [00:02<00:19, 449.52it/s] 11%|█████▌                                              | 1038/9741 [00:02<00:17, 493.53it/s] 11%|█████▊                                              | 1098/9741 [00:02<00:16, 524.78it/s] 12%|██████▏                                             | 1157/9741 [00:02<00:15, 543.71it/s] 12%|██████▍                                             | 1217/9741 [00:02<00:15, 558.80it/s] 13%|██████▊                                             | 1277/9741 [00:02<00:14, 569.93it/s] 14%|███████▏                                            | 1336/9741 [00:03<00:14, 574.81it/s] 14%|███████▍                                            | 1396/9741 [00:03<00:14, 580.18it/s] 15%|███████▊                                            | 1456/9741 [00:03<00:14, 583.81it/s] 16%|████████                                            | 1516/9741 [00:03<00:14, 585.87it/s] 16%|████████▍                                           | 1575/9741 [00:03<00:13, 585.90it/s] 17%|████████▋                                           | 1634/9741 [00:03<00:13, 580.51it/s] 17%|█████████                                           | 1694/9741 [00:03<00:13, 584.56it/s] 18%|█████████▎                                          | 1754/9741 [00:03<00:13, 587.45it/s] 19%|█████████▋                                          | 1813/9741 [00:03<00:14, 564.32it/s] 19%|█████████▉                                          | 1872/9741 [00:03<00:13, 571.36it/s] 20%|██████████▎                                         | 1932/9741 [00:04<00:13, 576.96it/s] 20%|██████████▋                                         | 1991/9741 [00:04<00:13, 580.68it/s] 21%|██████████▉                                         | 2050/9741 [00:04<00:13, 581.13it/s] 22%|███████████▎                                        | 2109/9741 [00:04<00:13, 583.36it/s] 22%|███████████▌                                        | 2169/9741 [00:04<00:12, 586.08it/s] 23%|███████████▉                                        | 2228/9741 [00:04<00:12, 579.09it/s] 23%|████████████▏                                       | 2287/9741 [00:04<00:12, 580.42it/s] 24%|████████████▌                                       | 2346/9741 [00:04<00:12, 582.54it/s] 25%|████████████▊                                       | 2406/9741 [00:04<00:12, 585.66it/s] 25%|█████████████▏                                      | 2466/9741 [00:04<00:12, 587.63it/s] 26%|█████████████▍                                      | 2525/9741 [00:05<00:12, 585.90it/s] 27%|█████████████▊                                      | 2585/9741 [00:05<00:12, 587.41it/s] 27%|██████████████                                      | 2645/9741 [00:05<00:12, 588.42it/s] 28%|██████████████▍                                     | 2704/9741 [00:05<00:11, 586.64it/s] 28%|██████████████▋                                     | 2763/9741 [00:05<00:11, 587.30it/s] 29%|███████████████                                     | 2822/9741 [00:05<00:11, 587.78it/s] 30%|███████████████▍                                    | 2881/9741 [00:05<00:11, 580.67it/s] 30%|███████████████▋                                    | 2940/9741 [00:05<00:11, 578.45it/s] 31%|████████████████                                    | 3000/9741 [00:05<00:11, 582.27it/s] 31%|████████████████▎                                   | 3059/9741 [00:06<00:11, 584.35it/s] 32%|████████████████▋                                   | 3119/9741 [00:06<00:11, 586.24it/s] 33%|████████████████▉                                   | 3178/9741 [00:06<00:11, 585.16it/s] 33%|█████████████████▎                                  | 3238/9741 [00:06<00:11, 587.14it/s] 34%|█████████████████▌                                  | 3298/9741 [00:06<00:10, 588.55it/s] 34%|█████████████████▉                                  | 3358/9741 [00:06<00:10, 589.17it/s] 35%|██████████████████▏                                 | 3417/9741 [00:06<00:10, 587.57it/s] 36%|██████████████████▌                                 | 3477/9741 [00:06<00:10, 588.29it/s] 36%|██████████████████▉                                 | 3536/9741 [00:06<00:10, 580.76it/s] 37%|███████████████████▏                                | 3595/9741 [00:06<00:10, 583.15it/s] 38%|███████████████████▌                                | 3654/9741 [00:07<00:10, 582.99it/s] 38%|███████████████████▊                                | 3713/9741 [00:07<00:10, 579.58it/s] 39%|████████████████████▏                               | 3773/9741 [00:07<00:10, 582.82it/s] 39%|████████████████████▍                               | 3832/9741 [00:07<00:10, 582.48it/s] 40%|████████████████████▊                               | 3892/9741 [00:07<00:09, 586.26it/s] 41%|█████████████████████                               | 3952/9741 [00:07<00:09, 587.68it/s] 41%|█████████████████████▍                              | 4012/9741 [00:07<00:09, 588.43it/s] 42%|█████████████████████▋                              | 4071/9741 [00:07<00:09, 587.02it/s] 42%|██████████████████████                              | 4131/9741 [00:07<00:09, 588.17it/s] 43%|██████████████████████▎                             | 4190/9741 [00:07<00:09, 580.63it/s] 44%|██████████████████████▋                             | 4250/9741 [00:08<00:09, 583.51it/s] 44%|███████████████████████                             | 4309/9741 [00:08<00:09, 583.55it/s] 45%|███████████████████████▎                            | 4369/9741 [00:08<00:09, 585.64it/s] 45%|███████████████████████▋                            | 4428/9741 [00:08<00:09, 580.76it/s] 46%|███████████████████████▉                            | 4488/9741 [00:08<00:09, 583.59it/s] 47%|████████████████████████▎                           | 4547/9741 [00:08<00:09, 547.80it/s] 47%|████████████████████████▌                           | 4606/9741 [00:08<00:09, 559.36it/s] 48%|████████████████████████▉                           | 4666/9741 [00:08<00:08, 568.36it/s] 49%|█████████████████████████▏                          | 4726/9741 [00:08<00:08, 575.45it/s] 49%|█████████████████████████▌                          | 4784/9741 [00:09<00:11, 415.16it/s] 50%|█████████████████████████▊                          | 4834/9741 [00:09<00:11, 434.49it/s] 50%|██████████████████████████                          | 4892/9741 [00:09<00:10, 469.93it/s] 51%|██████████████████████████▍                         | 4951/9741 [00:09<00:09, 499.33it/s] 51%|██████████████████████████▊                         | 5011/9741 [00:09<00:09, 524.25it/s] 52%|███████████████████████████                         | 5071/9741 [00:09<00:08, 542.93it/s] 53%|███████████████████████████▍                        | 5129/9741 [00:09<00:08, 550.96it/s] 53%|███████████████████████████▋                        | 5187/9741 [00:09<00:08, 558.24it/s] 54%|████████████████████████████                        | 5246/9741 [00:09<00:07, 566.95it/s] 54%|████████████████████████████▎                       | 5306/9741 [00:10<00:07, 573.90it/s] 55%|████████████████████████████▋                       | 5365/9741 [00:10<00:07, 577.99it/s] 56%|████████████████████████████▉                       | 5424/9741 [00:10<00:07, 578.10it/s] 56%|█████████████████████████████▎                      | 5483/9741 [00:10<00:07, 574.76it/s] 57%|█████████████████████████████▌                      | 5545/9741 [00:10<00:07, 585.84it/s] 58%|█████████████████████████████▉                      | 5607/9741 [00:10<00:06, 593.91it/s] 58%|██████████████████████████████▎                     | 5668/9741 [00:10<00:06, 598.21it/s] 59%|██████████████████████████████▌                     | 5730/9741 [00:10<00:06, 603.06it/s] 59%|██████████████████████████████▉                     | 5792/9741 [00:10<00:06, 606.12it/s] 60%|███████████████████████████████▏                    | 5853/9741 [00:10<00:06, 605.93it/s] 61%|███████████████████████████████▌                    | 5915/9741 [00:11<00:06, 608.05it/s] 61%|███████████████████████████████▉                    | 5977/9741 [00:11<00:06, 609.68it/s] 62%|████████████████████████████████▏                   | 6038/9741 [00:11<00:06, 602.41it/s] 63%|████████████████████████████████▌                   | 6099/9741 [00:11<00:06, 603.19it/s] 63%|████████████████████████████████▉                   | 6161/9741 [00:11<00:05, 605.62it/s] 64%|█████████████████████████████████▏                  | 6223/9741 [00:11<00:05, 607.95it/s] 65%|█████████████████████████████████▌                  | 6285/9741 [00:11<00:05, 608.97it/s] 65%|█████████████████████████████████▉                  | 6346/9741 [00:11<00:05, 607.89it/s] 66%|██████████████████████████████████▏                 | 6408/9741 [00:11<00:05, 609.43it/s] 66%|██████████████████████████████████▌                 | 6470/9741 [00:11<00:05, 609.77it/s] 67%|██████████████████████████████████▊                 | 6531/9741 [00:12<00:05, 608.41it/s] 68%|███████████████████████████████████▏                | 6593/9741 [00:12<00:05, 609.16it/s] 68%|███████████████████████████████████▌                | 6655/9741 [00:12<00:05, 610.43it/s] 69%|███████████████████████████████████▊                | 6717/9741 [00:12<00:04, 605.59it/s] 70%|████████████████████████████████████▏               | 6778/9741 [00:12<00:05, 582.82it/s] 70%|████████████████████████████████████▌               | 6840/9741 [00:12<00:04, 591.48it/s] 71%|████████████████████████████████████▊               | 6902/9741 [00:12<00:04, 598.42it/s] 71%|█████████████████████████████████████▏              | 6964/9741 [00:12<00:04, 603.25it/s] 72%|█████████████████████████████████████▌              | 7025/9741 [00:12<00:04, 603.80it/s] 73%|█████████████████████████████████████▊              | 7087/9741 [00:12<00:04, 607.22it/s] 73%|██████████████████████████████████████▏             | 7149/9741 [00:13<00:04, 610.30it/s] 74%|██████████████████████████████████████▍             | 7211/9741 [00:13<00:04, 610.93it/s] 75%|██████████████████████████████████████▊             | 7273/9741 [00:13<00:04, 609.34it/s] 75%|███████████████████████████████████████▏            | 7335/9741 [00:13<00:03, 611.13it/s] 76%|███████████████████████████████████████▍            | 7397/9741 [00:13<00:03, 612.69it/s] 77%|███████████████████████████████████████▊            | 7459/9741 [00:13<00:03, 578.84it/s] 77%|████████████████████████████████████████▏           | 7520/9741 [00:13<00:03, 587.59it/s] 78%|████████████████████████████████████████▍           | 7582/9741 [00:13<00:03, 594.64it/s] 78%|████████████████████████████████████████▊           | 7644/9741 [00:13<00:03, 600.02it/s] 79%|█████████████████████████████████████████▏          | 7705/9741 [00:14<00:03, 598.69it/s] 80%|█████████████████████████████████████████▍          | 7767/9741 [00:14<00:03, 603.33it/s] 80%|█████████████████████████████████████████▊          | 7829/9741 [00:14<00:03, 606.48it/s] 81%|██████████████████████████████████████████          | 7891/9741 [00:14<00:03, 608.59it/s] 82%|██████████████████████████████████████████▍         | 7952/9741 [00:14<00:02, 607.70it/s] 82%|██████████████████████████████████████████▊         | 8014/9741 [00:14<00:02, 609.65it/s] 83%|███████████████████████████████████████████         | 8076/9741 [00:14<00:02, 610.96it/s] 84%|███████████████████████████████████████████▍        | 8138/9741 [00:14<00:02, 609.42it/s] 84%|███████████████████████████████████████████▊        | 8200/9741 [00:14<00:02, 610.80it/s] 85%|████████████████████████████████████████████        | 8262/9741 [00:14<00:02, 611.57it/s] 85%|████████████████████████████████████████████▍       | 8324/9741 [00:15<00:02, 611.20it/s] 86%|████████████████████████████████████████████▊       | 8386/9741 [00:15<00:02, 609.53it/s] 87%|█████████████████████████████████████████████       | 8448/9741 [00:15<00:02, 610.77it/s] 87%|█████████████████████████████████████████████▍      | 8510/9741 [00:15<00:02, 611.39it/s] 88%|█████████████████████████████████████████████▊      | 8572/9741 [00:15<00:01, 611.03it/s] 89%|██████████████████████████████████████████████      | 8634/9741 [00:15<00:01, 609.13it/s] 89%|██████████████████████████████████████████████▍     | 8696/9741 [00:15<00:01, 610.06it/s] 90%|██████████████████████████████████████████████▊     | 8758/9741 [00:15<00:01, 609.81it/s] 91%|███████████████████████████████████████████████     | 8819/9741 [00:15<00:01, 608.02it/s] 91%|███████████████████████████████████████████████▍    | 8881/9741 [00:15<00:01, 609.04it/s] 92%|███████████████████████████████████████████████▋    | 8943/9741 [00:16<00:01, 610.29it/s] 92%|████████████████████████████████████████████████    | 9005/9741 [00:16<00:01, 610.72it/s] 93%|████████████████████████████████████████████████▍   | 9067/9741 [00:16<00:01, 609.45it/s] 94%|████████████████████████████████████████████████▋   | 9129/9741 [00:16<00:01, 610.14it/s] 94%|█████████████████████████████████████████████████   | 9191/9741 [00:16<00:00, 611.46it/s] 95%|█████████████████████████████████████████████████▍  | 9253/9741 [00:16<00:00, 611.79it/s] 96%|█████████████████████████████████████████████████▋  | 9315/9741 [00:16<00:00, 609.96it/s] 96%|██████████████████████████████████████████████████  | 9377/9741 [00:16<00:00, 611.20it/s] 97%|██████████████████████████████████████████████████▍ | 9439/9741 [00:16<00:00, 610.97it/s] 98%|██████████████████████████████████████████████████▋ | 9501/9741 [00:16<00:00, 608.67it/s] 98%|███████████████████████████████████████████████████ | 9563/9741 [00:17<00:00, 609.90it/s] 99%|███████████████████████████████████████████████████▍| 9625/9741 [00:17<00:00, 610.52it/s] 99%|███████████████████████████████████████████████████▋| 9687/9741 [00:17<00:00, 611.06it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:17<00:00, 561.88it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.00s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.02s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.44s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.27s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.18s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.37s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.43s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.59s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.56s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]
[2023-08-22 06:52:50,809] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.86s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.90s/it]
[2023-08-22 06:53:03,547] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 06:53:03,548] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f18d538efd0>
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 06:53:03,549] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f18d5259220>
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 06:53:03,550] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 06:53:03,551] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 06:53:03,551] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 06:53:03,551] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 06:53:03,551] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 06:53:03,551] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 06:53:03,551] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 06:53:03,551] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 06:53:03,551] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 06:53:03,551] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 06:53:03,551] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 06:53:03,551] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 06:53:03,551] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 06:53:03,551] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.44532060623168945 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.4045686721801758 seconds
Time to load utils op: 0.4049975872039795 seconds
Loading extension module utils...
Time to load utils op: 0.5048203468322754 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: The car-rental agency charges $30/day for a car, or $190 for the first week for a rental that lasts an entire week or longer. Jennie rented a car for 11 days. How much, in dollars, did she pay for the rental?
Output: 310

Input: A hurricane is approaching the southern coast of Texas, and a rancher is planning to move 400 head of cattle 60 miles to higher ground to protect them from possible inland flooding that might occur.  His animal transport truck holds 20 head of cattle.  Traveling at 60 miles per hour, what is the total driving time, in hours, it will take to transport all of his cattle to higher ground?
Output: 40

Input: Jason has a carriage house that he rents out.  He’s charging $50.00 per day or $500.00 for 14 days.  Eric wants to rent the house for 20 days.  How much will it cost him?
Output: 800

Input: Melissa works on a poultry farm. She drives to town twice each month to buy supplies. If it takes her 3 hours to drive to town and back, how many hours does Melissa spend driving in a year?
Output: 72

Input: The ratio of boys to girls in a family is 5:7. The total number of children in the family is 180. If the boys are given $3900 to share, how much money does each boy receive?
Output: 52

Input: Josephine receives a bill from the hospital for 5000$.  50 percent of the bill is for medication.  25 percent of the remaining bill is for overnight stays, and 175$ is for food.  The rest of the bill is for the ambulance ride.  How much did the ambulance ride cost?
Output: 1700

Input: It was time for Kelly to harvest her carrots that she had planted in three different beds.  In the first bed she pulled out 55 carrots.  In the second bed she pulled out 101 carrots and in the third bed she pulled out 78 carrots.  She found that 6 carrots weighed one pound.  How many pounds of carrots did Kelly harvest?
Output: 39

Input: Iris’ family is planning a surprise birthday party for her. The party will include her 3 uncles and 4 aunts who have a son and daughter each as well as her brother and mother. In total, how many people are coming to Iris’ birthday party?
Output: 23

Input: Lyra bought a pair of shoes at a 20% discount.  If she paid $480, how much was the original price of the pair of shoes?
Output: 600

Input: Rhett has been late on two of his monthly rent payments, but his landlord does not charge late fees and so he will be able to pay their total cost with 3/5 of his next month's salary after taxes. If he is currently paid $5000 per month and has to pay 10% tax, calculate his rent expense per month?
Output: 1350

Input: Ten friends decide to get an end-of-year gift for their teacher. They plan to split the cost of the gift equally. But four of the group drop out. The remaining friends split the cost equally among themselves. If each share is now $8 more, how much does the gift cost, in dollars?
Output: 120

Input: At the feline sanctuary, there were 12 lions, 14 tigers, and several cougars.  If there were half as many cougars as lions and tigers combined, then what was the total number of big cats at the feline sanctuary?
Output: 39

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o12-tgsm8k-s30-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:43<35:08, 43.03s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:25<34:12, 42.77s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:09<33:46, 43.12s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:51<32:48, 42.79s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:33<31:57, 42.61s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:16<31:12, 42.55s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:57<30:19, 42.30s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:40<29:36, 42.29s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:22<28:58, 42.40s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:05<28:16, 42.42s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:48<27:43, 42.65s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:18<24:28, 38.66s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:00<24:31, 39.77s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:43<24:29, 40.82s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:25<24:00, 41.17s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:07<23:29, 41.46s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:49<22:51, 41.55s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:31<22:18, 41.82s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:14<21:44, 42.08s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:56<20:59, 41.97s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:38<20:17, 41.98s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:57<16:27, 35.27s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:40<16:51, 37.45s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [16:22<16:50, 38.88s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:39<13:28, 32.35s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:22<14:10, 35.45s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [18:01<14:01, 36.60s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:44<14:02, 38.31s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:27<13:54, 39.76s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [20:09<13:31, 40.56s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:51<12:59, 41.01s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [21:33<12:23, 41.33s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [22:15<11:45, 41.52s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [22:58<11:09, 41.83s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [23:40<10:28, 41.93s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [24:23<09:50, 42.16s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [25:04<09:06, 42.02s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [25:46<08:24, 42.03s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [26:29<07:44, 42.18s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [27:12<07:04, 42.41s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [27:54<06:20, 42.31s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [28:36<05:37, 42.24s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [29:12<04:41, 40.23s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [29:54<04:05, 41.00s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [30:36<03:26, 41.27s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [31:18<02:45, 41.46s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [31:45<01:51, 37.15s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [32:28<01:17, 38.74s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [33:10<00:39, 39.77s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:52<00:00, 40.45s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:52<00:00, 40.65s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 2.7397} | avg. gen lenth: 295.02
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o13-tgsm8k-s30-rFalse --seed 30 --max-prompt-length 2048 --num-out-domain 13
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 07:27:05,352] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o13-tgsm8k-s30-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 13
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o13-tgsm8k-s30-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 38/9741 [00:00<00:26, 371.64it/s]  1%|▍                                                     | 76/9741 [00:00<00:25, 372.57it/s]  1%|▌                                                    | 114/9741 [00:00<00:25, 373.73it/s]  2%|▊                                                    | 152/9741 [00:00<00:25, 374.29it/s]  2%|█                                                    | 190/9741 [00:00<00:25, 373.20it/s]  2%|█▏                                                   | 228/9741 [00:00<00:25, 371.61it/s]  3%|█▍                                                   | 266/9741 [00:00<00:25, 372.09it/s]  3%|█▋                                                   | 304/9741 [00:00<00:25, 367.89it/s]  4%|█▊                                                   | 342/9741 [00:00<00:25, 368.99it/s]  4%|██                                                   | 380/9741 [00:01<00:25, 370.18it/s]  4%|██▎                                                  | 418/9741 [00:01<00:25, 371.05it/s]  5%|██▍                                                  | 456/9741 [00:01<00:25, 370.27it/s]  5%|██▋                                                  | 494/9741 [00:01<00:24, 370.87it/s]  5%|██▉                                                  | 532/9741 [00:01<00:24, 371.77it/s]  6%|███                                                  | 570/9741 [00:01<00:24, 371.90it/s]  6%|███▎                                                 | 608/9741 [00:01<00:24, 371.43it/s]  7%|███▌                                                 | 646/9741 [00:01<00:24, 368.60it/s]  7%|███▋                                                 | 683/9741 [00:01<00:24, 365.41it/s]  7%|███▉                                                 | 721/9741 [00:01<00:24, 367.72it/s]  8%|████▏                                                | 759/9741 [00:02<00:24, 369.44it/s]  8%|████▎                                                | 797/9741 [00:02<00:24, 370.77it/s]  9%|████▋                                                | 853/9741 [00:02<00:20, 425.79it/s]  9%|████▉                                                | 909/9741 [00:02<00:19, 464.68it/s] 10%|█████▎                                               | 966/9741 [00:02<00:17, 494.23it/s] 11%|█████▍                                              | 1023/9741 [00:02<00:16, 514.60it/s] 11%|█████▊                                              | 1080/9741 [00:02<00:16, 529.40it/s] 12%|██████                                              | 1136/9741 [00:02<00:16, 536.87it/s] 12%|██████▎                                             | 1193/9741 [00:02<00:15, 544.26it/s] 13%|██████▋                                             | 1250/9741 [00:02<00:15, 549.21it/s] 13%|██████▉                                             | 1307/9741 [00:03<00:15, 553.72it/s] 14%|███████▎                                            | 1363/9741 [00:03<00:15, 554.04it/s] 15%|███████▌                                            | 1419/9741 [00:03<00:14, 555.72it/s] 15%|███████▊                                            | 1475/9741 [00:03<00:14, 556.94it/s] 16%|████████▏                                           | 1532/9741 [00:03<00:14, 557.94it/s] 16%|████████▍                                           | 1588/9741 [00:03<00:14, 556.50it/s] 17%|████████▊                                           | 1645/9741 [00:03<00:14, 558.22it/s] 17%|█████████                                           | 1702/9741 [00:03<00:14, 559.48it/s] 18%|█████████▍                                          | 1759/9741 [00:03<00:14, 560.17it/s] 19%|█████████▋                                          | 1816/9741 [00:03<00:14, 532.83it/s] 19%|█████████▉                                          | 1873/9741 [00:04<00:14, 540.92it/s] 20%|██████████▎                                         | 1930/9741 [00:04<00:14, 546.86it/s] 20%|██████████▌                                         | 1987/9741 [00:04<00:14, 551.29it/s] 21%|██████████▉                                         | 2043/9741 [00:04<00:14, 548.71it/s] 22%|███████████▏                                        | 2099/9741 [00:04<00:13, 551.33it/s] 22%|███████████▌                                        | 2155/9741 [00:04<00:13, 546.31it/s] 23%|███████████▊                                        | 2212/9741 [00:04<00:13, 551.15it/s] 23%|████████████                                        | 2268/9741 [00:04<00:13, 551.77it/s] 24%|████████████▍                                       | 2325/9741 [00:04<00:13, 554.34it/s] 24%|████████████▋                                       | 2382/9741 [00:05<00:13, 556.71it/s] 25%|█████████████                                       | 2439/9741 [00:05<00:13, 558.86it/s] 26%|█████████████▎                                      | 2495/9741 [00:05<00:13, 556.53it/s] 26%|█████████████▌                                      | 2551/9741 [00:05<00:12, 556.42it/s] 27%|█████████████▉                                      | 2607/9741 [00:05<00:12, 557.34it/s] 27%|██████████████▏                                     | 2664/9741 [00:05<00:12, 558.18it/s] 28%|██████████████▌                                     | 2720/9741 [00:05<00:12, 556.01it/s] 28%|██████████████▊                                     | 2776/9741 [00:05<00:12, 550.52it/s] 29%|███████████████                                     | 2832/9741 [00:05<00:12, 552.28it/s] 30%|███████████████▍                                    | 2889/9741 [00:05<00:12, 554.91it/s] 30%|███████████████▋                                    | 2945/9741 [00:06<00:12, 554.39it/s] 31%|████████████████                                    | 3001/9741 [00:06<00:12, 555.75it/s] 31%|████████████████▎                                   | 3057/9741 [00:06<00:12, 556.64it/s] 32%|████████████████▌                                   | 3113/9741 [00:06<00:11, 556.84it/s] 33%|████████████████▉                                   | 3169/9741 [00:06<00:11, 554.98it/s] 33%|█████████████████▏                                  | 3226/9741 [00:06<00:11, 556.74it/s] 34%|█████████████████▌                                  | 3283/9741 [00:06<00:11, 558.43it/s] 34%|█████████████████▊                                  | 3339/9741 [00:06<00:11, 558.63it/s] 35%|██████████████████                                  | 3395/9741 [00:06<00:11, 556.37it/s] 35%|██████████████████▍                                 | 3451/9741 [00:06<00:11, 556.97it/s] 36%|██████████████████▋                                 | 3507/9741 [00:07<00:11, 551.46it/s] 37%|███████████████████                                 | 3563/9741 [00:07<00:11, 553.35it/s] 37%|███████████████████▎                                | 3619/9741 [00:07<00:11, 551.03it/s] 38%|███████████████████▌                                | 3675/9741 [00:07<00:10, 553.09it/s] 38%|███████████████████▉                                | 3732/9741 [00:07<00:10, 555.47it/s] 39%|████████████████████▏                               | 3788/9741 [00:07<00:10, 556.80it/s] 39%|████████████████████▌                               | 3844/9741 [00:07<00:10, 555.12it/s] 40%|████████████████████▊                               | 3900/9741 [00:07<00:10, 556.47it/s] 41%|█████████████████████                               | 3956/9741 [00:07<00:10, 556.85it/s] 41%|█████████████████████▍                              | 4012/9741 [00:07<00:10, 557.41it/s] 42%|█████████████████████▋                              | 4068/9741 [00:08<00:10, 555.50it/s] 42%|██████████████████████                              | 4124/9741 [00:08<00:10, 556.33it/s] 43%|██████████████████████▎                             | 4180/9741 [00:08<00:09, 556.51it/s] 43%|██████████████████████▌                             | 4236/9741 [00:08<00:09, 553.27it/s] 44%|██████████████████████▉                             | 4292/9741 [00:08<00:09, 552.89it/s] 45%|███████████████████████▏                            | 4348/9741 [00:08<00:09, 554.58it/s] 45%|███████████████████████▌                            | 4404/9741 [00:08<00:09, 555.33it/s] 46%|███████████████████████▊                            | 4460/9741 [00:08<00:09, 555.80it/s] 46%|████████████████████████                            | 4516/9741 [00:08<00:10, 510.19it/s] 47%|████████████████████████▍                           | 4572/9741 [00:08<00:09, 522.92it/s] 48%|████████████████████████▋                           | 4628/9741 [00:09<00:09, 531.39it/s] 48%|█████████████████████████                           | 4684/9741 [00:09<00:09, 539.30it/s] 49%|█████████████████████████▎                          | 4740/9741 [00:09<00:12, 392.24it/s] 49%|█████████████████████████▌                          | 4796/9741 [00:09<00:11, 429.64it/s] 50%|█████████████████████████▉                          | 4852/9741 [00:09<00:10, 460.69it/s] 50%|██████████████████████████▏                         | 4908/9741 [00:09<00:09, 485.83it/s] 51%|██████████████████████████▍                         | 4964/9741 [00:09<00:09, 504.05it/s] 52%|██████████████████████████▊                         | 5020/9741 [00:09<00:09, 519.26it/s] 52%|███████████████████████████                         | 5076/9741 [00:10<00:08, 529.74it/s] 53%|███████████████████████████▍                        | 5132/9741 [00:10<00:08, 537.89it/s] 53%|███████████████████████████▋                        | 5188/9741 [00:10<00:08, 541.78it/s] 54%|███████████████████████████▉                        | 5244/9741 [00:10<00:08, 546.40it/s] 54%|████████████████████████████▎                       | 5300/9741 [00:10<00:08, 549.73it/s] 55%|████████████████████████████▌                       | 5356/9741 [00:10<00:07, 552.46it/s] 56%|████████████████████████████▉                       | 5412/9741 [00:10<00:07, 551.75it/s] 56%|█████████████████████████████▏                      | 5468/9741 [00:10<00:07, 553.14it/s] 57%|█████████████████████████████▍                      | 5526/9741 [00:10<00:07, 560.92it/s] 57%|█████████████████████████████▊                      | 5584/9741 [00:10<00:07, 565.65it/s] 58%|██████████████████████████████                      | 5641/9741 [00:11<00:07, 566.27it/s] 59%|██████████████████████████████▍                     | 5700/9741 [00:11<00:07, 570.48it/s] 59%|██████████████████████████████▋                     | 5758/9741 [00:11<00:06, 572.84it/s] 60%|███████████████████████████████                     | 5816/9741 [00:11<00:06, 574.90it/s] 60%|███████████████████████████████▎                    | 5874/9741 [00:11<00:06, 574.29it/s] 61%|███████████████████████████████▋                    | 5932/9741 [00:11<00:06, 575.79it/s] 62%|███████████████████████████████▉                    | 5991/9741 [00:11<00:06, 577.61it/s] 62%|████████████████████████████████▎                   | 6050/9741 [00:11<00:06, 578.79it/s] 63%|████████████████████████████████▌                   | 6108/9741 [00:11<00:06, 576.09it/s] 63%|████████████████████████████████▉                   | 6166/9741 [00:11<00:06, 576.50it/s] 64%|█████████████████████████████████▏                  | 6224/9741 [00:12<00:06, 577.12it/s] 64%|█████████████████████████████████▌                  | 6282/9741 [00:12<00:05, 577.69it/s] 65%|█████████████████████████████████▊                  | 6340/9741 [00:12<00:05, 576.02it/s] 66%|██████████████████████████████████▏                 | 6398/9741 [00:12<00:05, 577.06it/s] 66%|██████████████████████████████████▍                 | 6457/9741 [00:12<00:05, 578.56it/s] 67%|██████████████████████████████████▊                 | 6515/9741 [00:12<00:05, 577.89it/s] 67%|███████████████████████████████████                 | 6573/9741 [00:12<00:05, 576.09it/s] 68%|███████████████████████████████████▍                | 6631/9741 [00:12<00:05, 576.73it/s] 69%|███████████████████████████████████▋                | 6689/9741 [00:12<00:05, 577.31it/s] 69%|████████████████████████████████████                | 6748/9741 [00:12<00:05, 578.35it/s] 70%|████████████████████████████████████▎               | 6806/9741 [00:13<00:05, 576.82it/s] 70%|████████████████████████████████████▋               | 6865/9741 [00:13<00:04, 578.39it/s] 71%|████████████████████████████████████▉               | 6923/9741 [00:13<00:04, 578.35it/s] 72%|█████████████████████████████████████▎              | 6981/9741 [00:13<00:04, 577.95it/s] 72%|█████████████████████████████████████▌              | 7039/9741 [00:13<00:04, 572.50it/s] 73%|█████████████████████████████████████▉              | 7097/9741 [00:13<00:04, 574.63it/s] 73%|██████████████████████████████████████▏             | 7155/9741 [00:13<00:04, 575.75it/s] 74%|██████████████████████████████████████▌             | 7213/9741 [00:13<00:04, 574.80it/s] 75%|██████████████████████████████████████▊             | 7272/9741 [00:13<00:04, 576.34it/s] 75%|███████████████████████████████████████▏            | 7331/9741 [00:13<00:04, 577.84it/s] 76%|███████████████████████████████████████▍            | 7390/9741 [00:14<00:04, 578.65it/s] 76%|███████████████████████████████████████▊            | 7448/9741 [00:14<00:04, 547.96it/s] 77%|████████████████████████████████████████            | 7506/9741 [00:14<00:04, 556.56it/s] 78%|████████████████████████████████████████▍           | 7564/9741 [00:14<00:03, 562.25it/s] 78%|████████████████████████████████████████▋           | 7622/9741 [00:14<00:03, 567.43it/s] 79%|████████████████████████████████████████▉           | 7679/9741 [00:14<00:03, 568.10it/s] 79%|█████████████████████████████████████████▎          | 7738/9741 [00:14<00:03, 572.40it/s] 80%|█████████████████████████████████████████▌          | 7796/9741 [00:14<00:03, 574.53it/s] 81%|█████████████████████████████████████████▉          | 7855/9741 [00:14<00:03, 576.37it/s] 81%|██████████████████████████████████████████▏         | 7913/9741 [00:14<00:03, 575.84it/s] 82%|██████████████████████████████████████████▌         | 7971/9741 [00:15<00:03, 575.75it/s] 82%|██████████████████████████████████████████▊         | 8030/9741 [00:15<00:02, 577.06it/s] 83%|███████████████████████████████████████████▏        | 8088/9741 [00:15<00:02, 577.45it/s] 84%|███████████████████████████████████████████▍        | 8146/9741 [00:15<00:02, 575.59it/s] 84%|███████████████████████████████████████████▊        | 8204/9741 [00:15<00:02, 576.48it/s] 85%|████████████████████████████████████████████        | 8262/9741 [00:15<00:02, 577.44it/s] 85%|████████████████████████████████████████████▍       | 8320/9741 [00:15<00:02, 577.63it/s] 86%|████████████████████████████████████████████▋       | 8378/9741 [00:15<00:02, 575.90it/s] 87%|█████████████████████████████████████████████       | 8437/9741 [00:15<00:02, 577.90it/s] 87%|█████████████████████████████████████████████▎      | 8495/9741 [00:15<00:02, 578.45it/s] 88%|█████████████████████████████████████████████▋      | 8553/9741 [00:16<00:02, 578.40it/s] 88%|█████████████████████████████████████████████▉      | 8611/9741 [00:16<00:01, 575.78it/s] 89%|██████████████████████████████████████████████▎     | 8669/9741 [00:16<00:01, 575.94it/s] 90%|██████████████████████████████████████████████▌     | 8728/9741 [00:16<00:01, 577.23it/s] 90%|██████████████████████████████████████████████▉     | 8787/9741 [00:16<00:01, 578.23it/s] 91%|███████████████████████████████████████████████▏    | 8845/9741 [00:16<00:01, 575.99it/s] 91%|███████████████████████████████████████████████▌    | 8904/9741 [00:16<00:01, 577.76it/s] 92%|███████████████████████████████████████████████▊    | 8962/9741 [00:16<00:01, 576.60it/s] 93%|████████████████████████████████████████████████▏   | 9020/9741 [00:16<00:01, 577.46it/s] 93%|████████████████████████████████████████████████▍   | 9078/9741 [00:17<00:01, 575.36it/s] 94%|████████████████████████████████████████████████▊   | 9136/9741 [00:17<00:01, 574.31it/s] 94%|█████████████████████████████████████████████████   | 9194/9741 [00:17<00:00, 575.30it/s] 95%|█████████████████████████████████████████████████▍  | 9252/9741 [00:17<00:00, 576.04it/s] 96%|█████████████████████████████████████████████████▋  | 9310/9741 [00:17<00:00, 574.09it/s] 96%|██████████████████████████████████████████████████  | 9368/9741 [00:17<00:00, 575.72it/s] 97%|██████████████████████████████████████████████████▎ | 9426/9741 [00:17<00:00, 576.09it/s] 97%|██████████████████████████████████████████████████▋ | 9484/9741 [00:17<00:00, 573.53it/s] 98%|██████████████████████████████████████████████████▉ | 9542/9741 [00:17<00:00, 574.58it/s] 99%|███████████████████████████████████████████████████▏| 9600/9741 [00:17<00:00, 574.61it/s] 99%|███████████████████████████████████████████████████▌| 9658/9741 [00:18<00:00, 574.91it/s]100%|███████████████████████████████████████████████████▊| 9716/9741 [00:18<00:00, 573.48it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:18<00:00, 536.57it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.12s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.96s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.27s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.22s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.11s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.03s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.17s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.39s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.52s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.65s/it]
[2023-08-22 07:28:14,815] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.60s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.99s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.08s/it]
[2023-08-22 07:28:25,301] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 07:28:25,302] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 07:28:25,303] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 07:28:25,303] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 07:28:25,303] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 07:28:25,303] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fbdc454cfd0>
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 07:28:25,304] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fbdc443f220>
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 07:28:25,305] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 07:28:25,306] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.46567821502685547 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5045924186706543 seconds
Time to load utils op: 0.4044990539550781 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]Loading extension module utils...
############### Example ###############
Time to load utils op: 0.5045850276947021 seconds
### Instruction:Answer the following multiple choice question.

Input: The car-rental agency charges $30/day for a car, or $190 for the first week for a rental that lasts an entire week or longer. Jennie rented a car for 11 days. How much, in dollars, did she pay for the rental?
Output: 310

Input: A hurricane is approaching the southern coast of Texas, and a rancher is planning to move 400 head of cattle 60 miles to higher ground to protect them from possible inland flooding that might occur.  His animal transport truck holds 20 head of cattle.  Traveling at 60 miles per hour, what is the total driving time, in hours, it will take to transport all of his cattle to higher ground?
Output: 40

Input: Jason has a carriage house that he rents out.  He’s charging $50.00 per day or $500.00 for 14 days.  Eric wants to rent the house for 20 days.  How much will it cost him?
Output: 800

Input: Melissa works on a poultry farm. She drives to town twice each month to buy supplies. If it takes her 3 hours to drive to town and back, how many hours does Melissa spend driving in a year?
Output: 72

Input: The ratio of boys to girls in a family is 5:7. The total number of children in the family is 180. If the boys are given $3900 to share, how much money does each boy receive?
Output: 52

Input: Josephine receives a bill from the hospital for 5000$.  50 percent of the bill is for medication.  25 percent of the remaining bill is for overnight stays, and 175$ is for food.  The rest of the bill is for the ambulance ride.  How much did the ambulance ride cost?
Output: 1700

Input: It was time for Kelly to harvest her carrots that she had planted in three different beds.  In the first bed she pulled out 55 carrots.  In the second bed she pulled out 101 carrots and in the third bed she pulled out 78 carrots.  She found that 6 carrots weighed one pound.  How many pounds of carrots did Kelly harvest?
Output: 39

Input: Iris’ family is planning a surprise birthday party for her. The party will include her 3 uncles and 4 aunts who have a son and daughter each as well as her brother and mother. In total, how many people are coming to Iris’ birthday party?
Output: 23

Input: Lyra bought a pair of shoes at a 20% discount.  If she paid $480, how much was the original price of the pair of shoes?
Output: 600

Input: Rhett has been late on two of his monthly rent payments, but his landlord does not charge late fees and so he will be able to pay their total cost with 3/5 of his next month's salary after taxes. If he is currently paid $5000 per month and has to pay 10% tax, calculate his rent expense per month?
Output: 1350

Input: Ten friends decide to get an end-of-year gift for their teacher. They plan to split the cost of the gift equally. But four of the group drop out. The remaining friends split the cost equally among themselves. If each share is now $8 more, how much does the gift cost, in dollars?
Output: 120

Input: At the feline sanctuary, there were 12 lions, 14 tigers, and several cougars.  If there were half as many cougars as lions and tigers combined, then what was the total number of big cats at the feline sanctuary?
Output: 39

Input: A pea patch is twice as big as a radish patch. If one sixth of the pea patch is 5 square feet.  How much is a whole radish patch in square feet?
Output: 15

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o13-tgsm8k-s30-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:43<35:36, 43.60s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:25<33:54, 42.39s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:07<33:08, 42.31s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:48<32:13, 42.04s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:16<27:37, 36.82s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:57<28:03, 38.26s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:39<28:14, 39.40s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:20<28:02, 40.06s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:48<24:47, 36.28s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:31<25:24, 38.11s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:12<25:31, 39.28s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:54<25:23, 40.08s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:37<25:10, 40.83s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:19<24:46, 41.29s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:01<24:13, 41.53s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:43<23:37, 41.68s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:26<23:02, 41.88s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:08<22:26, 42.07s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:51<21:50, 42.28s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:33<21:03, 42.12s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:14<20:16, 41.96s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:42<17:33, 37.62s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:24<17:33, 39.01s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [16:06<17:14, 39.79s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:47<16:45, 40.23s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:30<16:23, 40.99s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [18:11<15:47, 41.21s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:53<15:10, 41.40s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:36<14:36, 41.72s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [20:18<13:56, 41.83s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [21:00<13:16, 41.94s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [21:42<12:33, 41.89s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [22:24<11:53, 42.00s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:06<11:09, 41.85s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [23:48<10:31, 42.07s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [24:26<09:32, 40.86s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [25:09<08:57, 41.38s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [25:50<08:17, 41.45s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [26:33<07:38, 41.70s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [26:51<05:46, 34.65s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [27:19<04:54, 32.71s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [28:02<04:45, 35.68s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [28:45<04:26, 38.03s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [29:21<03:44, 37.41s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [30:03<03:13, 38.61s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [30:44<02:38, 39.51s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [31:26<02:00, 40.30s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [32:09<01:21, 40.95s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [32:51<00:41, 41.44s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:33<00:00, 41.63s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:33<00:00, 40.28s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.3304} | avg. gen lenth: 276.036
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o14-tgsm8k-s30-rFalse --seed 30 --max-prompt-length 2048 --num-out-domain 14
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 08:03:08,887] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o14-tgsm8k-s30-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 14
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o14-tgsm8k-s30-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 32/9741 [00:00<00:30, 317.83it/s]  1%|▎                                                     | 65/9741 [00:00<00:30, 320.01it/s]  1%|▌                                                     | 98/9741 [00:00<00:30, 321.07it/s]  1%|▋                                                    | 131/9741 [00:00<00:29, 320.89it/s]  2%|▉                                                    | 164/9741 [00:00<00:29, 321.09it/s]  2%|█                                                    | 197/9741 [00:00<00:29, 320.96it/s]  2%|█▎                                                   | 230/9741 [00:00<00:29, 319.01it/s]  3%|█▍                                                   | 262/9741 [00:00<00:30, 313.83it/s]  3%|█▌                                                   | 294/9741 [00:00<00:29, 315.58it/s]  3%|█▊                                                   | 326/9741 [00:01<00:29, 316.78it/s]  4%|█▉                                                   | 358/9741 [00:01<00:29, 317.36it/s]  4%|██▏                                                  | 391/9741 [00:01<00:29, 318.52it/s]  4%|██▎                                                  | 423/9741 [00:01<00:29, 318.78it/s]  5%|██▍                                                  | 455/9741 [00:01<00:29, 317.78it/s]  5%|██▋                                                  | 487/9741 [00:01<00:29, 318.23it/s]  5%|██▊                                                  | 520/9741 [00:01<00:28, 318.79it/s]  6%|███                                                  | 552/9741 [00:01<00:28, 318.88it/s]  6%|███▏                                                 | 584/9741 [00:01<00:29, 315.74it/s]  6%|███▎                                                 | 616/9741 [00:01<00:28, 316.10it/s]  7%|███▌                                                 | 648/9741 [00:02<00:29, 312.50it/s]  7%|███▋                                                 | 680/9741 [00:02<00:28, 313.26it/s]  7%|███▉                                                 | 713/9741 [00:02<00:28, 315.33it/s]  8%|████                                                 | 746/9741 [00:02<00:28, 316.92it/s]  8%|████▏                                                | 779/9741 [00:02<00:28, 318.12it/s]  8%|████▍                                                | 812/9741 [00:02<00:27, 319.08it/s]  9%|████▌                                                | 845/9741 [00:02<00:27, 319.70it/s]  9%|████▊                                                | 878/9741 [00:02<00:27, 320.09it/s]  9%|████▉                                                | 911/9741 [00:02<00:27, 318.76it/s] 10%|█████▏                                               | 944/9741 [00:02<00:27, 319.29it/s] 10%|█████▎                                               | 977/9741 [00:03<00:27, 319.68it/s] 10%|█████▍                                              | 1010/9741 [00:03<00:27, 320.09it/s] 11%|█████▌                                              | 1043/9741 [00:03<00:27, 320.58it/s] 11%|█████▋                                              | 1076/9741 [00:03<00:26, 321.13it/s] 11%|█████▉                                              | 1109/9741 [00:03<00:27, 319.27it/s] 12%|██████▏                                             | 1158/9741 [00:03<00:23, 367.89it/s] 12%|██████▍                                             | 1207/9741 [00:03<00:21, 402.92it/s] 13%|██████▋                                             | 1256/9741 [00:03<00:19, 427.40it/s] 13%|██████▉                                             | 1305/9741 [00:03<00:18, 445.19it/s] 14%|███████▏                                            | 1353/9741 [00:03<00:18, 455.47it/s] 14%|███████▍                                            | 1402/9741 [00:04<00:17, 463.29it/s] 15%|███████▋                                            | 1451/9741 [00:04<00:17, 470.08it/s] 15%|████████                                            | 1500/9741 [00:04<00:17, 474.42it/s] 16%|████████▎                                           | 1549/9741 [00:04<00:17, 477.52it/s] 16%|████████▌                                           | 1597/9741 [00:04<00:17, 477.04it/s] 17%|████████▊                                           | 1646/9741 [00:04<00:16, 480.28it/s] 17%|█████████                                           | 1695/9741 [00:04<00:16, 482.14it/s] 18%|█████████▎                                          | 1744/9741 [00:04<00:16, 483.57it/s] 18%|█████████▌                                          | 1793/9741 [00:04<00:17, 462.78it/s] 19%|█████████▊                                          | 1842/9741 [00:05<00:16, 469.45it/s] 19%|██████████                                          | 1891/9741 [00:05<00:16, 473.77it/s] 20%|██████████▎                                         | 1940/9741 [00:05<00:16, 477.13it/s] 20%|██████████▌                                         | 1989/9741 [00:05<00:16, 479.61it/s] 21%|██████████▉                                         | 2038/9741 [00:05<00:16, 478.97it/s] 21%|███████████▏                                        | 2087/9741 [00:05<00:15, 480.43it/s] 22%|███████████▍                                        | 2136/9741 [00:05<00:15, 481.93it/s] 22%|███████████▋                                        | 2185/9741 [00:05<00:15, 480.43it/s] 23%|███████████▉                                        | 2234/9741 [00:05<00:15, 481.78it/s] 23%|████████████▏                                       | 2283/9741 [00:05<00:15, 480.29it/s] 24%|████████████▍                                       | 2332/9741 [00:06<00:15, 481.53it/s] 24%|████████████▋                                       | 2381/9741 [00:06<00:15, 481.12it/s] 25%|████████████▉                                       | 2430/9741 [00:06<00:15, 483.00it/s] 25%|█████████████▏                                      | 2479/9741 [00:06<00:15, 481.18it/s] 26%|█████████████▍                                      | 2528/9741 [00:06<00:14, 482.06it/s] 26%|█████████████▊                                      | 2577/9741 [00:06<00:14, 482.87it/s] 27%|██████████████                                      | 2626/9741 [00:06<00:14, 483.45it/s] 27%|██████████████▎                                     | 2675/9741 [00:06<00:14, 483.39it/s] 28%|██████████████▌                                     | 2724/9741 [00:06<00:14, 480.62it/s] 28%|██████████████▊                                     | 2773/9741 [00:06<00:14, 481.47it/s] 29%|███████████████                                     | 2822/9741 [00:07<00:14, 477.72it/s] 29%|███████████████▎                                    | 2871/9741 [00:07<00:14, 480.12it/s] 30%|███████████████▌                                    | 2920/9741 [00:07<00:14, 481.20it/s] 30%|███████████████▊                                    | 2969/9741 [00:07<00:14, 479.46it/s] 31%|████████████████                                    | 3018/9741 [00:07<00:13, 481.18it/s] 31%|████████████████▎                                   | 3067/9741 [00:07<00:13, 481.59it/s] 32%|████████████████▋                                   | 3116/9741 [00:07<00:13, 481.92it/s] 32%|████████████████▉                                   | 3165/9741 [00:07<00:13, 480.36it/s] 33%|█████████████████▏                                  | 3214/9741 [00:07<00:13, 481.36it/s] 33%|█████████████████▍                                  | 3263/9741 [00:07<00:13, 482.59it/s] 34%|█████████████████▋                                  | 3312/9741 [00:08<00:13, 483.00it/s] 35%|█████████████████▉                                  | 3361/9741 [00:08<00:13, 482.07it/s] 35%|██████████████████▏                                 | 3410/9741 [00:08<00:13, 481.12it/s] 36%|██████████████████▍                                 | 3459/9741 [00:08<00:13, 478.00it/s] 36%|██████████████████▋                                 | 3508/9741 [00:08<00:13, 479.28it/s] 37%|██████████████████▉                                 | 3557/9741 [00:08<00:12, 480.66it/s] 37%|███████████████████▏                                | 3606/9741 [00:08<00:12, 478.89it/s] 38%|███████████████████▌                                | 3655/9741 [00:08<00:12, 480.27it/s] 38%|███████████████████▊                                | 3704/9741 [00:08<00:12, 481.07it/s] 39%|████████████████████                                | 3753/9741 [00:08<00:12, 482.15it/s] 39%|████████████████████▎                               | 3802/9741 [00:09<00:12, 482.55it/s] 40%|████████████████████▌                               | 3851/9741 [00:09<00:12, 480.68it/s] 40%|████████████████████▊                               | 3900/9741 [00:09<00:12, 481.75it/s] 41%|█████████████████████                               | 3949/9741 [00:09<00:12, 482.02it/s] 41%|█████████████████████▎                              | 3998/9741 [00:09<00:11, 482.51it/s] 42%|█████████████████████▌                              | 4047/9741 [00:09<00:11, 479.26it/s] 42%|█████████████████████▊                              | 4095/9741 [00:09<00:11, 475.58it/s] 43%|██████████████████████                              | 4144/9741 [00:09<00:11, 477.63it/s] 43%|██████████████████████▍                             | 4193/9741 [00:09<00:11, 479.22it/s] 44%|██████████████████████▋                             | 4242/9741 [00:10<00:11, 480.24it/s] 44%|██████████████████████▉                             | 4291/9741 [00:10<00:11, 479.30it/s] 45%|███████████████████████▏                            | 4339/9741 [00:10<00:11, 478.19it/s] 45%|███████████████████████▍                            | 4388/9741 [00:10<00:11, 479.50it/s] 46%|███████████████████████▋                            | 4437/9741 [00:10<00:11, 479.97it/s] 46%|███████████████████████▉                            | 4486/9741 [00:10<00:10, 480.89it/s] 47%|████████████████████████▏                           | 4535/9741 [00:10<00:11, 434.40it/s] 47%|████████████████████████▍                           | 4584/9741 [00:10<00:11, 447.80it/s] 48%|████████████████████████▋                           | 4633/9741 [00:10<00:11, 457.73it/s] 48%|████████████████████████▉                           | 4682/9741 [00:10<00:10, 464.70it/s] 49%|█████████████████████████▎                          | 4731/9741 [00:11<00:10, 469.94it/s] 49%|█████████████████████████▌                          | 4779/9741 [00:11<00:14, 337.87it/s] 50%|█████████████████████████▊                          | 4828/9741 [00:11<00:13, 371.76it/s] 50%|██████████████████████████                          | 4877/9741 [00:11<00:12, 399.35it/s] 51%|██████████████████████████▎                         | 4926/9741 [00:11<00:11, 421.22it/s] 51%|██████████████████████████▌                         | 4974/9741 [00:11<00:10, 436.18it/s] 52%|██████████████████████████▊                         | 5023/9741 [00:11<00:10, 449.44it/s] 52%|███████████████████████████                         | 5072/9741 [00:11<00:10, 458.79it/s] 53%|███████████████████████████▎                        | 5121/9741 [00:12<00:09, 465.95it/s] 53%|███████████████████████████▌                        | 5170/9741 [00:12<00:09, 468.80it/s] 54%|███████████████████████████▊                        | 5218/9741 [00:12<00:09, 468.31it/s] 54%|████████████████████████████                        | 5267/9741 [00:12<00:09, 472.27it/s] 55%|████████████████████████████▍                       | 5316/9741 [00:12<00:09, 475.10it/s] 55%|████████████████████████████▋                       | 5365/9741 [00:12<00:09, 477.12it/s] 56%|████████████████████████████▉                       | 5413/9741 [00:12<00:09, 475.91it/s] 56%|█████████████████████████████▏                      | 5462/9741 [00:12<00:08, 477.65it/s] 57%|█████████████████████████████▍                      | 5512/9741 [00:12<00:08, 482.57it/s] 57%|█████████████████████████████▋                      | 5562/9741 [00:12<00:08, 487.12it/s] 58%|█████████████████████████████▉                      | 5612/9741 [00:13<00:08, 489.60it/s] 58%|██████████████████████████████▏                     | 5662/9741 [00:13<00:08, 489.92it/s] 59%|██████████████████████████████▍                     | 5712/9741 [00:13<00:08, 492.44it/s] 59%|██████████████████████████████▊                     | 5762/9741 [00:13<00:08, 493.90it/s] 60%|███████████████████████████████                     | 5812/9741 [00:13<00:07, 494.96it/s] 60%|███████████████████████████████▎                    | 5862/9741 [00:13<00:07, 492.51it/s] 61%|███████████████████████████████▌                    | 5912/9741 [00:13<00:07, 494.36it/s] 61%|███████████████████████████████▊                    | 5962/9741 [00:13<00:07, 495.78it/s] 62%|████████████████████████████████                    | 6012/9741 [00:13<00:07, 496.38it/s] 62%|████████████████████████████████▎                   | 6062/9741 [00:13<00:07, 494.76it/s] 63%|████████████████████████████████▋                   | 6112/9741 [00:14<00:07, 493.33it/s] 63%|████████████████████████████████▉                   | 6162/9741 [00:14<00:07, 494.09it/s] 64%|█████████████████████████████████▏                  | 6212/9741 [00:14<00:07, 493.30it/s] 64%|█████████████████████████████████▍                  | 6262/9741 [00:14<00:07, 493.93it/s] 65%|█████████████████████████████████▋                  | 6312/9741 [00:14<00:06, 492.64it/s] 65%|█████████████████████████████████▉                  | 6362/9741 [00:14<00:06, 493.96it/s] 66%|██████████████████████████████████▏                 | 6412/9741 [00:14<00:06, 494.80it/s] 66%|██████████████████████████████████▍                 | 6462/9741 [00:14<00:06, 494.89it/s] 67%|██████████████████████████████████▊                 | 6512/9741 [00:14<00:06, 495.93it/s] 67%|███████████████████████████████████                 | 6562/9741 [00:14<00:06, 494.18it/s] 68%|███████████████████████████████████▎                | 6612/9741 [00:15<00:06, 494.97it/s] 68%|███████████████████████████████████▌                | 6662/9741 [00:15<00:06, 495.58it/s] 69%|███████████████████████████████████▊                | 6712/9741 [00:15<00:06, 496.27it/s] 69%|████████████████████████████████████                | 6762/9741 [00:15<00:06, 495.11it/s] 70%|████████████████████████████████████▎               | 6813/9741 [00:15<00:05, 496.60it/s] 70%|████████████████████████████████████▋               | 6863/9741 [00:15<00:05, 497.48it/s] 71%|████████████████████████████████████▉               | 6913/9741 [00:15<00:05, 496.23it/s] 71%|█████████████████████████████████████▏              | 6963/9741 [00:15<00:05, 496.48it/s] 72%|█████████████████████████████████████▍              | 7013/9741 [00:15<00:05, 494.20it/s] 73%|█████████████████████████████████████▋              | 7063/9741 [00:15<00:05, 495.82it/s] 73%|█████████████████████████████████████▉              | 7113/9741 [00:16<00:05, 496.22it/s] 74%|██████████████████████████████████████▏             | 7163/9741 [00:16<00:05, 496.43it/s] 74%|██████████████████████████████████████▌             | 7213/9741 [00:16<00:05, 493.06it/s] 75%|██████████████████████████████████████▊             | 7263/9741 [00:16<00:05, 494.30it/s] 75%|███████████████████████████████████████             | 7313/9741 [00:16<00:04, 494.74it/s] 76%|███████████████████████████████████████▎            | 7363/9741 [00:16<00:04, 495.58it/s] 76%|███████████████████████████████████████▌            | 7413/9741 [00:16<00:04, 495.72it/s] 77%|███████████████████████████████████████▊            | 7463/9741 [00:16<00:04, 468.33it/s] 77%|████████████████████████████████████████            | 7513/9741 [00:16<00:04, 476.13it/s] 78%|████████████████████████████████████████▎           | 7563/9741 [00:16<00:04, 482.03it/s] 78%|████████████████████████████████████████▋           | 7613/9741 [00:17<00:04, 486.92it/s] 79%|████████████████████████████████████████▉           | 7663/9741 [00:17<00:04, 489.67it/s] 79%|█████████████████████████████████████████▏          | 7713/9741 [00:17<00:04, 489.78it/s] 80%|█████████████████████████████████████████▍          | 7763/9741 [00:17<00:04, 491.57it/s] 80%|█████████████████████████████████████████▋          | 7813/9741 [00:17<00:03, 493.19it/s] 81%|█████████████████████████████████████████▉          | 7863/9741 [00:17<00:03, 494.62it/s] 81%|██████████████████████████████████████████▏         | 7913/9741 [00:17<00:03, 492.51it/s] 82%|██████████████████████████████████████████▌         | 7963/9741 [00:17<00:03, 493.94it/s] 82%|██████████████████████████████████████████▊         | 8013/9741 [00:17<00:03, 494.57it/s] 83%|███████████████████████████████████████████         | 8063/9741 [00:17<00:03, 495.16it/s] 83%|███████████████████████████████████████████▎        | 8113/9741 [00:18<00:03, 496.09it/s] 84%|███████████████████████████████████████████▌        | 8163/9741 [00:18<00:03, 494.11it/s] 84%|███████████████████████████████████████████▊        | 8213/9741 [00:18<00:03, 493.48it/s] 85%|████████████████████████████████████████████        | 8263/9741 [00:18<00:02, 494.98it/s] 85%|████████████████████████████████████████████▍       | 8313/9741 [00:18<00:02, 495.64it/s] 86%|████████████████████████████████████████████▋       | 8363/9741 [00:18<00:02, 493.85it/s] 86%|████████████████████████████████████████████▉       | 8413/9741 [00:18<00:02, 494.99it/s] 87%|█████████████████████████████████████████████▏      | 8463/9741 [00:18<00:02, 496.05it/s] 87%|█████████████████████████████████████████████▍      | 8513/9741 [00:18<00:02, 496.98it/s] 88%|█████████████████████████████████████████████▋      | 8563/9741 [00:18<00:02, 494.63it/s] 88%|█████████████████████████████████████████████▉      | 8613/9741 [00:19<00:02, 493.71it/s] 89%|██████████████████████████████████████████████▏     | 8663/9741 [00:19<00:02, 494.74it/s] 89%|██████████████████████████████████████████████▌     | 8713/9741 [00:19<00:02, 495.34it/s] 90%|██████████████████████████████████████████████▊     | 8763/9741 [00:19<00:01, 495.91it/s] 90%|███████████████████████████████████████████████     | 8813/9741 [00:19<00:01, 493.61it/s] 91%|███████████████████████████████████████████████▎    | 8863/9741 [00:19<00:01, 494.41it/s] 91%|███████████████████████████████████████████████▌    | 8913/9741 [00:19<00:01, 495.57it/s] 92%|███████████████████████████████████████████████▊    | 8963/9741 [00:19<00:01, 496.27it/s] 93%|████████████████████████████████████████████████    | 9013/9741 [00:19<00:01, 496.88it/s] 93%|████████████████████████████████████████████████▍   | 9063/9741 [00:20<00:01, 495.11it/s] 94%|████████████████████████████████████████████████▋   | 9113/9741 [00:20<00:01, 495.70it/s] 94%|████████████████████████████████████████████████▉   | 9163/9741 [00:20<00:01, 495.84it/s] 95%|█████████████████████████████████████████████████▏  | 9213/9741 [00:20<00:01, 495.51it/s] 95%|█████████████████████████████████████████████████▍  | 9263/9741 [00:20<00:00, 494.07it/s] 96%|█████████████████████████████████████████████████▋  | 9313/9741 [00:20<00:00, 494.66it/s] 96%|█████████████████████████████████████████████████▉  | 9363/9741 [00:20<00:00, 495.36it/s] 97%|██████████████████████████████████████████████████▏ | 9413/9741 [00:20<00:00, 490.69it/s] 97%|██████████████████████████████████████████████████▌ | 9463/9741 [00:20<00:00, 491.89it/s] 98%|██████████████████████████████████████████████████▊ | 9513/9741 [00:20<00:00, 489.41it/s] 98%|███████████████████████████████████████████████████ | 9563/9741 [00:21<00:00, 491.19it/s] 99%|███████████████████████████████████████████████████▎| 9613/9741 [00:21<00:00, 491.67it/s] 99%|███████████████████████████████████████████████████▌| 9663/9741 [00:21<00:00, 492.49it/s]100%|███████████████████████████████████████████████████▊| 9713/9741 [00:21<00:00, 491.56it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:21<00:00, 455.55it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.92s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.43s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.57s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.43s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.88s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.34s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.50s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.45s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.28s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.44s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.92s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.97s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.83s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.99s/it]
[2023-08-22 08:04:22,946] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 08:04:36,131] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 08:04:36,132] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 08:04:36,134] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 08:04:36,134] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 08:04:36,134] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 08:04:36,134] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 08:04:36,135] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 08:04:36,135] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 08:04:36,135] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 08:04:36,135] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 08:04:36,135] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 08:04:36,135] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f25d9afafd0>
[2023-08-22 08:04:36,135] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 08:04:36,136] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f25d92732b0>
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 08:04:36,137] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 08:04:36,138] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5741739273071289 seconds
Loading extension module utils...
Time to load utils op: 0.604973554611206 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5047781467437744 seconds
Time to load utils op: 0.6049232482910156 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: The car-rental agency charges $30/day for a car, or $190 for the first week for a rental that lasts an entire week or longer. Jennie rented a car for 11 days. How much, in dollars, did she pay for the rental?
Output: 310

Input: A hurricane is approaching the southern coast of Texas, and a rancher is planning to move 400 head of cattle 60 miles to higher ground to protect them from possible inland flooding that might occur.  His animal transport truck holds 20 head of cattle.  Traveling at 60 miles per hour, what is the total driving time, in hours, it will take to transport all of his cattle to higher ground?
Output: 40

Input: Jason has a carriage house that he rents out.  He’s charging $50.00 per day or $500.00 for 14 days.  Eric wants to rent the house for 20 days.  How much will it cost him?
Output: 800

Input: Melissa works on a poultry farm. She drives to town twice each month to buy supplies. If it takes her 3 hours to drive to town and back, how many hours does Melissa spend driving in a year?
Output: 72

Input: The ratio of boys to girls in a family is 5:7. The total number of children in the family is 180. If the boys are given $3900 to share, how much money does each boy receive?
Output: 52

Input: Josephine receives a bill from the hospital for 5000$.  50 percent of the bill is for medication.  25 percent of the remaining bill is for overnight stays, and 175$ is for food.  The rest of the bill is for the ambulance ride.  How much did the ambulance ride cost?
Output: 1700

Input: It was time for Kelly to harvest her carrots that she had planted in three different beds.  In the first bed she pulled out 55 carrots.  In the second bed she pulled out 101 carrots and in the third bed she pulled out 78 carrots.  She found that 6 carrots weighed one pound.  How many pounds of carrots did Kelly harvest?
Output: 39

Input: Iris’ family is planning a surprise birthday party for her. The party will include her 3 uncles and 4 aunts who have a son and daughter each as well as her brother and mother. In total, how many people are coming to Iris’ birthday party?
Output: 23

Input: Lyra bought a pair of shoes at a 20% discount.  If she paid $480, how much was the original price of the pair of shoes?
Output: 600

Input: Rhett has been late on two of his monthly rent payments, but his landlord does not charge late fees and so he will be able to pay their total cost with 3/5 of his next month's salary after taxes. If he is currently paid $5000 per month and has to pay 10% tax, calculate his rent expense per month?
Output: 1350

Input: Ten friends decide to get an end-of-year gift for their teacher. They plan to split the cost of the gift equally. But four of the group drop out. The remaining friends split the cost equally among themselves. If each share is now $8 more, how much does the gift cost, in dollars?
Output: 120

Input: At the feline sanctuary, there were 12 lions, 14 tigers, and several cougars.  If there were half as many cougars as lions and tigers combined, then what was the total number of big cats at the feline sanctuary?
Output: 39

Input: A pea patch is twice as big as a radish patch. If one sixth of the pea patch is 5 square feet.  How much is a whole radish patch in square feet?
Output: 15

Input: Phoebe has two pizzas to share with her and three friends. One has pepperoni and the other has cheese. They both have 16 slices. They all eat the same amount. One friend eats only pepperoni, while the rest have an equal number of slices of each. At the end, there is one slice of pepperoni left and 7 slices of cheese, how many slices does each person eat?
Output: 6

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o14-tgsm8k-s30-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:41<34:14, 41.92s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:23<33:12, 41.50s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:04<32:25, 41.39s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:45<31:36, 41.24s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:26<30:56, 41.26s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:07<30:11, 41.17s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:48<29:24, 41.04s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:12<24:58, 35.68s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:54<25:39, 37.54s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:35<25:44, 38.62s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:01<22:43, 34.95s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:43<23:18, 36.80s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:24<23:35, 38.25s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:05<23:23, 38.99s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:45<23:00, 39.43s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:26<22:35, 39.87s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:07<22:04, 40.13s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:31<18:49, 35.29s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:12<19:08, 37.05s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:54<19:18, 38.60s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:35<19:01, 39.36s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:16<18:34, 39.80s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:58<18:07, 40.28s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:39<17:34, 40.58s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:20<17:00, 40.82s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [17:02<16:24, 41.03s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:43<15:42, 40.98s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:23<14:59, 40.88s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [19:04<14:16, 40.81s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:45<13:36, 40.84s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:25<12:54, 40.78s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [21:07<12:16, 40.92s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:48<11:35, 40.93s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [22:29<10:56, 41.06s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [23:10<10:16, 41.11s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [23:51<09:33, 40.98s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [24:32<08:52, 40.99s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [25:06<07:45, 38.80s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [25:47<07:16, 39.69s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [26:28<06:40, 40.09s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [27:10<06:04, 40.55s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [27:52<05:27, 40.93s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [28:33<04:47, 41.07s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [29:15<04:06, 41.13s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [29:56<03:25, 41.08s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [30:19<02:23, 35.94s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [31:01<01:52, 37.54s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [31:42<01:17, 38.71s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [32:24<00:39, 39.51s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:04<00:00, 39.88s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [33:04<00:00, 39.70s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.5692} | avg. gen lenth: 278.744
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o15-tgsm8k-s30-rFalse --seed 30 --max-prompt-length 2048 --num-out-domain 15
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 08:37:52,412] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o15-tgsm8k-s30-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 15
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o15-tgsm8k-s30-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 31/9741 [00:00<00:31, 306.92it/s]  1%|▎                                                     | 63/9741 [00:00<00:31, 309.21it/s]  1%|▌                                                     | 95/9741 [00:00<00:31, 309.85it/s]  1%|▋                                                    | 126/9741 [00:00<00:31, 309.27it/s]  2%|▊                                                    | 157/9741 [00:00<00:31, 308.88it/s]  2%|█                                                    | 188/9741 [00:00<00:31, 308.15it/s]  2%|█▏                                                   | 219/9741 [00:00<00:31, 306.07it/s]  3%|█▎                                                   | 250/9741 [00:00<00:31, 301.53it/s]  3%|█▌                                                   | 281/9741 [00:00<00:31, 303.22it/s]  3%|█▋                                                   | 312/9741 [00:01<00:30, 304.44it/s]  4%|█▊                                                   | 343/9741 [00:01<00:30, 304.78it/s]  4%|██                                                   | 374/9741 [00:01<00:30, 305.08it/s]  4%|██▏                                                  | 405/9741 [00:01<00:30, 305.80it/s]  4%|██▎                                                  | 436/9741 [00:01<00:30, 304.32it/s]  5%|██▌                                                  | 467/9741 [00:01<00:30, 305.13it/s]  5%|██▋                                                  | 498/9741 [00:01<00:30, 305.60it/s]  5%|██▉                                                  | 529/9741 [00:01<00:30, 305.88it/s]  6%|███                                                  | 560/9741 [00:01<00:30, 302.05it/s]  6%|███▎                                                 | 598/9741 [00:01<00:28, 323.27it/s]  7%|███▌                                                 | 645/9741 [00:02<00:24, 364.49it/s]  7%|███▊                                                 | 691/9741 [00:02<00:23, 390.95it/s]  8%|████                                                 | 738/9741 [00:02<00:21, 411.82it/s]  8%|████▎                                                | 785/9741 [00:02<00:20, 427.00it/s]  9%|████▌                                                | 832/9741 [00:02<00:20, 437.76it/s]  9%|████▊                                                | 879/9741 [00:02<00:19, 446.09it/s]  9%|█████                                                | 925/9741 [00:02<00:19, 449.36it/s] 10%|█████▎                                               | 970/9741 [00:02<00:19, 440.30it/s] 10%|█████▍                                              | 1017/9741 [00:02<00:19, 446.35it/s] 11%|█████▋                                              | 1064/9741 [00:02<00:19, 452.17it/s] 11%|█████▉                                              | 1110/9741 [00:03<00:19, 453.07it/s] 12%|██████▏                                             | 1157/9741 [00:03<00:18, 455.22it/s] 12%|██████▍                                             | 1204/9741 [00:03<00:18, 457.71it/s] 13%|██████▋                                             | 1251/9741 [00:03<00:18, 459.92it/s] 13%|██████▉                                             | 1298/9741 [00:03<00:18, 461.40it/s] 14%|███████▏                                            | 1345/9741 [00:03<00:18, 459.82it/s] 14%|███████▍                                            | 1392/9741 [00:03<00:18, 460.52it/s] 15%|███████▋                                            | 1439/9741 [00:03<00:17, 461.69it/s] 15%|███████▉                                            | 1486/9741 [00:03<00:17, 460.15it/s] 16%|████████▏                                           | 1533/9741 [00:03<00:17, 457.78it/s] 16%|████████▍                                           | 1579/9741 [00:04<00:17, 456.79it/s] 17%|████████▋                                           | 1626/9741 [00:04<00:17, 458.43it/s] 17%|████████▉                                           | 1673/9741 [00:04<00:17, 460.30it/s] 18%|█████████▏                                          | 1720/9741 [00:04<00:17, 460.53it/s] 18%|█████████▍                                          | 1767/9741 [00:04<00:17, 461.49it/s] 19%|█████████▋                                          | 1814/9741 [00:04<00:18, 438.26it/s] 19%|█████████▉                                          | 1861/9741 [00:04<00:17, 445.17it/s] 20%|██████████▏                                         | 1908/9741 [00:04<00:17, 450.32it/s] 20%|██████████▍                                         | 1954/9741 [00:04<00:17, 452.77it/s] 21%|██████████▋                                         | 2000/9741 [00:05<00:17, 454.17it/s] 21%|██████████▉                                         | 2046/9741 [00:05<00:16, 453.01it/s] 21%|███████████▏                                        | 2092/9741 [00:05<00:16, 454.86it/s] 22%|███████████▍                                        | 2138/9741 [00:05<00:16, 456.04it/s] 22%|███████████▋                                        | 2185/9741 [00:05<00:16, 458.23it/s] 23%|███████████▉                                        | 2232/9741 [00:05<00:16, 459.88it/s] 23%|████████████▏                                       | 2279/9741 [00:05<00:16, 458.55it/s] 24%|████████████▍                                       | 2325/9741 [00:05<00:16, 455.73it/s] 24%|████████████▋                                       | 2371/9741 [00:05<00:16, 454.53it/s] 25%|████████████▉                                       | 2418/9741 [00:05<00:16, 456.84it/s] 25%|█████████████▏                                      | 2465/9741 [00:06<00:15, 458.43it/s] 26%|█████████████▍                                      | 2511/9741 [00:06<00:15, 453.71it/s] 26%|█████████████▋                                      | 2557/9741 [00:06<00:15, 454.77it/s] 27%|█████████████▉                                      | 2604/9741 [00:06<00:15, 458.04it/s] 27%|██████████████▏                                     | 2651/9741 [00:06<00:15, 458.88it/s] 28%|██████████████▍                                     | 2697/9741 [00:06<00:15, 454.78it/s] 28%|██████████████▋                                     | 2743/9741 [00:06<00:15, 453.16it/s] 29%|██████████████▉                                     | 2790/9741 [00:06<00:15, 455.20it/s] 29%|███████████████▏                                    | 2837/9741 [00:06<00:15, 457.25it/s] 30%|███████████████▍                                    | 2884/9741 [00:06<00:14, 458.88it/s] 30%|███████████████▋                                    | 2930/9741 [00:07<00:15, 452.45it/s] 31%|███████████████▉                                    | 2976/9741 [00:07<00:14, 452.63it/s] 31%|████████████████▏                                   | 3022/9741 [00:07<00:14, 453.21it/s] 31%|████████████████▍                                   | 3068/9741 [00:07<00:14, 452.69it/s] 32%|████████████████▌                                   | 3114/9741 [00:07<00:14, 453.13it/s] 32%|████████████████▊                                   | 3160/9741 [00:07<00:14, 452.82it/s] 33%|█████████████████                                   | 3207/9741 [00:07<00:14, 455.49it/s] 33%|█████████████████▎                                  | 3253/9741 [00:07<00:14, 453.78it/s] 34%|█████████████████▌                                  | 3299/9741 [00:07<00:14, 454.73it/s] 34%|█████████████████▊                                  | 3346/9741 [00:07<00:14, 456.59it/s] 35%|██████████████████                                  | 3392/9741 [00:08<00:13, 455.64it/s] 35%|██████████████████▎                                 | 3439/9741 [00:08<00:13, 457.56it/s] 36%|██████████████████▌                                 | 3485/9741 [00:08<00:13, 458.13it/s] 36%|██████████████████▊                                 | 3531/9741 [00:08<00:13, 451.10it/s] 37%|███████████████████                                 | 3577/9741 [00:08<00:13, 449.02it/s] 37%|███████████████████▎                                | 3622/9741 [00:08<00:13, 447.09it/s] 38%|███████████████████▌                                | 3668/9741 [00:08<00:13, 450.07it/s] 38%|███████████████████▊                                | 3715/9741 [00:08<00:13, 453.98it/s] 39%|████████████████████                                | 3762/9741 [00:08<00:13, 456.42it/s] 39%|████████████████████▎                               | 3808/9741 [00:08<00:12, 457.25it/s] 40%|████████████████████▌                               | 3854/9741 [00:09<00:12, 456.13it/s] 40%|████████████████████▊                               | 3900/9741 [00:09<00:12, 456.56it/s] 41%|█████████████████████                               | 3947/9741 [00:09<00:12, 458.14it/s] 41%|█████████████████████▎                              | 3993/9741 [00:09<00:12, 458.37it/s] 41%|█████████████████████▌                              | 4039/9741 [00:09<00:12, 456.88it/s] 42%|█████████████████████▊                              | 4085/9741 [00:09<00:12, 452.58it/s] 42%|██████████████████████                              | 4131/9741 [00:09<00:12, 446.97it/s] 43%|██████████████████████▎                             | 4177/9741 [00:09<00:12, 449.85it/s] 43%|██████████████████████▌                             | 4224/9741 [00:09<00:12, 452.87it/s] 44%|██████████████████████▊                             | 4270/9741 [00:09<00:12, 454.82it/s] 44%|███████████████████████                             | 4316/9741 [00:10<00:11, 453.71it/s] 45%|███████████████████████▎                            | 4363/9741 [00:10<00:11, 455.89it/s] 45%|███████████████████████▌                            | 4410/9741 [00:10<00:11, 457.35it/s] 46%|███████████████████████▊                            | 4457/9741 [00:10<00:11, 458.67it/s] 46%|████████████████████████                            | 4503/9741 [00:10<00:11, 458.47it/s] 47%|████████████████████████▎                           | 4549/9741 [00:10<00:12, 413.89it/s] 47%|████████████████████████▌                           | 4596/9741 [00:10<00:12, 426.66it/s] 48%|████████████████████████▊                           | 4642/9741 [00:10<00:11, 434.21it/s] 48%|█████████████████████████                           | 4688/9741 [00:10<00:11, 438.99it/s] 49%|█████████████████████████▎                          | 4734/9741 [00:11<00:11, 444.19it/s] 49%|█████████████████████████▌                          | 4779/9741 [00:11<00:15, 319.14it/s] 50%|█████████████████████████▊                          | 4825/9741 [00:11<00:13, 351.37it/s] 50%|██████████████████████████                          | 4871/9741 [00:11<00:12, 377.47it/s] 50%|██████████████████████████▎                         | 4918/9741 [00:11<00:12, 399.46it/s] 51%|██████████████████████████▍                         | 4963/9741 [00:11<00:11, 412.63it/s] 51%|██████████████████████████▋                         | 5008/9741 [00:11<00:11, 421.99it/s] 52%|██████████████████████████▉                         | 5055/9741 [00:11<00:10, 433.24it/s] 52%|███████████████████████████▏                        | 5101/9741 [00:11<00:10, 438.67it/s] 53%|███████████████████████████▍                        | 5146/9741 [00:12<00:10, 441.87it/s] 53%|███████████████████████████▋                        | 5191/9741 [00:12<00:10, 443.85it/s] 54%|███████████████████████████▉                        | 5236/9741 [00:12<00:10, 444.64it/s] 54%|████████████████████████████▏                       | 5282/9741 [00:12<00:09, 448.56it/s] 55%|████████████████████████████▍                       | 5329/9741 [00:12<00:09, 452.25it/s] 55%|████████████████████████████▋                       | 5375/9741 [00:12<00:09, 454.46it/s] 56%|████████████████████████████▉                       | 5421/9741 [00:12<00:09, 453.18it/s] 56%|█████████████████████████████▏                      | 5467/9741 [00:12<00:09, 453.19it/s] 57%|█████████████████████████████▍                      | 5514/9741 [00:12<00:09, 456.50it/s] 57%|█████████████████████████████▋                      | 5562/9741 [00:13<00:09, 462.21it/s] 58%|█████████████████████████████▉                      | 5610/9741 [00:13<00:08, 465.39it/s] 58%|██████████████████████████████▏                     | 5657/9741 [00:13<00:08, 461.91it/s] 59%|██████████████████████████████▍                     | 5705/9741 [00:13<00:08, 465.76it/s] 59%|██████████████████████████████▋                     | 5753/9741 [00:13<00:08, 468.92it/s] 60%|██████████████████████████████▉                     | 5801/9741 [00:13<00:08, 470.56it/s] 60%|███████████████████████████████▏                    | 5849/9741 [00:13<00:08, 471.78it/s] 61%|███████████████████████████████▍                    | 5897/9741 [00:13<00:08, 471.25it/s] 61%|███████████████████████████████▋                    | 5945/9741 [00:13<00:08, 471.38it/s] 62%|███████████████████████████████▉                    | 5993/9741 [00:13<00:08, 466.60it/s] 62%|████████████████████████████████▏                   | 6041/9741 [00:14<00:07, 468.95it/s] 62%|████████████████████████████████▍                   | 6088/9741 [00:14<00:07, 467.30it/s] 63%|████████████████████████████████▊                   | 6135/9741 [00:14<00:07, 467.25it/s] 63%|█████████████████████████████████                   | 6182/9741 [00:14<00:07, 466.45it/s] 64%|█████████████████████████████████▎                  | 6229/9741 [00:14<00:07, 467.48it/s] 64%|█████████████████████████████████▌                  | 6276/9741 [00:14<00:07, 465.21it/s] 65%|█████████████████████████████████▊                  | 6323/9741 [00:14<00:07, 463.32it/s] 65%|██████████████████████████████████                  | 6371/9741 [00:14<00:07, 467.29it/s] 66%|██████████████████████████████████▎                 | 6419/9741 [00:14<00:07, 469.98it/s] 66%|██████████████████████████████████▌                 | 6467/9741 [00:14<00:06, 470.48it/s] 67%|██████████████████████████████████▊                 | 6515/9741 [00:15<00:06, 471.37it/s] 67%|███████████████████████████████████                 | 6563/9741 [00:15<00:06, 469.42it/s] 68%|███████████████████████████████████▎                | 6611/9741 [00:15<00:06, 469.95it/s] 68%|███████████████████████████████████▌                | 6659/9741 [00:15<00:06, 470.30it/s] 69%|███████████████████████████████████▊                | 6707/9741 [00:15<00:06, 471.79it/s] 69%|████████████████████████████████████                | 6755/9741 [00:15<00:06, 473.47it/s] 70%|████████████████████████████████████▎               | 6803/9741 [00:15<00:06, 470.13it/s] 70%|████████████████████████████████████▌               | 6851/9741 [00:15<00:06, 468.13it/s] 71%|████████████████████████████████████▊               | 6898/9741 [00:15<00:06, 468.46it/s] 71%|█████████████████████████████████████               | 6946/9741 [00:15<00:05, 470.52it/s] 72%|█████████████████████████████████████▎              | 6994/9741 [00:16<00:05, 469.84it/s] 72%|█████████████████████████████████████▌              | 7042/9741 [00:16<00:05, 471.21it/s] 73%|█████████████████████████████████████▊              | 7090/9741 [00:16<00:05, 471.23it/s] 73%|██████████████████████████████████████              | 7138/9741 [00:16<00:05, 472.34it/s] 74%|██████████████████████████████████████▎             | 7186/9741 [00:16<00:05, 473.52it/s] 74%|██████████████████████████████████████▌             | 7234/9741 [00:16<00:05, 472.04it/s] 75%|██████████████████████████████████████▊             | 7282/9741 [00:16<00:05, 472.79it/s] 75%|███████████████████████████████████████▏            | 7330/9741 [00:16<00:05, 473.65it/s] 76%|███████████████████████████████████████▍            | 7378/9741 [00:16<00:04, 472.90it/s] 76%|███████████████████████████████████████▋            | 7426/9741 [00:16<00:04, 464.89it/s] 77%|███████████████████████████████████████▉            | 7473/9741 [00:17<00:05, 437.95it/s] 77%|████████████████████████████████████████▏           | 7520/9741 [00:17<00:04, 446.37it/s] 78%|████████████████████████████████████████▍           | 7568/9741 [00:17<00:04, 454.41it/s] 78%|████████████████████████████████████████▋           | 7616/9741 [00:17<00:04, 459.22it/s] 79%|████████████████████████████████████████▉           | 7663/9741 [00:17<00:04, 459.92it/s] 79%|█████████████████████████████████████████▏          | 7710/9741 [00:17<00:04, 460.84it/s] 80%|█████████████████████████████████████████▍          | 7758/9741 [00:17<00:04, 465.04it/s] 80%|█████████████████████████████████████████▋          | 7806/9741 [00:17<00:04, 466.84it/s] 81%|█████████████████████████████████████████▉          | 7854/9741 [00:17<00:04, 469.09it/s] 81%|██████████████████████████████████████████▏         | 7901/9741 [00:18<00:03, 467.57it/s] 82%|██████████████████████████████████████████▍         | 7949/9741 [00:18<00:03, 469.44it/s] 82%|██████████████████████████████████████████▋         | 7997/9741 [00:18<00:03, 470.29it/s] 83%|██████████████████████████████████████████▉         | 8045/9741 [00:18<00:03, 471.34it/s] 83%|███████████████████████████████████████████▏        | 8093/9741 [00:18<00:03, 472.54it/s] 84%|███████████████████████████████████████████▍        | 8141/9741 [00:18<00:03, 471.01it/s] 84%|███████████████████████████████████████████▋        | 8189/9741 [00:18<00:03, 472.35it/s] 85%|███████████████████████████████████████████▉        | 8237/9741 [00:18<00:03, 470.12it/s] 85%|████████████████████████████████████████████▏       | 8285/9741 [00:18<00:03, 468.44it/s] 86%|████████████████████████████████████████████▍       | 8333/9741 [00:18<00:02, 470.05it/s] 86%|████████████████████████████████████████████▋       | 8381/9741 [00:19<00:02, 466.74it/s] 87%|████████████████████████████████████████████▉       | 8429/9741 [00:19<00:02, 468.76it/s] 87%|█████████████████████████████████████████████▏      | 8476/9741 [00:19<00:02, 468.81it/s] 88%|█████████████████████████████████████████████▌      | 8524/9741 [00:19<00:02, 471.00it/s] 88%|█████████████████████████████████████████████▊      | 8572/9741 [00:19<00:02, 471.80it/s] 88%|██████████████████████████████████████████████      | 8620/9741 [00:19<00:02, 468.35it/s] 89%|██████████████████████████████████████████████▎     | 8667/9741 [00:19<00:02, 467.86it/s] 89%|██████████████████████████████████████████████▌     | 8715/9741 [00:19<00:02, 468.76it/s] 90%|██████████████████████████████████████████████▊     | 8763/9741 [00:19<00:02, 470.89it/s] 90%|███████████████████████████████████████████████     | 8811/9741 [00:19<00:01, 469.22it/s] 91%|███████████████████████████████████████████████▎    | 8859/9741 [00:20<00:01, 470.05it/s] 91%|███████████████████████████████████████████████▌    | 8907/9741 [00:20<00:01, 471.03it/s] 92%|███████████████████████████████████████████████▊    | 8955/9741 [00:20<00:01, 472.25it/s] 92%|████████████████████████████████████████████████    | 9003/9741 [00:20<00:01, 472.52it/s] 93%|████████████████████████████████████████████████▎   | 9051/9741 [00:20<00:01, 470.59it/s] 93%|████████████████████████████████████████████████▌   | 9099/9741 [00:20<00:01, 471.52it/s] 94%|████████████████████████████████████████████████▊   | 9147/9741 [00:20<00:01, 472.53it/s] 94%|█████████████████████████████████████████████████   | 9195/9741 [00:20<00:01, 467.32it/s] 95%|█████████████████████████████████████████████████▎  | 9243/9741 [00:20<00:01, 468.58it/s] 95%|█████████████████████████████████████████████████▌  | 9290/9741 [00:20<00:00, 466.61it/s] 96%|█████████████████████████████████████████████████▊  | 9337/9741 [00:21<00:00, 467.37it/s] 96%|██████████████████████████████████████████████████  | 9384/9741 [00:21<00:00, 466.64it/s] 97%|██████████████████████████████████████████████████▎ | 9431/9741 [00:21<00:00, 467.62it/s] 97%|██████████████████████████████████████████████████▌ | 9479/9741 [00:21<00:00, 469.67it/s] 98%|██████████████████████████████████████████████████▊ | 9526/9741 [00:21<00:00, 469.19it/s] 98%|███████████████████████████████████████████████████ | 9574/9741 [00:21<00:00, 470.06it/s] 99%|███████████████████████████████████████████████████▎| 9622/9741 [00:21<00:00, 469.17it/s] 99%|███████████████████████████████████████████████████▌| 9670/9741 [00:21<00:00, 469.74it/s]100%|███████████████████████████████████████████████████▊| 9717/9741 [00:21<00:00, 468.92it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:21<00:00, 444.29it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.85s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.73s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.57s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.59s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.98s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.46s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.53s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.48s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.44s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.57s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.89s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.07s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.05s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.19s/it]
[2023-08-22 08:39:07,824] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.84s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]
[2023-08-22 08:39:20,354] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 08:39:20,355] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f7ac0b96fd0>
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 08:39:20,356] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f7ac0a2f220>
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 08:39:20,357] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 08:39:20,357] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5752403736114502 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Time to load utils op: 0.5049190521240234 seconds
Loading extension module utils...
Time to load utils op: 0.5073986053466797 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: The car-rental agency charges $30/day for a car, or $190 for the first week for a rental that lasts an entire week or longer. Jennie rented a car for 11 days. How much, in dollars, did she pay for the rental?
Output: 310

Input: A hurricane is approaching the southern coast of Texas, and a rancher is planning to move 400 head of cattle 60 miles to higher ground to protect them from possible inland flooding that might occur.  His animal transport truck holds 20 head of cattle.  Traveling at 60 miles per hour, what is the total driving time, in hours, it will take to transport all of his cattle to higher ground?
Output: 40

Input: Jason has a carriage house that he rents out.  He’s charging $50.00 per day or $500.00 for 14 days.  Eric wants to rent the house for 20 days.  How much will it cost him?
Output: 800

Input: Melissa works on a poultry farm. She drives to town twice each month to buy supplies. If it takes her 3 hours to drive to town and back, how many hours does Melissa spend driving in a year?
Output: 72

Input: The ratio of boys to girls in a family is 5:7. The total number of children in the family is 180. If the boys are given $3900 to share, how much money does each boy receive?
Output: 52

Input: Josephine receives a bill from the hospital for 5000$.  50 percent of the bill is for medication.  25 percent of the remaining bill is for overnight stays, and 175$ is for food.  The rest of the bill is for the ambulance ride.  How much did the ambulance ride cost?
Output: 1700

Input: It was time for Kelly to harvest her carrots that she had planted in three different beds.  In the first bed she pulled out 55 carrots.  In the second bed she pulled out 101 carrots and in the third bed she pulled out 78 carrots.  She found that 6 carrots weighed one pound.  How many pounds of carrots did Kelly harvest?
Output: 39

Input: Iris’ family is planning a surprise birthday party for her. The party will include her 3 uncles and 4 aunts who have a son and daughter each as well as her brother and mother. In total, how many people are coming to Iris’ birthday party?
Output: 23

Input: Lyra bought a pair of shoes at a 20% discount.  If she paid $480, how much was the original price of the pair of shoes?
Output: 600

Input: Rhett has been late on two of his monthly rent payments, but his landlord does not charge late fees and so he will be able to pay their total cost with 3/5 of his next month's salary after taxes. If he is currently paid $5000 per month and has to pay 10% tax, calculate his rent expense per month?
Output: 1350

Input: Ten friends decide to get an end-of-year gift for their teacher. They plan to split the cost of the gift equally. But four of the group drop out. The remaining friends split the cost equally among themselves. If each share is now $8 more, how much does the gift cost, in dollars?
Output: 120

Input: At the feline sanctuary, there were 12 lions, 14 tigers, and several cougars.  If there were half as many cougars as lions and tigers combined, then what was the total number of big cats at the feline sanctuary?
Output: 39

Input: A pea patch is twice as big as a radish patch. If one sixth of the pea patch is 5 square feet.  How much is a whole radish patch in square feet?
Output: 15

Input: Phoebe has two pizzas to share with her and three friends. One has pepperoni and the other has cheese. They both have 16 slices. They all eat the same amount. One friend eats only pepperoni, while the rest have an equal number of slices of each. At the end, there is one slice of pepperoni left and 7 slices of cheese, how many slices does each person eat?
Output: 6

Input: Jeremy buys 30 watermelons. He eats 3 watermelons per week. Each week he gives 2 to his dad. How many weeks will the watermelons last?
Output: 6

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o15-tgsm8k-s30-rFalse
Loading extension module utils...
Time to load utils op: 0.6048252582550049 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:41<33:57, 41.58s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:21<32:26, 40.54s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:02<31:49, 40.62s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:42<31:09, 40.64s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:22<30:16, 40.36s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:02<29:31, 40.25s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:18<23:07, 32.26s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [04:58<24:17, 34.70s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:13<19:26, 28.46s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [05:53<21:26, 32.15s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [06:34<22:36, 34.79s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:15<23:13, 36.66s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [07:55<23:19, 37.83s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [08:36<23:10, 38.61s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:16<22:47, 39.08s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [09:51<21:29, 37.94s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:31<21:14, 38.61s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:13<21:04, 39.52s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [11:54<20:34, 39.84s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:25<18:41, 37.39s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [12:52<16:35, 34.32s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [13:33<16:51, 36.13s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:14<16:54, 37.56s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [14:54<16:34, 38.26s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [15:35<16:18, 39.12s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:14<15:40, 39.17s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [16:54<15:10, 39.57s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [17:35<14:34, 39.73s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:16<14:08, 40.38s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [18:57<13:27, 40.36s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:38<12:48, 40.47s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:18<12:09, 40.54s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [20:59<11:28, 40.51s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:39<10:47, 40.48s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:20<10:09, 40.65s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [22:46<08:28, 36.30s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:13<07:15, 33.48s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [23:54<07:06, 35.58s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [24:35<06:49, 37.21s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [24:52<05:11, 31.19s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [25:33<05:06, 34.10s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:14<04:49, 36.17s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [26:55<04:23, 37.60s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [27:35<03:51, 38.55s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:16<03:16, 39.32s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [28:57<02:38, 39.75s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [29:39<02:00, 40.21s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [30:19<01:20, 40.37s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [31:00<00:40, 40.53s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:41<00:00, 40.55s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:41<00:00, 38.03s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.169} | avg. gen lenth: 266.892
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o16-tgsm8k-s30-rFalse --seed 30 --max-prompt-length 2048 --num-out-domain 16
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 09:12:06,117] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o16-tgsm8k-s30-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 16
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o16-tgsm8k-s30-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 30/9741 [00:00<00:33, 293.76it/s]  1%|▎                                                     | 60/9741 [00:00<00:32, 295.03it/s]  1%|▍                                                     | 90/9741 [00:00<00:32, 295.28it/s]  1%|▋                                                    | 120/9741 [00:00<00:32, 295.91it/s]  2%|▊                                                    | 150/9741 [00:00<00:32, 295.92it/s]  2%|▉                                                    | 180/9741 [00:00<00:32, 295.80it/s]  2%|█▏                                                   | 210/9741 [00:00<00:32, 294.18it/s]  2%|█▎                                                   | 240/9741 [00:00<00:32, 290.82it/s]  3%|█▍                                                   | 270/9741 [00:00<00:32, 292.30it/s]  3%|█▋                                                   | 300/9741 [00:01<00:32, 293.53it/s]  3%|█▊                                                   | 330/9741 [00:01<00:32, 293.95it/s]  4%|█▉                                                   | 360/9741 [00:01<00:31, 293.89it/s]  4%|██                                                   | 390/9741 [00:01<00:31, 294.45it/s]  4%|██▎                                                  | 420/9741 [00:01<00:31, 294.49it/s]  5%|██▍                                                  | 450/9741 [00:01<00:31, 293.15it/s]  5%|██▌                                                  | 480/9741 [00:01<00:31, 293.66it/s]  5%|██▊                                                  | 510/9741 [00:01<00:31, 291.52it/s]  6%|██▉                                                  | 540/9741 [00:01<00:31, 292.11it/s]  6%|███                                                  | 570/9741 [00:01<00:31, 292.52it/s]  6%|███▎                                                 | 600/9741 [00:02<00:31, 293.03it/s]  6%|███▍                                                 | 630/9741 [00:02<00:31, 293.30it/s]  7%|███▌                                                 | 660/9741 [00:02<00:31, 291.65it/s]  7%|███▊                                                 | 690/9741 [00:02<00:30, 292.48it/s]  7%|███▉                                                 | 720/9741 [00:02<00:30, 292.65it/s]  8%|████                                                 | 750/9741 [00:02<00:30, 292.86it/s]  8%|████▏                                                | 780/9741 [00:02<00:30, 293.63it/s]  8%|████▍                                                | 810/9741 [00:02<00:30, 293.69it/s]  9%|████▋                                                | 851/9741 [00:02<00:27, 326.28it/s]  9%|████▉                                                | 896/9741 [00:02<00:24, 360.56it/s] 10%|█████                                                | 941/9741 [00:03<00:22, 385.73it/s] 10%|█████▎                                               | 986/9741 [00:03<00:21, 404.01it/s] 11%|█████▌                                              | 1031/9741 [00:03<00:20, 416.84it/s] 11%|█████▋                                              | 1076/9741 [00:03<00:20, 425.72it/s] 11%|█████▉                                              | 1119/9741 [00:03<00:20, 426.79it/s] 12%|██████▏                                             | 1164/9741 [00:03<00:19, 432.51it/s] 12%|██████▍                                             | 1209/9741 [00:03<00:19, 436.63it/s] 13%|██████▋                                             | 1254/9741 [00:03<00:19, 439.03it/s] 13%|██████▉                                             | 1299/9741 [00:03<00:19, 441.31it/s] 14%|███████▏                                            | 1344/9741 [00:03<00:19, 440.16it/s] 14%|███████▍                                            | 1389/9741 [00:04<00:18, 441.61it/s] 15%|███████▋                                            | 1434/9741 [00:04<00:18, 442.81it/s] 15%|███████▉                                            | 1479/9741 [00:04<00:18, 440.27it/s] 16%|████████▏                                           | 1524/9741 [00:04<00:18, 441.32it/s] 16%|████████▍                                           | 1569/9741 [00:04<00:18, 440.43it/s] 17%|████████▌                                           | 1614/9741 [00:04<00:18, 441.46it/s] 17%|████████▊                                           | 1659/9741 [00:04<00:18, 442.95it/s] 17%|█████████                                           | 1704/9741 [00:04<00:18, 443.64it/s] 18%|█████████▎                                          | 1749/9741 [00:04<00:17, 444.06it/s] 18%|█████████▌                                          | 1794/9741 [00:05<00:18, 421.93it/s] 19%|█████████▊                                          | 1839/9741 [00:05<00:18, 427.54it/s] 19%|██████████                                          | 1884/9741 [00:05<00:18, 432.43it/s] 20%|██████████▎                                         | 1929/9741 [00:05<00:17, 436.12it/s] 20%|██████████▌                                         | 1974/9741 [00:05<00:17, 438.71it/s] 21%|██████████▊                                         | 2018/9741 [00:05<00:17, 438.90it/s] 21%|███████████                                         | 2063/9741 [00:05<00:17, 440.65it/s] 22%|███████████▎                                        | 2108/9741 [00:05<00:17, 439.94it/s] 22%|███████████▍                                        | 2153/9741 [00:05<00:17, 441.14it/s] 23%|███████████▋                                        | 2198/9741 [00:05<00:17, 441.76it/s] 23%|███████████▉                                        | 2243/9741 [00:06<00:17, 440.15it/s] 23%|████████████▏                                       | 2288/9741 [00:06<00:16, 441.50it/s] 24%|████████████▍                                       | 2333/9741 [00:06<00:16, 441.74it/s] 24%|████████████▋                                       | 2378/9741 [00:06<00:16, 442.84it/s] 25%|████████████▉                                       | 2423/9741 [00:06<00:16, 443.66it/s] 25%|█████████████▏                                      | 2468/9741 [00:06<00:16, 444.15it/s] 26%|█████████████▍                                      | 2513/9741 [00:06<00:16, 441.56it/s] 26%|█████████████▋                                      | 2558/9741 [00:06<00:16, 441.22it/s] 27%|█████████████▉                                      | 2603/9741 [00:06<00:16, 442.47it/s] 27%|██████████████▏                                     | 2648/9741 [00:06<00:16, 442.31it/s] 28%|██████████████▍                                     | 2693/9741 [00:07<00:16, 437.52it/s] 28%|██████████████▌                                     | 2737/9741 [00:07<00:16, 437.03it/s] 29%|██████████████▊                                     | 2782/9741 [00:07<00:15, 438.71it/s] 29%|███████████████                                     | 2827/9741 [00:07<00:15, 440.00it/s] 29%|███████████████▎                                    | 2872/9741 [00:07<00:15, 441.56it/s] 30%|███████████████▌                                    | 2917/9741 [00:07<00:15, 442.34it/s] 30%|███████████████▊                                    | 2962/9741 [00:07<00:15, 440.09it/s] 31%|████████████████                                    | 3007/9741 [00:07<00:15, 441.51it/s] 31%|████████████████▎                                   | 3052/9741 [00:07<00:15, 441.84it/s] 32%|████████████████▌                                   | 3097/9741 [00:07<00:15, 442.09it/s] 32%|████████████████▊                                   | 3142/9741 [00:08<00:14, 442.61it/s] 33%|█████████████████                                   | 3187/9741 [00:08<00:14, 441.10it/s] 33%|█████████████████▎                                  | 3232/9741 [00:08<00:14, 437.64it/s] 34%|█████████████████▍                                  | 3277/9741 [00:08<00:14, 439.56it/s] 34%|█████████████████▋                                  | 3322/9741 [00:08<00:14, 441.05it/s] 35%|█████████████████▉                                  | 3367/9741 [00:08<00:14, 441.43it/s] 35%|██████████████████▏                                 | 3412/9741 [00:08<00:14, 439.98it/s] 35%|██████████████████▍                                 | 3457/9741 [00:08<00:14, 440.91it/s] 36%|██████████████████▋                                 | 3502/9741 [00:08<00:14, 441.62it/s] 36%|██████████████████▉                                 | 3547/9741 [00:08<00:13, 442.50it/s] 37%|███████████████████▏                                | 3592/9741 [00:09<00:13, 442.60it/s] 37%|███████████████████▍                                | 3637/9741 [00:09<00:13, 441.01it/s] 38%|███████████████████▋                                | 3682/9741 [00:09<00:13, 441.68it/s] 38%|███████████████████▉                                | 3727/9741 [00:09<00:13, 442.64it/s] 39%|████████████████████▏                               | 3772/9741 [00:09<00:13, 442.89it/s] 39%|████████████████████▍                               | 3817/9741 [00:09<00:13, 439.21it/s] 40%|████████████████████▌                               | 3861/9741 [00:09<00:13, 436.73it/s] 40%|████████████████████▊                               | 3906/9741 [00:09<00:13, 438.44it/s] 41%|█████████████████████                               | 3951/9741 [00:09<00:13, 439.53it/s] 41%|█████████████████████▎                              | 3996/9741 [00:09<00:13, 440.61it/s] 41%|█████████████████████▌                              | 4041/9741 [00:10<00:12, 441.45it/s] 42%|█████████████████████▊                              | 4086/9741 [00:10<00:12, 440.13it/s] 42%|██████████████████████                              | 4131/9741 [00:10<00:12, 441.05it/s] 43%|██████████████████████▎                             | 4176/9741 [00:10<00:12, 441.22it/s] 43%|██████████████████████▌                             | 4221/9741 [00:10<00:12, 441.37it/s] 44%|██████████████████████▊                             | 4266/9741 [00:10<00:12, 441.98it/s] 44%|███████████████████████                             | 4311/9741 [00:10<00:12, 440.43it/s] 45%|███████████████████████▎                            | 4356/9741 [00:10<00:12, 441.31it/s] 45%|███████████████████████▍                            | 4401/9741 [00:10<00:12, 442.13it/s] 46%|███████████████████████▋                            | 4446/9741 [00:11<00:11, 441.69it/s] 46%|███████████████████████▉                            | 4491/9741 [00:11<00:11, 441.66it/s] 47%|████████████████████████▏                           | 4536/9741 [00:11<00:13, 397.61it/s] 47%|████████████████████████▍                           | 4581/9741 [00:11<00:12, 410.34it/s] 47%|████████████████████████▋                           | 4626/9741 [00:11<00:12, 419.87it/s] 48%|████████████████████████▉                           | 4671/9741 [00:11<00:11, 426.17it/s] 48%|█████████████████████████▏                          | 4715/9741 [00:11<00:11, 429.89it/s] 49%|█████████████████████████▍                          | 4759/9741 [00:11<00:14, 337.78it/s] 49%|█████████████████████████▋                          | 4804/9741 [00:11<00:13, 363.50it/s] 50%|█████████████████████████▉                          | 4848/9741 [00:12<00:12, 383.19it/s] 50%|██████████████████████████                          | 4892/9741 [00:12<00:12, 396.44it/s] 51%|██████████████████████████▎                         | 4936/9741 [00:12<00:11, 407.62it/s] 51%|██████████████████████████▌                         | 4980/9741 [00:12<00:11, 414.73it/s] 52%|██████████████████████████▊                         | 5024/9741 [00:12<00:11, 421.86it/s] 52%|███████████████████████████                         | 5069/9741 [00:12<00:10, 427.27it/s] 52%|███████████████████████████▎                        | 5114/9741 [00:12<00:10, 431.46it/s] 53%|███████████████████████████▌                        | 5159/9741 [00:12<00:10, 434.48it/s] 53%|███████████████████████████▊                        | 5203/9741 [00:12<00:10, 433.51it/s] 54%|████████████████████████████                        | 5248/9741 [00:12<00:10, 435.65it/s] 54%|████████████████████████████▎                       | 5292/9741 [00:13<00:10, 436.11it/s] 55%|████████████████████████████▍                       | 5336/9741 [00:13<00:10, 437.14it/s] 55%|████████████████████████████▋                       | 5381/9741 [00:13<00:09, 438.67it/s] 56%|████████████████████████████▉                       | 5425/9741 [00:13<00:09, 436.27it/s] 56%|█████████████████████████████▏                      | 5470/9741 [00:13<00:09, 437.80it/s] 57%|█████████████████████████████▍                      | 5516/9741 [00:13<00:09, 443.59it/s] 57%|█████████████████████████████▋                      | 5562/9741 [00:13<00:09, 448.37it/s] 58%|█████████████████████████████▉                      | 5608/9741 [00:13<00:09, 450.59it/s] 58%|██████████████████████████████▏                     | 5654/9741 [00:13<00:09, 448.63it/s] 59%|██████████████████████████████▍                     | 5700/9741 [00:13<00:08, 451.36it/s] 59%|██████████████████████████████▋                     | 5746/9741 [00:14<00:08, 453.27it/s] 59%|██████████████████████████████▉                     | 5792/9741 [00:14<00:08, 454.75it/s] 60%|███████████████████████████████▏                    | 5838/9741 [00:14<00:08, 455.64it/s] 60%|███████████████████████████████▍                    | 5884/9741 [00:14<00:08, 454.07it/s] 61%|███████████████████████████████▋                    | 5930/9741 [00:14<00:08, 454.82it/s] 61%|███████████████████████████████▉                    | 5976/9741 [00:14<00:08, 455.29it/s] 62%|████████████████████████████████▏                   | 6022/9741 [00:14<00:08, 455.51it/s] 62%|████████████████████████████████▍                   | 6068/9741 [00:14<00:08, 455.91it/s] 63%|████████████████████████████████▋                   | 6114/9741 [00:14<00:07, 454.37it/s] 63%|████████████████████████████████▉                   | 6160/9741 [00:14<00:07, 455.31it/s] 64%|█████████████████████████████████▏                  | 6206/9741 [00:15<00:07, 456.21it/s] 64%|█████████████████████████████████▎                  | 6252/9741 [00:15<00:07, 455.70it/s] 65%|█████████████████████████████████▌                  | 6298/9741 [00:15<00:07, 456.08it/s] 65%|█████████████████████████████████▊                  | 6344/9741 [00:15<00:07, 453.42it/s] 66%|██████████████████████████████████                  | 6390/9741 [00:15<00:07, 454.76it/s] 66%|██████████████████████████████████▎                 | 6436/9741 [00:15<00:07, 454.86it/s] 67%|██████████████████████████████████▌                 | 6482/9741 [00:15<00:07, 455.25it/s] 67%|██████████████████████████████████▊                 | 6528/9741 [00:15<00:07, 455.25it/s] 67%|███████████████████████████████████                 | 6574/9741 [00:15<00:06, 453.81it/s] 68%|███████████████████████████████████▎                | 6620/9741 [00:16<00:06, 455.05it/s] 68%|███████████████████████████████████▌                | 6666/9741 [00:16<00:06, 456.33it/s] 69%|███████████████████████████████████▊                | 6712/9741 [00:16<00:06, 456.56it/s] 69%|████████████████████████████████████                | 6758/9741 [00:16<00:06, 457.00it/s] 70%|████████████████████████████████████▎               | 6804/9741 [00:16<00:06, 454.52it/s] 70%|████████████████████████████████████▌               | 6850/9741 [00:16<00:06, 455.28it/s] 71%|████████████████████████████████████▊               | 6896/9741 [00:16<00:06, 455.36it/s] 71%|█████████████████████████████████████               | 6942/9741 [00:16<00:06, 455.73it/s] 72%|█████████████████████████████████████▎              | 6988/9741 [00:16<00:06, 454.24it/s] 72%|█████████████████████████████████████▌              | 7034/9741 [00:16<00:05, 454.84it/s] 73%|█████████████████████████████████████▊              | 7080/9741 [00:17<00:05, 455.88it/s] 73%|██████████████████████████████████████              | 7126/9741 [00:17<00:05, 456.46it/s] 74%|██████████████████████████████████████▎             | 7172/9741 [00:17<00:05, 457.11it/s] 74%|██████████████████████████████████████▌             | 7218/9741 [00:17<00:05, 454.63it/s] 75%|██████████████████████████████████████▊             | 7264/9741 [00:17<00:05, 455.13it/s] 75%|███████████████████████████████████████             | 7310/9741 [00:17<00:05, 455.57it/s] 76%|███████████████████████████████████████▎            | 7356/9741 [00:17<00:05, 455.66it/s] 76%|███████████████████████████████████████▌            | 7402/9741 [00:17<00:05, 456.36it/s] 76%|███████████████████████████████████████▊            | 7448/9741 [00:17<00:05, 427.61it/s] 77%|████████████████████████████████████████            | 7494/9741 [00:17<00:05, 435.72it/s] 77%|████████████████████████████████████████▎           | 7540/9741 [00:18<00:04, 441.67it/s] 78%|████████████████████████████████████████▍           | 7586/9741 [00:18<00:04, 446.03it/s] 78%|████████████████████████████████████████▋           | 7632/9741 [00:18<00:04, 448.76it/s] 79%|████████████████████████████████████████▉           | 7677/9741 [00:18<00:04, 448.50it/s] 79%|█████████████████████████████████████████▏          | 7723/9741 [00:18<00:04, 451.41it/s] 80%|█████████████████████████████████████████▍          | 7769/9741 [00:18<00:04, 453.13it/s] 80%|█████████████████████████████████████████▋          | 7815/9741 [00:18<00:04, 454.20it/s] 81%|█████████████████████████████████████████▉          | 7861/9741 [00:18<00:04, 455.07it/s] 81%|██████████████████████████████████████████▏         | 7907/9741 [00:18<00:04, 453.45it/s] 82%|██████████████████████████████████████████▍         | 7953/9741 [00:18<00:03, 452.71it/s] 82%|██████████████████████████████████████████▋         | 7999/9741 [00:19<00:03, 453.95it/s] 83%|██████████████████████████████████████████▉         | 8045/9741 [00:19<00:03, 455.02it/s] 83%|███████████████████████████████████████████▏        | 8091/9741 [00:19<00:03, 455.87it/s] 84%|███████████████████████████████████████████▍        | 8137/9741 [00:19<00:03, 454.99it/s] 84%|███████████████████████████████████████████▋        | 8183/9741 [00:19<00:03, 455.19it/s] 84%|███████████████████████████████████████████▉        | 8229/9741 [00:19<00:03, 455.57it/s] 85%|████████████████████████████████████████████▏       | 8275/9741 [00:19<00:03, 456.07it/s] 85%|████████████████████████████████████████████▍       | 8321/9741 [00:19<00:03, 456.29it/s] 86%|████████████████████████████████████████████▋       | 8367/9741 [00:19<00:03, 454.87it/s] 86%|████████████████████████████████████████████▉       | 8413/9741 [00:19<00:02, 455.73it/s] 87%|█████████████████████████████████████████████▏      | 8459/9741 [00:20<00:02, 455.68it/s] 87%|█████████████████████████████████████████████▍      | 8505/9741 [00:20<00:02, 456.35it/s] 88%|█████████████████████████████████████████████▋      | 8551/9741 [00:20<00:02, 456.48it/s] 88%|█████████████████████████████████████████████▉      | 8597/9741 [00:20<00:02, 454.65it/s] 89%|██████████████████████████████████████████████▏     | 8643/9741 [00:20<00:02, 454.57it/s] 89%|██████████████████████████████████████████████▍     | 8689/9741 [00:20<00:02, 455.01it/s] 90%|██████████████████████████████████████████████▋     | 8735/9741 [00:20<00:02, 451.22it/s] 90%|██████████████████████████████████████████████▉     | 8781/9741 [00:20<00:02, 452.33it/s] 91%|███████████████████████████████████████████████     | 8827/9741 [00:20<00:02, 451.51it/s] 91%|███████████████████████████████████████████████▎    | 8873/9741 [00:20<00:01, 452.63it/s] 92%|███████████████████████████████████████████████▌    | 8919/9741 [00:21<00:01, 453.26it/s] 92%|███████████████████████████████████████████████▊    | 8965/9741 [00:21<00:01, 453.93it/s] 93%|████████████████████████████████████████████████    | 9011/9741 [00:21<00:01, 454.36it/s] 93%|████████████████████████████████████████████████▎   | 9057/9741 [00:21<00:01, 452.43it/s] 93%|████████████████████████████████████████████████▌   | 9103/9741 [00:21<00:01, 453.16it/s] 94%|████████████████████████████████████████████████▊   | 9149/9741 [00:21<00:01, 454.13it/s] 94%|█████████████████████████████████████████████████   | 9195/9741 [00:21<00:01, 454.84it/s] 95%|█████████████████████████████████████████████████▎  | 9241/9741 [00:21<00:01, 454.76it/s] 95%|█████████████████████████████████████████████████▌  | 9287/9741 [00:21<00:01, 453.22it/s] 96%|█████████████████████████████████████████████████▊  | 9333/9741 [00:21<00:00, 454.69it/s] 96%|██████████████████████████████████████████████████  | 9379/9741 [00:22<00:00, 455.42it/s] 97%|██████████████████████████████████████████████████▎ | 9425/9741 [00:22<00:00, 455.86it/s] 97%|██████████████████████████████████████████████████▌ | 9471/9741 [00:22<00:00, 455.98it/s] 98%|██████████████████████████████████████████████████▊ | 9517/9741 [00:22<00:00, 450.31it/s] 98%|███████████████████████████████████████████████████ | 9563/9741 [00:22<00:00, 452.05it/s] 99%|███████████████████████████████████████████████████▎| 9609/9741 [00:22<00:00, 453.24it/s] 99%|███████████████████████████████████████████████████▌| 9655/9741 [00:22<00:00, 454.02it/s]100%|███████████████████████████████████████████████████▊| 9701/9741 [00:22<00:00, 454.59it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:22<00:00, 425.46it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.98s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.88s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.36s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.31s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.27s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.29s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.46s/it]
[2023-08-22 09:13:20,043] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.93s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.65s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
[2023-08-22 09:13:28,720] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 09:13:28,721] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fc65ae4ffd0>
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 09:13:28,721] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fc659660220>
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 09:13:28,722] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 09:13:28,722] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5009572505950928 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: The car-rental agency charges $30/day for a car, or $190 for the first week for a rental that lasts an entire week or longer. Jennie rented a car for 11 days. How much, in dollars, did she pay for the rental?
Output: 310

Input: A hurricane is approaching the southern coast of Texas, and a rancher is planning to move 400 head of cattle 60 miles to higher ground to protect them from possible inland flooding that might occur.  His animal transport truck holds 20 head of cattle.  Traveling at 60 miles per hour, what is the total driving time, in hours, it will take to transport all of his cattle to higher ground?
Output: 40

Input: Jason has a carriage house that he rents out.  He’s charging $50.00 per day or $500.00 for 14 days.  Eric wants to rent the house for 20 days.  How much will it cost him?
Output: 800

Input: Melissa works on a poultry farm. She drives to town twice each month to buy supplies. If it takes her 3 hours to drive to town and back, how many hours does Melissa spend driving in a year?
Output: 72

Input: The ratio of boys to girls in a family is 5:7. The total number of children in the family is 180. If the boys are given $3900 to share, how much money does each boy receive?
Output: 52

Input: Josephine receives a bill from the hospital for 5000$.  50 percent of the bill is for medication.  25 percent of the remaining bill is for overnight stays, and 175$ is for food.  The rest of the bill is for the ambulance ride.  How much did the ambulance ride cost?
Output: 1700

Input: It was time for Kelly to harvest her carrots that she had planted in three different beds.  In the first bed she pulled out 55 carrots.  In the second bed she pulled out 101 carrots and in the third bed she pulled out 78 carrots.  She found that 6 carrots weighed one pound.  How many pounds of carrots did Kelly harvest?
Output: 39

Input: Iris’ family is planning a surprise birthday party for her. The party will include her 3 uncles and 4 aunts who have a son and daughter each as well as her brother and mother. In total, how many people are coming to Iris’ birthday party?
Output: 23

Input: Lyra bought a pair of shoes at a 20% discount.  If she paid $480, how much was the original price of the pair of shoes?
Output: 600

Input: Rhett has been late on two of his monthly rent payments, but his landlord does not charge late fees and so he will be able to pay their total cost with 3/5 of his next month's salary after taxes. If he is currently paid $5000 per month and has to pay 10% tax, calculate his rent expense per month?
Output: 1350

Input: Ten friends decide to get an end-of-year gift for their teacher. They plan to split the cost of the gift equally. But four of the group drop out. The remaining friends split the cost equally among themselves. If each share is now $8 more, how much does the gift cost, in dollars?
Output: 120

Input: At the feline sanctuary, there were 12 lions, 14 tigers, and several cougars.  If there were half as many cougars as lions and tigers combined, then what was the total number of big cats at the feline sanctuary?
Output: 39

Input: A pea patch is twice as big as a radish patch. If one sixth of the pea patch is 5 square feet.  How much is a whole radish patch in square feet?
Output: 15

Input: Phoebe has two pizzas to share with her and three friends. One has pepperoni and the other has cheese. They both have 16 slices. They all eat the same amount. One friend eats only pepperoni, while the rest have an equal number of slices of each. At the end, there is one slice of pepperoni left and 7 slices of cheese, how many slices does each person eat?
Output: 6

Input: Jeremy buys 30 watermelons. He eats 3 watermelons per week. Each week he gives 2 to his dad. How many weeks will the watermelons last?
Output: 6

Input: Jackson has 5 times more money than Williams. Together, they have $150. How much money, in dollars, does Jackson have?
Output: 125

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o16-tgsm8k-s30-rFalse
Loading extension module utils...
Time to load utils op: 0.40448713302612305 seconds
Loading extension module utils...
Time to load utils op: 0.504528284072876 seconds
Loading extension module utils...
Time to load utils op: 0.4043135643005371 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:40<33:17, 40.76s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:20<32:10, 40.23s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:00<31:29, 40.21s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:40<30:42, 40.06s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:20<29:59, 39.99s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:00<29:19, 39.98s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:40<28:42, 40.05s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:20<28:01, 40.05s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:00<27:18, 39.96s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:40<26:41, 40.03s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:14<24:48, 38.17s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:54<24:30, 38.69s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:34<24:05, 39.07s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:14<23:39, 39.42s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:54<23:08, 39.66s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:34<22:32, 39.78s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:05<20:19, 36.97s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:39<19:13, 36.04s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:19<19:15, 37.28s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:46<17:05, 34.18s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:26<17:23, 35.98s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [13:49<14:57, 32.05s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:29<15:33, 34.58s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:10<15:48, 36.46s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [15:50<15:38, 37.55s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:31<15:20, 38.36s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:09<14:45, 38.51s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [17:49<14:15, 38.87s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:29<13:44, 39.28s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:10<13:11, 39.57s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:50<12:34, 39.73s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:30<11:56, 39.82s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [20:58<10:16, 36.25s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:32<09:29, 35.57s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:12<09:16, 37.08s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [22:52<08:51, 37.99s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:33<08:24, 38.82s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [24:14<07:51, 39.33s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [24:55<07:18, 39.85s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [25:35<06:39, 39.98s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [26:15<06:00, 40.08s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:55<05:20, 40.09s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [27:36<04:41, 40.21s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [28:16<04:01, 40.18s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:56<03:20, 40.14s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [29:36<02:40, 40.10s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [30:12<01:56, 38.93s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [30:53<01:18, 39.39s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [31:33<00:39, 39.76s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [32:14<00:00, 39.94s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [32:14<00:00, 38.69s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.5626} | avg. gen lenth: 269.216
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o17-tgsm8k-s30-rFalse --seed 30 --max-prompt-length 2048 --num-out-domain 17
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 09:46:04,590] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o17-tgsm8k-s30-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 17
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o17-tgsm8k-s30-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 29/9741 [00:00<00:34, 283.09it/s]  1%|▎                                                     | 58/9741 [00:00<00:34, 284.23it/s]  1%|▍                                                     | 87/9741 [00:00<00:33, 284.16it/s]  1%|▋                                                    | 116/9741 [00:00<00:33, 284.66it/s]  1%|▊                                                    | 145/9741 [00:00<00:33, 284.76it/s]  2%|▉                                                    | 174/9741 [00:00<00:33, 284.86it/s]  2%|█                                                    | 203/9741 [00:00<00:34, 278.35it/s]  2%|█▎                                                   | 232/9741 [00:00<00:33, 280.02it/s]  3%|█▍                                                   | 261/9741 [00:00<00:33, 281.20it/s]  3%|█▌                                                   | 290/9741 [00:01<00:33, 282.09it/s]  3%|█▋                                                   | 319/9741 [00:01<00:33, 282.88it/s]  4%|█▉                                                   | 348/9741 [00:01<00:33, 283.32it/s]  4%|██                                                   | 377/9741 [00:01<00:33, 283.34it/s]  4%|██▏                                                  | 406/9741 [00:01<00:32, 283.41it/s]  4%|██▎                                                  | 435/9741 [00:01<00:33, 281.62it/s]  5%|██▌                                                  | 464/9741 [00:01<00:32, 282.49it/s]  5%|██▋                                                  | 493/9741 [00:01<00:33, 279.70it/s]  5%|██▊                                                  | 522/9741 [00:01<00:32, 280.62it/s]  6%|██▉                                                  | 551/9741 [00:01<00:32, 281.47it/s]  6%|███▏                                                 | 580/9741 [00:02<00:32, 281.83it/s]  6%|███▎                                                 | 609/9741 [00:02<00:32, 281.92it/s]  7%|███▍                                                 | 638/9741 [00:02<00:32, 282.17it/s]  7%|███▋                                                 | 667/9741 [00:02<00:32, 280.51it/s]  7%|███▊                                                 | 696/9741 [00:02<00:32, 282.22it/s]  8%|████                                                 | 739/9741 [00:02<00:27, 325.52it/s]  8%|████▎                                                | 782/9741 [00:02<00:25, 356.14it/s]  8%|████▍                                                | 825/9741 [00:02<00:23, 377.59it/s]  9%|████▋                                                | 868/9741 [00:02<00:22, 393.09it/s]  9%|████▉                                                | 911/9741 [00:02<00:21, 401.86it/s] 10%|█████▏                                               | 954/9741 [00:03<00:21, 410.00it/s] 10%|█████▍                                               | 997/9741 [00:03<00:21, 415.82it/s] 11%|█████▌                                              | 1040/9741 [00:03<00:20, 419.78it/s] 11%|█████▊                                              | 1083/9741 [00:03<00:20, 422.65it/s] 12%|██████                                              | 1126/9741 [00:03<00:20, 422.20it/s] 12%|██████▏                                             | 1169/9741 [00:03<00:20, 423.87it/s] 12%|██████▍                                             | 1212/9741 [00:03<00:20, 425.06it/s] 13%|██████▋                                             | 1255/9741 [00:03<00:19, 426.38it/s] 13%|██████▉                                             | 1298/9741 [00:03<00:19, 426.30it/s] 14%|███████▏                                            | 1341/9741 [00:03<00:19, 424.87it/s] 14%|███████▍                                            | 1384/9741 [00:04<00:19, 425.37it/s] 15%|███████▌                                            | 1427/9741 [00:04<00:19, 422.28it/s] 15%|███████▊                                            | 1470/9741 [00:04<00:19, 422.26it/s] 16%|████████                                            | 1513/9741 [00:04<00:19, 422.91it/s] 16%|████████▎                                           | 1556/9741 [00:04<00:19, 421.09it/s] 16%|████████▌                                           | 1599/9741 [00:04<00:19, 419.16it/s] 17%|████████▊                                           | 1642/9741 [00:04<00:19, 421.75it/s] 17%|████████▉                                           | 1685/9741 [00:04<00:19, 423.03it/s] 18%|█████████▏                                          | 1728/9741 [00:04<00:18, 424.30it/s] 18%|█████████▍                                          | 1771/9741 [00:04<00:18, 424.69it/s] 19%|█████████▋                                          | 1814/9741 [00:05<00:19, 401.64it/s] 19%|█████████▉                                          | 1857/9741 [00:05<00:19, 408.76it/s] 20%|██████████▏                                         | 1900/9741 [00:05<00:18, 413.44it/s] 20%|██████████▎                                         | 1943/9741 [00:05<00:18, 416.62it/s] 20%|██████████▌                                         | 1986/9741 [00:05<00:18, 419.25it/s] 21%|██████████▊                                         | 2029/9741 [00:05<00:18, 414.85it/s] 21%|███████████                                         | 2072/9741 [00:05<00:18, 417.61it/s] 22%|███████████▎                                        | 2115/9741 [00:05<00:18, 419.53it/s] 22%|███████████▌                                        | 2158/9741 [00:05<00:18, 420.60it/s] 23%|███████████▋                                        | 2201/9741 [00:06<00:17, 422.23it/s] 23%|███████████▉                                        | 2244/9741 [00:06<00:17, 420.65it/s] 23%|████████████▏                                       | 2287/9741 [00:06<00:17, 422.53it/s] 24%|████████████▍                                       | 2330/9741 [00:06<00:17, 423.35it/s] 24%|████████████▋                                       | 2373/9741 [00:06<00:17, 424.02it/s] 25%|████████████▉                                       | 2416/9741 [00:06<00:17, 424.96it/s] 25%|█████████████▏                                      | 2459/9741 [00:06<00:17, 424.81it/s] 26%|█████████████▎                                      | 2502/9741 [00:06<00:17, 422.74it/s] 26%|█████████████▌                                      | 2545/9741 [00:06<00:17, 422.59it/s] 27%|█████████████▊                                      | 2588/9741 [00:06<00:17, 419.35it/s] 27%|██████████████                                      | 2631/9741 [00:07<00:16, 421.01it/s] 27%|██████████████▎                                     | 2674/9741 [00:07<00:16, 421.98it/s] 28%|██████████████▌                                     | 2717/9741 [00:07<00:16, 419.20it/s] 28%|██████████████▋                                     | 2760/9741 [00:07<00:16, 420.92it/s] 29%|██████████████▉                                     | 2803/9741 [00:07<00:16, 421.79it/s] 29%|███████████████▏                                    | 2846/9741 [00:07<00:16, 422.53it/s] 30%|███████████████▍                                    | 2889/9741 [00:07<00:16, 423.75it/s] 30%|███████████████▋                                    | 2932/9741 [00:07<00:16, 422.04it/s] 31%|███████████████▉                                    | 2975/9741 [00:07<00:16, 422.48it/s] 31%|████████████████                                    | 3018/9741 [00:07<00:15, 423.41it/s] 31%|████████████████▎                                   | 3061/9741 [00:08<00:15, 423.79it/s] 32%|████████████████▌                                   | 3104/9741 [00:08<00:15, 424.14it/s] 32%|████████████████▊                                   | 3147/9741 [00:08<00:15, 422.00it/s] 33%|█████████████████                                   | 3190/9741 [00:08<00:15, 420.76it/s] 33%|█████████████████▎                                  | 3233/9741 [00:08<00:15, 421.65it/s] 34%|█████████████████▍                                  | 3276/9741 [00:08<00:15, 421.95it/s] 34%|█████████████████▋                                  | 3319/9741 [00:08<00:15, 422.23it/s] 35%|█████████████████▉                                  | 3362/9741 [00:08<00:15, 422.57it/s] 35%|██████████████████▏                                 | 3405/9741 [00:08<00:15, 420.85it/s] 35%|██████████████████▍                                 | 3448/9741 [00:08<00:14, 421.71it/s] 36%|██████████████████▋                                 | 3491/9741 [00:09<00:14, 422.50it/s] 36%|██████████████████▊                                 | 3534/9741 [00:09<00:14, 422.57it/s] 37%|███████████████████                                 | 3577/9741 [00:09<00:14, 423.17it/s] 37%|███████████████████▎                                | 3620/9741 [00:09<00:14, 421.17it/s] 38%|███████████████████▌                                | 3663/9741 [00:09<00:14, 420.16it/s] 38%|███████████████████▊                                | 3706/9741 [00:09<00:14, 422.04it/s] 38%|████████████████████                                | 3749/9741 [00:09<00:14, 423.18it/s] 39%|████████████████████▏                               | 3792/9741 [00:09<00:14, 423.58it/s] 39%|████████████████████▍                               | 3835/9741 [00:09<00:14, 421.68it/s] 40%|████████████████████▋                               | 3878/9741 [00:10<00:13, 422.70it/s] 40%|████████████████████▉                               | 3921/9741 [00:10<00:13, 423.46it/s] 41%|█████████████████████▏                              | 3964/9741 [00:10<00:13, 423.74it/s] 41%|█████████████████████▍                              | 4007/9741 [00:10<00:13, 423.54it/s] 42%|█████████████████████▌                              | 4050/9741 [00:10<00:13, 423.75it/s] 42%|█████████████████████▊                              | 4093/9741 [00:10<00:13, 421.41it/s] 42%|██████████████████████                              | 4136/9741 [00:10<00:13, 421.77it/s] 43%|██████████████████████▎                             | 4179/9741 [00:10<00:13, 422.21it/s] 43%|██████████████████████▌                             | 4222/9741 [00:10<00:13, 422.11it/s] 44%|██████████████████████▊                             | 4265/9741 [00:10<00:12, 422.50it/s] 44%|██████████████████████▉                             | 4308/9741 [00:11<00:12, 420.75it/s] 45%|███████████████████████▏                            | 4351/9741 [00:11<00:12, 421.61it/s] 45%|███████████████████████▍                            | 4394/9741 [00:11<00:12, 421.80it/s] 46%|███████████████████████▋                            | 4437/9741 [00:11<00:12, 421.81it/s] 46%|███████████████████████▉                            | 4480/9741 [00:11<00:12, 422.31it/s] 46%|████████████████████████▏                           | 4523/9741 [00:11<00:13, 388.05it/s] 47%|████████████████████████▎                           | 4566/9741 [00:11<00:13, 397.97it/s] 47%|████████████████████████▌                           | 4609/9741 [00:11<00:12, 405.54it/s] 48%|████████████████████████▊                           | 4652/9741 [00:11<00:12, 410.47it/s] 48%|█████████████████████████                           | 4695/9741 [00:11<00:12, 413.95it/s] 49%|█████████████████████████▎                          | 4738/9741 [00:12<00:12, 416.77it/s] 49%|█████████████████████████▌                          | 4780/9741 [00:12<00:16, 300.23it/s] 50%|█████████████████████████▋                          | 4823/9741 [00:12<00:14, 329.07it/s] 50%|█████████████████████████▉                          | 4866/9741 [00:12<00:13, 352.53it/s] 50%|██████████████████████████▏                         | 4909/9741 [00:12<00:13, 371.30it/s] 51%|██████████████████████████▍                         | 4951/9741 [00:12<00:12, 383.85it/s] 51%|██████████████████████████▋                         | 4994/9741 [00:12<00:12, 395.25it/s] 52%|██████████████████████████▉                         | 5037/9741 [00:12<00:11, 403.46it/s] 52%|███████████████████████████                         | 5080/9741 [00:13<00:11, 408.91it/s] 53%|███████████████████████████▎                        | 5123/9741 [00:13<00:11, 413.15it/s] 53%|███████████████████████████▌                        | 5166/9741 [00:13<00:10, 416.07it/s] 53%|███████████████████████████▊                        | 5208/9741 [00:13<00:10, 413.95it/s] 54%|████████████████████████████                        | 5251/9741 [00:13<00:10, 416.46it/s] 54%|████████████████████████████▎                       | 5294/9741 [00:13<00:10, 418.32it/s] 55%|████████████████████████████▍                       | 5337/9741 [00:13<00:10, 419.44it/s] 55%|████████████████████████████▋                       | 5380/9741 [00:13<00:10, 420.50it/s] 56%|████████████████████████████▉                       | 5423/9741 [00:13<00:10, 418.39it/s] 56%|█████████████████████████████▏                      | 5466/9741 [00:13<00:10, 419.65it/s] 57%|█████████████████████████████▍                      | 5510/9741 [00:14<00:09, 424.01it/s] 57%|█████████████████████████████▋                      | 5554/9741 [00:14<00:09, 428.24it/s] 57%|█████████████████████████████▉                      | 5598/9741 [00:14<00:09, 429.98it/s] 58%|██████████████████████████████                      | 5642/9741 [00:14<00:09, 429.78it/s] 58%|██████████████████████████████▎                     | 5686/9741 [00:14<00:09, 432.19it/s] 59%|██████████████████████████████▌                     | 5730/9741 [00:14<00:09, 434.19it/s] 59%|██████████████████████████████▊                     | 5774/9741 [00:14<00:09, 434.98it/s] 60%|███████████████████████████████                     | 5818/9741 [00:14<00:08, 435.92it/s] 60%|███████████████████████████████▎                    | 5862/9741 [00:14<00:08, 434.04it/s] 61%|███████████████████████████████▌                    | 5906/9741 [00:14<00:08, 435.30it/s] 61%|███████████████████████████████▊                    | 5950/9741 [00:15<00:08, 434.72it/s] 62%|███████████████████████████████▉                    | 5994/9741 [00:15<00:08, 435.21it/s] 62%|████████████████████████████████▏                   | 6038/9741 [00:15<00:08, 436.17it/s] 62%|████████████████████████████████▍                   | 6082/9741 [00:15<00:08, 434.67it/s] 63%|████████████████████████████████▋                   | 6126/9741 [00:15<00:08, 435.10it/s] 63%|████████████████████████████████▉                   | 6170/9741 [00:15<00:08, 434.82it/s] 64%|█████████████████████████████████▏                  | 6214/9741 [00:15<00:08, 435.91it/s] 64%|█████████████████████████████████▍                  | 6258/9741 [00:15<00:07, 436.22it/s] 65%|█████████████████████████████████▋                  | 6302/9741 [00:15<00:07, 436.76it/s] 65%|█████████████████████████████████▉                  | 6346/9741 [00:15<00:07, 434.77it/s] 66%|██████████████████████████████████                  | 6390/9741 [00:16<00:07, 436.02it/s] 66%|██████████████████████████████████▎                 | 6434/9741 [00:16<00:07, 436.72it/s] 67%|██████████████████████████████████▌                 | 6478/9741 [00:16<00:07, 436.26it/s] 67%|██████████████████████████████████▊                 | 6522/9741 [00:16<00:07, 436.36it/s] 67%|███████████████████████████████████                 | 6566/9741 [00:16<00:07, 434.51it/s] 68%|███████████████████████████████████▎                | 6610/9741 [00:16<00:07, 435.28it/s] 68%|███████████████████████████████████▌                | 6654/9741 [00:16<00:07, 435.69it/s] 69%|███████████████████████████████████▊                | 6698/9741 [00:16<00:07, 434.45it/s] 69%|███████████████████████████████████▉                | 6742/9741 [00:16<00:06, 435.97it/s] 70%|████████████████████████████████████▏               | 6786/9741 [00:16<00:06, 434.78it/s] 70%|████████████████████████████████████▍               | 6830/9741 [00:17<00:06, 435.46it/s] 71%|████████████████████████████████████▋               | 6874/9741 [00:17<00:06, 436.14it/s] 71%|████████████████████████████████████▉               | 6918/9741 [00:17<00:06, 436.89it/s] 71%|█████████████████████████████████████▏              | 6962/9741 [00:17<00:06, 437.13it/s] 72%|█████████████████████████████████████▍              | 7006/9741 [00:17<00:06, 434.14it/s] 72%|█████████████████████████████████████▋              | 7050/9741 [00:17<00:06, 435.35it/s] 73%|█████████████████████████████████████▊              | 7094/9741 [00:17<00:06, 436.38it/s] 73%|██████████████████████████████████████              | 7138/9741 [00:17<00:05, 437.04it/s] 74%|██████████████████████████████████████▎             | 7182/9741 [00:17<00:05, 437.13it/s] 74%|██████████████████████████████████████▌             | 7226/9741 [00:17<00:05, 435.04it/s] 75%|██████████████████████████████████████▊             | 7270/9741 [00:18<00:05, 436.18it/s] 75%|███████████████████████████████████████             | 7314/9741 [00:18<00:05, 436.72it/s] 76%|███████████████████████████████████████▎            | 7358/9741 [00:18<00:05, 436.86it/s] 76%|███████████████████████████████████████▌            | 7402/9741 [00:18<00:05, 437.55it/s] 76%|███████████████████████████████████████▋            | 7446/9741 [00:18<00:05, 404.88it/s] 77%|███████████████████████████████████████▉            | 7490/9741 [00:18<00:05, 414.21it/s] 77%|████████████████████████████████████████▏           | 7534/9741 [00:18<00:05, 420.23it/s] 78%|████████████████████████████████████████▍           | 7578/9741 [00:18<00:05, 425.67it/s] 78%|████████████████████████████████████████▋           | 7622/9741 [00:18<00:04, 429.44it/s] 79%|████████████████████████████████████████▉           | 7666/9741 [00:19<00:04, 431.79it/s] 79%|█████████████████████████████████████████▏          | 7710/9741 [00:19<00:04, 431.06it/s] 80%|█████████████████████████████████████████▍          | 7755/9741 [00:19<00:04, 433.72it/s] 80%|█████████████████████████████████████████▋          | 7799/9741 [00:19<00:04, 435.12it/s] 81%|█████████████████████████████████████████▊          | 7843/9741 [00:19<00:04, 435.89it/s] 81%|██████████████████████████████████████████          | 7887/9741 [00:19<00:04, 436.39it/s] 81%|██████████████████████████████████████████▎         | 7931/9741 [00:19<00:04, 434.52it/s] 82%|██████████████████████████████████████████▌         | 7975/9741 [00:19<00:04, 435.53it/s] 82%|██████████████████████████████████████████▊         | 8019/9741 [00:19<00:03, 436.56it/s] 83%|███████████████████████████████████████████         | 8063/9741 [00:19<00:03, 435.91it/s] 83%|███████████████████████████████████████████▎        | 8107/9741 [00:20<00:03, 436.97it/s] 84%|███████████████████████████████████████████▌        | 8151/9741 [00:20<00:03, 431.80it/s] 84%|███████████████████████████████████████████▋        | 8195/9741 [00:20<00:03, 433.99it/s] 85%|███████████████████████████████████████████▉        | 8239/9741 [00:20<00:03, 435.55it/s] 85%|████████████████████████████████████████████▏       | 8283/9741 [00:20<00:03, 436.45it/s] 85%|████████████████████████████████████████████▍       | 8327/9741 [00:20<00:03, 436.93it/s] 86%|████████████████████████████████████████████▋       | 8371/9741 [00:20<00:03, 435.11it/s] 86%|████████████████████████████████████████████▉       | 8415/9741 [00:20<00:03, 435.86it/s] 87%|█████████████████████████████████████████████▏      | 8459/9741 [00:20<00:02, 435.22it/s] 87%|█████████████████████████████████████████████▍      | 8503/9741 [00:20<00:02, 435.67it/s] 88%|█████████████████████████████████████████████▋      | 8547/9741 [00:21<00:02, 435.99it/s] 88%|█████████████████████████████████████████████▊      | 8591/9741 [00:21<00:02, 434.00it/s] 89%|██████████████████████████████████████████████      | 8635/9741 [00:21<00:02, 433.98it/s] 89%|██████████████████████████████████████████████▎     | 8679/9741 [00:21<00:02, 434.71it/s] 90%|██████████████████████████████████████████████▌     | 8723/9741 [00:21<00:02, 435.67it/s] 90%|██████████████████████████████████████████████▊     | 8767/9741 [00:21<00:02, 436.00it/s] 90%|███████████████████████████████████████████████     | 8811/9741 [00:21<00:02, 434.04it/s] 91%|███████████████████████████████████████████████▎    | 8855/9741 [00:21<00:02, 435.37it/s] 91%|███████████████████████████████████████████████▌    | 8899/9741 [00:21<00:01, 431.90it/s] 92%|███████████████████████████████████████████████▋    | 8943/9741 [00:21<00:01, 433.77it/s] 92%|███████████████████████████████████████████████▉    | 8987/9741 [00:22<00:01, 435.16it/s] 93%|████████████████████████████████████████████████▏   | 9031/9741 [00:22<00:01, 432.40it/s] 93%|████████████████████████████████████████████████▍   | 9075/9741 [00:22<00:01, 433.69it/s] 94%|████████████████████████████████████████████████▋   | 9119/9741 [00:22<00:01, 434.63it/s] 94%|████████████████████████████████████████████████▉   | 9163/9741 [00:22<00:01, 435.68it/s] 95%|█████████████████████████████████████████████████▏  | 9207/9741 [00:22<00:01, 436.50it/s] 95%|█████████████████████████████████████████████████▍  | 9251/9741 [00:22<00:01, 436.87it/s] 95%|█████████████████████████████████████████████████▌  | 9295/9741 [00:22<00:01, 434.52it/s] 96%|█████████████████████████████████████████████████▊  | 9339/9741 [00:22<00:00, 435.42it/s] 96%|██████████████████████████████████████████████████  | 9383/9741 [00:22<00:00, 435.94it/s] 97%|██████████████████████████████████████████████████▎ | 9427/9741 [00:23<00:00, 436.26it/s] 97%|██████████████████████████████████████████████████▌ | 9471/9741 [00:23<00:00, 436.37it/s] 98%|██████████████████████████████████████████████████▊ | 9515/9741 [00:23<00:00, 434.54it/s] 98%|███████████████████████████████████████████████████ | 9559/9741 [00:23<00:00, 435.50it/s] 99%|███████████████████████████████████████████████████▎| 9603/9741 [00:23<00:00, 435.56it/s] 99%|███████████████████████████████████████████████████▍| 9647/9741 [00:23<00:00, 429.98it/s] 99%|███████████████████████████████████████████████████▋| 9691/9741 [00:23<00:00, 431.48it/s]100%|███████████████████████████████████████████████████▉| 9735/9741 [00:23<00:00, 430.35it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:23<00:00, 409.71it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.35s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.31s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.05s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.26s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.09s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.63s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.60s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.49s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
[2023-08-22 09:47:20,173] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.65s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
[2023-08-22 09:47:30,736] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 09:47:30,737] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 09:47:30,738] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 09:47:30,738] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 09:47:30,738] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 09:47:30,738] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f930ab8dfd0>
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 09:47:30,739] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f930a57d220>
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 09:47:30,740] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 09:47:30,740] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4658074378967285 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5045797824859619 seconds
Time to load utils op: 0.5048439502716064 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: The car-rental agency charges $30/day for a car, or $190 for the first week for a rental that lasts an entire week or longer. Jennie rented a car for 11 days. How much, in dollars, did she pay for the rental?
Output: 310

Input: A hurricane is approaching the southern coast of Texas, and a rancher is planning to move 400 head of cattle 60 miles to higher ground to protect them from possible inland flooding that might occur.  His animal transport truck holds 20 head of cattle.  Traveling at 60 miles per hour, what is the total driving time, in hours, it will take to transport all of his cattle to higher ground?
Output: 40

Input: Jason has a carriage house that he rents out.  He’s charging $50.00 per day or $500.00 for 14 days.  Eric wants to rent the house for 20 days.  How much will it cost him?
Output: 800

Input: Melissa works on a poultry farm. She drives to town twice each month to buy supplies. If it takes her 3 hours to drive to town and back, how many hours does Melissa spend driving in a year?
Output: 72

Input: The ratio of boys to girls in a family is 5:7. The total number of children in the family is 180. If the boys are given $3900 to share, how much money does each boy receive?
Output: 52

Input: Josephine receives a bill from the hospital for 5000$.  50 percent of the bill is for medication.  25 percent of the remaining bill is for overnight stays, and 175$ is for food.  The rest of the bill is for the ambulance ride.  How much did the ambulance ride cost?
Output: 1700

Input: It was time for Kelly to harvest her carrots that she had planted in three different beds.  In the first bed she pulled out 55 carrots.  In the second bed she pulled out 101 carrots and in the third bed she pulled out 78 carrots.  She found that 6 carrots weighed one pound.  How many pounds of carrots did Kelly harvest?
Output: 39

Input: Iris’ family is planning a surprise birthday party for her. The party will include her 3 uncles and 4 aunts who have a son and daughter each as well as her brother and mother. In total, how many people are coming to Iris’ birthday party?
Output: 23

Input: Lyra bought a pair of shoes at a 20% discount.  If she paid $480, how much was the original price of the pair of shoes?
Output: 600

Input: Rhett has been late on two of his monthly rent payments, but his landlord does not charge late fees and so he will be able to pay their total cost with 3/5 of his next month's salary after taxes. If he is currently paid $5000 per month and has to pay 10% tax, calculate his rent expense per month?
Output: 1350

Input: Ten friends decide to get an end-of-year gift for their teacher. They plan to split the cost of the gift equally. But four of the group drop out. The remaining friends split the cost equally among themselves. If each share is now $8 more, how much does the gift cost, in dollars?
Output: 120

Input: At the feline sanctuary, there were 12 lions, 14 tigers, and several cougars.  If there were half as many cougars as lions and tigers combined, then what was the total number of big cats at the feline sanctuary?
Output: 39

Input: A pea patch is twice as big as a radish patch. If one sixth of the pea patch is 5 square feet.  How much is a whole radish patch in square feet?
Output: 15

Input: Phoebe has two pizzas to share with her and three friends. One has pepperoni and the other has cheese. They both have 16 slices. They all eat the same amount. One friend eats only pepperoni, while the rest have an equal number of slices of each. At the end, there is one slice of pepperoni left and 7 slices of cheese, how many slices does each person eat?
Output: 6

Input: Jeremy buys 30 watermelons. He eats 3 watermelons per week. Each week he gives 2 to his dad. How many weeks will the watermelons last?
Output: 6

Input: Jackson has 5 times more money than Williams. Together, they have $150. How much money, in dollars, does Jackson have?
Output: 125

Input: Janet counts 30 crows on the powerlines and 60% more hawks than crows. How many birds does she count total?
Output: 78

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o17-tgsm8k-s30-rFalse
Loading extension module utils...
Time to load utils op: 0.4044911861419678 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:35<28:51, 35.34s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:15<30:32, 38.19s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:55<30:37, 39.10s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:35<30:06, 39.27s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:15<29:35, 39.45s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:55<29:06, 39.69s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:22<25:32, 35.64s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:02<25:53, 36.99s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:42<25:59, 38.03s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:22<25:47, 38.70s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:02<25:25, 39.13s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:42<24:51, 39.24s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:22<24:25, 39.60s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:02<23:49, 39.70s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:42<23:09, 39.69s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:22<22:32, 39.79s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:02<21:55, 39.86s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:42<21:16, 39.90s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:22<20:40, 40.03s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:02<19:57, 39.90s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:30<17:37, 36.46s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:11<17:32, 37.59s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:50<17:11, 38.22s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:30<16:45, 38.69s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:10<16:19, 39.19s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:51<15:52, 39.67s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:17<13:39, 35.63s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [17:57<13:28, 36.77s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:27<12:08, 34.70s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [18:59<11:17, 33.88s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:39<11:17, 35.67s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:19<11:05, 36.97s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [20:41<09:12, 32.50s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:20<09:15, 34.70s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:00<09:04, 36.27s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [22:40<08:42, 37.35s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:10<07:36, 35.13s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [23:52<07:23, 37.00s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [24:32<06:57, 37.98s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [25:12<06:25, 38.52s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [25:52<05:51, 39.11s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:32<05:14, 39.35s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [27:12<04:36, 39.48s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [27:27<03:13, 32.18s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:06<02:51, 34.36s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [28:47<02:24, 36.09s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [29:08<01:35, 31.84s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [29:31<00:57, 29.00s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [30:10<00:32, 32.19s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [30:46<00:00, 33.09s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [30:46<00:00, 36.92s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.7005} | avg. gen lenth: 272.472
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o18-tgsm8k-s30-rFalse --seed 30 --max-prompt-length 2048 --num-out-domain 18
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 10:19:13,088] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o18-tgsm8k-s30-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 18
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o18-tgsm8k-s30-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 28/9741 [00:00<00:35, 273.45it/s]  1%|▎                                                     | 56/9741 [00:00<00:35, 273.58it/s]  1%|▍                                                     | 84/9741 [00:00<00:35, 274.08it/s]  1%|▌                                                    | 112/9741 [00:00<00:35, 274.52it/s]  1%|▊                                                    | 140/9741 [00:00<00:34, 274.45it/s]  2%|▉                                                    | 168/9741 [00:00<00:34, 274.41it/s]  2%|█                                                    | 196/9741 [00:00<00:35, 270.02it/s]  2%|█▏                                                   | 224/9741 [00:00<00:35, 269.00it/s]  3%|█▎                                                   | 252/9741 [00:00<00:35, 270.54it/s]  3%|█▌                                                   | 280/9741 [00:01<00:34, 271.48it/s]  3%|█▋                                                   | 308/9741 [00:01<00:34, 272.20it/s]  3%|█▊                                                   | 336/9741 [00:01<00:34, 272.21it/s]  4%|█▉                                                   | 364/9741 [00:01<00:34, 272.32it/s]  4%|██▏                                                  | 392/9741 [00:01<00:34, 272.89it/s]  4%|██▎                                                  | 420/9741 [00:01<00:34, 272.79it/s]  5%|██▍                                                  | 448/9741 [00:01<00:34, 271.21it/s]  5%|██▌                                                  | 476/9741 [00:01<00:34, 268.91it/s]  5%|██▋                                                  | 504/9741 [00:01<00:34, 269.71it/s]  5%|██▉                                                  | 532/9741 [00:01<00:34, 270.68it/s]  6%|███                                                  | 566/9741 [00:02<00:31, 290.92it/s]  6%|███▎                                                 | 607/9741 [00:02<00:28, 325.61it/s]  7%|███▍                                                 | 642/9741 [00:02<00:27, 331.29it/s]  7%|███▋                                                 | 682/9741 [00:02<00:25, 350.35it/s]  7%|███▉                                                 | 723/9741 [00:02<00:24, 367.43it/s]  8%|████▏                                                | 765/9741 [00:02<00:23, 381.37it/s]  8%|████▍                                                | 807/9741 [00:02<00:22, 391.16it/s]  9%|████▌                                                | 847/9741 [00:02<00:23, 383.88it/s]  9%|████▊                                                | 888/9741 [00:02<00:22, 389.89it/s] 10%|█████                                                | 930/9741 [00:02<00:22, 396.86it/s] 10%|█████▎                                               | 970/9741 [00:03<00:22, 396.54it/s] 10%|█████▍                                              | 1012/9741 [00:03<00:21, 400.79it/s] 11%|█████▋                                              | 1054/9741 [00:03<00:21, 404.46it/s] 11%|█████▊                                              | 1095/9741 [00:03<00:21, 403.70it/s] 12%|██████                                              | 1136/9741 [00:03<00:21, 402.46it/s] 12%|██████▎                                             | 1178/9741 [00:03<00:21, 405.22it/s] 13%|██████▌                                             | 1220/9741 [00:03<00:20, 407.37it/s] 13%|██████▋                                             | 1262/9741 [00:03<00:20, 409.01it/s] 13%|██████▉                                             | 1304/9741 [00:03<00:20, 409.86it/s] 14%|███████▏                                            | 1345/9741 [00:03<00:20, 408.41it/s] 14%|███████▍                                            | 1387/9741 [00:04<00:20, 409.73it/s] 15%|███████▋                                            | 1429/9741 [00:04<00:20, 410.46it/s] 15%|███████▊                                            | 1471/9741 [00:04<00:20, 409.34it/s] 16%|████████                                            | 1512/9741 [00:04<00:20, 409.24it/s] 16%|████████▎                                           | 1554/9741 [00:04<00:19, 410.29it/s] 16%|████████▌                                           | 1596/9741 [00:04<00:19, 408.28it/s] 17%|████████▋                                           | 1637/9741 [00:04<00:23, 348.21it/s] 17%|████████▉                                           | 1675/9741 [00:04<00:22, 354.47it/s] 18%|█████████▏                                          | 1716/9741 [00:04<00:21, 369.44it/s] 18%|█████████▍                                          | 1758/9741 [00:05<00:20, 381.58it/s] 18%|█████████▌                                          | 1797/9741 [00:05<00:21, 368.67it/s] 19%|█████████▊                                          | 1839/9741 [00:05<00:20, 381.27it/s] 19%|██████████                                          | 1881/9741 [00:05<00:20, 390.38it/s] 20%|██████████▎                                         | 1923/9741 [00:05<00:19, 396.33it/s] 20%|██████████▍                                         | 1965/9741 [00:05<00:19, 401.22it/s] 21%|██████████▋                                         | 2006/9741 [00:05<00:19, 400.89it/s] 21%|██████████▉                                         | 2047/9741 [00:05<00:19, 401.64it/s] 21%|███████████▏                                        | 2089/9741 [00:05<00:18, 404.44it/s] 22%|███████████▍                                        | 2131/9741 [00:06<00:18, 406.74it/s] 22%|███████████▌                                        | 2173/9741 [00:06<00:18, 408.57it/s] 23%|███████████▊                                        | 2215/9741 [00:06<00:18, 409.71it/s] 23%|████████████                                        | 2256/9741 [00:06<00:18, 408.32it/s] 24%|████████████▎                                       | 2298/9741 [00:06<00:18, 409.64it/s] 24%|████████████▍                                       | 2340/9741 [00:06<00:18, 409.77it/s] 24%|████████████▋                                       | 2382/9741 [00:06<00:17, 410.56it/s] 25%|████████████▉                                       | 2424/9741 [00:06<00:17, 411.32it/s] 25%|█████████████▏                                      | 2466/9741 [00:06<00:17, 411.79it/s] 26%|█████████████▍                                      | 2508/9741 [00:06<00:17, 409.43it/s] 26%|█████████████▌                                      | 2549/9741 [00:07<00:17, 406.16it/s] 27%|█████████████▊                                      | 2591/9741 [00:07<00:17, 408.15it/s] 27%|██████████████                                      | 2633/9741 [00:07<00:17, 408.99it/s] 27%|██████████████▎                                     | 2675/9741 [00:07<00:17, 410.02it/s] 28%|██████████████▌                                     | 2717/9741 [00:07<00:17, 407.46it/s] 28%|██████████████▋                                     | 2759/9741 [00:07<00:17, 408.54it/s] 29%|██████████████▉                                     | 2801/9741 [00:07<00:16, 409.38it/s] 29%|███████████████▏                                    | 2843/9741 [00:07<00:16, 410.17it/s] 30%|███████████████▍                                    | 2885/9741 [00:07<00:16, 410.60it/s] 30%|███████████████▋                                    | 2927/9741 [00:07<00:16, 408.77it/s] 30%|███████████████▊                                    | 2969/9741 [00:08<00:16, 409.74it/s] 31%|████████████████                                    | 3011/9741 [00:08<00:16, 410.48it/s] 31%|████████████████▎                                   | 3053/9741 [00:08<00:16, 410.29it/s] 32%|████████████████▌                                   | 3095/9741 [00:08<00:16, 407.88it/s] 32%|████████████████▋                                   | 3137/9741 [00:08<00:16, 408.92it/s] 33%|████████████████▉                                   | 3178/9741 [00:08<00:16, 407.29it/s] 33%|█████████████████▏                                  | 3220/9741 [00:08<00:15, 408.48it/s] 33%|█████████████████▍                                  | 3262/9741 [00:08<00:15, 409.86it/s] 34%|█████████████████▋                                  | 3304/9741 [00:08<00:15, 410.10it/s] 34%|█████████████████▊                                  | 3346/9741 [00:08<00:15, 410.46it/s] 35%|██████████████████                                  | 3388/9741 [00:09<00:15, 408.56it/s] 35%|██████████████████▎                                 | 3430/9741 [00:09<00:15, 409.03it/s] 36%|██████████████████▌                                 | 3471/9741 [00:09<00:15, 409.18it/s] 36%|██████████████████▋                                 | 3512/9741 [00:09<00:15, 409.00it/s] 36%|██████████████████▉                                 | 3554/9741 [00:09<00:15, 409.72it/s] 37%|███████████████████▏                                | 3595/9741 [00:09<00:15, 409.29it/s] 37%|███████████████████▍                                | 3636/9741 [00:09<00:14, 407.53it/s] 38%|███████████████████▋                                | 3678/9741 [00:09<00:14, 408.59it/s] 38%|███████████████████▊                                | 3720/9741 [00:09<00:14, 409.41it/s] 39%|████████████████████                                | 3762/9741 [00:09<00:14, 410.01it/s] 39%|████████████████████▎                               | 3804/9741 [00:10<00:14, 409.12it/s] 39%|████████████████████▌                               | 3845/9741 [00:10<00:14, 407.63it/s] 40%|████████████████████▋                               | 3887/9741 [00:10<00:14, 408.66it/s] 40%|████████████████████▉                               | 3929/9741 [00:10<00:14, 409.49it/s] 41%|█████████████████████▏                              | 3971/9741 [00:10<00:14, 410.21it/s] 41%|█████████████████████▍                              | 4013/9741 [00:10<00:13, 410.49it/s] 42%|█████████████████████▋                              | 4055/9741 [00:10<00:13, 410.57it/s] 42%|█████████████████████▊                              | 4097/9741 [00:10<00:13, 408.57it/s] 42%|██████████████████████                              | 4138/9741 [00:10<00:13, 408.88it/s] 43%|██████████████████████▎                             | 4179/9741 [00:11<00:13, 408.79it/s] 43%|██████████████████████▌                             | 4221/9741 [00:11<00:13, 409.42it/s] 44%|██████████████████████▊                             | 4263/9741 [00:11<00:13, 409.98it/s] 44%|██████████████████████▉                             | 4304/9741 [00:11<00:13, 408.44it/s] 45%|███████████████████████▏                            | 4346/9741 [00:11<00:13, 409.26it/s] 45%|███████████████████████▍                            | 4388/9741 [00:11<00:13, 409.84it/s] 45%|███████████████████████▋                            | 4429/9741 [00:11<00:12, 409.87it/s] 46%|███████████████████████▊                            | 4471/9741 [00:11<00:12, 410.10it/s] 46%|████████████████████████                            | 4513/9741 [00:11<00:13, 376.44it/s] 47%|████████████████████████▎                           | 4554/9741 [00:11<00:13, 385.65it/s] 47%|████████████████████████▌                           | 4596/9741 [00:12<00:13, 392.95it/s] 48%|████████████████████████▊                           | 4638/9741 [00:12<00:12, 398.19it/s] 48%|████████████████████████▉                           | 4680/9741 [00:12<00:12, 401.99it/s] 48%|█████████████████████████▏                          | 4722/9741 [00:12<00:12, 404.62it/s] 49%|█████████████████████████▍                          | 4763/9741 [00:12<00:17, 282.45it/s] 49%|█████████████████████████▋                          | 4805/9741 [00:12<00:15, 311.79it/s] 50%|█████████████████████████▊                          | 4847/9741 [00:12<00:14, 336.28it/s] 50%|██████████████████████████                          | 4889/9741 [00:12<00:13, 355.72it/s] 51%|██████████████████████████▎                         | 4931/9741 [00:13<00:12, 370.60it/s] 51%|██████████████████████████▌                         | 4972/9741 [00:13<00:12, 379.90it/s] 51%|██████████████████████████▊                         | 5014/9741 [00:13<00:12, 388.61it/s] 52%|██████████████████████████▉                         | 5056/9741 [00:13<00:11, 394.91it/s] 52%|███████████████████████████▏                        | 5097/9741 [00:13<00:11, 397.14it/s] 53%|███████████████████████████▍                        | 5139/9741 [00:13<00:11, 401.51it/s] 53%|███████████████████████████▋                        | 5180/9741 [00:13<00:11, 402.25it/s] 54%|███████████████████████████▊                        | 5221/9741 [00:13<00:11, 404.38it/s] 54%|████████████████████████████                        | 5263/9741 [00:13<00:11, 406.09it/s] 54%|████████████████████████████▎                       | 5305/9741 [00:13<00:10, 407.32it/s] 55%|████████████████████████████▌                       | 5346/9741 [00:14<00:10, 407.87it/s] 55%|████████████████████████████▊                       | 5388/9741 [00:14<00:10, 408.90it/s] 56%|████████████████████████████▉                       | 5429/9741 [00:14<00:10, 406.90it/s] 56%|█████████████████████████████▏                      | 5470/9741 [00:14<00:10, 407.48it/s] 57%|█████████████████████████████▍                      | 5513/9741 [00:14<00:10, 412.21it/s] 57%|█████████████████████████████▋                      | 5556/9741 [00:14<00:10, 416.03it/s] 57%|█████████████████████████████▉                      | 5599/9741 [00:14<00:09, 417.58it/s] 58%|██████████████████████████████                      | 5641/9741 [00:14<00:09, 416.89it/s] 58%|██████████████████████████████▎                     | 5684/9741 [00:14<00:09, 419.40it/s] 59%|██████████████████████████████▌                     | 5727/9741 [00:14<00:09, 421.02it/s] 59%|██████████████████████████████▊                     | 5770/9741 [00:15<00:09, 420.79it/s] 60%|███████████████████████████████                     | 5813/9741 [00:15<00:09, 421.58it/s] 60%|███████████████████████████████▎                    | 5856/9741 [00:15<00:09, 419.81it/s] 61%|███████████████████████████████▍                    | 5899/9741 [00:15<00:09, 420.63it/s] 61%|███████████████████████████████▋                    | 5942/9741 [00:15<00:09, 421.57it/s] 61%|███████████████████████████████▉                    | 5985/9741 [00:15<00:08, 422.15it/s] 62%|████████████████████████████████▏                   | 6028/9741 [00:15<00:08, 422.36it/s] 62%|████████████████████████████████▍                   | 6071/9741 [00:15<00:08, 423.23it/s] 63%|████████████████████████████████▋                   | 6114/9741 [00:15<00:08, 421.29it/s] 63%|████████████████████████████████▊                   | 6157/9741 [00:15<00:08, 421.48it/s] 64%|█████████████████████████████████                   | 6200/9741 [00:16<00:08, 422.43it/s] 64%|█████████████████████████████████▎                  | 6243/9741 [00:16<00:08, 422.44it/s] 65%|█████████████████████████████████▌                  | 6286/9741 [00:16<00:08, 422.92it/s] 65%|█████████████████████████████████▊                  | 6329/9741 [00:16<00:08, 420.85it/s] 65%|██████████████████████████████████                  | 6372/9741 [00:16<00:07, 422.06it/s] 66%|██████████████████████████████████▏                 | 6415/9741 [00:16<00:07, 422.77it/s] 66%|██████████████████████████████████▍                 | 6458/9741 [00:16<00:07, 422.98it/s] 67%|██████████████████████████████████▋                 | 6501/9741 [00:16<00:07, 421.66it/s] 67%|██████████████████████████████████▉                 | 6544/9741 [00:16<00:07, 419.37it/s] 68%|███████████████████████████████████▏                | 6586/9741 [00:16<00:07, 419.54it/s] 68%|███████████████████████████████████▍                | 6629/9741 [00:17<00:07, 420.76it/s] 68%|███████████████████████████████████▌                | 6672/9741 [00:17<00:07, 421.68it/s] 69%|███████████████████████████████████▊                | 6715/9741 [00:17<00:07, 422.05it/s] 69%|████████████████████████████████████                | 6758/9741 [00:17<00:07, 422.77it/s] 70%|████████████████████████████████████▎               | 6801/9741 [00:17<00:06, 420.86it/s] 70%|████████████████████████████████████▌               | 6844/9741 [00:17<00:06, 421.82it/s] 71%|████████████████████████████████████▊               | 6887/9741 [00:17<00:06, 422.49it/s] 71%|████████████████████████████████████▉               | 6930/9741 [00:17<00:06, 422.97it/s] 72%|█████████████████████████████████████▏              | 6973/9741 [00:17<00:06, 423.08it/s] 72%|█████████████████████████████████████▍              | 7016/9741 [00:18<00:06, 420.87it/s] 72%|█████████████████████████████████████▋              | 7059/9741 [00:18<00:06, 421.94it/s] 73%|█████████████████████████████████████▉              | 7102/9741 [00:18<00:06, 422.27it/s] 73%|██████████████████████████████████████▏             | 7145/9741 [00:18<00:06, 422.58it/s] 74%|██████████████████████████████████████▎             | 7188/9741 [00:18<00:06, 422.86it/s] 74%|██████████████████████████████████████▌             | 7231/9741 [00:18<00:06, 406.18it/s] 75%|██████████████████████████████████████▊             | 7274/9741 [00:18<00:05, 411.58it/s] 75%|███████████████████████████████████████             | 7317/9741 [00:18<00:05, 415.02it/s] 76%|███████████████████████████████████████▎            | 7360/9741 [00:18<00:05, 418.00it/s] 76%|███████████████████████████████████████▌            | 7403/9741 [00:18<00:05, 420.04it/s] 76%|███████████████████████████████████████▋            | 7446/9741 [00:19<00:05, 394.05it/s] 77%|███████████████████████████████████████▉            | 7489/9741 [00:19<00:05, 402.63it/s] 77%|████████████████████████████████████████▏           | 7532/9741 [00:19<00:05, 407.90it/s] 78%|████████████████████████████████████████▍           | 7575/9741 [00:19<00:05, 412.44it/s] 78%|████████████████████████████████████████▋           | 7618/9741 [00:19<00:05, 415.81it/s] 79%|████████████████████████████████████████▉           | 7661/9741 [00:19<00:04, 417.26it/s] 79%|█████████████████████████████████████████           | 7703/9741 [00:19<00:04, 416.93it/s] 80%|█████████████████████████████████████████▎          | 7746/9741 [00:19<00:04, 419.35it/s] 80%|█████████████████████████████████████████▌          | 7789/9741 [00:19<00:04, 420.44it/s] 80%|█████████████████████████████████████████▊          | 7832/9741 [00:19<00:04, 421.78it/s] 81%|██████████████████████████████████████████          | 7875/9741 [00:20<00:04, 422.14it/s] 81%|██████████████████████████████████████████▎         | 7918/9741 [00:20<00:04, 416.88it/s] 82%|██████████████████████████████████████████▍         | 7961/9741 [00:20<00:04, 418.95it/s] 82%|██████████████████████████████████████████▋         | 8004/9741 [00:20<00:04, 420.36it/s] 83%|██████████████████████████████████████████▉         | 8047/9741 [00:20<00:04, 420.97it/s] 83%|███████████████████████████████████████████▏        | 8090/9741 [00:20<00:03, 422.16it/s] 83%|███████████████████████████████████████████▍        | 8133/9741 [00:20<00:03, 421.10it/s] 84%|███████████████████████████████████████████▋        | 8176/9741 [00:20<00:03, 422.01it/s] 84%|███████████████████████████████████████████▉        | 8219/9741 [00:20<00:03, 422.66it/s] 85%|████████████████████████████████████████████        | 8262/9741 [00:20<00:03, 423.42it/s] 85%|████████████████████████████████████████████▎       | 8305/9741 [00:21<00:03, 423.06it/s] 86%|████████████████████████████████████████████▌       | 8348/9741 [00:21<00:03, 420.91it/s] 86%|████████████████████████████████████████████▊       | 8391/9741 [00:21<00:03, 421.35it/s] 87%|█████████████████████████████████████████████       | 8434/9741 [00:21<00:03, 422.38it/s] 87%|█████████████████████████████████████████████▎      | 8477/9741 [00:21<00:02, 422.27it/s] 87%|█████████████████████████████████████████████▍      | 8520/9741 [00:21<00:02, 422.77it/s] 88%|█████████████████████████████████████████████▋      | 8563/9741 [00:21<00:02, 422.60it/s] 88%|█████████████████████████████████████████████▉      | 8606/9741 [00:21<00:02, 420.40it/s] 89%|██████████████████████████████████████████████▏     | 8649/9741 [00:21<00:02, 417.27it/s] 89%|██████████████████████████████████████████████▍     | 8692/9741 [00:22<00:02, 418.94it/s] 90%|██████████████████████████████████████████████▋     | 8735/9741 [00:22<00:02, 419.64it/s] 90%|██████████████████████████████████████████████▊     | 8778/9741 [00:22<00:02, 420.36it/s] 91%|███████████████████████████████████████████████     | 8821/9741 [00:22<00:02, 418.76it/s] 91%|███████████████████████████████████████████████▎    | 8864/9741 [00:22<00:02, 420.18it/s] 91%|███████████████████████████████████████████████▌    | 8907/9741 [00:22<00:01, 421.36it/s] 92%|███████████████████████████████████████████████▊    | 8950/9741 [00:22<00:01, 422.42it/s] 92%|████████████████████████████████████████████████    | 8993/9741 [00:22<00:01, 422.43it/s] 93%|████████████████████████████████████████████████▏   | 9036/9741 [00:22<00:01, 420.41it/s] 93%|████████████████████████████████████████████████▍   | 9079/9741 [00:22<00:01, 421.20it/s] 94%|████████████████████████████████████████████████▋   | 9122/9741 [00:23<00:01, 421.50it/s] 94%|████████████████████████████████████████████████▉   | 9165/9741 [00:23<00:01, 421.87it/s] 95%|█████████████████████████████████████████████████▏  | 9208/9741 [00:23<00:01, 422.44it/s] 95%|█████████████████████████████████████████████████▍  | 9251/9741 [00:23<00:01, 422.22it/s] 95%|█████████████████████████████████████████████████▌  | 9294/9741 [00:23<00:01, 420.38it/s] 96%|█████████████████████████████████████████████████▊  | 9337/9741 [00:23<00:00, 417.43it/s] 96%|██████████████████████████████████████████████████  | 9380/9741 [00:23<00:00, 418.90it/s] 97%|██████████████████████████████████████████████████▎ | 9423/9741 [00:23<00:00, 419.62it/s] 97%|██████████████████████████████████████████████████▌ | 9466/9741 [00:23<00:00, 420.36it/s] 98%|██████████████████████████████████████████████████▊ | 9509/9741 [00:23<00:00, 418.27it/s] 98%|██████████████████████████████████████████████████▉ | 9551/9741 [00:24<00:00, 350.11it/s] 98%|███████████████████████████████████████████████████▏| 9588/9741 [00:24<00:00, 327.04it/s] 99%|███████████████████████████████████████████████████▎| 9623/9741 [00:24<00:00, 311.76it/s] 99%|███████████████████████████████████████████████████▌| 9656/9741 [00:24<00:00, 301.79it/s] 99%|███████████████████████████████████████████████████▋| 9687/9741 [00:24<00:00, 294.94it/s]100%|███████████████████████████████████████████████████▊| 9717/9741 [00:24<00:00, 288.27it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:24<00:00, 392.61it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.41s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:07<00:15,  7.62s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.17s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.35s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.34s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.62s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]
Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:13<00:06,  6.81s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
[2023-08-22 10:20:30,777] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.85s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.99s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:19<00:00,  6.31s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:19<00:00,  6.52s/it]
[2023-08-22 10:20:50,908] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 10:20:50,909] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 10:20:50,910] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 10:20:50,910] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 10:20:50,910] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 10:20:50,910] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 10:20:50,910] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 10:20:50,910] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fefab625fd0>
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 10:20:50,911] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fefab4bc220>
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 10:20:50,912] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 10:20:50,912] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5294017791748047 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: The car-rental agency charges $30/day for a car, or $190 for the first week for a rental that lasts an entire week or longer. Jennie rented a car for 11 days. How much, in dollars, did she pay for the rental?
Output: 310

Input: A hurricane is approaching the southern coast of Texas, and a rancher is planning to move 400 head of cattle 60 miles to higher ground to protect them from possible inland flooding that might occur.  His animal transport truck holds 20 head of cattle.  Traveling at 60 miles per hour, what is the total driving time, in hours, it will take to transport all of his cattle to higher ground?
Output: 40

Input: Jason has a carriage house that he rents out.  He’s charging $50.00 per day or $500.00 for 14 days.  Eric wants to rent the house for 20 days.  How much will it cost him?
Output: 800

Input: Melissa works on a poultry farm. She drives to town twice each month to buy supplies. If it takes her 3 hours to drive to town and back, how many hours does Melissa spend driving in a year?
Output: 72

Input: The ratio of boys to girls in a family is 5:7. The total number of children in the family is 180. If the boys are given $3900 to share, how much money does each boy receive?
Output: 52

Input: Josephine receives a bill from the hospital for 5000$.  50 percent of the bill is for medication.  25 percent of the remaining bill is for overnight stays, and 175$ is for food.  The rest of the bill is for the ambulance ride.  How much did the ambulance ride cost?
Output: 1700

Input: It was time for Kelly to harvest her carrots that she had planted in three different beds.  In the first bed she pulled out 55 carrots.  In the second bed she pulled out 101 carrots and in the third bed she pulled out 78 carrots.  She found that 6 carrots weighed one pound.  How many pounds of carrots did Kelly harvest?
Output: 39

Input: Iris’ family is planning a surprise birthday party for her. The party will include her 3 uncles and 4 aunts who have a son and daughter each as well as her brother and mother. In total, how many people are coming to Iris’ birthday party?
Output: 23

Input: Lyra bought a pair of shoes at a 20% discount.  If she paid $480, how much was the original price of the pair of shoes?
Output: 600

Input: Rhett has been late on two of his monthly rent payments, but his landlord does not charge late fees and so he will be able to pay their total cost with 3/5 of his next month's salary after taxes. If he is currently paid $5000 per month and has to pay 10% tax, calculate his rent expense per month?
Output: 1350

Input: Ten friends decide to get an end-of-year gift for their teacher. They plan to split the cost of the gift equally. But four of the group drop out. The remaining friends split the cost equally among themselves. If each share is now $8 more, how much does the gift cost, in dollars?
Output: 120

Input: At the feline sanctuary, there were 12 lions, 14 tigers, and several cougars.  If there were half as many cougars as lions and tigers combined, then what was the total number of big cats at the feline sanctuary?
Output: 39

Input: A pea patch is twice as big as a radish patch. If one sixth of the pea patch is 5 square feet.  How much is a whole radish patch in square feet?
Output: 15

Input: Phoebe has two pizzas to share with her and three friends. One has pepperoni and the other has cheese. They both have 16 slices. They all eat the same amount. One friend eats only pepperoni, while the rest have an equal number of slices of each. At the end, there is one slice of pepperoni left and 7 slices of cheese, how many slices does each person eat?
Output: 6

Input: Jeremy buys 30 watermelons. He eats 3 watermelons per week. Each week he gives 2 to his dad. How many weeks will the watermelons last?
Output: 6

Input: Jackson has 5 times more money than Williams. Together, they have $150. How much money, in dollars, does Jackson have?
Output: 125

Input: Janet counts 30 crows on the powerlines and 60% more hawks than crows. How many birds does she count total?
Output: 78

Input: There are 290 liters of oil in 24 cans. If 10 of the cans are holding 8 liters each, how much oil is each of the remaining cans holding?
Output: 15

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o18-tgsm8k-s30-rFalse
Loading extension module utils...
Time to load utils op: 0.5046734809875488 seconds
Loading extension module utils...
Time to load utils op: 0.6048085689544678 seconds
Loading extension module utils...
Time to load utils op: 0.6047384738922119 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:40<33:25, 40.94s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:20<32:10, 40.22s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:00<31:26, 40.14s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:40<30:42, 40.05s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:19<29:48, 39.75s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:59<29:08, 39.74s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:41<29:02, 40.53s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:24<28:46, 41.10s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:10<29:10, 42.70s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:49<27:49, 41.74s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:29<26:46, 41.18s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:09<25:51, 40.82s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:49<25:01, 40.58s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:29<24:10, 40.30s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:09<23:23, 40.11s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:48<22:37, 39.94s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:28<21:55, 39.87s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:07<21:11, 39.73s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:47<20:31, 39.72s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:24<19:23, 38.78s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:03<18:49, 38.96s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:26<15:56, 34.18s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:05<16:03, 35.70s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:31<14:10, 32.69s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:04<13:37, 32.72s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:44<13:57, 34.91s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:24<13:57, 36.41s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [17:55<12:47, 34.90s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:35<12:46, 36.48s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:10<12:00, 36.01s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:50<11:44, 37.10s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:29<11:20, 37.81s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:08<10:48, 38.16s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:47<10:16, 38.51s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:03<07:56, 31.74s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [22:43<07:55, 33.99s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:22<07:43, 35.65s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [23:39<06:00, 30.01s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [24:18<05:59, 32.70s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [24:58<05:47, 34.76s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [25:37<05:25, 36.13s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:16<04:56, 37.10s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [26:56<04:26, 38.01s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [27:36<03:50, 38.45s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:11<03:07, 37.56s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [28:51<02:33, 38.26s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [29:06<01:33, 31.31s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [29:46<01:07, 33.73s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [30:13<00:31, 31.80s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [30:53<00:00, 34.24s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [30:53<00:00, 37.07s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.1299} | avg. gen lenth: 264.388
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o19-tgsm8k-s30-rFalse --seed 30 --max-prompt-length 2048 --num-out-domain 19
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 10:53:16,560] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o19-tgsm8k-s30-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 19
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o19-tgsm8k-s30-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 26/9741 [00:00<00:37, 259.84it/s]  1%|▎                                                     | 53/9741 [00:00<00:37, 260.96it/s]  1%|▍                                                     | 80/9741 [00:00<00:36, 261.33it/s]  1%|▌                                                    | 107/9741 [00:00<00:36, 261.57it/s]  1%|▋                                                    | 134/9741 [00:00<00:36, 261.42it/s]  2%|▉                                                    | 161/9741 [00:00<00:36, 261.92it/s]  2%|█                                                    | 188/9741 [00:00<00:37, 257.45it/s]  2%|█▏                                                   | 214/9741 [00:00<00:37, 256.05it/s]  2%|█▎                                                   | 241/9741 [00:00<00:36, 257.48it/s]  3%|█▍                                                   | 268/9741 [00:01<00:36, 258.47it/s]  3%|█▌                                                   | 295/9741 [00:01<00:36, 259.10it/s]  3%|█▊                                                   | 322/9741 [00:01<00:36, 259.85it/s]  4%|█▉                                                   | 349/9741 [00:01<00:36, 260.22it/s]  4%|██                                                   | 376/9741 [00:01<00:35, 260.59it/s]  4%|██▏                                                  | 403/9741 [00:01<00:35, 260.69it/s]  4%|██▎                                                  | 430/9741 [00:01<00:36, 254.70it/s]  5%|██▍                                                  | 456/9741 [00:01<00:36, 256.21it/s]  5%|██▋                                                  | 483/9741 [00:01<00:35, 257.54it/s]  5%|██▊                                                  | 510/9741 [00:01<00:35, 258.51it/s]  6%|██▉                                                  | 540/9741 [00:02<00:34, 269.94it/s]  6%|███▏                                                 | 580/9741 [00:02<00:29, 306.70it/s]  6%|███▎                                                 | 620/9741 [00:02<00:27, 333.00it/s]  7%|███▌                                                 | 659/9741 [00:02<00:25, 349.56it/s]  7%|███▊                                                 | 699/9741 [00:02<00:24, 363.64it/s]  8%|████                                                 | 739/9741 [00:02<00:24, 372.42it/s]  8%|████▏                                                | 779/9741 [00:02<00:23, 379.66it/s]  8%|████▍                                                | 819/9741 [00:02<00:23, 384.58it/s]  9%|████▋                                                | 859/9741 [00:02<00:22, 388.34it/s]  9%|████▉                                                | 898/9741 [00:02<00:22, 388.61it/s] 10%|█████                                                | 937/9741 [00:03<00:22, 387.17it/s] 10%|█████▎                                               | 976/9741 [00:03<00:22, 386.47it/s] 10%|█████▍                                              | 1016/9741 [00:03<00:22, 388.80it/s] 11%|█████▋                                              | 1056/9741 [00:03<00:22, 391.09it/s] 11%|█████▊                                              | 1096/9741 [00:03<00:22, 392.55it/s] 12%|██████                                              | 1136/9741 [00:03<00:22, 391.13it/s] 12%|██████▎                                             | 1176/9741 [00:03<00:21, 392.24it/s] 12%|██████▍                                             | 1216/9741 [00:03<00:21, 393.05it/s] 13%|██████▋                                             | 1256/9741 [00:03<00:21, 393.80it/s] 13%|██████▉                                             | 1296/9741 [00:03<00:21, 394.23it/s] 14%|███████▏                                            | 1336/9741 [00:04<00:21, 392.76it/s] 14%|███████▎                                            | 1376/9741 [00:04<00:21, 393.56it/s] 15%|███████▌                                            | 1416/9741 [00:04<00:21, 392.50it/s] 15%|███████▊                                            | 1456/9741 [00:04<00:21, 393.19it/s] 15%|███████▉                                            | 1496/9741 [00:04<00:20, 393.39it/s] 16%|████████▏                                           | 1536/9741 [00:04<00:20, 393.99it/s] 16%|████████▍                                           | 1576/9741 [00:04<00:20, 392.19it/s] 17%|████████▋                                           | 1616/9741 [00:04<00:20, 392.83it/s] 17%|████████▊                                           | 1656/9741 [00:04<00:20, 393.25it/s] 17%|█████████                                           | 1696/9741 [00:05<00:20, 393.68it/s] 18%|█████████▎                                          | 1736/9741 [00:05<00:20, 393.03it/s] 18%|█████████▍                                          | 1776/9741 [00:05<00:20, 393.98it/s] 19%|█████████▋                                          | 1816/9741 [00:05<00:21, 373.99it/s] 19%|█████████▉                                          | 1856/9741 [00:05<00:20, 380.10it/s] 19%|██████████                                          | 1896/9741 [00:05<00:20, 384.67it/s] 20%|██████████▎                                         | 1935/9741 [00:05<00:20, 383.61it/s] 20%|██████████▌                                         | 1975/9741 [00:05<00:20, 387.35it/s] 21%|██████████▊                                         | 2015/9741 [00:05<00:19, 390.19it/s] 21%|██████████▉                                         | 2055/9741 [00:05<00:19, 389.37it/s] 22%|███████████▏                                        | 2095/9741 [00:06<00:19, 390.54it/s] 22%|███████████▍                                        | 2135/9741 [00:06<00:19, 391.69it/s] 22%|███████████▌                                        | 2175/9741 [00:06<00:19, 392.78it/s] 23%|███████████▊                                        | 2215/9741 [00:06<00:19, 393.62it/s] 23%|████████████                                        | 2255/9741 [00:06<00:19, 392.02it/s] 24%|████████████▎                                       | 2295/9741 [00:06<00:18, 393.39it/s] 24%|████████████▍                                       | 2335/9741 [00:06<00:18, 393.48it/s] 24%|████████████▋                                       | 2375/9741 [00:06<00:18, 393.80it/s] 25%|████████████▉                                       | 2415/9741 [00:06<00:18, 394.31it/s] 25%|█████████████                                       | 2455/9741 [00:06<00:18, 390.95it/s] 26%|█████████████▎                                      | 2495/9741 [00:07<00:18, 388.52it/s] 26%|█████████████▌                                      | 2535/9741 [00:07<00:18, 390.16it/s] 26%|█████████████▋                                      | 2575/9741 [00:07<00:18, 389.92it/s] 27%|█████████████▉                                      | 2614/9741 [00:07<00:18, 387.34it/s] 27%|██████████████▏                                     | 2654/9741 [00:07<00:18, 388.34it/s] 28%|██████████████▍                                     | 2694/9741 [00:07<00:18, 390.06it/s] 28%|██████████████▌                                     | 2734/9741 [00:07<00:18, 386.88it/s] 28%|██████████████▊                                     | 2774/9741 [00:07<00:17, 387.99it/s] 29%|███████████████                                     | 2813/9741 [00:07<00:18, 383.48it/s] 29%|███████████████▏                                    | 2853/9741 [00:07<00:17, 386.16it/s] 30%|███████████████▍                                    | 2893/9741 [00:08<00:17, 388.65it/s] 30%|███████████████▋                                    | 2932/9741 [00:08<00:17, 386.05it/s] 31%|███████████████▊                                    | 2972/9741 [00:08<00:17, 388.14it/s] 31%|████████████████                                    | 3012/9741 [00:08<00:17, 390.18it/s] 31%|████████████████▎                                   | 3052/9741 [00:08<00:17, 391.10it/s] 32%|████████████████▌                                   | 3092/9741 [00:08<00:16, 392.05it/s] 32%|████████████████▋                                   | 3132/9741 [00:08<00:16, 392.76it/s] 33%|████████████████▉                                   | 3172/9741 [00:08<00:17, 368.47it/s] 33%|█████████████████▏                                  | 3210/9741 [00:08<00:18, 362.14it/s] 33%|█████████████████▎                                  | 3250/9741 [00:09<00:17, 370.72it/s] 34%|█████████████████▌                                  | 3290/9741 [00:09<00:17, 377.83it/s] 34%|█████████████████▊                                  | 3328/9741 [00:09<00:17, 374.06it/s] 35%|█████████████████▉                                  | 3366/9741 [00:09<00:17, 359.86it/s] 35%|██████████████████▏                                 | 3403/9741 [00:09<00:18, 346.01it/s] 35%|██████████████████▎                                 | 3438/9741 [00:09<00:18, 338.29it/s] 36%|██████████████████▌                                 | 3472/9741 [00:09<00:18, 334.34it/s] 36%|██████████████████▋                                 | 3508/9741 [00:09<00:18, 339.19it/s] 36%|██████████████████▉                                 | 3542/9741 [00:09<00:18, 333.74it/s] 37%|███████████████████                                 | 3577/9741 [00:09<00:18, 337.66it/s] 37%|███████████████████▎                                | 3611/9741 [00:10<00:18, 333.46it/s] 37%|███████████████████▍                                | 3646/9741 [00:10<00:18, 337.84it/s] 38%|███████████████████▋                                | 3681/9741 [00:10<00:17, 338.65it/s] 38%|███████████████████▊                                | 3715/9741 [00:10<00:17, 338.76it/s] 39%|████████████████████                                | 3753/9741 [00:10<00:17, 349.26it/s] 39%|████████████████████▏                               | 3793/9741 [00:10<00:16, 362.66it/s] 39%|████████████████████▍                               | 3832/9741 [00:10<00:15, 370.36it/s] 40%|████████████████████▋                               | 3870/9741 [00:10<00:15, 367.51it/s] 40%|████████████████████▊                               | 3907/9741 [00:10<00:16, 363.83it/s] 40%|█████████████████████                               | 3944/9741 [00:11<00:16, 354.28it/s] 41%|█████████████████████▏                              | 3980/9741 [00:11<00:16, 344.07it/s] 41%|█████████████████████▍                              | 4015/9741 [00:11<00:16, 337.59it/s] 42%|█████████████████████▌                              | 4049/9741 [00:11<00:17, 333.11it/s] 42%|█████████████████████▊                              | 4083/9741 [00:11<00:17, 328.30it/s] 42%|█████████████████████▉                              | 4116/9741 [00:11<00:17, 327.73it/s] 43%|██████████████████████▏                             | 4151/9741 [00:11<00:16, 331.73it/s] 43%|██████████████████████▎                             | 4187/9741 [00:11<00:16, 337.30it/s] 43%|██████████████████████▌                             | 4221/9741 [00:11<00:16, 333.49it/s] 44%|██████████████████████▋                             | 4255/9741 [00:11<00:16, 334.96it/s] 44%|██████████████████████▉                             | 4289/9741 [00:12<00:16, 330.27it/s] 44%|███████████████████████                             | 4323/9741 [00:12<00:16, 329.11it/s] 45%|███████████████████████▎                            | 4356/9741 [00:12<00:16, 328.73it/s] 45%|███████████████████████▍                            | 4389/9741 [00:12<00:16, 328.43it/s] 45%|███████████████████████▌                            | 4422/9741 [00:12<00:16, 327.79it/s] 46%|███████████████████████▊                            | 4457/9741 [00:12<00:15, 333.41it/s] 46%|████████████████████████                            | 4497/9741 [00:12<00:14, 351.63it/s] 47%|████████████████████████▏                           | 4533/9741 [00:12<00:15, 333.78it/s] 47%|████████████████████████▍                           | 4573/9741 [00:12<00:14, 351.24it/s] 47%|████████████████████████▋                           | 4613/9741 [00:13<00:14, 364.27it/s] 48%|████████████████████████▊                           | 4653/9741 [00:13<00:13, 373.45it/s] 48%|█████████████████████████                           | 4693/9741 [00:13<00:13, 379.73it/s] 49%|█████████████████████████▎                          | 4733/9741 [00:13<00:13, 382.90it/s] 49%|█████████████████████████▍                          | 4772/9741 [00:13<00:18, 270.29it/s] 49%|█████████████████████████▋                          | 4812/9741 [00:13<00:16, 298.72it/s] 50%|█████████████████████████▉                          | 4852/9741 [00:13<00:15, 321.65it/s] 50%|██████████████████████████                          | 4892/9741 [00:13<00:14, 339.71it/s] 51%|██████████████████████████▎                         | 4932/9741 [00:13<00:13, 354.36it/s] 51%|██████████████████████████▌                         | 4971/9741 [00:14<00:13, 363.72it/s] 51%|██████████████████████████▋                         | 5010/9741 [00:14<00:12, 370.90it/s] 52%|██████████████████████████▉                         | 5050/9741 [00:14<00:12, 377.56it/s] 52%|███████████████████████████▏                        | 5090/9741 [00:14<00:12, 382.51it/s] 53%|███████████████████████████▍                        | 5130/9741 [00:14<00:11, 386.19it/s] 53%|███████████████████████████▌                        | 5170/9741 [00:14<00:11, 386.81it/s] 53%|███████████████████████████▊                        | 5210/9741 [00:14<00:11, 388.96it/s] 54%|████████████████████████████                        | 5250/9741 [00:14<00:11, 390.44it/s] 54%|████████████████████████████▏                       | 5290/9741 [00:14<00:11, 391.51it/s] 55%|████████████████████████████▍                       | 5330/9741 [00:14<00:11, 391.70it/s] 55%|████████████████████████████▋                       | 5370/9741 [00:15<00:11, 392.03it/s] 56%|████████████████████████████▉                       | 5410/9741 [00:15<00:11, 390.43it/s] 56%|█████████████████████████████                       | 5450/9741 [00:15<00:10, 391.10it/s] 56%|█████████████████████████████▎                      | 5490/9741 [00:15<00:10, 393.56it/s] 57%|█████████████████████████████▌                      | 5531/9741 [00:15<00:10, 397.49it/s] 57%|█████████████████████████████▋                      | 5572/9741 [00:15<00:10, 400.51it/s] 58%|█████████████████████████████▉                      | 5613/9741 [00:15<00:10, 402.11it/s] 58%|██████████████████████████████▏                     | 5654/9741 [00:15<00:10, 401.42it/s] 58%|██████████████████████████████▍                     | 5695/9741 [00:15<00:10, 403.51it/s] 59%|██████████████████████████████▌                     | 5736/9741 [00:15<00:09, 404.69it/s] 59%|██████████████████████████████▊                     | 5777/9741 [00:16<00:09, 405.31it/s] 60%|███████████████████████████████                     | 5818/9741 [00:16<00:09, 406.05it/s] 60%|███████████████████████████████▎                    | 5859/9741 [00:16<00:09, 404.25it/s] 61%|███████████████████████████████▍                    | 5900/9741 [00:16<00:09, 405.28it/s] 61%|███████████████████████████████▋                    | 5941/9741 [00:16<00:09, 405.94it/s] 61%|███████████████████████████████▉                    | 5982/9741 [00:16<00:09, 406.53it/s] 62%|████████████████████████████████▏                   | 6023/9741 [00:16<00:09, 405.63it/s] 62%|████████████████████████████████▎                   | 6064/9741 [00:16<00:09, 406.11it/s] 63%|████████████████████████████████▌                   | 6105/9741 [00:16<00:08, 404.54it/s] 63%|████████████████████████████████▊                   | 6146/9741 [00:17<00:08, 405.07it/s] 64%|█████████████████████████████████                   | 6187/9741 [00:17<00:08, 405.89it/s] 64%|█████████████████████████████████▏                  | 6228/9741 [00:17<00:08, 406.01it/s] 64%|█████████████████████████████████▍                  | 6269/9741 [00:17<00:08, 405.95it/s] 65%|█████████████████████████████████▋                  | 6310/9741 [00:17<00:08, 404.36it/s] 65%|█████████████████████████████████▉                  | 6351/9741 [00:17<00:08, 405.16it/s] 66%|██████████████████████████████████                  | 6392/9741 [00:17<00:08, 405.94it/s] 66%|██████████████████████████████████▎                 | 6433/9741 [00:17<00:08, 406.58it/s] 66%|██████████████████████████████████▌                 | 6474/9741 [00:17<00:08, 406.31it/s] 67%|██████████████████████████████████▊                 | 6515/9741 [00:17<00:07, 406.36it/s] 67%|██████████████████████████████████▉                 | 6556/9741 [00:18<00:07, 404.69it/s] 68%|███████████████████████████████████▏                | 6597/9741 [00:18<00:07, 403.89it/s] 68%|███████████████████████████████████▍                | 6638/9741 [00:18<00:07, 404.88it/s] 69%|███████████████████████████████████▋                | 6679/9741 [00:18<00:07, 405.80it/s] 69%|███████████████████████████████████▊                | 6720/9741 [00:18<00:07, 402.25it/s] 69%|████████████████████████████████████                | 6761/9741 [00:18<00:07, 400.68it/s] 70%|████████████████████████████████████▎               | 6802/9741 [00:18<00:07, 402.09it/s] 70%|████████████████████████████████████▌               | 6843/9741 [00:18<00:07, 404.00it/s] 71%|████████████████████████████████████▋               | 6884/9741 [00:18<00:07, 404.94it/s] 71%|████████████████████████████████████▉               | 6925/9741 [00:18<00:06, 405.77it/s] 72%|█████████████████████████████████████▏              | 6966/9741 [00:19<00:06, 406.37it/s] 72%|█████████████████████████████████████▍              | 7007/9741 [00:19<00:06, 403.71it/s] 72%|█████████████████████████████████████▌              | 7048/9741 [00:19<00:06, 404.63it/s] 73%|█████████████████████████████████████▊              | 7089/9741 [00:19<00:06, 405.31it/s] 73%|██████████████████████████████████████              | 7130/9741 [00:19<00:06, 405.91it/s] 74%|██████████████████████████████████████▎             | 7171/9741 [00:19<00:06, 406.60it/s] 74%|██████████████████████████████████████▍             | 7212/9741 [00:19<00:06, 406.63it/s] 74%|██████████████████████████████████████▋             | 7253/9741 [00:19<00:06, 404.83it/s] 75%|██████████████████████████████████████▉             | 7294/9741 [00:19<00:06, 405.77it/s] 75%|███████████████████████████████████████▏            | 7335/9741 [00:19<00:05, 406.21it/s] 76%|███████████████████████████████████████▍            | 7376/9741 [00:20<00:05, 403.74it/s] 76%|███████████████████████████████████████▌            | 7417/9741 [00:20<00:05, 404.40it/s] 77%|███████████████████████████████████████▊            | 7458/9741 [00:20<00:06, 377.58it/s] 77%|████████████████████████████████████████            | 7499/9741 [00:20<00:05, 384.79it/s] 77%|████████████████████████████████████████▎           | 7540/9741 [00:20<00:05, 390.99it/s] 78%|████████████████████████████████████████▍           | 7581/9741 [00:20<00:05, 395.24it/s] 78%|████████████████████████████████████████▋           | 7622/9741 [00:20<00:05, 398.81it/s] 79%|████████████████████████████████████████▉           | 7663/9741 [00:20<00:05, 400.90it/s] 79%|█████████████████████████████████████████▏          | 7704/9741 [00:20<00:05, 400.72it/s] 80%|█████████████████████████████████████████▎          | 7745/9741 [00:20<00:04, 403.20it/s] 80%|█████████████████████████████████████████▌          | 7786/9741 [00:21<00:04, 403.85it/s] 80%|█████████████████████████████████████████▊          | 7827/9741 [00:21<00:04, 404.65it/s] 81%|██████████████████████████████████████████          | 7868/9741 [00:21<00:04, 403.35it/s] 81%|██████████████████████████████████████████▏         | 7909/9741 [00:21<00:04, 401.19it/s] 82%|██████████████████████████████████████████▍         | 7950/9741 [00:21<00:04, 402.57it/s] 82%|██████████████████████████████████████████▋         | 7991/9741 [00:21<00:04, 403.95it/s] 82%|██████████████████████████████████████████▉         | 8032/9741 [00:21<00:04, 404.67it/s] 83%|███████████████████████████████████████████         | 8073/9741 [00:21<00:04, 401.85it/s] 83%|███████████████████████████████████████████▎        | 8114/9741 [00:21<00:04, 403.72it/s] 84%|███████████████████████████████████████████▌        | 8155/9741 [00:22<00:03, 400.93it/s] 84%|███████████████████████████████████████████▊        | 8196/9741 [00:22<00:03, 401.80it/s] 85%|███████████████████████████████████████████▉        | 8237/9741 [00:22<00:03, 403.15it/s] 85%|████████████████████████████████████████████▏       | 8278/9741 [00:22<00:03, 404.68it/s] 85%|████████████████████████████████████████████▍       | 8319/9741 [00:22<00:03, 405.26it/s] 86%|████████████████████████████████████████████▋       | 8360/9741 [00:22<00:03, 403.98it/s] 86%|████████████████████████████████████████████▊       | 8401/9741 [00:22<00:03, 405.11it/s] 87%|█████████████████████████████████████████████       | 8442/9741 [00:22<00:03, 405.09it/s] 87%|█████████████████████████████████████████████▎      | 8483/9741 [00:22<00:03, 405.33it/s] 88%|█████████████████████████████████████████████▌      | 8524/9741 [00:22<00:02, 405.85it/s] 88%|█████████████████████████████████████████████▋      | 8565/9741 [00:23<00:02, 405.87it/s] 88%|█████████████████████████████████████████████▉      | 8606/9741 [00:23<00:02, 403.83it/s] 89%|██████████████████████████████████████████████▏     | 8647/9741 [00:23<00:02, 404.64it/s] 89%|██████████████████████████████████████████████▍     | 8688/9741 [00:23<00:02, 405.34it/s] 90%|██████████████████████████████████████████████▌     | 8729/9741 [00:23<00:02, 405.69it/s] 90%|██████████████████████████████████████████████▊     | 8770/9741 [00:23<00:02, 406.03it/s] 90%|███████████████████████████████████████████████     | 8811/9741 [00:23<00:02, 404.17it/s] 91%|███████████████████████████████████████████████▎    | 8852/9741 [00:23<00:02, 404.70it/s] 91%|███████████████████████████████████████████████▍    | 8893/9741 [00:23<00:02, 405.69it/s] 92%|███████████████████████████████████████████████▋    | 8934/9741 [00:23<00:01, 406.09it/s] 92%|███████████████████████████████████████████████▉    | 8975/9741 [00:24<00:01, 406.50it/s] 93%|████████████████████████████████████████████████▏   | 9016/9741 [00:24<00:01, 406.33it/s] 93%|████████████████████████████████████████████████▎   | 9057/9741 [00:24<00:01, 404.43it/s] 93%|████████████████████████████████████████████████▌   | 9098/9741 [00:24<00:01, 405.28it/s] 94%|████████████████████████████████████████████████▊   | 9139/9741 [00:24<00:01, 404.36it/s] 94%|█████████████████████████████████████████████████   | 9180/9741 [00:24<00:01, 405.18it/s] 95%|█████████████████████████████████████████████████▏  | 9221/9741 [00:24<00:01, 405.61it/s] 95%|█████████████████████████████████████████████████▍  | 9262/9741 [00:24<00:01, 404.23it/s] 96%|█████████████████████████████████████████████████▋  | 9303/9741 [00:24<00:01, 405.07it/s] 96%|█████████████████████████████████████████████████▉  | 9344/9741 [00:24<00:00, 405.79it/s] 96%|██████████████████████████████████████████████████  | 9385/9741 [00:25<00:00, 405.73it/s] 97%|██████████████████████████████████████████████████▎ | 9426/9741 [00:25<00:00, 404.84it/s] 97%|██████████████████████████████████████████████████▌ | 9467/9741 [00:25<00:00, 404.36it/s] 98%|██████████████████████████████████████████████████▊ | 9508/9741 [00:25<00:00, 402.70it/s] 98%|██████████████████████████████████████████████████▉ | 9549/9741 [00:25<00:00, 404.02it/s] 98%|███████████████████████████████████████████████████▏| 9590/9741 [00:25<00:00, 404.83it/s] 99%|███████████████████████████████████████████████████▍| 9631/9741 [00:25<00:00, 404.50it/s] 99%|███████████████████████████████████████████████████▋| 9672/9741 [00:25<00:00, 405.22it/s]100%|███████████████████████████████████████████████████▊| 9713/9741 [00:25<00:00, 403.29it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:25<00:00, 375.86it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.07s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.28s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.21s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:06<00:12,  6.04s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.08s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.17s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.26s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.57s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.54s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
[2023-08-22 10:54:34,569] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.59s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.83s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.08s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  5.00s/it]
[2023-08-22 10:54:46,573] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 10:54:46,573] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7faef7cb8fd0>
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 10:54:46,574] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7faef6e39220>
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 10:54:46,575] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 10:54:46,575] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5246603488922119 seconds
Loading extension module utils...
Time to load utils op: 0.5046019554138184 seconds
Loading extension module utils...
Time to load utils op: 0.6050534248352051 seconds
Loading extension module utils...
Time to load utils op: 0.6048269271850586 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: The car-rental agency charges $30/day for a car, or $190 for the first week for a rental that lasts an entire week or longer. Jennie rented a car for 11 days. How much, in dollars, did she pay for the rental?
Output: 310

Input: A hurricane is approaching the southern coast of Texas, and a rancher is planning to move 400 head of cattle 60 miles to higher ground to protect them from possible inland flooding that might occur.  His animal transport truck holds 20 head of cattle.  Traveling at 60 miles per hour, what is the total driving time, in hours, it will take to transport all of his cattle to higher ground?
Output: 40

Input: Jason has a carriage house that he rents out.  He’s charging $50.00 per day or $500.00 for 14 days.  Eric wants to rent the house for 20 days.  How much will it cost him?
Output: 800

Input: Melissa works on a poultry farm. She drives to town twice each month to buy supplies. If it takes her 3 hours to drive to town and back, how many hours does Melissa spend driving in a year?
Output: 72

Input: The ratio of boys to girls in a family is 5:7. The total number of children in the family is 180. If the boys are given $3900 to share, how much money does each boy receive?
Output: 52

Input: Josephine receives a bill from the hospital for 5000$.  50 percent of the bill is for medication.  25 percent of the remaining bill is for overnight stays, and 175$ is for food.  The rest of the bill is for the ambulance ride.  How much did the ambulance ride cost?
Output: 1700

Input: It was time for Kelly to harvest her carrots that she had planted in three different beds.  In the first bed she pulled out 55 carrots.  In the second bed she pulled out 101 carrots and in the third bed she pulled out 78 carrots.  She found that 6 carrots weighed one pound.  How many pounds of carrots did Kelly harvest?
Output: 39

Input: Iris’ family is planning a surprise birthday party for her. The party will include her 3 uncles and 4 aunts who have a son and daughter each as well as her brother and mother. In total, how many people are coming to Iris’ birthday party?
Output: 23

Input: Lyra bought a pair of shoes at a 20% discount.  If she paid $480, how much was the original price of the pair of shoes?
Output: 600

Input: Rhett has been late on two of his monthly rent payments, but his landlord does not charge late fees and so he will be able to pay their total cost with 3/5 of his next month's salary after taxes. If he is currently paid $5000 per month and has to pay 10% tax, calculate his rent expense per month?
Output: 1350

Input: Ten friends decide to get an end-of-year gift for their teacher. They plan to split the cost of the gift equally. But four of the group drop out. The remaining friends split the cost equally among themselves. If each share is now $8 more, how much does the gift cost, in dollars?
Output: 120

Input: At the feline sanctuary, there were 12 lions, 14 tigers, and several cougars.  If there were half as many cougars as lions and tigers combined, then what was the total number of big cats at the feline sanctuary?
Output: 39

Input: A pea patch is twice as big as a radish patch. If one sixth of the pea patch is 5 square feet.  How much is a whole radish patch in square feet?
Output: 15

Input: Phoebe has two pizzas to share with her and three friends. One has pepperoni and the other has cheese. They both have 16 slices. They all eat the same amount. One friend eats only pepperoni, while the rest have an equal number of slices of each. At the end, there is one slice of pepperoni left and 7 slices of cheese, how many slices does each person eat?
Output: 6

Input: Jeremy buys 30 watermelons. He eats 3 watermelons per week. Each week he gives 2 to his dad. How many weeks will the watermelons last?
Output: 6

Input: Jackson has 5 times more money than Williams. Together, they have $150. How much money, in dollars, does Jackson have?
Output: 125

Input: Janet counts 30 crows on the powerlines and 60% more hawks than crows. How many birds does she count total?
Output: 78

Input: There are 290 liters of oil in 24 cans. If 10 of the cans are holding 8 liters each, how much oil is each of the remaining cans holding?
Output: 15

Input: Bill had to finish a project from work that was to take him 4 days. If he took 6 seven-hour naps in the four days, how long did he spend working on the project?
Output: 54

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o19-tgsm8k-s30-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:40<32:54, 40.30s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:20<32:01, 40.03s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:59<31:00, 39.59s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:38<30:16, 39.48s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:17<29:29, 39.33s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:56<28:49, 39.31s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:36<28:21, 39.56s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:16<27:44, 39.63s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:56<27:06, 39.66s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:36<26:26, 39.65s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:15<25:46, 39.64s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:55<25:10, 39.74s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:35<24:31, 39.76s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:14<23:45, 39.61s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:54<23:08, 39.67s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:33<22:22, 39.49s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:13<21:43, 39.51s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:52<21:06, 39.59s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:32<20:28, 39.64s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [13:12<19:50, 39.67s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:52<19:12, 39.75s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:31<18:30, 39.65s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:11<17:51, 39.67s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:37<15:24, 35.55s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:17<15:24, 36.99s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:57<15:07, 37.81s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:37<14:44, 38.46s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:17<14:13, 38.79s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:34<11:18, 32.31s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [18:56<09:43, 29.19s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:35<10:14, 32.35s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:15<10:21, 34.51s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [20:55<10:15, 36.23s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [21:35<09:54, 37.18s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:02<08:33, 34.24s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [22:42<08:22, 35.87s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [23:21<08:01, 37.05s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [24:01<07:33, 37.77s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [24:41<07:03, 38.47s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [25:20<06:27, 38.70s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [26:00<05:50, 39.00s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [26:40<05:13, 39.21s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [26:58<03:51, 33.05s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [27:38<03:30, 35.02s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [28:18<03:02, 36.45s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [28:57<02:29, 37.42s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [29:37<01:54, 38.09s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [30:08<01:11, 35.80s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [30:47<00:36, 37.00s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:27<00:00, 37.71s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [31:27<00:00, 37.74s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.2156} | avg. gen lenth: 280.328
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o20-tgsm8k-s30-rFalse --seed 30 --max-prompt-length 2048 --num-out-domain 20
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-22 11:26:49,974] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o20-tgsm8k-s30-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 20
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o20-tgsm8k-s30-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 25/9741 [00:00<00:39, 248.15it/s]  1%|▎                                                     | 51/9741 [00:00<00:38, 249.36it/s]  1%|▍                                                     | 77/9741 [00:00<00:38, 249.86it/s]  1%|▌                                                    | 103/9741 [00:00<00:38, 250.02it/s]  1%|▋                                                    | 129/9741 [00:00<00:38, 249.87it/s]  2%|▊                                                    | 154/9741 [00:00<00:38, 249.82it/s]  2%|▉                                                    | 179/9741 [00:00<00:38, 245.22it/s]  2%|█                                                    | 204/9741 [00:00<00:39, 244.20it/s]  2%|█▏                                                   | 229/9741 [00:00<00:38, 245.65it/s]  3%|█▍                                                   | 254/9741 [00:01<00:38, 246.60it/s]  3%|█▌                                                   | 279/9741 [00:01<00:38, 247.30it/s]  3%|█▋                                                   | 304/9741 [00:01<00:38, 247.77it/s]  3%|█▊                                                   | 329/9741 [00:01<00:37, 248.10it/s]  4%|█▉                                                   | 354/9741 [00:01<00:37, 248.20it/s]  4%|██                                                   | 379/9741 [00:01<00:37, 248.42it/s]  4%|██▏                                                  | 404/9741 [00:01<00:37, 248.57it/s]  4%|██▎                                                  | 429/9741 [00:01<00:38, 244.62it/s]  5%|██▍                                                  | 454/9741 [00:01<00:37, 245.24it/s]  5%|██▌                                                  | 479/9741 [00:01<00:37, 246.07it/s]  5%|██▋                                                  | 504/9741 [00:02<00:37, 246.89it/s]  5%|██▉                                                  | 534/9741 [00:02<00:35, 261.90it/s]  6%|███                                                  | 572/9741 [00:02<00:30, 296.32it/s]  6%|███▎                                                 | 610/9741 [00:02<00:28, 319.98it/s]  7%|███▌                                                 | 648/9741 [00:02<00:27, 336.29it/s]  7%|███▋                                                 | 685/9741 [00:02<00:26, 346.20it/s]  7%|███▉                                                 | 723/9741 [00:02<00:25, 355.41it/s]  8%|████▏                                                | 761/9741 [00:02<00:24, 362.00it/s]  8%|████▎                                                | 799/9741 [00:02<00:24, 366.58it/s]  9%|████▌                                                | 837/9741 [00:02<00:24, 369.62it/s]  9%|████▊                                                | 875/9741 [00:03<00:23, 372.16it/s]  9%|████▉                                                | 913/9741 [00:03<00:23, 371.66it/s] 10%|█████▏                                               | 951/9741 [00:03<00:23, 373.26it/s] 10%|█████▍                                               | 989/9741 [00:03<00:23, 374.34it/s] 11%|█████▍                                              | 1027/9741 [00:03<00:23, 374.51it/s] 11%|█████▋                                              | 1065/9741 [00:03<00:23, 374.87it/s] 11%|█████▉                                              | 1103/9741 [00:03<00:22, 375.93it/s] 12%|██████                                              | 1141/9741 [00:03<00:23, 373.76it/s] 12%|██████▎                                             | 1179/9741 [00:03<00:22, 374.81it/s] 12%|██████▍                                             | 1217/9741 [00:03<00:22, 374.16it/s] 13%|██████▋                                             | 1255/9741 [00:04<00:22, 375.03it/s] 13%|██████▉                                             | 1293/9741 [00:04<00:22, 375.59it/s] 14%|███████                                             | 1331/9741 [00:04<00:22, 374.97it/s] 14%|███████▎                                            | 1369/9741 [00:04<00:22, 372.93it/s] 14%|███████▌                                            | 1407/9741 [00:04<00:22, 373.90it/s] 15%|███████▋                                            | 1445/9741 [00:04<00:22, 373.61it/s] 15%|███████▉                                            | 1483/9741 [00:04<00:22, 374.31it/s] 16%|████████                                            | 1521/9741 [00:04<00:21, 374.66it/s] 16%|████████▎                                           | 1559/9741 [00:04<00:21, 375.85it/s] 16%|████████▌                                           | 1597/9741 [00:04<00:21, 373.67it/s] 17%|████████▋                                           | 1635/9741 [00:05<00:21, 374.68it/s] 17%|████████▉                                           | 1673/9741 [00:05<00:21, 375.48it/s] 18%|█████████▏                                          | 1711/9741 [00:05<00:21, 375.53it/s] 18%|█████████▎                                          | 1749/9741 [00:05<00:21, 375.66it/s] 18%|█████████▌                                          | 1787/9741 [00:05<00:21, 375.68it/s] 19%|█████████▋                                          | 1825/9741 [00:05<00:22, 352.34it/s] 19%|█████████▉                                          | 1862/9741 [00:05<00:22, 356.95it/s] 20%|██████████▏                                         | 1900/9741 [00:05<00:21, 362.07it/s] 20%|██████████▎                                         | 1938/9741 [00:05<00:21, 365.70it/s] 20%|██████████▌                                         | 1976/9741 [00:06<00:21, 367.48it/s] 21%|██████████▊                                         | 2014/9741 [00:06<00:20, 369.89it/s] 21%|██████████▉                                         | 2052/9741 [00:06<00:20, 368.95it/s] 21%|███████████▏                                        | 2090/9741 [00:06<00:20, 370.40it/s] 22%|███████████▎                                        | 2128/9741 [00:06<00:20, 371.96it/s] 22%|███████████▌                                        | 2166/9741 [00:06<00:20, 373.34it/s] 23%|███████████▊                                        | 2204/9741 [00:06<00:20, 374.09it/s] 23%|███████████▉                                        | 2242/9741 [00:06<00:20, 372.50it/s] 23%|████████████▏                                       | 2280/9741 [00:06<00:20, 368.91it/s] 24%|████████████▎                                       | 2317/9741 [00:06<00:20, 367.78it/s] 24%|████████████▌                                       | 2355/9741 [00:07<00:19, 369.91it/s] 25%|████████████▊                                       | 2393/9741 [00:07<00:19, 371.80it/s] 25%|████████████▉                                       | 2431/9741 [00:07<00:19, 373.22it/s] 25%|█████████████▏                                      | 2469/9741 [00:07<00:19, 373.55it/s] 26%|█████████████▍                                      | 2507/9741 [00:07<00:19, 370.85it/s] 26%|█████████████▌                                      | 2545/9741 [00:07<00:19, 371.92it/s] 27%|█████████████▊                                      | 2583/9741 [00:07<00:19, 373.15it/s] 27%|█████████████▉                                      | 2621/9741 [00:07<00:19, 373.57it/s] 27%|██████████████▏                                     | 2659/9741 [00:07<00:19, 369.14it/s] 28%|██████████████▍                                     | 2696/9741 [00:07<00:19, 369.25it/s] 28%|██████████████▌                                     | 2733/9741 [00:08<00:19, 367.39it/s] 28%|██████████████▊                                     | 2771/9741 [00:08<00:18, 369.60it/s] 29%|██████████████▉                                     | 2808/9741 [00:08<00:18, 368.54it/s] 29%|███████████████▏                                    | 2846/9741 [00:08<00:18, 370.50it/s] 30%|███████████████▍                                    | 2884/9741 [00:08<00:18, 371.90it/s] 30%|███████████████▌                                    | 2922/9741 [00:08<00:18, 372.77it/s] 30%|███████████████▊                                    | 2960/9741 [00:08<00:18, 371.19it/s] 31%|████████████████                                    | 2998/9741 [00:08<00:18, 372.82it/s] 31%|████████████████▏                                   | 3036/9741 [00:08<00:17, 373.44it/s] 32%|████████████████▍                                   | 3074/9741 [00:08<00:17, 372.83it/s] 32%|████████████████▌                                   | 3112/9741 [00:09<00:17, 372.64it/s] 32%|████████████████▊                                   | 3150/9741 [00:09<00:17, 372.96it/s] 33%|█████████████████                                   | 3188/9741 [00:09<00:17, 371.79it/s] 33%|█████████████████▏                                  | 3226/9741 [00:09<00:17, 372.79it/s] 34%|█████████████████▍                                  | 3264/9741 [00:09<00:17, 373.91it/s] 34%|█████████████████▋                                  | 3302/9741 [00:09<00:17, 373.88it/s] 34%|█████████████████▊                                  | 3340/9741 [00:09<00:17, 374.25it/s] 35%|██████████████████                                  | 3378/9741 [00:09<00:17, 371.70it/s] 35%|██████████████████▏                                 | 3416/9741 [00:09<00:17, 370.96it/s] 35%|██████████████████▍                                 | 3454/9741 [00:09<00:16, 371.11it/s] 36%|██████████████████▋                                 | 3492/9741 [00:10<00:16, 371.28it/s] 36%|██████████████████▊                                 | 3530/9741 [00:10<00:16, 372.36it/s] 37%|███████████████████                                 | 3568/9741 [00:10<00:16, 373.14it/s] 37%|███████████████████▏                                | 3606/9741 [00:10<00:16, 371.57it/s] 37%|███████████████████▍                                | 3644/9741 [00:10<00:16, 372.52it/s] 38%|███████████████████▋                                | 3682/9741 [00:10<00:16, 373.25it/s] 38%|███████████████████▊                                | 3720/9741 [00:10<00:16, 373.80it/s] 39%|████████████████████                                | 3758/9741 [00:10<00:15, 374.17it/s] 39%|████████████████████▎                               | 3796/9741 [00:10<00:15, 374.09it/s] 39%|████████████████████▍                               | 3834/9741 [00:11<00:15, 372.02it/s] 40%|████████████████████▋                               | 3872/9741 [00:11<00:15, 372.64it/s] 40%|████████████████████▊                               | 3910/9741 [00:11<00:15, 372.69it/s] 41%|█████████████████████                               | 3948/9741 [00:11<00:15, 370.98it/s] 41%|█████████████████████▎                              | 3986/9741 [00:11<00:15, 370.80it/s] 41%|█████████████████████▍                              | 4024/9741 [00:11<00:15, 372.44it/s] 42%|█████████████████████▋                              | 4062/9741 [00:11<00:15, 370.82it/s] 42%|█████████████████████▉                              | 4100/9741 [00:11<00:15, 371.75it/s] 42%|██████████████████████                              | 4138/9741 [00:11<00:15, 372.46it/s] 43%|██████████████████████▎                             | 4176/9741 [00:11<00:14, 372.27it/s] 43%|██████████████████████▍                             | 4214/9741 [00:12<00:14, 372.04it/s] 44%|██████████████████████▋                             | 4252/9741 [00:12<00:14, 372.73it/s] 44%|██████████████████████▉                             | 4290/9741 [00:12<00:14, 371.47it/s] 44%|███████████████████████                             | 4328/9741 [00:12<00:14, 370.42it/s] 45%|███████████████████████▎                            | 4366/9741 [00:12<00:14, 369.22it/s] 45%|███████████████████████▌                            | 4404/9741 [00:12<00:14, 369.64it/s] 46%|███████████████████████▋                            | 4442/9741 [00:12<00:14, 370.82it/s] 46%|███████████████████████▉                            | 4480/9741 [00:12<00:14, 371.98it/s] 46%|████████████████████████                            | 4518/9741 [00:12<00:15, 343.71it/s] 47%|████████████████████████▎                           | 4556/9741 [00:12<00:14, 352.14it/s] 47%|████████████████████████▌                           | 4594/9741 [00:13<00:14, 358.55it/s] 48%|████████████████████████▋                           | 4632/9741 [00:13<00:14, 363.35it/s] 48%|████████████████████████▉                           | 4669/9741 [00:13<00:13, 365.15it/s] 48%|█████████████████████████▏                          | 4707/9741 [00:13<00:13, 367.56it/s] 49%|█████████████████████████▎                          | 4744/9741 [00:13<00:19, 253.95it/s] 49%|█████████████████████████▌                          | 4782/9741 [00:13<00:17, 281.29it/s] 49%|█████████████████████████▋                          | 4820/9741 [00:13<00:16, 303.77it/s] 50%|█████████████████████████▉                          | 4858/9741 [00:13<00:15, 321.72it/s] 50%|██████████████████████████▏                         | 4896/9741 [00:14<00:14, 334.93it/s] 51%|██████████████████████████▎                         | 4934/9741 [00:14<00:13, 346.02it/s] 51%|██████████████████████████▌                         | 4971/9741 [00:14<00:13, 352.47it/s] 51%|██████████████████████████▋                         | 5009/9741 [00:14<00:13, 357.98it/s] 52%|██████████████████████████▉                         | 5047/9741 [00:14<00:12, 362.22it/s] 52%|███████████████████████████▏                        | 5085/9741 [00:14<00:12, 365.65it/s] 53%|███████████████████████████▎                        | 5123/9741 [00:14<00:12, 368.43it/s] 53%|███████████████████████████▌                        | 5161/9741 [00:14<00:12, 369.55it/s] 53%|███████████████████████████▊                        | 5199/9741 [00:14<00:12, 367.88it/s] 54%|███████████████████████████▉                        | 5237/9741 [00:14<00:12, 369.67it/s] 54%|████████████████████████████▏                       | 5275/9741 [00:15<00:12, 371.01it/s] 55%|████████████████████████████▎                       | 5313/9741 [00:15<00:11, 372.25it/s] 55%|████████████████████████████▌                       | 5351/9741 [00:15<00:11, 372.62it/s] 55%|████████████████████████████▊                       | 5389/9741 [00:15<00:11, 372.99it/s] 56%|████████████████████████████▉                       | 5427/9741 [00:15<00:11, 371.18it/s] 56%|█████████████████████████████▏                      | 5465/9741 [00:15<00:11, 372.02it/s] 57%|█████████████████████████████▍                      | 5504/9741 [00:15<00:11, 375.38it/s] 57%|█████████████████████████████▌                      | 5543/9741 [00:15<00:11, 378.02it/s] 57%|█████████████████████████████▊                      | 5582/9741 [00:15<00:10, 379.55it/s] 58%|██████████████████████████████                      | 5621/9741 [00:15<00:10, 380.96it/s] 58%|██████████████████████████████▏                     | 5660/9741 [00:16<00:10, 379.08it/s] 59%|██████████████████████████████▍                     | 5699/9741 [00:16<00:10, 381.19it/s] 59%|██████████████████████████████▋                     | 5738/9741 [00:16<00:10, 382.28it/s] 59%|██████████████████████████████▊                     | 5777/9741 [00:16<00:10, 383.14it/s] 60%|███████████████████████████████                     | 5816/9741 [00:16<00:10, 384.15it/s] 60%|███████████████████████████████▎                    | 5855/9741 [00:16<00:10, 382.61it/s] 61%|███████████████████████████████▍                    | 5894/9741 [00:16<00:10, 383.55it/s] 61%|███████████████████████████████▋                    | 5933/9741 [00:16<00:09, 383.96it/s] 61%|███████████████████████████████▉                    | 5972/9741 [00:16<00:09, 384.74it/s] 62%|████████████████████████████████                    | 6011/9741 [00:16<00:09, 385.26it/s] 62%|████████████████████████████████▎                   | 6050/9741 [00:17<00:09, 385.44it/s] 63%|████████████████████████████████▌                   | 6089/9741 [00:17<00:09, 383.46it/s] 63%|████████████████████████████████▋                   | 6128/9741 [00:17<00:09, 383.90it/s] 63%|████████████████████████████████▉                   | 6167/9741 [00:17<00:09, 384.41it/s] 64%|█████████████████████████████████▏                  | 6206/9741 [00:17<00:09, 384.82it/s] 64%|█████████████████████████████████▎                  | 6245/9741 [00:17<00:09, 384.69it/s] 65%|█████████████████████████████████▌                  | 6284/9741 [00:17<00:08, 385.10it/s] 65%|█████████████████████████████████▊                  | 6323/9741 [00:17<00:08, 383.12it/s] 65%|█████████████████████████████████▉                  | 6362/9741 [00:17<00:08, 384.10it/s] 66%|██████████████████████████████████▏                 | 6401/9741 [00:18<00:08, 384.85it/s] 66%|██████████████████████████████████▍                 | 6440/9741 [00:18<00:08, 383.66it/s] 67%|██████████████████████████████████▌                 | 6479/9741 [00:18<00:08, 383.97it/s] 67%|██████████████████████████████████▊                 | 6518/9741 [00:18<00:08, 384.44it/s] 67%|███████████████████████████████████                 | 6557/9741 [00:18<00:08, 381.83it/s] 68%|███████████████████████████████████▏                | 6596/9741 [00:18<00:08, 382.87it/s] 68%|███████████████████████████████████▍                | 6635/9741 [00:18<00:08, 383.74it/s] 69%|███████████████████████████████████▋                | 6674/9741 [00:18<00:07, 384.40it/s] 69%|███████████████████████████████████▊                | 6713/9741 [00:18<00:07, 384.67it/s] 69%|████████████████████████████████████                | 6752/9741 [00:18<00:07, 385.52it/s] 70%|████████████████████████████████████▎               | 6791/9741 [00:19<00:07, 383.79it/s] 70%|████████████████████████████████████▍               | 6830/9741 [00:19<00:07, 384.44it/s] 71%|████████████████████████████████████▋               | 6869/9741 [00:19<00:07, 384.78it/s] 71%|████████████████████████████████████▉               | 6908/9741 [00:19<00:07, 384.89it/s] 71%|█████████████████████████████████████               | 6947/9741 [00:19<00:07, 385.34it/s] 72%|█████████████████████████████████████▎              | 6986/9741 [00:19<00:07, 383.64it/s] 72%|█████████████████████████████████████▌              | 7025/9741 [00:19<00:07, 384.35it/s] 73%|█████████████████████████████████████▋              | 7064/9741 [00:19<00:06, 384.71it/s] 73%|█████████████████████████████████████▉              | 7103/9741 [00:19<00:06, 381.69it/s] 73%|██████████████████████████████████████▏             | 7142/9741 [00:19<00:06, 382.44it/s] 74%|██████████████████████████████████████▎             | 7181/9741 [00:20<00:06, 378.75it/s] 74%|██████████████████████████████████████▌             | 7219/9741 [00:20<00:06, 377.20it/s] 75%|██████████████████████████████████████▋             | 7258/9741 [00:20<00:06, 379.79it/s] 75%|██████████████████████████████████████▉             | 7297/9741 [00:20<00:06, 380.96it/s] 75%|███████████████████████████████████████▏            | 7336/9741 [00:20<00:06, 382.09it/s] 76%|███████████████████████████████████████▎            | 7375/9741 [00:20<00:06, 383.44it/s] 76%|███████████████████████████████████████▌            | 7414/9741 [00:20<00:06, 384.23it/s] 77%|███████████████████████████████████████▊            | 7453/9741 [00:20<00:06, 359.60it/s] 77%|███████████████████████████████████████▉            | 7492/9741 [00:20<00:06, 366.03it/s] 77%|████████████████████████████████████████▏           | 7531/9741 [00:20<00:05, 370.85it/s] 78%|████████████████████████████████████████▍           | 7570/9741 [00:21<00:05, 374.98it/s] 78%|████████████████████████████████████████▌           | 7609/9741 [00:21<00:05, 378.32it/s] 79%|████████████████████████████████████████▊           | 7648/9741 [00:21<00:05, 380.49it/s] 79%|█████████████████████████████████████████           | 7687/9741 [00:21<00:05, 380.00it/s] 79%|█████████████████████████████████████████▏          | 7726/9741 [00:21<00:05, 381.59it/s] 80%|█████████████████████████████████████████▍          | 7765/9741 [00:21<00:05, 383.09it/s] 80%|█████████████████████████████████████████▋          | 7804/9741 [00:21<00:05, 383.86it/s] 81%|█████████████████████████████████████████▊          | 7843/9741 [00:21<00:04, 381.84it/s] 81%|██████████████████████████████████████████          | 7882/9741 [00:21<00:04, 382.64it/s] 81%|██████████████████████████████████████████▎         | 7921/9741 [00:21<00:04, 381.72it/s] 82%|██████████████████████████████████████████▍         | 7960/9741 [00:22<00:04, 381.72it/s] 82%|██████████████████████████████████████████▋         | 7999/9741 [00:22<00:04, 383.00it/s] 83%|██████████████████████████████████████████▉         | 8038/9741 [00:22<00:04, 383.67it/s] 83%|███████████████████████████████████████████         | 8077/9741 [00:22<00:04, 383.98it/s] 83%|███████████████████████████████████████████▎        | 8116/9741 [00:22<00:04, 384.81it/s] 84%|███████████████████████████████████████████▌        | 8155/9741 [00:22<00:04, 382.97it/s] 84%|███████████████████████████████████████████▋        | 8194/9741 [00:22<00:04, 383.61it/s] 85%|███████████████████████████████████████████▉        | 8233/9741 [00:22<00:03, 384.36it/s] 85%|████████████████████████████████████████████▏       | 8272/9741 [00:22<00:03, 384.45it/s] 85%|████████████████████████████████████████████▎       | 8311/9741 [00:23<00:03, 384.60it/s] 86%|████████████████████████████████████████████▌       | 8350/9741 [00:23<00:03, 383.09it/s] 86%|████████████████████████████████████████████▊       | 8389/9741 [00:23<00:03, 383.75it/s] 87%|████████████████████████████████████████████▉       | 8428/9741 [00:23<00:03, 384.45it/s] 87%|█████████████████████████████████████████████▏      | 8467/9741 [00:23<00:03, 385.05it/s] 87%|█████████████████████████████████████████████▍      | 8506/9741 [00:23<00:03, 382.73it/s] 88%|█████████████████████████████████████████████▌      | 8545/9741 [00:23<00:03, 383.48it/s] 88%|█████████████████████████████████████████████▊      | 8584/9741 [00:23<00:03, 382.04it/s] 89%|██████████████████████████████████████████████      | 8623/9741 [00:23<00:02, 382.64it/s] 89%|██████████████████████████████████████████████▏     | 8662/9741 [00:23<00:02, 383.07it/s] 89%|██████████████████████████████████████████████▍     | 8701/9741 [00:24<00:02, 383.88it/s] 90%|██████████████████████████████████████████████▋     | 8740/9741 [00:24<00:02, 383.67it/s] 90%|██████████████████████████████████████████████▊     | 8779/9741 [00:24<00:02, 384.16it/s] 91%|███████████████████████████████████████████████     | 8818/9741 [00:24<00:02, 381.84it/s] 91%|███████████████████████████████████████████████▎    | 8857/9741 [00:24<00:02, 382.78it/s] 91%|███████████████████████████████████████████████▍    | 8896/9741 [00:24<00:02, 383.55it/s] 92%|███████████████████████████████████████████████▋    | 8935/9741 [00:24<00:02, 384.40it/s] 92%|███████████████████████████████████████████████▉    | 8974/9741 [00:24<00:01, 384.80it/s] 93%|████████████████████████████████████████████████    | 9013/9741 [00:24<00:01, 384.69it/s] 93%|████████████████████████████████████████████████▎   | 9052/9741 [00:24<00:01, 382.27it/s] 93%|████████████████████████████████████████████████▌   | 9091/9741 [00:25<00:01, 383.39it/s] 94%|████████████████████████████████████████████████▋   | 9130/9741 [00:25<00:01, 380.79it/s] 94%|████████████████████████████████████████████████▉   | 9169/9741 [00:25<00:01, 381.76it/s] 95%|█████████████████████████████████████████████████▏  | 9208/9741 [00:25<00:01, 382.66it/s] 95%|█████████████████████████████████████████████████▎  | 9247/9741 [00:25<00:01, 383.38it/s] 95%|█████████████████████████████████████████████████▌  | 9286/9741 [00:25<00:01, 381.27it/s] 96%|█████████████████████████████████████████████████▊  | 9325/9741 [00:25<00:01, 382.56it/s] 96%|█████████████████████████████████████████████████▉  | 9364/9741 [00:25<00:00, 383.05it/s] 97%|██████████████████████████████████████████████████▏ | 9403/9741 [00:25<00:00, 383.24it/s] 97%|██████████████████████████████████████████████████▍ | 9442/9741 [00:25<00:00, 383.98it/s] 97%|██████████████████████████████████████████████████▌ | 9481/9741 [00:26<00:00, 384.51it/s] 98%|██████████████████████████████████████████████████▊ | 9520/9741 [00:26<00:00, 381.68it/s] 98%|███████████████████████████████████████████████████ | 9559/9741 [00:26<00:00, 382.57it/s] 99%|███████████████████████████████████████████████████▏| 9598/9741 [00:26<00:00, 382.99it/s] 99%|███████████████████████████████████████████████████▍| 9637/9741 [00:26<00:00, 383.53it/s] 99%|███████████████████████████████████████████████████▋| 9676/9741 [00:26<00:00, 384.28it/s]100%|███████████████████████████████████████████████████▊| 9715/9741 [00:26<00:00, 382.81it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:26<00:00, 364.24it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.59s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.79s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.76s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:06<00:12,  6.12s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.65s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.66s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.54s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:12<00:06,  6.13s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.18s/it]
[2023-08-22 11:28:10,025] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.03s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.21s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.89s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.09s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.40s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.59s/it]
[2023-08-22 11:28:20,280] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 11:28:20,281] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 11:28:20,282] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 11:28:20,282] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 11:28:20,282] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 11:28:20,282] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f4da6d68fd0>
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 11:28:20,283] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f4da0b2b220>
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 11:28:20,284] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 11:28:20,284] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4776015281677246 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]Time to load utils op: 0.4030025005340576 seconds
############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: The car-rental agency charges $30/day for a car, or $190 for the first week for a rental that lasts an entire week or longer. Jennie rented a car for 11 days. How much, in dollars, did she pay for the rental?
Output: 310

Input: A hurricane is approaching the southern coast of Texas, and a rancher is planning to move 400 head of cattle 60 miles to higher ground to protect them from possible inland flooding that might occur.  His animal transport truck holds 20 head of cattle.  Traveling at 60 miles per hour, what is the total driving time, in hours, it will take to transport all of his cattle to higher ground?
Output: 40

Input: Jason has a carriage house that he rents out.  He’s charging $50.00 per day or $500.00 for 14 days.  Eric wants to rent the house for 20 days.  How much will it cost him?
Output: 800

Input: Melissa works on a poultry farm. She drives to town twice each month to buy supplies. If it takes her 3 hours to drive to town and back, how many hours does Melissa spend driving in a year?
Output: 72

Input: The ratio of boys to girls in a family is 5:7. The total number of children in the family is 180. If the boys are given $3900 to share, how much money does each boy receive?
Output: 52

Input: Josephine receives a bill from the hospital for 5000$.  50 percent of the bill is for medication.  25 percent of the remaining bill is for overnight stays, and 175$ is for food.  The rest of the bill is for the ambulance ride.  How much did the ambulance ride cost?
Output: 1700

Input: It was time for Kelly to harvest her carrots that she had planted in three different beds.  In the first bed she pulled out 55 carrots.  In the second bed she pulled out 101 carrots and in the third bed she pulled out 78 carrots.  She found that 6 carrots weighed one pound.  How many pounds of carrots did Kelly harvest?
Output: 39

Input: Iris’ family is planning a surprise birthday party for her. The party will include her 3 uncles and 4 aunts who have a son and daughter each as well as her brother and mother. In total, how many people are coming to Iris’ birthday party?
Output: 23

Input: Lyra bought a pair of shoes at a 20% discount.  If she paid $480, how much was the original price of the pair of shoes?
Output: 600

Input: Rhett has been late on two of his monthly rent payments, but his landlord does not charge late fees and so he will be able to pay their total cost with 3/5 of his next month's salary after taxes. If he is currently paid $5000 per month and has to pay 10% tax, calculate his rent expense per month?
Output: 1350

Input: Ten friends decide to get an end-of-year gift for their teacher. They plan to split the cost of the gift equally. But four of the group drop out. The remaining friends split the cost equally among themselves. If each share is now $8 more, how much does the gift cost, in dollars?
Output: 120

Input: At the feline sanctuary, there were 12 lions, 14 tigers, and several cougars.  If there were half as many cougars as lions and tigers combined, then what was the total number of big cats at the feline sanctuary?
Output: 39

Input: A pea patch is twice as big as a radish patch. If one sixth of the pea patch is 5 square feet.  How much is a whole radish patch in square feet?
Output: 15

Input: Phoebe has two pizzas to share with her and three friends. One has pepperoni and the other has cheese. They both have 16 slices. They all eat the same amount. One friend eats only pepperoni, while the rest have an equal number of slices of each. At the end, there is one slice of pepperoni left and 7 slices of cheese, how many slices does each person eat?
Output: 6

Input: Jeremy buys 30 watermelons. He eats 3 watermelons per week. Each week he gives 2 to his dad. How many weeks will the watermelons last?
Output: 6

Input: Jackson has 5 times more money than Williams. Together, they have $150. How much money, in dollars, does Jackson have?
Output: 125

Input: Janet counts 30 crows on the powerlines and 60% more hawks than crows. How many birds does she count total?
Output: 78

Input: There are 290 liters of oil in 24 cans. If 10 of the cans are holding 8 liters each, how much oil is each of the remaining cans holding?
Output: 15

Input: Bill had to finish a project from work that was to take him 4 days. If he took 6 seven-hour naps in the four days, how long did he spend working on the project?
Output: 54

Input: There are 120 cards in a box. If 2/5 of the cards are red, exactly 5/9 of the remainder are black, and the rest are green, calculate the number of green cards in the box?
Output: 32

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o20-tgsm8k-s30-rFalse
Loading extension module utils...
Time to load utils op: 0.5048489570617676 seconds
Loading extension module utils...
Time to load utils op: 0.5047543048858643 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:40<33:01, 40.45s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:19<31:48, 39.76s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:58<30:53, 39.43s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:37<30:06, 39.27s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:17<29:27, 39.27s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:56<28:43, 39.18s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:35<28:08, 39.26s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:14<27:29, 39.28s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:53<26:49, 39.25s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:33<26:10, 39.26s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [06:55<22:12, 34.16s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:34<22:33, 35.62s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:14<22:39, 36.75s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [08:52<22:24, 37.34s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:33<22:16, 38.18s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:12<21:50, 38.54s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:51<21:15, 38.64s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:30<20:38, 38.72s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:09<20:03, 38.83s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:48<19:29, 38.98s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:27<18:48, 38.92s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [13:52<16:17, 34.92s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:32<16:18, 36.24s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:11<16:03, 37.07s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [15:50<15:44, 37.79s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:29<15:15, 38.16s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:08<14:44, 38.46s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [17:47<14:10, 38.64s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:07<11:31, 32.93s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [18:46<11:35, 34.79s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [19:25<11:26, 36.13s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:05<11:08, 37.13s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [20:44<10:41, 37.76s/it]