PYTHONPATH=/home/ylu130/workspace/in-context-generalization
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o10-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 10
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 11:46:33,946] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o10-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 10
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o10-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  1%|▎                                                     | 49/9741 [00:00<00:19, 486.83it/s]  1%|▌                                                     | 99/9741 [00:00<00:19, 489.39it/s]  2%|▊                                                    | 149/9741 [00:00<00:19, 490.22it/s]  2%|█                                                    | 199/9741 [00:00<00:19, 489.92it/s]  3%|█▎                                                   | 248/9741 [00:00<00:19, 487.38it/s]  3%|█▌                                                   | 297/9741 [00:00<00:19, 488.13it/s]  4%|█▉                                                   | 346/9741 [00:00<00:19, 488.54it/s]  4%|██▏                                                  | 395/9741 [00:00<00:19, 481.92it/s]  5%|██▍                                                  | 444/9741 [00:00<00:19, 480.77it/s]  5%|██▋                                                  | 493/9741 [00:01<00:19, 482.92it/s]  6%|██▉                                                  | 542/9741 [00:01<00:18, 484.85it/s]  6%|███▏                                                 | 591/9741 [00:01<00:19, 475.94it/s]  7%|███▍                                                 | 640/9741 [00:01<00:18, 479.35it/s]  7%|███▋                                                 | 689/9741 [00:01<00:18, 480.33it/s]  8%|████                                                 | 738/9741 [00:01<00:18, 482.55it/s]  8%|████▎                                                | 787/9741 [00:01<00:18, 484.28it/s]  9%|████▌                                                | 836/9741 [00:01<00:18, 483.97it/s]  9%|████▊                                                | 885/9741 [00:01<00:19, 465.32it/s] 10%|█████                                                | 934/9741 [00:01<00:18, 470.62it/s] 10%|█████▎                                               | 982/9741 [00:02<00:18, 468.54it/s] 11%|█████▌                                              | 1031/9741 [00:02<00:18, 472.86it/s] 11%|█████▊                                              | 1081/9741 [00:02<00:18, 478.31it/s] 12%|██████                                              | 1130/9741 [00:02<00:17, 479.70it/s] 12%|██████▎                                             | 1180/9741 [00:02<00:17, 482.77it/s] 13%|██████▋                                             | 1254/9741 [00:02<00:15, 556.82it/s] 14%|███████                                             | 1329/9741 [00:02<00:13, 613.10it/s] 14%|███████▍                                            | 1403/9741 [00:02<00:12, 649.46it/s] 15%|███████▉                                            | 1478/9741 [00:02<00:12, 677.34it/s] 16%|████████▎                                           | 1553/9741 [00:02<00:11, 697.12it/s] 17%|████████▋                                           | 1627/9741 [00:03<00:11, 708.58it/s] 17%|█████████                                           | 1701/9741 [00:03<00:11, 717.72it/s] 18%|█████████▍                                          | 1775/9741 [00:03<00:11, 723.29it/s] 19%|█████████▊                                          | 1848/9741 [00:03<00:11, 700.24it/s] 20%|██████████▎                                         | 1923/9741 [00:03<00:10, 711.96it/s] 21%|██████████▋                                         | 1998/9741 [00:03<00:10, 721.09it/s] 21%|███████████                                         | 2072/9741 [00:03<00:10, 724.22it/s] 22%|███████████▍                                        | 2146/9741 [00:03<00:10, 728.49it/s] 23%|███████████▊                                        | 2221/9741 [00:03<00:10, 732.72it/s] 24%|████████████▎                                       | 2295/9741 [00:03<00:10, 732.61it/s] 24%|████████████▋                                       | 2370/9741 [00:04<00:10, 735.29it/s] 25%|█████████████                                       | 2445/9741 [00:04<00:09, 737.99it/s] 26%|█████████████▍                                      | 2519/9741 [00:04<00:09, 733.71it/s] 27%|█████████████▊                                      | 2593/9741 [00:04<00:09, 732.31it/s] 27%|██████████████▏                                     | 2667/9741 [00:04<00:09, 731.41it/s] 28%|██████████████▋                                     | 2741/9741 [00:04<00:09, 730.99it/s] 29%|███████████████                                     | 2815/9741 [00:04<00:09, 731.89it/s] 30%|███████████████▍                                    | 2890/9741 [00:04<00:09, 735.33it/s] 30%|███████████████▊                                    | 2964/9741 [00:04<00:09, 733.40it/s] 31%|████████████████▏                                   | 3039/9741 [00:04<00:09, 735.73it/s] 32%|████████████████▌                                   | 3113/9741 [00:05<00:08, 736.98it/s] 33%|█████████████████                                   | 3187/9741 [00:05<00:08, 734.61it/s] 33%|█████████████████▍                                  | 3262/9741 [00:05<00:08, 737.12it/s] 34%|█████████████████▊                                  | 3336/9741 [00:05<00:08, 737.59it/s] 35%|██████████████████▏                                 | 3410/9741 [00:05<00:08, 736.56it/s] 36%|██████████████████▌                                 | 3484/9741 [00:05<00:08, 737.38it/s] 37%|██████████████████▉                                 | 3558/9741 [00:05<00:08, 737.99it/s] 37%|███████████████████▍                                | 3632/9741 [00:05<00:08, 730.38it/s] 38%|███████████████████▊                                | 3706/9741 [00:05<00:08, 732.68it/s] 39%|████████████████████▏                               | 3780/9741 [00:05<00:08, 733.14it/s] 40%|████████████████████▌                               | 3854/9741 [00:06<00:08, 706.95it/s] 40%|████████████████████▉                               | 3929/9741 [00:06<00:08, 717.31it/s] 41%|█████████████████████▎                              | 4004/9741 [00:06<00:07, 724.24it/s] 42%|█████████████████████▊                              | 4078/9741 [00:06<00:07, 727.10it/s] 43%|██████████████████████▏                             | 4152/9741 [00:06<00:07, 730.67it/s] 43%|██████████████████████▌                             | 4226/9741 [00:06<00:07, 733.04it/s] 44%|██████████████████████▉                             | 4300/9741 [00:06<00:07, 725.17it/s] 45%|███████████████████████▎                            | 4374/9741 [00:06<00:07, 726.97it/s] 46%|███████████████████████▋                            | 4448/9741 [00:06<00:07, 729.77it/s] 46%|████████████████████████▏                           | 4522/9741 [00:07<00:07, 691.92it/s] 47%|████████████████████████▌                           | 4596/9741 [00:07<00:07, 703.07it/s] 48%|████████████████████████▉                           | 4670/9741 [00:07<00:07, 713.73it/s] 49%|█████████████████████████▎                          | 4742/9741 [00:07<00:09, 522.10it/s] 49%|█████████████████████████▋                          | 4816/9741 [00:07<00:08, 571.75it/s] 50%|██████████████████████████                          | 4890/9741 [00:07<00:07, 612.53it/s] 51%|██████████████████████████▍                         | 4963/9741 [00:07<00:07, 642.33it/s] 52%|██████████████████████████▉                         | 5037/9741 [00:07<00:07, 668.56it/s] 52%|███████████████████████████▎                        | 5111/9741 [00:07<00:06, 688.09it/s] 53%|███████████████████████████▋                        | 5185/9741 [00:08<00:06, 700.58it/s] 54%|████████████████████████████                        | 5259/9741 [00:08<00:06, 711.93it/s] 55%|████████████████████████████▍                       | 5333/9741 [00:08<00:06, 719.33it/s] 55%|████████████████████████████▊                       | 5406/9741 [00:08<00:06, 717.09it/s] 56%|█████████████████████████████▎                      | 5481/9741 [00:08<00:05, 725.30it/s] 57%|█████████████████████████████▋                      | 5558/9741 [00:08<00:05, 738.00it/s] 58%|██████████████████████████████                      | 5634/9741 [00:08<00:05, 742.38it/s] 59%|██████████████████████████████▍                     | 5711/9741 [00:08<00:05, 750.11it/s] 59%|██████████████████████████████▉                     | 5789/9741 [00:08<00:05, 756.83it/s] 60%|███████████████████████████████▎                    | 5866/9741 [00:08<00:05, 758.56it/s] 61%|███████████████████████████████▋                    | 5943/9741 [00:09<00:04, 761.24it/s] 62%|████████████████████████████████▏                   | 6020/9741 [00:09<00:04, 763.74it/s] 63%|████████████████████████████████▌                   | 6097/9741 [00:09<00:04, 763.78it/s] 63%|████████████████████████████████▉                   | 6174/9741 [00:09<00:04, 765.28it/s] 64%|█████████████████████████████████▎                  | 6251/9741 [00:09<00:04, 766.26it/s] 65%|█████████████████████████████████▊                  | 6328/9741 [00:09<00:04, 763.49it/s] 66%|██████████████████████████████████▏                 | 6405/9741 [00:09<00:04, 754.98it/s] 67%|██████████████████████████████████▌                 | 6481/9741 [00:09<00:04, 755.41it/s] 67%|███████████████████████████████████                 | 6557/9741 [00:09<00:04, 754.65it/s] 68%|███████████████████████████████████▍                | 6634/9741 [00:09<00:04, 758.39it/s] 69%|███████████████████████████████████▊                | 6711/9741 [00:10<00:03, 759.11it/s] 70%|████████████████████████████████████▏               | 6787/9741 [00:10<00:03, 759.26it/s] 70%|████████████████████████████████████▋               | 6864/9741 [00:10<00:03, 760.70it/s] 71%|█████████████████████████████████████               | 6941/9741 [00:10<00:03, 762.21it/s] 72%|█████████████████████████████████████▍              | 7018/9741 [00:10<00:03, 760.52it/s] 73%|█████████████████████████████████████▉              | 7096/9741 [00:10<00:03, 763.49it/s] 74%|██████████████████████████████████████▎             | 7173/9741 [00:10<00:03, 764.33it/s] 74%|██████████████████████████████████████▋             | 7250/9741 [00:10<00:03, 761.60it/s] 75%|███████████████████████████████████████             | 7327/9741 [00:10<00:03, 758.93it/s] 76%|███████████████████████████████████████▌            | 7404/9741 [00:11<00:03, 760.43it/s] 77%|███████████████████████████████████████▉            | 7481/9741 [00:11<00:03, 711.61it/s] 78%|████████████████████████████████████████▎           | 7558/9741 [00:11<00:03, 726.10it/s] 78%|████████████████████████████████████████▊           | 7635/9741 [00:11<00:02, 737.89it/s] 79%|█████████████████████████████████████████▏          | 7711/9741 [00:11<00:02, 744.05it/s] 80%|█████████████████████████████████████████▌          | 7789/9741 [00:11<00:02, 752.16it/s] 81%|█████████████████████████████████████████▉          | 7866/9741 [00:11<00:02, 757.19it/s] 82%|██████████████████████████████████████████▍         | 7942/9741 [00:11<00:02, 757.29it/s] 82%|██████████████████████████████████████████▊         | 8018/9741 [00:11<00:02, 757.55it/s] 83%|███████████████████████████████████████████▏        | 8094/9741 [00:11<00:02, 754.22it/s] 84%|███████████████████████████████████████████▌        | 8170/9741 [00:12<00:02, 748.44it/s] 85%|████████████████████████████████████████████        | 8247/9741 [00:12<00:01, 752.93it/s] 85%|████████████████████████████████████████████▍       | 8324/9741 [00:12<00:01, 755.04it/s] 86%|████████████████████████████████████████████▊       | 8400/9741 [00:12<00:01, 752.01it/s] 87%|█████████████████████████████████████████████▎      | 8477/9741 [00:12<00:01, 756.23it/s] 88%|█████████████████████████████████████████████▋      | 8554/9741 [00:12<00:01, 759.64it/s] 89%|██████████████████████████████████████████████      | 8630/9741 [00:12<00:01, 759.49it/s] 89%|██████████████████████████████████████████████▍     | 8707/9741 [00:12<00:01, 762.30it/s] 90%|██████████████████████████████████████████████▉     | 8784/9741 [00:12<00:01, 763.95it/s] 91%|███████████████████████████████████████████████▎    | 8861/9741 [00:12<00:01, 762.22it/s] 92%|███████████████████████████████████████████████▋    | 8938/9741 [00:13<00:01, 764.43it/s] 93%|████████████████████████████████████████████████    | 9015/9741 [00:13<00:00, 764.79it/s] 93%|████████████████████████████████████████████████▌   | 9092/9741 [00:13<00:00, 760.61it/s] 94%|████████████████████████████████████████████████▉   | 9169/9741 [00:13<00:00, 762.25it/s] 95%|█████████████████████████████████████████████████▎  | 9246/9741 [00:13<00:00, 763.58it/s] 96%|█████████████████████████████████████████████████▊  | 9323/9741 [00:13<00:00, 760.88it/s] 96%|██████████████████████████████████████████████████▏ | 9400/9741 [00:13<00:00, 761.78it/s] 97%|██████████████████████████████████████████████████▌ | 9477/9741 [00:13<00:00, 762.42it/s] 98%|███████████████████████████████████████████████████ | 9554/9741 [00:13<00:00, 760.98it/s] 99%|███████████████████████████████████████████████████▍| 9631/9741 [00:13<00:00, 757.55it/s]100%|███████████████████████████████████████████████████▊| 9707/9741 [00:14<00:00, 757.64it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:14<00:00, 690.88it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.70s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.63s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.62s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:06<00:12,  6.26s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.55s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.68s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.55s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.87s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.98s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.17s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.04s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.19s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.17s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.28s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.34s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.53s/it]
[2023-08-21 11:47:42,126] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 11:47:54,626] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 11:47:54,627] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 11:47:54,627] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 11:47:54,627] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 11:47:54,627] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 11:47:54,627] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f4726528f40>
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f46fdf2edc0>
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 11:47:54,628] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 11:47:54,629] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 11:47:54,629] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.448444128036499 seconds
Loading extension module utils...
Time to load utils op: 0.40442609786987305 seconds
Loading extension module utils...
Time to load utils op: 0.504676103591919 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o10-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.5050630569458008 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:46<37:57, 46.47s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:33<37:19, 46.65s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:19<36:16, 46.32s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [03:07<35:58, 46.93s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:53<34:59, 46.66s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:24<30:28, 41.55s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:05<29:35, 41.28s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:52<30:02, 42.93s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:27<27:45, 40.62s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:14<28:28, 42.70s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:50<26:18, 40.47s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:36<26:45, 42.26s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:24<27:02, 43.86s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:11<26:55, 44.88s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:59<26:39, 45.69s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:45<25:57, 45.81s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:31<25:16, 45.95s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [13:18<24:41, 46.30s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [14:05<24:01, 46.49s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:52<23:18, 46.63s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [15:31<21:23, 44.25s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [16:17<20:57, 44.92s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [17:05<20:34, 45.71s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [17:45<19:07, 44.14s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [18:32<18:43, 44.95s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [19:18<18:03, 45.16s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [19:53<16:08, 42.11s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [20:39<15:52, 43.30s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [21:26<15:31, 44.38s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [22:12<14:58, 44.95s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [22:59<14:25, 45.56s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [23:46<13:48, 46.02s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [24:33<13:07, 46.33s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [25:20<12:25, 46.61s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [26:02<11:19, 45.27s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [26:38<09:53, 42.39s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [27:25<09:29, 43.81s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [28:09<08:46, 43.89s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [28:56<08:12, 44.79s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [29:43<07:35, 45.50s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [30:30<06:51, 45.77s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [30:58<05:25, 40.63s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [31:45<04:58, 42.58s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [32:33<04:23, 43.91s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [33:10<03:30, 42.04s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [33:57<02:54, 43.57s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [34:44<02:13, 44.41s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [35:30<01:30, 45.02s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [36:17<00:45, 45.69s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [36:43<00:00, 39.77s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [36:43<00:00, 44.08s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.0272} | lm_loss 7.9754 | avg. gen lenth: 272.076
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o11-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 11
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 12:26:37,610] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o11-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 11
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o11-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▎                                                     | 46/9741 [00:00<00:21, 453.50it/s]  1%|▌                                                     | 92/9741 [00:00<00:21, 455.64it/s]  1%|▊                                                    | 138/9741 [00:00<00:21, 456.91it/s]  2%|█                                                    | 184/9741 [00:00<00:20, 456.25it/s]  2%|█▎                                                   | 230/9741 [00:00<00:20, 454.45it/s]  3%|█▌                                                   | 276/9741 [00:00<00:20, 454.68it/s]  3%|█▊                                                   | 322/9741 [00:00<00:20, 455.35it/s]  4%|██                                                   | 368/9741 [00:00<00:20, 449.84it/s]  4%|██▎                                                  | 414/9741 [00:00<00:20, 451.17it/s]  5%|██▌                                                  | 460/9741 [00:01<00:20, 450.37it/s]  5%|██▊                                                  | 506/9741 [00:01<00:20, 451.57it/s]  6%|███                                                  | 552/9741 [00:01<00:20, 452.71it/s]  6%|███▎                                                 | 598/9741 [00:01<00:20, 452.95it/s]  7%|███▌                                                 | 644/9741 [00:01<00:20, 453.28it/s]  7%|███▊                                                 | 690/9741 [00:01<00:20, 451.94it/s]  8%|████                                                 | 736/9741 [00:01<00:19, 452.11it/s]  8%|████▎                                                | 782/9741 [00:01<00:19, 453.09it/s]  9%|████▌                                                | 832/9741 [00:01<00:19, 465.55it/s]  9%|████▉                                                | 900/9741 [00:01<00:16, 529.16it/s] 10%|█████▎                                               | 969/9741 [00:02<00:15, 577.10it/s] 11%|█████▌                                              | 1038/9741 [00:02<00:14, 610.54it/s] 11%|█████▉                                              | 1107/9741 [00:02<00:13, 634.16it/s] 12%|██████▎                                             | 1176/9741 [00:02<00:13, 648.39it/s] 13%|██████▋                                             | 1245/9741 [00:02<00:12, 659.65it/s] 13%|███████                                             | 1315/9741 [00:02<00:12, 668.80it/s] 14%|███████▍                                            | 1383/9741 [00:02<00:12, 671.85it/s] 15%|███████▊                                            | 1452/9741 [00:02<00:12, 676.42it/s] 16%|████████                                            | 1521/9741 [00:02<00:12, 680.07it/s] 16%|████████▍                                           | 1590/9741 [00:02<00:11, 680.26it/s] 17%|████████▊                                           | 1659/9741 [00:03<00:11, 682.82it/s] 18%|█████████▏                                          | 1728/9741 [00:03<00:11, 679.51it/s] 18%|█████████▌                                          | 1796/9741 [00:03<00:12, 653.31it/s] 19%|█████████▉                                          | 1865/9741 [00:03<00:11, 662.70it/s] 20%|██████████▎                                         | 1934/9741 [00:03<00:11, 669.26it/s] 21%|██████████▋                                         | 2003/9741 [00:03<00:11, 674.66it/s] 21%|███████████                                         | 2071/9741 [00:03<00:11, 674.37it/s] 22%|███████████▍                                        | 2140/9741 [00:03<00:11, 677.26it/s] 23%|███████████▊                                        | 2209/9741 [00:03<00:11, 680.17it/s] 23%|████████████▏                                       | 2278/9741 [00:03<00:10, 679.54it/s] 24%|████████████▌                                       | 2347/9741 [00:04<00:10, 681.31it/s] 25%|████████████▉                                       | 2416/9741 [00:04<00:10, 683.78it/s] 26%|█████████████▎                                      | 2485/9741 [00:04<00:10, 682.21it/s] 26%|█████████████▋                                      | 2554/9741 [00:04<00:10, 682.89it/s] 27%|██████████████                                      | 2623/9741 [00:04<00:10, 677.66it/s] 28%|██████████████▎                                     | 2692/9741 [00:04<00:10, 679.62it/s] 28%|██████████████▋                                     | 2760/9741 [00:04<00:10, 677.71it/s] 29%|███████████████                                     | 2829/9741 [00:04<00:10, 679.02it/s] 30%|███████████████▍                                    | 2898/9741 [00:04<00:10, 681.20it/s] 30%|███████████████▊                                    | 2967/9741 [00:04<00:09, 680.45it/s] 31%|████████████████▏                                   | 3036/9741 [00:05<00:09, 681.95it/s] 32%|████████████████▌                                   | 3105/9741 [00:05<00:09, 683.17it/s] 33%|████████████████▉                                   | 3174/9741 [00:05<00:09, 681.63it/s] 33%|█████████████████▎                                  | 3243/9741 [00:05<00:09, 683.45it/s] 34%|█████████████████▋                                  | 3312/9741 [00:05<00:09, 684.47it/s] 35%|██████████████████                                  | 3381/9741 [00:05<00:09, 682.26it/s] 35%|██████████████████▍                                 | 3450/9741 [00:05<00:09, 683.29it/s] 36%|██████████████████▊                                 | 3519/9741 [00:05<00:09, 675.65it/s] 37%|███████████████████▏                                | 3588/9741 [00:05<00:09, 677.72it/s] 38%|███████████████████▌                                | 3656/9741 [00:05<00:09, 673.84it/s] 38%|███████████████████▉                                | 3725/9741 [00:06<00:08, 677.60it/s] 39%|████████████████████▎                               | 3794/9741 [00:06<00:08, 680.03it/s] 40%|████████████████████▌                               | 3863/9741 [00:06<00:08, 679.53it/s] 40%|████████████████████▉                               | 3932/9741 [00:06<00:08, 681.17it/s] 41%|█████████████████████▎                              | 4001/9741 [00:06<00:08, 682.26it/s] 42%|█████████████████████▋                              | 4070/9741 [00:06<00:08, 680.97it/s] 42%|██████████████████████                              | 4139/9741 [00:06<00:08, 682.25it/s] 43%|██████████████████████▍                             | 4208/9741 [00:06<00:08, 682.63it/s] 44%|██████████████████████▊                             | 4277/9741 [00:06<00:07, 683.89it/s] 45%|███████████████████████▏                            | 4346/9741 [00:06<00:07, 682.96it/s] 45%|███████████████████████▌                            | 4415/9741 [00:07<00:07, 682.82it/s] 46%|███████████████████████▉                            | 4484/9741 [00:07<00:07, 683.35it/s] 47%|████████████████████████▎                           | 4553/9741 [00:07<00:08, 633.67it/s] 47%|████████████████████████▋                           | 4622/9741 [00:07<00:07, 648.51it/s] 48%|█████████████████████████                           | 4691/9741 [00:07<00:07, 659.51it/s] 49%|█████████████████████████▍                          | 4758/9741 [00:07<00:09, 528.23it/s] 50%|█████████████████████████▊                          | 4827/9741 [00:07<00:08, 567.26it/s] 50%|██████████████████████████▏                         | 4896/9741 [00:07<00:08, 597.96it/s] 51%|██████████████████████████▍                         | 4964/9741 [00:08<00:07, 619.37it/s] 52%|██████████████████████████▊                         | 5033/9741 [00:08<00:07, 636.50it/s] 52%|███████████████████████████▏                        | 5102/9741 [00:08<00:07, 650.19it/s] 53%|███████████████████████████▌                        | 5171/9741 [00:08<00:06, 658.42it/s] 54%|███████████████████████████▉                        | 5240/9741 [00:08<00:06, 665.40it/s] 55%|████████████████████████████▎                       | 5309/9741 [00:08<00:06, 671.71it/s] 55%|████████████████████████████▋                       | 5378/9741 [00:08<00:06, 675.37it/s] 56%|█████████████████████████████                       | 5446/9741 [00:08<00:06, 675.55it/s] 57%|█████████████████████████████▍                      | 5515/9741 [00:08<00:06, 679.10it/s] 57%|█████████████████████████████▊                      | 5587/9741 [00:08<00:06, 689.62it/s] 58%|██████████████████████████████▏                     | 5658/9741 [00:09<00:05, 694.20it/s] 59%|██████████████████████████████▌                     | 5730/9741 [00:09<00:05, 700.82it/s] 60%|██████████████████████████████▉                     | 5802/9741 [00:09<00:05, 705.01it/s] 60%|███████████████████████████████▎                    | 5873/9741 [00:09<00:05, 704.99it/s] 61%|███████████████████████████████▋                    | 5945/9741 [00:09<00:05, 708.24it/s] 62%|████████████████████████████████                    | 6017/9741 [00:09<00:05, 710.47it/s] 63%|████████████████████████████████▌                   | 6089/9741 [00:09<00:05, 708.74it/s] 63%|████████████████████████████████▉                   | 6161/9741 [00:09<00:05, 710.41it/s] 64%|█████████████████████████████████▎                  | 6233/9741 [00:09<00:04, 710.98it/s] 65%|█████████████████████████████████▋                  | 6305/9741 [00:09<00:04, 711.65it/s] 65%|██████████████████████████████████                  | 6377/9741 [00:10<00:04, 710.59it/s] 66%|██████████████████████████████████▍                 | 6449/9741 [00:10<00:04, 711.67it/s] 67%|██████████████████████████████████▊                 | 6521/9741 [00:10<00:04, 711.17it/s] 68%|███████████████████████████████████▏                | 6593/9741 [00:10<00:04, 709.43it/s] 68%|███████████████████████████████████▌                | 6665/9741 [00:10<00:04, 710.93it/s] 69%|███████████████████████████████████▉                | 6737/9741 [00:10<00:04, 711.84it/s] 70%|████████████████████████████████████▎               | 6809/9741 [00:10<00:04, 710.99it/s] 71%|████████████████████████████████████▋               | 6881/9741 [00:10<00:04, 711.17it/s] 71%|█████████████████████████████████████               | 6953/9741 [00:10<00:03, 711.85it/s] 72%|█████████████████████████████████████▌              | 7025/9741 [00:10<00:03, 710.11it/s] 73%|█████████████████████████████████████▉              | 7097/9741 [00:11<00:03, 711.61it/s] 74%|██████████████████████████████████████▎             | 7169/9741 [00:11<00:03, 712.73it/s] 74%|██████████████████████████████████████▋             | 7241/9741 [00:11<00:03, 710.56it/s] 75%|███████████████████████████████████████             | 7313/9741 [00:11<00:03, 711.22it/s] 76%|███████████████████████████████████████▍            | 7385/9741 [00:11<00:03, 712.27it/s] 77%|███████████████████████████████████████▊            | 7457/9741 [00:11<00:03, 679.26it/s] 77%|████████████████████████████████████████▏           | 7528/9741 [00:11<00:03, 687.79it/s] 78%|████████████████████████████████████████▌           | 7600/9741 [00:11<00:03, 695.52it/s] 79%|████████████████████████████████████████▉           | 7671/9741 [00:11<00:02, 698.19it/s] 79%|█████████████████████████████████████████▎          | 7743/9741 [00:11<00:02, 702.30it/s] 80%|█████████████████████████████████████████▋          | 7815/9741 [00:12<00:02, 705.27it/s] 81%|██████████████████████████████████████████          | 7886/9741 [00:12<00:02, 705.84it/s] 82%|██████████████████████████████████████████▍         | 7957/9741 [00:12<00:02, 706.09it/s] 82%|██████████████████████████████████████████▊         | 8029/9741 [00:12<00:02, 708.54it/s] 83%|███████████████████████████████████████████▏        | 8101/9741 [00:12<00:02, 710.23it/s] 84%|███████████████████████████████████████████▋        | 8173/9741 [00:12<00:02, 709.24it/s] 85%|████████████████████████████████████████████        | 8245/9741 [00:12<00:02, 710.97it/s] 85%|████████████████████████████████████████████▍       | 8317/9741 [00:12<00:02, 711.02it/s] 86%|████████████████████████████████████████████▊       | 8389/9741 [00:12<00:01, 709.48it/s] 87%|█████████████████████████████████████████████▏      | 8461/9741 [00:12<00:01, 711.09it/s] 88%|█████████████████████████████████████████████▌      | 8533/9741 [00:13<00:01, 711.60it/s] 88%|█████████████████████████████████████████████▉      | 8605/9741 [00:13<00:01, 709.75it/s] 89%|██████████████████████████████████████████████▎     | 8677/9741 [00:13<00:01, 710.12it/s] 90%|██████████████████████████████████████████████▋     | 8749/9741 [00:13<00:01, 711.07it/s] 91%|███████████████████████████████████████████████     | 8821/9741 [00:13<00:01, 708.97it/s] 91%|███████████████████████████████████████████████▍    | 8893/9741 [00:13<00:01, 709.99it/s] 92%|███████████████████████████████████████████████▊    | 8965/9741 [00:13<00:01, 711.13it/s] 93%|████████████████████████████████████████████████▏   | 9037/9741 [00:13<00:00, 709.76it/s] 94%|████████████████████████████████████████████████▌   | 9108/9741 [00:13<00:00, 705.40it/s] 94%|█████████████████████████████████████████████████   | 9180/9741 [00:13<00:00, 707.81it/s] 95%|█████████████████████████████████████████████████▍  | 9252/9741 [00:14<00:00, 709.22it/s] 96%|█████████████████████████████████████████████████▊  | 9323/9741 [00:14<00:00, 708.17it/s] 96%|██████████████████████████████████████████████████▏ | 9395/9741 [00:14<00:00, 709.95it/s] 97%|██████████████████████████████████████████████████▌ | 9467/9741 [00:14<00:00, 710.75it/s] 98%|██████████████████████████████████████████████████▉ | 9539/9741 [00:14<00:00, 709.20it/s] 99%|███████████████████████████████████████████████████▎| 9611/9741 [00:14<00:00, 710.06it/s] 99%|███████████████████████████████████████████████████▋| 9683/9741 [00:14<00:00, 710.63it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:14<00:00, 658.97it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.96s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.07s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.29s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.99s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.23s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.26s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.41s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.57s/it]
[2023-08-21 12:27:43,684] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.39s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.55s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.83s/it]
[2023-08-21 12:27:57,340] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 12:27:57,341] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f5413384f40>
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 12:27:57,342] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f54135fedc0>
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 12:27:57,343] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 12:27:57,343] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.45584940910339355 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o11-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.40461039543151855 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.4043731689453125 seconds
Time to load utils op: 0.4045078754425049 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:45<37:20, 45.73s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:32<37:08, 46.42s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:18<36:02, 46.02s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [03:04<35:28, 46.28s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:44<32:57, 43.94s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:30<32:46, 44.68s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:16<32:20, 45.12s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:54<29:50, 42.64s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:39<29:48, 43.62s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:25<29:32, 44.32s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [08:11<29:03, 44.70s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:57<28:34, 45.12s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:43<27:55, 45.28s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:14<24:37, 41.05s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [11:00<24:51, 42.63s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:47<24:55, 43.99s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:34<24:37, 44.78s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [13:16<23:27, 43.97s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [14:02<23:01, 44.56s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:37<20:49, 41.64s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:55<16:41, 34.54s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:41<17:45, 38.04s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:27<18:11, 40.44s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [17:01<16:44, 38.62s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:47<17:01, 40.86s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:34<16:58, 42.43s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [19:14<16:00, 41.76s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [20:00<15:48, 43.12s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:42<14:57, 42.72s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [21:28<14:34, 43.73s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [22:15<14:08, 44.66s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [23:01<13:33, 45.20s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [23:47<12:53, 45.49s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [24:34<12:12, 45.80s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [25:20<11:29, 45.99s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [26:06<10:42, 45.88s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [26:43<09:20, 43.11s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [27:29<08:50, 44.19s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [28:15<08:12, 44.78s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [29:02<07:31, 45.16s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [29:48<06:50, 45.61s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [30:35<06:07, 45.97s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [31:14<05:06, 43.75s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [32:00<04:27, 44.59s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [32:47<03:45, 45.18s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [33:33<03:02, 45.51s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [34:20<02:17, 45.93s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [35:05<01:31, 45.58s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [35:28<00:38, 38.79s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [36:14<00:00, 41.03s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [36:14<00:00, 43.49s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.1037} | lm_loss 8.0399 | avg. gen lenth: 277.984
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o12-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 12
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 13:04:21,422] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o12-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 12
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o12-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 43/9741 [00:00<00:22, 422.83it/s]  1%|▍                                                     | 86/9741 [00:00<00:22, 425.08it/s]  1%|▋                                                    | 129/9741 [00:00<00:22, 426.26it/s]  2%|▉                                                    | 172/9741 [00:00<00:22, 426.87it/s]  2%|█▏                                                   | 215/9741 [00:00<00:22, 423.76it/s]  3%|█▍                                                   | 258/9741 [00:00<00:22, 424.71it/s]  3%|█▋                                                   | 301/9741 [00:00<00:22, 418.73it/s]  4%|█▊                                                   | 344/9741 [00:00<00:22, 419.66it/s]  4%|██                                                   | 387/9741 [00:00<00:22, 421.39it/s]  4%|██▎                                                  | 430/9741 [00:01<00:22, 420.76it/s]  5%|██▌                                                  | 473/9741 [00:01<00:21, 422.71it/s]  5%|██▊                                                  | 516/9741 [00:01<00:21, 424.15it/s]  6%|███                                                  | 559/9741 [00:01<00:21, 424.45it/s]  6%|███▎                                                 | 602/9741 [00:01<00:21, 424.98it/s]  7%|███▌                                                 | 645/9741 [00:01<00:21, 425.40it/s]  7%|███▋                                                 | 688/9741 [00:01<00:21, 424.44it/s]  8%|███▉                                                 | 731/9741 [00:01<00:21, 420.41it/s]  8%|████▏                                                | 774/9741 [00:01<00:21, 421.60it/s]  8%|████▍                                                | 817/9741 [00:01<00:21, 423.17it/s]  9%|████▋                                                | 860/9741 [00:02<00:20, 424.36it/s]  9%|████▉                                                | 903/9741 [00:02<00:20, 423.11it/s] 10%|█████▏                                               | 946/9741 [00:02<00:20, 423.97it/s] 10%|█████▍                                               | 989/9741 [00:02<00:20, 424.82it/s] 11%|█████▌                                              | 1032/9741 [00:02<00:20, 425.45it/s] 11%|█████▊                                              | 1088/9741 [00:02<00:18, 464.50it/s] 12%|██████▏                                             | 1152/9741 [00:02<00:16, 514.91it/s] 12%|██████▍                                             | 1216/9741 [00:02<00:15, 552.04it/s] 13%|██████▊                                             | 1280/9741 [00:02<00:14, 578.15it/s] 14%|███████▏                                            | 1344/9741 [00:02<00:14, 594.43it/s] 14%|███████▌                                            | 1408/9741 [00:03<00:13, 607.86it/s] 15%|███████▊                                            | 1473/9741 [00:03<00:13, 617.75it/s] 16%|████████▏                                           | 1538/9741 [00:03<00:13, 624.55it/s] 16%|████████▌                                           | 1602/9741 [00:03<00:12, 626.88it/s] 17%|████████▉                                           | 1667/9741 [00:03<00:12, 631.96it/s] 18%|█████████▏                                          | 1732/9741 [00:03<00:12, 634.85it/s] 18%|█████████▌                                          | 1796/9741 [00:03<00:12, 611.56it/s] 19%|█████████▉                                          | 1860/9741 [00:03<00:12, 619.45it/s] 20%|██████████▎                                         | 1924/9741 [00:03<00:12, 625.40it/s] 20%|██████████▌                                         | 1988/9741 [00:03<00:12, 628.81it/s] 21%|██████████▉                                         | 2051/9741 [00:04<00:12, 628.64it/s] 22%|███████████▎                                        | 2115/9741 [00:04<00:12, 631.40it/s] 22%|███████████▋                                        | 2179/9741 [00:04<00:11, 633.92it/s] 23%|███████████▉                                        | 2243/9741 [00:04<00:11, 629.16it/s] 24%|████████████▎                                       | 2307/9741 [00:04<00:11, 631.91it/s] 24%|████████████▋                                       | 2371/9741 [00:04<00:11, 633.68it/s] 25%|█████████████                                       | 2436/9741 [00:04<00:11, 636.12it/s] 26%|█████████████▎                                      | 2500/9741 [00:04<00:11, 634.15it/s] 26%|█████████████▋                                      | 2564/9741 [00:04<00:11, 635.36it/s] 27%|██████████████                                      | 2629/9741 [00:04<00:11, 637.21it/s] 28%|██████████████▍                                     | 2693/9741 [00:05<00:11, 637.06it/s] 28%|██████████████▋                                     | 2757/9741 [00:05<00:11, 634.33it/s] 29%|███████████████                                     | 2821/9741 [00:05<00:10, 631.93it/s] 30%|███████████████▍                                    | 2886/9741 [00:05<00:10, 634.59it/s] 30%|███████████████▋                                    | 2950/9741 [00:05<00:10, 633.88it/s] 31%|████████████████                                    | 3015/9741 [00:05<00:10, 636.21it/s] 32%|████████████████▍                                   | 3079/9741 [00:05<00:10, 629.78it/s] 32%|████████████████▊                                   | 3143/9741 [00:05<00:10, 632.28it/s] 33%|█████████████████                                   | 3207/9741 [00:05<00:10, 631.95it/s] 34%|█████████████████▍                                  | 3271/9741 [00:05<00:10, 634.14it/s] 34%|█████████████████▊                                  | 3335/9741 [00:06<00:10, 635.20it/s] 35%|██████████████████▏                                 | 3399/9741 [00:06<00:10, 633.05it/s] 36%|██████████████████▍                                 | 3463/9741 [00:06<00:09, 634.71it/s] 36%|██████████████████▊                                 | 3527/9741 [00:06<00:09, 635.86it/s] 37%|███████████████████▏                                | 3591/9741 [00:06<00:09, 636.67it/s] 38%|███████████████████▌                                | 3655/9741 [00:06<00:09, 635.31it/s] 38%|███████████████████▊                                | 3720/9741 [00:06<00:09, 636.84it/s] 39%|████████████████████▏                               | 3785/9741 [00:06<00:09, 637.89it/s] 40%|████████████████████▌                               | 3849/9741 [00:06<00:09, 635.49it/s] 40%|████████████████████▉                               | 3913/9741 [00:06<00:09, 630.34it/s] 41%|█████████████████████▏                              | 3977/9741 [00:07<00:09, 633.14it/s] 41%|█████████████████████▌                              | 4041/9741 [00:07<00:08, 635.04it/s] 42%|█████████████████████▉                              | 4105/9741 [00:07<00:08, 632.68it/s] 43%|██████████████████████▎                             | 4169/9741 [00:07<00:08, 634.77it/s] 43%|██████████████████████▌                             | 4233/9741 [00:07<00:08, 635.68it/s] 44%|██████████████████████▉                             | 4297/9741 [00:07<00:08, 634.11it/s] 45%|███████████████████████▎                            | 4361/9741 [00:07<00:08, 635.15it/s] 45%|███████████████████████▌                            | 4425/9741 [00:07<00:08, 635.67it/s] 46%|███████████████████████▉                            | 4489/9741 [00:07<00:08, 636.54it/s] 47%|████████████████████████▎                           | 4553/9741 [00:08<00:08, 587.26it/s] 47%|████████████████████████▋                           | 4617/9741 [00:08<00:08, 602.07it/s] 48%|████████████████████████▉                           | 4681/9741 [00:08<00:08, 612.86it/s] 49%|█████████████████████████▎                          | 4743/9741 [00:08<00:11, 450.69it/s] 49%|█████████████████████████▋                          | 4807/9741 [00:08<00:09, 494.65it/s] 50%|██████████████████████████                          | 4871/9741 [00:08<00:09, 530.01it/s] 51%|██████████████████████████▎                         | 4935/9741 [00:08<00:08, 558.22it/s] 51%|██████████████████████████▋                         | 4999/9741 [00:08<00:08, 578.09it/s] 52%|███████████████████████████                         | 5063/9741 [00:08<00:07, 595.12it/s] 53%|███████████████████████████▎                        | 5127/9741 [00:09<00:07, 607.32it/s] 53%|███████████████████████████▋                        | 5190/9741 [00:09<00:07, 613.83it/s] 54%|████████████████████████████                        | 5254/9741 [00:09<00:07, 620.72it/s] 55%|████████████████████████████▍                       | 5318/9741 [00:09<00:07, 625.18it/s] 55%|████████████████████████████▋                       | 5382/9741 [00:09<00:06, 628.64it/s] 56%|█████████████████████████████                       | 5446/9741 [00:09<00:06, 629.04it/s] 57%|█████████████████████████████▍                      | 5512/9741 [00:09<00:06, 636.40it/s] 57%|█████████████████████████████▊                      | 5579/9741 [00:09<00:06, 644.32it/s] 58%|██████████████████████████████▏                     | 5645/9741 [00:09<00:06, 646.37it/s] 59%|██████████████████████████████▍                     | 5712/9741 [00:09<00:06, 651.75it/s] 59%|██████████████████████████████▊                     | 5779/9741 [00:10<00:06, 655.20it/s] 60%|███████████████████████████████▏                    | 5846/9741 [00:10<00:05, 657.58it/s] 61%|███████████████████████████████▌                    | 5912/9741 [00:10<00:05, 657.41it/s] 61%|███████████████████████████████▉                    | 5979/9741 [00:10<00:05, 660.73it/s] 62%|████████████████████████████████▎                   | 6046/9741 [00:10<00:05, 662.64it/s] 63%|████████████████████████████████▋                   | 6113/9741 [00:10<00:05, 660.72it/s] 63%|████████████████████████████████▉                   | 6180/9741 [00:10<00:05, 661.74it/s] 64%|█████████████████████████████████▎                  | 6247/9741 [00:10<00:05, 661.54it/s] 65%|█████████████████████████████████▋                  | 6314/9741 [00:10<00:05, 659.02it/s] 66%|██████████████████████████████████                  | 6381/9741 [00:10<00:05, 660.91it/s] 66%|██████████████████████████████████▍                 | 6448/9741 [00:11<00:04, 661.62it/s] 67%|██████████████████████████████████▊                 | 6515/9741 [00:11<00:04, 661.38it/s] 68%|███████████████████████████████████▏                | 6582/9741 [00:11<00:04, 659.01it/s] 68%|███████████████████████████████████▍                | 6649/9741 [00:11<00:04, 660.23it/s] 69%|███████████████████████████████████▊                | 6716/9741 [00:11<00:04, 660.44it/s] 70%|████████████████████████████████████▏               | 6783/9741 [00:11<00:04, 659.59it/s] 70%|████████████████████████████████████▌               | 6850/9741 [00:11<00:04, 660.30it/s] 71%|████████████████████████████████████▉               | 6917/9741 [00:11<00:04, 660.84it/s] 72%|█████████████████████████████████████▎              | 6984/9741 [00:11<00:04, 661.78it/s] 72%|█████████████████████████████████████▋              | 7051/9741 [00:11<00:04, 659.95it/s] 73%|█████████████████████████████████████▉              | 7118/9741 [00:12<00:03, 661.70it/s] 74%|██████████████████████████████████████▎             | 7185/9741 [00:12<00:03, 662.95it/s] 74%|██████████████████████████████████████▋             | 7252/9741 [00:12<00:03, 660.72it/s] 75%|███████████████████████████████████████             | 7319/9741 [00:12<00:03, 661.53it/s] 76%|███████████████████████████████████████▍            | 7386/9741 [00:12<00:03, 662.01it/s] 77%|███████████████████████████████████████▊            | 7453/9741 [00:12<00:03, 629.57it/s] 77%|████████████████████████████████████████▏           | 7520/9741 [00:12<00:03, 638.58it/s] 78%|████████████████████████████████████████▍           | 7586/9741 [00:12<00:03, 644.77it/s] 79%|████████████████████████████████████████▊           | 7653/9741 [00:12<00:03, 650.85it/s] 79%|█████████████████████████████████████████▏          | 7719/9741 [00:13<00:03, 652.33it/s] 80%|█████████████████████████████████████████▌          | 7786/9741 [00:13<00:02, 655.65it/s] 81%|█████████████████████████████████████████▉          | 7853/9741 [00:13<00:02, 658.28it/s] 81%|██████████████████████████████████████████▎         | 7919/9741 [00:13<00:02, 654.78it/s] 82%|██████████████████████████████████████████▋         | 7986/9741 [00:13<00:02, 656.70it/s] 83%|██████████████████████████████████████████▉         | 8053/9741 [00:13<00:02, 657.86it/s] 83%|███████████████████████████████████████████▎        | 8120/9741 [00:13<00:02, 658.18it/s] 84%|███████████████████████████████████████████▋        | 8187/9741 [00:13<00:02, 660.86it/s] 85%|████████████████████████████████████████████        | 8254/9741 [00:13<00:02, 661.52it/s] 85%|████████████████████████████████████████████▍       | 8321/9741 [00:13<00:02, 661.14it/s] 86%|████████████████████████████████████████████▊       | 8388/9741 [00:14<00:02, 658.78it/s] 87%|█████████████████████████████████████████████▏      | 8455/9741 [00:14<00:01, 659.61it/s] 87%|█████████████████████████████████████████████▍      | 8522/9741 [00:14<00:01, 660.92it/s] 88%|█████████████████████████████████████████████▊      | 8589/9741 [00:14<00:01, 658.49it/s] 89%|██████████████████████████████████████████████▏     | 8656/9741 [00:14<00:01, 659.62it/s] 90%|██████████████████████████████████████████████▌     | 8723/9741 [00:14<00:01, 661.59it/s] 90%|██████████████████████████████████████████████▉     | 8790/9741 [00:14<00:01, 661.57it/s] 91%|███████████████████████████████████████████████▎    | 8857/9741 [00:14<00:01, 660.06it/s] 92%|███████████████████████████████████████████████▋    | 8924/9741 [00:14<00:01, 661.09it/s] 92%|███████████████████████████████████████████████▉    | 8991/9741 [00:14<00:01, 661.07it/s] 93%|████████████████████████████████████████████████▎   | 9058/9741 [00:15<00:01, 656.81it/s] 94%|████████████████████████████████████████████████▋   | 9125/9741 [00:15<00:00, 658.55it/s] 94%|█████████████████████████████████████████████████   | 9192/9741 [00:15<00:00, 659.78it/s] 95%|█████████████████████████████████████████████████▍  | 9258/9741 [00:15<00:00, 658.26it/s] 96%|█████████████████████████████████████████████████▊  | 9325/9741 [00:15<00:00, 659.75it/s] 96%|██████████████████████████████████████████████████▏ | 9392/9741 [00:15<00:00, 660.92it/s] 97%|██████████████████████████████████████████████████▍ | 9459/9741 [00:15<00:00, 661.21it/s] 98%|██████████████████████████████████████████████████▊ | 9526/9741 [00:15<00:00, 659.77it/s] 98%|███████████████████████████████████████████████████▏| 9593/9741 [00:15<00:00, 660.08it/s] 99%|███████████████████████████████████████████████████▌| 9660/9741 [00:15<00:00, 659.30it/s]100%|███████████████████████████████████████████████████▉| 9726/9741 [00:16<00:00, 655.29it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:16<00:00, 605.58it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.16s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.20s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.00s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.07s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.22s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.22s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.38s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.56s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.49s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.65s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]
[2023-08-21 13:05:29,381] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 13:05:37,952] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 13:05:37,953] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 13:05:37,954] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 13:05:37,954] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 13:05:37,954] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 13:05:37,954] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f9ef2c83f40>
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 13:05:37,955] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f9ec954bdc0>
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 13:05:37,956] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 13:05:37,957] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 13:05:37,957] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4539928436279297 seconds
Loading extension module utils...
Time to load utils op: 0.4043312072753906 seconds
Loading extension module utils...
Time to load utils op: 0.40460658073425293 seconds
Loading extension module utils...
Time to load utils op: 0.5047159194946289 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o12-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:45<37:06, 45.43s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:30<36:14, 45.29s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:15<35:24, 45.19s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [03:01<34:48, 45.41s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:38<31:40, 42.24s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:23<31:44, 43.28s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:08<31:28, 43.91s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:54<31:06, 44.44s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:39<30:39, 44.87s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:25<30:01, 45.03s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [08:11<29:28, 45.34s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:56<28:45, 45.41s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:42<28:02, 45.46s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:13<24:39, 41.10s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:58<24:40, 42.31s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:43<24:26, 43.14s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:28<24:01, 43.70s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [13:14<23:40, 44.39s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:59<23:03, 44.64s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:44<22:22, 44.75s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [15:30<21:40, 44.85s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [16:01<19:01, 40.77s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:46<18:53, 41.99s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [17:31<18:35, 42.91s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [18:16<18:13, 43.72s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [19:02<17:46, 44.42s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [19:32<15:16, 39.86s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [20:17<15:13, 41.54s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [21:03<14:57, 42.73s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [21:49<14:35, 43.76s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [22:35<14:03, 44.40s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [23:20<13:23, 44.64s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [24:06<12:47, 45.14s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [24:52<12:07, 45.48s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [25:38<11:24, 45.62s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [26:24<10:39, 45.66s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [27:10<09:55, 45.81s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [27:56<09:10, 45.85s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [28:42<08:22, 45.72s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [29:27<07:36, 45.61s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [30:12<06:50, 45.56s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [30:39<05:19, 39.88s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [31:24<04:49, 41.37s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [32:10<04:16, 42.73s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [32:56<03:38, 43.75s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [33:41<02:56, 44.24s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [34:27<02:14, 44.78s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [35:13<01:30, 45.17s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [35:59<00:45, 45.17s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [36:44<00:00, 45.26s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [36:44<00:00, 44.09s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.2744} | lm_loss 8.0472 | avg. gen lenth: 308.38
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o13-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 13
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 13:42:29,679] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o13-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 13
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o13-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 41/9741 [00:00<00:24, 404.01it/s]  1%|▍                                                     | 82/9741 [00:00<00:23, 405.17it/s]  1%|▋                                                    | 123/9741 [00:00<00:23, 406.63it/s]  2%|▉                                                    | 164/9741 [00:00<00:23, 407.28it/s]  2%|█                                                    | 205/9741 [00:00<00:23, 404.99it/s]  3%|█▎                                                   | 246/9741 [00:00<00:23, 405.62it/s]  3%|█▌                                                   | 287/9741 [00:00<00:23, 406.07it/s]  3%|█▊                                                   | 328/9741 [00:00<00:23, 406.57it/s]  4%|██                                                   | 369/9741 [00:00<00:23, 406.31it/s]  4%|██▏                                                  | 410/9741 [00:01<00:22, 406.58it/s]  5%|██▍                                                  | 451/9741 [00:01<00:22, 404.80it/s]  5%|██▋                                                  | 492/9741 [00:01<00:23, 399.53it/s]  5%|██▉                                                  | 533/9741 [00:01<00:22, 401.39it/s]  6%|███                                                  | 574/9741 [00:01<00:22, 402.30it/s]  6%|███▎                                                 | 615/9741 [00:01<00:22, 403.01it/s]  7%|███▌                                                 | 656/9741 [00:01<00:22, 401.94it/s]  7%|███▊                                                 | 697/9741 [00:01<00:22, 402.99it/s]  8%|████                                                 | 738/9741 [00:01<00:22, 403.31it/s]  8%|████▏                                                | 779/9741 [00:01<00:22, 403.80it/s]  8%|████▍                                                | 820/9741 [00:02<00:22, 404.42it/s]  9%|████▋                                                | 861/9741 [00:02<00:24, 362.20it/s]  9%|████▉                                                | 899/9741 [00:02<00:25, 340.99it/s] 10%|█████                                                | 940/9741 [00:02<00:24, 357.99it/s] 10%|█████▎                                               | 981/9741 [00:02<00:23, 371.21it/s] 10%|█████▍                                              | 1021/9741 [00:02<00:23, 379.11it/s] 11%|█████▋                                              | 1062/9741 [00:02<00:22, 386.74it/s] 11%|█████▉                                              | 1103/9741 [00:02<00:21, 392.67it/s] 12%|██████                                              | 1143/9741 [00:02<00:21, 393.99it/s] 12%|██████▎                                             | 1184/9741 [00:03<00:21, 396.87it/s] 13%|██████▌                                             | 1224/9741 [00:03<00:21, 390.13it/s] 13%|██████▋                                             | 1264/9741 [00:03<00:21, 392.89it/s] 13%|██████▉                                             | 1305/9741 [00:03<00:21, 396.00it/s] 14%|███████▏                                            | 1345/9741 [00:03<00:21, 395.29it/s] 14%|███████▍                                            | 1386/9741 [00:03<00:21, 397.36it/s] 15%|███████▌                                            | 1426/9741 [00:03<00:20, 397.93it/s] 15%|███████▊                                            | 1467/9741 [00:03<00:20, 399.40it/s] 15%|████████                                            | 1508/9741 [00:03<00:20, 400.39it/s] 16%|████████▎                                           | 1549/9741 [00:03<00:20, 401.55it/s] 16%|████████▍                                           | 1590/9741 [00:04<00:20, 400.31it/s] 17%|████████▋                                           | 1631/9741 [00:04<00:20, 401.21it/s] 17%|████████▉                                           | 1672/9741 [00:04<00:20, 398.53it/s] 18%|█████████▎                                          | 1733/9741 [00:04<00:17, 460.12it/s] 18%|█████████▌                                          | 1789/9741 [00:04<00:17, 467.48it/s] 19%|█████████▉                                          | 1850/9741 [00:04<00:15, 507.06it/s] 20%|██████████▏                                         | 1911/9741 [00:04<00:14, 536.21it/s] 20%|██████████▌                                         | 1972/9741 [00:04<00:13, 556.24it/s] 21%|██████████▊                                         | 2032/9741 [00:04<00:13, 568.30it/s] 21%|███████████▏                                        | 2093/9741 [00:04<00:13, 578.77it/s] 22%|███████████▍                                        | 2154/9741 [00:05<00:12, 587.36it/s] 23%|███████████▊                                        | 2215/9741 [00:05<00:12, 593.70it/s] 23%|████████████▏                                       | 2275/9741 [00:05<00:12, 594.92it/s] 24%|████████████▍                                       | 2336/9741 [00:05<00:12, 598.17it/s] 25%|████████████▊                                       | 2397/9741 [00:05<00:12, 601.35it/s] 25%|█████████████                                       | 2458/9741 [00:05<00:12, 602.32it/s] 26%|█████████████▍                                      | 2519/9741 [00:05<00:12, 600.94it/s] 26%|█████████████▊                                      | 2580/9741 [00:05<00:11, 602.34it/s] 27%|██████████████                                      | 2641/9741 [00:05<00:11, 604.20it/s] 28%|██████████████▍                                     | 2702/9741 [00:05<00:11, 602.23it/s] 28%|██████████████▋                                     | 2763/9741 [00:06<00:11, 602.53it/s] 29%|███████████████                                     | 2824/9741 [00:06<00:11, 603.37it/s] 30%|███████████████▍                                    | 2885/9741 [00:06<00:11, 601.60it/s] 30%|███████████████▋                                    | 2946/9741 [00:06<00:11, 599.97it/s] 31%|████████████████                                    | 3007/9741 [00:06<00:11, 602.13it/s] 31%|████████████████▍                                   | 3068/9741 [00:06<00:11, 602.41it/s] 32%|████████████████▋                                   | 3129/9741 [00:06<00:10, 603.83it/s] 33%|█████████████████                                   | 3190/9741 [00:06<00:10, 601.98it/s] 33%|█████████████████▎                                  | 3251/9741 [00:06<00:10, 603.04it/s] 34%|█████████████████▋                                  | 3312/9741 [00:06<00:10, 603.71it/s] 35%|██████████████████                                  | 3373/9741 [00:07<00:10, 596.55it/s] 35%|██████████████████▎                                 | 3433/9741 [00:07<00:10, 594.92it/s] 36%|██████████████████▋                                 | 3494/9741 [00:07<00:10, 597.17it/s] 36%|██████████████████▉                                 | 3555/9741 [00:07<00:10, 599.25it/s] 37%|███████████████████▎                                | 3615/9741 [00:07<00:10, 597.64it/s] 38%|███████████████████▌                                | 3676/9741 [00:07<00:10, 599.72it/s] 38%|███████████████████▉                                | 3737/9741 [00:07<00:09, 601.95it/s] 39%|████████████████████▎                               | 3798/9741 [00:07<00:09, 601.21it/s] 40%|████████████████████▌                               | 3859/9741 [00:07<00:09, 599.24it/s] 40%|████████████████████▉                               | 3920/9741 [00:07<00:09, 600.65it/s] 41%|█████████████████████▎                              | 3981/9741 [00:08<00:09, 600.91it/s] 41%|█████████████████████▌                              | 4042/9741 [00:08<00:09, 602.21it/s] 42%|█████████████████████▉                              | 4103/9741 [00:08<00:09, 599.86it/s] 43%|██████████████████████▏                             | 4164/9741 [00:08<00:09, 600.99it/s] 43%|██████████████████████▌                             | 4225/9741 [00:08<00:09, 601.47it/s] 44%|██████████████████████▉                             | 4286/9741 [00:08<00:09, 599.87it/s] 45%|███████████████████████▏                            | 4346/9741 [00:08<00:08, 599.58it/s] 45%|███████████████████████▌                            | 4406/9741 [00:08<00:08, 599.61it/s] 46%|███████████████████████▊                            | 4467/9741 [00:08<00:08, 600.75it/s] 46%|████████████████████████▏                           | 4528/9741 [00:09<00:09, 555.48it/s] 47%|████████████████████████▍                           | 4589/9741 [00:09<00:09, 569.38it/s] 48%|████████████████████████▊                           | 4650/9741 [00:09<00:08, 579.86it/s] 48%|█████████████████████████▏                          | 4711/9741 [00:09<00:08, 586.60it/s] 49%|█████████████████████████▍                          | 4770/9741 [00:09<00:10, 459.19it/s] 50%|█████████████████████████▊                          | 4831/9741 [00:09<00:09, 495.01it/s] 50%|██████████████████████████                          | 4892/9741 [00:09<00:09, 523.42it/s] 51%|██████████████████████████▍                         | 4952/9741 [00:09<00:08, 541.93it/s] 51%|██████████████████████████▊                         | 5013/9741 [00:09<00:08, 559.06it/s] 52%|███████████████████████████                         | 5074/9741 [00:10<00:08, 571.72it/s] 53%|███████████████████████████▍                        | 5135/9741 [00:10<00:07, 581.47it/s] 53%|███████████████████████████▋                        | 5195/9741 [00:10<00:07, 586.12it/s] 54%|████████████████████████████                        | 5256/9741 [00:10<00:07, 590.49it/s] 55%|████████████████████████████▍                       | 5317/9741 [00:10<00:07, 593.54it/s] 55%|████████████████████████████▋                       | 5378/9741 [00:10<00:07, 596.56it/s] 56%|█████████████████████████████                       | 5438/9741 [00:10<00:07, 596.14it/s] 56%|█████████████████████████████▎                      | 5500/9741 [00:10<00:07, 601.48it/s] 57%|█████████████████████████████▋                      | 5564/9741 [00:10<00:06, 610.26it/s] 58%|██████████████████████████████                      | 5626/9741 [00:10<00:06, 613.07it/s] 58%|██████████████████████████████▎                     | 5689/9741 [00:11<00:06, 617.37it/s] 59%|██████████████████████████████▋                     | 5752/9741 [00:11<00:06, 620.88it/s] 60%|███████████████████████████████                     | 5815/9741 [00:11<00:06, 622.89it/s] 60%|███████████████████████████████▍                    | 5878/9741 [00:11<00:06, 621.07it/s] 61%|███████████████████████████████▋                    | 5941/9741 [00:11<00:06, 623.02it/s] 62%|████████████████████████████████                    | 6004/9741 [00:11<00:05, 624.82it/s] 62%|████████████████████████████████▍                   | 6067/9741 [00:11<00:05, 625.63it/s] 63%|████████████████████████████████▋                   | 6130/9741 [00:11<00:05, 623.27it/s] 64%|█████████████████████████████████                   | 6194/9741 [00:11<00:05, 625.46it/s] 64%|█████████████████████████████████▍                  | 6257/9741 [00:11<00:05, 626.09it/s] 65%|█████████████████████████████████▋                  | 6320/9741 [00:12<00:05, 624.03it/s] 66%|██████████████████████████████████                  | 6383/9741 [00:12<00:05, 625.41it/s] 66%|██████████████████████████████████▍                 | 6446/9741 [00:12<00:05, 626.13it/s] 67%|██████████████████████████████████▋                 | 6509/9741 [00:12<00:05, 625.84it/s] 67%|███████████████████████████████████                 | 6572/9741 [00:12<00:05, 623.45it/s] 68%|███████████████████████████████████▍                | 6635/9741 [00:12<00:04, 623.77it/s] 69%|███████████████████████████████████▊                | 6698/9741 [00:12<00:04, 624.98it/s] 69%|████████████████████████████████████                | 6761/9741 [00:12<00:04, 624.21it/s] 70%|████████████████████████████████████▍               | 6824/9741 [00:12<00:04, 625.43it/s] 71%|████████████████████████████████████▊               | 6887/9741 [00:12<00:04, 626.67it/s] 71%|█████████████████████████████████████               | 6950/9741 [00:13<00:04, 627.06it/s] 72%|█████████████████████████████████████▍              | 7013/9741 [00:13<00:04, 623.61it/s] 73%|█████████████████████████████████████▊              | 7076/9741 [00:13<00:04, 625.35it/s] 73%|██████████████████████████████████████              | 7139/9741 [00:13<00:04, 625.79it/s] 74%|██████████████████████████████████████▍             | 7202/9741 [00:13<00:04, 625.99it/s] 75%|██████████████████████████████████████▊             | 7265/9741 [00:13<00:03, 620.34it/s] 75%|███████████████████████████████████████             | 7328/9741 [00:13<00:03, 622.38it/s] 76%|███████████████████████████████████████▍            | 7391/9741 [00:13<00:03, 624.37it/s] 77%|███████████████████████████████████████▊            | 7454/9741 [00:13<00:03, 592.67it/s] 77%|████████████████████████████████████████▏           | 7517/9741 [00:13<00:03, 601.80it/s] 78%|████████████████████████████████████████▍           | 7580/9741 [00:14<00:03, 608.94it/s] 78%|████████████████████████████████████████▊           | 7643/9741 [00:14<00:03, 614.69it/s] 79%|█████████████████████████████████████████▏          | 7705/9741 [00:14<00:03, 614.49it/s] 80%|█████████████████████████████████████████▍          | 7768/9741 [00:14<00:03, 618.66it/s] 80%|█████████████████████████████████████████▊          | 7830/9741 [00:14<00:03, 614.70it/s] 81%|██████████████████████████████████████████▏         | 7893/9741 [00:14<00:03, 615.29it/s] 82%|██████████████████████████████████████████▍         | 7956/9741 [00:14<00:02, 618.74it/s] 82%|██████████████████████████████████████████▊         | 8019/9741 [00:14<00:02, 620.56it/s] 83%|███████████████████████████████████████████▏        | 8082/9741 [00:14<00:02, 621.85it/s] 84%|███████████████████████████████████████████▍        | 8145/9741 [00:14<00:02, 620.59it/s] 84%|███████████████████████████████████████████▊        | 8208/9741 [00:15<00:02, 622.03it/s] 85%|████████████████████████████████████████████▏       | 8271/9741 [00:15<00:02, 623.25it/s] 86%|████████████████████████████████████████████▍       | 8334/9741 [00:15<00:02, 623.79it/s] 86%|████████████████████████████████████████████▊       | 8397/9741 [00:15<00:02, 621.21it/s] 87%|█████████████████████████████████████████████▏      | 8460/9741 [00:15<00:02, 618.06it/s] 87%|█████████████████████████████████████████████▍      | 8523/9741 [00:15<00:01, 620.86it/s] 88%|█████████████████████████████████████████████▊      | 8586/9741 [00:15<00:01, 618.79it/s] 89%|██████████████████████████████████████████████▏     | 8649/9741 [00:15<00:01, 620.90it/s] 89%|██████████████████████████████████████████████▌     | 8712/9741 [00:15<00:01, 622.90it/s] 90%|██████████████████████████████████████████████▊     | 8775/9741 [00:16<00:01, 623.81it/s] 91%|███████████████████████████████████████████████▏    | 8838/9741 [00:16<00:01, 621.98it/s] 91%|███████████████████████████████████████████████▌    | 8901/9741 [00:16<00:01, 622.80it/s] 92%|███████████████████████████████████████████████▊    | 8964/9741 [00:16<00:01, 623.63it/s] 93%|████████████████████████████████████████████████▏   | 9027/9741 [00:16<00:01, 624.43it/s] 93%|████████████████████████████████████████████████▌   | 9090/9741 [00:16<00:01, 618.24it/s] 94%|████████████████████████████████████████████████▊   | 9153/9741 [00:16<00:00, 620.46it/s] 95%|█████████████████████████████████████████████████▏  | 9216/9741 [00:16<00:00, 621.94it/s] 95%|█████████████████████████████████████████████████▌  | 9279/9741 [00:16<00:00, 619.91it/s] 96%|█████████████████████████████████████████████████▊  | 9342/9741 [00:16<00:00, 620.58it/s] 97%|██████████████████████████████████████████████████▏ | 9405/9741 [00:17<00:00, 621.91it/s] 97%|██████████████████████████████████████████████████▌ | 9468/9741 [00:17<00:00, 622.87it/s] 98%|██████████████████████████████████████████████████▉ | 9531/9741 [00:17<00:00, 620.99it/s] 98%|███████████████████████████████████████████████████▏| 9594/9741 [00:17<00:00, 622.26it/s] 99%|███████████████████████████████████████████████████▌| 9657/9741 [00:17<00:00, 623.35it/s]100%|███████████████████████████████████████████████████▉| 9720/9741 [00:17<00:00, 621.18it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:17<00:00, 554.67it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.02s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.30s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.53s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.13s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.61s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.35s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.57s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.13s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
[2023-08-21 13:43:40,113] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
[2023-08-21 13:43:54,084] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 13:43:54,084] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f520d84ff40>
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 13:43:54,085] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f51e3a3cdc0>
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 13:43:54,086] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 13:43:54,087] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.479752779006958 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o13-tgsm8k-s1-rFalse
Time to load utils op: 0.40436482429504395 seconds
Loading extension module utils...
Time to load utils op: 0.5045933723449707 seconds
Loading extension module utils...
Time to load utils op: 0.5047204494476318 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:45<36:55, 45.22s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:29<35:44, 44.68s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:14<35:03, 44.76s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:59<34:25, 44.91s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:45<33:51, 45.16s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:29<33:00, 45.02s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:14<32:11, 44.91s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:59<31:21, 44.80s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:43<30:33, 44.71s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:28<29:55, 44.90s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [08:14<29:18, 45.08s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [09:00<28:38, 45.23s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:40<27:03, 43.88s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:14<24:30, 40.85s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:59<24:28, 41.95s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:44<24:18, 42.89s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:29<23:57, 43.55s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [13:05<21:59, 41.22s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:49<21:46, 42.14s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:34<21:33, 43.13s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [15:19<21:05, 43.63s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [16:05<20:38, 44.22s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:34<17:49, 39.61s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [17:19<17:53, 41.28s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [18:04<17:41, 42.47s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:49<17:15, 43.15s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [19:34<16:47, 43.80s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [20:19<16:13, 44.27s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:49<13:58, 39.94s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [21:34<13:49, 41.48s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [22:19<13:25, 42.41s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [22:56<12:16, 40.90s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [23:41<11:57, 42.18s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:59<09:17, 34.84s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [24:44<09:28, 37.91s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [25:31<09:26, 40.46s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [26:16<09:06, 42.03s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [27:01<08:34, 42.88s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [27:47<07:59, 43.61s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [28:31<07:19, 43.96s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [29:16<06:37, 44.17s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [30:01<05:56, 44.52s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [30:46<05:12, 44.61s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [31:32<04:29, 44.85s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [32:17<03:44, 44.95s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [33:02<03:00, 45.08s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [33:47<02:14, 44.95s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [34:19<01:22, 41.00s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [35:04<00:42, 42.38s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [35:49<00:00, 43.09s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [35:49<00:00, 42.99s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.1197} | lm_loss 8.1181 | avg. gen lenth: 287.108
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o14-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 14
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 14:21:09,013] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o14-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 14
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o14-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 32/9741 [00:00<00:30, 313.68it/s]  1%|▎                                                     | 64/9741 [00:00<00:30, 315.12it/s]  1%|▌                                                     | 96/9741 [00:00<00:30, 315.74it/s]  1%|▋                                                    | 128/9741 [00:00<00:30, 315.87it/s]  2%|▊                                                    | 160/9741 [00:00<00:32, 296.38it/s]  2%|█                                                    | 192/9741 [00:00<00:31, 301.93it/s]  2%|█▏                                                   | 223/9741 [00:00<00:31, 304.27it/s]  3%|█▍                                                   | 254/9741 [00:00<00:31, 299.34it/s]  3%|█▌                                                   | 286/9741 [00:00<00:31, 303.27it/s]  3%|█▋                                                   | 318/9741 [00:01<00:30, 306.45it/s]  4%|█▉                                                   | 350/9741 [00:01<00:30, 308.44it/s]  4%|██                                                   | 382/9741 [00:01<00:30, 309.92it/s]  4%|██▎                                                  | 414/9741 [00:01<00:30, 310.87it/s]  5%|██▍                                                  | 446/9741 [00:01<00:30, 309.61it/s]  5%|██▌                                                  | 478/9741 [00:01<00:29, 310.72it/s]  5%|██▊                                                  | 510/9741 [00:01<00:29, 311.23it/s]  6%|██▉                                                  | 542/9741 [00:01<00:30, 305.95it/s]  6%|███                                                  | 573/9741 [00:01<00:29, 306.49it/s]  6%|███▎                                                 | 605/9741 [00:01<00:29, 308.25it/s]  7%|███▍                                                 | 637/9741 [00:02<00:29, 309.67it/s]  7%|███▋                                                 | 668/9741 [00:02<00:29, 308.23it/s]  7%|███▊                                                 | 700/9741 [00:02<00:29, 309.78it/s]  8%|███▉                                                 | 732/9741 [00:02<00:29, 310.26it/s]  8%|████▏                                                | 764/9741 [00:02<00:28, 311.23it/s]  8%|████▎                                                | 796/9741 [00:02<00:28, 312.14it/s]  9%|████▌                                                | 828/9741 [00:02<00:28, 312.50it/s]  9%|████▋                                                | 863/9741 [00:02<00:27, 323.42it/s]  9%|████▉                                                | 910/9741 [00:02<00:24, 365.73it/s] 10%|█████▏                                               | 958/9741 [00:02<00:22, 397.99it/s] 10%|█████▎                                              | 1005/9741 [00:03<00:20, 418.01it/s] 11%|█████▌                                              | 1053/9741 [00:03<00:19, 434.66it/s] 11%|█████▉                                              | 1101/9741 [00:03<00:19, 446.48it/s] 12%|██████▏                                             | 1148/9741 [00:03<00:18, 452.34it/s] 12%|██████▍                                             | 1196/9741 [00:03<00:18, 458.65it/s] 13%|██████▋                                             | 1244/9741 [00:03<00:18, 462.09it/s] 13%|██████▉                                             | 1292/9741 [00:03<00:18, 465.29it/s] 14%|███████▏                                            | 1339/9741 [00:03<00:18, 464.84it/s] 14%|███████▍                                            | 1387/9741 [00:03<00:17, 467.05it/s] 15%|███████▋                                            | 1435/9741 [00:03<00:17, 468.64it/s] 15%|███████▉                                            | 1483/9741 [00:04<00:17, 469.82it/s] 16%|████████▏                                           | 1531/9741 [00:04<00:17, 470.47it/s] 16%|████████▍                                           | 1579/9741 [00:04<00:17, 468.20it/s] 17%|████████▋                                           | 1626/9741 [00:04<00:17, 464.55it/s] 17%|████████▉                                           | 1674/9741 [00:04<00:17, 467.11it/s] 18%|█████████▏                                          | 1722/9741 [00:04<00:17, 468.54it/s] 18%|█████████▍                                          | 1770/9741 [00:04<00:16, 469.55it/s] 19%|█████████▋                                          | 1817/9741 [00:04<00:18, 433.24it/s] 19%|█████████▉                                          | 1865/9741 [00:04<00:17, 444.26it/s] 20%|██████████▏                                         | 1913/9741 [00:05<00:17, 452.17it/s] 20%|██████████▍                                         | 1961/9741 [00:05<00:16, 457.70it/s] 21%|██████████▋                                         | 2009/9741 [00:05<00:16, 461.92it/s] 21%|██████████▉                                         | 2056/9741 [00:05<00:16, 462.10it/s] 22%|███████████▏                                        | 2103/9741 [00:05<00:16, 463.94it/s] 22%|███████████▍                                        | 2150/9741 [00:05<00:16, 464.24it/s] 23%|███████████▋                                        | 2198/9741 [00:05<00:16, 466.29it/s] 23%|███████████▉                                        | 2245/9741 [00:05<00:16, 462.67it/s] 24%|████████████▏                                       | 2293/9741 [00:05<00:16, 465.05it/s] 24%|████████████▍                                       | 2341/9741 [00:05<00:15, 467.05it/s] 25%|████████████▊                                       | 2389/9741 [00:06<00:15, 468.64it/s] 25%|█████████████                                       | 2437/9741 [00:06<00:15, 470.07it/s] 26%|█████████████▎                                      | 2485/9741 [00:06<00:15, 467.76it/s] 26%|█████████████▌                                      | 2533/9741 [00:06<00:15, 468.65it/s] 26%|█████████████▊                                      | 2581/9741 [00:06<00:15, 469.81it/s] 27%|██████████████                                      | 2629/9741 [00:06<00:15, 470.36it/s] 27%|██████████████▎                                     | 2677/9741 [00:06<00:15, 470.84it/s] 28%|██████████████▌                                     | 2725/9741 [00:06<00:14, 467.90it/s] 28%|██████████████▊                                     | 2773/9741 [00:06<00:14, 468.70it/s] 29%|███████████████                                     | 2821/9741 [00:06<00:14, 469.15it/s] 29%|███████████████▎                                    | 2869/9741 [00:07<00:14, 470.36it/s] 30%|███████████████▌                                    | 2917/9741 [00:07<00:14, 471.12it/s] 30%|███████████████▊                                    | 2965/9741 [00:07<00:14, 468.95it/s] 31%|████████████████                                    | 3012/9741 [00:07<00:14, 468.37it/s] 31%|████████████████▎                                   | 3059/9741 [00:07<00:14, 468.71it/s] 32%|████████████████▌                                   | 3107/9741 [00:07<00:14, 469.45it/s] 32%|████████████████▊                                   | 3154/9741 [00:07<00:14, 467.55it/s] 33%|█████████████████                                   | 3202/9741 [00:07<00:13, 468.91it/s] 33%|█████████████████▎                                  | 3250/9741 [00:07<00:13, 469.97it/s] 34%|█████████████████▌                                  | 3298/9741 [00:07<00:13, 470.31it/s] 34%|█████████████████▊                                  | 3346/9741 [00:08<00:13, 470.38it/s] 35%|██████████████████                                  | 3394/9741 [00:08<00:13, 468.44it/s] 35%|██████████████████▎                                 | 3442/9741 [00:08<00:13, 469.06it/s] 36%|██████████████████▋                                 | 3489/9741 [00:08<00:13, 469.24it/s] 36%|██████████████████▉                                 | 3537/9741 [00:08<00:13, 469.52it/s] 37%|███████████████████▏                                | 3584/9741 [00:08<00:13, 469.25it/s] 37%|███████████████████▍                                | 3631/9741 [00:08<00:13, 467.05it/s] 38%|███████████████████▋                                | 3679/9741 [00:08<00:12, 468.35it/s] 38%|███████████████████▉                                | 3727/9741 [00:08<00:12, 469.59it/s] 39%|████████████████████▏                               | 3775/9741 [00:09<00:12, 470.10it/s] 39%|████████████████████▍                               | 3823/9741 [00:09<00:12, 468.89it/s] 40%|████████████████████▋                               | 3870/9741 [00:09<00:12, 467.53it/s] 40%|████████████████████▉                               | 3918/9741 [00:09<00:12, 468.64it/s] 41%|█████████████████████▏                              | 3966/9741 [00:09<00:12, 469.29it/s] 41%|█████████████████████▍                              | 4014/9741 [00:09<00:12, 469.56it/s] 42%|█████████████████████▋                              | 4061/9741 [00:09<00:12, 467.34it/s] 42%|█████████████████████▉                              | 4108/9741 [00:09<00:12, 467.93it/s] 43%|██████████████████████▏                             | 4156/9741 [00:09<00:11, 468.86it/s] 43%|██████████████████████▍                             | 4204/9741 [00:09<00:11, 469.51it/s] 44%|██████████████████████▋                             | 4252/9741 [00:10<00:11, 469.76it/s] 44%|██████████████████████▉                             | 4299/9741 [00:10<00:11, 468.14it/s] 45%|███████████████████████▏                            | 4347/9741 [00:10<00:11, 469.03it/s] 45%|███████████████████████▍                            | 4395/9741 [00:10<00:11, 469.55it/s] 46%|███████████████████████▋                            | 4442/9741 [00:10<00:11, 469.58it/s] 46%|███████████████████████▉                            | 4489/9741 [00:10<00:11, 469.16it/s] 47%|████████████████████████▏                           | 4536/9741 [00:10<00:11, 438.56it/s] 47%|████████████████████████▍                           | 4583/9741 [00:10<00:11, 447.34it/s] 48%|████████████████████████▋                           | 4631/9741 [00:10<00:11, 454.58it/s] 48%|████████████████████████▉                           | 4678/9741 [00:10<00:11, 458.52it/s] 49%|█████████████████████████▏                          | 4726/9741 [00:11<00:10, 462.28it/s] 49%|█████████████████████████▍                          | 4773/9741 [00:11<00:15, 320.54it/s] 49%|█████████████████████████▋                          | 4821/9741 [00:11<00:13, 355.15it/s] 50%|█████████████████████████▉                          | 4869/9741 [00:11<00:12, 383.58it/s] 50%|██████████████████████████▏                         | 4917/9741 [00:11<00:11, 406.48it/s] 51%|██████████████████████████▍                         | 4964/9741 [00:11<00:11, 421.72it/s] 51%|██████████████████████████▊                         | 5012/9741 [00:11<00:10, 435.72it/s] 52%|███████████████████████████                         | 5060/9741 [00:11<00:10, 446.13it/s] 52%|███████████████████████████▎                        | 5108/9741 [00:12<00:10, 453.62it/s] 53%|███████████████████████████▌                        | 5156/9741 [00:12<00:09, 459.01it/s] 53%|███████████████████████████▊                        | 5203/9741 [00:12<00:09, 460.56it/s] 54%|████████████████████████████                        | 5251/9741 [00:12<00:09, 463.49it/s] 54%|████████████████████████████▎                       | 5299/9741 [00:12<00:09, 465.96it/s] 55%|████████████████████████████▌                       | 5346/9741 [00:12<00:09, 463.00it/s] 55%|████████████████████████████▊                       | 5394/9741 [00:12<00:09, 465.32it/s] 56%|█████████████████████████████                       | 5441/9741 [00:12<00:09, 464.71it/s] 56%|█████████████████████████████▎                      | 5489/9741 [00:12<00:09, 468.56it/s] 57%|█████████████████████████████▌                      | 5538/9741 [00:12<00:08, 474.38it/s] 57%|█████████████████████████████▊                      | 5587/9741 [00:13<00:08, 478.34it/s] 58%|██████████████████████████████                      | 5636/9741 [00:13<00:08, 479.11it/s] 58%|██████████████████████████████▎                     | 5685/9741 [00:13<00:08, 481.61it/s] 59%|██████████████████████████████▌                     | 5734/9741 [00:13<00:08, 483.38it/s] 59%|██████████████████████████████▊                     | 5783/9741 [00:13<00:08, 484.70it/s] 60%|███████████████████████████████▏                    | 5832/9741 [00:13<00:08, 485.38it/s] 60%|███████████████████████████████▍                    | 5881/9741 [00:13<00:07, 482.75it/s] 61%|███████████████████████████████▋                    | 5930/9741 [00:13<00:07, 483.05it/s] 61%|███████████████████████████████▉                    | 5979/9741 [00:13<00:07, 483.78it/s] 62%|████████████████████████████████▏                   | 6028/9741 [00:13<00:07, 484.58it/s] 62%|████████████████████████████████▍                   | 6077/9741 [00:14<00:07, 485.52it/s] 63%|████████████████████████████████▋                   | 6126/9741 [00:14<00:07, 479.28it/s] 63%|████████████████████████████████▉                   | 6175/9741 [00:14<00:07, 481.25it/s] 64%|█████████████████████████████████▏                  | 6224/9741 [00:14<00:07, 482.49it/s] 64%|█████████████████████████████████▍                  | 6273/9741 [00:14<00:07, 483.47it/s] 65%|█████████████████████████████████▋                  | 6322/9741 [00:14<00:07, 481.80it/s] 65%|██████████████████████████████████                  | 6371/9741 [00:14<00:06, 482.96it/s] 66%|██████████████████████████████████▎                 | 6420/9741 [00:14<00:06, 484.12it/s] 66%|██████████████████████████████████▌                 | 6469/9741 [00:14<00:06, 484.52it/s] 67%|██████████████████████████████████▊                 | 6518/9741 [00:14<00:06, 484.65it/s] 67%|███████████████████████████████████                 | 6567/9741 [00:15<00:06, 483.02it/s] 68%|███████████████████████████████████▎                | 6616/9741 [00:15<00:06, 484.34it/s] 68%|███████████████████████████████████▌                | 6665/9741 [00:15<00:06, 485.26it/s] 69%|███████████████████████████████████▊                | 6714/9741 [00:15<00:06, 485.89it/s] 69%|████████████████████████████████████                | 6763/9741 [00:15<00:06, 483.98it/s] 70%|████████████████████████████████████▎               | 6812/9741 [00:15<00:06, 484.76it/s] 70%|████████████████████████████████████▋               | 6861/9741 [00:15<00:05, 485.54it/s] 71%|████████████████████████████████████▉               | 6910/9741 [00:15<00:05, 485.51it/s] 71%|█████████████████████████████████████▏              | 6959/9741 [00:15<00:05, 480.05it/s] 72%|█████████████████████████████████████▍              | 7008/9741 [00:15<00:05, 477.60it/s] 72%|█████████████████████████████████████▋              | 7057/9741 [00:16<00:05, 480.17it/s] 73%|█████████████████████████████████████▉              | 7106/9741 [00:16<00:05, 482.00it/s] 73%|██████████████████████████████████████▏             | 7155/9741 [00:16<00:05, 483.21it/s] 74%|██████████████████████████████████████▍             | 7204/9741 [00:16<00:05, 484.56it/s] 74%|██████████████████████████████████████▋             | 7253/9741 [00:16<00:05, 483.19it/s] 75%|██████████████████████████████████████▉             | 7302/9741 [00:16<00:05, 484.23it/s] 75%|███████████████████████████████████████▏            | 7351/9741 [00:16<00:04, 484.72it/s] 76%|███████████████████████████████████████▌            | 7400/9741 [00:16<00:04, 486.11it/s] 76%|███████████████████████████████████████▊            | 7449/9741 [00:16<00:05, 441.18it/s] 77%|████████████████████████████████████████            | 7498/9741 [00:17<00:04, 453.84it/s] 77%|████████████████████████████████████████▎           | 7547/9741 [00:17<00:04, 463.17it/s] 78%|████████████████████████████████████████▌           | 7596/9741 [00:17<00:04, 470.15it/s] 78%|████████████████████████████████████████▊           | 7645/9741 [00:17<00:04, 475.19it/s] 79%|█████████████████████████████████████████           | 7693/9741 [00:17<00:04, 476.22it/s] 79%|█████████████████████████████████████████▎          | 7742/9741 [00:17<00:04, 479.94it/s] 80%|█████████████████████████████████████████▌          | 7791/9741 [00:17<00:04, 476.18it/s] 80%|█████████████████████████████████████████▊          | 7840/9741 [00:17<00:03, 479.49it/s] 81%|██████████████████████████████████████████          | 7889/9741 [00:17<00:03, 481.04it/s] 81%|██████████████████████████████████████████▍         | 7938/9741 [00:17<00:03, 480.62it/s] 82%|██████████████████████████████████████████▋         | 7987/9741 [00:18<00:03, 482.30it/s] 82%|██████████████████████████████████████████▉         | 8036/9741 [00:18<00:03, 483.20it/s] 83%|███████████████████████████████████████████▏        | 8085/9741 [00:18<00:03, 483.79it/s] 84%|███████████████████████████████████████████▍        | 8134/9741 [00:18<00:03, 482.93it/s] 84%|███████████████████████████████████████████▋        | 8183/9741 [00:18<00:03, 483.64it/s] 85%|███████████████████████████████████████████▉        | 8232/9741 [00:18<00:03, 484.26it/s] 85%|████████████████████████████████████████████▏       | 8281/9741 [00:18<00:03, 485.03it/s] 86%|████████████████████████████████████████████▍       | 8330/9741 [00:18<00:02, 485.44it/s] 86%|████████████████████████████████████████████▋       | 8379/9741 [00:18<00:02, 483.60it/s] 87%|████████████████████████████████████████████▉       | 8428/9741 [00:18<00:02, 483.87it/s] 87%|█████████████████████████████████████████████▎      | 8477/9741 [00:19<00:02, 484.54it/s] 88%|█████████████████████████████████████████████▌      | 8526/9741 [00:19<00:02, 485.29it/s] 88%|█████████████████████████████████████████████▊      | 8575/9741 [00:19<00:02, 482.66it/s] 89%|██████████████████████████████████████████████      | 8624/9741 [00:19<00:02, 483.40it/s] 89%|██████████████████████████████████████████████▎     | 8673/9741 [00:19<00:02, 484.30it/s] 90%|██████████████████████████████████████████████▌     | 8722/9741 [00:19<00:02, 485.20it/s] 90%|██████████████████████████████████████████████▊     | 8771/9741 [00:19<00:01, 485.48it/s] 91%|███████████████████████████████████████████████     | 8820/9741 [00:19<00:01, 483.31it/s] 91%|███████████████████████████████████████████████▎    | 8869/9741 [00:19<00:01, 484.29it/s] 92%|███████████████████████████████████████████████▌    | 8918/9741 [00:19<00:01, 484.77it/s] 92%|███████████████████████████████████████████████▊    | 8967/9741 [00:20<00:01, 484.96it/s] 93%|████████████████████████████████████████████████▏   | 9016/9741 [00:20<00:01, 485.38it/s] 93%|████████████████████████████████████████████████▍   | 9065/9741 [00:20<00:01, 483.17it/s] 94%|████████████████████████████████████████████████▋   | 9114/9741 [00:20<00:01, 484.29it/s] 94%|████████████████████████████████████████████████▉   | 9163/9741 [00:20<00:01, 485.10it/s] 95%|█████████████████████████████████████████████████▏  | 9212/9741 [00:20<00:01, 485.37it/s] 95%|█████████████████████████████████████████████████▍  | 9261/9741 [00:20<00:00, 484.08it/s] 96%|█████████████████████████████████████████████████▋  | 9310/9741 [00:20<00:00, 484.05it/s] 96%|█████████████████████████████████████████████████▉  | 9359/9741 [00:20<00:00, 483.44it/s] 97%|██████████████████████████████████████████████████▏ | 9408/9741 [00:20<00:00, 483.69it/s] 97%|██████████████████████████████████████████████████▍ | 9457/9741 [00:21<00:00, 483.85it/s] 98%|██████████████████████████████████████████████████▋ | 9506/9741 [00:21<00:00, 482.06it/s] 98%|███████████████████████████████████████████████████ | 9555/9741 [00:21<00:00, 482.47it/s] 99%|███████████████████████████████████████████████████▎| 9604/9741 [00:21<00:00, 483.04it/s] 99%|███████████████████████████████████████████████████▌| 9653/9741 [00:21<00:00, 480.32it/s]100%|███████████████████████████████████████████████████▊| 9702/9741 [00:21<00:00, 481.66it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:21<00:00, 449.56it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.11s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.22s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.78s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.20s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.08s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:12<00:06,  6.16s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
[2023-08-21 14:22:22,196] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:17<00:00,  5.82s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:17<00:00,  5.87s/it]
[2023-08-21 14:22:40,890] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 14:22:40,891] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fb54425bf40>
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 14:22:40,892] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fb518e07d30>
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 14:22:40,893] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 14:22:40,894] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 14:22:40,894] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.49880003929138184 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Time to load utils op: 0.5047774314880371 seconds
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]Loading extension module utils...
############### Example ###############
Time to load utils op: 0.5045032501220703 seconds
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o14-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.5044536590576172 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:44<36:22, 44.54s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:27<35:04, 43.84s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:11<34:13, 43.70s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:54<33:19, 43.48s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:38<32:36, 43.47s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:20<31:34, 43.06s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [05:03<30:55, 43.16s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:47<30:16, 43.24s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:30<29:35, 43.30s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:13<28:53, 43.33s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:57<28:14, 43.45s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:41<27:39, 43.67s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:26<27:02, 43.85s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [10:11<26:37, 44.38s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:55<25:45, 44.15s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:39<24:57, 44.04s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:22<24:10, 43.97s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [13:06<23:22, 43.83s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:36<20:31, 39.73s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:20<20:26, 40.87s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [15:04<20:12, 41.82s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:46<19:39, 42.14s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:30<19:06, 42.45s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [17:13<18:32, 42.81s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:58<18:01, 43.25s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:24<15:19, 38.30s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [19:08<15:16, 39.84s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [19:51<14:58, 40.86s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:35<14:34, 41.65s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [21:19<14:10, 42.53s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [22:03<13:35, 42.92s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [22:46<12:54, 43.05s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [23:30<12:13, 43.15s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:52<09:48, 36.79s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [24:35<09:42, 38.83s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [25:19<09:24, 40.34s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [26:03<08:56, 41.30s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [26:46<08:25, 42.08s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [27:26<07:33, 41.24s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [28:10<07:01, 42.11s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [28:54<06:23, 42.61s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [29:36<05:40, 42.55s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [30:20<05:01, 43.05s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [31:04<04:19, 43.24s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [31:48<03:37, 43.43s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [32:31<02:53, 43.45s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [33:15<02:10, 43.64s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [33:59<01:27, 43.66s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [34:42<00:43, 43.56s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [35:26<00:00, 43.57s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [35:26<00:00, 42.53s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.9228} | lm_loss 8.1879 | avg. gen lenth: 311.896
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o15-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 15
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 14:58:57,788] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o15-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 15
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o15-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 31/9741 [00:00<00:31, 304.45it/s]  1%|▎                                                     | 62/9741 [00:00<00:31, 306.16it/s]  1%|▌                                                     | 93/9741 [00:00<00:31, 306.53it/s]  1%|▋                                                    | 124/9741 [00:00<00:31, 306.86it/s]  2%|▊                                                    | 155/9741 [00:00<00:31, 307.04it/s]  2%|█                                                    | 186/9741 [00:00<00:31, 306.50it/s]  2%|█▏                                                   | 217/9741 [00:00<00:31, 299.83it/s]  3%|█▎                                                   | 248/9741 [00:00<00:31, 300.95it/s]  3%|█▌                                                   | 279/9741 [00:00<00:31, 301.92it/s]  3%|█▋                                                   | 310/9741 [00:01<00:31, 303.25it/s]  4%|█▊                                                   | 341/9741 [00:01<00:30, 303.65it/s]  4%|██                                                   | 372/9741 [00:01<00:30, 304.07it/s]  4%|██▏                                                  | 403/9741 [00:01<00:30, 304.43it/s]  4%|██▎                                                  | 434/9741 [00:01<00:30, 302.37it/s]  5%|██▌                                                  | 465/9741 [00:01<00:30, 302.96it/s]  5%|██▋                                                  | 496/9741 [00:01<00:30, 303.55it/s]  5%|██▊                                                  | 527/9741 [00:01<00:30, 301.28it/s]  6%|███                                                  | 558/9741 [00:01<00:30, 301.99it/s]  6%|███▎                                                 | 602/9741 [00:01<00:26, 341.21it/s]  7%|███▌                                                 | 649/9741 [00:02<00:24, 377.55it/s]  7%|███▊                                                 | 695/9741 [00:02<00:22, 401.15it/s]  8%|████                                                 | 742/9741 [00:02<00:21, 419.63it/s]  8%|████▎                                                | 789/9741 [00:02<00:20, 433.13it/s]  9%|████▌                                                | 836/9741 [00:02<00:20, 442.24it/s]  9%|████▊                                                | 882/9741 [00:02<00:19, 446.77it/s] 10%|█████                                                | 929/9741 [00:02<00:19, 451.73it/s] 10%|█████▎                                               | 976/9741 [00:02<00:19, 455.27it/s] 11%|█████▍                                              | 1023/9741 [00:02<00:19, 457.58it/s] 11%|█████▋                                              | 1070/9741 [00:02<00:18, 458.99it/s] 11%|█████▉                                              | 1116/9741 [00:03<00:18, 457.67it/s] 12%|██████▏                                             | 1163/9741 [00:03<00:18, 459.14it/s] 12%|██████▍                                             | 1210/9741 [00:03<00:18, 459.88it/s] 13%|██████▋                                             | 1257/9741 [00:03<00:18, 460.58it/s] 13%|██████▉                                             | 1304/9741 [00:03<00:18, 460.78it/s] 14%|███████▏                                            | 1351/9741 [00:03<00:18, 458.98it/s] 14%|███████▍                                            | 1397/9741 [00:03<00:18, 459.08it/s] 15%|███████▋                                            | 1444/9741 [00:03<00:18, 459.49it/s] 15%|███████▉                                            | 1491/9741 [00:03<00:17, 459.94it/s] 16%|████████▏                                           | 1538/9741 [00:03<00:17, 460.10it/s] 16%|████████▍                                           | 1585/9741 [00:04<00:17, 458.13it/s] 17%|████████▋                                           | 1632/9741 [00:04<00:17, 459.07it/s] 17%|████████▉                                           | 1679/9741 [00:04<00:17, 459.83it/s] 18%|█████████▏                                          | 1726/9741 [00:04<00:17, 460.09it/s] 18%|█████████▍                                          | 1773/9741 [00:04<00:17, 460.64it/s] 19%|█████████▋                                          | 1820/9741 [00:04<00:18, 438.81it/s] 19%|█████████▉                                          | 1866/9741 [00:04<00:17, 444.60it/s] 20%|██████████▏                                         | 1913/9741 [00:04<00:17, 449.25it/s] 20%|██████████▍                                         | 1959/9741 [00:04<00:17, 452.23it/s] 21%|██████████▋                                         | 2006/9741 [00:05<00:16, 455.17it/s] 21%|██████████▉                                         | 2052/9741 [00:05<00:16, 453.76it/s] 22%|███████████▏                                        | 2098/9741 [00:05<00:16, 454.95it/s] 22%|███████████▍                                        | 2145/9741 [00:05<00:16, 456.48it/s] 22%|███████████▋                                        | 2191/9741 [00:05<00:16, 457.44it/s] 23%|███████████▉                                        | 2237/9741 [00:05<00:16, 458.18it/s] 23%|████████████▏                                       | 2283/9741 [00:05<00:16, 456.56it/s] 24%|████████████▍                                       | 2329/9741 [00:05<00:16, 455.51it/s] 24%|████████████▋                                       | 2376/9741 [00:05<00:16, 457.02it/s] 25%|████████████▉                                       | 2423/9741 [00:05<00:15, 458.13it/s] 25%|█████████████▏                                      | 2469/9741 [00:06<00:15, 458.67it/s] 26%|█████████████▍                                      | 2515/9741 [00:06<00:15, 456.26it/s] 26%|█████████████▋                                      | 2561/9741 [00:06<00:15, 456.95it/s] 27%|█████████████▉                                      | 2608/9741 [00:06<00:15, 458.23it/s] 27%|██████████████▏                                     | 2654/9741 [00:06<00:15, 458.30it/s] 28%|██████████████▍                                     | 2700/9741 [00:06<00:15, 456.19it/s] 28%|██████████████▋                                     | 2746/9741 [00:06<00:15, 456.76it/s] 29%|██████████████▉                                     | 2792/9741 [00:06<00:15, 457.33it/s] 29%|███████████████▏                                    | 2838/9741 [00:06<00:15, 458.08it/s] 30%|███████████████▍                                    | 2884/9741 [00:06<00:14, 458.24it/s] 30%|███████████████▋                                    | 2930/9741 [00:07<00:15, 452.30it/s] 31%|███████████████▉                                    | 2976/9741 [00:07<00:14, 454.37it/s] 31%|████████████████▏                                   | 3023/9741 [00:07<00:14, 456.09it/s] 32%|████████████████▍                                   | 3069/9741 [00:07<00:14, 456.28it/s] 32%|████████████████▋                                   | 3116/9741 [00:07<00:14, 457.46it/s] 32%|████████████████▉                                   | 3162/9741 [00:07<00:14, 455.56it/s] 33%|█████████████████▏                                  | 3209/9741 [00:07<00:14, 457.07it/s] 33%|█████████████████▍                                  | 3256/9741 [00:07<00:14, 458.00it/s] 34%|█████████████████▋                                  | 3302/9741 [00:07<00:14, 458.11it/s] 34%|█████████████████▊                                  | 3348/9741 [00:07<00:13, 458.02it/s] 35%|██████████████████                                  | 3394/9741 [00:08<00:13, 455.72it/s] 35%|██████████████████▎                                 | 3440/9741 [00:08<00:13, 456.68it/s] 36%|██████████████████▌                                 | 3486/9741 [00:08<00:13, 453.41it/s] 36%|██████████████████▊                                 | 3532/9741 [00:08<00:13, 454.53it/s] 37%|███████████████████                                 | 3578/9741 [00:08<00:13, 455.69it/s] 37%|███████████████████▎                                | 3624/9741 [00:08<00:13, 454.33it/s] 38%|███████████████████▌                                | 3670/9741 [00:08<00:13, 455.50it/s] 38%|███████████████████▊                                | 3716/9741 [00:08<00:13, 456.05it/s] 39%|████████████████████                                | 3762/9741 [00:08<00:13, 457.04it/s] 39%|████████████████████▎                               | 3808/9741 [00:08<00:12, 457.79it/s] 40%|████████████████████▌                               | 3854/9741 [00:09<00:12, 456.14it/s] 40%|████████████████████▊                               | 3900/9741 [00:09<00:12, 457.02it/s] 41%|█████████████████████                               | 3946/9741 [00:09<00:12, 457.34it/s] 41%|█████████████████████▎                              | 3992/9741 [00:09<00:12, 457.58it/s] 41%|█████████████████████▌                              | 4038/9741 [00:09<00:12, 458.27it/s] 42%|█████████████████████▊                              | 4084/9741 [00:09<00:12, 452.10it/s] 42%|██████████████████████                              | 4130/9741 [00:09<00:12, 453.86it/s] 43%|██████████████████████▎                             | 4176/9741 [00:09<00:12, 455.33it/s] 43%|██████████████████████▌                             | 4222/9741 [00:09<00:12, 455.97it/s] 44%|██████████████████████▊                             | 4269/9741 [00:09<00:11, 457.36it/s] 44%|███████████████████████                             | 4315/9741 [00:10<00:12, 450.76it/s] 45%|███████████████████████▎                            | 4361/9741 [00:10<00:11, 452.68it/s] 45%|███████████████████████▌                            | 4407/9741 [00:10<00:11, 454.22it/s] 46%|███████████████████████▊                            | 4453/9741 [00:10<00:11, 455.30it/s] 46%|████████████████████████                            | 4500/9741 [00:10<00:11, 456.83it/s] 47%|████████████████████████▎                           | 4546/9741 [00:10<00:12, 413.16it/s] 47%|████████████████████████▌                           | 4592/9741 [00:10<00:12, 425.92it/s] 48%|████████████████████████▊                           | 4638/9741 [00:10<00:11, 435.52it/s] 48%|█████████████████████████                           | 4685/9741 [00:10<00:11, 442.74it/s] 49%|█████████████████████████▏                          | 4730/9741 [00:11<00:11, 444.66it/s] 49%|█████████████████████████▍                          | 4775/9741 [00:11<00:15, 324.73it/s] 49%|█████████████████████████▋                          | 4821/9741 [00:11<00:13, 355.95it/s] 50%|█████████████████████████▉                          | 4867/9741 [00:11<00:12, 381.25it/s] 50%|██████████████████████████▏                         | 4913/9741 [00:11<00:12, 401.60it/s] 51%|██████████████████████████▍                         | 4959/9741 [00:11<00:11, 415.76it/s] 51%|██████████████████████████▋                         | 5005/9741 [00:11<00:11, 428.10it/s] 52%|██████████████████████████▉                         | 5051/9741 [00:11<00:10, 436.88it/s] 52%|███████████████████████████▏                        | 5097/9741 [00:11<00:10, 443.25it/s] 53%|███████████████████████████▍                        | 5143/9741 [00:12<00:10, 447.90it/s] 53%|███████████████████████████▋                        | 5189/9741 [00:12<00:10, 449.00it/s] 54%|███████████████████████████▉                        | 5235/9741 [00:12<00:10, 448.01it/s] 54%|████████████████████████████▏                       | 5281/9741 [00:12<00:09, 450.69it/s] 55%|████████████████████████████▍                       | 5327/9741 [00:12<00:09, 453.22it/s] 55%|████████████████████████████▋                       | 5373/9741 [00:12<00:09, 454.81it/s] 56%|████████████████████████████▉                       | 5419/9741 [00:12<00:09, 453.46it/s] 56%|█████████████████████████████▏                      | 5465/9741 [00:12<00:09, 454.33it/s] 57%|█████████████████████████████▍                      | 5513/9741 [00:12<00:09, 459.51it/s] 57%|█████████████████████████████▋                      | 5561/9741 [00:12<00:09, 463.87it/s] 58%|█████████████████████████████▉                      | 5609/9741 [00:13<00:08, 466.19it/s] 58%|██████████████████████████████▏                     | 5656/9741 [00:13<00:08, 465.84it/s] 59%|██████████████████████████████▍                     | 5704/9741 [00:13<00:08, 468.50it/s] 59%|██████████████████████████████▋                     | 5752/9741 [00:13<00:08, 470.30it/s] 60%|██████████████████████████████▉                     | 5800/9741 [00:13<00:08, 470.90it/s] 60%|███████████████████████████████▏                    | 5848/9741 [00:13<00:08, 470.70it/s] 61%|███████████████████████████████▍                    | 5896/9741 [00:13<00:08, 468.68it/s] 61%|███████████████████████████████▋                    | 5944/9741 [00:13<00:08, 469.90it/s] 62%|███████████████████████████████▉                    | 5991/9741 [00:13<00:07, 469.09it/s] 62%|████████████████████████████████▏                   | 6039/9741 [00:13<00:07, 470.85it/s] 62%|████████████████████████████████▍                   | 6087/9741 [00:14<00:07, 469.82it/s] 63%|████████████████████████████████▊                   | 6135/9741 [00:14<00:07, 470.41it/s] 63%|█████████████████████████████████                   | 6183/9741 [00:14<00:07, 471.16it/s] 64%|█████████████████████████████████▎                  | 6231/9741 [00:14<00:07, 471.61it/s] 64%|█████████████████████████████████▌                  | 6279/9741 [00:14<00:07, 471.52it/s] 65%|█████████████████████████████████▊                  | 6327/9741 [00:14<00:07, 469.57it/s] 65%|██████████████████████████████████                  | 6375/9741 [00:14<00:07, 470.87it/s] 66%|██████████████████████████████████▎                 | 6423/9741 [00:14<00:07, 471.76it/s] 66%|██████████████████████████████████▌                 | 6471/9741 [00:14<00:06, 472.15it/s] 67%|██████████████████████████████████▊                 | 6519/9741 [00:14<00:06, 471.47it/s] 67%|███████████████████████████████████                 | 6567/9741 [00:15<00:06, 469.90it/s] 68%|███████████████████████████████████▎                | 6615/9741 [00:15<00:06, 470.38it/s] 68%|███████████████████████████████████▌                | 6663/9741 [00:15<00:06, 471.15it/s] 69%|███████████████████████████████████▊                | 6711/9741 [00:15<00:06, 471.71it/s] 69%|████████████████████████████████████                | 6759/9741 [00:15<00:06, 472.50it/s] 70%|████████████████████████████████████▎               | 6807/9741 [00:15<00:06, 470.11it/s] 70%|████████████████████████████████████▌               | 6855/9741 [00:15<00:06, 470.99it/s] 71%|████████████████████████████████████▊               | 6903/9741 [00:15<00:06, 472.01it/s] 71%|█████████████████████████████████████               | 6951/9741 [00:15<00:05, 472.44it/s] 72%|█████████████████████████████████████▎              | 6999/9741 [00:16<00:05, 470.11it/s] 72%|█████████████████████████████████████▌              | 7047/9741 [00:16<00:05, 471.17it/s] 73%|█████████████████████████████████████▊              | 7095/9741 [00:16<00:05, 471.78it/s] 73%|██████████████████████████████████████▏             | 7143/9741 [00:16<00:05, 472.40it/s] 74%|██████████████████████████████████████▍             | 7191/9741 [00:16<00:05, 472.70it/s] 74%|██████████████████████████████████████▋             | 7239/9741 [00:16<00:05, 470.87it/s] 75%|██████████████████████████████████████▉             | 7287/9741 [00:16<00:05, 471.12it/s] 75%|███████████████████████████████████████▏            | 7335/9741 [00:16<00:05, 471.55it/s] 76%|███████████████████████████████████████▍            | 7383/9741 [00:16<00:04, 472.47it/s] 76%|███████████████████████████████████████▋            | 7431/9741 [00:16<00:04, 472.43it/s] 77%|███████████████████████████████████████▉            | 7479/9741 [00:17<00:05, 444.49it/s] 77%|████████████████████████████████████████▏           | 7527/9741 [00:17<00:04, 452.78it/s] 78%|████████████████████████████████████████▍           | 7575/9741 [00:17<00:04, 459.16it/s] 78%|████████████████████████████████████████▋           | 7622/9741 [00:17<00:04, 462.12it/s] 79%|████████████████████████████████████████▉           | 7669/9741 [00:17<00:04, 462.62it/s] 79%|█████████████████████████████████████████▏          | 7717/9741 [00:17<00:04, 465.88it/s] 80%|█████████████████████████████████████████▍          | 7765/9741 [00:17<00:04, 468.36it/s] 80%|█████████████████████████████████████████▋          | 7813/9741 [00:17<00:04, 469.39it/s] 81%|█████████████████████████████████████████▉          | 7861/9741 [00:17<00:03, 470.12it/s] 81%|██████████████████████████████████████████▏         | 7909/9741 [00:17<00:03, 468.92it/s] 82%|██████████████████████████████████████████▍         | 7957/9741 [00:18<00:03, 469.57it/s] 82%|██████████████████████████████████████████▋         | 8005/9741 [00:18<00:03, 470.70it/s] 83%|██████████████████████████████████████████▉         | 8053/9741 [00:18<00:03, 471.14it/s] 83%|███████████████████████████████████████████▏        | 8101/9741 [00:18<00:03, 472.44it/s] 84%|███████████████████████████████████████████▌        | 8149/9741 [00:18<00:03, 471.22it/s] 84%|███████████████████████████████████████████▊        | 8197/9741 [00:18<00:03, 471.48it/s] 85%|████████████████████████████████████████████        | 8245/9741 [00:18<00:03, 472.14it/s] 85%|████████████████████████████████████████████▎       | 8293/9741 [00:18<00:03, 471.70it/s] 86%|████████████████████████████████████████████▌       | 8341/9741 [00:18<00:02, 472.28it/s] 86%|████████████████████████████████████████████▊       | 8389/9741 [00:18<00:02, 469.15it/s] 87%|█████████████████████████████████████████████       | 8437/9741 [00:19<00:02, 470.52it/s] 87%|█████████████████████████████████████████████▎      | 8485/9741 [00:19<00:02, 470.95it/s] 88%|█████████████████████████████████████████████▌      | 8533/9741 [00:19<00:02, 470.84it/s] 88%|█████████████████████████████████████████████▊      | 8581/9741 [00:19<00:02, 469.02it/s] 89%|██████████████████████████████████████████████      | 8629/9741 [00:19<00:02, 469.59it/s] 89%|██████████████████████████████████████████████▎     | 8677/9741 [00:19<00:02, 469.91it/s] 90%|██████████████████████████████████████████████▌     | 8725/9741 [00:19<00:02, 470.87it/s] 90%|██████████████████████████████████████████████▊     | 8773/9741 [00:19<00:02, 471.56it/s] 91%|███████████████████████████████████████████████     | 8821/9741 [00:19<00:01, 469.22it/s] 91%|███████████████████████████████████████████████▎    | 8869/9741 [00:19<00:01, 470.15it/s] 92%|███████████████████████████████████████████████▌    | 8917/9741 [00:20<00:01, 471.44it/s] 92%|███████████████████████████████████████████████▊    | 8965/9741 [00:20<00:01, 471.64it/s] 93%|████████████████████████████████████████████████    | 9013/9741 [00:20<00:01, 472.10it/s] 93%|████████████████████████████████████████████████▎   | 9061/9741 [00:20<00:01, 470.60it/s] 94%|████████████████████████████████████████████████▋   | 9109/9741 [00:20<00:01, 471.17it/s] 94%|████████████████████████████████████████████████▉   | 9157/9741 [00:20<00:01, 471.41it/s] 94%|█████████████████████████████████████████████████▏  | 9205/9741 [00:20<00:01, 471.52it/s] 95%|█████████████████████████████████████████████████▍  | 9253/9741 [00:20<00:01, 471.87it/s] 95%|█████████████████████████████████████████████████▋  | 9301/9741 [00:20<00:00, 469.87it/s] 96%|█████████████████████████████████████████████████▉  | 9349/9741 [00:21<00:00, 470.54it/s] 96%|██████████████████████████████████████████████████▏ | 9397/9741 [00:21<00:00, 471.18it/s] 97%|██████████████████████████████████████████████████▍ | 9445/9741 [00:21<00:00, 471.77it/s] 97%|██████████████████████████████████████████████████▋ | 9493/9741 [00:21<00:00, 469.59it/s] 98%|██████████████████████████████████████████████████▉ | 9541/9741 [00:21<00:00, 470.63it/s] 98%|███████████████████████████████████████████████████▏| 9589/9741 [00:21<00:00, 471.07it/s] 99%|███████████████████████████████████████████████████▍| 9637/9741 [00:21<00:00, 471.23it/s] 99%|███████████████████████████████████████████████████▋| 9685/9741 [00:21<00:00, 471.75it/s]100%|███████████████████████████████████████████████████▉| 9733/9741 [00:21<00:00, 469.67it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:21<00:00, 445.83it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.07s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.49s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.97s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.06s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.23s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.37s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.60s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.46s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.63s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.55s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]
[2023-08-21 15:00:11,275] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.94s/it]
[2023-08-21 15:00:25,541] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 15:00:25,542] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 15:00:25,542] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 15:00:25,542] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 15:00:25,542] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 15:00:25,542] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 15:00:25,542] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 15:00:25,542] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fe3a3d3bf40>
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fe37b8dcd90>
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 15:00:25,543] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 15:00:25,544] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 15:00:25,544] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 15:00:25,544] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 15:00:25,544] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 15:00:25,544] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 15:00:25,544] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 15:00:25,544] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.524294376373291 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o15-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.5052719116210938 seconds
Loading extension module utils...
Time to load utils op: 0.5046749114990234 seconds
Loading extension module utils...
Time to load utils op: 0.50472092628479 seconds
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:43<35:37, 43.62s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:26<34:29, 43.12s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [01:46<25:38, 32.73s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:30<28:21, 37.00s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:14<29:38, 39.51s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:56<29:45, 40.57s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:40<29:47, 41.58s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:23<29:25, 42.04s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:06<28:58, 42.40s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:49<28:24, 42.61s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:33<27:55, 42.97s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:17<27:23, 43.24s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:00<26:42, 43.31s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:44<26:06, 43.50s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:28<25:25, 43.58s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:11<24:38, 43.48s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [11:56<24:02, 43.72s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:39<23:19, 43.72s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:19<21:54, 42.40s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:02<21:22, 42.74s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:46<20:46, 42.99s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:30<20:10, 43.23s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [16:13<19:25, 43.15s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [16:56<18:45, 43.28s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:40<18:03, 43.33s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:23<17:21, 43.39s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [18:37<13:16, 34.62s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [19:21<13:41, 37.32s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:04<13:42, 39.16s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [20:48<13:29, 40.48s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [21:32<13:07, 41.43s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [22:16<12:39, 42.21s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [22:40<10:26, 36.86s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:23<10:21, 38.83s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [24:07<10:04, 40.27s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [24:51<09:37, 41.23s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [25:34<09:05, 41.97s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [26:09<07:56, 39.70s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [26:52<07:29, 40.87s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [27:36<06:58, 41.82s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [28:20<06:22, 42.47s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [29:04<05:41, 42.73s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [29:31<04:27, 38.25s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [30:15<03:59, 39.95s/it]Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [30:59<03:25, 41.08s/it]Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [31:43<02:47, 41.88s/it]Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [32:26<02:07, 42.38s/it]Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [33:10<01:25, 42.77s/it]Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [33:53<00:42, 42.98s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:37<00:00, 43.05s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:37<00:00, 41.54s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.9045} | lm_loss 8.1555 | avg. gen lenth: 295.532
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o16-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 16
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-21 15:36:36,589] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o16-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 16
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o16-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 29/9741 [00:00<00:34, 283.91it/s]  1%|▎                                                     | 58/9741 [00:00<00:33, 284.92it/s]  1%|▍                                                     | 87/9741 [00:00<00:33, 285.26it/s]  1%|▋                                                    | 116/9741 [00:00<00:33, 286.01it/s]  1%|▊                                                    | 145/9741 [00:00<00:33, 286.02it/s]  2%|▉                                                    | 174/9741 [00:00<00:33, 286.24it/s]  2%|█                                                    | 203/9741 [00:00<00:34, 279.09it/s]  2%|█▎                                                   | 232/9741 [00:00<00:33, 280.86it/s]  3%|█▍                                                   | 261/9741 [00:00<00:33, 282.32it/s]  3%|█▌                                                   | 290/9741 [00:01<00:33, 282.91it/s]  3%|█▋                                                   | 319/9741 [00:01<00:33, 278.49it/s]  4%|█▉                                                   | 348/9741 [00:01<00:33, 280.68it/s]  4%|██                                                   | 377/9741 [00:01<00:33, 282.37it/s]  4%|██▏                                                  | 406/9741 [00:01<00:32, 283.37it/s]  4%|██▎                                                  | 435/9741 [00:01<00:32, 282.35it/s]  5%|██▌                                                  | 464/9741 [00:01<00:32, 283.47it/s]  5%|██▋                                                  | 493/9741 [00:01<00:32, 280.50it/s]  5%|██▊                                                  | 522/9741 [00:01<00:32, 281.87it/s]  6%|██▉                                                  | 551/9741 [00:01<00:32, 283.07it/s]  6%|███▏                                                 | 580/9741 [00:02<00:32, 283.38it/s]  6%|███▎                                                 | 609/9741 [00:02<00:32, 283.76it/s]  7%|███▍                                                 | 638/9741 [00:02<00:32, 284.08it/s]  7%|███▋                                                 | 667/9741 [00:02<00:32, 282.50it/s]  7%|███▊                                                 | 696/9741 [00:02<00:31, 283.33it/s]  8%|████                                                 | 736/9741 [00:02<00:28, 316.24it/s]  8%|████▏                                                | 780/9741 [00:02<00:25, 351.22it/s]  8%|████▍                                                | 824/9741 [00:02<00:23, 376.11it/s]  9%|████▋                                                | 868/9741 [00:02<00:22, 393.37it/s]  9%|████▉                                                | 911/9741 [00:02<00:21, 402.89it/s] 10%|█████▏                                               | 955/9741 [00:03<00:21, 411.61it/s] 10%|█████▍                                               | 999/9741 [00:03<00:20, 418.03it/s] 11%|█████▌                                              | 1043/9741 [00:03<00:20, 422.81it/s] 11%|█████▊                                              | 1087/9741 [00:03<00:20, 426.29it/s] 12%|██████                                              | 1130/9741 [00:03<00:20, 425.78it/s] 12%|██████▎                                             | 1174/9741 [00:03<00:20, 427.47it/s] 13%|██████▌                                             | 1218/9741 [00:03<00:19, 428.47it/s] 13%|██████▋                                             | 1262/9741 [00:03<00:19, 429.53it/s] 13%|██████▉                                             | 1306/9741 [00:03<00:19, 430.26it/s] 14%|███████▏                                            | 1350/9741 [00:03<00:19, 428.39it/s] 14%|███████▍                                            | 1393/9741 [00:04<00:19, 426.83it/s] 15%|███████▋                                            | 1437/9741 [00:04<00:19, 428.55it/s] 15%|███████▉                                            | 1480/9741 [00:04<00:19, 428.38it/s] 16%|████████▏                                           | 1523/9741 [00:04<00:19, 428.24it/s] 16%|████████▎                                           | 1566/9741 [00:04<00:19, 427.04it/s] 17%|████████▌                                           | 1610/9741 [00:04<00:18, 428.33it/s] 17%|████████▊                                           | 1654/9741 [00:04<00:18, 429.97it/s] 17%|█████████                                           | 1697/9741 [00:04<00:18, 429.62it/s] 18%|█████████▎                                          | 1741/9741 [00:04<00:18, 430.17it/s] 18%|█████████▌                                          | 1785/9741 [00:05<00:18, 430.64it/s] 19%|█████████▊                                          | 1829/9741 [00:05<00:19, 408.16it/s] 19%|█████████▉                                          | 1872/9741 [00:05<00:18, 414.20it/s] 20%|██████████▏                                         | 1915/9741 [00:05<00:18, 416.05it/s] 20%|██████████▍                                         | 1959/9741 [00:05<00:18, 420.29it/s] 21%|██████████▋                                         | 2003/9741 [00:05<00:18, 423.56it/s] 21%|██████████▉                                         | 2046/9741 [00:05<00:18, 418.93it/s] 21%|███████████▏                                        | 2089/9741 [00:05<00:18, 421.24it/s] 22%|███████████▍                                        | 2132/9741 [00:05<00:18, 420.67it/s] 22%|███████████▌                                        | 2176/9741 [00:05<00:17, 423.82it/s] 23%|███████████▊                                        | 2220/9741 [00:06<00:17, 425.79it/s] 23%|████████████                                        | 2263/9741 [00:06<00:17, 424.71it/s] 24%|████████████▎                                       | 2307/9741 [00:06<00:17, 426.94it/s] 24%|████████████▌                                       | 2351/9741 [00:06<00:17, 428.20it/s] 25%|████████████▊                                       | 2394/9741 [00:06<00:17, 428.66it/s] 25%|█████████████                                       | 2437/9741 [00:06<00:17, 428.95it/s] 25%|█████████████▏                                      | 2480/9741 [00:06<00:16, 427.19it/s] 26%|█████████████▍                                      | 2523/9741 [00:06<00:16, 427.54it/s] 26%|█████████████▋                                      | 2566/9741 [00:06<00:16, 428.15it/s] 27%|█████████████▉                                      | 2609/9741 [00:06<00:16, 424.24it/s] 27%|██████████████▏                                     | 2653/9741 [00:07<00:16, 426.13it/s] 28%|██████████████▍                                     | 2697/9741 [00:07<00:16, 424.14it/s] 28%|██████████████▋                                     | 2740/9741 [00:07<00:16, 425.78it/s] 29%|██████████████▊                                     | 2783/9741 [00:07<00:16, 426.37it/s] 29%|███████████████                                     | 2826/9741 [00:07<00:16, 427.08it/s] 29%|███████████████▎                                    | 2870/9741 [00:07<00:16, 428.51it/s] 30%|███████████████▌                                    | 2914/9741 [00:07<00:15, 429.44it/s] 30%|███████████████▊                                    | 2957/9741 [00:07<00:15, 426.01it/s] 31%|████████████████                                    | 3001/9741 [00:07<00:15, 427.32it/s] 31%|████████████████▎                                   | 3045/9741 [00:07<00:15, 428.78it/s] 32%|████████████████▍                                   | 3089/9741 [00:08<00:15, 429.41it/s] 32%|████████████████▋                                   | 3132/9741 [00:08<00:15, 426.86it/s] 33%|████████████████▉                                   | 3175/9741 [00:08<00:15, 424.68it/s] 33%|█████████████████▏                                  | 3219/9741 [00:08<00:15, 426.54it/s] 33%|█████████████████▍                                  | 3263/9741 [00:08<00:15, 428.46it/s] 34%|█████████████████▋                                  | 3306/9741 [00:08<00:15, 428.37it/s] 34%|█████████████████▉                                  | 3349/9741 [00:08<00:14, 428.57it/s] 35%|██████████████████                                  | 3392/9741 [00:08<00:14, 426.34it/s] 35%|██████████████████▎                                 | 3436/9741 [00:08<00:14, 428.22it/s] 36%|██████████████████▌                                 | 3479/9741 [00:08<00:14, 428.34it/s] 36%|██████████████████▊                                 | 3522/9741 [00:09<00:14, 428.01it/s] 37%|███████████████████                                 | 3566/9741 [00:09<00:14, 428.84it/s] 37%|███████████████████▎                                | 3609/9741 [00:09<00:14, 427.38it/s] 38%|███████████████████▌                                | 3653/9741 [00:09<00:14, 428.66it/s] 38%|███████████████████▋                                | 3696/9741 [00:09<00:14, 428.11it/s] 38%|███████████████████▉                                | 3740/9741 [00:09<00:13, 429.17it/s] 39%|████████████████████▏                               | 3784/9741 [00:09<00:13, 429.58it/s] 39%|████████████████████▍                               | 3827/9741 [00:09<00:13, 429.64it/s] 40%|████████████████████▋                               | 3870/9741 [00:09<00:13, 426.51it/s] 40%|████████████████████▉                               | 3913/9741 [00:10<00:13, 426.27it/s] 41%|█████████████████████                               | 3956/9741 [00:10<00:13, 427.28it/s] 41%|█████████████████████▎                              | 4000/9741 [00:10<00:13, 428.57it/s] 42%|█████████████████████▌                              | 4043/9741 [00:10<00:13, 428.53it/s] 42%|█████████████████████▊                              | 4086/9741 [00:10<00:13, 426.28it/s] 42%|██████████████████████                              | 4130/9741 [00:10<00:13, 427.48it/s] 43%|██████████████████████▎                             | 4173/9741 [00:10<00:13, 427.62it/s] 43%|██████████████████████▌                             | 4216/9741 [00:10<00:12, 426.57it/s] 44%|██████████████████████▋                             | 4260/9741 [00:10<00:12, 427.63it/s] 44%|██████████████████████▉                             | 4303/9741 [00:10<00:12, 426.14it/s] 45%|███████████████████████▏                            | 4347/9741 [00:11<00:12, 427.49it/s] 45%|███████████████████████▍                            | 4390/9741 [00:11<00:12, 427.39it/s] 46%|███████████████████████▋                            | 4433/9741 [00:11<00:12, 427.75it/s] 46%|███████████████████████▉                            | 4476/9741 [00:11<00:12, 428.11it/s] 46%|████████████████████████                            | 4519/9741 [00:11<00:13, 394.78it/s] 47%|████████████████████████▎                           | 4562/9741 [00:11<00:12, 403.95it/s] 47%|████████████████████████▌                           | 4605/9741 [00:11<00:12, 411.06it/s] 48%|████████████████████████▊                           | 4649/9741 [00:11<00:12, 416.70it/s] 48%|█████████████████████████                           | 4693/9741 [00:11<00:11, 421.04it/s] 49%|█████████████████████████▎                          | 4736/9741 [00:11<00:11, 423.31it/s] 49%|█████████████████████████▌                          | 4779/9741 [00:12<00:16, 295.08it/s] 50%|█████████████████████████▋                          | 4822/9741 [00:12<00:15, 325.43it/s] 50%|█████████████████████████▉                          | 4865/9741 [00:12<00:13, 350.50it/s] 50%|██████████████████████████▏                         | 4908/9741 [00:12<00:13, 370.40it/s] 51%|██████████████████████████▍                         | 4951/9741 [00:12<00:12, 384.38it/s] 51%|██████████████████████████▋                         | 4995/9741 [00:12<00:11, 397.18it/s] 52%|██████████████████████████▉                         | 5038/9741 [00:12<00:11, 405.29it/s] 52%|███████████████████████████                         | 5081/9741 [00:12<00:11, 411.80it/s] 53%|███████████████████████████▎                        | 5124/9741 [00:13<00:11, 416.67it/s] 53%|███████████████████████████▌                        | 5167/9741 [00:13<00:10, 420.10it/s] 53%|███████████████████████████▊                        | 5210/9741 [00:13<00:10, 419.81it/s] 54%|████████████████████████████                        | 5253/9741 [00:13<00:10, 419.79it/s] 54%|████████████████████████████▎                       | 5296/9741 [00:13<00:10, 421.97it/s] 55%|████████████████████████████▌                       | 5339/9741 [00:13<00:10, 422.92it/s] 55%|████████████████████████████▋                       | 5382/9741 [00:13<00:10, 421.43it/s] 56%|████████████████████████████▉                       | 5425/9741 [00:13<00:10, 419.52it/s] 56%|█████████████████████████████▏                      | 5469/9741 [00:13<00:10, 422.66it/s] 57%|█████████████████████████████▍                      | 5514/9741 [00:13<00:09, 428.64it/s] 57%|█████████████████████████████▋                      | 5559/9741 [00:14<00:09, 432.91it/s] 58%|█████████████████████████████▉                      | 5604/9741 [00:14<00:09, 435.97it/s] 58%|██████████████████████████████▏                     | 5648/9741 [00:14<00:09, 435.45it/s] 58%|██████████████████████████████▍                     | 5693/9741 [00:14<00:09, 437.31it/s] 59%|██████████████████████████████▋                     | 5738/9741 [00:14<00:09, 439.07it/s] 59%|██████████████████████████████▊                     | 5783/9741 [00:14<00:08, 440.59it/s] 60%|███████████████████████████████                     | 5828/9741 [00:14<00:08, 441.59it/s] 60%|███████████████████████████████▎                    | 5873/9741 [00:14<00:08, 440.10it/s] 61%|███████████████████████████████▌                    | 5918/9741 [00:14<00:08, 440.75it/s] 61%|███████████████████████████████▊                    | 5963/9741 [00:14<00:08, 441.66it/s] 62%|████████████████████████████████                    | 6008/9741 [00:15<00:08, 440.94it/s] 62%|████████████████████████████████▎                   | 6053/9741 [00:15<00:08, 441.47it/s] 63%|████████████████████████████████▌                   | 6098/9741 [00:15<00:08, 438.78it/s] 63%|████████████████████████████████▊                   | 6143/9741 [00:15<00:08, 440.24it/s] 64%|█████████████████████████████████                   | 6188/9741 [00:15<00:08, 441.66it/s] 64%|█████████████████████████████████▎                  | 6233/9741 [00:15<00:07, 441.94it/s] 64%|█████████████████████████████████▌                  | 6278/9741 [00:15<00:07, 440.95it/s] 65%|█████████████████████████████████▊                  | 6323/9741 [00:15<00:07, 439.50it/s] 65%|█████████████████████████████████▉                  | 6368/9741 [00:15<00:07, 441.22it/s] 66%|██████████████████████████████████▏                 | 6413/9741 [00:15<00:07, 438.37it/s] 66%|██████████████████████████████████▍                 | 6457/9741 [00:16<00:07, 428.55it/s] 67%|██████████████████████████████████▋                 | 6500/9741 [00:16<00:07, 417.71it/s] 67%|██████████████████████████████████▉                 | 6544/9741 [00:16<00:07, 421.83it/s] 68%|███████████████████████████████████▏                | 6588/9741 [00:16<00:07, 425.78it/s] 68%|███████████████████████████████████▍                | 6633/9741 [00:16<00:07, 430.47it/s] 69%|███████████████████████████████████▋                | 6677/9741 [00:16<00:07, 424.74it/s] 69%|███████████████████████████████████▊                | 6720/9741 [00:16<00:07, 419.52it/s] 69%|████████████████████████████████████                | 6764/9741 [00:16<00:07, 424.40it/s] 70%|████████████████████████████████████▎               | 6809/9741 [00:16<00:06, 429.92it/s] 70%|████████████████████████████████████▌               | 6853/9741 [00:17<00:06, 430.06it/s] 71%|████████████████████████████████████▊               | 6897/9741 [00:17<00:06, 418.26it/s] 71%|█████████████████████████████████████               | 6939/9741 [00:17<00:06, 416.15it/s] 72%|█████████████████████████████████████▎              | 6983/9741 [00:17<00:06, 421.09it/s] 72%|█████████████████████████████████████▌              | 7026/9741 [00:17<00:06, 412.93it/s] 73%|█████████████████████████████████████▋              | 7070/9741 [00:17<00:06, 418.28it/s] 73%|█████████████████████████████████████▉              | 7115/9741 [00:17<00:06, 425.93it/s] 74%|██████████████████████████████████████▏             | 7160/9741 [00:17<00:05, 431.28it/s] 74%|██████████████████████████████████████▍             | 7205/9741 [00:17<00:05, 434.77it/s] 74%|██████████████████████████████████████▋             | 7249/9741 [00:17<00:05, 435.53it/s] 75%|██████████████████████████████████████▉             | 7294/9741 [00:18<00:05, 438.52it/s] 75%|███████████████████████████████████████▏            | 7339/9741 [00:18<00:05, 439.98it/s] 76%|███████████████████████████████████████▍            | 7384/9741 [00:18<00:05, 441.37it/s] 76%|███████████████████████████████████████▋            | 7429/9741 [00:18<00:05, 442.58it/s] 77%|███████████████████████████████████████▉            | 7474/9741 [00:18<00:05, 409.64it/s] 77%|████████████████████████████████████████▏           | 7519/9741 [00:18<00:05, 419.13it/s] 78%|████████████████████████████████████████▎           | 7562/9741 [00:18<00:05, 413.76it/s] 78%|████████████████████████████████████████▌           | 7604/9741 [00:18<00:05, 402.38it/s] 79%|████████████████████████████████████████▊           | 7648/9741 [00:18<00:05, 411.81it/s] 79%|█████████████████████████████████████████           | 7690/9741 [00:19<00:05, 403.70it/s] 79%|█████████████████████████████████████████▎          | 7734/9741 [00:19<00:04, 412.74it/s] 80%|█████████████████████████████████████████▌          | 7779/9741 [00:19<00:04, 421.48it/s] 80%|█████████████████████████████████████████▊          | 7824/9741 [00:19<00:04, 428.17it/s] 81%|██████████████████████████████████████████          | 7869/9741 [00:19<00:04, 432.62it/s] 81%|██████████████████████████████████████████▏         | 7913/9741 [00:19<00:04, 434.04it/s] 82%|██████████████████████████████████████████▍         | 7958/9741 [00:19<00:04, 437.97it/s] 82%|██████████████████████████████████████████▋         | 8003/9741 [00:19<00:03, 440.90it/s] 83%|██████████████████████████████████████████▉         | 8048/9741 [00:19<00:03, 441.97it/s] 83%|███████████████████████████████████████████▏        | 8093/9741 [00:19<00:03, 442.61it/s] 84%|███████████████████████████████████████████▍        | 8138/9741 [00:20<00:03, 440.34it/s] 84%|███████████████████████████████████████████▋        | 8183/9741 [00:20<00:03, 435.62it/s] 84%|███████████████████████████████████████████▉        | 8228/9741 [00:20<00:03, 437.81it/s] 85%|████████████████████████████████████████████▏       | 8273/9741 [00:20<00:03, 439.67it/s] 85%|████████████████████████████████████████████▍       | 8318/9741 [00:20<00:03, 441.32it/s] 86%|████████████████████████████████████████████▋       | 8363/9741 [00:20<00:03, 440.53it/s] 86%|████████████████████████████████████████████▉       | 8408/9741 [00:20<00:03, 441.41it/s] 87%|█████████████████████████████████████████████       | 8453/9741 [00:20<00:02, 442.65it/s] 87%|█████████████████████████████████████████████▎      | 8498/9741 [00:20<00:02, 442.86it/s] 88%|█████████████████████████████████████████████▌      | 8543/9741 [00:20<00:02, 443.04it/s] 88%|█████████████████████████████████████████████▊      | 8588/9741 [00:21<00:02, 440.61it/s] 89%|██████████████████████████████████████████████      | 8633/9741 [00:21<00:02, 441.21it/s] 89%|██████████████████████████████████████████████▎     | 8678/9741 [00:21<00:02, 438.61it/s] 90%|██████████████████████████████████████████████▌     | 8722/9741 [00:21<00:02, 437.60it/s] 90%|██████████████████████████████████████████████▊     | 8767/9741 [00:21<00:02, 438.53it/s] 90%|███████████████████████████████████████████████     | 8811/9741 [00:21<00:02, 437.93it/s] 91%|███████████████████████████████████████████████▎    | 8856/9741 [00:21<00:02, 439.87it/s] 91%|███████████████████████████████████████████████▌    | 8900/9741 [00:21<00:01, 437.54it/s] 92%|███████████████████████████████████████████████▊    | 8945/9741 [00:21<00:01, 438.83it/s] 92%|███████████████████████████████████████████████▉    | 8990/9741 [00:21<00:01, 440.23it/s] 93%|████████████████████████████████████████████████▏   | 9035/9741 [00:22<00:01, 438.45it/s] 93%|████████████████████████████████████████████████▍   | 9080/9741 [00:22<00:01, 440.35it/s] 94%|████████████████████████████████████████████████▋   | 9125/9741 [00:22<00:01, 441.26it/s] 94%|████████████████████████████████████████████████▉   | 9170/9741 [00:22<00:01, 439.31it/s] 95%|█████████████████████████████████████████████████▏  | 9215/9741 [00:22<00:01, 440.85it/s] 95%|█████████████████████████████████████████████████▍  | 9260/9741 [00:22<00:01, 438.97it/s] 96%|█████████████████████████████████████████████████▋  | 9305/9741 [00:22<00:00, 440.19it/s] 96%|█████████████████████████████████████████████████▉  | 9350/9741 [00:22<00:00, 440.72it/s] 96%|██████████████████████████████████████████████████▏ | 9395/9741 [00:22<00:00, 441.23it/s] 97%|██████████████████████████████████████████████████▍ | 9440/9741 [00:22<00:00, 442.18it/s] 97%|██████████████████████████████████████████████████▋ | 9485/9741 [00:23<00:00, 440.45it/s] 98%|██████████████████████████████████████████████████▊ | 9530/9741 [00:23<00:00, 441.76it/s] 98%|███████████████████████████████████████████████████ | 9575/9741 [00:23<00:00, 442.57it/s] 99%|███████████████████████████████████████████████████▎| 9620/9741 [00:23<00:00, 442.68it/s] 99%|███████████████████████████████████████████████████▌| 9665/9741 [00:23<00:00, 435.23it/s]100%|███████████████████████████████████████████████████▊| 9709/9741 [00:23<00:00, 432.73it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:23<00:00, 411.65it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.22s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.37s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.66s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.87s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.23s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.56s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.27s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]
[2023-08-21 15:37:51,343] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.88s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.08s/it]
[2023-08-21 15:38:02,572] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 15:38:02,573] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 15:38:02,574] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 15:38:02,574] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 15:38:02,574] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 15:38:02,574] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f23bb677f40>
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 15:38:02,575] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f238f0bfdc0>
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 15:38:02,576] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 15:38:02,576] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.48862218856811523 seconds
2048
Loading extension module utils...
Time to load utils op: 0.4047822952270508 seconds
Loading extension module utils...
Time to load utils op: 0.4048459529876709 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

2048
Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]2048
############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input: Tonya has $150.00 on her credit card.  If she leaves any balance on her card at the end of the month, she is charged 20% interest.  If she makes a $50.00 payment on her card, what will be the new balance?
Output: 120

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o16-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.5049498081207275 seconds
2048
2048
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:43<35:32, 43.51s/it]2048
2048
2048
Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:19<31:05, 38.87s/it]2048
2048
2048
2048
Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:02<31:53, 40.71s/it]2048
2048
2048
2048
Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:45<31:59, 41.73s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  10%|███                            | 5/50 [03:28<31:37, 42.17s/it]2048
2048
2048
2048
2048
2048
Evaluating commonsenseqa :  12%|███▋                           | 6/50 [04:10<31:01, 42.30s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:54<30:33, 42.64s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:36<29:53, 42.70s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [06:19<29:11, 42.71s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  20%|██████                        | 10/50 [07:02<28:24, 42.62s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:44<27:44, 42.67s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [08:27<27:01, 42.68s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [09:10<26:24, 42.83s/it]2048
2048
2048
2048
2048
Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [09:53<25:42, 42.84s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  30%|█████████                     | 15/50 [10:36<25:00, 42.86s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [11:19<24:18, 42.90s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [12:02<23:39, 43.02s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [12:45<22:56, 43.02s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [13:29<22:20, 43.24s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  40%|████████████                  | 20/50 [14:12<21:33, 43.10s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [14:54<20:43, 42.89s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [15:37<19:57, 42.78s/it]2048
2048
2048
Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [15:55<15:56, 35.41s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [16:38<16:17, 37.61s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  50%|███████████████               | 25/50 [17:21<16:22, 39.29s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [18:04<16:10, 40.45s/it]2048
2048
2048
2048
2048
Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [18:48<15:51, 41.38s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [19:31<15:19, 41.81s/it]2048
2048
2048
Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [20:09<14:18, 40.87s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [20:52<13:48, 41.41s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [21:35<13:14, 41.84s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [22:18<12:39, 42.20s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [23:01<12:00, 42.41s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [23:44<11:20, 42.54s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [24:26<10:38, 42.57s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [25:09<09:56, 42.62s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [25:52<09:15, 42.74s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [26:35<08:34, 42.88s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [27:18<07:52, 43.00s/it]2048
2048
2048
2048
2048
Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [28:02<07:11, 43.11s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [28:45<06:27, 43.07s/it]2048
Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [29:10<05:01, 37.66s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [29:52<04:34, 39.16s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [30:35<04:01, 40.20s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  90%|███████████████████████████   | 45/50 [31:18<03:24, 40.96s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  92%|███████████████████████████▌  | 46/50 [32:01<02:46, 41.59s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  94%|████████████████████████████▏ | 47/50 [32:43<02:05, 41.87s/it]2048
2048
2048
2048
Evaluating commonsenseqa :  96%|████████████████████████████▊ | 48/50 [33:27<01:24, 42.31s/it]2048
2048
2048
2048
2048
Evaluating commonsenseqa :  98%|█████████████████████████████▍| 49/50 [34:10<00:42, 42.59s/it]2048
2048
2048
Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:53<00:00, 42.79s/it]Evaluating commonsenseqa : 100%|██████████████████████████████| 50/50 [34:53<00:00, 41.87s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.8092} | lm_loss 8.1901 | avg. gen lenth: 302.244
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o17-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 17
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[2023-08-21 16:13:10,187] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o17-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 17
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o17-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                | 0/9741 [00:00<?, ?it/s]  0%|▏                                                     | 26/9741 [00:00<00:37, 258.49it/s]  1%|▎                                                     | 52/9741 [00:00<00:37, 259.09it/s]  1%|▍                                                     | 79/9741 [00:00<00:37, 259.78it/s]  1%|▌                                                    | 106/9741 [00:00<00:37, 260.33it/s]  1%|▋                                                    | 133/9741 [00:00<00:36, 260.29it/s]  2%|▊                                                    | 160/9741 [00:00<00:36, 260.71it/s]  2%|█                                                    | 187/9741 [00:00<00:36, 260.13it/s]  2%|█▏                                                   | 214/9741 [00:00<00:37, 254.64it/s]  2%|█▎                                                   | 240/9741 [00:00<00:37, 256.11it/s]  3%|█▍                                                   | 266/9741 [00:01<00:36, 257.09it/s]  3%|█▌                                                   | 292/9741 [00:01<00:36, 257.88it/s]  3%|█▋                                                   | 318/9741 [00:01<00:36, 258.48it/s]  4%|█▊                                                   | 344/9741 [00:01<00:36, 258.90it/s]  4%|██                                                   | 370/9741 [00:01<00:36, 258.91it/s]  4%|██▏                                                  | 397/9741 [00:01<00:36, 259.33it/s]  4%|██▎                                                  | 423/9741 [00:01<00:35, 259.33it/s]  5%|██▍                                                  | 449/9741 [00:01<00:36, 258.01it/s]  5%|██▌                                                  | 475/9741 [00:01<00:36, 255.95it/s]  5%|██▋                                                  | 501/9741 [00:01<00:35, 256.90it/s]  5%|██▊                                                  | 527/9741 [00:02<00:35, 257.69it/s]  6%|███                                                  | 553/9741 [00:02<00:35, 258.28it/s]  6%|███▏                                                 | 579/9741 [00:02<00:35, 258.60it/s]  6%|███▎                                                 | 605/9741 [00:02<00:35, 258.86it/s]  7%|███▍                                                 | 642/9741 [00:02<00:31, 291.47it/s]  7%|███▋                                                 | 681/9741 [00:02<00:28, 319.96it/s]  7%|███▉                                                 | 721/9741 [00:02<00:26, 341.99it/s]  8%|████▏                                                | 761/9741 [00:02<00:25, 357.15it/s]  8%|████▎                                                | 801/9741 [00:02<00:24, 368.08it/s]  9%|████▌                                                | 841/9741 [00:02<00:23, 375.74it/s]  9%|████▊                                                | 881/9741 [00:03<00:23, 378.99it/s]  9%|█████                                                | 921/9741 [00:03<00:23, 382.84it/s] 10%|█████▏                                               | 961/9741 [00:03<00:22, 385.78it/s] 10%|█████▎                                              | 1001/9741 [00:03<00:22, 387.86it/s] 11%|█████▌                                              | 1041/9741 [00:03<00:22, 389.72it/s] 11%|█████▊                                              | 1081/9741 [00:03<00:22, 390.51it/s] 12%|█████▉                                              | 1121/9741 [00:03<00:22, 388.94it/s] 12%|██████▏                                             | 1161/9741 [00:03<00:22, 389.94it/s] 12%|██████▍                                             | 1201/9741 [00:03<00:21, 390.56it/s] 13%|██████▌                                             | 1241/9741 [00:03<00:21, 390.59it/s] 13%|██████▊                                             | 1281/9741 [00:04<00:21, 391.12it/s] 14%|███████                                             | 1321/9741 [00:04<00:21, 391.15it/s] 14%|███████▎                                            | 1361/9741 [00:04<00:21, 389.23it/s] 14%|███████▍                                            | 1400/9741 [00:04<00:21, 389.27it/s] 15%|███████▋                                            | 1440/9741 [00:04<00:21, 389.65it/s] 15%|███████▉                                            | 1480/9741 [00:04<00:21, 390.43it/s] 16%|████████                                            | 1520/9741 [00:04<00:21, 390.73it/s] 16%|████████▎                                           | 1560/9741 [00:04<00:20, 391.42it/s] 16%|████████▌                                           | 1600/9741 [00:04<00:20, 388.65it/s] 17%|████████▊                                           | 1640/9741 [00:04<00:20, 389.67it/s] 17%|████████▉                                           | 1680/9741 [00:05<00:20, 390.76it/s] 18%|█████████▏                                          | 1720/9741 [00:05<00:20, 390.94it/s] 18%|█████████▍                                          | 1760/9741 [00:05<00:20, 391.20it/s] 18%|█████████▌                                          | 1800/9741 [00:05<00:21, 370.10it/s] 19%|█████████▊                                          | 1839/9741 [00:05<00:21, 375.73it/s] 19%|██████████                                          | 1879/9741 [00:05<00:20, 380.59it/s] 20%|██████████▏                                         | 1918/9741 [00:05<00:20, 382.06it/s] 20%|██████████▍                                         | 1958/9741 [00:05<00:20, 384.61it/s] 21%|██████████▋                                         | 1998/9741 [00:05<00:20, 386.44it/s] 21%|██████████▊                                         | 2037/9741 [00:06<00:19, 385.66it/s] 21%|███████████                                         | 2077/9741 [00:06<00:19, 387.06it/s] 22%|███████████▎                                        | 2116/9741 [00:06<00:19, 387.74it/s] 22%|███████████▌                                        | 2156/9741 [00:06<00:19, 388.54it/s] 23%|███████████▋                                        | 2196/9741 [00:06<00:19, 389.42it/s] 23%|███████████▉                                        | 2235/9741 [00:06<00:19, 389.27it/s] 23%|████████████▏                                       | 2274/9741 [00:06<00:19, 387.30it/s] 24%|████████████▎                                       | 2314/9741 [00:06<00:19, 388.43it/s] 24%|████████████▌                                       | 2354/9741 [00:06<00:18, 389.11it/s] 25%|████████████▊                                       | 2394/9741 [00:06<00:18, 389.78it/s] 25%|████████████▉                                       | 2433/9741 [00:07<00:18, 386.34it/s] 25%|█████████████▏                                      | 2472/9741 [00:07<00:18, 385.21it/s] 26%|█████████████▍                                      | 2512/9741 [00:07<00:18, 386.99it/s] 26%|█████████████▌                                      | 2551/9741 [00:07<00:18, 387.73it/s] 27%|█████████████▊                                      | 2591/9741 [00:07<00:18, 388.66it/s] 27%|██████████████                                      | 2631/9741 [00:07<00:18, 389.20it/s] 27%|██████████████▎                                     | 2671/9741 [00:07<00:18, 389.93it/s] 28%|██████████████▍                                     | 2710/9741 [00:07<00:18, 387.77it/s] 28%|██████████████▋                                     | 2749/9741 [00:07<00:18, 388.17it/s] 29%|██████████████▉                                     | 2788/9741 [00:07<00:17, 388.69it/s] 29%|███████████████                                     | 2828/9741 [00:08<00:17, 389.27it/s] 29%|███████████████▎                                    | 2868/9741 [00:08<00:17, 390.06it/s] 30%|███████████████▌                                    | 2908/9741 [00:08<00:17, 386.14it/s] 30%|███████████████▋                                    | 2947/9741 [00:08<00:17, 384.60it/s] 31%|███████████████▉                                    | 2987/9741 [00:08<00:17, 386.23it/s] 31%|████████████████▏                                   | 3027/9741 [00:08<00:17, 387.78it/s] 31%|████████████████▎                                   | 3066/9741 [00:08<00:17, 387.76it/s] 32%|████████████████▌                                   | 3105/9741 [00:08<00:17, 388.28it/s] 32%|████████████████▊                                   | 3144/9741 [00:08<00:16, 388.71it/s] 33%|████████████████▉                                   | 3183/9741 [00:08<00:16, 387.35it/s] 33%|█████████████████▏                                  | 3223/9741 [00:09<00:16, 388.22it/s] 33%|█████████████████▍                                  | 3263/9741 [00:09<00:16, 388.80it/s] 34%|█████████████████▋                                  | 3302/9741 [00:09<00:16, 388.94it/s] 34%|█████████████████▊                                  | 3342/9741 [00:09<00:16, 389.46it/s] 35%|██████████████████                                  | 3381/9741 [00:09<00:16, 387.19it/s] 35%|██████████████████▎                                 | 3420/9741 [00:09<00:16, 384.48it/s] 36%|██████████████████▍                                 | 3459/9741 [00:09<00:16, 385.64it/s] 36%|██████████████████▋                                 | 3498/9741 [00:09<00:16, 386.87it/s] 36%|██████████████████▉                                 | 3537/9741 [00:09<00:16, 387.34it/s] 37%|███████████████████                                 | 3576/9741 [00:10<00:15, 387.48it/s] 37%|███████████████████▎                                | 3615/9741 [00:10<00:15, 385.55it/s] 38%|███████████████████▌                                | 3655/9741 [00:10<00:15, 387.07it/s] 38%|███████████████████▋                                | 3695/9741 [00:10<00:15, 388.15it/s] 38%|███████████████████▉                                | 3735/9741 [00:10<00:15, 388.72it/s] 39%|████████████████████▏                               | 3775/9741 [00:10<00:15, 389.14it/s] 39%|████████████████████▎                               | 3815/9741 [00:10<00:15, 389.50it/s] 40%|████████████████████▌                               | 3854/9741 [00:10<00:15, 387.36it/s] 40%|████████████████████▊                               | 3893/9741 [00:10<00:15, 388.04it/s] 40%|████████████████████▉                               | 3932/9741 [00:10<00:14, 388.26it/s] 41%|█████████████████████▏                              | 3972/9741 [00:11<00:14, 388.86it/s] 41%|█████████████████████▍                              | 4012/9741 [00:11<00:14, 389.75it/s] 42%|█████████████████████▋                              | 4051/9741 [00:11<00:14, 389.62it/s] 42%|█████████████████████▊                              | 4090/9741 [00:11<00:14, 387.20it/s] 42%|██████████████████████                              | 4129/9741 [00:11<00:14, 387.85it/s] 43%|██████████████████████▏                             | 4168/9741 [00:11<00:14, 388.18it/s] 43%|██████████████████████▍                             | 4207/9741 [00:11<00:14, 388.41it/s] 44%|██████████████████████▋                             | 4246/9741 [00:11<00:14, 388.50it/s] 44%|██████████████████████▊                             | 4285/9741 [00:11<00:14, 386.50it/s] 44%|███████████████████████                             | 4325/9741 [00:11<00:13, 387.69it/s] 45%|███████████████████████▎                            | 4364/9741 [00:12<00:13, 388.32it/s] 45%|███████████████████████▌                            | 4403/9741 [00:12<00:13, 388.48it/s] 46%|███████████████████████▋                            | 4442/9741 [00:12<00:13, 386.16it/s] 46%|███████████████████████▉                            | 4481/9741 [00:12<00:13, 387.20it/s] 46%|████████████████████████▏                           | 4520/9741 [00:12<00:15, 347.08it/s] 47%|████████████████████████▎                           | 4559/9741 [00:12<00:14, 358.28it/s] 47%|████████████████████████▌                           | 4598/9741 [00:12<00:14, 366.92it/s] 48%|████████████████████████▊                           | 4637/9741 [00:12<00:13, 373.48it/s] 48%|████████████████████████▉                           | 4676/9741 [00:12<00:13, 378.16it/s] 48%|█████████████████████████▏                          | 4716/9741 [00:12<00:13, 381.80it/s] 49%|█████████████████████████▍                          | 4755/9741 [00:13<00:17, 287.39it/s] 49%|█████████████████████████▌                          | 4794/9741 [00:13<00:15, 311.60it/s] 50%|█████████████████████████▊                          | 4833/9741 [00:13<00:14, 331.50it/s] 50%|██████████████████████████                          | 4872/9741 [00:13<00:14, 346.34it/s] 50%|██████████████████████████▏                         | 4911/9741 [00:13<00:13, 358.06it/s] 51%|██████████████████████████▍                         | 4950/9741 [00:13<00:13, 365.44it/s] 51%|██████████████████████████▋                         | 4989/9741 [00:13<00:12, 372.43it/s] 52%|██████████████████████████▊                         | 5028/9741 [00:13<00:12, 374.84it/s] 52%|███████████████████████████                         | 5067/9741 [00:13<00:12, 378.93it/s] 52%|███████████████████████████▎                        | 5106/9741 [00:14<00:12, 381.80it/s] 53%|███████████████████████████▍                        | 5145/9741 [00:14<00:11, 383.90it/s] 53%|███████████████████████████▋                        | 5184/9741 [00:14<00:11, 382.74it/s] 54%|███████████████████████████▉                        | 5223/9741 [00:14<00:11, 384.46it/s] 54%|████████████████████████████                        | 5262/9741 [00:14<00:11, 385.84it/s] 54%|████████████████████████████▎                       | 5301/9741 [00:14<00:11, 386.84it/s] 55%|████████████████████████████▌                       | 5340/9741 [00:14<00:11, 386.80it/s] 55%|████████████████████████████▋                       | 5379/9741 [00:14<00:11, 387.68it/s] 56%|████████████████████████████▉                       | 5418/9741 [00:14<00:11, 386.09it/s] 56%|█████████████████████████████▏                      | 5457/9741 [00:15<00:11, 386.55it/s] 56%|█████████████████████████████▎                      | 5497/9741 [00:15<00:10, 389.41it/s] 57%|█████████████████████████████▌                      | 5538/9741 [00:15<00:10, 393.35it/s] 57%|█████████████████████████████▊                      | 5579/9741 [00:15<00:10, 396.33it/s] 58%|██████████████████████████████                      | 5620/9741 [00:15<00:10, 398.27it/s] 58%|██████████████████████████████▏                     | 5660/9741 [00:15<00:10, 397.56it/s] 59%|██████████████████████████████▍                     | 5700/9741 [00:15<00:10, 397.74it/s] 59%|██████████████████████████████▋                     | 5741/9741 [00:15<00:10, 399.18it/s] 59%|██████████████████████████████▊                     | 5782/9741 [00:15<00:09, 400.54it/s] 60%|███████████████████████████████                     | 5823/9741 [00:15<00:09, 401.20it/s] 60%|███████████████████████████████▎                    | 5864/9741 [00:16<00:09, 398.49it/s] 61%|███████████████████████████████▌                    | 5905/9741 [00:16<00:09, 399.60it/s] 61%|███████████████████████████████▋                    | 5946/9741 [00:16<00:09, 400.19it/s] 61%|███████████████████████████████▉                    | 5987/9741 [00:16<00:09, 401.26it/s] 62%|████████████████████████████████▏                   | 6028/9741 [00:16<00:09, 401.43it/s] 62%|████████████████████████████████▍                   | 6069/9741 [00:16<00:09, 401.82it/s] 63%|████████████████████████████████▌                   | 6110/9741 [00:16<00:09, 399.87it/s] 63%|████████████████████████████████▊                   | 6151/9741 [00:16<00:08, 399.98it/s] 64%|█████████████████████████████████                   | 6192/9741 [00:16<00:08, 400.51it/s] 64%|█████████████████████████████████▎                  | 6233/9741 [00:16<00:08, 400.76it/s] 64%|█████████████████████████████████▍                  | 6274/9741 [00:17<00:08, 401.46it/s] 65%|█████████████████████████████████▋                  | 6315/9741 [00:17<00:08, 399.33it/s] 65%|█████████████████████████████████▉                  | 6356/9741 [00:17<00:08, 400.43it/s] 66%|██████████████████████████████████▏                 | 6397/9741 [00:17<00:08, 400.25it/s] 66%|██████████████████████████████████▎                 | 6438/9741 [00:17<00:08, 400.84it/s] 67%|██████████████████████████████████▌                 | 6479/9741 [00:17<00:08, 400.97it/s] 67%|██████████████████████████████████▊                 | 6520/9741 [00:17<00:08, 400.98it/s] 67%|███████████████████████████████████                 | 6561/9741 [00:17<00:07, 398.56it/s] 68%|███████████████████████████████████▏                | 6602/9741 [00:17<00:07, 399.35it/s] 68%|███████████████████████████████████▍                | 6643/9741 [00:17<00:07, 399.75it/s] 69%|███████████████████████████████████▋                | 6684/9741 [00:18<00:07, 400.62it/s] 69%|███████████████████████████████████▉                | 6725/9741 [00:18<00:07, 400.80it/s] 69%|████████████████████████████████████                | 6766/9741 [00:18<00:07, 399.18it/s] 70%|████████████████████████████████████▎               | 6807/9741 [00:18<00:07, 400.38it/s] 70%|████████████████████████████████████▌               | 6848/9741 [00:18<00:07, 400.56it/s] 71%|████████████████████████████████████▊               | 6889/9741 [00:18<00:07, 400.84it/s] 71%|████████████████████████████████████▉               | 6930/9741 [00:18<00:06, 401.63it/s] 72%|█████████████████████████████████████▏              | 6971/9741 [00:18<00:06, 402.00it/s] 72%|█████████████████████████████████████▍              | 7012/9741 [00:18<00:06, 399.99it/s] 72%|█████████████████████████████████████▋              | 7053/9741 [00:18<00:06, 398.67it/s] 73%|█████████████████████████████████████▊              | 7094/9741 [00:19<00:06, 399.40it/s] 73%|██████████████████████████████████████              | 7135/9741 [00:19<00:06, 400.17it/s] 74%|██████████████████████████████████████▎             | 7176/9741 [00:19<00:06, 400.70it/s] 74%|██████████████████████████████████████▌             | 7217/9741 [00:19<00:06, 398.61it/s] 75%|██████████████████████████████████████▋             | 7258/9741 [00:19<00:06, 399.46it/s] 75%|██████████████████████████████████████▉             | 7299/9741 [00:19<00:06, 400.56it/s] 75%|███████████████████████████████████████▏            | 7340/9741 [00:19<00:05, 401.63it/s] 76%|███████████████████████████████████████▍            | 7381/9741 [00:19<00:05, 401.42it/s] 76%|███████████████████████████████████████▌            | 7422/9741 [00:19<00:05, 401.60it/s] 77%|███████████████████████████████████████▊            | 7463/9741 [00:20<00:06, 374.40it/s] 77%|████████████████████████████████████████            | 7504/9741 [00:20<00:05, 382.27it/s] 77%|████████████████████████████████████████▎           | 7545/9741 [00:20<00:05, 387.48it/s] 78%|████████████████████████████████████████▍           | 7586/9741 [00:20<00:05, 391.73it/s] 78%|████████████████████████████████████████▋           | 7627/9741 [00:20<00:05, 395.22it/s] 79%|████████████████████████████████████████▉           | 7667/9741 [00:20<00:05, 395.10it/s] 79%|█████████████████████████████████████████▏          | 7708/9741 [00:20<00:05, 396.84it/s] 80%|█████████████████████████████████████████▎          | 7748/9741 [00:20<00:05, 394.42it/s] 80%|█████████████████████████████████████████▌          | 7789/9741 [00:20<00:04, 396.52it/s] 80%|█████████████████████████████████████████▊          | 7830/9741 [00:20<00:04, 398.01it/s] 81%|██████████████████████████████████████████          | 7871/9741 [00:21<00:04, 398.92it/s] 81%|██████████████████████████████████████████▏         | 7911/9741 [00:21<00:04, 387.94it/s] 82%|██████████████████████████████████████████▍         | 7951/9741 [00:21<00:04, 390.68it/s] 82%|██████████████████████████████████████████▋         | 7992/9741 [00:21<00:04, 394.42it/s] 82%|██████████████████████████████████████████▉         | 8033/9741 [00:21<00:04, 396.14it/s] 83%|███████████████████████████████████████████         | 8074/9741 [00:21<00:04, 397.57it/s] 83%|███████████████████████████████████████████▎        | 8115/9741 [00:21<00:04, 399.54it/s] 84%|███████████████████████████████████████████▌        | 8155/9741 [00:21<00:03, 398.43it/s] 84%|███████████████████████████████████████████▊        | 8196/9741 [00:21<00:03, 399.27it/s] 85%|███████████████████████████████████████████▉        | 8237/9741 [00:21<00:03, 400.27it/s] 85%|████████████████████████████████████████████▏       | 8278/9741 [00:22<00:03, 401.28it/s] 85%|████████████████████████████████████████████▍       | 8319/9741 [00:22<00:03, 401.95it/s] 86%|████████████████████████████████████████████▋       | 8360/9741 [00:22<00:03, 399.57it/s] 86%|████████████████████████████████████████████▊       | 8400/9741 [00:22<00:03, 395.96it/s] 87%|█████████████████████████████████████████████       | 8441/9741 [00:22<00:03, 397.84it/s] 87%|█████████████████████████████████████████████▎      | 8482/9741 [00:22<00:03, 399.04it/s] 87%|█████████████████████████████████████████████▍      | 8523/9741 [00:22<00:03, 399.35it/s] 88%|█████████████████████████████████████████████▋      | 8564/9741 [00:22<00:02, 399.95it/s] 88%|█████████████████████████████████████████████▉      | 8604/9741 [00:22<00:02, 398.06it/s] 89%|██████████████████████████████████████████████▏     | 8645/9741 [00:23<00:02, 399.43it/s] 89%|██████████████████████████████████████████████▎     | 8686/9741 [00:23<00:02, 400.17it/s] 90%|██████████████████████████████████████████████▌     | 8727/9741 [00:23<00:02, 400.14it/s] 90%|██████████████████████████████████████████████▊     | 8768/9741 [00:23<00:02, 400.62it/s] 90%|███████████████████████████████████████████████     | 8809/9741 [00:23<00:02, 398.57it/s] 91%|███████████████████████████████████████████████▏    | 8850/9741 [00:23<00:02, 399.26it/s] 91%|███████████████████████████████████████████████▍    | 8891/9741 [00:23<00:02, 399.77it/s] 92%|███████████████████████████████████████████████▋    | 8932/9741 [00:23<00:02, 400.47it/s] 92%|███████████████████████████████████████████████▉    | 8973/9741 [00:23<00:01, 401.17it/s] 93%|████████████████████████████████████████████████    | 9014/9741 [00:23<00:01, 401.38it/s] 93%|████████████████████████████████████████████████▎   | 9055/9741 [00:24<00:01, 398.70it/s] 93%|████████████████████████████████████████████████▌   | 9095/9741 [00:24<00:01, 395.44it/s] 94%|████████████████████████████████████████████████▊   | 9136/9741 [00:24<00:01, 397.20it/s] 94%|████████████████████████████████████████████████▉   | 9177/9741 [00:24<00:01, 399.05it/s] 95%|█████████████████████████████████████████████████▏  | 9217/9741 [00:24<00:01, 398.99it/s] 95%|█████████████████████████████████████████████████▍  | 9257/9741 [00:24<00:01, 397.60it/s] 95%|█████████████████████████████████████████████████▋  | 9298/9741 [00:24<00:01, 398.97it/s] 96%|█████████████████████████████████████████████████▊  | 9339/9741 [00:24<00:01, 400.19it/s] 96%|██████████████████████████████████████████████████  | 9380/9741 [00:24<00:00, 400.47it/s] 97%|██████████████████████████████████████████████████▎ | 9421/9741 [00:24<00:00, 400.15it/s] 97%|██████████████████████████████████████████████████▌ | 9462/9741 [00:25<00:00, 400.79it/s] 98%|██████████████████████████████████████████████████▋ | 9503/9741 [00:25<00:00, 399.08it/s] 98%|██████████████████████████████████████████████████▉ | 9544/9741 [00:25<00:00, 399.84it/s] 98%|███████████████████████████████████████████████████▏| 9585/9741 [00:25<00:00, 400.54it/s] 99%|███████████████████████████████████████████████████▍| 9626/9741 [00:25<00:00, 401.22it/s] 99%|███████████████████████████████████████████████████▌| 9667/9741 [00:25<00:00, 401.45it/s]100%|███████████████████████████████████████████████████▊| 9708/9741 [00:25<00:00, 401.22it/s]100%|████████████████████████████████████████████████████| 9741/9741 [00:25<00:00, 378.32it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                        | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.50s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:10,  5.09s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.81s/it]Loading checkpoint shards:  33%|██████████▋                     | 1/3 [00:05<00:11,  5.84s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:09<00:04,  4.97s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.57s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.79s/it]Loading checkpoint shards:  67%|█████████████████████▎          | 2/3 [00:11<00:05,  5.80s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.36s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:13<00:00,  4.53s/it]
[2023-08-21 16:14:27,512] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  4.97s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:15<00:00,  5.12s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.37s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.49s/it]
Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.42s/it]Loading checkpoint shards: 100%|████████████████████████████████| 3/3 [00:16<00:00,  5.53s/it]
[2023-08-21 16:14:38,561] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 16:14:38,562] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 16:14:38,562] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 16:14:38,562] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 16:14:38,562] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 16:14:38,562] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fdf67bede80>
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 16:14:38,563] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fdf54353f10>
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-21 16:14:38,564] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 16:14:38,565] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 16:14:38,565] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 16:14:38,565] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 16:14:38,565] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.40445637702941895 seconds
Time to load utils op: 0.5168542861938477 seconds
Loading extension module utils...
Time to load utils op: 0.4028167724609375 seconds
Loading extension module utils...
Time to load utils op: 0.4044957160949707 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                       | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input: There are 50 children at the party. Three-fifths of them are boys. How many of the children are girls?
Output: 20

Input: Gail has some bills in her wallet which amount to $100. She has four $5 bills and three $20 bills, and the rest are $10 bills. How many $10 bills are in her wallet?
Output: 2

Input: A 220-liter barrel has a small leak. It lost 10% of its contents before anyone noticed. How many liters are left in the barrel?
Output: 198

Input: Markese earned 5 fewer dollars than Evan. Together they earned $37. How many dollars did Markese earn? Use E to represent how many dollars Evan earned.
Output: 16

Input: Lou Senior took 3 cookies out of the cookie jar and ate them.  Since he didn't get caught by his wife, he went back the next day and took another 3 cookies out of the jar.  But after eating just one of the cookies, he felt guilty about it and put the other two cookies back.  His son, Louie Junior saw that his Dad was eating cookies.  So, Louie Junior took seven cookies out of the jar and hid them in his bedroom for later.  The next morning, Debra, Lou's wife looked into the cookie jar and reacted by accusing her husband of eating half of the cookies out of the cookie jar.  How many cookies remained in the jar?
Output: 11

Input: John had $200. He gave 3/8 of his money to his mother and 3/10 to his father. How much money did John have left?
Output: 65

Input: Tonya has $150.00 on her credit card.  If she leaves any balance on her card at the end of the month, she is charged 20% interest.  If she makes a $50.00 payment on her card, what will be the new balance?
Output: 120

Input: In her first term, Governor Sandoval gave twice as many commencement addresses as Governor Hawkins. Governor Sloan gave ten more commencement addresses than Governor Sandoval in the same amount of time. If Governor Sandoval gave 12 commencement addresses, how many commencement addresses did the three of them give altogether?
Output: 40

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o17-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|▌                              | 1/50 [00:40<33:08, 40.57s/it]Evaluating commonsenseqa :   4%|█▏                             | 2/50 [01:20<32:07, 40.16s/it]Evaluating commonsenseqa :   6%|█▊                             | 3/50 [02:00<31:22, 40.06s/it]Evaluating commonsenseqa :   8%|██▍                            | 4/50 [02:39<30:34, 39.88s/it]Evaluating commonsenseqa :  10%|███                            | 5/50 [03:19<29:43, 39.63s/it]Evaluating commonsenseqa :  12%|███▋                           | 6/50 [03:42<25:07, 34.25s/it]Evaluating commonsenseqa :  14%|████▎                          | 7/50 [04:22<25:51, 36.08s/it]Evaluating commonsenseqa :  16%|████▉                          | 8/50 [05:02<26:02, 37.20s/it]Evaluating commonsenseqa :  18%|█████▌                         | 9/50 [05:42<25:56, 37.96s/it]Evaluating commonsenseqa :  20%|██████                        | 10/50 [06:21<25:42, 38.56s/it]Evaluating commonsenseqa :  22%|██████▌                       | 11/50 [07:01<25:13, 38.81s/it]Evaluating commonsenseqa :  24%|███████▏                      | 12/50 [07:40<24:41, 39.00s/it]Evaluating commonsenseqa :  26%|███████▊                      | 13/50 [08:20<24:08, 39.15s/it]Evaluating commonsenseqa :  28%|████████▍                     | 14/50 [08:59<23:33, 39.26s/it]Evaluating commonsenseqa :  30%|█████████                     | 15/50 [09:39<23:02, 39.49s/it]Evaluating commonsenseqa :  32%|█████████▌                    | 16/50 [10:19<22:23, 39.51s/it]Evaluating commonsenseqa :  34%|██████████▏                   | 17/50 [10:59<21:46, 39.60s/it]Evaluating commonsenseqa :  36%|██████████▊                   | 18/50 [11:38<21:05, 39.55s/it]Evaluating commonsenseqa :  38%|███████████▍                  | 19/50 [12:18<20:26, 39.57s/it]Evaluating commonsenseqa :  40%|████████████                  | 20/50 [12:58<19:51, 39.72s/it]Evaluating commonsenseqa :  42%|████████████▌                 | 21/50 [13:38<19:12, 39.75s/it]Evaluating commonsenseqa :  44%|█████████████▏                | 22/50 [14:17<18:33, 39.78s/it]Evaluating commonsenseqa :  46%|█████████████▊                | 23/50 [14:57<17:53, 39.75s/it]Evaluating commonsenseqa :  48%|██████████████▍               | 24/50 [15:37<17:15, 39.81s/it]Evaluating commonsenseqa :  50%|███████████████               | 25/50 [16:17<16:37, 39.91s/it]Evaluating commonsenseqa :  52%|███████████████▌              | 26/50 [16:57<15:55, 39.81s/it]Evaluating commonsenseqa :  54%|████████████████▏             | 27/50 [17:37<15:15, 39.80s/it]Evaluating commonsenseqa :  56%|████████████████▊             | 28/50 [18:12<14:04, 38.38s/it]Evaluating commonsenseqa :  58%|█████████████████▍            | 29/50 [18:52<13:37, 38.92s/it]Evaluating commonsenseqa :  60%|██████████████████            | 30/50 [19:32<13:05, 39.29s/it]Evaluating commonsenseqa :  62%|██████████████████▌           | 31/50 [20:12<12:29, 39.46s/it]Evaluating commonsenseqa :  64%|███████████████████▏          | 32/50 [20:51<11:50, 39.50s/it]Evaluating commonsenseqa :  66%|███████████████████▊          | 33/50 [21:31<11:13, 39.65s/it]Evaluating commonsenseqa :  68%|████████████████████▍         | 34/50 [22:11<10:34, 39.64s/it]Evaluating commonsenseqa :  70%|█████████████████████         | 35/50 [22:51<09:56, 39.78s/it]Evaluating commonsenseqa :  72%|█████████████████████▌        | 36/50 [23:31<09:17, 39.82s/it]Evaluating commonsenseqa :  74%|██████████████████████▏       | 37/50 [24:10<08:35, 39.67s/it]Evaluating commonsenseqa :  76%|██████████████████████▊       | 38/50 [24:50<07:55, 39.63s/it]Evaluating commonsenseqa :  78%|███████████████████████▍      | 39/50 [25:30<07:17, 39.74s/it]Evaluating commonsenseqa :  80%|████████████████████████      | 40/50 [26:10<06:38, 39.81s/it]Evaluating commonsenseqa :  82%|████████████████████████▌     | 41/50 [26:50<05:58, 39.85s/it]Evaluating commonsenseqa :  84%|█████████████████████████▏    | 42/50 [27:30<05:18, 39.80s/it]Evaluating commonsenseqa :  86%|█████████████████████████▊    | 43/50 [28:09<04:38, 39.83s/it]Evaluating commonsenseqa :  88%|██████████████████████████▍   | 44/50 [28:49<03:58, 39.72s/it]