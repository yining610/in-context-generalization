PYTHONPATH=/home/ylu130/workspace/in-context-generalization
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-17 17:28:07,211] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  2%|█▊                                                                                               | 181/9741 [00:00<00:05, 1803.37it/s]  4%|███▌                                                                                             | 364/9741 [00:00<00:05, 1814.56it/s]  6%|█████▍                                                                                           | 548/9741 [00:00<00:05, 1824.57it/s]  8%|███████▎                                                                                         | 731/9741 [00:00<00:04, 1825.71it/s]  9%|█████████                                                                                        | 916/9741 [00:00<00:04, 1833.99it/s] 11%|██████████▊                                                                                     | 1103/9741 [00:00<00:04, 1842.88it/s] 13%|████████████▋                                                                                   | 1288/9741 [00:00<00:04, 1840.87it/s] 15%|██████████████▌                                                                                 | 1473/9741 [00:00<00:04, 1839.50it/s] 17%|████████████████▎                                                                               | 1658/9741 [00:00<00:04, 1839.71it/s] 19%|██████████████████▏                                                                             | 1842/9741 [00:01<00:04, 1820.98it/s] 21%|███████████████████▉                                                                            | 2025/9741 [00:01<00:04, 1823.28it/s] 23%|█████████████████████▊                                                                          | 2208/9741 [00:01<00:04, 1824.94it/s] 25%|███████████████████████▌                                                                        | 2392/9741 [00:01<00:04, 1828.97it/s] 26%|█████████████████████████▍                                                                      | 2576/9741 [00:01<00:03, 1831.27it/s] 28%|███████████████████████████▏                                                                    | 2760/9741 [00:01<00:03, 1829.12it/s] 30%|█████████████████████████████                                                                   | 2944/9741 [00:01<00:03, 1830.22it/s] 32%|██████████████████████████████▊                                                                 | 3129/9741 [00:01<00:03, 1833.79it/s] 34%|████████████████████████████████▋                                                               | 3313/9741 [00:01<00:03, 1835.51it/s] 36%|██████████████████████████████████▍                                                             | 3497/9741 [00:01<00:03, 1833.33it/s] 38%|████████████████████████████████████▎                                                           | 3681/9741 [00:02<00:03, 1831.83it/s] 40%|██████████████████████████████████████                                                          | 3866/9741 [00:02<00:03, 1836.11it/s] 42%|███████████████████████████████████████▉                                                        | 4051/9741 [00:02<00:03, 1839.20it/s] 43%|█████████████████████████████████████████▋                                                      | 4235/9741 [00:02<00:02, 1837.76it/s] 46%|████████████████████████████████████████████▎                                                   | 4501/9741 [00:02<00:02, 2081.92it/s] 49%|██████████████████████████████████████████████▋                                                 | 4740/9741 [00:02<00:02, 1789.53it/s] 52%|█████████████████████████████████████████████████▍                                              | 5017/9741 [00:02<00:02, 2043.59it/s] 54%|████████████████████████████████████████████████████▏                                           | 5296/9741 [00:02<00:01, 2245.54it/s] 57%|███████████████████████████████████████████████████████                                         | 5581/9741 [00:02<00:01, 2413.91it/s] 60%|█████████████████████████████████████████████████████████▉                                      | 5874/9741 [00:02<00:01, 2559.91it/s] 63%|████████████████████████████████████████████████████████████▍                                   | 6138/9741 [00:03<00:01, 2582.49it/s] 66%|███████████████████████████████████████████████████████████████▍                                | 6432/9741 [00:03<00:01, 2686.37it/s] 69%|██████████████████████████████████████████████████████████████████▎                             | 6726/9741 [00:03<00:01, 2759.76it/s] 72%|█████████████████████████████████████████████████████████████████████▏                          | 7021/9741 [00:03<00:00, 2815.78it/s] 75%|████████████████████████████████████████████████████████████████████████                        | 7318/9741 [00:03<00:00, 2859.85it/s] 78%|██████████████████████████████████████████████████████████████████████████▉                     | 7606/9741 [00:03<00:00, 2852.52it/s] 81%|█████████████████████████████████████████████████████████████████████████████▊                  | 7893/9741 [00:03<00:00, 2846.30it/s] 84%|████████████████████████████████████████████████████████████████████████████████▋               | 8186/9741 [00:03<00:00, 2870.74it/s] 87%|███████████████████████████████████████████████████████████████████████████████████▌            | 8481/9741 [00:03<00:00, 2891.52it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████▍         | 8774/9741 [00:03<00:00, 2900.22it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████████▎      | 9066/9741 [00:04<00:00, 2905.56it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▎   | 9361/9741 [00:04<00:00, 2916.61it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▏| 9655/9741 [00:04<00:00, 2921.72it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:04<00:00, 2255.77it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.11s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.12s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.33s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.58s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:04,  4.99s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:09<00:04,  4.94s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.35s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.40s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.36s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.54s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.32s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.92s/it]
[2023-08-17 17:29:03,670] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.90s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.05s/it]
[2023-08-17 17:29:15,851] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-17 17:29:15,852] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-17 17:29:15,852] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-17 17:29:15,852] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-17 17:29:15,852] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-17 17:29:15,852] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7ff230c94280>
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-17 17:29:15,853] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7ff230c94e20>
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-17 17:29:15,854] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-17 17:29:15,855] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-17 17:29:15,855] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-17 17:29:15,855] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-17 17:29:15,855] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-17 17:29:15,855] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-17 17:29:15,855] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-17 17:29:15,855] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-17 17:29:15,855] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4071958065032959 seconds
Loading extension module utils...
Time to load utils op: 0.3033766746520996 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.40453624725341797 seconds
Loading extension module utils...
Time to load utils op: 0.40447449684143066 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:55<45:33, 55.78s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:39<39:03, 48.83s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:35<40:48, 52.11s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:31<41:01, 53.51s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:28<40:58, 54.63s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [05:24<40:29, 55.22s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [06:20<39:41, 55.38s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [07:15<38:47, 55.42s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [08:11<38:00, 55.63s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [09:06<36:51, 55.29s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [10:01<35:59, 55.38s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [10:57<35:12, 55.59s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [11:26<29:15, 47.45s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [12:21<29:53, 49.82s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [13:18<30:14, 51.84s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [14:13<29:55, 52.81s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [15:07<29:18, 53.30s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [16:02<28:41, 53.81s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [16:57<27:53, 53.97s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [17:24<22:56, 45.88s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [18:11<22:24, 46.35s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [19:08<23:05, 49.49s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [20:05<23:15, 51.70s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [21:00<22:53, 52.82s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [21:57<22:30, 54.01s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [22:52<21:46, 54.42s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [23:48<20:59, 54.75s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [24:43<20:06, 54.83s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [25:40<19:22, 55.38s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [26:22<17:06, 51.32s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [27:16<16:35, 52.41s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [28:12<15:58, 53.25s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [29:07<15:16, 53.93s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [30:02<14:26, 54.16s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [30:57<13:34, 54.32s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [31:51<12:41, 54.40s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [32:47<11:53, 54.88s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [33:30<10:14, 51.18s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [34:20<09:20, 50.97s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [35:16<08:43, 52.37s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [36:12<08:00, 53.37s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [37:06<07:10, 53.78s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [38:02<06:21, 54.45s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [38:57<05:27, 54.64s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [39:53<04:35, 55.06s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [40:49<03:41, 55.28s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [41:46<02:46, 55.62s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [42:41<01:51, 55.63s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [43:37<00:55, 55.74s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [44:33<00:00, 55.65s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [44:33<00:00, 53.46s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 2.8861} | lm_loss 7.6478 | avg. gen lenth: 315.592
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-17 18:14:21,195] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|▊                                                                                                  | 86/9741 [00:00<00:11, 859.55it/s]  2%|█▊                                                                                                | 174/9741 [00:00<00:11, 866.62it/s]  3%|██▋                                                                                               | 261/9741 [00:00<00:11, 861.59it/s]  4%|███▌                                                                                              | 348/9741 [00:00<00:10, 862.40it/s]  4%|████▍                                                                                             | 435/9741 [00:00<00:10, 860.84it/s]  5%|█████▎                                                                                            | 522/9741 [00:00<00:10, 861.57it/s]  6%|██████▏                                                                                           | 609/9741 [00:00<00:10, 860.20it/s]  7%|███████                                                                                           | 696/9741 [00:00<00:10, 861.12it/s]  8%|███████▉                                                                                          | 783/9741 [00:00<00:10, 845.25it/s]  9%|████████▊                                                                                         | 870/9741 [00:01<00:10, 850.20it/s] 10%|█████████▌                                                                                        | 956/9741 [00:01<00:10, 852.85it/s] 11%|██████████▍                                                                                      | 1044/9741 [00:01<00:10, 858.16it/s] 12%|███████████▎                                                                                     | 1131/9741 [00:01<00:10, 860.26it/s] 13%|████████████▏                                                                                    | 1218/9741 [00:01<00:09, 861.47it/s] 13%|████████████▉                                                                                    | 1305/9741 [00:01<00:09, 863.36it/s] 14%|█████████████▊                                                                                   | 1392/9741 [00:01<00:09, 861.51it/s] 15%|██████████████▋                                                                                  | 1479/9741 [00:01<00:09, 863.50it/s] 16%|███████████████▌                                                                                 | 1566/9741 [00:01<00:09, 861.69it/s] 17%|████████████████▍                                                                                | 1653/9741 [00:01<00:09, 857.14it/s] 18%|█████████████████▎                                                                               | 1739/9741 [00:02<00:09, 857.69it/s] 19%|██████████████████▏                                                                              | 1825/9741 [00:02<00:09, 828.81it/s] 20%|███████████████████                                                                              | 1911/9741 [00:02<00:09, 837.30it/s] 21%|███████████████████▉                                                                             | 1997/9741 [00:02<00:09, 842.65it/s] 21%|████████████████████▋                                                                            | 2082/9741 [00:02<00:09, 844.26it/s] 22%|█████████████████████▌                                                                           | 2169/9741 [00:02<00:08, 849.30it/s] 23%|██████████████████████▍                                                                          | 2255/9741 [00:02<00:08, 850.54it/s] 24%|███████████████████████▎                                                                         | 2344/9741 [00:02<00:08, 861.33it/s] 25%|████████████████████████▌                                                                        | 2467/9741 [00:02<00:07, 969.13it/s] 27%|█████████████████████████▌                                                                      | 2598/9741 [00:02<00:06, 1069.79it/s] 28%|██████████████████████████▊                                                                     | 2720/9741 [00:03<00:06, 1113.78it/s] 29%|████████████████████████████                                                                    | 2851/9741 [00:03<00:05, 1171.92it/s] 31%|█████████████████████████████▍                                                                  | 2982/9741 [00:03<00:05, 1210.52it/s] 32%|██████████████████████████████▋                                                                 | 3113/9741 [00:03<00:05, 1240.22it/s] 33%|███████████████████████████████▉                                                                | 3243/9741 [00:03<00:05, 1257.75it/s] 35%|█████████████████████████████████▏                                                              | 3373/9741 [00:03<00:05, 1269.68it/s] 36%|██████████████████████████████████▌                                                             | 3504/9741 [00:03<00:04, 1280.47it/s] 37%|███████████████████████████████████▊                                                            | 3634/9741 [00:03<00:04, 1285.31it/s] 39%|█████████████████████████████████████                                                           | 3765/9741 [00:03<00:04, 1292.10it/s] 40%|██████████████████████████████████████▍                                                         | 3896/9741 [00:03<00:04, 1294.95it/s] 41%|███████████████████████████████████████▋                                                        | 4028/9741 [00:04<00:04, 1299.66it/s] 43%|████████████████████████████████████████▉                                                       | 4158/9741 [00:04<00:04, 1299.67it/s] 44%|██████████████████████████████████████████▎                                                     | 4288/9741 [00:04<00:04, 1299.57it/s] 45%|███████████████████████████████████████████▌                                                    | 4419/9741 [00:04<00:04, 1300.32it/s] 47%|████████████████████████████████████████████▊                                                   | 4550/9741 [00:04<00:04, 1257.02it/s] 48%|██████████████████████████████████████████████▏                                                 | 4681/9741 [00:04<00:03, 1272.17it/s] 49%|███████████████████████████████████████████████▉                                                 | 4809/9741 [00:04<00:05, 961.60it/s] 51%|████████████████████████████████████████████████▋                                               | 4939/9741 [00:04<00:04, 1040.06it/s] 52%|█████████████████████████████████████████████████▉                                              | 5070/9741 [00:04<00:04, 1107.25it/s] 53%|███████████████████████████████████████████████████▏                                            | 5200/9741 [00:05<00:03, 1158.27it/s] 55%|████████████████████████████████████████████████████▌                                           | 5331/9741 [00:05<00:03, 1199.21it/s] 56%|█████████████████████████████████████████████████████▊                                          | 5461/9741 [00:05<00:03, 1226.32it/s] 57%|███████████████████████████████████████████████████████▏                                        | 5597/9741 [00:05<00:03, 1263.00it/s] 59%|████████████████████████████████████████████████████████▍                                       | 5732/9741 [00:05<00:03, 1288.13it/s] 60%|█████████████████████████████████████████████████████████▊                                      | 5868/9741 [00:05<00:02, 1306.51it/s] 62%|███████████████████████████████████████████████████████████▏                                    | 6004/9741 [00:05<00:02, 1322.01it/s] 63%|████████████████████████████████████████████████████████████▍                                   | 6138/9741 [00:05<00:02, 1318.60it/s] 64%|█████████████████████████████████████████████████████████████▊                                  | 6273/9741 [00:05<00:02, 1327.52it/s] 66%|███████████████████████████████████████████████████████████████▏                                | 6407/9741 [00:05<00:02, 1329.54it/s] 67%|████████████████████████████████████████████████████████████████▍                               | 6541/9741 [00:06<00:02, 1330.66it/s] 69%|█████████████████████████████████████████████████████████████████▊                              | 6677/9741 [00:06<00:02, 1337.41it/s] 70%|███████████████████████████████████████████████████████████████████▏                            | 6812/9741 [00:06<00:02, 1338.86it/s] 71%|████████████████████████████████████████████████████████████████████▍                           | 6947/9741 [00:06<00:02, 1342.04it/s] 73%|█████████████████████████████████████████████████████████████████████▊                          | 7082/9741 [00:06<00:01, 1339.76it/s] 74%|███████████████████████████████████████████████████████████████████████▏                        | 7217/9741 [00:06<00:01, 1339.14it/s] 75%|████████████████████████████████████████████████████████████████████████▍                       | 7352/9741 [00:06<00:01, 1339.60it/s] 77%|█████████████████████████████████████████████████████████████████████████▊                      | 7486/9741 [00:06<00:01, 1290.16it/s] 78%|███████████████████████████████████████████████████████████████████████████                     | 7620/9741 [00:06<00:01, 1303.09it/s] 80%|████████████████████████████████████████████████████████████████████████████▍                   | 7754/9741 [00:06<00:01, 1312.85it/s] 81%|█████████████████████████████████████████████████████████████████████████████▋                  | 7886/9741 [00:07<00:01, 1309.24it/s] 82%|███████████████████████████████████████████████████████████████████████████████                 | 8020/9741 [00:07<00:01, 1317.93it/s] 84%|████████████████████████████████████████████████████████████████████████████████▎               | 8155/9741 [00:07<00:01, 1324.49it/s] 85%|█████████████████████████████████████████████████████████████████████████████████▋              | 8290/9741 [00:07<00:01, 1331.28it/s] 86%|███████████████████████████████████████████████████████████████████████████████████             | 8425/9741 [00:07<00:00, 1334.25it/s] 88%|████████████████████████████████████████████████████████████████████████████████████▎           | 8561/9741 [00:07<00:00, 1339.28it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▋          | 8695/9741 [00:07<00:00, 1337.37it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████         | 8829/9741 [00:07<00:00, 1330.90it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████▎       | 8965/9741 [00:07<00:00, 1336.68it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████████▋      | 9099/9741 [00:08<00:00, 1336.43it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████     | 9235/9741 [00:08<00:00, 1340.59it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▎   | 9370/9741 [00:08<00:00, 1336.86it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████████▋  | 9504/9741 [00:08<00:00, 1333.10it/s] 99%|██████████████████████████████████████████████████████████████████████████████████████████████▉ | 9638/9741 [00:08<00:00, 1320.66it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:08<00:00, 1147.96it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:04<00:09,  4.98s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.29s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.05s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.53s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.54s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.39s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.56s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.83s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
[2023-08-17 18:15:21,925] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.84s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.82s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.01s/it]
[2023-08-17 18:15:31,112] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-17 18:15:31,113] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-17 18:15:31,113] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-17 18:15:31,113] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-17 18:15:31,113] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-17 18:15:31,113] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f7c9ae78e80>
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f7c9ae78dc0>
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-17 18:15:31,114] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-17 18:15:31,115] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-17 18:15:31,115] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4018893241882324 seconds
Loading extension module utils...
Time to load utils op: 0.4044969081878662 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.4043242931365967 seconds
Time to load utils op: 0.30411219596862793 seconds
Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s1-rTrue
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:51<41:47, 51.18s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:41<40:36, 50.76s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:31<39:35, 50.55s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:21<38:27, 50.16s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:12<37:56, 50.59s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [05:02<36:51, 50.25s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:53<36:10, 50.47s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:43<35:15, 50.37s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [07:31<33:48, 49.47s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [08:21<33:06, 49.66s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [09:11<32:20, 49.75s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [10:01<31:37, 49.95s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [10:52<30:58, 50.22s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [11:42<30:13, 50.36s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [12:32<29:10, 50.01s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [13:22<28:18, 49.97s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [14:12<27:35, 50.17s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [15:02<26:42, 50.06s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [15:41<24:09, 46.76s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [16:32<23:57, 47.91s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [17:23<23:38, 48.93s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [18:12<22:51, 48.97s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [19:00<21:50, 48.55s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [19:50<21:18, 49.17s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [20:41<20:41, 49.66s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [21:31<19:52, 49.68s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [22:21<19:08, 49.92s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [23:11<18:14, 49.73s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [24:01<17:28, 49.94s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [24:52<16:42, 50.14s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [25:41<15:50, 50.03s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [26:32<15:04, 50.26s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [27:23<14:15, 50.30s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [28:13<13:27, 50.46s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [29:03<12:34, 50.32s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [29:54<11:46, 50.50s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [30:44<10:54, 50.33s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [31:34<10:00, 50.08s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [32:24<09:11, 50.09s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [33:14<08:21, 50.19s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [33:54<07:03, 47.01s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [34:45<06:25, 48.22s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [35:36<05:43, 49.07s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [36:26<04:55, 49.28s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [37:17<04:08, 49.78s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [37:56<03:06, 46.59s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [38:46<02:23, 47.73s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [39:36<01:36, 48.46s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [40:26<00:48, 48.87s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [41:17<00:00, 49.60s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [41:17<00:00, 49.56s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.2044} | lm_loss 7.6102 | avg. gen lenth: 302.3
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-17 18:56:55,190] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|▋                                                                                                  | 67/9741 [00:00<00:14, 667.07it/s]  1%|█▎                                                                                                | 135/9741 [00:00<00:14, 671.21it/s]  2%|██                                                                                                | 203/9741 [00:00<00:14, 669.20it/s]  3%|██▋                                                                                               | 271/9741 [00:00<00:14, 670.78it/s]  3%|███▍                                                                                              | 339/9741 [00:00<00:14, 670.78it/s]  4%|████                                                                                              | 407/9741 [00:00<00:13, 671.81it/s]  5%|████▊                                                                                             | 475/9741 [00:00<00:13, 669.31it/s]  6%|█████▍                                                                                            | 542/9741 [00:00<00:13, 657.89it/s]  6%|██████▏                                                                                           | 609/9741 [00:00<00:13, 660.85it/s]  7%|██████▊                                                                                           | 676/9741 [00:01<00:13, 659.80it/s]  8%|███████▍                                                                                          | 743/9741 [00:01<00:13, 662.80it/s]  8%|████████▏                                                                                         | 811/9741 [00:01<00:13, 666.67it/s]  9%|████████▊                                                                                         | 879/9741 [00:01<00:13, 668.61it/s] 10%|█████████▌                                                                                        | 946/9741 [00:01<00:13, 666.88it/s] 10%|██████████                                                                                       | 1014/9741 [00:01<00:13, 668.03it/s] 11%|██████████▊                                                                                      | 1082/9741 [00:01<00:12, 669.16it/s] 12%|███████████▍                                                                                     | 1149/9741 [00:01<00:12, 667.88it/s] 12%|████████████                                                                                     | 1216/9741 [00:01<00:12, 663.81it/s] 13%|████████████▊                                                                                    | 1283/9741 [00:01<00:12, 664.81it/s] 14%|█████████████▍                                                                                   | 1350/9741 [00:02<00:12, 664.59it/s] 15%|██████████████                                                                                   | 1417/9741 [00:02<00:12, 666.04it/s] 15%|██████████████▊                                                                                  | 1485/9741 [00:02<00:12, 667.80it/s] 16%|███████████████▍                                                                                 | 1553/9741 [00:02<00:12, 668.68it/s] 17%|████████████████▏                                                                                | 1620/9741 [00:02<00:12, 666.85it/s] 17%|████████████████▊                                                                                | 1688/9741 [00:02<00:12, 668.61it/s] 18%|█████████████████▊                                                                               | 1783/9741 [00:02<00:10, 750.58it/s] 19%|██████████████████▋                                                                              | 1873/9741 [00:02<00:09, 793.44it/s] 20%|███████████████████▋                                                                             | 1975/9741 [00:02<00:09, 859.68it/s] 21%|████████████████████▋                                                                            | 2076/9741 [00:02<00:08, 903.62it/s] 22%|█████████████████████▋                                                                           | 2178/9741 [00:03<00:08, 936.08it/s] 23%|██████████████████████▋                                                                          | 2279/9741 [00:03<00:07, 957.05it/s] 24%|███████████████████████▋                                                                         | 2381/9741 [00:03<00:07, 974.22it/s] 25%|████████████████████████▋                                                                        | 2482/9741 [00:03<00:07, 983.95it/s] 27%|█████████████████████████▋                                                                       | 2584/9741 [00:03<00:07, 992.06it/s] 28%|██████████████████████████▋                                                                      | 2686/9741 [00:03<00:07, 999.33it/s] 29%|███████████████████████████▍                                                                    | 2787/9741 [00:03<00:06, 1000.15it/s] 30%|████████████████████████████▍                                                                   | 2888/9741 [00:03<00:06, 1002.90it/s] 31%|█████████████████████████████▍                                                                  | 2989/9741 [00:03<00:06, 1002.89it/s] 32%|██████████████████████████████▍                                                                 | 3091/9741 [00:03<00:06, 1005.43it/s] 33%|███████████████████████████████▍                                                                | 3192/9741 [00:04<00:06, 1004.54it/s] 34%|████████████████████████████████▍                                                               | 3293/9741 [00:04<00:06, 1005.75it/s] 35%|█████████████████████████████████▍                                                              | 3394/9741 [00:04<00:06, 1003.80it/s] 36%|██████████████████████████████████▍                                                             | 3496/9741 [00:04<00:06, 1005.63it/s] 37%|███████████████████████████████████▊                                                             | 3597/9741 [00:04<00:06, 998.29it/s] 38%|████████████████████████████████████▊                                                            | 3697/9741 [00:04<00:06, 998.74it/s] 39%|█████████████████████████████████████▍                                                          | 3799/9741 [00:04<00:05, 1003.51it/s] 40%|██████████████████████████████████████▍                                                         | 3900/9741 [00:04<00:05, 1003.41it/s] 41%|███████████████████████████████████████▍                                                        | 4002/9741 [00:04<00:05, 1005.90it/s] 42%|████████████████████████████████████████▍                                                       | 4103/9741 [00:04<00:05, 1002.56it/s] 43%|█████████████████████████████████████████▍                                                      | 4204/9741 [00:05<00:05, 1004.44it/s] 44%|██████████████████████████████████████████▍                                                     | 4305/9741 [00:05<00:05, 1004.40it/s] 45%|███████████████████████████████████████████▍                                                    | 4406/9741 [00:05<00:05, 1006.04it/s] 46%|████████████████████████████████████████████▍                                                   | 4508/9741 [00:05<00:05, 1007.73it/s] 47%|█████████████████████████████████████████████▉                                                   | 4609/9741 [00:05<00:05, 937.51it/s] 48%|██████████████████████████████████████████████▉                                                  | 4711/9741 [00:05<00:05, 960.07it/s] 49%|███████████████████████████████████████████████▉                                                 | 4808/9741 [00:05<00:06, 706.47it/s] 50%|████████████████████████████████████████████████▉                                                | 4909/9741 [00:05<00:06, 775.64it/s] 51%|█████████████████████████████████████████████████▉                                               | 5009/9741 [00:06<00:05, 831.21it/s] 52%|██████████████████████████████████████████████████▉                                              | 5110/9741 [00:06<00:05, 878.06it/s] 53%|███████████████████████████████████████████████████▉                                             | 5211/9741 [00:06<00:04, 911.78it/s] 55%|████████████████████████████████████████████████████▉                                            | 5312/9741 [00:06<00:04, 938.11it/s] 56%|█████████████████████████████████████████████████████▉                                           | 5412/9741 [00:06<00:04, 955.13it/s] 57%|██████████████████████████████████████████████████████▉                                          | 5515/9741 [00:06<00:04, 976.01it/s] 58%|███████████████████████████████████████████████████████▉                                         | 5621/9741 [00:06<00:04, 999.82it/s] 59%|████████████████████████████████████████████████████████▍                                       | 5727/9741 [00:06<00:03, 1015.52it/s] 60%|█████████████████████████████████████████████████████████▍                                      | 5834/9741 [00:06<00:03, 1028.86it/s] 61%|██████████████████████████████████████████████████████████▌                                     | 5940/9741 [00:06<00:03, 1035.65it/s] 62%|███████████████████████████████████████████████████████████▌                                    | 6045/9741 [00:07<00:03, 1029.14it/s] 63%|████████████████████████████████████████████████████████████▌                                   | 6149/9741 [00:07<00:03, 1030.37it/s] 64%|█████████████████████████████████████████████████████████████▋                                  | 6255/9741 [00:07<00:03, 1036.99it/s] 65%|██████████████████████████████████████████████████████████████▋                                 | 6359/9741 [00:07<00:03, 1034.09it/s] 66%|███████████████████████████████████████████████████████████████▋                                | 6465/9741 [00:07<00:03, 1040.25it/s] 67%|████████████████████████████████████████████████████████████████▋                               | 6570/9741 [00:07<00:03, 1041.86it/s] 69%|█████████████████████████████████████████████████████████████████▊                              | 6676/9741 [00:07<00:02, 1045.56it/s] 70%|██████████████████████████████████████████████████████████████████▊                             | 6781/9741 [00:07<00:02, 1045.83it/s] 71%|███████████████████████████████████████████████████████████████████▊                            | 6887/9741 [00:07<00:02, 1049.18it/s] 72%|████████████████████████████████████████████████████████████████████▉                           | 6992/9741 [00:07<00:02, 1046.42it/s] 73%|█████████████████████████████████████████████████████████████████████▉                          | 7097/9741 [00:08<00:02, 1046.87it/s] 74%|██████████████████████████████████████████████████████████████████████▉                         | 7203/9741 [00:08<00:02, 1048.09it/s] 75%|████████████████████████████████████████████████████████████████████████                        | 7308/9741 [00:08<00:02, 1046.27it/s] 76%|█████████████████████████████████████████████████████████████████████████                       | 7413/9741 [00:08<00:02, 1045.43it/s] 77%|██████████████████████████████████████████████████████████████████████████▊                      | 7518/9741 [00:08<00:02, 988.72it/s] 78%|███████████████████████████████████████████████████████████████████████████▏                    | 7624/9741 [00:08<00:02, 1006.81it/s] 79%|████████████████████████████████████████████████████████████████████████████▏                   | 7729/9741 [00:08<00:01, 1016.72it/s] 80%|█████████████████████████████████████████████████████████████████████████████▏                  | 7834/9741 [00:08<00:01, 1026.38it/s] 82%|██████████████████████████████████████████████████████████████████████████████▏                 | 7939/9741 [00:08<00:01, 1031.44it/s] 83%|███████████████████████████████████████████████████████████████████████████████▎                | 8045/9741 [00:08<00:01, 1037.84it/s] 84%|████████████████████████████████████████████████████████████████████████████████▎               | 8150/9741 [00:09<00:01, 1039.32it/s] 85%|█████████████████████████████████████████████████████████████████████████████████▎              | 8256/9741 [00:09<00:01, 1043.01it/s] 86%|██████████████████████████████████████████████████████████████████████████████████▍             | 8361/9741 [00:09<00:01, 1041.15it/s] 87%|███████████████████████████████████████████████████████████████████████████████████▍            | 8467/9741 [00:09<00:01, 1045.38it/s] 88%|████████████████████████████████████████████████████████████████████████████████████▍           | 8572/9741 [00:09<00:01, 1046.07it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▌          | 8677/9741 [00:09<00:01, 1041.90it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████▌         | 8782/9741 [00:09<00:00, 1042.24it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████▌        | 8887/9741 [00:09<00:00, 1039.25it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████▌       | 8992/9741 [00:09<00:00, 1040.96it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████████▋      | 9097/9741 [00:09<00:00, 1037.59it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████████▋     | 9201/9741 [00:10<00:00, 1037.69it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████▋    | 9305/9741 [00:10<00:00, 1036.61it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████▋   | 9410/9741 [00:10<00:00, 1039.44it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████████▊  | 9514/9741 [00:10<00:00, 1037.08it/s] 99%|██████████████████████████████████████████████████████████████████████████████████████████████▊ | 9618/9741 [00:10<00:00, 1037.92it/s]100%|███████████████████████████████████████████████████████████████████████████████████████████████▊| 9722/9741 [00:10<00:00, 1034.28it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:10<00:00, 921.24it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.19s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.30s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.48s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:09<00:04,  4.94s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.20s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.24s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.57s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.34s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.52s/it]
[2023-08-17 18:57:56,716] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.65s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.00s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.15s/it]
[2023-08-17 18:58:07,157] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-17 18:58:07,157] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f3f59397e80>
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-17 18:58:07,158] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f3f59397dc0>
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-17 18:58:07,159] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-17 18:58:07,159] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4031670093536377 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.3043091297149658 seconds
Loading extension module utils...
Time to load utils op: 0.3042633533477783 seconds
Loading extension module utils...
Time to load utils op: 0.30425119400024414 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:48<39:25, 48.28s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:36<38:33, 48.20s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:24<37:39, 48.07s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:11<36:29, 47.59s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:58<35:40, 47.57s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:46<34:48, 47.47s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:33<33:59, 47.44s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:21<33:18, 47.59s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [07:09<32:37, 47.73s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [07:57<31:49, 47.73s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [08:44<31:00, 47.71s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [09:32<30:18, 47.86s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [10:19<29:21, 47.60s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [11:07<28:29, 47.49s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [11:54<27:37, 47.36s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [12:41<26:51, 47.38s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [13:30<26:13, 47.69s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [14:17<25:23, 47.62s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [14:58<23:31, 45.52s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [15:46<23:06, 46.22s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [16:33<22:33, 46.68s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [17:21<22:00, 47.15s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [18:09<21:12, 47.14s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [18:56<20:27, 47.20s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [19:43<19:35, 47.00s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [20:29<18:47, 46.98s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [21:17<18:03, 47.12s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [22:04<17:15, 47.05s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [22:40<15:20, 43.85s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [23:27<14:57, 44.87s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [24:14<14:22, 45.41s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [25:02<13:50, 46.15s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [25:50<13:13, 46.65s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [26:37<12:28, 46.78s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [27:11<10:45, 43.04s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [27:59<10:21, 44.37s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [28:47<09:50, 45.44s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [29:34<09:11, 45.96s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [30:21<08:29, 46.35s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [31:08<07:45, 46.53s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [31:56<07:01, 46.86s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [32:43<06:16, 47.01s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [33:31<05:30, 47.27s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [34:18<04:43, 47.28s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [35:06<03:56, 47.37s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [35:53<03:09, 47.39s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [36:41<02:23, 47.67s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [37:29<01:35, 47.58s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [38:17<00:47, 47.75s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [39:04<00:00, 47.61s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [39:04<00:00, 46.89s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 2.9502} | lm_loss 7.6343 | avg. gen lenth: 317.96
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-17 19:37:24,023] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                                  | 55/9741 [00:00<00:17, 548.83it/s]  1%|█                                                                                                 | 111/9741 [00:00<00:17, 552.51it/s]  2%|█▋                                                                                                | 167/9741 [00:00<00:17, 554.27it/s]  2%|██▏                                                                                               | 223/9741 [00:00<00:17, 550.48it/s]  3%|██▊                                                                                               | 279/9741 [00:00<00:17, 551.53it/s]  3%|███▎                                                                                              | 335/9741 [00:00<00:17, 552.41it/s]  4%|███▉                                                                                              | 391/9741 [00:00<00:16, 553.28it/s]  5%|████▍                                                                                             | 447/9741 [00:00<00:16, 550.77it/s]  5%|█████                                                                                             | 503/9741 [00:00<00:17, 542.88it/s]  6%|█████▌                                                                                            | 559/9741 [00:01<00:16, 545.10it/s]  6%|██████▏                                                                                           | 615/9741 [00:01<00:16, 547.07it/s]  7%|██████▋                                                                                           | 670/9741 [00:01<00:16, 545.56it/s]  7%|███████▎                                                                                          | 726/9741 [00:01<00:16, 547.21it/s]  8%|███████▊                                                                                          | 782/9741 [00:01<00:16, 548.73it/s]  9%|████████▍                                                                                         | 838/9741 [00:01<00:16, 549.37it/s]  9%|████████▉                                                                                         | 893/9741 [00:01<00:16, 547.48it/s] 10%|█████████▌                                                                                        | 948/9741 [00:01<00:16, 548.21it/s] 10%|█████████▉                                                                                       | 1003/9741 [00:01<00:16, 545.13it/s] 11%|██████████▌                                                                                      | 1058/9741 [00:01<00:15, 545.98it/s] 12%|███████████▏                                                                                     | 1129/9741 [00:02<00:14, 593.85it/s] 12%|████████████                                                                                     | 1213/9741 [00:02<00:12, 667.23it/s] 13%|████████████▉                                                                                    | 1297/9741 [00:02<00:11, 718.75it/s] 14%|█████████████▋                                                                                   | 1380/9741 [00:02<00:11, 751.68it/s] 15%|██████████████▌                                                                                  | 1464/9741 [00:02<00:10, 777.71it/s] 16%|███████████████▍                                                                                 | 1548/9741 [00:02<00:10, 795.89it/s] 17%|████████████████▏                                                                                | 1631/9741 [00:02<00:10, 805.70it/s] 18%|█████████████████                                                                                | 1715/9741 [00:02<00:09, 815.91it/s] 18%|█████████████████▉                                                                               | 1797/9741 [00:02<00:10, 789.32it/s] 19%|██████████████████▋                                                                              | 1881/9741 [00:02<00:09, 803.03it/s] 20%|███████████████████▌                                                                             | 1965/9741 [00:03<00:09, 812.65it/s] 21%|████████████████████▍                                                                            | 2048/9741 [00:03<00:09, 816.54it/s] 22%|█████████████████████▏                                                                           | 2132/9741 [00:03<00:09, 822.29it/s] 23%|██████████████████████                                                                           | 2216/9741 [00:03<00:09, 826.79it/s] 24%|██████████████████████▉                                                                          | 2299/9741 [00:03<00:08, 826.92it/s] 24%|███████████████████████▋                                                                         | 2383/9741 [00:03<00:08, 830.65it/s] 25%|████████████████████████▌                                                                        | 2468/9741 [00:03<00:08, 833.74it/s] 26%|█████████████████████████▍                                                                       | 2552/9741 [00:03<00:08, 831.04it/s] 27%|██████████████████████████▏                                                                      | 2636/9741 [00:03<00:08, 833.36it/s] 28%|███████████████████████████                                                                      | 2720/9741 [00:03<00:08, 830.30it/s] 29%|███████████████████████████▉                                                                     | 2804/9741 [00:04<00:08, 831.83it/s] 30%|████████████████████████████▊                                                                    | 2888/9741 [00:04<00:08, 833.63it/s] 31%|█████████████████████████████▌                                                                   | 2972/9741 [00:04<00:08, 831.92it/s] 31%|██████████████████████████████▍                                                                  | 3056/9741 [00:04<00:08, 833.01it/s] 32%|███████████████████████████████▎                                                                 | 3140/9741 [00:04<00:07, 834.20it/s] 33%|████████████████████████████████                                                                 | 3224/9741 [00:04<00:07, 832.39it/s] 34%|████████████████████████████████▉                                                                | 3308/9741 [00:04<00:07, 834.24it/s] 35%|█████████████████████████████████▊                                                               | 3392/9741 [00:04<00:07, 831.29it/s] 36%|██████████████████████████████████▌                                                              | 3476/9741 [00:04<00:07, 832.66it/s] 37%|███████████████████████████████████▍                                                             | 3560/9741 [00:04<00:07, 832.93it/s] 37%|████████████████████████████████████▎                                                            | 3644/9741 [00:05<00:07, 830.34it/s] 38%|█████████████████████████████████████                                                            | 3728/9741 [00:05<00:07, 832.54it/s] 39%|█████████████████████████████████████▉                                                           | 3812/9741 [00:05<00:07, 833.20it/s] 40%|██████████████████████████████████████▊                                                          | 3896/9741 [00:05<00:07, 827.36it/s] 41%|███████████████████████████████████████▋                                                         | 3980/9741 [00:05<00:06, 829.09it/s] 42%|████████████████████████████████████████▍                                                        | 4063/9741 [00:05<00:06, 828.08it/s] 43%|█████████████████████████████████████████▎                                                       | 4147/9741 [00:05<00:06, 830.39it/s] 43%|██████████████████████████████████████████▏                                                      | 4231/9741 [00:05<00:06, 825.61it/s] 44%|██████████████████████████████████████████▉                                                      | 4314/9741 [00:05<00:06, 824.87it/s] 45%|███████████████████████████████████████████▊                                                     | 4398/9741 [00:05<00:06, 827.25it/s] 46%|████████████████████████████████████████████▋                                                    | 4482/9741 [00:06<00:06, 828.45it/s] 47%|█████████████████████████████████████████████▍                                                   | 4565/9741 [00:06<00:06, 787.98it/s] 48%|██████████████████████████████████████████████▎                                                  | 4649/9741 [00:06<00:06, 801.57it/s] 49%|███████████████████████████████████████████████                                                  | 4732/9741 [00:06<00:06, 809.72it/s] 49%|███████████████████████████████████████████████▉                                                 | 4814/9741 [00:06<00:08, 609.10it/s] 50%|████████████████████████████████████████████████▊                                                | 4898/9741 [00:06<00:07, 662.67it/s] 51%|█████████████████████████████████████████████████▌                                               | 4981/9741 [00:06<00:06, 704.26it/s] 52%|██████████████████████████████████████████████████▍                                              | 5065/9741 [00:06<00:06, 739.21it/s] 53%|███████████████████████████████████████████████████▎                                             | 5149/9741 [00:07<00:05, 766.78it/s] 54%|████████████████████████████████████████████████████                                             | 5229/9741 [00:07<00:05, 775.60it/s] 55%|████████████████████████████████████████████████████▉                                            | 5313/9741 [00:07<00:05, 793.70it/s] 55%|█████████████████████████████████████████████████████▋                                           | 5397/9741 [00:07<00:05, 806.44it/s] 56%|██████████████████████████████████████████████████████▌                                          | 5481/9741 [00:07<00:05, 813.86it/s] 57%|███████████████████████████████████████████████████████▍                                         | 5569/9741 [00:07<00:05, 831.91it/s] 58%|████████████████████████████████████████████████████████▎                                        | 5655/9741 [00:07<00:04, 839.98it/s] 59%|█████████████████████████████████████████████████████████▏                                       | 5743/9741 [00:07<00:04, 849.65it/s] 60%|██████████████████████████████████████████████████████████                                       | 5831/9741 [00:07<00:04, 856.54it/s] 61%|██████████████████████████████████████████████████████████▉                                      | 5918/9741 [00:07<00:04, 858.01it/s] 62%|███████████████████████████████████████████████████████████▊                                     | 6006/9741 [00:08<00:04, 862.65it/s] 63%|████████████████████████████████████████████████████████████▋                                    | 6093/9741 [00:08<00:04, 862.93it/s] 63%|█████████████████████████████████████████████████████████████▌                                   | 6181/9741 [00:08<00:04, 865.23it/s] 64%|██████████████████████████████████████████████████████████████▍                                  | 6268/9741 [00:08<00:04, 866.47it/s] 65%|███████████████████████████████████████████████████████████████▎                                 | 6355/9741 [00:08<00:03, 856.23it/s] 66%|████████████████████████████████████████████████████████████████▏                                | 6443/9741 [00:08<00:03, 860.98it/s] 67%|█████████████████████████████████████████████████████████████████                                | 6530/9741 [00:08<00:03, 863.42it/s] 68%|█████████████████████████████████████████████████████████████████▉                               | 6617/9741 [00:08<00:03, 862.39it/s] 69%|██████████████████████████████████████████████████████████████████▊                              | 6705/9741 [00:08<00:03, 865.55it/s] 70%|███████████████████████████████████████████████████████████████████▋                             | 6792/9741 [00:08<00:03, 864.49it/s] 71%|████████████████████████████████████████████████████████████████████▌                            | 6879/9741 [00:09<00:03, 865.59it/s] 72%|█████████████████████████████████████████████████████████████████████▍                           | 6967/9741 [00:09<00:03, 867.56it/s] 72%|██████████████████████████████████████████████████████████████████████▏                          | 7054/9741 [00:09<00:03, 865.57it/s] 73%|███████████████████████████████████████████████████████████████████████                          | 7142/9741 [00:09<00:02, 867.99it/s] 74%|███████████████████████████████████████████████████████████████████████▉                         | 7229/9741 [00:09<00:02, 865.41it/s] 75%|████████████████████████████████████████████████████████████████████████▊                        | 7316/9741 [00:09<00:02, 864.80it/s] 76%|█████████████████████████████████████████████████████████████████████████▋                       | 7404/9741 [00:09<00:02, 867.35it/s] 77%|██████████████████████████████████████████████████████████████████████████▌                      | 7491/9741 [00:09<00:02, 781.26it/s] 78%|███████████████████████████████████████████████████████████████████████████▍                     | 7578/9741 [00:09<00:02, 803.92it/s] 79%|████████████████████████████████████████████████████████████████████████████▎                    | 7665/9741 [00:09<00:02, 822.10it/s] 80%|█████████████████████████████████████████████████████████████████████████████▏                   | 7752/9741 [00:10<00:02, 833.67it/s] 80%|██████████████████████████████████████████████████████████████████████████████                   | 7840/9741 [00:10<00:02, 844.87it/s] 81%|██████████████████████████████████████████████████████████████████████████████▉                  | 7927/9741 [00:10<00:02, 850.23it/s] 82%|███████████████████████████████████████████████████████████████████████████████▊                 | 8015/9741 [00:10<00:02, 856.42it/s] 83%|████████████████████████████████████████████████████████████████████████████████▋                | 8102/9741 [00:10<00:01, 860.10it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▌               | 8189/9741 [00:10<00:01, 860.61it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▍              | 8277/9741 [00:10<00:01, 863.54it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▎             | 8364/9741 [00:10<00:01, 861.12it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▏            | 8452/9741 [00:10<00:01, 864.23it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████            | 8539/9741 [00:10<00:01, 865.41it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▉           | 8626/9741 [00:11<00:01, 862.71it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▊          | 8714/9741 [00:11<00:01, 865.28it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▋         | 8801/9741 [00:11<00:01, 862.92it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▌        | 8888/9741 [00:11<00:00, 864.81it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▎       | 8975/9741 [00:11<00:00, 866.28it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▏      | 9062/9741 [00:11<00:00, 863.19it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████      | 9149/9741 [00:11<00:00, 863.55it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████▉     | 9236/9741 [00:11<00:00, 863.85it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▊    | 9323/9741 [00:11<00:00, 861.30it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▋   | 9410/9741 [00:11<00:00, 862.73it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████▌  | 9497/9741 [00:12<00:00, 860.59it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████▍ | 9584/9741 [00:12<00:00, 862.37it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▎| 9671/9741 [00:12<00:00, 859.47it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:12<00:00, 787.37it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.17s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.29s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.34s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.39s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.36s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.20s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.28s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.28s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.73s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.85s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.86s/it]
[2023-08-17 19:38:28,419] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.87s/it]
[2023-08-17 19:38:37,292] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-17 19:38:37,293] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fdc43526310>
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-17 19:38:37,294] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fdc43526e50>
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-17 19:38:37,295] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-17 19:38:37,295] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4011716842651367 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]Time to load utils op: 0.4044814109802246 seconds
############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
So the final answer is 3

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.4043574333190918 seconds
Loading extension module utils...
Time to load utils op: 0.30427122116088867 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:46<38:06, 46.67s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:31<36:36, 45.77s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:17<35:52, 45.79s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:03<35:16, 46.01s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:49<34:30, 46.00s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:34<33:16, 45.38s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:19<32:35, 45.47s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:06<32:04, 45.82s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [06:51<31:14, 45.73s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [07:37<30:31, 45.79s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [08:23<29:42, 45.70s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [09:09<29:02, 45.85s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [09:55<28:22, 46.02s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [10:41<27:30, 45.84s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [11:27<26:45, 45.86s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [12:12<25:48, 45.55s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [12:57<25:05, 45.62s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [13:42<24:10, 45.34s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [14:28<23:29, 45.46s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [15:14<22:51, 45.72s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [16:00<22:09, 45.83s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [16:46<21:19, 45.69s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [17:32<20:40, 45.93s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [18:17<19:46, 45.62s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [19:02<18:59, 45.58s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [19:42<17:31, 43.80s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [20:28<17:03, 44.50s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [21:15<16:31, 45.06s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [22:00<15:47, 45.11s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [22:45<15:01, 45.08s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [23:29<14:08, 44.67s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [24:14<13:30, 45.05s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [25:01<12:51, 45.37s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [25:47<12:09, 45.56s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [26:33<11:28, 45.87s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [27:18<10:39, 45.70s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [28:05<09:56, 45.86s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [28:36<08:18, 41.54s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [29:23<07:53, 43.04s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [30:08<07:17, 43.79s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [30:54<06:39, 44.40s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [31:40<05:59, 44.93s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [32:27<05:17, 45.35s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [33:12<04:32, 45.46s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [33:58<03:48, 45.64s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [34:30<02:45, 41.31s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [35:15<02:07, 42.58s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [36:01<01:27, 43.50s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [36:46<00:44, 44.14s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [37:32<00:00, 44.58s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [37:32<00:00, 45.05s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.5879} | lm_loss 7.6256 | avg. gen lenth: 291.996
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 5
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-17 20:16:17,637] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 5
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  0%|▍                                                                                                  | 40/9741 [00:00<00:24, 393.12it/s]  1%|▊                                                                                                  | 80/9741 [00:00<00:24, 394.57it/s]  1%|█▏                                                                                                | 120/9741 [00:00<00:24, 395.60it/s]  2%|█▌                                                                                                | 160/9741 [00:00<00:24, 396.10it/s]  2%|██                                                                                                | 200/9741 [00:00<00:24, 393.06it/s]  2%|██▍                                                                                               | 240/9741 [00:00<00:24, 393.87it/s]  3%|██▊                                                                                               | 280/9741 [00:00<00:23, 394.84it/s]  3%|███▏                                                                                              | 320/9741 [00:00<00:23, 395.00it/s]  4%|███▌                                                                                              | 360/9741 [00:00<00:24, 390.46it/s]  4%|████                                                                                              | 400/9741 [00:01<00:23, 392.04it/s]  5%|████▍                                                                                             | 440/9741 [00:01<00:23, 389.58it/s]  5%|████▊                                                                                             | 480/9741 [00:01<00:23, 391.17it/s]  5%|█████▏                                                                                            | 520/9741 [00:01<00:23, 392.30it/s]  6%|█████▋                                                                                            | 560/9741 [00:01<00:23, 392.78it/s]  6%|██████                                                                                            | 600/9741 [00:01<00:23, 393.24it/s]  7%|██████▍                                                                                           | 640/9741 [00:01<00:23, 393.32it/s]  7%|██████▊                                                                                           | 680/9741 [00:01<00:23, 391.95it/s]  7%|███████▏                                                                                          | 720/9741 [00:01<00:22, 392.58it/s]  8%|███████▋                                                                                          | 760/9741 [00:01<00:23, 389.09it/s]  8%|████████▏                                                                                         | 814/9741 [00:02<00:20, 433.13it/s]  9%|████████▊                                                                                         | 874/9741 [00:02<00:18, 481.15it/s] 10%|█████████▍                                                                                        | 933/9741 [00:02<00:17, 511.46it/s] 10%|█████████▉                                                                                        | 993/9741 [00:02<00:16, 536.25it/s] 11%|██████████▍                                                                                      | 1053/9741 [00:02<00:15, 554.03it/s] 11%|███████████                                                                                      | 1112/9741 [00:02<00:15, 563.50it/s] 12%|███████████▋                                                                                     | 1172/9741 [00:02<00:14, 572.56it/s] 13%|████████████▎                                                                                    | 1232/9741 [00:02<00:14, 577.99it/s] 13%|████████████▊                                                                                    | 1292/9741 [00:02<00:14, 582.87it/s] 14%|█████████████▍                                                                                   | 1351/9741 [00:02<00:14, 583.60it/s] 14%|██████████████                                                                                   | 1411/9741 [00:03<00:14, 586.43it/s] 15%|██████████████▋                                                                                  | 1471/9741 [00:03<00:14, 588.17it/s] 16%|███████████████▏                                                                                 | 1531/9741 [00:03<00:13, 589.62it/s] 16%|███████████████▊                                                                                 | 1590/9741 [00:03<00:13, 587.93it/s] 17%|████████████████▍                                                                                | 1650/9741 [00:03<00:13, 589.27it/s] 18%|█████████████████                                                                                | 1710/9741 [00:03<00:13, 589.93it/s] 18%|█████████████████▋                                                                               | 1770/9741 [00:03<00:13, 590.87it/s] 19%|██████████████████▏                                                                              | 1830/9741 [00:03<00:14, 559.36it/s] 19%|██████████████████▊                                                                              | 1890/9741 [00:03<00:13, 568.50it/s] 20%|███████████████████▍                                                                             | 1950/9741 [00:03<00:13, 575.22it/s] 21%|████████████████████                                                                             | 2010/9741 [00:04<00:13, 580.43it/s] 21%|████████████████████▌                                                                            | 2069/9741 [00:04<00:13, 581.01it/s] 22%|█████████████████████▏                                                                           | 2128/9741 [00:04<00:13, 583.41it/s] 22%|█████████████████████▊                                                                           | 2188/9741 [00:04<00:12, 586.29it/s] 23%|██████████████████████▍                                                                          | 2247/9741 [00:04<00:12, 584.82it/s] 24%|██████████████████████▉                                                                          | 2306/9741 [00:04<00:12, 586.30it/s] 24%|███████████████████████▌                                                                         | 2366/9741 [00:04<00:12, 587.89it/s] 25%|████████████████████████▏                                                                        | 2426/9741 [00:04<00:12, 589.73it/s] 26%|████████████████████████▋                                                                        | 2485/9741 [00:04<00:12, 587.64it/s] 26%|█████████████████████████▎                                                                       | 2545/9741 [00:04<00:12, 588.75it/s] 27%|█████████████████████████▉                                                                       | 2605/9741 [00:05<00:12, 590.67it/s] 27%|██████████████████████████▌                                                                      | 2665/9741 [00:05<00:11, 590.59it/s] 28%|███████████████████████████▏                                                                     | 2725/9741 [00:05<00:11, 587.48it/s] 29%|███████████████████████████▋                                                                     | 2785/9741 [00:05<00:11, 588.39it/s] 29%|████████████████████████████▎                                                                    | 2845/9741 [00:05<00:11, 589.19it/s] 30%|████████████████████████████▉                                                                    | 2905/9741 [00:05<00:11, 590.47it/s] 30%|█████████████████████████████▌                                                                   | 2965/9741 [00:05<00:11, 587.40it/s] 31%|██████████████████████████████                                                                   | 3024/9741 [00:05<00:11, 586.43it/s] 32%|██████████████████████████████▋                                                                  | 3083/9741 [00:05<00:11, 587.20it/s] 32%|███████████████████████████████▎                                                                 | 3142/9741 [00:06<00:11, 587.45it/s] 33%|███████████████████████████████▉                                                                 | 3201/9741 [00:06<00:11, 585.80it/s] 33%|████████████████████████████████▍                                                                | 3261/9741 [00:06<00:11, 587.15it/s] 34%|█████████████████████████████████                                                                | 3320/9741 [00:06<00:10, 587.48it/s] 35%|█████████████████████████████████▋                                                               | 3379/9741 [00:06<00:10, 582.25it/s] 35%|██████████████████████████████████▏                                                              | 3439/9741 [00:06<00:10, 584.59it/s] 36%|██████████████████████████████████▊                                                              | 3498/9741 [00:06<00:10, 585.84it/s] 37%|███████████████████████████████████▍                                                             | 3557/9741 [00:06<00:10, 586.35it/s] 37%|████████████████████████████████████                                                             | 3616/9741 [00:06<00:10, 584.27it/s] 38%|████████████████████████████████████▌                                                            | 3676/9741 [00:06<00:10, 586.24it/s] 38%|█████████████████████████████████████▏                                                           | 3736/9741 [00:07<00:10, 587.95it/s] 39%|█████████████████████████████████████▊                                                           | 3795/9741 [00:07<00:10, 583.75it/s] 40%|██████████████████████████████████████▍                                                          | 3854/9741 [00:07<00:10, 582.80it/s] 40%|██████████████████████████████████████▉                                                          | 3914/9741 [00:07<00:09, 585.20it/s] 41%|███████████████████████████████████████▌                                                         | 3973/9741 [00:07<00:09, 586.61it/s] 41%|████████████████████████████████████████▏                                                        | 4033/9741 [00:07<00:09, 588.01it/s] 42%|████████████████████████████████████████▋                                                        | 4092/9741 [00:07<00:09, 586.02it/s] 43%|█████████████████████████████████████████▎                                                       | 4152/9741 [00:07<00:09, 587.28it/s] 43%|█████████████████████████████████████████▉                                                       | 4212/9741 [00:07<00:09, 588.08it/s] 44%|██████████████████████████████████████████▌                                                      | 4271/9741 [00:07<00:09, 588.60it/s] 44%|███████████████████████████████████████████                                                      | 4330/9741 [00:08<00:09, 586.54it/s] 45%|███████████████████████████████████████████▋                                                     | 4390/9741 [00:08<00:09, 587.66it/s] 46%|████████████████████████████████████████████▎                                                    | 4449/9741 [00:08<00:09, 587.44it/s] 46%|████████████████████████████████████████████▉                                                    | 4508/9741 [00:08<00:08, 587.85it/s] 47%|█████████████████████████████████████████████▍                                                   | 4567/9741 [00:08<00:09, 546.57it/s] 47%|██████████████████████████████████████████████                                                   | 4626/9741 [00:08<00:09, 558.86it/s] 48%|██████████████████████████████████████████████▋                                                  | 4685/9741 [00:08<00:08, 567.75it/s] 49%|███████████████████████████████████████████████▏                                                 | 4743/9741 [00:08<00:11, 444.65it/s] 49%|███████████████████████████████████████████████▊                                                 | 4802/9741 [00:08<00:10, 479.19it/s] 50%|████████████████████████████████████████████████▍                                                | 4861/9741 [00:09<00:09, 506.82it/s] 51%|████████████████████████████████████████████████▉                                                | 4920/9741 [00:09<00:09, 528.13it/s] 51%|█████████████████████████████████████████████████▌                                               | 4978/9741 [00:09<00:08, 542.43it/s] 52%|██████████████████████████████████████████████████▏                                              | 5037/9741 [00:09<00:08, 555.37it/s] 52%|██████████████████████████████████████████████████▋                                              | 5096/9741 [00:09<00:08, 563.18it/s] 53%|███████████████████████████████████████████████████▎                                             | 5155/9741 [00:09<00:08, 569.55it/s] 54%|███████████████████████████████████████████████████▉                                             | 5213/9741 [00:09<00:07, 571.95it/s] 54%|████████████████████████████████████████████████████▍                                            | 5271/9741 [00:09<00:07, 570.84it/s] 55%|█████████████████████████████████████████████████████                                            | 5330/9741 [00:09<00:07, 576.15it/s] 55%|█████████████████████████████████████████████████████▋                                           | 5389/9741 [00:09<00:07, 580.14it/s] 56%|██████████████████████████████████████████████████████▎                                          | 5448/9741 [00:10<00:07, 578.64it/s] 57%|██████████████████████████████████████████████████████▊                                          | 5508/9741 [00:10<00:07, 584.55it/s] 57%|███████████████████████████████████████████████████████▍                                         | 5570/9741 [00:10<00:07, 593.06it/s] 58%|████████████████████████████████████████████████████████                                         | 5630/9741 [00:10<00:06, 594.76it/s] 58%|████████████████████████████████████████████████████████▋                                        | 5692/9741 [00:10<00:06, 599.86it/s] 59%|█████████████████████████████████████████████████████████▎                                       | 5754/9741 [00:10<00:06, 603.35it/s] 60%|█████████████████████████████████████████████████████████▉                                       | 5816/9741 [00:10<00:06, 605.42it/s] 60%|██████████████████████████████████████████████████████████▌                                      | 5877/9741 [00:10<00:06, 604.17it/s] 61%|███████████████████████████████████████████████████████████▏                                     | 5939/9741 [00:10<00:06, 606.39it/s] 62%|███████████████████████████████████████████████████████████▋                                     | 6000/9741 [00:10<00:06, 607.21it/s] 62%|████████████████████████████████████████████████████████████▎                                    | 6062/9741 [00:11<00:06, 609.44it/s] 63%|████████████████████████████████████████████████████████████▉                                    | 6123/9741 [00:11<00:05, 607.09it/s] 63%|█████████████████████████████████████████████████████████████▌                                   | 6185/9741 [00:11<00:05, 608.19it/s] 64%|██████████████████████████████████████████████████████████████▏                                  | 6246/9741 [00:11<00:05, 608.29it/s] 65%|██████████████████████████████████████████████████████████████▊                                  | 6307/9741 [00:11<00:05, 605.50it/s] 65%|███████████████████████████████████████████████████████████████▍                                 | 6368/9741 [00:11<00:05, 606.62it/s] 66%|████████████████████████████████████████████████████████████████                                 | 6429/9741 [00:11<00:05, 607.53it/s] 67%|████████████████████████████████████████████████████████████████▋                                | 6490/9741 [00:11<00:05, 608.08it/s] 67%|█████████████████████████████████████████████████████████████████▏                               | 6551/9741 [00:11<00:05, 605.61it/s] 68%|█████████████████████████████████████████████████████████████████▊                               | 6613/9741 [00:11<00:05, 607.02it/s] 69%|██████████████████████████████████████████████████████████████████▍                              | 6675/9741 [00:12<00:05, 608.12it/s] 69%|███████████████████████████████████████████████████████████████████                              | 6736/9741 [00:12<00:04, 608.52it/s] 70%|███████████████████████████████████████████████████████████████████▋                             | 6797/9741 [00:12<00:04, 606.17it/s] 70%|████████████████████████████████████████████████████████████████████▎                            | 6858/9741 [00:12<00:04, 600.67it/s] 71%|████████████████████████████████████████████████████████████████████▉                            | 6919/9741 [00:12<00:04, 601.96it/s] 72%|█████████████████████████████████████████████████████████████████████▌                           | 6981/9741 [00:12<00:04, 604.73it/s] 72%|██████████████████████████████████████████████████████████████████████                           | 7042/9741 [00:12<00:04, 603.96it/s] 73%|██████████████████████████████████████████████████████████████████████▋                          | 7104/9741 [00:12<00:04, 606.68it/s] 74%|███████████████████████████████████████████████████████████████████████▎                         | 7166/9741 [00:12<00:04, 608.41it/s] 74%|███████████████████████████████████████████████████████████████████████▉                         | 7227/9741 [00:13<00:04, 606.17it/s] 75%|████████████████████████████████████████████████████████████████████████▌                        | 7289/9741 [00:13<00:04, 608.11it/s] 75%|█████████████████████████████████████████████████████████████████████████▏                       | 7351/9741 [00:13<00:03, 608.90it/s] 76%|█████████████████████████████████████████████████████████████████████████▊                       | 7413/9741 [00:13<00:03, 609.95it/s] 77%|██████████████████████████████████████████████████████████████████████████▍                      | 7474/9741 [00:13<00:04, 566.08it/s] 77%|███████████████████████████████████████████████████████████████████████████                      | 7535/9741 [00:13<00:03, 577.23it/s] 78%|███████████████████████████████████████████████████████████████████████████▋                     | 7596/9741 [00:13<00:03, 585.80it/s] 79%|████████████████████████████████████████████████████████████████████████████▏                    | 7657/9741 [00:13<00:03, 592.75it/s] 79%|████████████████████████████████████████████████████████████████████████████▊                    | 7718/9741 [00:13<00:03, 595.58it/s] 80%|█████████████████████████████████████████████████████████████████████████████▍                   | 7780/9741 [00:13<00:03, 600.44it/s] 81%|██████████████████████████████████████████████████████████████████████████████                   | 7842/9741 [00:14<00:03, 604.01it/s] 81%|██████████████████████████████████████████████████████████████████████████████▋                  | 7903/9741 [00:14<00:03, 603.26it/s] 82%|███████████████████████████████████████████████████████████████████████████████▎                 | 7965/9741 [00:14<00:02, 605.58it/s] 82%|███████████████████████████████████████████████████████████████████████████████▉                 | 8026/9741 [00:14<00:02, 606.57it/s] 83%|████████████████████████████████████████████████████████████████████████████████▌                | 8088/9741 [00:14<00:02, 607.78it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▏               | 8149/9741 [00:14<00:02, 606.47it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▊               | 8211/9741 [00:14<00:02, 607.99it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▍              | 8273/9741 [00:14<00:02, 608.95it/s] 86%|██████████████████████████████████████████████████████████████████████████████████▉              | 8334/9741 [00:14<00:02, 609.08it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▌             | 8395/9741 [00:14<00:02, 605.92it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▏            | 8457/9741 [00:15<00:02, 607.67it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▊            | 8519/9741 [00:15<00:02, 608.58it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▍           | 8580/9741 [00:15<00:01, 605.93it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████           | 8641/9741 [00:15<00:01, 603.95it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▋          | 8703/9741 [00:15<00:01, 605.82it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▎         | 8764/9741 [00:15<00:01, 606.62it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████▉         | 8825/9741 [00:15<00:01, 604.37it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▍        | 8886/9741 [00:15<00:01, 605.69it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████        | 8948/9741 [00:15<00:01, 607.34it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▋       | 9009/9741 [00:15<00:01, 607.76it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▎      | 9070/9741 [00:16<00:01, 605.60it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████████▉      | 9131/9741 [00:16<00:01, 606.75it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▌     | 9192/9741 [00:16<00:00, 607.66it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▏    | 9254/9741 [00:16<00:00, 608.46it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▊    | 9315/9741 [00:16<00:00, 606.47it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▎   | 9376/9741 [00:16<00:00, 607.49it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▉   | 9437/9741 [00:16<00:00, 607.51it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▌  | 9498/9741 [00:16<00:00, 604.71it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████▏ | 9559/9741 [00:16<00:00, 606.24it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▊ | 9620/9741 [00:16<00:00, 607.32it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▍| 9681/9741 [00:17<00:00, 607.05it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:17<00:00, 567.44it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.12s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.22s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.12s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.02s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.13s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.22s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.52s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.49s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.64s/it]
[2023-08-17 20:17:26,278] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.55s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.73s/it]
[2023-08-17 20:17:34,816] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-17 20:17:34,817] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-17 20:17:34,817] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-17 20:17:34,817] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-17 20:17:34,817] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-17 20:17:34,817] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f0fefb8be80>
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-17 20:17:34,818] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f0fefb8bdc0>
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-17 20:17:34,819] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-17 20:17:34,820] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-17 20:17:34,820] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-17 20:17:34,820] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-17 20:17:34,820] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.48756885528564453 seconds
Time to load utils op: 0.4052577018737793 seconds
Loading extension module utils...
Time to load utils op: 0.504791259765625 seconds
Loading extension module utils...
Time to load utils op: 0.5044891834259033 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
So the final answer is 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
So the final answer is 27

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s1-rTrue
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:43<35:27, 43.42s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:25<34:17, 42.87s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:08<33:32, 42.81s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [02:51<32:42, 42.66s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:34<32:04, 42.76s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:17<31:30, 42.96s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:00<30:44, 42.90s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [05:33<27:47, 39.71s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [06:15<27:44, 40.59s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [06:58<27:30, 41.27s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [07:40<27:05, 41.69s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [08:23<26:35, 41.99s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [09:06<25:58, 42.13s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [09:48<25:24, 42.34s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [10:31<24:49, 42.56s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [11:14<24:07, 42.58s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [11:57<23:27, 42.65s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [12:40<22:49, 42.80s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [13:23<22:06, 42.79s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [14:06<21:22, 42.76s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [14:48<20:39, 42.72s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [15:24<18:54, 40.52s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [16:06<18:33, 41.24s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [16:49<18:02, 41.62s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [17:32<17:30, 42.02s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [18:14<16:51, 42.16s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [18:57<16:12, 42.30s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [19:40<15:35, 42.53s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [20:23<14:55, 42.63s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [21:06<14:15, 42.75s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [21:49<13:33, 42.81s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [22:32<12:51, 42.84s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [23:14<12:06, 42.72s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [23:56<11:17, 42.36s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [24:39<10:40, 42.70s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [25:22<09:58, 42.73s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [26:05<09:17, 42.87s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [26:48<08:32, 42.73s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [27:29<07:44, 42.25s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [28:13<07:06, 42.67s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [28:56<06:25, 42.85s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [29:39<05:42, 42.85s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [30:22<05:00, 42.86s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [31:05<04:18, 43.01s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [31:49<03:36, 43.21s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [32:31<02:52, 43.08s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [33:14<02:08, 42.96s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [33:57<01:26, 43.11s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [34:40<00:42, 42.99s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [35:23<00:00, 42.85s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [35:23<00:00, 42.46s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.8088} | lm_loss 7.5566 | avg. gen lenth: 310.264
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 6
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-17 20:53:05,873] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 6
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o6-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                                  | 32/9741 [00:00<00:31, 313.15it/s]  1%|▋                                                                                                  | 64/9741 [00:00<00:30, 314.57it/s]  1%|▉                                                                                                  | 96/9741 [00:00<00:30, 315.47it/s]  1%|█▎                                                                                                | 128/9741 [00:00<00:30, 315.96it/s]  2%|█▌                                                                                                | 160/9741 [00:00<00:30, 316.46it/s]  2%|█▉                                                                                                | 192/9741 [00:00<00:30, 316.07it/s]  2%|██▎                                                                                               | 224/9741 [00:00<00:30, 313.79it/s]  3%|██▌                                                                                               | 256/9741 [00:00<00:30, 314.74it/s]  3%|██▉                                                                                               | 288/9741 [00:00<00:29, 315.66it/s]  3%|███▏                                                                                              | 320/9741 [00:01<00:29, 316.19it/s]  4%|███▌                                                                                              | 352/9741 [00:01<00:29, 316.32it/s]  4%|███▊                                                                                              | 384/9741 [00:01<00:30, 311.42it/s]  4%|████▏                                                                                             | 416/9741 [00:01<00:29, 312.57it/s]  5%|████▌                                                                                             | 448/9741 [00:01<00:29, 311.41it/s]  5%|████▊                                                                                             | 480/9741 [00:01<00:29, 312.81it/s]  5%|█████▏                                                                                            | 512/9741 [00:01<00:29, 313.67it/s]  6%|█████▍                                                                                            | 544/9741 [00:01<00:29, 314.54it/s]  6%|█████▊                                                                                            | 576/9741 [00:01<00:29, 309.72it/s]  6%|██████                                                                                            | 608/9741 [00:01<00:29, 310.68it/s]  7%|██████▍                                                                                           | 640/9741 [00:02<00:29, 311.40it/s]  7%|██████▊                                                                                           | 672/9741 [00:02<00:29, 309.93it/s]  7%|███████                                                                                           | 704/9741 [00:02<00:29, 307.30it/s]  8%|███████▍                                                                                          | 736/9741 [00:02<00:29, 308.72it/s]  8%|███████▋                                                                                          | 768/9741 [00:02<00:28, 310.52it/s]  8%|████████                                                                                          | 800/9741 [00:02<00:28, 312.15it/s]  9%|████████▎                                                                                         | 832/9741 [00:02<00:28, 311.85it/s]  9%|████████▋                                                                                         | 864/9741 [00:02<00:28, 313.21it/s]  9%|█████████                                                                                         | 896/9741 [00:02<00:28, 310.71it/s] 10%|█████████▎                                                                                        | 928/9741 [00:02<00:28, 312.00it/s] 10%|█████████▋                                                                                        | 960/9741 [00:03<00:28, 313.41it/s] 10%|█████████▉                                                                                        | 992/9741 [00:03<00:27, 314.37it/s] 11%|██████████▏                                                                                      | 1024/9741 [00:03<00:27, 314.85it/s] 11%|██████████▌                                                                                      | 1056/9741 [00:03<00:27, 315.08it/s] 11%|██████████▊                                                                                      | 1088/9741 [00:03<00:27, 315.32it/s] 11%|███████████▏                                                                                     | 1120/9741 [00:03<00:27, 313.57it/s] 12%|███████████▍                                                                                     | 1152/9741 [00:03<00:27, 314.41it/s] 12%|███████████▊                                                                                     | 1184/9741 [00:03<00:27, 314.66it/s] 12%|████████████                                                                                     | 1216/9741 [00:03<00:27, 314.55it/s] 13%|████████████▍                                                                                    | 1248/9741 [00:03<00:26, 314.86it/s] 13%|████████████▋                                                                                    | 1280/9741 [00:04<00:26, 314.74it/s] 13%|█████████████                                                                                    | 1312/9741 [00:04<00:26, 315.19it/s] 14%|█████████████▍                                                                                   | 1344/9741 [00:04<00:26, 312.83it/s] 14%|█████████████▋                                                                                   | 1376/9741 [00:04<00:26, 311.52it/s] 14%|██████████████                                                                                   | 1408/9741 [00:04<00:26, 312.06it/s] 15%|██████████████▎                                                                                  | 1442/9741 [00:04<00:26, 318.56it/s] 15%|██████████████▊                                                                                  | 1490/9741 [00:04<00:22, 365.16it/s] 16%|███████████████▎                                                                                 | 1538/9741 [00:04<00:20, 397.35it/s] 16%|███████████████▊                                                                                 | 1583/9741 [00:04<00:19, 410.54it/s] 17%|████████████████▏                                                                                | 1631/9741 [00:05<00:18, 430.00it/s] 17%|████████████████▋                                                                                | 1679/9741 [00:05<00:18, 444.07it/s] 18%|█████████████████▏                                                                               | 1727/9741 [00:05<00:17, 453.37it/s] 18%|█████████████████▋                                                                               | 1774/9741 [00:05<00:17, 458.02it/s] 19%|██████████████████                                                                               | 1820/9741 [00:05<00:18, 420.24it/s] 19%|██████████████████▌                                                                              | 1868/9741 [00:05<00:18, 435.57it/s] 20%|███████████████████                                                                              | 1916/9741 [00:05<00:17, 447.02it/s] 20%|███████████████████▌                                                                             | 1964/9741 [00:05<00:17, 455.30it/s] 21%|████████████████████                                                                             | 2012/9741 [00:05<00:16, 461.93it/s] 21%|████████████████████▌                                                                            | 2059/9741 [00:05<00:16, 462.92it/s] 22%|████████████████████▉                                                                            | 2107/9741 [00:06<00:16, 465.67it/s] 22%|█████████████████████▍                                                                           | 2155/9741 [00:06<00:16, 468.30it/s] 23%|█████████████████████▉                                                                           | 2203/9741 [00:06<00:16, 470.18it/s] 23%|██████████████████████▍                                                                          | 2251/9741 [00:06<00:15, 468.65it/s] 24%|██████████████████████▉                                                                          | 2299/9741 [00:06<00:15, 471.09it/s] 24%|███████████████████████▎                                                                         | 2347/9741 [00:06<00:15, 472.25it/s] 25%|███████████████████████▊                                                                         | 2395/9741 [00:06<00:15, 473.71it/s] 25%|████████████████████████▎                                                                        | 2443/9741 [00:06<00:15, 474.85it/s] 26%|████████████████████████▊                                                                        | 2491/9741 [00:06<00:15, 472.21it/s] 26%|█████████████████████████▎                                                                       | 2539/9741 [00:06<00:15, 473.35it/s] 27%|█████████████████████████▊                                                                       | 2587/9741 [00:07<00:15, 473.99it/s] 27%|██████████████████████████▏                                                                      | 2635/9741 [00:07<00:14, 474.61it/s] 28%|██████████████████████████▋                                                                      | 2683/9741 [00:07<00:14, 474.91it/s] 28%|███████████████████████████▏                                                                     | 2731/9741 [00:07<00:14, 472.17it/s] 29%|███████████████████████████▋                                                                     | 2779/9741 [00:07<00:14, 472.87it/s] 29%|████████████████████████████▏                                                                    | 2827/9741 [00:07<00:14, 473.35it/s] 30%|████████████████████████████▋                                                                    | 2875/9741 [00:07<00:14, 474.17it/s] 30%|█████████████████████████████                                                                    | 2923/9741 [00:07<00:14, 474.57it/s] 30%|█████████████████████████████▌                                                                   | 2971/9741 [00:07<00:14, 471.82it/s] 31%|██████████████████████████████                                                                   | 3019/9741 [00:07<00:14, 473.32it/s] 31%|██████████████████████████████▌                                                                  | 3067/9741 [00:08<00:14, 472.90it/s] 32%|███████████████████████████████                                                                  | 3115/9741 [00:08<00:13, 473.90it/s] 32%|███████████████████████████████▍                                                                 | 3163/9741 [00:08<00:13, 471.51it/s] 33%|███████████████████████████████▉                                                                 | 3211/9741 [00:08<00:13, 472.90it/s] 33%|████████████████████████████████▍                                                                | 3259/9741 [00:08<00:13, 473.92it/s] 34%|████████████████████████████████▉                                                                | 3307/9741 [00:08<00:13, 474.02it/s] 34%|█████████████████████████████████▍                                                               | 3355/9741 [00:08<00:13, 474.12it/s] 35%|█████████████████████████████████▉                                                               | 3403/9741 [00:08<00:13, 471.41it/s] 35%|██████████████████████████████████▎                                                              | 3451/9741 [00:08<00:13, 471.50it/s] 36%|██████████████████████████████████▊                                                              | 3499/9741 [00:08<00:13, 472.31it/s] 36%|███████████████████████████████████▎                                                             | 3547/9741 [00:09<00:13, 472.66it/s] 37%|███████████████████████████████████▊                                                             | 3595/9741 [00:09<00:13, 472.74it/s] 37%|████████████████████████████████████▎                                                            | 3643/9741 [00:09<00:12, 470.49it/s] 38%|████████████████████████████████████▊                                                            | 3691/9741 [00:09<00:12, 471.39it/s] 38%|█████████████████████████████████████▏                                                           | 3739/9741 [00:09<00:12, 472.91it/s] 39%|█████████████████████████████████████▋                                                           | 3787/9741 [00:09<00:12, 473.36it/s] 39%|██████████████████████████████████████▏                                                          | 3835/9741 [00:09<00:12, 471.00it/s] 40%|██████████████████████████████████████▋                                                          | 3883/9741 [00:09<00:12, 472.13it/s] 40%|███████████████████████████████████████▏                                                         | 3931/9741 [00:09<00:12, 472.31it/s] 41%|███████████████████████████████████████▌                                                         | 3979/9741 [00:10<00:12, 471.96it/s] 41%|████████████████████████████████████████                                                         | 4027/9741 [00:10<00:12, 472.57it/s] 42%|████████████████████████████████████████▌                                                        | 4075/9741 [00:10<00:12, 470.24it/s] 42%|█████████████████████████████████████████                                                        | 4123/9741 [00:10<00:11, 471.51it/s] 43%|█████████████████████████████████████████▌                                                       | 4171/9741 [00:10<00:11, 472.51it/s] 43%|██████████████████████████████████████████                                                       | 4219/9741 [00:10<00:11, 473.24it/s] 44%|██████████████████████████████████████████▍                                                      | 4267/9741 [00:10<00:11, 473.96it/s] 44%|██████████████████████████████████████████▉                                                      | 4315/9741 [00:10<00:11, 472.03it/s] 45%|███████████████████████████████████████████▍                                                     | 4363/9741 [00:10<00:11, 472.31it/s] 45%|███████████████████████████████████████████▉                                                     | 4411/9741 [00:10<00:11, 472.92it/s] 46%|████████████████████████████████████████████▍                                                    | 4459/9741 [00:11<00:11, 472.61it/s] 46%|████████████████████████████████████████████▉                                                    | 4507/9741 [00:11<00:11, 472.13it/s] 47%|█████████████████████████████████████████████▎                                                   | 4555/9741 [00:11<00:11, 438.02it/s] 47%|█████████████████████████████████████████████▊                                                   | 4603/9741 [00:11<00:11, 448.58it/s] 48%|██████████████████████████████████████████████▎                                                  | 4651/9741 [00:11<00:11, 456.37it/s] 48%|██████████████████████████████████████████████▊                                                  | 4699/9741 [00:11<00:10, 462.09it/s] 49%|███████████████████████████████████████████████▎                                                 | 4746/9741 [00:11<00:15, 330.37it/s] 49%|███████████████████████████████████████████████▋                                                 | 4794/9741 [00:11<00:13, 363.55it/s] 50%|████████████████████████████████████████████████▏                                                | 4842/9741 [00:11<00:12, 390.65it/s] 50%|████████████████████████████████████████████████▋                                                | 4889/9741 [00:12<00:11, 410.28it/s] 51%|█████████████████████████████████████████████████▏                                               | 4937/9741 [00:12<00:11, 427.14it/s] 51%|█████████████████████████████████████████████████▋                                               | 4984/9741 [00:12<00:10, 437.96it/s] 52%|██████████████████████████████████████████████████                                               | 5032/9741 [00:12<00:10, 448.49it/s] 52%|██████████████████████████████████████████████████▌                                              | 5080/9741 [00:12<00:10, 455.74it/s] 53%|███████████████████████████████████████████████████                                              | 5128/9741 [00:12<00:09, 461.37it/s] 53%|███████████████████████████████████████████████████▌                                             | 5175/9741 [00:12<00:09, 460.25it/s] 54%|████████████████████████████████████████████████████                                             | 5223/9741 [00:12<00:09, 463.59it/s] 54%|████████████████████████████████████████████████████▍                                            | 5271/9741 [00:12<00:09, 465.67it/s] 55%|████████████████████████████████████████████████████▉                                            | 5319/9741 [00:13<00:09, 467.97it/s] 55%|█████████████████████████████████████████████████████▍                                           | 5367/9741 [00:13<00:09, 469.48it/s] 56%|█████████████████████████████████████████████████████▉                                           | 5415/9741 [00:13<00:09, 467.53it/s] 56%|██████████████████████████████████████████████████████▍                                          | 5462/9741 [00:13<00:09, 463.95it/s] 57%|██████████████████████████████████████████████████████▉                                          | 5511/9741 [00:13<00:08, 470.79it/s] 57%|███████████████████████████████████████████████████████▍                                         | 5561/9741 [00:13<00:08, 477.15it/s] 58%|███████████████████████████████████████████████████████▊                                         | 5610/9741 [00:13<00:08, 479.80it/s] 58%|████████████████████████████████████████████████████████▎                                        | 5659/9741 [00:13<00:08, 480.14it/s] 59%|████████████████████████████████████████████████████████▊                                        | 5708/9741 [00:13<00:08, 478.29it/s] 59%|█████████████████████████████████████████████████████████▎                                       | 5757/9741 [00:13<00:08, 481.39it/s] 60%|█████████████████████████████████████████████████████████▊                                       | 5806/9741 [00:14<00:08, 483.62it/s] 60%|██████████████████████████████████████████████████████████▎                                      | 5855/9741 [00:14<00:08, 482.07it/s] 61%|██████████████████████████████████████████████████████████▊                                      | 5904/9741 [00:14<00:07, 483.72it/s] 61%|███████████████████████████████████████████████████████████▎                                     | 5954/9741 [00:14<00:07, 485.81it/s] 62%|███████████████████████████████████████████████████████████▊                                     | 6003/9741 [00:14<00:07, 482.82it/s] 62%|████████████████████████████████████████████████████████████▎                                    | 6052/9741 [00:14<00:07, 484.93it/s] 63%|████████████████████████████████████████████████████████████▊                                    | 6101/9741 [00:14<00:07, 481.82it/s] 63%|█████████████████████████████████████████████████████████████▏                                   | 6150/9741 [00:14<00:07, 483.60it/s] 64%|█████████████████████████████████████████████████████████████▋                                   | 6199/9741 [00:14<00:07, 485.12it/s] 64%|██████████████████████████████████████████████████████████████▏                                  | 6248/9741 [00:14<00:07, 485.33it/s] 65%|██████████████████████████████████████████████████████████████▋                                  | 6297/9741 [00:15<00:07, 481.00it/s] 65%|███████████████████████████████████████████████████████████████▏                                 | 6346/9741 [00:15<00:07, 480.37it/s] 66%|███████████████████████████████████████████████████████████████▋                                 | 6395/9741 [00:15<00:06, 482.79it/s] 66%|████████████████████████████████████████████████████████████████▏                                | 6444/9741 [00:15<00:06, 484.68it/s] 67%|████████████████████████████████████████████████████████████████▋                                | 6493/9741 [00:15<00:06, 485.94it/s] 67%|█████████████████████████████████████████████████████████████████▏                               | 6542/9741 [00:15<00:06, 483.14it/s] 68%|█████████████████████████████████████████████████████████████████▋                               | 6591/9741 [00:15<00:06, 484.32it/s] 68%|██████████████████████████████████████████████████████████████████                               | 6640/9741 [00:15<00:06, 483.66it/s] 69%|██████████████████████████████████████████████████████████████████▌                              | 6689/9741 [00:15<00:06, 485.46it/s] 69%|███████████████████████████████████████████████████████████████████                              | 6738/9741 [00:15<00:06, 486.76it/s] 70%|███████████████████████████████████████████████████████████████████▌                             | 6787/9741 [00:16<00:06, 485.31it/s] 70%|████████████████████████████████████████████████████████████████████                             | 6836/9741 [00:16<00:05, 486.48it/s] 71%|████████████████████████████████████████████████████████████████████▌                            | 6885/9741 [00:16<00:05, 487.10it/s] 71%|█████████████████████████████████████████████████████████████████████                            | 6934/9741 [00:16<00:05, 487.15it/s] 72%|█████████████████████████████████████████████████████████████████████▌                           | 6984/9741 [00:16<00:05, 488.32it/s] 72%|██████████████████████████████████████████████████████████████████████                           | 7033/9741 [00:16<00:05, 485.40it/s] 73%|██████████████████████████████████████████████████████████████████████▌                          | 7082/9741 [00:16<00:05, 486.52it/s] 73%|███████████████████████████████████████████████████████████████████████                          | 7132/9741 [00:16<00:05, 487.61it/s] 74%|███████████████████████████████████████████████████████████████████████▌                         | 7181/9741 [00:16<00:05, 487.97it/s] 74%|███████████████████████████████████████████████████████████████████████▉                         | 7230/9741 [00:16<00:05, 485.00it/s] 75%|████████████████████████████████████████████████████████████████████████▍                        | 7279/9741 [00:17<00:05, 485.68it/s] 75%|████████████████████████████████████████████████████████████████████████▉                        | 7328/9741 [00:17<00:04, 486.59it/s] 76%|█████████████████████████████████████████████████████████████████████████▍                       | 7377/9741 [00:17<00:04, 487.25it/s] 76%|█████████████████████████████████████████████████████████████████████████▉                       | 7426/9741 [00:17<00:04, 487.23it/s] 77%|██████████████████████████████████████████████████████████████████████████▍                      | 7475/9741 [00:17<00:05, 441.53it/s] 77%|██████████████████████████████████████████████████████████████████████████▉                      | 7524/9741 [00:17<00:04, 454.66it/s] 78%|███████████████████████████████████████████████████████████████████████████▍                     | 7573/9741 [00:17<00:04, 464.59it/s] 78%|███████████████████████████████████████████████████████████████████████████▉                     | 7622/9741 [00:17<00:04, 470.86it/s] 79%|████████████████████████████████████████████████████████████████████████████▍                    | 7670/9741 [00:17<00:04, 472.75it/s] 79%|████████████████████████████████████████████████████████████████████████████▊                    | 7719/9741 [00:17<00:04, 477.41it/s] 80%|█████████████████████████████████████████████████████████████████████████████▎                   | 7768/9741 [00:18<00:04, 480.89it/s] 80%|█████████████████████████████████████████████████████████████████████████████▊                   | 7817/9741 [00:18<00:03, 482.87it/s] 81%|██████████████████████████████████████████████████████████████████████████████▎                  | 7866/9741 [00:18<00:03, 484.18it/s] 81%|██████████████████████████████████████████████████████████████████████████████▊                  | 7915/9741 [00:18<00:03, 483.21it/s] 82%|███████████████████████████████████████████████████████████████████████████████▎                 | 7964/9741 [00:18<00:03, 484.30it/s] 82%|███████████████████████████████████████████████████████████████████████████████▊                 | 8013/9741 [00:18<00:03, 484.31it/s] 83%|████████████████████████████████████████████████████████████████████████████████▎                | 8062/9741 [00:18<00:03, 485.73it/s] 83%|████████████████████████████████████████████████████████████████████████████████▊                | 8111/9741 [00:18<00:03, 486.56it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▎               | 8160/9741 [00:18<00:03, 484.10it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▋               | 8209/9741 [00:19<00:03, 485.47it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▏              | 8258/9741 [00:19<00:03, 485.97it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▋              | 8307/9741 [00:19<00:02, 485.83it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▏             | 8356/9741 [00:19<00:02, 479.10it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▋             | 8405/9741 [00:19<00:02, 482.00it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▏            | 8454/9741 [00:19<00:02, 484.26it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▋            | 8503/9741 [00:19<00:02, 485.87it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▏           | 8552/9741 [00:19<00:02, 486.16it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▋           | 8601/9741 [00:19<00:02, 483.74it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▏          | 8650/9741 [00:19<00:02, 485.00it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▌          | 8699/9741 [00:20<00:02, 483.72it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████          | 8748/9741 [00:20<00:02, 484.75it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▌         | 8797/9741 [00:20<00:01, 485.40it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████         | 8846/9741 [00:20<00:01, 483.66it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▌        | 8895/9741 [00:20<00:01, 485.20it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████        | 8944/9741 [00:20<00:01, 486.46it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▌       | 8993/9741 [00:20<00:01, 486.78it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████       | 9042/9741 [00:20<00:01, 484.20it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▌      | 9091/9741 [00:20<00:01, 483.20it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████      | 9140/9741 [00:20<00:01, 483.28it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▌     | 9189/9741 [00:21<00:01, 485.16it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████▉     | 9238/9741 [00:21<00:01, 485.83it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▍    | 9287/9741 [00:21<00:00, 483.88it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▉    | 9336/9741 [00:21<00:00, 485.01it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▍   | 9385/9741 [00:21<00:00, 486.07it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▉   | 9434/9741 [00:21<00:00, 485.92it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████▍  | 9483/9741 [00:21<00:00, 483.11it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▉  | 9532/9741 [00:21<00:00, 482.23it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████▍ | 9581/9741 [00:21<00:00, 483.07it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▉ | 9630/9741 [00:21<00:00, 483.98it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▍| 9679/9741 [00:22<00:00, 484.87it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████▊| 9728/9741 [00:22<00:00, 482.67it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:22<00:00, 439.36it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.37s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.39s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:07<00:14,  7.41s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.24s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.26s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:12<00:06,  6.25s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:13<00:06,  6.44s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.64s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.24s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.25s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.43s/it]
[2023-08-17 20:54:22,535] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.60s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.92s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.58s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]
[2023-08-17 20:54:32,416] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-17 20:54:32,418] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-17 20:54:32,418] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-17 20:54:32,418] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-17 20:54:32,419] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-17 20:54:32,419] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-17 20:54:32,419] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-17 20:54:32,419] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-17 20:54:32,419] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-17 20:54:32,419] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-17 20:54:32,419] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-17 20:54:32,419] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fa6a00a6310>
[2023-08-17 20:54:32,419] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-17 20:54:32,420] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fa6a00a6e50>
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-17 20:54:32,421] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-17 20:54:32,422] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-17 20:54:32,422] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-17 20:54:32,422] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-17 20:54:32,422] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-17 20:54:32,422] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-17 20:54:32,422] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-17 20:54:32,422] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5003006458282471 seconds
Loading extension module utils...
Time to load utils op: 0.5030815601348877 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
So the final answer is 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
So the final answer is 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: Max finished history in 20 * 2 = <<20*2=40>>40 minutes.
Finishing geography took the most time, which is 40 * 3 = <<40*3=120>>120 minutes.
In total, for all three subjects, Max needed 20 + 40 + 120 = <<20+40+120=180>>180 minutes.
So the final answer is 180

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o6-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.5046665668487549 seconds
Loading extension module utils...
Time to load utils op: 0.5049796104431152 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:42<34:55, 42.76s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:24<33:50, 42.31s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:06<32:55, 42.03s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [02:42<30:27, 39.74s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:24<30:29, 40.67s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:07<30:13, 41.22s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [04:49<29:42, 41.46s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [05:31<29:07, 41.60s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [06:13<28:35, 41.84s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [06:55<27:55, 41.90s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [07:37<27:13, 41.89s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [08:19<26:36, 42.00s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [09:01<25:53, 41.99s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [09:43<25:10, 41.96s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [10:25<24:29, 42.00s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [11:07<23:49, 42.03s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [11:49<23:06, 42.01s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [12:31<22:22, 41.94s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [13:13<21:39, 41.91s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [13:55<20:57, 41.93s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [14:37<20:18, 42.01s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [15:19<19:36, 42.01s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [16:01<18:56, 42.10s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [16:43<18:10, 41.95s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [17:25<17:31, 42.05s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [18:07<16:49, 42.06s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [18:49<16:06, 42.03s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [19:31<15:25, 42.09s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [20:14<14:44, 42.12s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [20:56<14:03, 42.19s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [21:38<13:22, 42.25s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [22:14<12:06, 40.37s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [22:56<11:33, 40.79s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [23:38<10:59, 41.25s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [24:21<10:23, 41.59s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [25:03<09:44, 41.73s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [25:45<09:04, 41.86s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [26:27<08:22, 41.91s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [27:09<07:40, 41.88s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [27:51<06:58, 41.85s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [28:32<06:16, 41.84s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [29:15<05:35, 42.00s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [29:57<04:54, 42.13s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [30:39<04:12, 42.06s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [31:21<03:29, 42.00s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [31:51<02:33, 38.32s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [32:33<01:58, 39.52s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [33:15<01:20, 40.31s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [33:58<00:40, 40.93s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [34:40<00:00, 41.43s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [34:40<00:00, 41.61s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.222} | lm_loss 7.5733 | avg. gen lenth: 323.92
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 7
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-17 21:29:40,059] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 7
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o7-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                                  | 28/9741 [00:00<00:35, 276.72it/s]  1%|▌                                                                                                  | 56/9741 [00:00<00:34, 277.06it/s]  1%|▊                                                                                                  | 84/9741 [00:00<00:34, 277.58it/s]  1%|█▏                                                                                                | 112/9741 [00:00<00:34, 277.85it/s]  1%|█▍                                                                                                | 140/9741 [00:00<00:34, 278.21it/s]  2%|█▋                                                                                                | 168/9741 [00:00<00:34, 277.74it/s]  2%|█▉                                                                                                | 196/9741 [00:00<00:34, 273.28it/s]  2%|██▎                                                                                               | 224/9741 [00:00<00:35, 271.82it/s]  3%|██▌                                                                                               | 252/9741 [00:00<00:34, 273.33it/s]  3%|██▊                                                                                               | 280/9741 [00:01<00:34, 274.67it/s]  3%|███                                                                                               | 308/9741 [00:01<00:34, 275.60it/s]  3%|███▍                                                                                              | 336/9741 [00:01<00:34, 275.74it/s]  4%|███▋                                                                                              | 364/9741 [00:01<00:33, 276.16it/s]  4%|███▉                                                                                              | 392/9741 [00:01<00:33, 276.77it/s]  4%|████▏                                                                                             | 420/9741 [00:01<00:33, 276.65it/s]  5%|████▌                                                                                             | 448/9741 [00:01<00:33, 274.46it/s]  5%|████▊                                                                                             | 476/9741 [00:01<00:34, 272.08it/s]  5%|█████                                                                                             | 505/9741 [00:01<00:33, 276.02it/s]  6%|█████▌                                                                                            | 548/9741 [00:01<00:28, 319.64it/s]  6%|█████▉                                                                                            | 591/9741 [00:02<00:26, 349.95it/s]  7%|██████▍                                                                                           | 634/9741 [00:02<00:24, 371.11it/s]  7%|██████▊                                                                                           | 676/9741 [00:02<00:23, 383.14it/s]  7%|███████▏                                                                                          | 719/9741 [00:02<00:22, 394.44it/s]  8%|███████▋                                                                                          | 762/9741 [00:02<00:22, 402.27it/s]  8%|████████                                                                                          | 805/9741 [00:02<00:21, 407.98it/s]  9%|████████▌                                                                                         | 848/9741 [00:02<00:21, 411.72it/s]  9%|████████▉                                                                                         | 890/9741 [00:02<00:21, 410.95it/s] 10%|█████████▍                                                                                        | 933/9741 [00:02<00:21, 413.76it/s] 10%|█████████▊                                                                                        | 976/9741 [00:02<00:21, 415.86it/s] 10%|██████████▏                                                                                      | 1018/9741 [00:03<00:20, 415.95it/s] 11%|██████████▌                                                                                      | 1061/9741 [00:03<00:20, 417.02it/s] 11%|██████████▉                                                                                      | 1104/9741 [00:03<00:20, 418.18it/s] 12%|███████████▍                                                                                     | 1146/9741 [00:03<00:20, 415.83it/s] 12%|███████████▊                                                                                     | 1189/9741 [00:03<00:20, 417.14it/s] 13%|████████████▎                                                                                    | 1231/9741 [00:03<00:20, 417.50it/s] 13%|████████████▋                                                                                    | 1274/9741 [00:03<00:20, 418.29it/s] 14%|█████████████                                                                                    | 1316/9741 [00:03<00:20, 418.71it/s] 14%|█████████████▌                                                                                   | 1358/9741 [00:03<00:20, 416.33it/s] 14%|█████████████▉                                                                                   | 1400/9741 [00:03<00:19, 417.09it/s] 15%|██████████████▎                                                                                  | 1442/9741 [00:04<00:19, 417.55it/s] 15%|██████████████▊                                                                                  | 1485/9741 [00:04<00:19, 418.21it/s] 16%|███████████████▏                                                                                 | 1527/9741 [00:04<00:19, 417.79it/s] 16%|███████████████▌                                                                                 | 1569/9741 [00:04<00:19, 410.50it/s] 17%|████████████████                                                                                 | 1611/9741 [00:04<00:19, 412.39it/s] 17%|████████████████▍                                                                                | 1653/9741 [00:04<00:19, 414.50it/s] 17%|████████████████▉                                                                                | 1695/9741 [00:04<00:19, 415.46it/s] 18%|█████████████████▎                                                                               | 1737/9741 [00:04<00:19, 416.55it/s] 18%|█████████████████▋                                                                               | 1779/9741 [00:04<00:19, 417.26it/s] 19%|██████████████████▏                                                                              | 1821/9741 [00:05<00:20, 386.83it/s] 19%|██████████████████▌                                                                              | 1863/9741 [00:05<00:19, 395.65it/s] 20%|██████████████████▉                                                                              | 1905/9741 [00:05<00:19, 401.73it/s] 20%|███████████████████▍                                                                             | 1947/9741 [00:05<00:19, 406.12it/s] 20%|███████████████████▊                                                                             | 1989/9741 [00:05<00:18, 409.78it/s] 21%|████████████████████▏                                                                            | 2031/9741 [00:05<00:18, 409.10it/s] 21%|████████████████████▋                                                                            | 2073/9741 [00:05<00:18, 407.54it/s] 22%|█████████████████████                                                                            | 2115/9741 [00:05<00:18, 409.94it/s] 22%|█████████████████████▍                                                                           | 2157/9741 [00:05<00:18, 411.89it/s] 23%|█████████████████████▉                                                                           | 2199/9741 [00:05<00:18, 414.07it/s] 23%|██████████████████████▎                                                                          | 2241/9741 [00:06<00:18, 415.46it/s] 23%|██████████████████████▋                                                                          | 2283/9741 [00:06<00:18, 412.56it/s] 24%|███████████████████████▏                                                                         | 2325/9741 [00:06<00:17, 414.12it/s] 24%|███████████████████████▌                                                                         | 2367/9741 [00:06<00:17, 415.56it/s] 25%|███████████████████████▉                                                                         | 2409/9741 [00:06<00:17, 416.44it/s] 25%|████████████████████████▍                                                                        | 2451/9741 [00:06<00:17, 416.91it/s] 26%|████████████████████████▊                                                                        | 2493/9741 [00:06<00:17, 414.63it/s] 26%|█████████████████████████▏                                                                       | 2535/9741 [00:06<00:17, 415.33it/s] 26%|█████████████████████████▋                                                                       | 2577/9741 [00:06<00:17, 416.20it/s] 27%|██████████████████████████                                                                       | 2619/9741 [00:06<00:17, 416.61it/s] 27%|██████████████████████████▍                                                                      | 2661/9741 [00:07<00:16, 416.69it/s] 28%|██████████████████████████▉                                                                      | 2703/9741 [00:07<00:17, 412.78it/s] 28%|███████████████████████████▎                                                                     | 2745/9741 [00:07<00:16, 413.86it/s] 29%|███████████████████████████▊                                                                     | 2787/9741 [00:07<00:16, 414.45it/s] 29%|████████████████████████████▏                                                                    | 2829/9741 [00:07<00:16, 415.47it/s] 29%|████████████████████████████▌                                                                    | 2871/9741 [00:07<00:16, 416.48it/s] 30%|█████████████████████████████                                                                    | 2913/9741 [00:07<00:16, 416.25it/s] 30%|█████████████████████████████▍                                                                   | 2955/9741 [00:07<00:16, 413.97it/s] 31%|█████████████████████████████▊                                                                   | 2997/9741 [00:07<00:16, 415.35it/s] 31%|██████████████████████████████▎                                                                  | 3039/9741 [00:07<00:16, 415.77it/s] 32%|██████████████████████████████▋                                                                  | 3081/9741 [00:08<00:16, 415.80it/s] 32%|███████████████████████████████                                                                  | 3123/9741 [00:08<00:15, 416.39it/s] 32%|███████████████████████████████▌                                                                 | 3165/9741 [00:08<00:15, 413.96it/s] 33%|███████████████████████████████▉                                                                 | 3207/9741 [00:08<00:15, 415.00it/s] 33%|████████████████████████████████▎                                                                | 3249/9741 [00:08<00:15, 416.06it/s] 34%|████████████████████████████████▊                                                                | 3291/9741 [00:08<00:15, 416.83it/s] 34%|█████████████████████████████████▏                                                               | 3333/9741 [00:08<00:15, 416.02it/s] 35%|█████████████████████████████████▌                                                               | 3375/9741 [00:08<00:15, 416.09it/s] 35%|██████████████████████████████████                                                               | 3417/9741 [00:08<00:15, 413.89it/s] 36%|██████████████████████████████████▍                                                              | 3459/9741 [00:08<00:15, 414.26it/s] 36%|██████████████████████████████████▊                                                              | 3501/9741 [00:09<00:15, 415.18it/s] 36%|███████████████████████████████████▎                                                             | 3543/9741 [00:09<00:14, 415.98it/s] 37%|███████████████████████████████████▋                                                             | 3585/9741 [00:09<00:14, 416.37it/s] 37%|████████████████████████████████████                                                             | 3627/9741 [00:09<00:14, 413.83it/s] 38%|████████████████████████████████████▌                                                            | 3669/9741 [00:09<00:14, 414.90it/s] 38%|████████████████████████████████████▉                                                            | 3711/9741 [00:09<00:14, 416.26it/s] 39%|█████████████████████████████████████▎                                                           | 3753/9741 [00:09<00:14, 416.49it/s] 39%|█████████████████████████████████████▊                                                           | 3795/9741 [00:09<00:14, 416.74it/s] 39%|██████████████████████████████████████▏                                                          | 3837/9741 [00:09<00:14, 414.20it/s] 40%|██████████████████████████████████████▋                                                          | 3879/9741 [00:09<00:14, 415.13it/s] 40%|███████████████████████████████████████                                                          | 3921/9741 [00:10<00:13, 415.91it/s] 41%|███████████████████████████████████████▍                                                         | 3963/9741 [00:10<00:13, 416.46it/s] 41%|███████████████████████████████████████▉                                                         | 4005/9741 [00:10<00:13, 415.47it/s] 42%|████████████████████████████████████████▎                                                        | 4047/9741 [00:10<00:13, 416.17it/s] 42%|████████████████████████████████████████▋                                                        | 4089/9741 [00:10<00:13, 414.04it/s] 42%|█████████████████████████████████████████▏                                                       | 4131/9741 [00:10<00:13, 414.53it/s] 43%|█████████████████████████████████████████▌                                                       | 4173/9741 [00:10<00:13, 415.15it/s] 43%|█████████████████████████████████████████▉                                                       | 4215/9741 [00:10<00:13, 415.65it/s] 44%|██████████████████████████████████████████▍                                                      | 4257/9741 [00:10<00:13, 416.48it/s] 44%|██████████████████████████████████████████▊                                                      | 4299/9741 [00:10<00:13, 399.65it/s] 45%|███████████████████████████████████████████▏                                                     | 4341/9741 [00:11<00:13, 404.35it/s] 45%|███████████████████████████████████████████▋                                                     | 4383/9741 [00:11<00:13, 408.54it/s] 45%|████████████████████████████████████████████                                                     | 4425/9741 [00:11<00:12, 411.43it/s] 46%|████████████████████████████████████████████▍                                                    | 4467/9741 [00:11<00:12, 413.31it/s] 46%|████████████████████████████████████████████▉                                                    | 4509/9741 [00:11<00:12, 414.53it/s] 47%|█████████████████████████████████████████████▎                                                   | 4551/9741 [00:11<00:13, 379.56it/s] 47%|█████████████████████████████████████████████▋                                                   | 4593/9741 [00:11<00:13, 390.35it/s] 48%|██████████████████████████████████████████████▏                                                  | 4636/9741 [00:11<00:12, 399.09it/s] 48%|██████████████████████████████████████████████▌                                                  | 4678/9741 [00:11<00:12, 404.50it/s] 48%|███████████████████████████████████████████████                                                  | 4720/9741 [00:12<00:12, 407.52it/s] 49%|███████████████████████████████████████████████▍                                                 | 4761/9741 [00:12<00:17, 278.36it/s] 49%|███████████████████████████████████████████████▊                                                 | 4803/9741 [00:12<00:15, 309.48it/s] 50%|████████████████████████████████████████████████▏                                                | 4845/9741 [00:12<00:14, 335.54it/s] 50%|████████████████████████████████████████████████▋                                                | 4887/9741 [00:12<00:13, 356.48it/s] 51%|█████████████████████████████████████████████████                                                | 4929/9741 [00:12<00:12, 373.10it/s] 51%|█████████████████████████████████████████████████▌                                               | 4971/9741 [00:12<00:12, 383.77it/s] 51%|█████████████████████████████████████████████████▉                                               | 5013/9741 [00:12<00:12, 393.76it/s] 52%|██████████████████████████████████████████████████▎                                              | 5055/9741 [00:12<00:11, 401.16it/s] 52%|██████████████████████████████████████████████████▊                                              | 5097/9741 [00:13<00:11, 406.37it/s] 53%|███████████████████████████████████████████████████▏                                             | 5139/9741 [00:13<00:11, 409.79it/s] 53%|███████████████████████████████████████████████████▌                                             | 5181/9741 [00:13<00:11, 410.03it/s] 54%|████████████████████████████████████████████████████                                             | 5223/9741 [00:13<00:10, 412.79it/s] 54%|████████████████████████████████████████████████████▍                                            | 5265/9741 [00:13<00:10, 414.40it/s] 54%|████████████████████████████████████████████████████▊                                            | 5307/9741 [00:13<00:10, 416.04it/s] 55%|█████████████████████████████████████████████████████▎                                           | 5349/9741 [00:13<00:10, 416.62it/s] 55%|█████████████████████████████████████████████████████▋                                           | 5391/9741 [00:13<00:10, 415.12it/s] 56%|██████████████████████████████████████████████████████                                           | 5433/9741 [00:13<00:10, 413.58it/s] 56%|██████████████████████████████████████████████████████▌                                          | 5475/9741 [00:14<00:10, 414.96it/s] 57%|██████████████████████████████████████████████████████▉                                          | 5519/9741 [00:14<00:10, 419.80it/s] 57%|███████████████████████████████████████████████████████▍                                         | 5563/9741 [00:14<00:09, 423.29it/s] 58%|███████████████████████████████████████████████████████▊                                         | 5607/9741 [00:14<00:09, 425.51it/s] 58%|████████████████████████████████████████████████████████▎                                        | 5650/9741 [00:14<00:09, 424.83it/s] 58%|████████████████████████████████████████████████████████▋                                        | 5694/9741 [00:14<00:09, 427.02it/s] 59%|█████████████████████████████████████████████████████████▏                                       | 5738/9741 [00:14<00:09, 428.63it/s] 59%|█████████████████████████████████████████████████████████▌                                       | 5782/9741 [00:14<00:09, 429.64it/s] 60%|██████████████████████████████████████████████████████████                                       | 5826/9741 [00:14<00:09, 430.04it/s] 60%|██████████████████████████████████████████████████████████▍                                      | 5870/9741 [00:14<00:09, 426.96it/s] 61%|██████████████████████████████████████████████████████████▉                                      | 5914/9741 [00:15<00:08, 427.93it/s] 61%|███████████████████████████████████████████████████████████▎                                     | 5958/9741 [00:15<00:08, 429.36it/s] 62%|███████████████████████████████████████████████████████████▊                                     | 6002/9741 [00:15<00:08, 430.20it/s] 62%|████████████████████████████████████████████████████████████▏                                    | 6046/9741 [00:15<00:08, 431.08it/s] 63%|████████████████████████████████████████████████████████████▋                                    | 6090/9741 [00:15<00:08, 425.11it/s] 63%|█████████████████████████████████████████████████████████████                                    | 6134/9741 [00:15<00:08, 426.71it/s] 63%|█████████████████████████████████████████████████████████████▌                                   | 6178/9741 [00:15<00:08, 428.02it/s] 64%|█████████████████████████████████████████████████████████████▉                                   | 6222/9741 [00:15<00:08, 429.18it/s] 64%|██████████████████████████████████████████████████████████████▍                                  | 6266/9741 [00:15<00:08, 429.84it/s] 65%|██████████████████████████████████████████████████████████████▊                                  | 6309/9741 [00:15<00:08, 428.07it/s] 65%|███████████████████████████████████████████████████████████████▎                                 | 6353/9741 [00:16<00:07, 429.55it/s] 66%|███████████████████████████████████████████████████████████████▋                                 | 6397/9741 [00:16<00:07, 430.69it/s] 66%|████████████████████████████████████████████████████████████████▏                                | 6441/9741 [00:16<00:07, 431.58it/s] 67%|████████████████████████████████████████████████████████████████▌                                | 6485/9741 [00:16<00:07, 431.26it/s] 67%|█████████████████████████████████████████████████████████████████                                | 6529/9741 [00:16<00:07, 430.81it/s] 67%|█████████████████████████████████████████████████████████████████▍                               | 6573/9741 [00:16<00:07, 428.42it/s] 68%|█████████████████████████████████████████████████████████████████▉                               | 6617/9741 [00:16<00:07, 429.42it/s] 68%|██████████████████████████████████████████████████████████████████▎                              | 6661/9741 [00:16<00:07, 430.40it/s] 69%|██████████████████████████████████████████████████████████████████▊                              | 6705/9741 [00:16<00:07, 430.93it/s] 69%|███████████████████████████████████████████████████████████████████▏                             | 6749/9741 [00:16<00:06, 431.71it/s] 70%|███████████████████████████████████████████████████████████████████▋                             | 6793/9741 [00:17<00:06, 429.72it/s] 70%|████████████████████████████████████████████████████████████████████                             | 6836/9741 [00:17<00:06, 427.49it/s] 71%|████████████████████████████████████████████████████████████████████▌                            | 6880/9741 [00:17<00:06, 429.05it/s] 71%|████████████████████████████████████████████████████████████████████▉                            | 6924/9741 [00:17<00:06, 429.55it/s] 72%|█████████████████████████████████████████████████████████████████████▍                           | 6968/9741 [00:17<00:06, 430.16it/s] 72%|█████████████████████████████████████████████████████████████████████▊                           | 7012/9741 [00:17<00:06, 427.71it/s] 72%|██████████████████████████████████████████████████████████████████████▎                          | 7056/9741 [00:17<00:06, 429.04it/s] 73%|██████████████████████████████████████████████████████████████████████▋                          | 7100/9741 [00:17<00:06, 429.83it/s] 73%|███████████████████████████████████████████████████████████████████████▏                         | 7144/9741 [00:17<00:06, 430.63it/s] 74%|███████████████████████████████████████████████████████████████████████▌                         | 7188/9741 [00:17<00:05, 431.01it/s] 74%|████████████████████████████████████████████████████████████████████████                         | 7232/9741 [00:18<00:05, 428.19it/s] 75%|████████████████████████████████████████████████████████████████████████▍                        | 7275/9741 [00:18<00:05, 428.56it/s] 75%|████████████████████████████████████████████████████████████████████████▊                        | 7318/9741 [00:18<00:05, 428.61it/s] 76%|█████████████████████████████████████████████████████████████████████████▎                       | 7362/9741 [00:18<00:05, 429.41it/s] 76%|█████████████████████████████████████████████████████████████████████████▋                       | 7406/9741 [00:18<00:05, 430.03it/s] 76%|██████████████████████████████████████████████████████████████████████████▏                      | 7450/9741 [00:18<00:05, 396.56it/s] 77%|██████████████████████████████████████████████████████████████████████████▌                      | 7494/9741 [00:18<00:05, 406.51it/s] 77%|███████████████████████████████████████████████████████████████████████████                      | 7536/9741 [00:18<00:05, 410.13it/s] 78%|███████████████████████████████████████████████████████████████████████████▍                     | 7580/9741 [00:18<00:05, 416.28it/s] 78%|███████████████████████████████████████████████████████████████████████████▉                     | 7623/9741 [00:19<00:05, 420.02it/s] 79%|████████████████████████████████████████████████████████████████████████████▎                    | 7666/9741 [00:19<00:04, 422.91it/s] 79%|████████████████████████████████████████████████████████████████████████████▊                    | 7709/9741 [00:19<00:04, 421.30it/s] 80%|█████████████████████████████████████████████████████████████████████████████▏                   | 7752/9741 [00:19<00:04, 423.76it/s] 80%|█████████████████████████████████████████████████████████████████████████████▋                   | 7796/9741 [00:19<00:04, 425.86it/s] 80%|██████████████████████████████████████████████████████████████████████████████                   | 7840/9741 [00:19<00:04, 427.36it/s] 81%|██████████████████████████████████████████████████████████████████████████████▍                  | 7883/9741 [00:19<00:04, 427.99it/s] 81%|██████████████████████████████████████████████████████████████████████████████▉                  | 7926/9741 [00:19<00:04, 426.89it/s] 82%|███████████████████████████████████████████████████████████████████████████████▎                 | 7970/9741 [00:19<00:04, 428.45it/s] 82%|███████████████████████████████████████████████████████████████████████████████▊                 | 8014/9741 [00:19<00:04, 429.42it/s] 83%|████████████████████████████████████████████████████████████████████████████████▏                | 8058/9741 [00:20<00:03, 429.64it/s] 83%|████████████████████████████████████████████████████████████████████████████████▋                | 8102/9741 [00:20<00:03, 430.02it/s] 84%|█████████████████████████████████████████████████████████████████████████████████                | 8146/9741 [00:20<00:03, 427.37it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▌               | 8190/9741 [00:20<00:03, 428.47it/s] 85%|█████████████████████████████████████████████████████████████████████████████████▉               | 8234/9741 [00:20<00:03, 429.20it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▍              | 8277/9741 [00:20<00:03, 425.79it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▊              | 8320/9741 [00:20<00:03, 426.96it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▎             | 8363/9741 [00:20<00:03, 425.47it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▋             | 8407/9741 [00:20<00:03, 427.15it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▏            | 8451/9741 [00:20<00:03, 428.59it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▌            | 8495/9741 [00:21<00:02, 429.18it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████            | 8538/9741 [00:21<00:02, 429.31it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▍           | 8581/9741 [00:21<00:02, 426.67it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▉           | 8624/9741 [00:21<00:02, 427.46it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▎          | 8668/9741 [00:21<00:02, 428.32it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▋          | 8711/9741 [00:21<00:02, 428.61it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▏         | 8754/9741 [00:21<00:02, 428.20it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▌         | 8797/9741 [00:21<00:02, 427.80it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████         | 8840/9741 [00:21<00:02, 425.25it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▍        | 8883/9741 [00:21<00:02, 425.83it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████▉        | 8926/9741 [00:22<00:01, 426.39it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▎       | 8969/9741 [00:22<00:01, 426.51it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████████▋       | 9012/9741 [00:22<00:01, 425.40it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▏      | 9055/9741 [00:22<00:01, 423.15it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▌      | 9099/9741 [00:22<00:01, 425.38it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████      | 9143/9741 [00:22<00:01, 427.37it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▍     | 9187/9741 [00:22<00:01, 428.47it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████▉     | 9231/9741 [00:22<00:01, 429.07it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▎    | 9274/9741 [00:22<00:01, 427.14it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▊    | 9317/9741 [00:22<00:00, 427.81it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▏   | 9360/9741 [00:23<00:00, 428.23it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▋   | 9404/9741 [00:23<00:00, 428.97it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████   | 9448/9741 [00:23<00:00, 429.43it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████▌  | 9491/9741 [00:23<00:00, 427.17it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▉  | 9535/9741 [00:23<00:00, 428.11it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████▍ | 9579/9741 [00:23<00:00, 429.03it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▊ | 9623/9741 [00:23<00:00, 429.65it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▎| 9667/9741 [00:23<00:00, 430.05it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████▋| 9711/9741 [00:23<00:00, 427.08it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:23<00:00, 406.09it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.19s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:06<00:12,  6.01s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.50s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.24s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.18s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:13<00:06,  6.84s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]
[2023-08-17 21:30:55,729] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.58s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:18<00:00,  6.03s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:18<00:00,  6.17s/it]
[2023-08-17 21:31:13,233] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-17 21:31:13,235] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-17 21:31:13,236] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-17 21:31:13,236] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-17 21:31:13,236] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-17 21:31:13,236] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-17 21:31:13,237] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-17 21:31:13,237] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-17 21:31:13,237] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-17 21:31:13,237] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-17 21:31:13,237] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-17 21:31:13,237] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7ffac76b9e80>
[2023-08-17 21:31:13,237] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-17 21:31:13,237] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-17 21:31:13,237] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-17 21:31:13,237] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7ffac76b9dc0>
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-17 21:31:13,238] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-17 21:31:13,239] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-17 21:31:13,239] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5177180767059326 seconds
Loading extension module utils...
Time to load utils op: 0.4045414924621582 seconds
Loading extension module utils...
Time to load utils op: 0.5048215389251709 seconds
Loading extension module utils...
Time to load utils op: 0.4048583507537842 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
So the final answer is 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
So the final answer is 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: Max finished history in 20 * 2 = <<20*2=40>>40 minutes.
Finishing geography took the most time, which is 40 * 3 = <<40*3=120>>120 minutes.
In total, for all three subjects, Max needed 20 + 40 + 120 = <<20+40+120=180>>180 minutes.
So the final answer is 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: If Sophia ate 1/6 of the pie, then 6/6 - 1/6 = 5/6 is left in the fridge.
Let x be the pie's original weight.
The current weight of the pie can be described by 5x/6=1200 grams
So, 5x=7200.
And, the original weight is x = <<1440=1440>>1440 grams.
So, Sophia ate 1440 grams original - 1200 grams after= <<1440-1200=240>>240 grams of pie.
So the final answer is 240

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o7-tgsm8k-s1-rTrue
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:05<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 1645518) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-17_21:31:22
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 1645519)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-17_21:31:22
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 1645520)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-17_21:31:22
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 1645521)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-17_21:31:22
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 1645518)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 8
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-17 21:31:26,631] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 8
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o8-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                                  | 25/9741 [00:00<00:39, 246.38it/s]  1%|▌                                                                                                  | 50/9741 [00:00<00:39, 247.15it/s]  1%|▊                                                                                                  | 75/9741 [00:00<00:39, 247.23it/s]  1%|█                                                                                                 | 100/9741 [00:00<00:38, 247.31it/s]  1%|█▎                                                                                                | 125/9741 [00:00<00:38, 247.27it/s]  2%|█▌                                                                                                | 150/9741 [00:00<00:38, 247.08it/s]  2%|█▊                                                                                                | 175/9741 [00:00<00:39, 243.36it/s]  2%|██                                                                                                | 200/9741 [00:00<00:39, 241.71it/s]  2%|██▎                                                                                               | 225/9741 [00:00<00:39, 243.11it/s]  3%|██▌                                                                                               | 250/9741 [00:01<00:38, 244.16it/s]  3%|██▊                                                                                               | 275/9741 [00:01<00:38, 245.14it/s]  3%|███                                                                                               | 300/9741 [00:01<00:38, 245.51it/s]  3%|███▎                                                                                              | 325/9741 [00:01<00:38, 245.77it/s]  4%|███▌                                                                                              | 350/9741 [00:01<00:38, 246.04it/s]  4%|███▊                                                                                              | 375/9741 [00:01<00:38, 245.91it/s]  4%|████                                                                                              | 400/9741 [00:01<00:37, 246.55it/s]  4%|████▎                                                                                             | 425/9741 [00:01<00:38, 243.48it/s]  5%|████▌                                                                                             | 450/9741 [00:01<00:38, 240.45it/s]  5%|████▊                                                                                             | 475/9741 [00:01<00:38, 242.23it/s]  5%|█████                                                                                             | 500/9741 [00:02<00:37, 243.59it/s]  5%|█████▎                                                                                            | 525/9741 [00:02<00:37, 244.65it/s]  6%|█████▌                                                                                            | 550/9741 [00:02<00:37, 245.47it/s]  6%|█████▉                                                                                            | 586/9741 [00:02<00:32, 278.37it/s]  6%|██████▎                                                                                           | 624/9741 [00:02<00:29, 306.96it/s]  7%|██████▋                                                                                           | 661/9741 [00:02<00:27, 324.41it/s]  7%|███████                                                                                           | 699/9741 [00:02<00:26, 339.53it/s]  8%|███████▍                                                                                          | 737/9741 [00:02<00:25, 349.99it/s]  8%|███████▊                                                                                          | 775/9741 [00:02<00:25, 357.62it/s]  8%|████████▏                                                                                         | 812/9741 [00:02<00:24, 360.93it/s]  9%|████████▌                                                                                         | 850/9741 [00:03<00:24, 364.80it/s]  9%|████████▉                                                                                         | 887/9741 [00:03<00:24, 365.06it/s]  9%|█████████▎                                                                                        | 925/9741 [00:03<00:23, 367.63it/s] 10%|█████████▋                                                                                        | 963/9741 [00:03<00:23, 369.46it/s] 10%|█████████▉                                                                                       | 1001/9741 [00:03<00:23, 370.61it/s] 11%|██████████▎                                                                                      | 1039/9741 [00:03<00:23, 371.67it/s] 11%|██████████▋                                                                                      | 1077/9741 [00:03<00:23, 372.28it/s] 11%|███████████                                                                                      | 1115/9741 [00:03<00:23, 369.79it/s] 12%|███████████▍                                                                                     | 1153/9741 [00:03<00:23, 371.00it/s] 12%|███████████▊                                                                                     | 1191/9741 [00:03<00:23, 371.34it/s] 13%|████████████▏                                                                                    | 1229/9741 [00:04<00:22, 371.60it/s] 13%|████████████▌                                                                                    | 1267/9741 [00:04<00:22, 371.63it/s] 13%|████████████▉                                                                                    | 1305/9741 [00:04<00:22, 371.74it/s] 14%|█████████████▎                                                                                   | 1343/9741 [00:04<00:22, 369.03it/s] 14%|█████████████▊                                                                                   | 1381/9741 [00:04<00:22, 369.78it/s] 15%|██████████████▏                                                                                  | 1419/9741 [00:04<00:22, 370.59it/s] 15%|██████████████▌                                                                                  | 1457/9741 [00:04<00:22, 371.44it/s] 15%|██████████████▉                                                                                  | 1495/9741 [00:04<00:22, 371.78it/s] 16%|███████████████▎                                                                                 | 1533/9741 [00:04<00:22, 371.70it/s] 16%|███████████████▋                                                                                 | 1571/9741 [00:05<00:22, 369.58it/s] 17%|████████████████                                                                                 | 1609/9741 [00:05<00:21, 370.25it/s] 17%|████████████████▍                                                                                | 1647/9741 [00:05<00:21, 371.06it/s] 17%|████████████████▊                                                                                | 1685/9741 [00:05<00:21, 371.50it/s] 18%|█████████████████▏                                                                               | 1723/9741 [00:05<00:21, 371.73it/s] 18%|█████████████████▌                                                                               | 1761/9741 [00:05<00:21, 372.04it/s] 18%|█████████████████▉                                                                               | 1799/9741 [00:05<00:22, 346.71it/s] 19%|██████████████████▎                                                                              | 1837/9741 [00:05<00:22, 353.73it/s] 19%|██████████████████▋                                                                              | 1875/9741 [00:05<00:21, 358.56it/s] 20%|███████████████████                                                                              | 1913/9741 [00:05<00:21, 362.66it/s] 20%|███████████████████▍                                                                             | 1951/9741 [00:06<00:21, 365.25it/s] 20%|███████████████████▊                                                                             | 1989/9741 [00:06<00:21, 367.44it/s] 21%|████████████████████▏                                                                            | 2026/9741 [00:06<00:21, 365.74it/s] 21%|████████████████████▌                                                                            | 2063/9741 [00:06<00:20, 366.85it/s] 22%|████████████████████▉                                                                            | 2101/9741 [00:06<00:20, 368.11it/s] 22%|█████████████████████▎                                                                           | 2139/9741 [00:06<00:20, 369.54it/s] 22%|█████████████████████▋                                                                           | 2177/9741 [00:06<00:20, 370.60it/s] 23%|██████████████████████                                                                           | 2215/9741 [00:06<00:20, 371.04it/s] 23%|██████████████████████▍                                                                          | 2253/9741 [00:06<00:20, 368.60it/s] 24%|██████████████████████▊                                                                          | 2290/9741 [00:06<00:20, 367.20it/s] 24%|███████████████████████▏                                                                         | 2328/9741 [00:07<00:20, 368.53it/s] 24%|███████████████████████▌                                                                         | 2366/9741 [00:07<00:19, 369.47it/s] 25%|███████████████████████▉                                                                         | 2404/9741 [00:07<00:19, 370.03it/s] 25%|████████████████████████▎                                                                        | 2442/9741 [00:07<00:19, 370.52it/s] 25%|████████████████████████▋                                                                        | 2480/9741 [00:07<00:19, 368.15it/s] 26%|█████████████████████████                                                                        | 2518/9741 [00:07<00:19, 369.00it/s] 26%|█████████████████████████▍                                                                       | 2556/9741 [00:07<00:19, 369.55it/s] 27%|█████████████████████████▊                                                                       | 2594/9741 [00:07<00:19, 370.46it/s] 27%|██████████████████████████▏                                                                      | 2632/9741 [00:07<00:19, 370.14it/s] 27%|██████████████████████████▌                                                                      | 2670/9741 [00:07<00:19, 370.24it/s] 28%|██████████████████████████▉                                                                      | 2708/9741 [00:08<00:19, 367.57it/s] 28%|███████████████████████████▎                                                                     | 2745/9741 [00:08<00:19, 365.55it/s] 29%|███████████████████████████▋                                                                     | 2782/9741 [00:08<00:18, 366.62it/s] 29%|████████████████████████████                                                                     | 2819/9741 [00:08<00:18, 367.38it/s] 29%|████████████████████████████▍                                                                    | 2857/9741 [00:08<00:18, 368.95it/s] 30%|████████████████████████████▊                                                                    | 2895/9741 [00:08<00:18, 369.61it/s] 30%|█████████████████████████████▏                                                                   | 2932/9741 [00:08<00:18, 367.45it/s] 30%|█████████████████████████████▌                                                                   | 2970/9741 [00:08<00:18, 368.52it/s] 31%|█████████████████████████████▉                                                                   | 3008/9741 [00:08<00:18, 369.67it/s] 31%|██████████████████████████████▎                                                                  | 3046/9741 [00:09<00:18, 369.90it/s] 32%|██████████████████████████████▋                                                                  | 3083/9741 [00:09<00:18, 369.26it/s] 32%|███████████████████████████████                                                                  | 3121/9741 [00:09<00:17, 370.11it/s] 32%|███████████████████████████████▍                                                                 | 3159/9741 [00:09<00:17, 367.13it/s] 33%|███████████████████████████████▊                                                                 | 3197/9741 [00:09<00:17, 368.53it/s] 33%|████████████████████████████████▏                                                                | 3234/9741 [00:09<00:17, 366.50it/s] 34%|████████████████████████████████▌                                                                | 3272/9741 [00:09<00:17, 367.88it/s] 34%|████████████████████████████████▉                                                                | 3310/9741 [00:09<00:17, 369.20it/s] 34%|█████████████████████████████████▎                                                               | 3348/9741 [00:09<00:17, 369.91it/s] 35%|█████████████████████████████████▋                                                               | 3385/9741 [00:09<00:17, 366.64it/s] 35%|██████████████████████████████████                                                               | 3423/9741 [00:10<00:17, 367.86it/s] 36%|██████████████████████████████████▍                                                              | 3460/9741 [00:10<00:17, 368.31it/s] 36%|██████████████████████████████████▊                                                              | 3497/9741 [00:10<00:16, 368.73it/s] 36%|███████████████████████████████████▏                                                             | 3534/9741 [00:10<00:16, 368.79it/s] 37%|███████████████████████████████████▌                                                             | 3572/9741 [00:10<00:16, 369.27it/s] 37%|███████████████████████████████████▉                                                             | 3609/9741 [00:10<00:16, 367.13it/s] 37%|████████████████████████████████████▎                                                            | 3647/9741 [00:10<00:16, 368.27it/s] 38%|████████████████████████████████████▋                                                            | 3685/9741 [00:10<00:16, 368.98it/s] 38%|█████████████████████████████████████                                                            | 3723/9741 [00:10<00:16, 370.09it/s] 39%|█████████████████████████████████████▍                                                           | 3761/9741 [00:10<00:16, 370.70it/s] 39%|█████████████████████████████████████▊                                                           | 3799/9741 [00:11<00:16, 370.29it/s] 39%|██████████████████████████████████████▏                                                          | 3837/9741 [00:11<00:16, 367.61it/s] 40%|██████████████████████████████████████▌                                                          | 3875/9741 [00:11<00:15, 368.62it/s] 40%|██████████████████████████████████████▉                                                          | 3913/9741 [00:11<00:15, 369.52it/s] 41%|███████████████████████████████████████▎                                                         | 3951/9741 [00:11<00:15, 369.89it/s] 41%|███████████████████████████████████████▋                                                         | 3989/9741 [00:11<00:15, 370.08it/s] 41%|████████████████████████████████████████                                                         | 4027/9741 [00:11<00:15, 370.56it/s] 42%|████████████████████████████████████████▍                                                        | 4065/9741 [00:11<00:15, 368.22it/s] 42%|████████████████████████████████████████▊                                                        | 4103/9741 [00:11<00:15, 369.12it/s] 43%|█████████████████████████████████████████▏                                                       | 4141/9741 [00:11<00:15, 369.54it/s] 43%|█████████████████████████████████████████▌                                                       | 4178/9741 [00:12<00:15, 369.58it/s] 43%|█████████████████████████████████████████▉                                                       | 4215/9741 [00:12<00:15, 366.92it/s] 44%|██████████████████████████████████████████▎                                                      | 4252/9741 [00:12<00:14, 367.43it/s] 44%|██████████████████████████████████████████▋                                                      | 4289/9741 [00:12<00:14, 365.30it/s] 44%|███████████████████████████████████████████                                                      | 4327/9741 [00:12<00:14, 366.79it/s] 45%|███████████████████████████████████████████▍                                                     | 4364/9741 [00:12<00:14, 367.67it/s] 45%|███████████████████████████████████████████▊                                                     | 4401/9741 [00:12<00:14, 367.99it/s] 46%|████████████████████████████████████████████▏                                                    | 4438/9741 [00:12<00:14, 367.98it/s] 46%|████████████████████████████████████████████▌                                                    | 4475/9741 [00:12<00:14, 368.56it/s] 46%|████████████████████████████████████████████▉                                                    | 4512/9741 [00:13<00:16, 323.62it/s] 47%|█████████████████████████████████████████████▎                                                   | 4549/9741 [00:13<00:15, 335.83it/s] 47%|█████████████████████████████████████████████▋                                                   | 4586/9741 [00:13<00:14, 345.31it/s] 47%|██████████████████████████████████████████████                                                   | 4623/9741 [00:13<00:14, 352.35it/s] 48%|██████████████████████████████████████████████▍                                                  | 4661/9741 [00:13<00:14, 357.76it/s] 48%|██████████████████████████████████████████████▊                                                  | 4698/9741 [00:13<00:13, 361.15it/s] 49%|███████████████████████████████████████████████▏                                                 | 4735/9741 [00:13<00:13, 363.33it/s] 49%|███████████████████████████████████████████████▌                                                 | 4772/9741 [00:13<00:19, 252.34it/s] 49%|███████████████████████████████████████████████▉                                                 | 4809/9741 [00:13<00:17, 278.78it/s] 50%|████████████████████████████████████████████████▎                                                | 4846/9741 [00:14<00:16, 300.44it/s] 50%|████████████████████████████████████████████████▌                                                | 4883/9741 [00:14<00:15, 317.55it/s] 51%|████████████████████████████████████████████████▉                                                | 4920/9741 [00:14<00:14, 331.04it/s] 51%|█████████████████████████████████████████████████▎                                               | 4957/9741 [00:14<00:14, 339.30it/s] 51%|█████████████████████████████████████████████████▋                                               | 4994/9741 [00:14<00:13, 347.46it/s] 52%|██████████████████████████████████████████████████                                               | 5031/9741 [00:14<00:13, 353.06it/s] 52%|██████████████████████████████████████████████████▍                                              | 5068/9741 [00:14<00:13, 357.63it/s] 52%|██████████████████████████████████████████████████▊                                              | 5105/9741 [00:14<00:12, 360.87it/s] 53%|███████████████████████████████████████████████████▏                                             | 5142/9741 [00:14<00:12, 363.16it/s] 53%|███████████████████████████████████████████████████▌                                             | 5179/9741 [00:15<00:12, 362.00it/s] 54%|███████████████████████████████████████████████████▉                                             | 5216/9741 [00:15<00:12, 364.03it/s] 54%|████████████████████████████████████████████████████▎                                            | 5253/9741 [00:15<00:12, 365.61it/s] 54%|████████████████████████████████████████████████████▋                                            | 5290/9741 [00:15<00:12, 366.06it/s] 55%|█████████████████████████████████████████████████████                                            | 5327/9741 [00:15<00:12, 366.88it/s] 55%|█████████████████████████████████████████████████████▍                                           | 5364/9741 [00:15<00:11, 367.46it/s] 55%|█████████████████████████████████████████████████████▊                                           | 5401/9741 [00:15<00:11, 365.27it/s] 56%|██████████████████████████████████████████████████████▏                                          | 5439/9741 [00:15<00:11, 366.69it/s] 56%|██████████████████████████████████████████████████████▌                                          | 5477/9741 [00:15<00:11, 368.15it/s] 57%|██████████████████████████████████████████████████████▉                                          | 5516/9741 [00:15<00:11, 372.03it/s] 57%|███████████████████████████████████████████████████████▎                                         | 5555/9741 [00:16<00:11, 374.74it/s] 57%|███████████████████████████████████████████████████████▋                                         | 5594/9741 [00:16<00:11, 376.48it/s] 58%|████████████████████████████████████████████████████████                                         | 5632/9741 [00:16<00:10, 375.83it/s] 58%|████████████████████████████████████████████████████████▍                                        | 5671/9741 [00:16<00:10, 377.31it/s] 59%|████████████████████████████████████████████████████████▊                                        | 5710/9741 [00:16<00:10, 378.15it/s] 59%|█████████████████████████████████████████████████████████▏                                       | 5749/9741 [00:16<00:10, 379.37it/s] 59%|█████████████████████████████████████████████████████████▋                                       | 5788/9741 [00:16<00:10, 379.91it/s] 60%|██████████████████████████████████████████████████████████                                       | 5827/9741 [00:16<00:10, 380.07it/s] 60%|██████████████████████████████████████████████████████████▍                                      | 5866/9741 [00:16<00:10, 376.97it/s] 61%|██████████████████████████████████████████████████████████▊                                      | 5905/9741 [00:16<00:10, 378.34it/s] 61%|███████████████████████████████████████████████████████████▏                                     | 5944/9741 [00:17<00:10, 379.62it/s] 61%|███████████████████████████████████████████████████████████▌                                     | 5983/9741 [00:17<00:09, 380.47it/s] 62%|███████████████████████████████████████████████████████████▉                                     | 6022/9741 [00:17<00:09, 380.49it/s] 62%|████████████████████████████████████████████████████████████▎                                    | 6061/9741 [00:17<00:09, 381.18it/s] 63%|████████████████████████████████████████████████████████████▋                                    | 6100/9741 [00:17<00:09, 378.39it/s] 63%|█████████████████████████████████████████████████████████████                                    | 6138/9741 [00:17<00:09, 378.84it/s] 63%|█████████████████████████████████████████████████████████████▌                                   | 6177/9741 [00:17<00:09, 379.60it/s] 64%|█████████████████████████████████████████████████████████████▉                                   | 6216/9741 [00:17<00:09, 380.13it/s] 64%|██████████████████████████████████████████████████████████████▎                                  | 6255/9741 [00:17<00:09, 380.10it/s] 65%|██████████████████████████████████████████████████████████████▋                                  | 6294/9741 [00:17<00:09, 380.75it/s] 65%|███████████████████████████████████████████████████████████████                                  | 6333/9741 [00:18<00:09, 378.23it/s] 65%|███████████████████████████████████████████████████████████████▍                                 | 6372/9741 [00:18<00:08, 379.38it/s] 66%|███████████████████████████████████████████████████████████████▊                                 | 6411/9741 [00:18<00:08, 380.04it/s] 66%|████████████████████████████████████████████████████████████████▏                                | 6450/9741 [00:18<00:08, 380.73it/s] 67%|████████████████████████████████████████████████████████████████▌                                | 6489/9741 [00:18<00:08, 379.67it/s] 67%|█████████████████████████████████████████████████████████████████                                | 6528/9741 [00:18<00:08, 379.87it/s] 67%|█████████████████████████████████████████████████████████████████▍                               | 6566/9741 [00:18<00:08, 377.73it/s] 68%|█████████████████████████████████████████████████████████████████▊                               | 6604/9741 [00:18<00:08, 378.39it/s] 68%|██████████████████████████████████████████████████████████████████▏                              | 6643/9741 [00:18<00:08, 379.42it/s] 69%|██████████████████████████████████████████████████████████████████▌                              | 6682/9741 [00:18<00:08, 380.08it/s] 69%|██████████████████████████████████████████████████████████████████▉                              | 6721/9741 [00:19<00:07, 380.33it/s] 69%|███████████████████████████████████████████████████████████████████▎                             | 6760/9741 [00:19<00:07, 378.35it/s] 70%|███████████████████████████████████████████████████████████████████▋                             | 6799/9741 [00:19<00:07, 379.44it/s] 70%|████████████████████████████████████████████████████████████████████                             | 6838/9741 [00:19<00:07, 380.36it/s] 71%|████████████████████████████████████████████████████████████████████▍                            | 6877/9741 [00:19<00:07, 380.64it/s] 71%|████████████████████████████████████████████████████████████████████▊                            | 6916/9741 [00:19<00:07, 380.91it/s] 71%|█████████████████████████████████████████████████████████████████████▎                           | 6955/9741 [00:19<00:07, 381.06it/s] 72%|█████████████████████████████████████████████████████████████████████▋                           | 6994/9741 [00:19<00:07, 378.52it/s] 72%|██████████████████████████████████████████████████████████████████████                           | 7033/9741 [00:19<00:07, 379.08it/s] 73%|██████████████████████████████████████████████████████████████████████▍                          | 7071/9741 [00:20<00:07, 377.39it/s] 73%|██████████████████████████████████████████████████████████████████████▊                          | 7110/9741 [00:20<00:06, 378.79it/s] 73%|███████████████████████████████████████████████████████████████████████▏                         | 7149/9741 [00:20<00:06, 379.86it/s] 74%|███████████████████████████████████████████████████████████████████████▌                         | 7188/9741 [00:20<00:06, 380.71it/s] 74%|███████████████████████████████████████████████████████████████████████▉                         | 7227/9741 [00:20<00:06, 378.30it/s] 75%|████████████████████████████████████████████████████████████████████████▎                        | 7266/9741 [00:20<00:06, 379.30it/s] 75%|████████████████████████████████████████████████████████████████████████▋                        | 7305/9741 [00:20<00:06, 380.07it/s] 75%|█████████████████████████████████████████████████████████████████████████▏                       | 7344/9741 [00:20<00:06, 380.49it/s] 76%|█████████████████████████████████████████████████████████████████████████▌                       | 7383/9741 [00:20<00:06, 380.74it/s] 76%|█████████████████████████████████████████████████████████████████████████▉                       | 7422/9741 [00:20<00:06, 381.02it/s] 77%|██████████████████████████████████████████████████████████████████████████▎                      | 7461/9741 [00:21<00:06, 349.14it/s] 77%|██████████████████████████████████████████████████████████████████████████▋                      | 7500/9741 [00:21<00:06, 358.45it/s] 77%|███████████████████████████████████████████████████████████████████████████                      | 7539/9741 [00:21<00:06, 364.78it/s] 78%|███████████████████████████████████████████████████████████████████████████▍                     | 7578/9741 [00:21<00:05, 369.41it/s] 78%|███████████████████████████████████████████████████████████████████████████▊                     | 7617/9741 [00:21<00:05, 372.91it/s] 79%|████████████████████████████████████████████████████████████████████████████▏                    | 7655/9741 [00:21<00:05, 371.53it/s] 79%|████████████████████████████████████████████████████████████████████████████▌                    | 7693/9741 [00:21<00:05, 368.80it/s] 79%|████████████████████████████████████████████████████████████████████████████▉                    | 7732/9741 [00:21<00:05, 372.96it/s] 80%|█████████████████████████████████████████████████████████████████████████████▍                   | 7771/9741 [00:21<00:05, 375.40it/s] 80%|█████████████████████████████████████████████████████████████████████████████▊                   | 7810/9741 [00:21<00:05, 377.20it/s] 81%|██████████████████████████████████████████████████████████████████████████████▏                  | 7849/9741 [00:22<00:04, 378.53it/s] 81%|██████████████████████████████████████████████████████████████████████████████▌                  | 7888/9741 [00:22<00:04, 379.42it/s] 81%|██████████████████████████████████████████████████████████████████████████████▉                  | 7926/9741 [00:22<00:04, 377.02it/s] 82%|███████████████████████████████████████████████████████████████████████████████▎                 | 7965/9741 [00:22<00:04, 378.27it/s] 82%|███████████████████████████████████████████████████████████████████████████████▋                 | 8004/9741 [00:22<00:04, 379.21it/s] 83%|████████████████████████████████████████████████████████████████████████████████                 | 8043/9741 [00:22<00:04, 379.62it/s] 83%|████████████████████████████████████████████████████████████████████████████████▍                | 8082/9741 [00:22<00:04, 380.12it/s] 83%|████████████████████████████████████████████████████████████████████████████████▊                | 8121/9741 [00:22<00:04, 378.66it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▎               | 8160/9741 [00:22<00:04, 379.35it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▋               | 8198/9741 [00:23<00:04, 379.40it/s] 85%|██████████████████████████████████████████████████████████████████████████████████               | 8236/9741 [00:23<00:03, 376.96it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▍              | 8275/9741 [00:23<00:03, 378.06it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▊              | 8314/9741 [00:23<00:03, 378.78it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▏             | 8352/9741 [00:23<00:03, 377.01it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▌             | 8391/9741 [00:23<00:03, 378.43it/s] 87%|███████████████████████████████████████████████████████████████████████████████████▉             | 8430/9741 [00:23<00:03, 379.49it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▎            | 8469/9741 [00:23<00:03, 380.21it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▋            | 8508/9741 [00:23<00:03, 380.56it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████            | 8547/9741 [00:23<00:03, 380.43it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▍           | 8586/9741 [00:24<00:03, 377.21it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▉           | 8625/9741 [00:24<00:02, 378.24it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▎          | 8664/9741 [00:24<00:02, 378.93it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▋          | 8703/9741 [00:24<00:02, 379.73it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████          | 8742/9741 [00:24<00:02, 380.30it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▍         | 8781/9741 [00:24<00:02, 380.14it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████▊         | 8820/9741 [00:24<00:02, 374.41it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▏        | 8859/9741 [00:24<00:02, 376.09it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▌        | 8898/9741 [00:24<00:02, 377.31it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████▉        | 8937/9741 [00:24<00:02, 378.34it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▎       | 8975/9741 [00:25<00:02, 378.72it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████████▊       | 9014/9741 [00:25<00:01, 379.33it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▏      | 9052/9741 [00:25<00:01, 377.37it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▌      | 9091/9741 [00:25<00:01, 378.68it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████████▉      | 9130/9741 [00:25<00:01, 379.47it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▎     | 9169/9741 [00:25<00:01, 380.07it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████▋     | 9208/9741 [00:25<00:01, 380.59it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████     | 9247/9741 [00:25<00:01, 380.88it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▍    | 9286/9741 [00:25<00:01, 378.27it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▊    | 9325/9741 [00:25<00:01, 378.94it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▏   | 9364/9741 [00:26<00:00, 379.71it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▋   | 9403/9741 [00:26<00:00, 379.93it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████   | 9442/9741 [00:26<00:00, 380.16it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████▍  | 9481/9741 [00:26<00:00, 380.71it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▊  | 9520/9741 [00:26<00:00, 378.49it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████▏ | 9558/9741 [00:26<00:00, 377.02it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▌ | 9597/9741 [00:26<00:00, 378.02it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▉ | 9635/9741 [00:26<00:00, 378.20it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▎| 9674/9741 [00:26<00:00, 378.88it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████▋| 9712/9741 [00:27<00:00, 375.93it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:27<00:00, 359.55it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.04s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.11s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.15s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:06<00:12,  6.38s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:09<00:04,  4.92s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.02s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.06s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.32s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.49s/it]
Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:12<00:06,  6.35s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.41s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.59s/it]
[2023-08-17 21:32:45,178] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.66s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.85s/it]
[2023-08-17 21:32:58,999] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-17 21:32:59,001] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-17 21:32:59,001] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-17 21:32:59,001] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-17 21:32:59,001] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-17 21:32:59,001] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f873cfd7e80>
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-17 21:32:59,002] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f873cfd7dc0>
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-17 21:32:59,003] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-17 21:32:59,004] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5144593715667725 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
So the final answer is 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
So the final answer is 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: Max finished history in 20 * 2 = <<20*2=40>>40 minutes.
Finishing geography took the most time, which is 40 * 3 = <<40*3=120>>120 minutes.
In total, for all three subjects, Max needed 20 + 40 + 120 = <<20+40+120=180>>180 minutes.
So the final answer is 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: If Sophia ate 1/6 of the pie, then 6/6 - 1/6 = 5/6 is left in the fridge.
Let x be the pie's original weight.
The current weight of the pie can be described by 5x/6=1200 grams
So, 5x=7200.
And, the original weight is x = <<1440=1440>>1440 grams.
So, Sophia ate 1440 grams original - 1200 grams after= <<1440-1200=240>>240 grams of pie.
So the final answer is 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: After using the coupon, the final price comes to 67 - 4 = <<67-4=63>>63 dollars.
With three people, they each need to pay 63 / 3 = <<63/3=21>>21 dollars each.
So the final answer is 21

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o8-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.4053339958190918 seconds
Loading extension module utils...
Time to load utils op: 0.504676103591919 seconds
Loading extension module utils...
Time to load utils op: 0.6048033237457275 seconds
Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:05<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 1646665) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-17_21:33:09
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 1646666)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-17_21:33:09
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 1646667)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-17_21:33:09
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 1646668)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-17_21:33:09
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 1646665)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 9
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-17 21:33:13,069] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 9
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o9-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  0%|▏                                                                                                  | 23/9741 [00:00<00:43, 222.01it/s]  0%|▍                                                                                                  | 46/9741 [00:00<00:43, 222.40it/s]  1%|▋                                                                                                  | 69/9741 [00:00<00:43, 222.77it/s]  1%|▉                                                                                                  | 92/9741 [00:00<00:43, 223.17it/s]  1%|█▏                                                                                                | 115/9741 [00:00<00:43, 223.44it/s]  1%|█▍                                                                                                | 138/9741 [00:00<00:43, 223.27it/s]  2%|█▌                                                                                                | 161/9741 [00:00<00:43, 220.87it/s]  2%|█▊                                                                                                | 184/9741 [00:00<00:43, 221.05it/s]  2%|██                                                                                                | 207/9741 [00:00<00:43, 219.56it/s]  2%|██▎                                                                                               | 230/9741 [00:01<00:43, 220.56it/s]  3%|██▌                                                                                               | 253/9741 [00:01<00:42, 221.02it/s]  3%|██▊                                                                                               | 276/9741 [00:01<00:42, 221.67it/s]  3%|███                                                                                               | 299/9741 [00:01<00:42, 222.13it/s]  3%|███▏                                                                                              | 322/9741 [00:01<00:42, 222.42it/s]  4%|███▍                                                                                              | 345/9741 [00:01<00:42, 222.54it/s]  4%|███▋                                                                                              | 368/9741 [00:01<00:42, 222.57it/s]  4%|███▉                                                                                              | 394/9741 [00:01<00:40, 232.19it/s]  4%|████▎                                                                                             | 427/9741 [00:01<00:35, 259.36it/s]  5%|████▋                                                                                             | 462/9741 [00:01<00:32, 283.66it/s]  5%|████▉                                                                                             | 496/9741 [00:02<00:30, 299.84it/s]  5%|█████▎                                                                                            | 531/9741 [00:02<00:29, 312.02it/s]  6%|█████▋                                                                                            | 565/9741 [00:02<00:28, 317.56it/s]  6%|██████                                                                                            | 599/9741 [00:02<00:28, 324.06it/s]  6%|██████▎                                                                                           | 633/9741 [00:02<00:27, 328.64it/s]  7%|██████▋                                                                                           | 667/9741 [00:02<00:27, 329.58it/s]  7%|███████                                                                                           | 701/9741 [00:02<00:27, 332.62it/s]  8%|███████▍                                                                                          | 735/9741 [00:02<00:26, 334.25it/s]  8%|███████▋                                                                                          | 769/9741 [00:02<00:26, 335.89it/s]  8%|████████                                                                                          | 803/9741 [00:02<00:26, 337.08it/s]  9%|████████▍                                                                                         | 837/9741 [00:03<00:26, 337.59it/s]  9%|████████▊                                                                                         | 871/9741 [00:03<00:26, 338.12it/s]  9%|█████████                                                                                         | 905/9741 [00:03<00:26, 335.49it/s] 10%|█████████▍                                                                                        | 939/9741 [00:03<00:26, 336.48it/s] 10%|█████████▊                                                                                        | 973/9741 [00:03<00:25, 337.37it/s] 10%|██████████                                                                                       | 1007/9741 [00:03<00:25, 337.95it/s] 11%|██████████▍                                                                                      | 1042/9741 [00:03<00:25, 338.60it/s] 11%|██████████▋                                                                                      | 1076/9741 [00:03<00:25, 338.72it/s] 11%|███████████                                                                                      | 1110/9741 [00:03<00:25, 336.27it/s] 12%|███████████▍                                                                                     | 1144/9741 [00:03<00:25, 337.11it/s] 12%|███████████▋                                                                                     | 1178/9741 [00:04<00:25, 336.60it/s] 12%|████████████                                                                                     | 1212/9741 [00:04<00:25, 336.93it/s] 13%|████████████▍                                                                                    | 1246/9741 [00:04<00:25, 337.24it/s] 13%|████████████▋                                                                                    | 1280/9741 [00:04<00:25, 337.88it/s] 13%|█████████████                                                                                    | 1314/9741 [00:04<00:24, 338.41it/s] 14%|█████████████▍                                                                                   | 1348/9741 [00:04<00:25, 332.38it/s] 14%|█████████████▊                                                                                   | 1382/9741 [00:04<00:25, 333.99it/s] 15%|██████████████                                                                                   | 1416/9741 [00:04<00:24, 335.26it/s] 15%|██████████████▍                                                                                  | 1450/9741 [00:04<00:24, 336.11it/s] 15%|██████████████▊                                                                                  | 1484/9741 [00:04<00:24, 336.82it/s] 16%|███████████████                                                                                  | 1518/9741 [00:05<00:24, 336.88it/s] 16%|███████████████▍                                                                                 | 1552/9741 [00:05<00:24, 337.34it/s] 16%|███████████████▊                                                                                 | 1586/9741 [00:05<00:24, 334.95it/s] 17%|████████████████▏                                                                                | 1620/9741 [00:05<00:24, 333.73it/s] 17%|████████████████▍                                                                                | 1654/9741 [00:05<00:24, 335.27it/s] 17%|████████████████▊                                                                                | 1688/9741 [00:05<00:23, 335.71it/s] 18%|█████████████████▏                                                                               | 1722/9741 [00:05<00:23, 336.46it/s] 18%|█████████████████▍                                                                               | 1756/9741 [00:05<00:23, 336.79it/s] 18%|█████████████████▊                                                                               | 1790/9741 [00:05<00:25, 311.48it/s] 19%|██████████████████▏                                                                              | 1824/9741 [00:06<00:24, 318.53it/s] 19%|██████████████████▌                                                                              | 1858/9741 [00:06<00:24, 323.69it/s] 19%|██████████████████▊                                                                              | 1892/9741 [00:06<00:23, 327.55it/s] 20%|███████████████████▏                                                                             | 1926/9741 [00:06<00:23, 330.20it/s] 20%|███████████████████▌                                                                             | 1960/9741 [00:06<00:23, 331.93it/s] 20%|███████████████████▊                                                                             | 1994/9741 [00:06<00:23, 333.34it/s] 21%|████████████████████▏                                                                            | 2028/9741 [00:06<00:23, 331.51it/s] 21%|████████████████████▌                                                                            | 2062/9741 [00:06<00:23, 329.73it/s] 22%|████████████████████▊                                                                            | 2096/9741 [00:06<00:23, 331.20it/s] 22%|█████████████████████▏                                                                           | 2130/9741 [00:06<00:22, 332.29it/s] 22%|█████████████████████▌                                                                           | 2164/9741 [00:07<00:22, 333.26it/s] 23%|█████████████████████▉                                                                           | 2198/9741 [00:07<00:22, 333.88it/s] 23%|██████████████████████▏                                                                          | 2232/9741 [00:07<00:22, 334.23it/s] 23%|██████████████████████▌                                                                          | 2266/9741 [00:07<00:22, 331.77it/s] 24%|██████████████████████▉                                                                          | 2300/9741 [00:07<00:22, 332.80it/s] 24%|███████████████████████▏                                                                         | 2334/9741 [00:07<00:22, 333.02it/s] 24%|███████████████████████▌                                                                         | 2368/9741 [00:07<00:22, 333.33it/s] 25%|███████████████████████▉                                                                         | 2402/9741 [00:07<00:21, 333.80it/s] 25%|████████████████████████▎                                                                        | 2436/9741 [00:07<00:21, 334.08it/s] 25%|████████████████████████▌                                                                        | 2470/9741 [00:07<00:22, 329.77it/s] 26%|████████████████████████▉                                                                        | 2504/9741 [00:08<00:21, 330.46it/s] 26%|█████████████████████████▎                                                                       | 2538/9741 [00:08<00:21, 331.06it/s] 26%|█████████████████████████▌                                                                       | 2572/9741 [00:08<00:21, 331.92it/s] 27%|█████████████████████████▉                                                                       | 2606/9741 [00:08<00:21, 332.73it/s] 27%|██████████████████████████▎                                                                      | 2640/9741 [00:08<00:21, 332.75it/s] 27%|██████████████████████████▋                                                                      | 2674/9741 [00:08<00:21, 333.07it/s] 28%|██████████████████████████▉                                                                      | 2708/9741 [00:08<00:21, 330.38it/s] 28%|███████████████████████████▎                                                                     | 2742/9741 [00:08<00:21, 330.94it/s] 28%|███████████████████████████▋                                                                     | 2776/9741 [00:08<00:20, 331.74it/s] 29%|███████████████████████████▉                                                                     | 2810/9741 [00:08<00:20, 332.64it/s] 29%|████████████████████████████▎                                                                    | 2844/9741 [00:09<00:20, 333.07it/s] 30%|████████████████████████████▋                                                                    | 2878/9741 [00:09<00:20, 333.85it/s] 30%|████████████████████████████▉                                                                    | 2912/9741 [00:09<00:20, 334.18it/s] 30%|█████████████████████████████▎                                                                   | 2946/9741 [00:09<00:20, 331.94it/s] 31%|█████████████████████████████▋                                                                   | 2980/9741 [00:09<00:20, 332.96it/s] 31%|██████████████████████████████                                                                   | 3014/9741 [00:09<00:20, 333.85it/s] 31%|██████████████████████████████▎                                                                  | 3048/9741 [00:09<00:20, 332.33it/s] 32%|██████████████████████████████▋                                                                  | 3082/9741 [00:09<00:20, 332.77it/s] 32%|███████████████████████████████                                                                  | 3116/9741 [00:09<00:19, 333.36it/s] 32%|███████████████████████████████▎                                                                 | 3150/9741 [00:10<00:19, 331.05it/s] 33%|███████████████████████████████▋                                                                 | 3184/9741 [00:10<00:19, 332.37it/s] 33%|████████████████████████████████                                                                 | 3218/9741 [00:10<00:19, 333.03it/s] 33%|████████████████████████████████▍                                                                | 3252/9741 [00:10<00:19, 333.95it/s] 34%|████████████████████████████████▋                                                                | 3286/9741 [00:10<00:19, 334.13it/s] 34%|█████████████████████████████████                                                                | 3320/9741 [00:10<00:19, 334.39it/s] 34%|█████████████████████████████████▍                                                               | 3354/9741 [00:10<00:19, 333.89it/s] 35%|█████████████████████████████████▋                                                               | 3388/9741 [00:10<00:19, 331.59it/s] 35%|██████████████████████████████████                                                               | 3422/9741 [00:10<00:19, 332.53it/s] 35%|██████████████████████████████████▍                                                              | 3456/9741 [00:10<00:18, 333.05it/s] 36%|██████████████████████████████████▊                                                              | 3490/9741 [00:11<00:18, 333.42it/s] 36%|███████████████████████████████████                                                              | 3524/9741 [00:11<00:18, 333.32it/s] 37%|███████████████████████████████████▍                                                             | 3558/9741 [00:11<00:18, 333.54it/s] 37%|███████████████████████████████████▊                                                             | 3592/9741 [00:11<00:18, 333.73it/s] 37%|████████████████████████████████████                                                             | 3626/9741 [00:11<00:18, 331.58it/s] 38%|████████████████████████████████████▍                                                            | 3660/9741 [00:11<00:18, 332.15it/s] 38%|████████████████████████████████████▊                                                            | 3694/9741 [00:11<00:18, 332.98it/s] 38%|█████████████████████████████████████                                                            | 3728/9741 [00:11<00:18, 333.75it/s] 39%|█████████████████████████████████████▍                                                           | 3762/9741 [00:11<00:17, 334.04it/s] 39%|█████████████████████████████████████▊                                                           | 3796/9741 [00:11<00:17, 334.20it/s] 39%|██████████████████████████████████████▏                                                          | 3830/9741 [00:12<00:17, 334.49it/s] 40%|██████████████████████████████████████▍                                                          | 3864/9741 [00:12<00:17, 332.10it/s] 40%|██████████████████████████████████████▊                                                          | 3898/9741 [00:12<00:17, 333.06it/s] 40%|███████████████████████████████████████▏                                                         | 3932/9741 [00:12<00:17, 333.44it/s] 41%|███████████████████████████████████████▍                                                         | 3966/9741 [00:12<00:17, 332.93it/s] 41%|███████████████████████████████████████▊                                                         | 4000/9741 [00:12<00:17, 333.37it/s] 41%|████████████████████████████████████████▏                                                        | 4034/9741 [00:12<00:17, 333.95it/s] 42%|████████████████████████████████████████▌                                                        | 4068/9741 [00:12<00:17, 331.94it/s] 42%|████████████████████████████████████████▊                                                        | 4102/9741 [00:12<00:16, 332.78it/s] 42%|█████████████████████████████████████████▏                                                       | 4136/9741 [00:12<00:16, 333.27it/s] 43%|█████████████████████████████████████████▌                                                       | 4170/9741 [00:13<00:16, 333.04it/s] 43%|█████████████████████████████████████████▊                                                       | 4204/9741 [00:13<00:16, 333.56it/s] 44%|██████████████████████████████████████████▏                                                      | 4238/9741 [00:13<00:16, 333.80it/s] 44%|██████████████████████████████████████████▌                                                      | 4272/9741 [00:13<00:16, 334.04it/s] 44%|██████████████████████████████████████████▉                                                      | 4306/9741 [00:13<00:16, 331.82it/s] 45%|███████████████████████████████████████████▏                                                     | 4340/9741 [00:13<00:16, 332.37it/s] 45%|███████████████████████████████████████████▌                                                     | 4374/9741 [00:13<00:16, 333.23it/s] 45%|███████████████████████████████████████████▉                                                     | 4408/9741 [00:13<00:15, 333.71it/s] 46%|████████████████████████████████████████████▏                                                    | 4442/9741 [00:13<00:15, 333.99it/s] 46%|████████████████████████████████████████████▌                                                    | 4476/9741 [00:13<00:15, 334.47it/s] 46%|████████████████████████████████████████████▉                                                    | 4510/9741 [00:14<00:15, 334.67it/s] 47%|█████████████████████████████████████████████▏                                                   | 4544/9741 [00:14<00:17, 302.67it/s] 47%|█████████████████████████████████████████████▌                                                   | 4578/9741 [00:14<00:16, 311.33it/s] 47%|█████████████████████████████████████████████▉                                                   | 4612/9741 [00:14<00:16, 317.91it/s] 48%|██████████████████████████████████████████████▎                                                  | 4646/9741 [00:14<00:15, 322.86it/s] 48%|██████████████████████████████████████████████▌                                                  | 4680/9741 [00:14<00:15, 326.44it/s] 48%|██████████████████████████████████████████████▉                                                  | 4714/9741 [00:14<00:15, 328.93it/s] 49%|███████████████████████████████████████████████▎                                                 | 4748/9741 [00:14<00:20, 237.97it/s] 49%|███████████████████████████████████████████████▌                                                 | 4782/9741 [00:15<00:19, 260.59it/s] 49%|███████████████████████████████████████████████▉                                                 | 4816/9741 [00:15<00:17, 279.12it/s] 50%|████████████████████████████████████████████████▎                                                | 4850/9741 [00:15<00:16, 292.72it/s] 50%|████████████████████████████████████████████████▋                                                | 4884/9741 [00:15<00:16, 303.41it/s] 50%|████████████████████████████████████████████████▉                                                | 4918/9741 [00:15<00:15, 311.88it/s] 51%|█████████████████████████████████████████████████▎                                               | 4951/9741 [00:15<00:15, 315.25it/s] 51%|█████████████████████████████████████████████████▋                                               | 4985/9741 [00:15<00:14, 320.26it/s] 52%|█████████████████████████████████████████████████▉                                               | 5019/9741 [00:15<00:14, 323.89it/s] 52%|██████████████████████████████████████████████████▎                                              | 5053/9741 [00:15<00:14, 326.41it/s] 52%|██████████████████████████████████████████████████▋                                              | 5087/9741 [00:16<00:14, 328.23it/s] 53%|██████████████████████████████████████████████████▉                                              | 5121/9741 [00:16<00:14, 329.87it/s] 53%|███████████████████████████████████████████████████▎                                             | 5155/9741 [00:16<00:13, 331.13it/s] 53%|███████████████████████████████████████████████████▋                                             | 5189/9741 [00:16<00:13, 328.62it/s] 54%|████████████████████████████████████████████████████                                             | 5223/9741 [00:16<00:13, 330.04it/s] 54%|████████████████████████████████████████████████████▎                                            | 5257/9741 [00:16<00:13, 328.24it/s] 54%|████████████████████████████████████████████████████▋                                            | 5291/9741 [00:16<00:13, 329.05it/s] 55%|█████████████████████████████████████████████████████                                            | 5325/9741 [00:16<00:13, 330.20it/s] 55%|█████████████████████████████████████████████████████▎                                           | 5359/9741 [00:16<00:13, 330.78it/s] 55%|█████████████████████████████████████████████████████▋                                           | 5393/9741 [00:16<00:13, 331.46it/s] 56%|██████████████████████████████████████████████████████                                           | 5427/9741 [00:17<00:13, 329.39it/s] 56%|██████████████████████████████████████████████████████▍                                          | 5461/9741 [00:17<00:12, 330.52it/s] 56%|██████████████████████████████████████████████████████▋                                          | 5495/9741 [00:17<00:12, 333.17it/s] 57%|███████████████████████████████████████████████████████                                          | 5530/9741 [00:17<00:12, 336.47it/s] 57%|███████████████████████████████████████████████████████▍                                         | 5565/9741 [00:17<00:12, 338.73it/s] 57%|███████████████████████████████████████████████████████▊                                         | 5600/9741 [00:17<00:12, 339.46it/s] 58%|████████████████████████████████████████████████████████                                         | 5634/9741 [00:17<00:12, 337.30it/s] 58%|████████████████████████████████████████████████████████▍                                        | 5669/9741 [00:17<00:12, 338.38it/s] 59%|████████████████████████████████████████████████████████▊                                        | 5704/9741 [00:17<00:11, 339.34it/s] 59%|█████████████████████████████████████████████████████████▏                                       | 5739/9741 [00:17<00:11, 340.33it/s] 59%|█████████████████████████████████████████████████████████▍                                       | 5774/9741 [00:18<00:11, 340.82it/s] 60%|█████████████████████████████████████████████████████████▊                                       | 5809/9741 [00:18<00:11, 338.74it/s] 60%|██████████████████████████████████████████████████████████▏                                      | 5844/9741 [00:18<00:11, 339.21it/s] 60%|██████████████████████████████████████████████████████████▌                                      | 5878/9741 [00:18<00:11, 337.43it/s] 61%|██████████████████████████████████████████████████████████▉                                      | 5913/9741 [00:18<00:11, 338.76it/s] 61%|███████████████████████████████████████████████████████████▏                                     | 5948/9741 [00:18<00:11, 339.53it/s] 61%|███████████████████████████████████████████████████████████▌                                     | 5983/9741 [00:18<00:11, 340.85it/s] 62%|███████████████████████████████████████████████████████████▉                                     | 6018/9741 [00:18<00:10, 341.70it/s] 62%|████████████████████████████████████████████████████████████▎                                    | 6053/9741 [00:18<00:10, 342.68it/s] 62%|████████████████████████████████████████████████████████████▌                                    | 6088/9741 [00:18<00:10, 340.75it/s] 63%|████████████████████████████████████████████████████████████▉                                    | 6123/9741 [00:19<00:10, 341.48it/s] 63%|█████████████████████████████████████████████████████████████▎                                   | 6158/9741 [00:19<00:10, 341.89it/s] 64%|█████████████████████████████████████████████████████████████▋                                   | 6193/9741 [00:19<00:10, 342.55it/s] 64%|██████████████████████████████████████████████████████████████                                   | 6228/9741 [00:19<00:10, 342.65it/s] 64%|██████████████████████████████████████████████████████████████▎                                  | 6263/9741 [00:19<00:10, 342.69it/s] 65%|██████████████████████████████████████████████████████████████▋                                  | 6298/9741 [00:19<00:10, 342.88it/s] 65%|███████████████████████████████████████████████████████████████                                  | 6333/9741 [00:19<00:10, 340.43it/s] 65%|███████████████████████████████████████████████████████████████▍                                 | 6368/9741 [00:19<00:09, 341.47it/s] 66%|███████████████████████████████████████████████████████████████▊                                 | 6403/9741 [00:19<00:09, 339.59it/s] 66%|████████████████████████████████████████████████████████████████                                 | 6438/9741 [00:19<00:09, 340.92it/s] 66%|████████████████████████████████████████████████████████████████▍                                | 6473/9741 [00:20<00:09, 341.54it/s] 67%|████████████████████████████████████████████████████████████████▊                                | 6508/9741 [00:20<00:09, 341.88it/s] 67%|█████████████████████████████████████████████████████████████████▏                               | 6543/9741 [00:20<00:09, 339.68it/s] 68%|█████████████████████████████████████████████████████████████████▌                               | 6578/9741 [00:20<00:09, 340.71it/s] 68%|█████████████████████████████████████████████████████████████████▊                               | 6613/9741 [00:20<00:09, 341.25it/s] 68%|██████████████████████████████████████████████████████████████████▏                              | 6648/9741 [00:20<00:09, 341.76it/s] 69%|██████████████████████████████████████████████████████████████████▌                              | 6683/9741 [00:20<00:08, 342.24it/s] 69%|██████████████████████████████████████████████████████████████████▉                              | 6718/9741 [00:20<00:08, 342.59it/s] 69%|███████████████████████████████████████████████████████████████████▏                             | 6753/9741 [00:20<00:08, 343.13it/s] 70%|███████████████████████████████████████████████████████████████████▌                             | 6788/9741 [00:21<00:08, 341.18it/s] 70%|███████████████████████████████████████████████████████████████████▉                             | 6823/9741 [00:21<00:08, 341.86it/s] 70%|████████████████████████████████████████████████████████████████████▎                            | 6858/9741 [00:21<00:08, 342.27it/s] 71%|████████████████████████████████████████████████████████████████████▋                            | 6893/9741 [00:21<00:08, 342.84it/s] 71%|████████████████████████████████████████████████████████████████████▉                            | 6928/9741 [00:21<00:08, 343.29it/s] 71%|█████████████████████████████████████████████████████████████████████▎                           | 6963/9741 [00:21<00:08, 343.59it/s] 72%|█████████████████████████████████████████████████████████████████████▋                           | 6998/9741 [00:21<00:08, 335.84it/s] 72%|██████████████████████████████████████████████████████████████████████                           | 7033/9741 [00:21<00:08, 338.29it/s] 73%|██████████████████████████████████████████████████████████████████████▍                          | 7068/9741 [00:21<00:07, 340.36it/s] 73%|██████████████████████████████████████████████████████████████████████▋                          | 7103/9741 [00:21<00:07, 341.60it/s] 73%|███████████████████████████████████████████████████████████████████████                          | 7138/9741 [00:22<00:07, 342.31it/s] 74%|███████████████████████████████████████████████████████████████████████▍                         | 7173/9741 [00:22<00:07, 342.72it/s] 74%|███████████████████████████████████████████████████████████████████████▊                         | 7208/9741 [00:22<00:07, 343.29it/s] 74%|████████████████████████████████████████████████████████████████████████▏                        | 7243/9741 [00:22<00:07, 341.15it/s] 75%|████████████████████████████████████████████████████████████████████████▍                        | 7278/9741 [00:22<00:07, 341.83it/s] 75%|████████████████████████████████████████████████████████████████████████▊                        | 7313/9741 [00:22<00:07, 342.56it/s] 75%|█████████████████████████████████████████████████████████████████████████▏                       | 7348/9741 [00:22<00:06, 343.18it/s] 76%|█████████████████████████████████████████████████████████████████████████▌                       | 7383/9741 [00:22<00:06, 343.85it/s] 76%|█████████████████████████████████████████████████████████████████████████▊                       | 7418/9741 [00:22<00:06, 344.27it/s] 77%|██████████████████████████████████████████████████████████████████████████▏                      | 7453/9741 [00:23<00:07, 294.05it/s] 77%|██████████████████████████████████████████████████████████████████████████▌                      | 7488/9741 [00:23<00:07, 307.41it/s] 77%|██████████████████████████████████████████████████████████████████████████▉                      | 7523/9741 [00:23<00:06, 317.26it/s] 78%|███████████████████████████████████████████████████████████████████████████▎                     | 7557/9741 [00:23<00:06, 322.25it/s] 78%|███████████████████████████████████████████████████████████████████████████▌                     | 7592/9741 [00:23<00:06, 328.40it/s] 78%|███████████████████████████████████████████████████████████████████████████▉                     | 7627/9741 [00:23<00:06, 333.23it/s] 79%|████████████████████████████████████████████████████████████████████████████▎                    | 7662/9741 [00:23<00:06, 336.31it/s] 79%|████████████████████████████████████████████████████████████████████████████▋                    | 7696/9741 [00:23<00:06, 336.37it/s] 79%|████████████████████████████████████████████████████████████████████████████▉                    | 7731/9741 [00:23<00:05, 339.15it/s] 80%|█████████████████████████████████████████████████████████████████████████████▎                   | 7766/9741 [00:23<00:05, 340.73it/s] 80%|█████████████████████████████████████████████████████████████████████████████▋                   | 7801/9741 [00:24<00:05, 341.75it/s] 80%|██████████████████████████████████████████████████████████████████████████████                   | 7836/9741 [00:24<00:05, 342.65it/s] 81%|██████████████████████████████████████████████████████████████████████████████▍                  | 7871/9741 [00:24<00:05, 342.77it/s] 81%|██████████████████████████████████████████████████████████████████████████████▋                  | 7906/9741 [00:24<00:05, 340.84it/s] 82%|███████████████████████████████████████████████████████████████████████████████                  | 7941/9741 [00:24<00:05, 341.49it/s] 82%|███████████████████████████████████████████████████████████████████████████████▍                 | 7976/9741 [00:24<00:05, 342.24it/s] 82%|███████████████████████████████████████████████████████████████████████████████▊                 | 8011/9741 [00:24<00:05, 342.62it/s] 83%|████████████████████████████████████████████████████████████████████████████████                 | 8046/9741 [00:24<00:04, 342.97it/s] 83%|████████████████████████████████████████████████████████████████████████████████▍                | 8081/9741 [00:24<00:04, 343.23it/s] 83%|████████████████████████████████████████████████████████████████████████████████▊                | 8116/9741 [00:24<00:04, 341.96it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▏               | 8151/9741 [00:25<00:04, 340.06it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▌               | 8186/9741 [00:25<00:04, 341.12it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▊               | 8221/9741 [00:25<00:04, 342.11it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▏              | 8256/9741 [00:25<00:04, 342.72it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▌              | 8291/9741 [00:25<00:04, 342.52it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▉              | 8326/9741 [00:25<00:04, 342.78it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▎             | 8361/9741 [00:25<00:04, 340.78it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▌             | 8396/9741 [00:25<00:03, 341.70it/s] 87%|███████████████████████████████████████████████████████████████████████████████████▉             | 8431/9741 [00:25<00:03, 342.38it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▎            | 8466/9741 [00:25<00:03, 342.45it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▋            | 8501/9741 [00:26<00:03, 342.76it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████            | 8536/9741 [00:26<00:03, 342.62it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▎           | 8571/9741 [00:26<00:03, 342.50it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▋           | 8606/9741 [00:26<00:03, 340.18it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████           | 8641/9741 [00:26<00:03, 341.08it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▍          | 8676/9741 [00:26<00:03, 341.66it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▋          | 8711/9741 [00:26<00:03, 342.52it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████          | 8746/9741 [00:26<00:02, 342.68it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▍         | 8781/9741 [00:26<00:02, 342.72it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████▊         | 8816/9741 [00:27<00:02, 340.36it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▏        | 8851/9741 [00:27<00:02, 341.21it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▍        | 8886/9741 [00:27<00:02, 339.69it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████▊        | 8921/9741 [00:27<00:02, 340.92it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▏       | 8956/9741 [00:27<00:02, 341.57it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▌       | 8991/9741 [00:27<00:02, 341.88it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████████▉       | 9026/9741 [00:27<00:02, 342.36it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▏      | 9061/9741 [00:27<00:01, 340.07it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▌      | 9096/9741 [00:27<00:01, 340.87it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████████▉      | 9131/9741 [00:27<00:01, 341.60it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▎     | 9166/9741 [00:28<00:01, 342.18it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▌     | 9201/9741 [00:28<00:01, 342.85it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████▉     | 9236/9741 [00:28<00:01, 342.99it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▎    | 9271/9741 [00:28<00:01, 341.13it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▋    | 9306/9741 [00:28<00:01, 341.47it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████    | 9341/9741 [00:28<00:01, 342.05it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▎   | 9376/9741 [00:28<00:01, 342.39it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▋   | 9411/9741 [00:28<00:00, 342.50it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████   | 9446/9741 [00:28<00:00, 342.82it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████▍  | 9481/9741 [00:28<00:00, 343.29it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▊  | 9516/9741 [00:29<00:00, 341.11it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████  | 9551/9741 [00:29<00:00, 341.95it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████▍ | 9586/9741 [00:29<00:00, 342.17it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▊ | 9621/9741 [00:29<00:00, 341.92it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▏| 9656/9741 [00:29<00:00, 341.97it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▌| 9691/9741 [00:29<00:00, 342.16it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████▊| 9726/9741 [00:29<00:00, 339.67it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:29<00:00, 327.81it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:04<00:09,  4.93s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.24s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.50s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:09<00:04,  4.83s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.27s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.30s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.39s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.24s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.41s/it]
[2023-08-17 21:34:33,693] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.86s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
[2023-08-17 21:34:44,400] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-17 21:34:44,401] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-17 21:34:44,402] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-17 21:34:44,402] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-17 21:34:44,402] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-17 21:34:44,402] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-17 21:34:44,402] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-17 21:34:44,402] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-17 21:34:44,402] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-17 21:34:44,402] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-17 21:34:44,402] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f11bb36ee80>
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-17 21:34:44,403] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f11bb36edc0>
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-17 21:34:44,404] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-17 21:34:44,404] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.545245885848999 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5046708583831787 seconds
Time to load utils op: 0.5048775672912598 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
So the final answer is 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
So the final answer is 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: Max finished history in 20 * 2 = <<20*2=40>>40 minutes.
Finishing geography took the most time, which is 40 * 3 = <<40*3=120>>120 minutes.
In total, for all three subjects, Max needed 20 + 40 + 120 = <<20+40+120=180>>180 minutes.
So the final answer is 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: If Sophia ate 1/6 of the pie, then 6/6 - 1/6 = 5/6 is left in the fridge.
Let x be the pie's original weight.
The current weight of the pie can be described by 5x/6=1200 grams
So, 5x=7200.
And, the original weight is x = <<1440=1440>>1440 grams.
So, Sophia ate 1440 grams original - 1200 grams after= <<1440-1200=240>>240 grams of pie.
So the final answer is 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: After using the coupon, the final price comes to 67 - 4 = <<67-4=63>>63 dollars.
With three people, they each need to pay 63 / 3 = <<63/3=21>>21 dollars each.
So the final answer is 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: If in six years Tom's brother will be 30 years old, he is currently 30-6 = <<30-6=24>>24 years old.
Since Tom's brother is 4 times as old as Tom's dog, Tom's dog is 24/4 = <<24/4=6>>6 years old currently.
Tom's dog will be 6+6 = <<6+6=12>>12 years old in six years.
So the final answer is 12

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o9-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.6047623157501221 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:41<33:55, 41.55s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:22<32:46, 40.97s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:02<31:57, 40.81s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [02:43<31:12, 40.70s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:23<30:31, 40.70s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:04<29:45, 40.59s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [04:44<29:02, 40.52s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [05:25<28:23, 40.56s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [06:06<27:44, 40.59s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [06:47<27:13, 40.84s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [07:28<26:31, 40.81s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [08:08<25:48, 40.75s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [08:49<25:07, 40.73s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [09:30<24:26, 40.74s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [10:10<23:45, 40.72s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [10:51<23:06, 40.77s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [11:32<22:24, 40.73s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [12:13<21:43, 40.73s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [12:53<21:01, 40.69s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [13:34<20:21, 40.72s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [14:15<19:41, 40.75s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [14:55<18:59, 40.69s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [15:36<18:18, 40.68s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [16:17<17:37, 40.68s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [16:58<16:58, 40.75s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [17:38<16:17, 40.71s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [18:19<15:37, 40.76s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [19:00<14:56, 40.77s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [19:41<14:16, 40.79s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [20:22<13:36, 40.82s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [20:58<12:30, 39.49s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [21:39<11:58, 39.93s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [22:20<11:23, 40.18s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [23:01<10:46, 40.40s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [23:41<10:07, 40.47s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [24:22<09:27, 40.57s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [25:03<08:48, 40.66s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [25:44<08:08, 40.69s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [26:25<07:27, 40.73s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [27:05<06:47, 40.74s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [27:46<06:06, 40.73s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [28:27<05:25, 40.73s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [29:08<04:45, 40.81s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [29:49<04:05, 40.85s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [30:29<03:24, 40.81s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [31:10<02:43, 40.78s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [31:51<02:02, 40.84s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [32:32<01:21, 40.82s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [33:13<00:40, 40.81s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [33:54<00:00, 40.84s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [33:54<00:00, 40.68s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 2.7774} | lm_loss nan | avg. gen lenth: 377.488
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-17 22:08:51,776] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  3%|██▊                                                                                              | 285/9741 [00:00<00:03, 2847.67it/s]  6%|█████▋                                                                                           | 575/9741 [00:00<00:03, 2877.57it/s]  9%|████████▋                                                                                        | 869/9741 [00:00<00:03, 2901.49it/s] 12%|███████████▍                                                                                    | 1163/9741 [00:00<00:02, 2916.16it/s] 15%|██████████████▎                                                                                 | 1455/9741 [00:00<00:02, 2914.80it/s] 18%|█████████████████▏                                                                              | 1747/9741 [00:00<00:02, 2913.40it/s] 21%|████████████████████                                                                            | 2039/9741 [00:00<00:02, 2880.27it/s] 24%|██████████████████████▉                                                                         | 2329/9741 [00:00<00:02, 2885.51it/s] 27%|█████████████████████████▊                                                                      | 2618/9741 [00:00<00:02, 2839.08it/s] 30%|████████████████████████████▌                                                                   | 2903/9741 [00:01<00:02, 2838.03it/s] 33%|███████████████████████████████▍                                                                | 3193/9741 [00:01<00:02, 2856.14it/s] 36%|██████████████████████████████████▎                                                             | 3484/9741 [00:01<00:02, 2869.50it/s] 39%|█████████████████████████████████████▏                                                          | 3774/9741 [00:01<00:02, 2878.32it/s] 42%|████████████████████████████████████████▌                                                       | 4118/9741 [00:01<00:01, 3045.54it/s] 47%|████████████████████████████████████████████▊                                                   | 4549/9741 [00:01<00:01, 3423.52it/s] 50%|████████████████████████████████████████████████▏                                               | 4892/9741 [00:01<00:01, 2898.37it/s] 55%|████████████████████████████████████████████████████▌                                           | 5330/9741 [00:01<00:01, 3291.10it/s] 59%|████████████████████████████████████████████████████████▉                                       | 5779/9741 [00:01<00:01, 3619.60it/s] 64%|█████████████████████████████████████████████████████████████▍                                  | 6236/9741 [00:01<00:00, 3886.53it/s] 69%|█████████████████████████████████████████████████████████████████▉                              | 6691/9741 [00:02<00:00, 4075.39it/s] 73%|██████████████████████████████████████████████████████████████████████▌                         | 7158/9741 [00:02<00:00, 4246.37it/s] 78%|██████████████████████████████████████████████████████████████████████████▉                     | 7609/9741 [00:02<00:00, 4322.56it/s] 83%|███████████████████████████████████████████████████████████████████████████████▌                | 8074/9741 [00:02<00:00, 4419.18it/s] 88%|████████████████████████████████████████████████████████████████████████████████████▏           | 8541/9741 [00:02<00:00, 4491.82it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████▋       | 9005/9741 [00:02<00:00, 4534.03it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▎  | 9463/9741 [00:02<00:00, 4546.88it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:02<00:00, 3562.91it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.05s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.14s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.59s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.30s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.04s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.07s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.39s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.52s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.43s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.59s/it]
[2023-08-17 22:09:45,585] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.44s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.62s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.83s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.99s/it]
[2023-08-17 22:10:00,152] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-17 22:10:00,153] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f2655b92e80>
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-17 22:10:00,153] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f2655b92dc0>
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-17 22:10:00,154] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-17 22:10:00,154] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.33347272872924805 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.20428109169006348 seconds
Loading extension module utils...
Time to load utils op: 0.20401287078857422 seconds
Loading extension module utils...
Time to load utils op: 0.30426931381225586 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:58<48:06, 58.91s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:41<39:24, 49.26s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:40<42:04, 53.71s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:38<42:38, 55.63s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:38<42:44, 56.98s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [05:35<41:47, 56.99s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [06:33<41:03, 57.30s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [07:30<40:06, 57.29s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [08:27<39:06, 57.24s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [09:25<38:21, 57.53s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [10:24<37:32, 57.75s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [11:21<36:34, 57.75s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [12:19<35:40, 57.85s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [13:17<34:43, 57.87s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [13:59<30:52, 52.92s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [14:58<30:58, 54.67s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [15:56<30:38, 55.70s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [16:54<30:03, 56.36s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [17:51<29:19, 56.76s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [18:48<28:19, 56.64s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [19:45<27:28, 56.84s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [20:43<26:39, 57.13s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [21:40<25:41, 57.11s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [22:37<24:48, 57.25s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [23:36<24:04, 57.78s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [24:23<21:44, 54.35s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [25:21<21:16, 55.49s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [26:19<20:37, 56.24s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [27:17<19:54, 56.89s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [28:15<19:01, 57.08s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [29:13<18:09, 57.36s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [30:11<17:19, 57.73s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [30:59<15:30, 54.75s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [31:45<13:53, 52.11s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [32:23<11:57, 47.83s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [33:00<10:26, 44.73s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [33:58<10:30, 48.47s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [34:56<10:17, 51.44s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [35:54<09:48, 53.49s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [36:41<08:35, 51.52s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [37:22<07:14, 48.33s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [38:20<06:50, 51.30s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [39:18<06:13, 53.34s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [40:12<05:20, 53.50s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [41:10<04:33, 54.73s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [42:09<03:43, 55.92s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [43:07<02:50, 56.72s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [44:06<01:54, 57.22s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [45:03<00:57, 57.31s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [45:59<00:00, 57.02s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [45:59<00:00, 55.20s/it]
name: commonsenseqa | {'exact_match': 0.8, 'rougeL': 2.9078} | lm_loss 7.9761 | avg. gen lenth: 270.564
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-17 22:56:06,050] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  2%|█▌                                                                                               | 151/9741 [00:00<00:06, 1506.27it/s]  3%|███                                                                                              | 303/9741 [00:00<00:06, 1509.45it/s]  5%|████▌                                                                                            | 455/9741 [00:00<00:06, 1513.06it/s]  6%|██████                                                                                           | 608/9741 [00:00<00:06, 1519.49it/s]  8%|███████▌                                                                                         | 761/9741 [00:00<00:05, 1521.15it/s]  9%|█████████                                                                                        | 915/9741 [00:00<00:05, 1524.80it/s] 11%|██████████▌                                                                                     | 1070/9741 [00:00<00:05, 1530.60it/s] 13%|████████████                                                                                    | 1224/9741 [00:00<00:05, 1529.32it/s] 14%|█████████████▌                                                                                  | 1377/9741 [00:00<00:05, 1495.01it/s] 16%|███████████████                                                                                 | 1529/9741 [00:01<00:05, 1499.45it/s] 17%|████████████████▌                                                                               | 1682/9741 [00:01<00:05, 1508.62it/s] 19%|██████████████████                                                                              | 1833/9741 [00:01<00:05, 1481.14it/s] 20%|███████████████████▌                                                                            | 1985/9741 [00:01<00:05, 1491.04it/s] 22%|█████████████████████                                                                           | 2135/9741 [00:01<00:05, 1493.49it/s] 23%|██████████████████████▌                                                                         | 2288/9741 [00:01<00:04, 1501.93it/s] 25%|████████████████████████                                                                        | 2441/9741 [00:01<00:04, 1508.29it/s] 27%|█████████████████████████▌                                                                      | 2593/9741 [00:01<00:04, 1509.74it/s] 29%|███████████████████████████▌                                                                    | 2800/9741 [00:01<00:04, 1675.68it/s] 31%|█████████████████████████████▊                                                                  | 3029/9741 [00:01<00:03, 1858.00it/s] 33%|████████████████████████████████                                                                | 3259/9741 [00:02<00:03, 1988.59it/s] 36%|██████████████████████████████████▍                                                             | 3489/9741 [00:02<00:03, 2078.93it/s] 38%|████████████████████████████████████▋                                                           | 3719/9741 [00:02<00:02, 2142.78it/s] 41%|██████████████████████████████████████▉                                                         | 3951/9741 [00:02<00:02, 2193.62it/s] 43%|█████████████████████████████████████████▏                                                      | 4182/9741 [00:02<00:02, 2225.55it/s] 45%|███████████████████████████████████████████▍                                                    | 4413/9741 [00:02<00:02, 2248.76it/s] 48%|█████████████████████████████████████████████▋                                                  | 4638/9741 [00:02<00:02, 2222.06it/s] 50%|███████████████████████████████████████████████▉                                                | 4861/9741 [00:02<00:02, 1804.02it/s] 52%|██████████████████████████████████████████████████▏                                             | 5090/9741 [00:02<00:02, 1926.92it/s] 55%|████████████████████████████████████████████████████▍                                           | 5319/9741 [00:03<00:02, 2023.98it/s] 57%|██████████████████████████████████████████████████████▋                                         | 5551/9741 [00:03<00:01, 2103.86it/s] 59%|█████████████████████████████████████████████████████████                                       | 5784/9741 [00:03<00:01, 2165.63it/s] 62%|███████████████████████████████████████████████████████████▎                                    | 6023/9741 [00:03<00:01, 2229.65it/s] 64%|█████████████████████████████████████████████████████████████▋                                  | 6257/9741 [00:03<00:01, 2261.28it/s] 67%|████████████████████████████████████████████████████████████████                                | 6497/9741 [00:03<00:01, 2301.60it/s] 69%|██████████████████████████████████████████████████████████████████▎                             | 6730/9741 [00:03<00:01, 2259.81it/s] 72%|████████████████████████████████████████████████████████████████████▋                           | 6972/9741 [00:03<00:01, 2305.68it/s] 74%|███████████████████████████████████████████████████████████████████████                         | 7214/9741 [00:03<00:01, 2338.87it/s] 76%|█████████████████████████████████████████████████████████████████████████▍                      | 7449/9741 [00:03<00:00, 2327.99it/s] 79%|███████████████████████████████████████████████████████████████████████████▊                    | 7690/9741 [00:04<00:00, 2352.07it/s] 81%|██████████████████████████████████████████████████████████████████████████████▏                 | 7934/9741 [00:04<00:00, 2375.88it/s] 84%|████████████████████████████████████████████████████████████████████████████████▌               | 8178/9741 [00:04<00:00, 2394.58it/s] 86%|██████████████████████████████████████████████████████████████████████████████████▉             | 8421/9741 [00:04<00:00, 2404.99it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▍          | 8664/9741 [00:04<00:00, 2410.93it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████▊        | 8906/9741 [00:04<00:00, 2380.11it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████████▏     | 9148/9741 [00:04<00:00, 2390.03it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▌   | 9390/9741 [00:04<00:00, 2396.79it/s] 99%|██████████████████████████████████████████████████████████████████████████████████████████████▉ | 9631/9741 [00:04<00:00, 2400.18it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:04<00:00, 2000.97it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.03s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.35s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.53s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:09<00:04,  4.86s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.22s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.50s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.54s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.25s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.43s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.57s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.88s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.05s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.87s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.04s/it]
[2023-08-17 22:57:03,670] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-17 22:57:15,290] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-17 22:57:15,291] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-17 22:57:15,291] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-17 22:57:15,291] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-17 22:57:15,291] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-17 22:57:15,291] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fa66143de80>
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fa66143ddc0>
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-17 22:57:15,292] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-17 22:57:15,293] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-17 22:57:15,293] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-17 22:57:15,293] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-17 22:57:15,293] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-17 22:57:15,293] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-17 22:57:15,293] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-17 22:57:15,293] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-17 22:57:15,293] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-17 22:57:15,293] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-17 22:57:15,293] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-17 22:57:15,293] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.3699774742126465 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Time to load utils op: 0.3042609691619873 seconds
Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.30438923835754395 seconds
Loading extension module utils...
Time to load utils op: 0.4044833183288574 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:56<45:46, 56.05s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:51<44:25, 55.52s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:46<43:27, 55.47s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:41<42:28, 55.40s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:38<41:45, 55.68s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [05:16<36:37, 49.95s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:59<34:08, 47.63s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:53<34:48, 49.72s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [07:48<34:59, 51.21s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [08:45<35:20, 53.02s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [09:41<35:06, 54.02s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [10:08<28:55, 45.68s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [11:03<29:58, 48.60s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [11:59<30:31, 50.89s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [12:54<30:21, 52.03s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [13:49<30:02, 53.03s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [14:45<29:34, 53.79s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [15:40<28:55, 54.22s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [16:34<27:58, 54.14s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [17:28<27:05, 54.19s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [18:25<26:31, 54.87s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [19:21<25:50, 55.36s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [20:16<24:44, 55.00s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [20:51<21:17, 49.15s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [21:47<21:19, 51.18s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [22:43<21:04, 52.68s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [23:39<20:32, 53.58s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [24:35<19:54, 54.31s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [25:30<19:04, 54.49s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [26:19<17:35, 52.78s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [26:46<14:15, 45.04s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [27:21<12:37, 42.10s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [28:15<12:57, 45.73s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [29:10<12:54, 48.38s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [30:05<12:38, 50.60s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [31:02<12:13, 52.40s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [31:57<11:33, 53.31s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [32:53<10:47, 53.99s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [33:48<09:57, 54.33s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [34:43<09:04, 54.44s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [35:11<06:59, 46.65s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [35:55<06:05, 45.64s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [36:50<05:39, 48.47s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [37:34<04:44, 47.38s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [38:30<04:08, 49.70s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [39:26<03:26, 51.60s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [40:00<02:19, 46.34s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [40:56<01:38, 49.25s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [41:51<00:50, 50.98s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [42:37<00:00, 49.63s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [42:37<00:00, 51.15s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.2216} | lm_loss 7.9506 | avg. gen lenth: 256.284
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-17 23:40:25,108] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|█▏                                                                                               | 122/9741 [00:00<00:07, 1216.95it/s]  3%|██▍                                                                                              | 245/9741 [00:00<00:07, 1222.66it/s]  4%|███▋                                                                                             | 369/9741 [00:00<00:07, 1228.90it/s]  5%|████▉                                                                                            | 492/9741 [00:00<00:07, 1228.56it/s]  6%|██████▏                                                                                          | 616/9741 [00:00<00:07, 1230.39it/s]  8%|███████▎                                                                                         | 740/9741 [00:00<00:07, 1230.72it/s]  9%|████████▌                                                                                        | 865/9741 [00:00<00:07, 1236.14it/s] 10%|█████████▊                                                                                       | 989/9741 [00:00<00:07, 1234.84it/s] 11%|██████████▉                                                                                     | 1113/9741 [00:00<00:07, 1209.11it/s] 13%|████████████▏                                                                                   | 1236/9741 [00:01<00:07, 1212.89it/s] 14%|█████████████▍                                                                                  | 1359/9741 [00:01<00:06, 1217.76it/s] 15%|██████████████▌                                                                                 | 1483/9741 [00:01<00:06, 1222.27it/s] 16%|███████████████▊                                                                                | 1606/9741 [00:01<00:06, 1222.68it/s] 18%|█████████████████                                                                               | 1730/9741 [00:01<00:06, 1226.37it/s] 19%|██████████████████▎                                                                             | 1853/9741 [00:01<00:06, 1199.21it/s] 20%|███████████████████▍                                                                            | 1977/9741 [00:01<00:06, 1208.35it/s] 22%|████████████████████▋                                                                           | 2099/9741 [00:01<00:06, 1210.90it/s] 23%|█████████████████████▉                                                                          | 2223/9741 [00:01<00:06, 1217.45it/s] 24%|███████████████████████                                                                         | 2345/9741 [00:01<00:06, 1214.13it/s] 25%|████████████████████████▎                                                                       | 2469/9741 [00:02<00:05, 1219.26it/s] 27%|█████████████████████████▌                                                                      | 2592/9741 [00:02<00:05, 1221.64it/s] 28%|██████████████████████████▊                                                                     | 2715/9741 [00:02<00:05, 1222.39it/s] 30%|████████████████████████████▍                                                                   | 2891/9741 [00:02<00:04, 1382.87it/s] 32%|██████████████████████████████▎                                                                 | 3078/9741 [00:02<00:04, 1528.50it/s] 34%|████████████████████████████████▏                                                               | 3266/9741 [00:02<00:03, 1632.05it/s] 35%|██████████████████████████████████                                                              | 3451/9741 [00:02<00:03, 1695.71it/s] 37%|███████████████████████████████████▊                                                            | 3638/9741 [00:02<00:03, 1745.47it/s] 39%|█████████████████████████████████████▋                                                          | 3827/9741 [00:02<00:03, 1786.17it/s] 41%|███████████████████████████████████████▌                                                        | 4015/9741 [00:02<00:03, 1811.38it/s] 43%|█████████████████████████████████████████▍                                                      | 4203/9741 [00:03<00:03, 1829.20it/s] 45%|███████████████████████████████████████████▎                                                    | 4391/9741 [00:03<00:02, 1842.96it/s] 47%|█████████████████████████████████████████████                                                   | 4576/9741 [00:03<00:02, 1814.02it/s] 49%|██████████████████████████████████████████████▉                                                 | 4758/9741 [00:03<00:03, 1397.91it/s] 51%|████████████████████████████████████████████████▋                                               | 4945/9741 [00:03<00:03, 1512.05it/s] 53%|██████████████████████████████████████████████████▌                                             | 5133/9741 [00:03<00:02, 1607.17it/s] 55%|████████████████████████████████████████████████████▍                                           | 5320/9741 [00:03<00:02, 1677.35it/s] 57%|██████████████████████████████████████████████████████▎                                         | 5509/9741 [00:03<00:02, 1736.41it/s] 59%|████████████████████████████████████████████████████████▏                                       | 5705/9741 [00:03<00:02, 1799.54it/s] 61%|██████████████████████████████████████████████████████████▏                                     | 5901/9741 [00:04<00:02, 1843.76it/s] 63%|████████████████████████████████████████████████████████████                                    | 6098/9741 [00:04<00:01, 1878.92it/s] 65%|██████████████████████████████████████████████████████████████                                  | 6295/9741 [00:04<00:01, 1903.57it/s] 67%|███████████████████████████████████████████████████████████████▉                                | 6491/9741 [00:04<00:01, 1919.59it/s] 69%|█████████████████████████████████████████████████████████████████▉                              | 6686/9741 [00:04<00:01, 1928.23it/s] 71%|███████████████████████████████████████████████████████████████████▊                            | 6883/9741 [00:04<00:01, 1938.72it/s] 73%|█████████████████████████████████████████████████████████████████████▊                          | 7080/9741 [00:04<00:01, 1945.92it/s] 75%|███████████████████████████████████████████████████████████████████████▋                        | 7276/9741 [00:04<00:01, 1949.83it/s] 77%|█████████████████████████████████████████████████████████████████████████▋                      | 7472/9741 [00:04<00:01, 1921.45it/s] 79%|███████████████████████████████████████████████████████████████████████████▌                    | 7668/9741 [00:04<00:01, 1927.55it/s] 81%|█████████████████████████████████████████████████████████████████████████████▌                  | 7866/9741 [00:05<00:00, 1940.17it/s] 83%|███████████████████████████████████████████████████████████████████████████████▍                | 8063/9741 [00:05<00:00, 1947.07it/s] 85%|█████████████████████████████████████████████████████████████████████████████████▍              | 8260/9741 [00:05<00:00, 1952.74it/s] 87%|███████████████████████████████████████████████████████████████████████████████████▎            | 8456/9741 [00:05<00:00, 1954.85it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▎          | 8652/9741 [00:05<00:00, 1956.05it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████▏        | 8848/9741 [00:05<00:00, 1954.78it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████████▏      | 9044/9741 [00:05<00:00, 1956.25it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████     | 9240/9741 [00:05<00:00, 1953.30it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████▉   | 9436/9741 [00:05<00:00, 1937.48it/s] 99%|██████████████████████████████████████████████████████████████████████████████████████████████▉ | 9631/9741 [00:05<00:00, 1939.95it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:06<00:00, 1621.89it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.12s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.45s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.52s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:09<00:04,  4.97s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:09<00:04,  4.92s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.39s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.56s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.31s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.49s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.89s/it]
[2023-08-17 23:41:23,004] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.94s/it]
[2023-08-17 23:41:32,374] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-17 23:41:32,375] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-17 23:41:32,375] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-17 23:41:32,375] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-17 23:41:32,375] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-17 23:41:32,375] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f0b0042be80>
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f0b0042bdc0>
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-17 23:41:32,376] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-17 23:41:32,377] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-17 23:41:32,377] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3844318389892578 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.3041515350341797 seconds
Loading extension module utils...
Time to load utils op: 0.30576419830322266 seconds
Loading extension module utils...
Time to load utils op: 0.4045727252960205 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:53<43:51, 53.70s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:46<42:43, 53.40s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:39<41:36, 53.13s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:33<40:49, 53.24s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:27<40:08, 53.52s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [05:20<39:06, 53.33s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [06:14<38:34, 53.83s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [07:09<37:48, 54.01s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [08:03<36:50, 53.92s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [08:48<34:09, 51.24s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [09:42<33:49, 52.05s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [10:36<33:27, 52.83s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [11:09<28:49, 46.75s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [12:04<29:34, 49.29s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [12:58<29:30, 50.59s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [13:51<29:11, 51.50s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [14:46<28:46, 52.33s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [15:17<24:36, 46.14s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [15:50<21:41, 41.98s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [16:44<22:45, 45.53s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [17:37<23:13, 48.05s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [18:30<23:03, 49.42s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [19:23<22:42, 50.46s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [20:15<22:05, 51.00s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [21:09<21:38, 51.92s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [22:02<20:54, 52.28s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [22:57<20:17, 52.94s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [23:51<19:31, 53.26s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [24:46<18:48, 53.73s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [25:10<14:58, 44.94s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [26:05<15:09, 47.87s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [26:57<14:47, 49.30s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [27:18<11:33, 40.79s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [28:12<11:53, 44.58s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [29:05<11:45, 47.01s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [29:32<09:34, 41.03s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [30:25<09:41, 44.74s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [31:19<09:29, 47.45s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [32:07<08:44, 47.70s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [33:01<08:14, 49.49s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [33:55<07:38, 50.95s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [34:49<06:54, 51.79s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [35:43<06:08, 52.62s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [36:37<05:17, 52.96s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [37:32<04:27, 53.49s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [38:25<03:34, 53.54s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [39:20<02:41, 53.89s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [40:14<01:48, 54.00s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [41:07<00:53, 53.66s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [42:02<00:00, 53.86s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [42:02<00:00, 50.44s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.5494} | lm_loss 7.9488 | avg. gen lenth: 267.024
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 00:25:24,283] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|█                                                                                                | 105/9741 [00:00<00:09, 1048.88it/s]  2%|██                                                                                               | 210/9741 [00:00<00:09, 1048.08it/s]  3%|███▏                                                                                             | 317/9741 [00:00<00:08, 1053.54it/s]  4%|████▏                                                                                            | 423/9741 [00:00<00:08, 1055.48it/s]  5%|█████▎                                                                                           | 529/9741 [00:00<00:08, 1054.61it/s]  7%|██████▎                                                                                          | 635/9741 [00:00<00:08, 1055.77it/s]  8%|███████▍                                                                                         | 741/9741 [00:00<00:08, 1054.76it/s]  9%|████████▍                                                                                        | 847/9741 [00:00<00:08, 1040.83it/s] 10%|█████████▍                                                                                       | 952/9741 [00:00<00:08, 1038.95it/s] 11%|██████████▍                                                                                     | 1059/9741 [00:01<00:08, 1046.13it/s] 12%|███████████▍                                                                                    | 1165/9741 [00:01<00:08, 1048.25it/s] 13%|████████████▌                                                                                   | 1271/9741 [00:01<00:08, 1050.31it/s] 14%|█████████████▌                                                                                  | 1377/9741 [00:01<00:07, 1050.13it/s] 15%|██████████████▌                                                                                 | 1483/9741 [00:01<00:07, 1051.66it/s] 16%|███████████████▋                                                                                | 1589/9741 [00:01<00:07, 1050.58it/s] 17%|████████████████▋                                                                               | 1695/9741 [00:01<00:07, 1052.50it/s] 18%|█████████████████▋                                                                              | 1801/9741 [00:01<00:07, 1026.39it/s] 20%|██████████████████▊                                                                             | 1904/9741 [00:01<00:07, 1026.68it/s] 21%|███████████████████▊                                                                            | 2009/9741 [00:01<00:07, 1033.09it/s] 22%|████████████████████▊                                                                           | 2114/9741 [00:02<00:07, 1035.85it/s] 23%|██████████████████████                                                                          | 2234/9741 [00:02<00:06, 1083.49it/s] 25%|███████████████████████▌                                                                        | 2395/9741 [00:02<00:05, 1238.71it/s] 26%|█████████████████████████▏                                                                      | 2555/9741 [00:02<00:05, 1346.18it/s] 28%|██████████████████████████▊                                                                     | 2715/9741 [00:02<00:04, 1421.95it/s] 30%|████████████████████████████▎                                                                   | 2876/9741 [00:02<00:04, 1477.74it/s] 31%|█████████████████████████████▉                                                                  | 3036/9741 [00:02<00:04, 1514.13it/s] 33%|███████████████████████████████▌                                                                | 3197/9741 [00:02<00:04, 1541.44it/s] 34%|█████████████████████████████████                                                               | 3358/9741 [00:02<00:04, 1561.42it/s] 36%|██████████████████████████████████▋                                                             | 3518/9741 [00:02<00:03, 1570.44it/s] 38%|████████████████████████████████████▏                                                           | 3677/9741 [00:03<00:03, 1573.64it/s] 39%|█████████████████████████████████████▊                                                          | 3835/9741 [00:03<00:03, 1570.24it/s] 41%|███████████████████████████████████████▍                                                        | 3996/9741 [00:03<00:03, 1579.51it/s] 43%|████████████████████████████████████████▉                                                       | 4156/9741 [00:03<00:03, 1584.07it/s] 44%|██████████████████████████████████████████▌                                                     | 4315/9741 [00:03<00:03, 1585.15it/s] 46%|████████████████████████████████████████████                                                    | 4475/9741 [00:03<00:03, 1588.78it/s] 48%|█████████████████████████████████████████████▋                                                  | 4634/9741 [00:03<00:03, 1549.79it/s] 49%|███████████████████████████████████████████████▏                                                | 4790/9741 [00:03<00:04, 1191.98it/s] 51%|████████████████████████████████████████████████▊                                               | 4949/9741 [00:03<00:03, 1287.16it/s] 52%|██████████████████████████████████████████████████▎                                             | 5110/9741 [00:04<00:03, 1368.93it/s] 54%|███████████████████████████████████████████████████▉                                            | 5269/9741 [00:04<00:03, 1427.78it/s] 56%|█████████████████████████████████████████████████████▍                                          | 5428/9741 [00:04<00:02, 1472.62it/s] 57%|███████████████████████████████████████████████████████                                         | 5593/9741 [00:04<00:02, 1521.37it/s] 59%|████████████████████████████████████████████████████████▋                                       | 5754/9741 [00:04<00:02, 1544.62it/s] 61%|██████████████████████████████████████████████████████████▎                                     | 5919/9741 [00:04<00:02, 1573.82it/s] 62%|███████████████████████████████████████████████████████████▉                                    | 6085/9741 [00:04<00:02, 1598.87it/s] 64%|█████████████████████████████████████████████████████████████▌                                  | 6252/9741 [00:04<00:02, 1617.60it/s] 66%|███████████████████████████████████████████████████████████████▎                                | 6419/9741 [00:04<00:02, 1630.98it/s] 68%|████████████████████████████████████████████████████████████████▉                               | 6585/9741 [00:04<00:01, 1636.94it/s] 69%|██████████████████████████████████████████████████████████████████▌                             | 6752/9741 [00:05<00:01, 1646.63it/s] 71%|████████████████████████████████████████████████████████████████████▏                           | 6918/9741 [00:05<00:01, 1647.72it/s] 73%|█████████████████████████████████████████████████████████████████████▊                          | 7084/9741 [00:05<00:01, 1648.14it/s] 74%|███████████████████████████████████████████████████████████████████████▍                        | 7250/9741 [00:05<00:01, 1648.85it/s] 76%|█████████████████████████████████████████████████████████████████████████                       | 7418/9741 [00:05<00:01, 1656.20it/s] 78%|██████████████████████████████████████████████████████████████████████████▋                     | 7584/9741 [00:05<00:01, 1605.68it/s] 80%|████████████████████████████████████████████████████████████████████████████▍                   | 7750/9741 [00:05<00:01, 1620.20it/s] 81%|█████████████████████████████████████████████████████████████████████████████▉                  | 7913/9741 [00:05<00:01, 1603.23it/s] 83%|███████████████████████████████████████████████████████████████████████████████▋                | 8080/9741 [00:05<00:01, 1621.04it/s] 85%|█████████████████████████████████████████████████████████████████████████████████▎              | 8246/9741 [00:05<00:00, 1630.31it/s] 86%|██████████████████████████████████████████████████████████████████████████████████▉             | 8412/9741 [00:06<00:00, 1636.93it/s] 88%|████████████████████████████████████████████████████████████████████████████████████▌           | 8578/9741 [00:06<00:00, 1641.43it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████▏         | 8744/9741 [00:06<00:00, 1645.28it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████▊        | 8910/9741 [00:06<00:00, 1647.92it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████████▍      | 9076/9741 [00:06<00:00, 1650.90it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████     | 9243/9741 [00:06<00:00, 1655.51it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████▋   | 9410/9741 [00:06<00:00, 1657.13it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▎ | 9576/9741 [00:06<00:00, 1654.72it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:06<00:00, 1418.60it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.37s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.55s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.82s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.31s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.40s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.89s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:13<00:07,  7.07s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.93s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.19s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.34s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:19<00:00,  6.45s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:19<00:00,  6.49s/it]
[2023-08-18 00:26:28,078] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-18 00:26:41,890] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 00:26:41,891] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f30eba23250>
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 00:26:41,892] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f30eba23e50>
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 00:26:41,893] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 00:26:41,893] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.437593936920166 seconds
Loading extension module utils...
Time to load utils op: 0.4045984745025635 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.40453338623046875 seconds
Loading extension module utils...
Time to load utils op: 0.40453171730041504 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:52<43:11, 52.88s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:45<41:56, 52.43s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:37<41:09, 52.54s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:29<40:08, 52.36s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:22<39:14, 52.32s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [05:13<38:10, 52.06s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [06:06<37:25, 52.23s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:34<31:09, 44.52s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [07:07<28:07, 41.16s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [08:00<29:45, 44.64s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [08:53<30:45, 47.32s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [09:08<23:41, 37.41s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [09:56<25:05, 40.69s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [10:49<26:31, 44.20s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [11:42<27:19, 46.85s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [12:20<25:07, 44.33s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [12:50<22:01, 40.03s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [13:26<20:45, 38.92s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [14:18<22:06, 42.79s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [15:12<23:03, 46.11s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [16:03<23:01, 47.64s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [16:55<22:50, 48.93s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [17:49<22:37, 50.30s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [18:42<22:11, 51.22s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [19:35<21:31, 51.65s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [20:02<17:40, 44.20s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [20:53<17:50, 46.53s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [21:46<17:42, 48.31s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [22:39<17:21, 49.61s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [23:32<16:52, 50.63s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [24:09<14:47, 46.69s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [25:02<14:34, 48.61s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [25:54<14:04, 49.70s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [26:19<11:15, 42.25s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [27:12<11:22, 45.52s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [28:07<11:13, 48.09s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [29:00<10:45, 49.63s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [29:52<10:05, 50.43s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [30:45<09:21, 51.06s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [31:38<08:38, 51.84s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [32:31<07:48, 52.02s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [33:01<06:03, 45.45s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [33:47<05:19, 45.59s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [34:23<04:16, 42.78s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [35:16<03:50, 46.01s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [36:09<03:11, 47.92s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [37:01<02:27, 49.10s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [37:31<01:27, 43.52s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [38:25<00:46, 46.50s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [38:48<00:00, 39.66s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [38:48<00:00, 46.58s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 2.7882} | lm_loss 7.9498 | avg. gen lenth: 258.092
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 5
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 01:09:18,333] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 5
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|█▏                                                                                               | 115/9741 [00:00<00:08, 1143.49it/s]  2%|██▎                                                                                              | 230/9741 [00:00<00:08, 1146.65it/s]  4%|███▍                                                                                             | 345/9741 [00:00<00:08, 1147.16it/s]  5%|████▌                                                                                            | 460/9741 [00:00<00:08, 1147.66it/s]  6%|█████▋                                                                                           | 575/9741 [00:00<00:07, 1148.47it/s]  7%|██████▊                                                                                          | 690/9741 [00:00<00:07, 1148.96it/s]  8%|████████                                                                                         | 806/9741 [00:00<00:07, 1150.59it/s]  9%|█████████▏                                                                                       | 922/9741 [00:00<00:07, 1145.08it/s] 11%|██████████▏                                                                                     | 1037/9741 [00:00<00:07, 1134.16it/s] 12%|███████████▎                                                                                    | 1152/9741 [00:01<00:07, 1136.92it/s] 13%|████████████▍                                                                                   | 1267/9741 [00:01<00:07, 1140.50it/s] 14%|█████████████▌                                                                                  | 1382/9741 [00:01<00:07, 1140.70it/s] 15%|██████████████▊                                                                                 | 1497/9741 [00:01<00:07, 1141.10it/s] 17%|███████████████▉                                                                                | 1612/9741 [00:01<00:07, 1139.51it/s] 18%|█████████████████                                                                               | 1728/9741 [00:01<00:07, 1143.91it/s] 19%|██████████████████▏                                                                             | 1843/9741 [00:01<00:07, 1119.35it/s] 20%|███████████████████▎                                                                            | 1958/9741 [00:01<00:06, 1127.34it/s] 21%|████████████████████▍                                                                           | 2072/9741 [00:01<00:06, 1129.60it/s] 22%|█████████████████████▌                                                                          | 2186/9741 [00:01<00:06, 1124.49it/s] 24%|██████████████████████▋                                                                         | 2300/9741 [00:02<00:06, 1126.26it/s] 25%|███████████████████████▊                                                                        | 2416/9741 [00:02<00:06, 1135.14it/s] 26%|████████████████████████▉                                                                       | 2530/9741 [00:02<00:06, 1135.06it/s] 27%|██████████████████████████                                                                      | 2646/9741 [00:02<00:06, 1141.48it/s] 28%|███████████████████████████▏                                                                    | 2761/9741 [00:02<00:06, 1137.70it/s] 30%|████████████████████████████▎                                                                   | 2875/9741 [00:02<00:06, 1094.49it/s] 31%|█████████████████████████████▍                                                                  | 2990/9741 [00:02<00:06, 1108.97it/s] 32%|██████████████████████████████▌                                                                 | 3106/9741 [00:02<00:05, 1122.65it/s] 33%|███████████████████████████████▋                                                                | 3221/9741 [00:02<00:05, 1129.30it/s] 34%|████████████████████████████████▉                                                               | 3337/9741 [00:02<00:05, 1138.26it/s] 35%|██████████████████████████████████                                                              | 3452/9741 [00:03<00:05, 1140.23it/s] 37%|███████████████████████████████████▏                                                            | 3567/9741 [00:03<00:05, 1142.41it/s] 38%|████████████████████████████████████▎                                                           | 3682/9741 [00:03<00:05, 1143.10it/s] 39%|█████████████████████████████████████▍                                                          | 3798/9741 [00:03<00:05, 1146.50it/s] 40%|██████████████████████████████████████▌                                                         | 3913/9741 [00:03<00:05, 1146.18it/s] 41%|███████████████████████████████████████▋                                                        | 4029/9741 [00:03<00:04, 1149.25it/s] 43%|████████████████████████████████████████▊                                                       | 4144/9741 [00:03<00:04, 1147.75it/s] 44%|█████████████████████████████████████████▉                                                      | 4259/9741 [00:03<00:04, 1148.40it/s] 45%|███████████████████████████████████████████                                                     | 4374/9741 [00:03<00:04, 1145.91it/s] 46%|████████████████████████████████████████████▎                                                   | 4490/9741 [00:03<00:04, 1147.52it/s] 47%|█████████████████████████████████████████████▍                                                  | 4605/9741 [00:04<00:04, 1113.78it/s] 48%|██████████████████████████████████████████████▌                                                 | 4722/9741 [00:04<00:04, 1128.23it/s] 50%|████████████████████████████████████████████████▏                                                | 4836/9741 [00:04<00:05, 856.26it/s] 51%|█████████████████████████████████████████████████▎                                               | 4950/9741 [00:04<00:05, 924.13it/s] 52%|██████████████████████████████████████████████████▍                                              | 5066/9741 [00:04<00:04, 983.43it/s] 53%|███████████████████████████████████████████████████                                             | 5181/9741 [00:04<00:04, 1027.37it/s] 54%|████████████████████████████████████████████████████▏                                           | 5297/9741 [00:04<00:04, 1061.48it/s] 56%|█████████████████████████████████████████████████████▎                                          | 5410/9741 [00:04<00:04, 1080.41it/s] 57%|██████████████████████████████████████████████████████▍                                         | 5527/9741 [00:04<00:03, 1105.45it/s] 58%|███████████████████████████████████████████████████████▌                                        | 5644/9741 [00:05<00:03, 1123.88it/s] 59%|████████████████████████████████████████████████████████▊                                       | 5764/9741 [00:05<00:03, 1143.43it/s] 60%|█████████████████████████████████████████████████████████▉                                      | 5883/9741 [00:05<00:03, 1155.07it/s] 62%|███████████████████████████████████████████████████████████▏                                    | 6003/9741 [00:05<00:03, 1168.04it/s] 63%|████████████████████████████████████████████████████████████▎                                   | 6122/9741 [00:05<00:03, 1174.54it/s] 64%|█████████████████████████████████████████████████████████████▌                                  | 6242/9741 [00:05<00:02, 1180.66it/s] 65%|██████████████████████████████████████████████████████████████▋                                 | 6361/9741 [00:05<00:02, 1182.73it/s] 67%|███████████████████████████████████████████████████████████████▊                                | 6481/9741 [00:05<00:02, 1187.28it/s] 68%|█████████████████████████████████████████████████████████████████                               | 6600/9741 [00:05<00:02, 1177.18it/s] 69%|██████████████████████████████████████████████████████████████████▏                             | 6720/9741 [00:05<00:02, 1183.38it/s] 70%|███████████████████████████████████████████████████████████████████▍                            | 6840/9741 [00:06<00:02, 1185.76it/s] 71%|████████████████████████████████████████████████████████████████████▌                           | 6961/9741 [00:06<00:02, 1190.61it/s] 73%|█████████████████████████████████████████████████████████████████████▊                          | 7081/9741 [00:06<00:02, 1189.51it/s] 74%|██████████████████████████████████████████████████████████████████████▉                         | 7202/9741 [00:06<00:02, 1193.16it/s] 75%|████████████████████████████████████████████████████████████████████████▏                       | 7322/9741 [00:06<00:02, 1190.75it/s] 76%|█████████████████████████████████████████████████████████████████████████▎                      | 7442/9741 [00:06<00:01, 1159.65it/s] 78%|██████████████████████████████████████████████████████████████████████████▌                     | 7561/9741 [00:06<00:01, 1165.82it/s] 79%|███████████████████████████████████████████████████████████████████████████▋                    | 7680/9741 [00:06<00:01, 1171.61it/s] 80%|████████████████████████████████████████████████████████████████████████████▊                   | 7800/9741 [00:06<00:01, 1177.89it/s] 81%|██████████████████████████████████████████████████████████████████████████████                  | 7920/9741 [00:06<00:01, 1182.28it/s] 83%|███████████████████████████████████████████████████████████████████████████████▏                | 8040/9741 [00:07<00:01, 1187.26it/s] 84%|████████████████████████████████████████████████████████████████████████████████▍               | 8159/9741 [00:07<00:01, 1177.67it/s] 85%|█████████████████████████████████████████████████████████████████████████████████▌              | 8279/9741 [00:07<00:01, 1182.32it/s] 86%|██████████████████████████████████████████████████████████████████████████████████▊             | 8398/9741 [00:07<00:01, 1181.00it/s] 87%|███████████████████████████████████████████████████████████████████████████████████▉            | 8518/9741 [00:07<00:01, 1185.97it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████           | 8637/9741 [00:07<00:00, 1184.26it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████▎         | 8756/9741 [00:07<00:00, 1185.83it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████▍        | 8875/9741 [00:07<00:00, 1186.44it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████▋       | 8994/9741 [00:07<00:00, 1186.14it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████▊      | 9113/9741 [00:07<00:00, 1184.42it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████▉     | 9233/9741 [00:08<00:00, 1188.14it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▏   | 9353/9741 [00:08<00:00, 1188.86it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▎  | 9473/9741 [00:08<00:00, 1189.45it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▌ | 9592/9741 [00:08<00:00, 1187.20it/s]100%|███████████████████████████████████████████████████████████████████████████████████████████████▋| 9711/9741 [00:08<00:00, 1170.15it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:08<00:00, 1141.89it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.61s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.63s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.89s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.99s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.57s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.82s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.79s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.78s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.03s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.18s/it]
[2023-08-18 01:10:19,822] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.11s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.29s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.39s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.51s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.53s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.62s/it]
[2023-08-18 01:10:40,172] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 01:10:40,173] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f822a2f7e80>
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 01:10:40,174] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f822a2f7dc0>
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 01:10:40,175] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 01:10:40,176] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 01:10:40,176] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.43355727195739746 seconds
Loading extension module utils...
Time to load utils op: 0.4045274257659912 seconds
Loading extension module utils...
Time to load utils op: 0.40447235107421875 seconds
Loading extension module utils...
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Time to load utils op: 0.40442323684692383 seconds
Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:50<41:13, 50.48s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:41<40:28, 50.60s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:32<40:02, 51.11s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:25<39:35, 51.64s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:16<38:42, 51.62s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [05:07<37:38, 51.33s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:58<36:42, 51.22s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:49<35:49, 51.18s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [07:40<34:48, 50.94s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [08:04<28:34, 42.86s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [08:56<29:34, 45.49s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [09:46<29:44, 46.95s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [10:37<29:36, 48.02s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [11:20<28:00, 46.69s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [12:11<27:57, 47.92s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [13:03<27:48, 49.07s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [13:30<23:24, 42.57s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [14:21<24:05, 45.17s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [15:12<24:07, 46.68s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [15:58<23:19, 46.66s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [16:49<23:11, 47.97s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [17:40<22:42, 48.66s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [18:30<22:07, 49.18s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [18:57<18:28, 42.65s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [19:49<18:49, 45.19s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [20:40<18:50, 47.12s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [21:15<16:42, 43.57s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [21:34<13:13, 36.07s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [22:25<14:09, 40.48s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [23:17<14:38, 43.92s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [24:07<14:32, 45.90s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [24:57<14:09, 47.19s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [25:49<13:45, 48.54s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [26:40<13:08, 49.30s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [27:31<12:25, 49.72s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [28:22<11:41, 50.07s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [29:12<10:52, 50.16s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [30:04<10:06, 50.53s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [30:55<09:18, 50.77s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [31:43<08:21, 50.10s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [32:30<07:21, 49.07s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [33:22<06:38, 49.87s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [34:13<05:52, 50.30s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [35:04<05:02, 50.36s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [35:54<04:11, 50.31s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [36:44<03:21, 50.32s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [37:36<02:32, 50.76s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [38:27<01:41, 50.95s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [39:18<00:51, 51.01s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [40:09<00:00, 50.75s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [40:09<00:00, 48.18s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.7474} | lm_loss 8.0059 | avg. gen lenth: 280.052
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 6
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 01:51:17,409] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 6
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o6-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|▋                                                                                                  | 65/9741 [00:00<00:15, 642.94it/s]  1%|█▎                                                                                                | 130/9741 [00:00<00:14, 646.82it/s]  2%|█▉                                                                                                | 195/9741 [00:00<00:14, 647.24it/s]  3%|██▌                                                                                               | 260/9741 [00:00<00:14, 645.23it/s]  3%|███▎                                                                                              | 325/9741 [00:00<00:14, 646.46it/s]  4%|███▉                                                                                              | 391/9741 [00:00<00:14, 647.70it/s]  5%|████▌                                                                                             | 456/9741 [00:00<00:14, 645.73it/s]  5%|█████▏                                                                                            | 521/9741 [00:00<00:14, 635.59it/s]  6%|█████▉                                                                                            | 586/9741 [00:00<00:14, 637.32it/s]  7%|██████▌                                                                                           | 651/9741 [00:01<00:14, 639.47it/s]  7%|███████▏                                                                                          | 715/9741 [00:01<00:14, 638.94it/s]  8%|███████▊                                                                                          | 780/9741 [00:01<00:13, 642.24it/s]  9%|████████▌                                                                                         | 845/9741 [00:01<00:13, 644.26it/s]  9%|█████████▏                                                                                        | 910/9741 [00:01<00:13, 643.36it/s] 10%|█████████▊                                                                                        | 975/9741 [00:01<00:13, 644.93it/s] 11%|██████████▎                                                                                      | 1040/9741 [00:01<00:13, 645.96it/s] 11%|███████████                                                                                      | 1105/9741 [00:01<00:13, 645.76it/s] 12%|███████████▋                                                                                     | 1170/9741 [00:01<00:13, 639.19it/s] 13%|████████████▎                                                                                    | 1234/9741 [00:01<00:13, 639.28it/s] 13%|████████████▉                                                                                    | 1299/9741 [00:02<00:13, 641.09it/s] 14%|█████████████▌                                                                                   | 1364/9741 [00:02<00:13, 640.69it/s] 15%|██████████████▎                                                                                  | 1440/9741 [00:02<00:12, 675.04it/s] 16%|███████████████▎                                                                                 | 1539/9741 [00:02<00:10, 767.84it/s] 17%|████████████████▎                                                                                | 1637/9741 [00:02<00:09, 830.05it/s] 18%|█████████████████▎                                                                               | 1736/9741 [00:02<00:09, 875.63it/s] 19%|██████████████████▏                                                                              | 1826/9741 [00:02<00:08, 880.65it/s] 20%|███████████████████▏                                                                             | 1925/9741 [00:02<00:08, 911.50it/s] 21%|████████████████████▏                                                                            | 2023/9741 [00:02<00:08, 931.05it/s] 22%|█████████████████████                                                                            | 2121/9741 [00:02<00:08, 944.57it/s] 23%|██████████████████████                                                                           | 2216/9741 [00:03<00:07, 946.08it/s] 24%|███████████████████████                                                                          | 2311/9741 [00:03<00:07, 943.58it/s] 25%|███████████████████████▉                                                                         | 2409/9741 [00:03<00:07, 954.44it/s] 26%|████████████████████████▉                                                                        | 2507/9741 [00:03<00:07, 959.90it/s] 27%|█████████████████████████▉                                                                       | 2606/9741 [00:03<00:07, 966.58it/s] 28%|██████████████████████████▉                                                                      | 2704/9741 [00:03<00:07, 968.45it/s] 29%|███████████████████████████▉                                                                     | 2802/9741 [00:03<00:07, 971.42it/s] 30%|████████████████████████████▉                                                                    | 2900/9741 [00:03<00:07, 973.84it/s] 31%|█████████████████████████████▊                                                                   | 2998/9741 [00:03<00:06, 974.63it/s] 32%|██████████████████████████████▊                                                                  | 3096/9741 [00:03<00:06, 975.89it/s] 33%|███████████████████████████████▊                                                                 | 3194/9741 [00:04<00:06, 976.30it/s] 34%|████████████████████████████████▊                                                                | 3293/9741 [00:04<00:06, 978.57it/s] 35%|█████████████████████████████████▊                                                               | 3391/9741 [00:04<00:06, 977.15it/s] 36%|██████████████████████████████████▊                                                              | 3490/9741 [00:04<00:06, 978.45it/s] 37%|███████████████████████████████████▋                                                             | 3588/9741 [00:04<00:06, 969.32it/s] 38%|████████████████████████████████████▋                                                            | 3685/9741 [00:04<00:06, 968.17it/s] 39%|█████████████████████████████████████▋                                                           | 3784/9741 [00:04<00:06, 972.90it/s] 40%|██████████████████████████████████████▋                                                          | 3882/9741 [00:04<00:06, 972.21it/s] 41%|███████████████████████████████████████▋                                                         | 3981/9741 [00:04<00:05, 975.17it/s] 42%|████████████████████████████████████████▌                                                        | 4079/9741 [00:04<00:05, 967.59it/s] 43%|█████████████████████████████████████████▌                                                       | 4176/9741 [00:05<00:05, 964.04it/s] 44%|██████████████████████████████████████████▌                                                      | 4274/9741 [00:05<00:05, 968.21it/s] 45%|███████████████████████████████████████████▌                                                     | 4371/9741 [00:05<00:05, 968.72it/s] 46%|████████████████████████████████████████████▌                                                    | 4469/9741 [00:05<00:05, 971.94it/s] 47%|█████████████████████████████████████████████▍                                                   | 4567/9741 [00:05<00:05, 922.65it/s] 48%|██████████████████████████████████████████████▍                                                  | 4665/9741 [00:05<00:05, 938.27it/s] 49%|███████████████████████████████████████████████▍                                                 | 4760/9741 [00:05<00:07, 695.32it/s] 50%|████████████████████████████████████████████████▍                                                | 4858/9741 [00:05<00:06, 761.61it/s] 51%|█████████████████████████████████████████████████▎                                               | 4955/9741 [00:05<00:05, 813.49it/s] 52%|██████████████████████████████████████████████████▎                                              | 5048/9741 [00:06<00:05, 842.45it/s] 53%|███████████████████████████████████████████████████▏                                             | 5138/9741 [00:06<00:05, 847.05it/s] 54%|████████████████████████████████████████████████████▏                                            | 5236/9741 [00:06<00:05, 881.61it/s] 55%|█████████████████████████████████████████████████████                                            | 5334/9741 [00:06<00:04, 909.47it/s] 56%|██████████████████████████████████████████████████████                                           | 5432/9741 [00:06<00:04, 927.16it/s] 57%|███████████████████████████████████████████████████████                                          | 5533/9741 [00:06<00:04, 949.92it/s] 58%|████████████████████████████████████████████████████████                                         | 5635/9741 [00:06<00:04, 969.37it/s] 59%|█████████████████████████████████████████████████████████▏                                       | 5738/9741 [00:06<00:04, 986.37it/s] 60%|██████████████████████████████████████████████████████████▏                                      | 5841/9741 [00:06<00:03, 997.21it/s] 61%|██████████████████████████████████████████████████████████▌                                     | 5943/9741 [00:06<00:03, 1002.65it/s] 62%|███████████████████████████████████████████████████████████▌                                    | 6046/9741 [00:07<00:03, 1010.77it/s] 63%|████████████████████████████████████████████████████████████▌                                   | 6148/9741 [00:07<00:03, 1012.77it/s] 64%|█████████████████████████████████████████████████████████████▌                                  | 6251/9741 [00:07<00:03, 1015.62it/s] 65%|██████████████████████████████████████████████████████████████▌                                 | 6353/9741 [00:07<00:03, 1016.20it/s] 66%|███████████████████████████████████████████████████████████████▌                                | 6455/9741 [00:07<00:03, 1013.89it/s] 67%|████████████████████████████████████████████████████████████████▌                               | 6557/9741 [00:07<00:03, 1012.82it/s] 68%|█████████████████████████████████████████████████████████████████▋                              | 6659/9741 [00:07<00:03, 1014.45it/s] 69%|██████████████████████████████████████████████████████████████████▋                             | 6761/9741 [00:07<00:02, 1009.85it/s] 70%|███████████████████████████████████████████████████████████████████▋                            | 6864/9741 [00:07<00:02, 1014.11it/s] 72%|████████████████████████████████████████████████████████████████████▋                           | 6967/9741 [00:08<00:02, 1018.12it/s] 73%|█████████████████████████████████████████████████████████████████████▋                          | 7069/9741 [00:08<00:02, 1017.26it/s] 74%|██████████████████████████████████████████████████████████████████████▋                         | 7172/9741 [00:08<00:02, 1018.68it/s] 75%|███████████████████████████████████████████████████████████████████████▋                        | 7274/9741 [00:08<00:02, 1016.84it/s] 76%|████████████████████████████████████████████████████████████████████████▋                       | 7377/9741 [00:08<00:02, 1020.09it/s] 77%|██████████████████████████████████████████████████████████████████████████▍                      | 7480/9741 [00:08<00:02, 988.08it/s] 78%|███████████████████████████████████████████████████████████████████████████▌                     | 7582/9741 [00:08<00:02, 996.44it/s] 79%|███████████████████████████████████████████████████████████████████████████▋                    | 7684/9741 [00:08<00:02, 1001.41it/s] 80%|████████████████████████████████████████████████████████████████████████████▋                   | 7787/9741 [00:08<00:01, 1007.48it/s] 81%|█████████████████████████████████████████████████████████████████████████████▋                  | 7889/9741 [00:08<00:01, 1009.61it/s] 82%|██████████████████████████████████████████████████████████████████████████████▊                 | 7991/9741 [00:09<00:01, 1011.04it/s] 83%|███████████████████████████████████████████████████████████████████████████████▊                | 8093/9741 [00:09<00:01, 1010.35it/s] 84%|████████████████████████████████████████████████████████████████████████████████▊               | 8195/9741 [00:09<00:01, 1011.94it/s] 85%|█████████████████████████████████████████████████████████████████████████████████▊              | 8298/9741 [00:09<00:01, 1014.48it/s] 86%|██████████████████████████████████████████████████████████████████████████████████▊             | 8400/9741 [00:09<00:01, 1014.65it/s] 87%|███████████████████████████████████████████████████████████████████████████████████▊            | 8503/9741 [00:09<00:01, 1016.85it/s] 88%|████████████████████████████████████████████████████████████████████████████████████▊           | 8605/9741 [00:09<00:01, 1015.28it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▊          | 8708/9741 [00:09<00:01, 1016.97it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████▊         | 8810/9741 [00:09<00:00, 1014.73it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████▊        | 8913/9741 [00:09<00:00, 1017.38it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████▊       | 9015/9741 [00:10<00:00, 1016.95it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████▊      | 9117/9741 [00:10<00:00, 1014.52it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████▊     | 9219/9741 [00:10<00:00, 1015.60it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████▊    | 9321/9741 [00:10<00:00, 1014.94it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████▊   | 9423/9741 [00:10<00:00, 1015.73it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████████▊  | 9525/9741 [00:10<00:00, 1012.11it/s] 99%|██████████████████████████████████████████████████████████████████████████████████████████████▉ | 9627/9741 [00:10<00:00, 1012.42it/s]100%|███████████████████████████████████████████████████████████████████████████████████████████████▉| 9729/9741 [00:10<00:00, 1011.24it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:10<00:00, 906.51it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.48s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.64s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:06<00:12,  6.05s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:07<00:14,  7.28s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.62s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.58s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.78s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:14<00:07,  7.28s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.96s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.13s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.99s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.16s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.13s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.34s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:19<00:00,  6.20s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:19<00:00,  6.49s/it]
[2023-08-18 01:52:25,058] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-18 01:52:44,211] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 01:52:44,211] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f71403cef10>
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 01:52:44,212] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f71403cedc0>
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 01:52:44,213] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 01:52:44,213] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3965003490447998 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]Time to load utils op: 0.30422329902648926 seconds
############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o6-tgsm8k-s1-rFalse
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.30446839332580566 seconds
Time to load utils op: 0.3059208393096924 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:50<41:04, 50.30s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:39<39:40, 49.59s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:28<38:41, 49.40s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:18<37:55, 49.47s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:08<37:15, 49.68s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:57<36:19, 49.54s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:47<35:31, 49.57s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:13<29:34, 42.24s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [07:04<30:36, 44.80s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [07:54<31:00, 46.52s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [08:43<30:44, 47.29s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [09:32<30:13, 47.73s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [10:21<29:43, 48.20s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [11:11<29:09, 48.59s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [12:01<28:37, 49.08s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [12:50<27:55, 49.29s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [13:40<27:13, 49.49s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [14:29<26:12, 49.14s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [15:18<25:20, 49.03s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [16:08<24:42, 49.42s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [16:58<23:58, 49.60s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [17:48<23:15, 49.83s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [18:20<19:58, 44.39s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [19:10<20:00, 46.16s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [20:00<19:42, 47.32s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [20:49<19:08, 47.84s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [21:21<16:30, 43.06s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [22:12<16:37, 45.35s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [23:01<16:12, 46.32s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [23:50<15:47, 47.38s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [24:39<15:06, 47.73s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [25:29<14:34, 48.57s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [26:20<13:57, 49.28s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [27:10<13:10, 49.40s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [28:00<12:22, 49.52s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [28:49<11:33, 49.54s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [29:39<10:45, 49.65s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [30:29<09:54, 49.55s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [30:55<07:49, 42.69s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [31:47<07:32, 45.25s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [32:36<06:57, 46.44s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [33:26<06:21, 47.67s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [34:16<05:37, 48.19s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [35:05<04:51, 48.64s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [35:55<04:04, 48.92s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [36:46<03:17, 49.47s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [37:35<02:28, 49.47s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [38:25<01:38, 49.48s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [39:15<00:49, 49.62s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [40:05<00:00, 49.84s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [40:05<00:00, 48.11s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.2219} | lm_loss 7.9982 | avg. gen lenth: 281.172
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 7
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 02:32:56,360] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 7
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o7-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                                  | 60/9741 [00:00<00:16, 593.89it/s]  1%|█▏                                                                                                | 121/9741 [00:00<00:16, 598.11it/s]  2%|█▊                                                                                                | 181/9741 [00:00<00:15, 598.18it/s]  2%|██▍                                                                                               | 241/9741 [00:00<00:15, 595.89it/s]  3%|███                                                                                               | 301/9741 [00:00<00:15, 597.11it/s]  4%|███▋                                                                                              | 361/9741 [00:00<00:15, 597.06it/s]  4%|████▏                                                                                             | 422/9741 [00:00<00:15, 598.15it/s]  5%|████▊                                                                                             | 482/9741 [00:00<00:15, 584.23it/s]  6%|█████▍                                                                                            | 542/9741 [00:00<00:15, 588.33it/s]  6%|██████                                                                                            | 602/9741 [00:01<00:15, 590.95it/s]  7%|██████▋                                                                                           | 662/9741 [00:01<00:15, 591.62it/s]  7%|███████▎                                                                                          | 723/9741 [00:01<00:15, 594.68it/s]  8%|███████▉                                                                                          | 784/9741 [00:01<00:14, 597.31it/s]  9%|████████▌                                                                                         | 845/9741 [00:01<00:14, 598.59it/s]  9%|█████████                                                                                         | 905/9741 [00:01<00:14, 597.56it/s] 10%|█████████▋                                                                                        | 966/9741 [00:01<00:14, 598.44it/s] 11%|██████████▏                                                                                      | 1027/9741 [00:01<00:14, 599.95it/s] 11%|██████████▊                                                                                      | 1087/9741 [00:01<00:14, 595.83it/s] 12%|███████████▍                                                                                     | 1147/9741 [00:01<00:14, 595.14it/s] 12%|████████████                                                                                     | 1208/9741 [00:02<00:14, 597.41it/s] 13%|████████████▋                                                                                    | 1268/9741 [00:02<00:14, 598.15it/s] 14%|█████████████▏                                                                                   | 1329/9741 [00:02<00:14, 600.01it/s] 14%|█████████████▊                                                                                   | 1390/9741 [00:02<00:13, 598.49it/s] 15%|██████████████▍                                                                                  | 1451/9741 [00:02<00:13, 599.00it/s] 16%|███████████████                                                                                  | 1511/9741 [00:02<00:13, 599.00it/s] 16%|███████████████▋                                                                                 | 1571/9741 [00:02<00:13, 597.55it/s] 17%|████████████████▎                                                                                | 1640/9741 [00:02<00:12, 624.47it/s] 18%|█████████████████▏                                                                               | 1732/9741 [00:02<00:11, 712.09it/s] 19%|██████████████████                                                                               | 1815/9741 [00:02<00:10, 745.62it/s] 20%|██████████████████▉                                                                              | 1907/9741 [00:03<00:09, 796.47it/s] 20%|███████████████████▉                                                                             | 1996/9741 [00:03<00:09, 824.22it/s] 21%|████████████████████▊                                                                            | 2086/9741 [00:03<00:09, 845.70it/s] 22%|█████████████████████▋                                                                           | 2178/9741 [00:03<00:08, 866.87it/s] 23%|██████████████████████▌                                                                          | 2269/9741 [00:03<00:08, 879.25it/s] 24%|███████████████████████▌                                                                         | 2361/9741 [00:03<00:08, 889.93it/s] 25%|████████████████████████▍                                                                        | 2454/9741 [00:03<00:08, 899.47it/s] 26%|█████████████████████████▎                                                                       | 2545/9741 [00:03<00:07, 901.18it/s] 27%|██████████████████████████▎                                                                      | 2637/9741 [00:03<00:07, 906.53it/s] 28%|███████████████████████████▏                                                                     | 2728/9741 [00:03<00:07, 906.82it/s] 29%|████████████████████████████                                                                     | 2820/9741 [00:04<00:07, 908.56it/s] 30%|████████████████████████████▉                                                                    | 2912/9741 [00:04<00:07, 911.12it/s] 31%|█████████████████████████████▉                                                                   | 3004/9741 [00:04<00:07, 909.14it/s] 32%|██████████████████████████████▊                                                                  | 3096/9741 [00:04<00:07, 909.43it/s] 33%|███████████████████████████████▋                                                                 | 3187/9741 [00:04<00:07, 898.73it/s] 34%|████████████████████████████████▋                                                                | 3279/9741 [00:04<00:07, 903.04it/s] 35%|█████████████████████████████████▌                                                               | 3370/9741 [00:04<00:07, 904.75it/s] 36%|██████████████████████████████████▍                                                              | 3461/9741 [00:04<00:06, 905.59it/s] 36%|███████████████████████████████████▍                                                             | 3553/9741 [00:04<00:06, 907.02it/s] 37%|████████████████████████████████████▎                                                            | 3644/9741 [00:04<00:06, 906.62it/s] 38%|█████████████████████████████████████▏                                                           | 3736/9741 [00:05<00:06, 909.51it/s] 39%|██████████████████████████████████████                                                           | 3828/9741 [00:05<00:06, 910.95it/s] 40%|███████████████████████████████████████                                                          | 3920/9741 [00:05<00:06, 909.23it/s] 41%|███████████████████████████████████████▉                                                         | 4011/9741 [00:05<00:06, 903.48it/s] 42%|████████████████████████████████████████▊                                                        | 4102/9741 [00:05<00:06, 904.67it/s] 43%|█████████████████████████████████████████▊                                                       | 4194/9741 [00:05<00:06, 907.36it/s] 44%|██████████████████████████████████████████▋                                                      | 4286/9741 [00:05<00:06, 907.27it/s] 45%|███████████████████████████████████████████▌                                                     | 4377/9741 [00:05<00:05, 904.39it/s] 46%|████████████████████████████████████████████▍                                                    | 4468/9741 [00:05<00:05, 905.52it/s] 47%|█████████████████████████████████████████████▍                                                   | 4559/9741 [00:05<00:06, 861.85it/s] 48%|██████████████████████████████████████████████▎                                                  | 4650/9741 [00:06<00:05, 874.67it/s] 49%|███████████████████████████████████████████████▏                                                 | 4740/9741 [00:06<00:07, 659.18it/s] 50%|████████████████████████████████████████████████                                                 | 4831/9741 [00:06<00:06, 718.34it/s] 51%|█████████████████████████████████████████████████                                                | 4923/9741 [00:06<00:06, 767.33it/s] 51%|█████████████████████████████████████████████████▉                                               | 5012/9741 [00:06<00:05, 799.58it/s] 52%|██████████████████████████████████████████████████▊                                              | 5104/9741 [00:06<00:05, 830.55it/s] 53%|███████████████████████████████████████████████████▋                                             | 5194/9741 [00:06<00:05, 849.85it/s] 54%|████████████████████████████████████████████████████▋                                            | 5286/9741 [00:06<00:05, 867.66it/s] 55%|█████████████████████████████████████████████████████▌                                           | 5378/9741 [00:06<00:04, 880.83it/s] 56%|██████████████████████████████████████████████████████▍                                          | 5469/9741 [00:07<00:04, 887.73it/s] 57%|███████████████████████████████████████████████████████▍                                         | 5565/9741 [00:07<00:04, 907.12it/s] 58%|████████████████████████████████████████████████████████▎                                        | 5660/9741 [00:07<00:04, 918.13it/s] 59%|█████████████████████████████████████████████████████████▎                                       | 5755/9741 [00:07<00:04, 927.04it/s] 60%|██████████████████████████████████████████████████████████▏                                      | 5849/9741 [00:07<00:04, 930.72it/s] 61%|███████████████████████████████████████████████████████████▏                                     | 5944/9741 [00:07<00:04, 935.23it/s] 62%|████████████████████████████████████████████████████████████▏                                    | 6040/9741 [00:07<00:03, 941.79it/s] 63%|█████████████████████████████████████████████████████████████                                    | 6135/9741 [00:07<00:03, 941.19it/s] 64%|██████████████████████████████████████████████████████████████                                   | 6230/9741 [00:07<00:03, 943.40it/s] 65%|██████████████████████████████████████████████████████████████▉                                  | 6325/9741 [00:08<00:03, 943.46it/s] 66%|███████████████████████████████████████████████████████████████▉                                 | 6421/9741 [00:08<00:03, 946.08it/s] 67%|████████████████████████████████████████████████████████████████▉                                | 6517/9741 [00:08<00:03, 947.92it/s] 68%|█████████████████████████████████████████████████████████████████▊                               | 6612/9741 [00:08<00:03, 946.57it/s] 69%|██████████████████████████████████████████████████████████████████▊                              | 6708/9741 [00:08<00:03, 948.82it/s] 70%|███████████████████████████████████████████████████████████████████▋                             | 6803/9741 [00:08<00:03, 949.04it/s] 71%|████████████████████████████████████████████████████████████████████▋                            | 6899/9741 [00:08<00:02, 950.68it/s] 72%|█████████████████████████████████████████████████████████████████████▋                           | 6995/9741 [00:08<00:02, 949.10it/s] 73%|██████████████████████████████████████████████████████████████████████▌                          | 7091/9741 [00:08<00:02, 951.24it/s] 74%|███████████████████████████████████████████████████████████████████████▌                         | 7187/9741 [00:08<00:02, 951.91it/s] 75%|████████████████████████████████████████████████████████████████████████▌                        | 7283/9741 [00:09<00:02, 946.38it/s] 76%|█████████████████████████████████████████████████████████████████████████▍                       | 7378/9741 [00:09<00:02, 943.91it/s] 77%|██████████████████████████████████████████████████████████████████████████▍                      | 7473/9741 [00:09<00:02, 912.70it/s] 78%|███████████████████████████████████████████████████████████████████████████▎                     | 7569/9741 [00:09<00:02, 923.93it/s] 79%|████████████████████████████████████████████████████████████████████████████▎                    | 7665/9741 [00:09<00:02, 932.38it/s] 80%|█████████████████████████████████████████████████████████████████████████████▎                   | 7760/9741 [00:09<00:02, 936.62it/s] 81%|██████████████████████████████████████████████████████████████████████████████▏                  | 7856/9741 [00:09<00:02, 941.62it/s] 82%|███████████████████████████████████████████████████████████████████████████████▏                 | 7951/9741 [00:09<00:01, 942.74it/s] 83%|████████████████████████████████████████████████████████████████████████████████▏                | 8047/9741 [00:09<00:01, 945.56it/s] 84%|█████████████████████████████████████████████████████████████████████████████████                | 8142/9741 [00:09<00:01, 946.65it/s] 85%|██████████████████████████████████████████████████████████████████████████████████               | 8238/9741 [00:10<00:01, 948.46it/s] 86%|██████████████████████████████████████████████████████████████████████████████████▉              | 8333/9741 [00:10<00:01, 946.63it/s] 87%|███████████████████████████████████████████████████████████████████████████████████▉             | 8428/9741 [00:10<00:01, 943.34it/s] 88%|████████████████████████████████████████████████████████████████████████████████████▉            | 8524/9741 [00:10<00:01, 946.28it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▊           | 8619/9741 [00:10<00:01, 944.87it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▊          | 8715/9741 [00:10<00:01, 947.12it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▋         | 8810/9741 [00:10<00:00, 943.74it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▋        | 8906/9741 [00:10<00:00, 946.63it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▋       | 9002/9741 [00:10<00:00, 947.81it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▌      | 9097/9741 [00:10<00:00, 938.75it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▌     | 9192/9741 [00:11<00:00, 941.88it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▍    | 9287/9741 [00:11<00:00, 943.06it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▍   | 9383/9741 [00:11<00:00, 946.51it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████▍  | 9479/9741 [00:11<00:00, 948.04it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████▎ | 9574/9741 [00:11<00:00, 945.48it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▎| 9669/9741 [00:11<00:00, 944.45it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:11<00:00, 838.08it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.11s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.33s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.36s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.37s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:04,  5.00s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.37s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.41s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.39s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.57s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.73s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.89s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.92s/it]
[2023-08-18 02:34:00,171] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-18 02:34:08,483] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 02:34:08,484] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 02:34:08,484] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 02:34:08,484] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 02:34:08,484] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 02:34:08,484] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f0f15530e20>
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f0f15530d60>
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 02:34:08,485] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 02:34:08,486] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 02:34:08,486] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.39961814880371094 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|
Loading extension module utils...
Time to load utils op: 0.3042604923248291 seconds

Time to load utils op: 0.3044776916503906 seconds
Loading extension module utils...
Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
Time to load utils op: 0.3044605255126953 seconds
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o7-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:48<39:49, 48.77s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:37<38:54, 48.64s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:13<33:46, 43.12s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:02<34:45, 45.34s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:51<34:54, 46.54s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:40<34:45, 47.39s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:29<34:17, 47.86s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:19<34:01, 48.61s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [07:09<33:29, 49.01s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [07:58<32:38, 48.97s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [08:47<31:53, 49.06s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [09:35<30:57, 48.88s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [10:24<30:05, 48.81s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [11:13<29:24, 49.01s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [11:40<24:32, 42.08s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [12:29<25:03, 44.22s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [13:18<25:07, 45.68s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [14:07<24:52, 46.63s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [14:56<24:33, 47.52s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [15:29<21:29, 42.99s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [16:16<21:20, 44.15s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [17:05<21:18, 45.66s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [17:54<21:01, 46.72s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [18:43<20:30, 47.33s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [19:32<19:56, 47.85s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [20:21<19:16, 48.17s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [21:10<18:38, 48.63s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [21:59<17:50, 48.68s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [22:49<17:10, 49.07s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [23:38<16:19, 48.98s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [24:27<15:33, 49.11s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [25:17<14:46, 49.26s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [26:06<13:58, 49.34s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [26:55<13:04, 49.02s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [27:44<12:14, 48.99s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [28:21<10:38, 45.57s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [29:10<10:05, 46.57s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [30:00<09:29, 47.47s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [30:49<08:48, 48.03s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [31:39<08:05, 48.55s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [32:27<07:16, 48.47s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [33:16<06:29, 48.72s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [34:05<05:40, 48.58s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [34:53<04:50, 48.45s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [35:41<04:01, 48.31s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [36:29<03:13, 48.35s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [37:19<02:26, 48.75s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [38:08<01:37, 48.95s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [38:56<00:48, 48.65s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [39:13<00:00, 39.21s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [39:13<00:00, 47.08s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.6102} | lm_loss 7.9878 | avg. gen lenth: 279.296
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 8
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 03:14:35,144] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 8
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o8-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                                  | 55/9741 [00:00<00:17, 539.57it/s]  1%|█                                                                                                 | 110/9741 [00:00<00:17, 543.55it/s]  2%|█▋                                                                                                | 165/9741 [00:00<00:17, 545.17it/s]  2%|██▏                                                                                               | 220/9741 [00:00<00:17, 542.97it/s]  3%|██▊                                                                                               | 275/9741 [00:00<00:17, 543.68it/s]  3%|███▎                                                                                              | 330/9741 [00:00<00:17, 544.78it/s]  4%|███▊                                                                                              | 385/9741 [00:00<00:17, 545.34it/s]  5%|████▍                                                                                             | 440/9741 [00:00<00:17, 543.65it/s]  5%|████▉                                                                                             | 495/9741 [00:00<00:17, 538.22it/s]  6%|█████▌                                                                                            | 550/9741 [00:01<00:17, 539.77it/s]  6%|██████                                                                                            | 605/9741 [00:01<00:16, 540.92it/s]  7%|██████▋                                                                                           | 660/9741 [00:01<00:16, 539.52it/s]  7%|███████▏                                                                                          | 715/9741 [00:01<00:16, 540.86it/s]  8%|███████▋                                                                                          | 770/9741 [00:01<00:16, 541.65it/s]  8%|████████▎                                                                                         | 825/9741 [00:01<00:16, 542.43it/s]  9%|████████▊                                                                                         | 880/9741 [00:01<00:16, 543.41it/s] 10%|█████████▍                                                                                        | 935/9741 [00:01<00:16, 541.49it/s] 10%|█████████▉                                                                                        | 990/9741 [00:01<00:16, 539.15it/s] 11%|██████████▍                                                                                      | 1045/9741 [00:01<00:16, 539.90it/s] 11%|██████████▉                                                                                      | 1100/9741 [00:02<00:15, 541.23it/s] 12%|███████████▌                                                                                     | 1155/9741 [00:02<00:15, 540.25it/s] 13%|████████████▏                                                                                    | 1229/9741 [00:02<00:14, 597.71it/s] 13%|█████████████                                                                                    | 1312/9741 [00:02<00:12, 666.22it/s] 14%|█████████████▉                                                                                   | 1394/9741 [00:02<00:11, 711.77it/s] 15%|██████████████▋                                                                                  | 1477/9741 [00:02<00:11, 746.84it/s] 16%|███████████████▌                                                                                 | 1560/9741 [00:02<00:10, 771.51it/s] 17%|████████████████▎                                                                                | 1643/9741 [00:02<00:10, 786.30it/s] 18%|█████████████████▏                                                                               | 1726/9741 [00:02<00:10, 798.78it/s] 19%|█████████████████▉                                                                               | 1806/9741 [00:02<00:10, 782.37it/s] 19%|██████████████████▊                                                                              | 1889/9741 [00:03<00:09, 794.84it/s] 20%|███████████████████▋                                                                             | 1971/9741 [00:03<00:09, 800.24it/s] 21%|████████████████████▍                                                                            | 2053/9741 [00:03<00:09, 805.36it/s] 22%|█████████████████████▎                                                                           | 2136/9741 [00:03<00:09, 811.01it/s] 23%|██████████████████████                                                                           | 2219/9741 [00:03<00:09, 816.35it/s] 24%|██████████████████████▉                                                                          | 2301/9741 [00:03<00:09, 817.29it/s] 24%|███████████████████████▋                                                                         | 2384/9741 [00:03<00:08, 820.99it/s] 25%|████████████████████████▌                                                                        | 2468/9741 [00:03<00:08, 823.73it/s] 26%|█████████████████████████▍                                                                       | 2551/9741 [00:03<00:08, 821.53it/s] 27%|██████████████████████████▏                                                                      | 2635/9741 [00:03<00:08, 824.09it/s] 28%|███████████████████████████                                                                      | 2718/9741 [00:04<00:08, 822.24it/s] 29%|███████████████████████████▉                                                                     | 2801/9741 [00:04<00:08, 823.49it/s] 30%|████████████████████████████▋                                                                    | 2884/9741 [00:04<00:08, 825.39it/s] 30%|█████████████████████████████▌                                                                   | 2967/9741 [00:04<00:08, 823.51it/s] 31%|██████████████████████████████▎                                                                  | 3050/9741 [00:04<00:08, 817.49it/s] 32%|███████████████████████████████▏                                                                 | 3133/9741 [00:04<00:08, 819.72it/s] 33%|████████████████████████████████                                                                 | 3215/9741 [00:04<00:07, 817.93it/s] 34%|████████████████████████████████▊                                                                | 3298/9741 [00:04<00:07, 820.58it/s] 35%|█████████████████████████████████▋                                                               | 3381/9741 [00:04<00:07, 819.52it/s] 36%|██████████████████████████████████▍                                                              | 3464/9741 [00:04<00:07, 821.11it/s] 36%|███████████████████████████████████▎                                                             | 3547/9741 [00:05<00:07, 821.99it/s] 37%|████████████████████████████████████▏                                                            | 3630/9741 [00:05<00:07, 820.73it/s] 38%|████████████████████████████████████▉                                                            | 3713/9741 [00:05<00:07, 822.49it/s] 39%|█████████████████████████████████████▊                                                           | 3796/9741 [00:05<00:07, 823.32it/s] 40%|██████████████████████████████████████▋                                                          | 3879/9741 [00:05<00:07, 822.54it/s] 41%|███████████████████████████████████████▍                                                         | 3962/9741 [00:05<00:07, 823.30it/s] 42%|████████████████████████████████████████▎                                                        | 4045/9741 [00:05<00:06, 824.59it/s] 42%|█████████████████████████████████████████                                                        | 4128/9741 [00:05<00:06, 818.95it/s] 43%|█████████████████████████████████████████▉                                                       | 4211/9741 [00:05<00:06, 820.02it/s] 44%|██████████████████████████████████████████▊                                                      | 4294/9741 [00:05<00:06, 819.92it/s] 45%|███████████████████████████████████████████▌                                                     | 4377/9741 [00:06<00:06, 821.94it/s] 46%|████████████████████████████████████████████▍                                                    | 4460/9741 [00:06<00:06, 821.82it/s] 47%|█████████████████████████████████████████████▏                                                   | 4543/9741 [00:06<00:06, 779.37it/s] 47%|██████████████████████████████████████████████                                                   | 4626/9741 [00:06<00:06, 792.89it/s] 48%|██████████████████████████████████████████████▉                                                  | 4709/9741 [00:06<00:06, 802.65it/s] 49%|███████████████████████████████████████████████▋                                                 | 4790/9741 [00:06<00:07, 652.94it/s] 50%|████████████████████████████████████████████████▌                                                | 4872/9741 [00:06<00:07, 694.32it/s] 51%|█████████████████████████████████████████████████▎                                               | 4953/9741 [00:06<00:06, 724.89it/s] 52%|██████████████████████████████████████████████████▏                                              | 5035/9741 [00:06<00:06, 750.54it/s] 53%|██████████████████████████████████████████████████▉                                              | 5117/9741 [00:07<00:06, 770.11it/s] 53%|███████████████████████████████████████████████████▋                                             | 5196/9741 [00:07<00:05, 775.31it/s] 54%|████████████████████████████████████████████████████▌                                            | 5275/9741 [00:07<00:05, 768.26it/s] 55%|█████████████████████████████████████████████████████▎                                           | 5358/9741 [00:07<00:05, 784.25it/s] 56%|██████████████████████████████████████████████████████▏                                          | 5439/9741 [00:07<00:05, 790.44it/s] 57%|███████████████████████████████████████████████████████                                          | 5524/9741 [00:07<00:05, 805.70it/s] 58%|███████████████████████████████████████████████████████▊                                         | 5610/9741 [00:07<00:05, 820.69it/s] 58%|████████████████████████████████████████████████████████▋                                        | 5696/9741 [00:07<00:04, 829.64it/s] 59%|█████████████████████████████████████████████████████████▌                                       | 5782/9741 [00:07<00:04, 838.48it/s] 60%|██████████████████████████████████████████████████████████▍                                      | 5867/9741 [00:07<00:04, 841.72it/s] 61%|███████████████████████████████████████████████████████████▎                                     | 5953/9741 [00:08<00:04, 846.98it/s] 62%|████████████████████████████████████████████████████████████▏                                    | 6040/9741 [00:08<00:04, 850.98it/s] 63%|█████████████████████████████████████████████████████████████                                    | 6126/9741 [00:08<00:04, 850.22it/s] 64%|█████████████████████████████████████████████████████████████▊                                   | 6212/9741 [00:08<00:04, 852.51it/s] 65%|██████████████████████████████████████████████████████████████▋                                  | 6298/9741 [00:08<00:04, 853.38it/s] 66%|███████████████████████████████████████████████████████████████▌                                 | 6384/9741 [00:08<00:03, 852.42it/s] 66%|████████████████████████████████████████████████████████████████▍                                | 6470/9741 [00:08<00:03, 853.41it/s] 67%|█████████████████████████████████████████████████████████████████▎                               | 6556/9741 [00:08<00:03, 851.62it/s] 68%|██████████████████████████████████████████████████████████████████▏                              | 6642/9741 [00:08<00:03, 852.79it/s] 69%|██████████████████████████████████████████████████████████████████▉                              | 6728/9741 [00:08<00:03, 854.28it/s] 70%|███████████████████████████████████████████████████████████████████▊                             | 6814/9741 [00:09<00:03, 853.43it/s] 71%|████████████████████████████████████████████████████████████████████▋                            | 6900/9741 [00:09<00:03, 852.93it/s] 72%|█████████████████████████████████████████████████████████████████████▌                           | 6986/9741 [00:09<00:03, 854.15it/s] 73%|██████████████████████████████████████████████████████████████████████▍                          | 7072/9741 [00:09<00:03, 852.91it/s] 73%|███████████████████████████████████████████████████████████████████████▎                         | 7158/9741 [00:09<00:03, 854.19it/s] 74%|████████████████████████████████████████████████████████████████████████▏                        | 7244/9741 [00:09<00:02, 851.68it/s] 75%|████████████████████████████████████████████████████████████████████████▉                        | 7330/9741 [00:09<00:02, 853.28it/s] 76%|█████████████████████████████████████████████████████████████████████████▊                       | 7416/9741 [00:09<00:02, 854.74it/s] 77%|██████████████████████████████████████████████████████████████████████████▋                      | 7502/9741 [00:09<00:02, 822.32it/s] 78%|███████████████████████████████████████████████████████████████████████████▌                     | 7588/9741 [00:10<00:02, 830.44it/s] 79%|████████████████████████████████████████████████████████████████████████████▍                    | 7673/9741 [00:10<00:02, 834.67it/s] 80%|█████████████████████████████████████████████████████████████████████████████▎                   | 7759/9741 [00:10<00:02, 841.13it/s] 81%|██████████████████████████████████████████████████████████████████████████████                   | 7845/9741 [00:10<00:02, 845.23it/s] 81%|██████████████████████████████████████████████████████████████████████████████▉                  | 7930/9741 [00:10<00:02, 846.19it/s] 82%|███████████████████████████████████████████████████████████████████████████████▊                 | 8016/9741 [00:10<00:02, 849.47it/s] 83%|████████████████████████████████████████████████████████████████████████████████▋                | 8102/9741 [00:10<00:01, 851.96it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▌               | 8188/9741 [00:10<00:01, 851.43it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▍              | 8274/9741 [00:10<00:01, 852.86it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▏             | 8360/9741 [00:10<00:01, 851.07it/s] 87%|████████████████████████████████████████████████████████████████████████████████████             | 8446/9741 [00:11<00:01, 853.24it/s] 88%|████████████████████████████████████████████████████████████████████████████████████▉            | 8532/9741 [00:11<00:01, 853.61it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▊           | 8618/9741 [00:11<00:01, 851.19it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▋          | 8704/9741 [00:11<00:01, 852.99it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▌         | 8790/9741 [00:11<00:01, 853.52it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▍        | 8876/9741 [00:11<00:01, 852.05it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▏       | 8962/9741 [00:11<00:00, 853.31it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████       | 9048/9741 [00:11<00:00, 851.14it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████████▉      | 9134/9741 [00:11<00:00, 852.90it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████▊     | 9220/9741 [00:11<00:00, 853.26it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▋    | 9306/9741 [00:12<00:00, 851.81it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▌   | 9392/9741 [00:12<00:00, 853.20it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████▍  | 9478/9741 [00:12<00:00, 854.13it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████▏ | 9564/9741 [00:12<00:00, 852.71it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████ | 9650/9741 [00:12<00:00, 853.29it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████▉| 9736/9741 [00:12<00:00, 851.65it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:12<00:00, 776.92it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:04<00:09,  4.86s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.41s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.43s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:09<00:04,  4.89s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.52s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.49s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.57s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.27s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.44s/it]
[2023-08-18 03:15:38,365] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.87s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.03s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.84s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.01s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.34s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.38s/it]
[2023-08-18 03:15:57,202] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 03:15:57,203] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7ff4fbe33e80>
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 03:15:57,204] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7ff4fbe33dc0>
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 03:15:57,205] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 03:15:57,205] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.41498327255249023 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o8-tgsm8k-s1-rFalse
Time to load utils op: 0.3042111396789551 seconds
Loading extension module utils...
Time to load utils op: 0.30412960052490234 seconds
Loading extension module utils...
Time to load utils op: 0.40442371368408203 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:47<39:09, 47.95s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:35<38:17, 47.87s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:23<37:32, 47.93s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:11<36:41, 47.86s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:59<35:55, 47.89s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:47<35:07, 47.89s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:34<34:07, 47.61s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:21<33:16, 47.53s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [07:10<32:38, 47.77s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [07:58<32:01, 48.04s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [08:39<29:50, 45.91s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [09:27<29:24, 46.42s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [10:10<28:02, 45.47s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [10:58<27:45, 46.25s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [11:46<27:10, 46.58s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [12:34<26:46, 47.25s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [13:22<26:02, 47.34s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [14:09<25:16, 47.38s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [14:57<24:34, 47.58s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [15:46<23:55, 47.86s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [16:33<23:04, 47.74s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [17:11<20:52, 44.73s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [17:59<20:30, 45.57s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [18:28<17:41, 40.83s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [19:17<17:57, 43.12s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [19:54<16:33, 41.41s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [20:42<16:38, 43.43s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [21:31<16:26, 44.86s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [22:11<15:12, 43.43s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [22:59<14:57, 44.85s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [23:47<14:31, 45.86s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [24:35<13:56, 46.49s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [25:23<13:19, 47.02s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [26:12<12:39, 47.49s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [26:33<09:54, 39.62s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [27:21<09:50, 42.17s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [28:10<09:33, 44.13s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [28:58<09:04, 45.36s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [29:45<08:24, 45.90s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [30:32<07:41, 46.18s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [31:20<07:00, 46.68s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [32:09<06:17, 47.23s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [32:57<05:32, 47.47s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [33:44<04:44, 47.42s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [34:32<03:58, 47.70s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [35:20<03:10, 47.66s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [36:07<02:22, 47.66s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [36:55<01:35, 47.65s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [37:43<00:47, 47.59s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [38:30<00:00, 47.52s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [38:30<00:00, 46.21s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.2237} | lm_loss 8.0387 | avg. gen lenth: 278.58
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 9
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 03:54:54,018] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 9
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o9-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                                  | 51/9741 [00:00<00:19, 507.36it/s]  1%|█                                                                                                 | 103/9741 [00:00<00:18, 510.40it/s]  2%|█▌                                                                                                | 155/9741 [00:00<00:18, 511.38it/s]  2%|██                                                                                                | 207/9741 [00:00<00:18, 508.83it/s]  3%|██▌                                                                                               | 259/9741 [00:00<00:18, 509.77it/s]  3%|███▏                                                                                              | 311/9741 [00:00<00:18, 510.95it/s]  4%|███▋                                                                                              | 363/9741 [00:00<00:18, 504.38it/s]  4%|████▏                                                                                             | 414/9741 [00:00<00:18, 505.71it/s]  5%|████▋                                                                                             | 465/9741 [00:00<00:18, 504.89it/s]  5%|█████▏                                                                                            | 517/9741 [00:01<00:18, 506.96it/s]  6%|█████▋                                                                                            | 568/9741 [00:01<00:18, 507.85it/s]  6%|██████▏                                                                                           | 619/9741 [00:01<00:17, 508.26it/s]  7%|██████▋                                                                                           | 670/9741 [00:01<00:17, 506.84it/s]  7%|███████▎                                                                                          | 722/9741 [00:01<00:17, 508.26it/s]  8%|███████▊                                                                                          | 774/9741 [00:01<00:17, 509.42it/s]  9%|████████▎                                                                                         | 832/9741 [00:01<00:16, 529.57it/s]  9%|█████████                                                                                         | 907/9741 [00:01<00:14, 594.78it/s] 10%|█████████▉                                                                                        | 985/9741 [00:01<00:13, 648.10it/s] 11%|██████████▌                                                                                      | 1063/9741 [00:01<00:12, 686.16it/s] 12%|███████████▎                                                                                     | 1141/9741 [00:02<00:12, 711.62it/s] 13%|████████████▏                                                                                    | 1219/9741 [00:02<00:11, 731.08it/s] 13%|████████████▉                                                                                    | 1297/9741 [00:02<00:11, 744.79it/s] 14%|█████████████▋                                                                                   | 1374/9741 [00:02<00:11, 752.13it/s] 15%|██████████████▍                                                                                  | 1452/9741 [00:02<00:10, 759.15it/s] 16%|███████████████▏                                                                                 | 1530/9741 [00:02<00:10, 763.74it/s] 16%|████████████████                                                                                 | 1607/9741 [00:02<00:10, 764.69it/s] 17%|████████████████▊                                                                                | 1685/9741 [00:02<00:10, 768.48it/s] 18%|█████████████████▌                                                                               | 1763/9741 [00:02<00:10, 770.03it/s] 19%|██████████████████▎                                                                              | 1841/9741 [00:02<00:10, 743.96it/s] 20%|███████████████████                                                                              | 1919/9741 [00:03<00:10, 752.22it/s] 21%|███████████████████▉                                                                             | 1997/9741 [00:03<00:10, 758.50it/s] 21%|████████████████████▋                                                                            | 2074/9741 [00:03<00:10, 759.52it/s] 22%|█████████████████████▍                                                                           | 2152/9741 [00:03<00:09, 762.96it/s] 23%|██████████████████████▏                                                                          | 2230/9741 [00:03<00:09, 766.15it/s] 24%|██████████████████████▉                                                                          | 2307/9741 [00:03<00:09, 765.90it/s] 24%|███████████████████████▋                                                                         | 2385/9741 [00:03<00:09, 767.59it/s] 25%|████████████████████████▌                                                                        | 2463/9741 [00:03<00:09, 770.38it/s] 26%|█████████████████████████▎                                                                       | 2541/9741 [00:03<00:09, 768.38it/s] 27%|██████████████████████████                                                                       | 2619/9741 [00:03<00:09, 768.93it/s] 28%|██████████████████████████▊                                                                      | 2696/9741 [00:04<00:09, 768.70it/s] 28%|███████████████████████████▌                                                                     | 2773/9741 [00:04<00:09, 766.49it/s] 29%|████████████████████████████▍                                                                    | 2851/9741 [00:04<00:08, 768.01it/s] 30%|█████████████████████████████▏                                                                   | 2928/9741 [00:04<00:08, 763.89it/s] 31%|█████████████████████████████▉                                                                   | 3006/9741 [00:04<00:08, 766.20it/s] 32%|██████████████████████████████▋                                                                  | 3084/9741 [00:04<00:08, 767.60it/s] 32%|███████████████████████████████▍                                                                 | 3161/9741 [00:04<00:08, 766.49it/s] 33%|████████████████████████████████▎                                                                | 3239/9741 [00:04<00:08, 769.19it/s] 34%|█████████████████████████████████                                                                | 3317/9741 [00:04<00:08, 769.87it/s] 35%|█████████████████████████████████▊                                                               | 3394/9741 [00:04<00:08, 766.87it/s] 36%|██████████████████████████████████▌                                                              | 3472/9741 [00:05<00:08, 768.15it/s] 36%|███████████████████████████████████▎                                                             | 3550/9741 [00:05<00:08, 769.31it/s] 37%|████████████████████████████████████                                                             | 3627/9741 [00:05<00:07, 767.16it/s] 38%|████████████████████████████████████▉                                                            | 3705/9741 [00:05<00:07, 768.59it/s] 39%|█████████████████████████████████████▋                                                           | 3783/9741 [00:05<00:07, 770.37it/s] 40%|██████████████████████████████████████▍                                                          | 3861/9741 [00:05<00:07, 769.17it/s] 40%|███████████████████████████████████████▏                                                         | 3938/9741 [00:05<00:07, 762.55it/s] 41%|███████████████████████████████████████▉                                                         | 4016/9741 [00:05<00:07, 765.24it/s] 42%|████████████████████████████████████████▊                                                        | 4093/9741 [00:05<00:07, 765.29it/s] 43%|█████████████████████████████████████████▌                                                       | 4170/9741 [00:05<00:07, 765.35it/s] 44%|██████████████████████████████████████████▎                                                      | 4247/9741 [00:06<00:07, 766.60it/s] 44%|███████████████████████████████████████████                                                      | 4324/9741 [00:06<00:07, 765.17it/s] 45%|███████████████████████████████████████████▊                                                     | 4402/9741 [00:06<00:06, 767.07it/s] 46%|████████████████████████████████████████████▌                                                    | 4480/9741 [00:06<00:06, 768.30it/s] 47%|█████████████████████████████████████████████▍                                                   | 4557/9741 [00:06<00:07, 732.02it/s] 48%|██████████████████████████████████████████████▏                                                  | 4635/9741 [00:06<00:06, 743.90it/s] 48%|██████████████████████████████████████████████▉                                                  | 4713/9741 [00:06<00:06, 752.13it/s] 49%|███████████████████████████████████████████████▋                                                 | 4789/9741 [00:06<00:08, 557.99it/s] 50%|████████████████████████████████████████████████▍                                                | 4864/9741 [00:07<00:08, 602.56it/s] 51%|█████████████████████████████████████████████████▏                                               | 4941/9741 [00:07<00:07, 644.43it/s] 51%|█████████████████████████████████████████████████▉                                               | 5016/9741 [00:07<00:07, 670.28it/s] 52%|██████████████████████████████████████████████████▋                                              | 5093/9741 [00:07<00:06, 696.69it/s] 53%|███████████████████████████████████████████████████▍                                             | 5171/9741 [00:07<00:06, 716.01it/s] 54%|████████████████████████████████████████████████████▎                                            | 5249/9741 [00:07<00:06, 731.64it/s] 55%|█████████████████████████████████████████████████████                                            | 5327/9741 [00:07<00:05, 742.84it/s] 55%|█████████████████████████████████████████████████████▊                                           | 5404/9741 [00:07<00:05, 748.71it/s] 56%|██████████████████████████████████████████████████████▌                                          | 5482/9741 [00:07<00:05, 756.55it/s] 57%|███████████████████████████████████████████████████████▍                                         | 5563/9741 [00:07<00:05, 771.16it/s] 58%|████████████████████████████████████████████████████████▏                                        | 5643/9741 [00:08<00:05, 777.53it/s] 59%|████████████████████████████████████████████████████████▉                                        | 5724/9741 [00:08<00:05, 786.16it/s] 60%|█████████████████████████████████████████████████████████▊                                       | 5805/9741 [00:08<00:04, 792.26it/s] 60%|██████████████████████████████████████████████████████████▌                                      | 5885/9741 [00:08<00:04, 785.51it/s] 61%|███████████████████████████████████████████████████████████▍                                     | 5966/9741 [00:08<00:04, 791.39it/s] 62%|████████████████████████████████████████████████████████████▏                                    | 6047/9741 [00:08<00:04, 795.82it/s] 63%|█████████████████████████████████████████████████████████████                                    | 6127/9741 [00:08<00:04, 795.98it/s] 64%|█████████████████████████████████████████████████████████████▊                                   | 6208/9741 [00:08<00:04, 799.22it/s] 65%|██████████████████████████████████████████████████████████████▋                                  | 6289/9741 [00:08<00:04, 800.49it/s] 65%|███████████████████████████████████████████████████████████████▍                                 | 6370/9741 [00:08<00:04, 799.62it/s] 66%|████████████████████████████████████████████████████████████████▏                                | 6451/9741 [00:09<00:04, 801.70it/s] 67%|█████████████████████████████████████████████████████████████████                                | 6532/9741 [00:09<00:03, 802.61it/s] 68%|█████████████████████████████████████████████████████████████████▊                               | 6613/9741 [00:09<00:03, 800.77it/s] 69%|██████████████████████████████████████████████████████████████████▋                              | 6694/9741 [00:09<00:03, 802.25it/s] 70%|███████████████████████████████████████████████████████████████████▍                             | 6775/9741 [00:09<00:03, 800.72it/s] 70%|████████████████████████████████████████████████████████████████████▎                            | 6856/9741 [00:09<00:03, 801.90it/s] 71%|█████████████████████████████████████████████████████████████████████                            | 6937/9741 [00:09<00:03, 803.66it/s] 72%|█████████████████████████████████████████████████████████████████████▉                           | 7018/9741 [00:09<00:03, 801.95it/s] 73%|██████████████████████████████████████████████████████████████████████▋                          | 7099/9741 [00:09<00:03, 779.20it/s] 74%|███████████████████████████████████████████████████████████████████████▍                         | 7180/9741 [00:09<00:03, 787.39it/s] 75%|████████████████████████████████████████████████████████████████████████▎                        | 7260/9741 [00:10<00:03, 789.41it/s] 75%|█████████████████████████████████████████████████████████████████████████                        | 7341/9741 [00:10<00:03, 794.94it/s] 76%|█████████████████████████████████████████████████████████████████████████▉                       | 7423/9741 [00:10<00:02, 799.44it/s] 77%|██████████████████████████████████████████████████████████████████████████▋                      | 7503/9741 [00:10<00:02, 767.86it/s] 78%|███████████████████████████████████████████████████████████████████████████▌                     | 7584/9741 [00:10<00:02, 777.77it/s] 79%|████████████████████████████████████████████████████████████████████████████▎                    | 7665/9741 [00:10<00:02, 785.13it/s] 80%|█████████████████████████████████████████████████████████████████████████████                    | 7745/9741 [00:10<00:02, 788.96it/s] 80%|█████████████████████████████████████████████████████████████████████████████▉                   | 7826/9741 [00:10<00:02, 793.41it/s] 81%|██████████████████████████████████████████████████████████████████████████████▋                  | 7906/9741 [00:10<00:02, 794.70it/s] 82%|███████████████████████████████████████████████████████████████████████████████▌                 | 7987/9741 [00:10<00:02, 798.80it/s] 83%|████████████████████████████████████████████████████████████████████████████████▎                | 8068/9741 [00:11<00:02, 800.59it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▏               | 8149/9741 [00:11<00:01, 800.49it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▉               | 8230/9741 [00:11<00:01, 802.27it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▊              | 8311/9741 [00:11<00:01, 802.89it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▌             | 8392/9741 [00:11<00:01, 800.82it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▎            | 8473/9741 [00:11<00:01, 801.87it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▏           | 8554/9741 [00:11<00:01, 801.96it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▉           | 8635/9741 [00:11<00:01, 799.25it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▊          | 8716/9741 [00:11<00:01, 800.81it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▌         | 8797/9741 [00:11<00:01, 800.48it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▍        | 8878/9741 [00:12<00:01, 799.32it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▏       | 8959/9741 [00:12<00:00, 800.58it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████       | 9040/9741 [00:12<00:00, 799.14it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████████▊      | 9121/9741 [00:12<00:00, 800.67it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▋     | 9202/9741 [00:12<00:00, 802.36it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▍    | 9283/9741 [00:12<00:00, 800.35it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▏   | 9364/9741 [00:12<00:00, 798.89it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████   | 9445/9741 [00:12<00:00, 799.56it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▊  | 9525/9741 [00:12<00:00, 798.92it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▋ | 9606/9741 [00:12<00:00, 800.41it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▍| 9687/9741 [00:13<00:00, 801.42it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:13<00:00, 739.79it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.30s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.16s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.19s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.36s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.09s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.06s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.30s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.52s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]
[2023-08-18 03:55:58,583] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.62s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
[2023-08-18 03:56:07,135] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 03:56:07,136] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f5b66f17310>
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 03:56:07,137] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f5b66f17e50>
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 03:56:07,138] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 03:56:07,139] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 03:56:07,139] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 03:56:07,139] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 03:56:07,139] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 03:56:07,139] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 03:56:07,139] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 03:56:07,139] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 03:56:07,139] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 03:56:07,139] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 03:56:07,139] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 03:56:07,139] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 03:56:07,139] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 03:56:07,139] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.41851139068603516 seconds
Loading extension module utils...
Time to load utils op: 0.40456652641296387 seconds
Loading extension module utils...
Time to load utils op: 0.5048727989196777 seconds
Loading extension module utils...
Time to load utils op: 0.5046064853668213 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o9-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:47<38:36, 47.28s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:33<37:31, 46.90s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:21<36:51, 47.05s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:08<36:05, 47.08s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:46<32:57, 43.94s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:34<33:09, 45.22s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:07<29:32, 41.21s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [05:54<30:05, 42.99s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [06:34<28:48, 42.15s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [07:22<29:16, 43.92s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [08:09<29:12, 44.94s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [08:57<28:56, 45.71s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [09:44<28:28, 46.18s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [10:31<27:49, 46.38s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [11:17<27:08, 46.53s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [12:05<26:26, 46.68s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [12:52<25:46, 46.87s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [13:36<24:32, 46.03s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [14:22<23:48, 46.09s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [15:10<23:15, 46.51s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [15:57<22:36, 46.77s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [16:27<19:28, 41.72s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [17:14<19:28, 43.27s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [18:01<19:16, 44.49s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [18:48<18:50, 45.22s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [19:36<18:26, 46.09s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [20:24<17:50, 46.54s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [21:11<17:10, 46.85s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [21:59<16:26, 47.00s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [22:31<14:13, 42.65s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [23:19<14:00, 44.23s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [24:07<13:34, 45.23s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [24:54<13:01, 45.96s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [25:42<12:23, 46.44s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [26:30<11:42, 46.86s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [27:17<10:58, 47.03s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [28:06<10:16, 47.42s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [28:53<09:29, 47.50s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [29:41<08:42, 47.49s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [30:07<06:50, 41.08s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [30:53<06:24, 42.75s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [31:05<04:26, 33.25s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [31:52<04:21, 37.38s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [32:36<03:57, 39.57s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [33:23<03:29, 41.82s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [34:11<02:54, 43.66s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [34:58<02:14, 44.68s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [35:26<01:19, 39.51s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [36:13<00:41, 41.97s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [37:01<00:00, 43.58s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [37:01<00:00, 44.43s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.8544} | lm_loss 8.0201 | avg. gen lenth: 263.64
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 04:34:52,879] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  2%|██                                                                                               | 204/9741 [00:00<00:04, 2037.94it/s]  4%|████                                                                                             | 412/9741 [00:00<00:04, 2060.44it/s]  6%|██████▏                                                                                          | 620/9741 [00:00<00:04, 2065.12it/s]  9%|████████▎                                                                                        | 830/9741 [00:00<00:04, 2076.07it/s] 11%|██████████▏                                                                                     | 1040/9741 [00:00<00:04, 2083.34it/s] 13%|████████████▎                                                                                   | 1249/9741 [00:00<00:04, 2081.42it/s] 15%|██████████████▎                                                                                 | 1458/9741 [00:00<00:03, 2077.71it/s] 17%|████████████████▍                                                                               | 1666/9741 [00:00<00:03, 2076.77it/s] 19%|██████████████████▍                                                                             | 1874/9741 [00:00<00:03, 1982.40it/s] 21%|████████████████████▍                                                                           | 2078/9741 [00:01<00:03, 1999.52it/s] 23%|██████████████████████▌                                                                         | 2284/9741 [00:01<00:03, 2016.25it/s] 26%|████████████████████████▌                                                                       | 2493/9741 [00:01<00:03, 2038.00it/s] 28%|██████████████████████████▌                                                                     | 2700/9741 [00:01<00:03, 2046.49it/s] 30%|████████████████████████████▋                                                                   | 2907/9741 [00:01<00:03, 2053.39it/s] 32%|██████████████████████████████▋                                                                 | 3114/9741 [00:01<00:03, 2056.67it/s] 34%|████████████████████████████████▋                                                               | 3323/9741 [00:01<00:03, 2062.23it/s] 36%|██████████████████████████████████▊                                                             | 3531/9741 [00:01<00:03, 2065.16it/s] 38%|████████████████████████████████████▊                                                           | 3739/9741 [00:01<00:02, 2068.71it/s] 41%|██████████████████████████████████████▉                                                         | 3946/9741 [00:01<00:02, 2059.37it/s] 43%|████████████████████████████████████████▉                                                       | 4152/9741 [00:02<00:02, 2050.12it/s] 45%|██████████████████████████████████████████▉                                                     | 4361/9741 [00:02<00:02, 2061.30it/s] 47%|█████████████████████████████████████████████                                                   | 4568/9741 [00:02<00:02, 2029.76it/s] 49%|███████████████████████████████████████████████                                                 | 4772/9741 [00:02<00:03, 1492.01it/s] 51%|█████████████████████████████████████████████████                                               | 4980/9741 [00:02<00:02, 1630.24it/s] 53%|███████████████████████████████████████████████████▏                                            | 5189/9741 [00:02<00:02, 1744.63it/s] 55%|█████████████████████████████████████████████████████▏                                          | 5398/9741 [00:02<00:02, 1834.87it/s] 58%|███████████████████████████████████████████████████████▎                                        | 5613/9741 [00:02<00:02, 1919.69it/s] 60%|█████████████████████████████████████████████████████████▍                                      | 5830/9741 [00:02<00:01, 1989.73it/s] 62%|███████████████████████████████████████████████████████████▌                                    | 6049/9741 [00:03<00:01, 2045.36it/s] 64%|█████████████████████████████████████████████████████████████▋                                  | 6265/9741 [00:03<00:01, 2077.79it/s] 66%|███████████████████████████████████████████████████████████████▊                                | 6477/9741 [00:03<00:01, 2073.81it/s] 69%|█████████████████████████████████████████████████████████████████▉                              | 6692/9741 [00:03<00:01, 2093.33it/s] 71%|████████████████████████████████████████████████████████████████████                            | 6909/9741 [00:03<00:01, 2115.24it/s] 73%|██████████████████████████████████████████████████████████████████████▏                         | 7126/9741 [00:03<00:01, 2130.18it/s] 75%|████████████████████████████████████████████████████████████████████████▎                       | 7343/9741 [00:03<00:01, 2140.30it/s] 78%|██████████████████████████████████████████████████████████████████████████▍                     | 7558/9741 [00:03<00:01, 2108.41it/s] 81%|█████████████████████████████████████████████████████████████████████████████▋                  | 7889/9741 [00:03<00:00, 2461.95it/s] 84%|█████████████████████████████████████████████████████████████████████████████████               | 8219/9741 [00:03<00:00, 2710.20it/s] 88%|████████████████████████████████████████████████████████████████████████████████████▎           | 8550/9741 [00:04<00:00, 2886.40it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████▌        | 8879/9741 [00:04<00:00, 3006.05it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████▊     | 9210/9741 [00:04<00:00, 3095.60it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████  | 9541/9741 [00:04<00:00, 3158.28it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:04<00:00, 2201.49it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.24s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.31s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.45s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.49s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.35s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.41s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.65s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.61s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.83s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.98s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.92s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.08s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.13s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.25s/it]
[2023-08-18 04:35:51,481] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-18 04:36:02,794] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 04:36:02,795] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 04:36:02,795] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 04:36:02,795] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 04:36:02,795] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 04:36:02,795] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 04:36:02,795] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 04:36:02,795] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 04:36:02,795] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 04:36:02,795] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 04:36:02,795] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f847b9f3310>
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f847b9f3e50>
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 04:36:02,796] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 04:36:02,797] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 04:36:02,797] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 04:36:02,797] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 04:36:02,797] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 04:36:02,797] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 04:36:02,797] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 04:36:02,797] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3970675468444824 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Time to load utils op: 0.3042409420013428 seconds
Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s10-rTrue
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.3042788505554199 seconds
Time to load utils op: 0.3043959140777588 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:55<45:41, 55.95s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:51<44:31, 55.66s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:48<43:57, 56.12s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:44<42:58, 56.06s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:40<42:09, 56.22s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [05:35<40:48, 55.65s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [06:30<39:52, 55.63s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [07:27<39:09, 55.94s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [08:09<35:14, 51.58s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [09:01<34:28, 51.72s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [09:56<34:18, 52.79s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [10:52<33:57, 53.62s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [11:49<33:46, 54.76s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [12:45<33:03, 55.10s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [13:39<32:04, 54.98s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [14:36<31:23, 55.39s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [15:10<26:57, 49.01s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [16:06<27:11, 50.99s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [17:01<26:59, 52.25s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [17:57<26:39, 53.32s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [18:27<22:28, 46.50s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [19:23<23:01, 49.33s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [20:19<23:07, 51.38s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [21:14<22:38, 52.24s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [22:09<22:08, 53.13s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [23:01<21:06, 52.79s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [23:57<20:41, 53.98s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [24:42<18:45, 51.16s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [25:40<18:35, 53.13s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [26:36<17:59, 53.97s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [27:32<17:17, 54.63s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [28:29<16:37, 55.40s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [29:25<15:44, 55.54s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [30:20<14:46, 55.40s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [31:17<13:57, 55.84s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [32:12<12:56, 55.47s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [33:09<12:08, 56.05s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [34:04<11:07, 55.65s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [35:01<10:18, 56.21s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [35:57<09:22, 56.24s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [36:55<08:28, 56.48s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [37:51<07:31, 56.39s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [38:48<06:35, 56.55s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [39:43<05:36, 56.05s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [40:39<04:41, 56.29s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [41:21<03:27, 51.92s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [42:17<02:39, 53.16s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [43:12<01:47, 53.81s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [44:09<00:54, 54.70s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [45:04<00:00, 54.83s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [45:04<00:00, 54.10s/it]
name: commonsenseqa | {'exact_match': 1.2, 'rougeL': 4.5132} | lm_loss 7.8956 | avg. gen lenth: 285.18
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 05:21:17,090] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|█▏                                                                                               | 120/9741 [00:00<00:08, 1197.98it/s]  2%|██▍                                                                                              | 240/9741 [00:00<00:07, 1196.85it/s]  4%|███▌                                                                                             | 361/9741 [00:00<00:07, 1199.61it/s]  5%|████▊                                                                                            | 482/9741 [00:00<00:07, 1200.13it/s]  6%|██████                                                                                           | 603/9741 [00:00<00:07, 1202.16it/s]  7%|███████▏                                                                                         | 724/9741 [00:00<00:07, 1202.32it/s]  9%|████████▍                                                                                        | 846/9741 [00:00<00:07, 1207.43it/s] 10%|█████████▋                                                                                       | 967/9741 [00:00<00:07, 1207.48it/s] 11%|██████████▋                                                                                     | 1088/9741 [00:00<00:07, 1188.85it/s] 12%|███████████▉                                                                                    | 1207/9741 [00:01<00:07, 1189.07it/s] 14%|█████████████                                                                                   | 1328/9741 [00:01<00:07, 1193.92it/s] 15%|██████████████▎                                                                                 | 1448/9741 [00:01<00:06, 1195.23it/s] 16%|███████████████▍                                                                                | 1569/9741 [00:01<00:06, 1197.82it/s] 17%|████████████████▋                                                                               | 1690/9741 [00:01<00:06, 1201.22it/s] 19%|█████████████████▊                                                                              | 1811/9741 [00:01<00:06, 1168.97it/s] 20%|███████████████████                                                                             | 1932/9741 [00:01<00:06, 1179.39it/s] 21%|████████████████████▏                                                                           | 2052/9741 [00:01<00:06, 1184.48it/s] 22%|█████████████████████▍                                                                          | 2173/9741 [00:01<00:06, 1191.18it/s] 24%|██████████████████████▌                                                                         | 2293/9741 [00:01<00:06, 1188.76it/s] 25%|███████████████████████▊                                                                        | 2414/9741 [00:02<00:06, 1194.38it/s] 26%|████████████████████████▉                                                                       | 2534/9741 [00:02<00:06, 1195.60it/s] 27%|██████████████████████████▏                                                                     | 2656/9741 [00:02<00:05, 1200.32it/s] 29%|███████████████████████████▎                                                                    | 2777/9741 [00:02<00:05, 1199.06it/s] 30%|████████████████████████████▌                                                                   | 2898/9741 [00:02<00:05, 1200.85it/s] 31%|█████████████████████████████▊                                                                  | 3019/9741 [00:02<00:05, 1201.23it/s] 32%|███████████████████████████████                                                                 | 3151/9741 [00:02<00:05, 1233.36it/s] 34%|████████████████████████████████▉                                                               | 3336/9741 [00:02<00:04, 1415.53it/s] 36%|██████████████████████████████████▋                                                             | 3519/9741 [00:02<00:04, 1538.43it/s] 38%|████████████████████████████████████▍                                                           | 3702/9741 [00:02<00:03, 1623.55it/s] 40%|██████████████████████████████████████▎                                                         | 3885/9741 [00:03<00:03, 1684.03it/s] 42%|████████████████████████████████████████                                                        | 4068/9741 [00:03<00:03, 1725.90it/s] 44%|█████████████████████████████████████████▊                                                      | 4245/9741 [00:03<00:03, 1737.01it/s] 45%|███████████████████████████████████████████▋                                                    | 4427/9741 [00:03<00:03, 1759.97it/s] 47%|█████████████████████████████████████████████▎                                                  | 4604/9741 [00:03<00:02, 1721.09it/s] 49%|███████████████████████████████████████████████                                                 | 4777/9741 [00:03<00:03, 1456.08it/s] 51%|████████████████████████████████████████████████▊                                               | 4957/9741 [00:03<00:03, 1545.38it/s] 53%|██████████████████████████████████████████████████▋                                             | 5140/9741 [00:03<00:02, 1621.13it/s] 55%|████████████████████████████████████████████████████▍                                           | 5321/9741 [00:03<00:02, 1672.58it/s] 57%|██████████████████████████████████████████████████████▏                                         | 5504/9741 [00:04<00:02, 1715.36it/s] 58%|████████████████████████████████████████████████████████                                        | 5694/9741 [00:04<00:02, 1766.68it/s] 60%|█████████████████████████████████████████████████████████▉                                      | 5885/9741 [00:04<00:02, 1805.84it/s] 62%|███████████████████████████████████████████████████████████▉                                    | 6077/9741 [00:04<00:01, 1838.21it/s] 64%|█████████████████████████████████████████████████████████████▊                                  | 6266/9741 [00:04<00:01, 1853.01it/s] 66%|███████████████████████████████████████████████████████████████▌                                | 6453/9741 [00:04<00:01, 1842.96it/s] 68%|█████████████████████████████████████████████████████████████████▍                              | 6641/9741 [00:04<00:01, 1852.38it/s] 70%|███████████████████████████████████████████████████████████████████▎                            | 6831/9741 [00:04<00:01, 1864.43it/s] 72%|█████████████████████████████████████████████████████████████████████▏                          | 7021/9741 [00:04<00:01, 1874.53it/s] 74%|███████████████████████████████████████████████████████████████████████                         | 7213/9741 [00:04<00:01, 1886.29it/s] 76%|████████████████████████████████████████████████████████████████████████▉                       | 7404/9741 [00:05<00:01, 1891.41it/s] 78%|██████████████████████████████████████████████████████████████████████████▊                     | 7594/9741 [00:05<00:01, 1823.95it/s] 80%|████████████████████████████████████████████████████████████████████████████▋                   | 7784/9741 [00:05<00:01, 1844.39it/s] 82%|██████████████████████████████████████████████████████████████████████████████▌                 | 7974/9741 [00:05<00:00, 1859.50it/s] 84%|████████████████████████████████████████████████████████████████████████████████▍               | 8164/9741 [00:05<00:00, 1870.88it/s] 86%|██████████████████████████████████████████████████████████████████████████████████▎             | 8354/9741 [00:05<00:00, 1877.38it/s] 88%|████████████████████████████████████████████████████████████████████████████████████▏           | 8545/9741 [00:05<00:00, 1886.49it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████          | 8735/9741 [00:05<00:00, 1888.64it/s] 92%|███████████████████████████████████████████████████████████████████████████████████████▉        | 8924/9741 [00:05<00:00, 1882.64it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████▊      | 9113/9741 [00:05<00:00, 1882.06it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████▋    | 9303/9741 [00:06<00:00, 1885.96it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▌  | 9492/9741 [00:06<00:00, 1883.06it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▍| 9683/9741 [00:06<00:00, 1888.44it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:06<00:00, 1557.37it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.39s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:04<00:09,  4.91s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.36s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.53s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.06s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:09<00:04,  4.97s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.49s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.32s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.49s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.49s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.93s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.97s/it]
[2023-08-18 05:22:15,586] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-18 05:22:25,738] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 05:22:25,740] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 05:22:25,742] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 05:22:25,742] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 05:22:25,742] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 05:22:25,742] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f2e54218e80>
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 05:22:25,743] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f2e54218dc0>
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 05:22:25,744] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 05:22:25,745] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 05:22:25,745] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 05:22:25,745] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 05:22:25,745] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3658754825592041 seconds
Loading extension module utils...
Time to load utils op: 0.3042476177215576 seconds
Loading extension module utils...
Time to load utils op: 0.20401811599731445 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s10-rTrue
Loading extension module utils...
Time to load utils op: 0.40453147888183594 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:52<42:58, 52.62s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:44<41:58, 52.47s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:36<40:43, 51.99s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:28<39:59, 52.16s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:21<39:14, 52.33s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [05:13<38:15, 52.18s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [06:06<37:37, 52.49s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:58<36:37, 52.31s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [07:50<35:38, 52.17s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [08:42<34:46, 52.16s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [09:33<33:46, 51.96s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [10:25<32:54, 51.96s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [11:18<32:15, 52.30s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [12:11<31:24, 52.35s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [13:03<30:25, 52.16s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [13:32<25:38, 45.26s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [14:24<26:02, 47.36s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [15:17<26:10, 49.08s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [16:10<25:55, 50.18s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [17:02<25:17, 50.60s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [17:55<24:48, 51.34s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [18:47<24:10, 51.80s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [19:41<23:29, 52.22s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [20:25<21:36, 49.88s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [21:17<21:05, 50.62s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [22:11<20:37, 51.57s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [23:03<19:49, 51.73s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [23:56<19:06, 52.13s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [24:48<18:13, 52.07s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [25:40<17:18, 51.93s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [26:32<16:28, 52.03s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [27:26<15:45, 52.50s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [28:19<14:55, 52.67s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [29:12<14:04, 52.75s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [30:05<13:13, 52.89s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [30:58<12:22, 53.01s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [31:50<11:25, 52.75s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [32:27<09:35, 47.96s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [33:21<09:06, 49.66s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [34:13<08:24, 50.41s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [35:06<07:39, 51.07s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [35:58<06:51, 51.39s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [36:51<06:02, 51.82s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [37:42<05:10, 51.79s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [38:35<04:20, 52.05s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [39:27<03:28, 52.18s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [40:21<02:37, 52.50s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [41:14<01:45, 52.79s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [41:34<00:42, 42.79s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [42:26<00:00, 45.68s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [42:26<00:00, 50.93s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 2.7675} | lm_loss 7.8492 | avg. gen lenth: 300.76
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 06:05:26,217] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|▉                                                                                                  | 93/9741 [00:00<00:10, 920.39it/s]  2%|█▊                                                                                                | 186/9741 [00:00<00:10, 925.61it/s]  3%|██▊                                                                                               | 279/9741 [00:00<00:10, 925.44it/s]  4%|███▊                                                                                              | 373/9741 [00:00<00:10, 928.09it/s]  5%|████▋                                                                                             | 466/9741 [00:00<00:10, 927.19it/s]  6%|█████▋                                                                                            | 560/9741 [00:00<00:09, 930.08it/s]  7%|██████▌                                                                                           | 654/9741 [00:00<00:09, 928.95it/s]  8%|███████▌                                                                                          | 748/9741 [00:00<00:09, 931.08it/s]  9%|████████▍                                                                                         | 842/9741 [00:00<00:09, 918.46it/s] 10%|█████████▍                                                                                        | 934/9741 [00:01<00:09, 918.23it/s] 11%|██████████▏                                                                                      | 1028/9741 [00:01<00:09, 923.69it/s] 12%|███████████▏                                                                                     | 1122/9741 [00:01<00:09, 925.74it/s] 12%|████████████                                                                                     | 1216/9741 [00:01<00:09, 928.07it/s] 13%|█████████████                                                                                    | 1310/9741 [00:01<00:09, 930.72it/s] 14%|█████████████▉                                                                                   | 1404/9741 [00:01<00:08, 929.21it/s] 15%|██████████████▉                                                                                  | 1498/9741 [00:01<00:08, 930.37it/s] 16%|███████████████▊                                                                                 | 1592/9741 [00:01<00:08, 929.41it/s] 17%|████████████████▊                                                                                | 1686/9741 [00:01<00:08, 931.73it/s] 18%|█████████████████▋                                                                               | 1780/9741 [00:01<00:08, 928.19it/s] 19%|██████████████████▋                                                                              | 1873/9741 [00:02<00:08, 897.44it/s] 20%|███████████████████▌                                                                             | 1966/9741 [00:02<00:08, 906.75it/s] 21%|████████████████████▌                                                                            | 2059/9741 [00:02<00:08, 911.87it/s] 22%|█████████████████████▌                                                                           | 2161/9741 [00:02<00:08, 941.87it/s] 24%|██████████████████████▋                                                                         | 2304/9741 [00:02<00:06, 1084.21it/s] 25%|████████████████████████▏                                                                       | 2448/9741 [00:02<00:06, 1187.75it/s] 27%|█████████████████████████▌                                                                      | 2590/9741 [00:02<00:05, 1256.13it/s] 28%|██████████████████████████▉                                                                     | 2732/9741 [00:02<00:05, 1302.55it/s] 30%|████████████████████████████▎                                                                   | 2875/9741 [00:02<00:05, 1340.08it/s] 31%|█████████████████████████████▋                                                                  | 3018/9741 [00:02<00:04, 1365.36it/s] 32%|███████████████████████████████▏                                                                | 3160/9741 [00:03<00:04, 1379.84it/s] 34%|████████████████████████████████▌                                                               | 3304/9741 [00:03<00:04, 1395.16it/s] 35%|█████████████████████████████████▉                                                              | 3444/9741 [00:03<00:04, 1391.16it/s] 37%|███████████████████████████████████▎                                                            | 3587/9741 [00:03<00:04, 1399.86it/s] 38%|████████████████████████████████████▊                                                           | 3729/9741 [00:03<00:04, 1404.70it/s] 40%|██████████████████████████████████████▏                                                         | 3871/9741 [00:03<00:04, 1408.23it/s] 41%|███████████████████████████████████████▌                                                        | 4014/9741 [00:03<00:04, 1414.72it/s] 43%|████████████████████████████████████████▉                                                       | 4156/9741 [00:03<00:03, 1414.21it/s] 44%|██████████████████████████████████████████▎                                                     | 4298/9741 [00:03<00:03, 1413.42it/s] 46%|███████████████████████████████████████████▊                                                    | 4441/9741 [00:03<00:03, 1417.31it/s] 47%|█████████████████████████████████████████████▏                                                  | 4583/9741 [00:04<00:03, 1368.38it/s] 49%|██████████████████████████████████████████████▌                                                 | 4726/9741 [00:04<00:03, 1384.95it/s] 50%|███████████████████████████████████████████████▉                                                | 4865/9741 [00:04<00:04, 1093.59it/s] 51%|█████████████████████████████████████████████████▎                                              | 5006/9741 [00:04<00:04, 1171.79it/s] 53%|██████████████████████████████████████████████████▋                                             | 5144/9741 [00:04<00:03, 1224.43it/s] 54%|████████████████████████████████████████████████████                                            | 5284/9741 [00:04<00:03, 1271.07it/s] 56%|█████████████████████████████████████████████████████▍                                          | 5424/9741 [00:04<00:03, 1306.88it/s] 57%|██████████████████████████████████████████████████████▉                                         | 5570/9741 [00:04<00:03, 1350.58it/s] 59%|████████████████████████████████████████████████████████▎                                       | 5717/9741 [00:04<00:02, 1383.01it/s] 60%|█████████████████████████████████████████████████████████▊                                      | 5864/9741 [00:05<00:02, 1406.59it/s] 62%|███████████████████████████████████████████████████████████▏                                    | 6012/9741 [00:05<00:02, 1425.86it/s] 63%|████████████████████████████████████████████████████████████▋                                   | 6159/9741 [00:05<00:02, 1437.34it/s] 65%|██████████████████████████████████████████████████████████████▏                                 | 6306/9741 [00:05<00:02, 1444.20it/s] 66%|███████████████████████████████████████████████████████████████▌                                | 6453/9741 [00:05<00:02, 1451.26it/s] 68%|█████████████████████████████████████████████████████████████████                               | 6599/9741 [00:05<00:02, 1451.68it/s] 69%|██████████████████████████████████████████████████████████████████▍                             | 6747/9741 [00:05<00:02, 1458.78it/s] 71%|███████████████████████████████████████████████████████████████████▉                            | 6894/9741 [00:05<00:01, 1461.35it/s] 72%|█████████████████████████████████████████████████████████████████████▍                          | 7041/9741 [00:05<00:01, 1451.47it/s] 74%|██████████████████████████████████████████████████████████████████████▊                         | 7189/9741 [00:05<00:01, 1457.24it/s] 75%|████████████████████████████████████████████████████████████████████████▎                       | 7335/9741 [00:06<00:01, 1452.72it/s] 77%|█████████████████████████████████████████████████████████████████████████▋                      | 7481/9741 [00:06<00:01, 1411.75it/s] 78%|███████████████████████████████████████████████████████████████████████████▏                    | 7628/9741 [00:06<00:01, 1427.91it/s] 80%|████████████████████████████████████████████████████████████████████████████▌                   | 7774/9741 [00:06<00:01, 1435.98it/s] 81%|██████████████████████████████████████████████████████████████████████████████                  | 7918/9741 [00:06<00:01, 1433.15it/s] 83%|███████████████████████████████████████████████████████████████████████████████▍                | 8066/9741 [00:06<00:01, 1444.27it/s] 84%|████████████████████████████████████████████████████████████████████████████████▉               | 8213/9741 [00:06<00:01, 1451.06it/s] 86%|██████████████████████████████████████████████████████████████████████████████████▍             | 8359/9741 [00:06<00:00, 1451.36it/s] 87%|███████████████████████████████████████████████████████████████████████████████████▊            | 8507/9741 [00:06<00:00, 1458.09it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▎          | 8653/9741 [00:06<00:00, 1456.99it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████▋         | 8800/9741 [00:07<00:00, 1459.05it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████▏       | 8946/9741 [00:07<00:00, 1458.48it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████████▌      | 9092/9741 [00:07<00:00, 1455.99it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████     | 9239/9741 [00:07<00:00, 1457.54it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▍   | 9385/9741 [00:07<00:00, 1452.06it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████████▉  | 9531/9741 [00:07<00:00, 1448.75it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▎| 9677/9741 [00:07<00:00, 1449.91it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:07<00:00, 1262.16it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:04<00:09,  4.93s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.32s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.02s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.22s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.09s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.41s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.57s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
[2023-08-18 06:06:25,855] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.86s/it]
[2023-08-18 06:06:34,921] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 06:06:34,922] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f4960ab9310>
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 06:06:34,923] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f4960ab9e50>
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 06:06:34,924] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 06:06:34,924] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3637511730194092 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s10-rTrue
Loading extension module utils...
Time to load utils op: 0.4044041633605957 seconds
Loading extension module utils...
Time to load utils op: 0.30432581901550293 seconds
Loading extension module utils...
Time to load utils op: 0.3043973445892334 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:50<40:56, 50.13s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:40<40:24, 50.52s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:29<39:00, 49.79s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:19<38:03, 49.65s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:09<37:17, 49.72s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:58<36:23, 49.62s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:47<35:29, 49.52s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:37<34:43, 49.61s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [07:27<34:03, 49.83s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [08:16<32:58, 49.45s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [09:05<32:04, 49.35s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [09:55<31:23, 49.56s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [10:46<30:43, 49.81s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [11:35<29:47, 49.66s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [12:25<29:02, 49.78s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [13:16<28:21, 50.04s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [14:05<27:28, 49.97s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [14:55<26:39, 49.98s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [15:46<25:53, 50.10s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [16:36<25:04, 50.16s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [17:27<24:23, 50.47s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [18:16<23:19, 49.99s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [19:06<22:29, 49.98s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [19:56<21:38, 49.93s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [20:45<20:44, 49.79s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [21:36<19:59, 50.00s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [22:26<19:11, 50.07s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [23:12<17:50, 48.66s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [24:00<17:03, 48.73s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [24:51<16:24, 49.22s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [25:41<15:43, 49.65s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [26:32<14:57, 49.85s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [27:21<14:05, 49.76s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [28:10<13:13, 49.56s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [29:01<12:26, 49.73s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [29:51<11:38, 49.86s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [30:40<10:47, 49.78s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [31:30<09:56, 49.71s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [32:17<08:57, 48.89s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [33:06<08:10, 49.05s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [33:56<07:22, 49.20s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [34:46<06:36, 49.53s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [35:10<04:53, 41.93s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [36:01<04:27, 44.55s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [36:51<03:50, 46.05s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [37:40<03:08, 47.21s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [38:30<02:23, 47.98s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [39:20<01:36, 48.45s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [40:11<00:49, 49.15s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [40:59<00:00, 49.07s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [40:59<00:00, 49.20s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 2.5085} | lm_loss 7.8302 | avg. gen lenth: 311.164
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 06:47:44,996] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|▋                                                                                                  | 65/9741 [00:00<00:14, 648.58it/s]  1%|█▎                                                                                                | 131/9741 [00:00<00:14, 651.55it/s]  2%|█▉                                                                                                | 197/9741 [00:00<00:14, 652.97it/s]  3%|██▋                                                                                               | 263/9741 [00:00<00:14, 650.05it/s]  3%|███▎                                                                                              | 329/9741 [00:00<00:14, 652.10it/s]  4%|███▉                                                                                              | 395/9741 [00:00<00:14, 652.06it/s]  5%|████▋                                                                                             | 461/9741 [00:00<00:14, 649.88it/s]  5%|█████▎                                                                                            | 526/9741 [00:00<00:14, 649.31it/s]  6%|█████▉                                                                                            | 591/9741 [00:00<00:14, 637.51it/s]  7%|██████▌                                                                                           | 655/9741 [00:01<00:14, 635.49it/s]  7%|███████▏                                                                                          | 720/9741 [00:01<00:14, 639.70it/s]  8%|███████▉                                                                                          | 785/9741 [00:01<00:13, 642.76it/s]  9%|████████▌                                                                                         | 851/9741 [00:01<00:13, 645.26it/s]  9%|█████████▏                                                                                        | 916/9741 [00:01<00:13, 644.79it/s] 10%|█████████▊                                                                                        | 981/9741 [00:01<00:13, 646.11it/s] 11%|██████████▍                                                                                      | 1047/9741 [00:01<00:13, 647.73it/s] 12%|███████████▏                                                                                     | 1122/9741 [00:01<00:12, 676.92it/s] 13%|████████████▏                                                                                    | 1221/9741 [00:01<00:11, 769.64it/s] 14%|█████████████                                                                                    | 1318/9741 [00:01<00:10, 828.41it/s] 15%|██████████████                                                                                   | 1415/9741 [00:02<00:09, 869.49it/s] 16%|███████████████                                                                                  | 1514/9741 [00:02<00:09, 902.79it/s] 17%|████████████████                                                                                 | 1612/9741 [00:02<00:08, 923.37it/s] 18%|█████████████████                                                                                | 1711/9741 [00:02<00:08, 942.93it/s] 19%|█████████████████▉                                                                               | 1806/9741 [00:02<00:08, 922.60it/s] 20%|██████████████████▉                                                                              | 1904/9741 [00:02<00:08, 938.70it/s] 21%|███████████████████▉                                                                             | 2003/9741 [00:02<00:08, 951.49it/s] 22%|████████████████████▉                                                                            | 2100/9741 [00:02<00:07, 955.91it/s] 23%|█████████████████████▉                                                                           | 2199/9741 [00:02<00:07, 963.17it/s] 24%|██████████████████████▊                                                                          | 2297/9741 [00:02<00:07, 965.47it/s] 25%|███████████████████████▊                                                                         | 2396/9741 [00:03<00:07, 971.72it/s] 26%|████████████████████████▊                                                                        | 2494/9741 [00:03<00:07, 971.83it/s] 27%|█████████████████████████▊                                                                       | 2593/9741 [00:03<00:07, 974.65it/s] 28%|██████████████████████████▊                                                                      | 2692/9741 [00:03<00:07, 976.62it/s] 29%|███████████████████████████▊                                                                     | 2790/9741 [00:03<00:07, 974.62it/s] 30%|████████████████████████████▊                                                                    | 2888/9741 [00:03<00:07, 975.14it/s] 31%|█████████████████████████████▋                                                                   | 2986/9741 [00:03<00:06, 974.78it/s] 32%|██████████████████████████████▋                                                                  | 3085/9741 [00:03<00:06, 977.29it/s] 33%|███████████████████████████████▋                                                                 | 3183/9741 [00:03<00:06, 975.58it/s] 34%|████████████████████████████████▋                                                                | 3282/9741 [00:03<00:06, 977.81it/s] 35%|█████████████████████████████████▋                                                               | 3380/9741 [00:04<00:06, 975.26it/s] 36%|██████████████████████████████████▋                                                              | 3478/9741 [00:04<00:06, 976.22it/s] 37%|███████████████████████████████████▌                                                             | 3577/9741 [00:04<00:06, 977.27it/s] 38%|████████████████████████████████████▌                                                            | 3675/9741 [00:04<00:06, 974.76it/s] 39%|█████████████████████████████████████▌                                                           | 3774/9741 [00:04<00:06, 976.81it/s] 40%|██████████████████████████████████████▌                                                          | 3872/9741 [00:04<00:06, 975.40it/s] 41%|███████████████████████████████████████▌                                                         | 3971/9741 [00:04<00:05, 976.92it/s] 42%|████████████████████████████████████████▌                                                        | 4069/9741 [00:04<00:05, 975.66it/s] 43%|█████████████████████████████████████████▍                                                       | 4167/9741 [00:04<00:05, 976.32it/s] 44%|██████████████████████████████████████████▍                                                      | 4265/9741 [00:04<00:05, 976.44it/s] 45%|███████████████████████████████████████████▍                                                     | 4363/9741 [00:05<00:05, 972.80it/s] 46%|████████████████████████████████████████████▍                                                    | 4461/9741 [00:05<00:05, 973.52it/s] 47%|█████████████████████████████████████████████▍                                                   | 4559/9741 [00:05<00:05, 933.92it/s] 48%|██████████████████████████████████████████████▎                                                  | 4657/9741 [00:05<00:05, 947.01it/s] 49%|███████████████████████████████████████████████▎                                                 | 4752/9741 [00:05<00:06, 724.71it/s] 50%|████████████████████████████████████████████████▎                                                | 4851/9741 [00:05<00:06, 787.13it/s] 51%|█████████████████████████████████████████████████▎                                               | 4948/9741 [00:05<00:05, 833.82it/s] 52%|██████████████████████████████████████████████████▏                                              | 5043/9741 [00:05<00:05, 864.83it/s] 53%|███████████████████████████████████████████████████▏                                             | 5141/9741 [00:05<00:05, 896.52it/s] 54%|████████████████████████████████████████████████████▏                                            | 5238/9741 [00:06<00:04, 917.16it/s] 55%|█████████████████████████████████████████████████████▏                                           | 5337/9741 [00:06<00:04, 936.04it/s] 56%|██████████████████████████████████████████████████████                                           | 5435/9741 [00:06<00:04, 946.82it/s] 57%|███████████████████████████████████████████████████████▏                                         | 5537/9741 [00:06<00:04, 966.12it/s] 58%|████████████████████████████████████████████████████████▏                                        | 5639/9741 [00:06<00:04, 981.42it/s] 59%|█████████████████████████████████████████████████████████▏                                       | 5743/9741 [00:06<00:04, 996.59it/s] 60%|█████████████████████████████████████████████████████████▌                                      | 5846/9741 [00:06<00:03, 1005.85it/s] 61%|██████████████████████████████████████████████████████████▋                                     | 5949/9741 [00:06<00:03, 1010.58it/s] 62%|███████████████████████████████████████████████████████████▋                                    | 6053/9741 [00:06<00:03, 1017.78it/s] 63%|████████████████████████████████████████████████████████████▋                                   | 6155/9741 [00:06<00:03, 1016.96it/s] 64%|█████████████████████████████████████████████████████████████▋                                  | 6258/9741 [00:07<00:03, 1019.68it/s] 65%|██████████████████████████████████████████████████████████████▋                                 | 6361/9741 [00:07<00:03, 1003.21it/s] 66%|███████████████████████████████████████████████████████████████▋                                | 6464/9741 [00:07<00:03, 1008.67it/s] 67%|████████████████████████████████████████████████████████████████▋                               | 6566/9741 [00:07<00:03, 1010.37it/s] 68%|█████████████████████████████████████████████████████████████████▋                              | 6669/9741 [00:07<00:03, 1014.32it/s] 70%|██████████████████████████████████████████████████████████████████▋                             | 6771/9741 [00:07<00:02, 1013.40it/s] 71%|███████████████████████████████████████████████████████████████████▋                            | 6873/9741 [00:07<00:02, 1015.04it/s] 72%|████████████████████████████████████████████████████████████████████▋                           | 6975/9741 [00:07<00:02, 1015.59it/s] 73%|█████████████████████████████████████████████████████████████████████▋                          | 7077/9741 [00:07<00:02, 1012.67it/s] 74%|██████████████████████████████████████████████████████████████████████▊                         | 7179/9741 [00:07<00:02, 1013.35it/s] 75%|███████████████████████████████████████████████████████████████████████▊                        | 7281/9741 [00:08<00:02, 1010.93it/s] 76%|████████████████████████████████████████████████████████████████████████▊                       | 7383/9741 [00:08<00:02, 1012.93it/s] 77%|██████████████████████████████████████████████████████████████████████████▌                      | 7485/9741 [00:08<00:02, 973.10it/s] 78%|███████████████████████████████████████████████████████████████████████████▌                     | 7583/9741 [00:08<00:02, 973.52it/s] 79%|████████████████████████████████████████████████████████████████████████████▍                    | 7682/9741 [00:08<00:02, 977.69it/s] 80%|█████████████████████████████████████████████████████████████████████████████▌                   | 7783/9741 [00:08<00:01, 986.02it/s] 81%|██████████████████████████████████████████████████████████████████████████████▌                  | 7885/9741 [00:08<00:01, 993.63it/s] 82%|███████████████████████████████████████████████████████████████████████████████▌                 | 7986/9741 [00:08<00:01, 995.89it/s] 83%|███████████████████████████████████████████████████████████████████████████████▋                | 8088/9741 [00:08<00:01, 1000.42it/s] 84%|████████████████████████████████████████████████████████████████████████████████▋               | 8189/9741 [00:09<00:01, 1001.55it/s] 85%|█████████████████████████████████████████████████████████████████████████████████▋              | 8291/9741 [00:09<00:01, 1004.22it/s] 86%|██████████████████████████████████████████████████████████████████████████████████▋             | 8392/9741 [00:09<00:01, 1002.92it/s] 87%|███████████████████████████████████████████████████████████████████████████████████▋            | 8494/9741 [00:09<00:01, 1005.97it/s] 88%|████████████████████████████████████████████████████████████████████████████████████▋           | 8595/9741 [00:09<00:01, 1003.54it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▋          | 8696/9741 [00:09<00:01, 1004.46it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████▋         | 8797/9741 [00:09<00:00, 1005.50it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▌        | 8898/9741 [00:09<00:00, 994.67it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▌       | 8999/9741 [00:09<00:00, 997.15it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▌      | 9099/9741 [00:09<00:00, 995.79it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▌     | 9199/9741 [00:10<00:00, 994.84it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▌    | 9299/9741 [00:10<00:00, 993.52it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▌   | 9400/9741 [00:10<00:00, 996.48it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▌  | 9500/9741 [00:10<00:00, 995.12it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▌ | 9601/9741 [00:10<00:00, 997.76it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████▌| 9701/9741 [00:10<00:00, 997.49it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:10<00:00, 921.78it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.44s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.67s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.14s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.14s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.83s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.51s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.64s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.64s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.83s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.90s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.87s/it]
[2023-08-18 06:48:50,682] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-18 06:49:04,090] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 06:49:04,091] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 06:49:04,092] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 06:49:04,092] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 06:49:04,092] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 06:49:04,092] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f6c97695e80>
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 06:49:04,093] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f6c97695dc0>
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 06:49:04,094] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 06:49:04,095] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 06:49:04,095] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4810342788696289 seconds
Loading extension module utils...
Time to load utils op: 0.5044927597045898 seconds
Loading extension module utils...
Time to load utils op: 0.5043389797210693 seconds
Loading extension module utils...
Time to load utils op: 0.5046124458312988 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
So the final answer is 30

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s10-rTrue
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:48<39:39, 48.55s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:28<34:37, 43.28s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:08<32:54, 42.01s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [02:56<33:56, 44.28s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:43<33:53, 45.19s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:30<33:46, 46.05s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:19<33:34, 46.85s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:06<32:55, 47.04s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [06:53<32:06, 46.99s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [07:41<31:23, 47.09s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [08:29<30:55, 47.58s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [09:16<29:59, 47.36s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [10:03<29:06, 47.21s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [10:51<28:26, 47.40s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [11:38<27:39, 47.43s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [12:26<26:50, 47.38s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [13:13<25:59, 47.25s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [13:59<25:08, 47.15s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [14:47<24:26, 47.30s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [15:35<23:48, 47.61s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [16:22<22:52, 47.31s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [17:09<22:02, 47.24s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [17:56<21:10, 47.05s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [18:42<20:19, 46.92s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [19:24<18:50, 45.22s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [20:11<18:24, 46.02s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [20:58<17:44, 46.28s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [21:45<17:02, 46.49s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [22:33<16:23, 46.85s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [23:21<15:43, 47.19s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [23:59<14:02, 44.33s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [24:46<13:34, 45.27s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [25:35<13:05, 46.22s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [26:22<12:25, 46.62s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [27:09<11:41, 46.78s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [27:57<10:56, 46.92s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [28:44<10:13, 47.19s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [29:31<09:24, 47.08s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [30:19<08:39, 47.26s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [31:07<07:56, 47.65s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [31:55<07:08, 47.64s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [32:42<06:19, 47.45s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [33:29<05:32, 47.45s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [34:16<04:43, 47.21s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [35:03<03:56, 47.22s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [35:50<03:08, 47.12s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [36:37<02:21, 47.07s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [37:25<01:34, 47.36s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [38:13<00:47, 47.49s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [39:00<00:00, 47.47s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [39:00<00:00, 46.82s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.2178} | lm_loss 7.8275 | avg. gen lenth: 304.312
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 5
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 07:28:14,001] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 5
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                                  | 57/9741 [00:00<00:17, 563.54it/s]  1%|█▏                                                                                                | 114/9741 [00:00<00:16, 566.63it/s]  2%|█▋                                                                                                | 171/9741 [00:00<00:16, 567.88it/s]  2%|██▎                                                                                               | 228/9741 [00:00<00:16, 563.67it/s]  3%|██▊                                                                                               | 285/9741 [00:00<00:16, 563.87it/s]  4%|███▍                                                                                              | 342/9741 [00:00<00:16, 563.87it/s]  4%|████                                                                                              | 399/9741 [00:00<00:16, 563.64it/s]  5%|████▌                                                                                             | 456/9741 [00:00<00:16, 561.09it/s]  5%|█████▏                                                                                            | 513/9741 [00:00<00:16, 552.55it/s]  6%|█████▋                                                                                            | 569/9741 [00:01<00:16, 554.41it/s]  6%|██████▎                                                                                           | 626/9741 [00:01<00:16, 557.11it/s]  7%|██████▊                                                                                           | 682/9741 [00:01<00:16, 556.94it/s]  8%|███████▍                                                                                          | 739/9741 [00:01<00:16, 558.86it/s]  8%|████████                                                                                          | 796/9741 [00:01<00:15, 560.53it/s]  9%|████████▌                                                                                         | 853/9741 [00:01<00:15, 561.30it/s]  9%|█████████▏                                                                                        | 910/9741 [00:01<00:15, 559.41it/s] 10%|█████████▋                                                                                        | 967/9741 [00:01<00:15, 560.63it/s] 11%|██████████▏                                                                                      | 1024/9741 [00:01<00:15, 560.87it/s] 11%|██████████▊                                                                                      | 1081/9741 [00:01<00:15, 558.84it/s] 12%|███████████▎                                                                                     | 1137/9741 [00:02<00:15, 557.26it/s] 12%|███████████▉                                                                                     | 1203/9741 [00:02<00:14, 587.29it/s] 13%|████████████▊                                                                                    | 1289/9741 [00:02<00:12, 667.97it/s] 14%|█████████████▋                                                                                   | 1374/9741 [00:02<00:11, 721.77it/s] 15%|██████████████▌                                                                                  | 1460/9741 [00:02<00:10, 762.74it/s] 16%|███████████████▍                                                                                 | 1547/9741 [00:02<00:10, 792.41it/s] 17%|████████████████▎                                                                                | 1632/9741 [00:02<00:10, 809.31it/s] 18%|█████████████████                                                                                | 1718/9741 [00:02<00:09, 823.32it/s] 18%|█████████████████▉                                                                               | 1801/9741 [00:02<00:09, 799.81it/s] 19%|██████████████████▊                                                                              | 1887/9741 [00:02<00:09, 814.56it/s] 20%|███████████████████▋                                                                             | 1973/9741 [00:03<00:09, 825.96it/s] 21%|████████████████████▍                                                                            | 2057/9741 [00:03<00:09, 827.39it/s] 22%|█████████████████████▎                                                                           | 2143/9741 [00:03<00:09, 835.27it/s] 23%|██████████████████████▏                                                                          | 2229/9741 [00:03<00:08, 841.04it/s] 24%|███████████████████████                                                                          | 2314/9741 [00:03<00:08, 843.65it/s] 25%|███████████████████████▉                                                                         | 2401/9741 [00:03<00:08, 848.60it/s] 26%|████████████████████████▊                                                                        | 2486/9741 [00:03<00:08, 848.37it/s] 26%|█████████████████████████▌                                                                       | 2572/9741 [00:03<00:08, 850.86it/s] 27%|██████████████████████████▍                                                                      | 2658/9741 [00:03<00:08, 852.68it/s] 28%|███████████████████████████▎                                                                     | 2744/9741 [00:03<00:08, 850.67it/s] 29%|████████████████████████████▏                                                                    | 2830/9741 [00:04<00:08, 852.50it/s] 30%|█████████████████████████████                                                                    | 2916/9741 [00:04<00:07, 853.40it/s] 31%|█████████████████████████████▉                                                                   | 3002/9741 [00:04<00:07, 849.53it/s] 32%|██████████████████████████████▋                                                                  | 3087/9741 [00:04<00:07, 849.57it/s] 33%|███████████████████████████████▌                                                                 | 3172/9741 [00:04<00:07, 839.37it/s] 33%|████████████████████████████████▍                                                                | 3258/9741 [00:04<00:07, 842.49it/s] 34%|█████████████████████████████████▎                                                               | 3343/9741 [00:04<00:07, 844.07it/s] 35%|██████████████████████████████████▏                                                              | 3428/9741 [00:04<00:07, 840.06it/s] 36%|██████████████████████████████████▉                                                              | 3513/9741 [00:04<00:07, 840.42it/s] 37%|███████████████████████████████████▊                                                             | 3598/9741 [00:04<00:07, 841.16it/s] 38%|████████████████████████████████████▋                                                            | 3683/9741 [00:05<00:07, 838.13it/s] 39%|█████████████████████████████████████▌                                                           | 3768/9741 [00:05<00:07, 841.11it/s] 40%|██████████████████████████████████████▎                                                          | 3853/9741 [00:05<00:07, 839.57it/s] 40%|███████████████████████████████████████▏                                                         | 3938/9741 [00:05<00:06, 841.55it/s] 41%|████████████████████████████████████████                                                         | 4023/9741 [00:05<00:06, 842.76it/s] 42%|████████████████████████████████████████▉                                                        | 4108/9741 [00:05<00:06, 839.75it/s] 43%|█████████████████████████████████████████▊                                                       | 4193/9741 [00:05<00:06, 840.95it/s] 44%|██████████████████████████████████████████▌                                                      | 4278/9741 [00:05<00:06, 838.78it/s] 45%|███████████████████████████████████████████▍                                                     | 4363/9741 [00:05<00:06, 839.62it/s] 46%|████████████████████████████████████████████▎                                                    | 4449/9741 [00:05<00:06, 843.70it/s] 47%|█████████████████████████████████████████████▏                                                   | 4534/9741 [00:06<00:06, 789.12it/s] 47%|██████████████████████████████████████████████                                                   | 4620/9741 [00:06<00:06, 807.56it/s] 48%|██████████████████████████████████████████████▊                                                  | 4706/9741 [00:06<00:06, 820.52it/s] 49%|███████████████████████████████████████████████▋                                                 | 4789/9741 [00:06<00:07, 654.37it/s] 50%|████████████████████████████████████████████████▌                                                | 4874/9741 [00:06<00:06, 701.48it/s] 51%|█████████████████████████████████████████████████▎                                               | 4958/9741 [00:06<00:06, 736.54it/s] 52%|██████████████████████████████████████████████████▏                                              | 5043/9741 [00:06<00:06, 765.99it/s] 53%|███████████████████████████████████████████████████                                              | 5128/9741 [00:06<00:05, 787.63it/s] 54%|███████████████████████████████████████████████████▉                                             | 5212/9741 [00:06<00:05, 800.91it/s] 54%|████████████████████████████████████████████████████▋                                            | 5297/9741 [00:07<00:05, 813.28it/s] 55%|█████████████████████████████████████████████████████▌                                           | 5383/9741 [00:07<00:05, 824.20it/s] 56%|██████████████████████████████████████████████████████▍                                          | 5468/9741 [00:07<00:05, 829.94it/s] 57%|███████████████████████████████████████████████████████▎                                         | 5557/9741 [00:07<00:04, 846.75it/s] 58%|████████████████████████████████████████████████████████▏                                        | 5644/9741 [00:07<00:04, 851.25it/s] 59%|█████████████████████████████████████████████████████████                                        | 5733/9741 [00:07<00:04, 861.49it/s] 60%|█████████████████████████████████████████████████████████▉                                       | 5822/9741 [00:07<00:04, 869.08it/s] 61%|██████████████████████████████████████████████████████████▊                                      | 5910/9741 [00:07<00:04, 870.88it/s] 62%|███████████████████████████████████████████████████████████▋                                     | 5999/9741 [00:07<00:04, 875.88it/s] 62%|████████████████████████████████████████████████████████████▌                                    | 6087/9741 [00:08<00:04, 876.06it/s] 63%|█████████████████████████████████████████████████████████████▌                                   | 6176/9741 [00:08<00:04, 877.98it/s] 64%|██████████████████████████████████████████████████████████████▍                                  | 6265/9741 [00:08<00:03, 879.75it/s] 65%|███████████████████████████████████████████████████████████████▎                                 | 6354/9741 [00:08<00:03, 878.46it/s] 66%|████████████████████████████████████████████████████████████████▏                                | 6443/9741 [00:08<00:03, 880.70it/s] 67%|█████████████████████████████████████████████████████████████████                                | 6532/9741 [00:08<00:03, 881.19it/s] 68%|█████████████████████████████████████████████████████████████████▉                               | 6621/9741 [00:08<00:03, 878.69it/s] 69%|██████████████████████████████████████████████████████████████████▊                              | 6710/9741 [00:08<00:03, 881.04it/s] 70%|███████████████████████████████████████████████████████████████████▋                             | 6799/9741 [00:08<00:03, 880.09it/s] 71%|████████████████████████████████████████████████████████████████████▌                            | 6888/9741 [00:08<00:03, 882.02it/s] 72%|█████████████████████████████████████████████████████████████████████▍                           | 6977/9741 [00:09<00:03, 881.85it/s] 73%|██████████████████████████████████████████████████████████████████████▎                          | 7066/9741 [00:09<00:03, 878.41it/s] 73%|███████████████████████████████████████████████████████████████████████▏                         | 7154/9741 [00:09<00:02, 877.00it/s] 74%|████████████████████████████████████████████████████████████████████████                         | 7242/9741 [00:09<00:02, 872.55it/s] 75%|████████████████████████████████████████████████████████████████████████▉                        | 7330/9741 [00:09<00:02, 872.53it/s] 76%|█████████████████████████████████████████████████████████████████████████▊                       | 7418/9741 [00:09<00:02, 873.17it/s] 77%|██████████████████████████████████████████████████████████████████████████▋                      | 7506/9741 [00:09<00:02, 830.73it/s] 78%|███████████████████████████████████████████████████████████████████████████▌                     | 7593/9741 [00:09<00:02, 841.93it/s] 79%|████████████████████████████████████████████████████████████████████████████▍                    | 7679/9741 [00:09<00:02, 845.88it/s] 80%|█████████████████████████████████████████████████████████████████████████████▎                   | 7767/9741 [00:09<00:02, 854.09it/s] 81%|██████████████████████████████████████████████████████████████████████████████▏                  | 7854/9741 [00:10<00:02, 858.50it/s] 82%|███████████████████████████████████████████████████████████████████████████████                  | 7941/9741 [00:10<00:02, 859.89it/s] 82%|███████████████████████████████████████████████████████████████████████████████▉                 | 8029/9741 [00:10<00:01, 863.89it/s] 83%|████████████████████████████████████████████████████████████████████████████████▊                | 8117/9741 [00:10<00:01, 867.16it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▋               | 8204/9741 [00:10<00:01, 865.95it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▌              | 8292/9741 [00:10<00:01, 867.46it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▍             | 8379/9741 [00:10<00:01, 865.86it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▎            | 8467/9741 [00:10<00:01, 868.31it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▏           | 8554/9741 [00:10<00:01, 868.34it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████           | 8641/9741 [00:10<00:01, 868.11it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████▉          | 8730/9741 [00:11<00:01, 872.02it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████▊         | 8818/9741 [00:11<00:01, 871.48it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▋        | 8907/9741 [00:11<00:00, 874.75it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▌       | 8996/9741 [00:11<00:00, 876.59it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▍      | 9084/9741 [00:11<00:00, 874.71it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▎     | 9173/9741 [00:11<00:00, 876.57it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▏    | 9261/9741 [00:11<00:00, 874.54it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████    | 9350/9741 [00:11<00:00, 876.21it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▉   | 9438/9741 [00:11<00:00, 877.07it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▊  | 9526/9741 [00:11<00:00, 874.44it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▋ | 9614/9741 [00:12<00:00, 875.44it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████▌| 9702/9741 [00:12<00:00, 875.25it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:12<00:00, 798.47it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.06s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.97s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.18s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.05s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.82s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.41s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.58s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.54s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
[2023-08-18 07:29:18,141] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.71s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.75s/it]
[2023-08-18 07:29:39,826] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 07:29:39,827] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 07:29:39,828] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 07:29:39,828] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 07:29:39,828] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 07:29:39,828] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f5117697310>
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 07:29:39,829] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f5117697e50>
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 07:29:39,830] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 07:29:39,831] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 07:29:39,831] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 07:29:39,831] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4177563190460205 seconds
Loading extension module utils...
Time to load utils op: 0.4042537212371826 seconds
Loading extension module utils...
Time to load utils op: 0.3038043975830078 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
So the final answer is 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
So the final answer is 868

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s10-rTrue
Loading extension module utils...
Time to load utils op: 0.3047058582305908 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:46<38:06, 46.66s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:32<36:53, 46.11s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:18<36:06, 46.11s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:03<35:00, 45.67s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:49<34:24, 45.89s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:35<33:40, 45.93s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [05:21<32:54, 45.93s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:07<32:05, 45.84s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [06:53<31:21, 45.89s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [07:38<30:28, 45.70s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [08:24<29:46, 45.81s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [09:07<28:30, 45.00s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [09:53<27:56, 45.30s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [10:39<27:17, 45.48s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [11:25<26:39, 45.70s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [12:12<25:58, 45.84s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [12:58<25:14, 45.88s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [13:43<24:22, 45.71s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [14:29<23:42, 45.88s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [15:15<22:54, 45.81s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [16:00<21:59, 45.49s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [16:45<21:11, 45.40s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [17:31<20:28, 45.51s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [18:16<19:45, 45.60s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [19:02<18:59, 45.59s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [19:48<18:17, 45.72s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [20:33<17:29, 45.64s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [21:19<16:47, 45.78s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [22:03<15:46, 45.09s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [22:49<15:07, 45.39s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [23:30<13:57, 44.08s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [24:16<13:23, 44.65s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [25:01<12:42, 44.83s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [25:47<12:02, 45.17s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [26:33<11:20, 45.34s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [27:18<10:34, 45.30s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [28:04<09:50, 45.44s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [28:49<09:03, 45.26s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [29:34<08:18, 45.34s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [30:20<07:35, 45.52s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [31:06<06:49, 45.55s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [31:51<06:03, 45.43s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [32:37<05:19, 45.62s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [33:23<04:33, 45.66s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [34:08<03:47, 45.59s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [34:53<03:01, 45.42s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [35:39<02:16, 45.64s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [36:26<01:31, 45.98s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [37:12<00:46, 46.04s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [37:58<00:00, 45.81s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [37:58<00:00, 45.56s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.205} | lm_loss 7.8532 | avg. gen lenth: 310.772
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 6
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 08:07:47,651] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 6
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o6-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                                  | 36/9741 [00:00<00:27, 356.36it/s]  1%|▋                                                                                                  | 73/9741 [00:00<00:26, 358.65it/s]  1%|█                                                                                                 | 110/9741 [00:00<00:26, 360.50it/s]  2%|█▍                                                                                                | 147/9741 [00:00<00:26, 361.15it/s]  2%|█▊                                                                                                | 184/9741 [00:00<00:26, 360.91it/s]  2%|██▏                                                                                               | 221/9741 [00:00<00:26, 358.71it/s]  3%|██▌                                                                                               | 258/9741 [00:00<00:26, 359.41it/s]  3%|██▉                                                                                               | 294/9741 [00:00<00:26, 353.99it/s]  3%|███▎                                                                                              | 331/9741 [00:00<00:26, 356.06it/s]  4%|███▋                                                                                              | 367/9741 [00:01<00:26, 356.92it/s]  4%|████                                                                                              | 404/9741 [00:01<00:26, 358.31it/s]  5%|████▍                                                                                             | 440/9741 [00:01<00:26, 355.57it/s]  5%|████▊                                                                                             | 476/9741 [00:01<00:25, 356.74it/s]  5%|█████▏                                                                                            | 513/9741 [00:01<00:25, 357.99it/s]  6%|█████▌                                                                                            | 550/9741 [00:01<00:25, 358.70it/s]  6%|█████▉                                                                                            | 586/9741 [00:01<00:25, 358.31it/s]  6%|██████▎                                                                                           | 622/9741 [00:01<00:25, 356.13it/s]  7%|██████▌                                                                                           | 658/9741 [00:01<00:25, 354.13it/s]  7%|██████▉                                                                                           | 695/9741 [00:01<00:25, 356.18it/s]  8%|███████▎                                                                                          | 731/9741 [00:02<00:25, 356.24it/s]  8%|███████▋                                                                                          | 767/9741 [00:02<00:25, 357.09it/s]  8%|████████▏                                                                                         | 818/9741 [00:02<00:22, 401.42it/s]  9%|████████▊                                                                                         | 872/9741 [00:02<00:20, 442.46it/s]  9%|█████████▎                                                                                        | 925/9741 [00:02<00:18, 468.54it/s] 10%|█████████▊                                                                                        | 979/9741 [00:02<00:17, 488.80it/s] 11%|██████████▎                                                                                      | 1034/9741 [00:02<00:17, 505.27it/s] 11%|██████████▊                                                                                      | 1089/9741 [00:02<00:16, 517.08it/s] 12%|███████████▍                                                                                     | 1143/9741 [00:02<00:16, 522.08it/s] 12%|███████████▉                                                                                     | 1198/9741 [00:02<00:16, 527.99it/s] 13%|████████████▍                                                                                    | 1253/9741 [00:03<00:15, 532.51it/s] 13%|█████████████                                                                                    | 1308/9741 [00:03<00:15, 535.09it/s] 14%|█████████████▌                                                                                   | 1362/9741 [00:03<00:15, 534.02it/s] 15%|██████████████                                                                                   | 1416/9741 [00:03<00:15, 535.37it/s] 15%|██████████████▋                                                                                  | 1470/9741 [00:03<00:15, 536.55it/s] 16%|███████████████▏                                                                                 | 1524/9741 [00:03<00:15, 536.56it/s] 16%|███████████████▋                                                                                 | 1578/9741 [00:03<00:15, 534.71it/s] 17%|████████████████▎                                                                                | 1633/9741 [00:03<00:15, 537.12it/s] 17%|████████████████▊                                                                                | 1687/9741 [00:03<00:14, 537.69it/s] 18%|█████████████████▎                                                                               | 1742/9741 [00:03<00:14, 538.60it/s] 18%|█████████████████▉                                                                               | 1796/9741 [00:04<00:15, 510.77it/s] 19%|██████████████████▍                                                                              | 1851/9741 [00:04<00:15, 519.34it/s] 20%|██████████████████▉                                                                              | 1905/9741 [00:04<00:14, 525.13it/s] 20%|███████████████████▍                                                                             | 1958/9741 [00:04<00:14, 526.19it/s] 21%|████████████████████                                                                             | 2012/9741 [00:04<00:14, 530.13it/s] 21%|████████████████████▌                                                                            | 2066/9741 [00:04<00:14, 528.35it/s] 22%|█████████████████████                                                                            | 2120/9741 [00:04<00:14, 530.37it/s] 22%|█████████████████████▋                                                                           | 2174/9741 [00:04<00:14, 532.82it/s] 23%|██████████████████████▏                                                                          | 2228/9741 [00:04<00:14, 534.23it/s] 23%|██████████████████████▋                                                                          | 2282/9741 [00:04<00:14, 531.55it/s] 24%|███████████████████████▎                                                                         | 2336/9741 [00:05<00:13, 533.68it/s] 25%|███████████████████████▊                                                                         | 2391/9741 [00:05<00:13, 535.67it/s] 25%|████████████████████████▎                                                                        | 2446/9741 [00:05<00:13, 537.50it/s] 26%|████████████████████████▉                                                                        | 2500/9741 [00:05<00:13, 534.45it/s] 26%|█████████████████████████▍                                                                       | 2554/9741 [00:05<00:13, 535.36it/s] 27%|█████████████████████████▉                                                                       | 2609/9741 [00:05<00:13, 537.02it/s] 27%|██████████████████████████▌                                                                      | 2663/9741 [00:05<00:13, 532.04it/s] 28%|███████████████████████████                                                                      | 2717/9741 [00:05<00:13, 529.01it/s] 28%|███████████████████████████▌                                                                     | 2771/9741 [00:05<00:13, 531.38it/s] 29%|████████████████████████████▏                                                                    | 2825/9741 [00:06<00:12, 532.13it/s] 30%|████████████████████████████▋                                                                    | 2880/9741 [00:06<00:12, 534.64it/s] 30%|█████████████████████████████▏                                                                   | 2934/9741 [00:06<00:12, 532.62it/s] 31%|█████████████████████████████▊                                                                   | 2988/9741 [00:06<00:12, 533.96it/s] 31%|██████████████████████████████▎                                                                  | 3042/9741 [00:06<00:12, 535.52it/s] 32%|██████████████████████████████▊                                                                  | 3096/9741 [00:06<00:12, 535.70it/s] 32%|███████████████████████████████▎                                                                 | 3150/9741 [00:06<00:12, 536.70it/s] 33%|███████████████████████████████▉                                                                 | 3204/9741 [00:06<00:12, 534.33it/s] 33%|████████████████████████████████▍                                                                | 3258/9741 [00:06<00:12, 535.87it/s] 34%|████████████████████████████████▉                                                                | 3312/9741 [00:06<00:11, 536.26it/s] 35%|█████████████████████████████████▌                                                               | 3366/9741 [00:07<00:12, 529.62it/s] 35%|██████████████████████████████████                                                               | 3419/9741 [00:07<00:11, 526.87it/s] 36%|██████████████████████████████████▌                                                              | 3473/9741 [00:07<00:11, 529.43it/s] 36%|███████████████████████████████████                                                              | 3527/9741 [00:07<00:11, 530.78it/s] 37%|███████████████████████████████████▋                                                             | 3581/9741 [00:07<00:11, 532.27it/s] 37%|████████████████████████████████████▏                                                            | 3635/9741 [00:07<00:11, 530.34it/s] 38%|████████████████████████████████████▋                                                            | 3689/9741 [00:07<00:11, 531.84it/s] 38%|█████████████████████████████████████▎                                                           | 3743/9741 [00:07<00:11, 534.18it/s] 39%|█████████████████████████████████████▊                                                           | 3797/9741 [00:07<00:11, 534.61it/s] 40%|██████████████████████████████████████▎                                                          | 3851/9741 [00:07<00:11, 533.23it/s] 40%|██████████████████████████████████████▉                                                          | 3905/9741 [00:08<00:10, 535.03it/s] 41%|███████████████████████████████████████▍                                                         | 3959/9741 [00:08<00:10, 534.58it/s] 41%|███████████████████████████████████████▉                                                         | 4013/9741 [00:08<00:10, 535.85it/s] 42%|████████████████████████████████████████▍                                                        | 4067/9741 [00:08<00:10, 529.90it/s] 42%|█████████████████████████████████████████                                                        | 4121/9741 [00:08<00:10, 531.71it/s] 43%|█████████████████████████████████████████▌                                                       | 4175/9741 [00:08<00:10, 532.94it/s] 43%|██████████████████████████████████████████                                                       | 4229/9741 [00:08<00:10, 533.64it/s] 44%|██████████████████████████████████████████▋                                                      | 4283/9741 [00:08<00:10, 535.16it/s] 45%|███████████████████████████████████████████▏                                                     | 4337/9741 [00:08<00:10, 533.17it/s] 45%|███████████████████████████████████████████▋                                                     | 4391/9741 [00:08<00:10, 533.95it/s] 46%|████████████████████████████████████████████▎                                                    | 4445/9741 [00:09<00:09, 534.20it/s] 46%|████████████████████████████████████████████▊                                                    | 4499/9741 [00:09<00:09, 535.30it/s] 47%|█████████████████████████████████████████████▎                                                   | 4553/9741 [00:09<00:10, 482.73it/s] 47%|█████████████████████████████████████████████▉                                                   | 4607/9741 [00:09<00:10, 496.35it/s] 48%|██████████████████████████████████████████████▍                                                  | 4661/9741 [00:09<00:10, 507.94it/s] 48%|██████████████████████████████████████████████▉                                                  | 4715/9741 [00:09<00:09, 516.50it/s] 49%|███████████████████████████████████████████████▍                                                 | 4768/9741 [00:09<00:13, 379.57it/s] 50%|████████████████████████████████████████████████                                                 | 4822/9741 [00:09<00:11, 416.21it/s] 50%|████████████████████████████████████████████████▌                                                | 4876/9741 [00:10<00:10, 445.77it/s] 51%|█████████████████████████████████████████████████                                                | 4930/9741 [00:10<00:10, 469.55it/s] 51%|█████████████████████████████████████████████████▋                                               | 4984/9741 [00:10<00:09, 486.89it/s] 52%|██████████████████████████████████████████████████▏                                              | 5038/9741 [00:10<00:09, 501.62it/s] 52%|██████████████████████████████████████████████████▋                                              | 5092/9741 [00:10<00:09, 511.51it/s] 53%|███████████████████████████████████████████████████▏                                             | 5146/9741 [00:10<00:08, 518.49it/s] 53%|███████████████████████████████████████████████████▊                                             | 5199/9741 [00:10<00:08, 521.48it/s] 54%|████████████████████████████████████████████████████▎                                            | 5253/9741 [00:10<00:08, 525.44it/s] 54%|████████████████████████████████████████████████████▊                                            | 5307/9741 [00:10<00:08, 529.39it/s] 55%|█████████████████████████████████████████████████████▍                                           | 5361/9741 [00:10<00:08, 531.58it/s] 56%|█████████████████████████████████████████████████████▉                                           | 5415/9741 [00:11<00:08, 530.80it/s] 56%|██████████████████████████████████████████████████████▍                                          | 5469/9741 [00:11<00:08, 532.73it/s] 57%|███████████████████████████████████████████████████████                                          | 5524/9741 [00:11<00:07, 537.03it/s] 57%|███████████████████████████████████████████████████████▌                                         | 5579/9741 [00:11<00:07, 539.18it/s] 58%|████████████████████████████████████████████████████████                                         | 5633/9741 [00:11<00:07, 538.70it/s] 58%|████████████████████████████████████████████████████████▋                                        | 5688/9741 [00:11<00:07, 541.42it/s] 59%|█████████████████████████████████████████████████████████▏                                       | 5744/9741 [00:11<00:07, 544.15it/s] 60%|█████████████████████████████████████████████████████████▋                                       | 5799/9741 [00:11<00:07, 545.48it/s] 60%|██████████████████████████████████████████████████████████▎                                      | 5854/9741 [00:11<00:07, 542.67it/s] 61%|██████████████████████████████████████████████████████████▊                                      | 5909/9741 [00:11<00:07, 544.82it/s] 61%|███████████████████████████████████████████████████████████▍                                     | 5964/9741 [00:12<00:06, 545.82it/s] 62%|███████████████████████████████████████████████████████████▉                                     | 6019/9741 [00:12<00:06, 546.02it/s] 62%|████████████████████████████████████████████████████████████▍                                    | 6075/9741 [00:12<00:06, 547.38it/s] 63%|█████████████████████████████████████████████████████████████                                    | 6130/9741 [00:12<00:06, 544.89it/s] 64%|█████████████████████████████████████████████████████████████▌                                   | 6186/9741 [00:12<00:06, 546.90it/s] 64%|██████████████████████████████████████████████████████████████▏                                  | 6241/9741 [00:12<00:06, 546.89it/s] 65%|██████████████████████████████████████████████████████████████▋                                  | 6297/9741 [00:12<00:06, 548.30it/s] 65%|███████████████████████████████████████████████████████████████▎                                 | 6352/9741 [00:12<00:06, 546.12it/s] 66%|███████████████████████████████████████████████████████████████▊                                 | 6408/9741 [00:12<00:06, 547.69it/s] 66%|████████████████████████████████████████████████████████████████▎                                | 6463/9741 [00:12<00:05, 548.03it/s] 67%|████████████████████████████████████████████████████████████████▉                                | 6518/9741 [00:13<00:05, 548.27it/s] 67%|█████████████████████████████████████████████████████████████████▍                               | 6573/9741 [00:13<00:05, 545.82it/s] 68%|██████████████████████████████████████████████████████████████████                               | 6628/9741 [00:13<00:05, 546.72it/s] 69%|██████████████████████████████████████████████████████████████████▌                              | 6683/9741 [00:13<00:05, 545.95it/s] 69%|███████████████████████████████████████████████████████████████████                              | 6739/9741 [00:13<00:05, 547.27it/s] 70%|███████████████████████████████████████████████████████████████████▋                             | 6794/9741 [00:13<00:05, 545.90it/s] 70%|████████████████████████████████████████████████████████████████████▏                            | 6850/9741 [00:13<00:05, 547.79it/s] 71%|████████████████████████████████████████████████████████████████████▊                            | 6906/9741 [00:13<00:05, 548.50it/s] 71%|█████████████████████████████████████████████████████████████████████▎                           | 6962/9741 [00:13<00:05, 549.62it/s] 72%|█████████████████████████████████████████████████████████████████████▊                           | 7017/9741 [00:13<00:04, 546.27it/s] 73%|██████████████████████████████████████████████████████████████████████▍                          | 7073/9741 [00:14<00:04, 548.42it/s] 73%|██████████████████████████████████████████████████████████████████████▉                          | 7129/9741 [00:14<00:04, 549.62it/s] 74%|███████████████████████████████████████████████████████████████████████▌                         | 7185/9741 [00:14<00:04, 550.34it/s] 74%|████████████████████████████████████████████████████████████████████████                         | 7241/9741 [00:14<00:04, 546.27it/s] 75%|████████████████████████████████████████████████████████████████████████▋                        | 7296/9741 [00:14<00:04, 547.35it/s] 75%|█████████████████████████████████████████████████████████████████████████▏                       | 7351/9741 [00:14<00:04, 547.81it/s] 76%|█████████████████████████████████████████████████████████████████████████▊                       | 7407/9741 [00:14<00:04, 548.90it/s] 77%|██████████████████████████████████████████████████████████████████████████▎                      | 7462/9741 [00:14<00:04, 512.29it/s] 77%|██████████████████████████████████████████████████████████████████████████▊                      | 7517/9741 [00:14<00:04, 522.06it/s] 78%|███████████████████████████████████████████████████████████████████████████▍                     | 7572/9741 [00:14<00:04, 529.90it/s] 78%|███████████████████████████████████████████████████████████████████████████▉                     | 7627/9741 [00:15<00:03, 533.87it/s] 79%|████████████████████████████████████████████████████████████████████████████▍                    | 7681/9741 [00:15<00:03, 534.34it/s] 79%|█████████████████████████████████████████████████████████████████████████████                    | 7736/9741 [00:15<00:03, 537.01it/s] 80%|█████████████████████████████████████████████████████████████████████████████▌                   | 7791/9741 [00:15<00:03, 539.68it/s] 81%|██████████████████████████████████████████████████████████████████████████████▏                  | 7847/9741 [00:15<00:03, 542.97it/s] 81%|██████████████████████████████████████████████████████████████████████████████▋                  | 7902/9741 [00:15<00:03, 542.09it/s] 82%|███████████████████████████████████████████████████████████████████████████████▏                 | 7958/9741 [00:15<00:03, 544.77it/s] 82%|███████████████████████████████████████████████████████████████████████████████▊                 | 8014/9741 [00:15<00:03, 546.86it/s] 83%|████████████████████████████████████████████████████████████████████████████████▎                | 8069/9741 [00:15<00:03, 547.28it/s] 83%|████████████████████████████████████████████████████████████████████████████████▉                | 8124/9741 [00:16<00:02, 546.57it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▍               | 8179/9741 [00:16<00:02, 547.56it/s] 85%|██████████████████████████████████████████████████████████████████████████████████               | 8235/9741 [00:16<00:02, 548.59it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▌              | 8290/9741 [00:16<00:02, 548.56it/s] 86%|███████████████████████████████████████████████████████████████████████████████████              | 8345/9741 [00:16<00:02, 548.52it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▋             | 8400/9741 [00:16<00:02, 545.47it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▏            | 8456/9741 [00:16<00:02, 547.58it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▊            | 8512/9741 [00:16<00:02, 549.01it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▎           | 8567/9741 [00:16<00:02, 545.97it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▊           | 8622/9741 [00:16<00:02, 543.64it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▍          | 8677/9741 [00:17<00:01, 545.10it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████▉          | 8732/9741 [00:17<00:01, 546.35it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▌         | 8787/9741 [00:17<00:01, 546.88it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████         | 8842/9741 [00:17<00:01, 544.82it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▌        | 8897/9741 [00:17<00:01, 545.10it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▏       | 8953/9741 [00:17<00:01, 546.95it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▋       | 9008/9741 [00:17<00:01, 545.85it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▏      | 9063/9741 [00:17<00:01, 543.43it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████████▊      | 9118/9741 [00:17<00:01, 544.85it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▎     | 9173/9741 [00:17<00:01, 546.06it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████▉     | 9229/9741 [00:18<00:00, 547.37it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▍    | 9284/9741 [00:18<00:00, 545.14it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████    | 9340/9741 [00:18<00:00, 546.87it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▌   | 9395/9741 [00:18<00:00, 546.99it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████   | 9450/9741 [00:18<00:00, 547.07it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▋  | 9505/9741 [00:18<00:00, 539.40it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████▏ | 9561/9741 [00:18<00:00, 542.84it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▊ | 9617/9741 [00:18<00:00, 545.12it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▎| 9672/9741 [00:18<00:00, 545.43it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████▊| 9727/9741 [00:18<00:00, 542.97it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:18<00:00, 513.57it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.11s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.14s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.59s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.22s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.18s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.80s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.62s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]
[2023-08-18 08:08:58,491] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.55s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.90s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.82s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.78s/it]
[2023-08-18 08:09:12,389] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 08:09:12,390] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 08:09:12,390] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 08:09:12,390] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 08:09:12,390] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 08:09:12,390] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 08:09:12,390] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 08:09:12,390] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 08:09:12,390] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 08:09:12,390] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 08:09:12,390] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f65f803d310>
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f65f803de50>
[2023-08-18 08:09:12,391] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 08:09:12,392] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 08:09:12,392] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.46474552154541016 seconds
Loading extension module utils...
Time to load utils op: 0.4043004512786865 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
So the final answer is 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
So the final answer is 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: Stella and Twinkle filled up the truck at the rate of 250 blocks per hour per person, a total of 2*250 = <<250*2=500>>500 blocks per hour for both.
After working for four hours, Stella and Twinkle had filled 4*500 = <<4*500=2000>>2000 blocks into the truck.
The number of blocks they had to put into the truck for it to be full is 6000-2000 = <<6000-2000=4000>>4000
When 6 more people joined Stella and Twinkle, a total of 2+6 = <<2+6=8>>8 people were filling the truck now.
Working at the rate of 250 blocks per person, the eight people filled the truck with 250*8 = <<250*8=2000>>2000 blocks in one hour.
If there were 4000 blocks that still needed to be put into the truck, the 8 people took 4000/2000 = <<4000/2000=2>>2 hours to fill the truck with the blocks.
The total time it took to fill up the tank is 4+2 = <<4+2=6>>6 hours.
So the final answer is 6

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o6-tgsm8k-s10-rTrue
Loading extension module utils...
Time to load utils op: 0.5046215057373047 seconds
Loading extension module utils...
Time to load utils op: 0.40543389320373535 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:43<35:10, 43.07s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:25<34:17, 42.87s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:07<33:19, 42.55s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [02:49<32:24, 42.28s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:32<31:46, 42.37s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:15<31:09, 42.48s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [04:57<30:27, 42.50s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [05:40<29:51, 42.65s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [06:23<29:06, 42.59s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [07:05<28:18, 42.46s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [07:47<27:36, 42.48s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [08:29<26:50, 42.38s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [09:11<26:04, 42.29s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [09:53<25:18, 42.19s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [10:36<24:41, 42.32s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [11:18<23:59, 42.34s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [12:01<23:18, 42.38s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [12:43<22:35, 42.37s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [13:25<21:49, 42.25s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [14:08<21:11, 42.37s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [14:50<20:23, 42.20s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [15:32<19:45, 42.32s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [16:15<19:02, 42.30s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [16:57<18:21, 42.35s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [17:39<17:37, 42.29s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [18:22<16:58, 42.42s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [19:04<16:16, 42.46s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [19:31<13:52, 37.83s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [20:14<13:41, 39.13s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [20:56<13:19, 39.99s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [21:38<12:53, 40.70s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [22:20<12:19, 41.10s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [23:03<11:46, 41.53s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [23:45<11:08, 41.76s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [24:27<10:28, 41.93s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [25:10<09:48, 42.07s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [25:52<09:09, 42.28s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [26:35<08:27, 42.28s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [27:17<07:46, 42.41s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [27:59<07:03, 42.34s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [28:42<06:22, 42.46s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [29:25<05:39, 42.48s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [30:07<04:57, 42.52s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [30:50<04:14, 42.45s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [31:32<03:32, 42.42s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [32:15<02:49, 42.48s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [32:57<02:07, 42.39s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [33:27<01:17, 38.72s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [34:10<00:40, 40.03s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [34:52<00:00, 40.73s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [34:52<00:00, 41.86s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.4806} | lm_loss 7.837 | avg. gen lenth: 330.604
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 7
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 08:44:16,280] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 7
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o7-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                                  | 32/9741 [00:00<00:30, 318.44it/s]  1%|▋                                                                                                  | 64/9741 [00:00<00:30, 318.39it/s]  1%|▉                                                                                                  | 97/9741 [00:00<00:30, 319.21it/s]  1%|█▎                                                                                                | 129/9741 [00:00<00:30, 319.37it/s]  2%|█▋                                                                                                | 162/9741 [00:00<00:29, 319.77it/s]  2%|█▉                                                                                                | 194/9741 [00:00<00:29, 319.18it/s]  2%|██▎                                                                                               | 226/9741 [00:00<00:30, 317.03it/s]  3%|██▌                                                                                               | 258/9741 [00:00<00:30, 311.83it/s]  3%|██▉                                                                                               | 290/9741 [00:00<00:30, 313.77it/s]  3%|███▏                                                                                              | 322/9741 [00:01<00:29, 315.50it/s]  4%|███▌                                                                                              | 354/9741 [00:01<00:29, 316.66it/s]  4%|███▉                                                                                              | 386/9741 [00:01<00:29, 317.64it/s]  4%|████▏                                                                                             | 419/9741 [00:01<00:29, 319.26it/s]  5%|████▌                                                                                             | 451/9741 [00:01<00:29, 318.45it/s]  5%|████▊                                                                                             | 484/9741 [00:01<00:28, 320.36it/s]  5%|█████▏                                                                                            | 517/9741 [00:01<00:28, 321.90it/s]  6%|█████▌                                                                                            | 550/9741 [00:01<00:28, 322.78it/s]  6%|█████▊                                                                                            | 583/9741 [00:01<00:28, 320.51it/s]  6%|██████▏                                                                                           | 616/9741 [00:01<00:28, 321.09it/s]  7%|██████▌                                                                                           | 649/9741 [00:02<00:28, 322.26it/s]  7%|██████▊                                                                                           | 682/9741 [00:02<00:28, 321.11it/s]  7%|███████▏                                                                                          | 715/9741 [00:02<00:28, 322.27it/s]  8%|███████▌                                                                                          | 748/9741 [00:02<00:27, 322.89it/s]  8%|███████▊                                                                                          | 781/9741 [00:02<00:27, 323.93it/s]  8%|████████▏                                                                                         | 819/9741 [00:02<00:26, 340.06it/s]  9%|████████▋                                                                                         | 869/9741 [00:02<00:22, 385.81it/s]  9%|█████████▏                                                                                        | 918/9741 [00:02<00:21, 414.81it/s] 10%|█████████▋                                                                                        | 968/9741 [00:02<00:20, 437.88it/s] 10%|██████████▏                                                                                      | 1018/9741 [00:02<00:19, 454.11it/s] 11%|██████████▋                                                                                      | 1068/9741 [00:03<00:18, 465.83it/s] 11%|███████████                                                                                      | 1116/9741 [00:03<00:18, 467.77it/s] 12%|███████████▌                                                                                     | 1165/9741 [00:03<00:18, 473.67it/s] 12%|████████████                                                                                     | 1214/9741 [00:03<00:17, 478.35it/s] 13%|████████████▌                                                                                    | 1263/9741 [00:03<00:17, 479.54it/s] 13%|█████████████                                                                                    | 1312/9741 [00:03<00:17, 481.34it/s] 14%|█████████████▌                                                                                   | 1361/9741 [00:03<00:17, 480.92it/s] 14%|██████████████                                                                                   | 1410/9741 [00:03<00:17, 483.60it/s] 15%|██████████████▌                                                                                  | 1459/9741 [00:03<00:17, 471.14it/s] 15%|███████████████                                                                                  | 1509/9741 [00:03<00:17, 476.92it/s] 16%|███████████████▌                                                                                 | 1559/9741 [00:04<00:16, 481.66it/s] 17%|████████████████                                                                                 | 1608/9741 [00:04<00:16, 481.51it/s] 17%|████████████████▌                                                                                | 1658/9741 [00:04<00:16, 485.16it/s] 18%|████████████████▉                                                                                | 1707/9741 [00:04<00:16, 483.06it/s] 18%|█████████████████▍                                                                               | 1757/9741 [00:04<00:16, 485.33it/s] 19%|█████████████████▉                                                                               | 1806/9741 [00:04<00:17, 444.11it/s] 19%|██████████████████▍                                                                              | 1855/9741 [00:04<00:17, 455.18it/s] 20%|██████████████████▉                                                                              | 1904/9741 [00:04<00:16, 462.85it/s] 20%|███████████████████▍                                                                             | 1953/9741 [00:04<00:16, 469.23it/s] 21%|███████████████████▉                                                                             | 2002/9741 [00:05<00:16, 472.90it/s] 21%|████████████████████▍                                                                            | 2050/9741 [00:05<00:16, 471.66it/s] 22%|████████████████████▉                                                                            | 2098/9741 [00:05<00:16, 473.10it/s] 22%|█████████████████████▎                                                                           | 2146/9741 [00:05<00:16, 474.32it/s] 23%|█████████████████████▊                                                                           | 2194/9741 [00:05<00:15, 475.57it/s] 23%|██████████████████████▎                                                                          | 2243/9741 [00:05<00:15, 475.32it/s] 24%|██████████████████████▊                                                                          | 2293/9741 [00:05<00:15, 479.73it/s] 24%|███████████████████████▎                                                                         | 2342/9741 [00:05<00:15, 480.56it/s] 25%|███████████████████████▊                                                                         | 2392/9741 [00:05<00:15, 483.94it/s] 25%|████████████████████████▎                                                                        | 2442/9741 [00:05<00:15, 486.55it/s] 26%|████████████████████████▊                                                                        | 2491/9741 [00:06<00:14, 484.79it/s] 26%|█████████████████████████▎                                                                       | 2540/9741 [00:06<00:14, 486.18it/s] 27%|█████████████████████████▊                                                                       | 2590/9741 [00:06<00:14, 487.97it/s] 27%|██████████████████████████▎                                                                      | 2639/9741 [00:06<00:14, 488.43it/s] 28%|██████████████████████████▊                                                                      | 2688/9741 [00:06<00:14, 488.83it/s] 28%|███████████████████████████▎                                                                     | 2737/9741 [00:06<00:14, 486.41it/s] 29%|███████████████████████████▊                                                                     | 2787/9741 [00:06<00:14, 487.59it/s] 29%|████████████████████████████▎                                                                    | 2837/9741 [00:06<00:14, 488.31it/s] 30%|████████████████████████████▋                                                                    | 2887/9741 [00:06<00:14, 489.06it/s] 30%|█████████████████████████████▏                                                                   | 2936/9741 [00:06<00:14, 485.45it/s] 31%|█████████████████████████████▋                                                                   | 2985/9741 [00:07<00:13, 484.87it/s] 31%|██████████████████████████████▏                                                                  | 3034/9741 [00:07<00:13, 484.81it/s] 32%|██████████████████████████████▋                                                                  | 3084/9741 [00:07<00:13, 486.54it/s] 32%|███████████████████████████████▏                                                                 | 3134/9741 [00:07<00:13, 488.34it/s] 33%|███████████████████████████████▋                                                                 | 3183/9741 [00:07<00:13, 484.46it/s] 33%|████████████████████████████████▏                                                                | 3233/9741 [00:07<00:13, 486.69it/s] 34%|████████████████████████████████▋                                                                | 3283/9741 [00:07<00:13, 488.79it/s] 34%|█████████████████████████████████▏                                                               | 3333/9741 [00:07<00:13, 489.69it/s] 35%|█████████████████████████████████▋                                                               | 3382/9741 [00:07<00:13, 487.22it/s] 35%|██████████████████████████████████▏                                                              | 3431/9741 [00:07<00:12, 487.58it/s] 36%|██████████████████████████████████▋                                                              | 3480/9741 [00:08<00:12, 488.09it/s] 36%|███████████████████████████████████▏                                                             | 3529/9741 [00:08<00:12, 487.71it/s] 37%|███████████████████████████████████▋                                                             | 3579/9741 [00:08<00:12, 488.45it/s] 37%|████████████████████████████████████▏                                                            | 3628/9741 [00:08<00:12, 485.10it/s] 38%|████████████████████████████████████▋                                                            | 3678/9741 [00:08<00:12, 486.65it/s] 38%|█████████████████████████████████████                                                            | 3728/9741 [00:08<00:12, 487.65it/s] 39%|█████████████████████████████████████▌                                                           | 3777/9741 [00:08<00:12, 487.77it/s] 39%|██████████████████████████████████████                                                           | 3826/9741 [00:08<00:12, 487.79it/s] 40%|██████████████████████████████████████▌                                                          | 3875/9741 [00:08<00:12, 484.22it/s] 40%|███████████████████████████████████████                                                          | 3924/9741 [00:08<00:11, 485.83it/s] 41%|███████████████████████████████████████▌                                                         | 3974/9741 [00:09<00:11, 487.27it/s] 41%|████████████████████████████████████████                                                         | 4023/9741 [00:09<00:11, 486.05it/s] 42%|████████████████████████████████████████▌                                                        | 4072/9741 [00:09<00:11, 484.06it/s] 42%|█████████████████████████████████████████                                                        | 4121/9741 [00:09<00:11, 485.42it/s] 43%|█████████████████████████████████████████▌                                                       | 4170/9741 [00:09<00:11, 486.19it/s] 43%|██████████████████████████████████████████                                                       | 4219/9741 [00:09<00:11, 486.88it/s] 44%|██████████████████████████████████████████▌                                                      | 4268/9741 [00:09<00:11, 486.53it/s] 44%|██████████████████████████████████████████▉                                                      | 4317/9741 [00:09<00:11, 484.61it/s] 45%|███████████████████████████████████████████▍                                                     | 4366/9741 [00:09<00:11, 485.73it/s] 45%|███████████████████████████████████████████▉                                                     | 4415/9741 [00:09<00:10, 486.55it/s] 46%|████████████████████████████████████████████▍                                                    | 4464/9741 [00:10<00:10, 486.32it/s] 46%|████████████████████████████████████████████▉                                                    | 4513/9741 [00:10<00:11, 450.81it/s] 47%|█████████████████████████████████████████████▍                                                   | 4562/9741 [00:10<00:11, 461.42it/s] 47%|█████████████████████████████████████████████▉                                                   | 4612/9741 [00:10<00:10, 469.85it/s] 48%|██████████████████████████████████████████████▍                                                  | 4662/9741 [00:10<00:10, 475.87it/s] 48%|██████████████████████████████████████████████▉                                                  | 4711/9741 [00:10<00:10, 479.91it/s] 49%|███████████████████████████████████████████████▍                                                 | 4760/9741 [00:10<00:14, 332.30it/s] 49%|███████████████████████████████████████████████▉                                                 | 4810/9741 [00:10<00:13, 368.30it/s] 50%|████████████████████████████████████████████████▍                                                | 4859/9741 [00:11<00:12, 397.42it/s] 50%|████████████████████████████████████████████████▉                                                | 4909/9741 [00:11<00:11, 421.60it/s] 51%|█████████████████████████████████████████████████▎                                               | 4958/9741 [00:11<00:10, 437.82it/s] 51%|█████████████████████████████████████████████████▊                                               | 5007/9741 [00:11<00:10, 451.94it/s] 52%|██████████████████████████████████████████████████▎                                              | 5057/9741 [00:11<00:10, 462.90it/s] 52%|██████████████████████████████████████████████████▊                                              | 5106/9741 [00:11<00:09, 470.31it/s] 53%|███████████████████████████████████████████████████▎                                             | 5156/9741 [00:11<00:09, 476.39it/s] 53%|███████████████████████████████████████████████████▊                                             | 5205/9741 [00:11<00:09, 477.20it/s] 54%|████████████████████████████████████████████████████▎                                            | 5255/9741 [00:11<00:09, 481.10it/s] 54%|████████████████████████████████████████████████████▊                                            | 5305/9741 [00:11<00:09, 484.24it/s] 55%|█████████████████████████████████████████████████████▎                                           | 5355/9741 [00:12<00:09, 486.34it/s] 55%|█████████████████████████████████████████████████████▊                                           | 5404/9741 [00:12<00:08, 484.82it/s] 56%|██████████████████████████████████████████████████████▎                                          | 5454/9741 [00:12<00:08, 486.85it/s] 57%|██████████████████████████████████████████████████████▊                                          | 5505/9741 [00:12<00:08, 491.32it/s] 57%|███████████████████████████████████████████████████████▎                                         | 5555/9741 [00:12<00:08, 491.81it/s] 58%|███████████████████████████████████████████████████████▊                                         | 5606/9741 [00:12<00:08, 496.10it/s] 58%|████████████████████████████████████████████████████████▎                                        | 5656/9741 [00:12<00:08, 496.08it/s] 59%|████████████████████████████████████████████████████████▊                                        | 5707/9741 [00:12<00:08, 499.20it/s] 59%|█████████████████████████████████████████████████████████▎                                       | 5758/9741 [00:12<00:07, 501.75it/s] 60%|█████████████████████████████████████████████████████████▊                                       | 5809/9741 [00:12<00:07, 503.61it/s] 60%|██████████████████████████████████████████████████████████▎                                      | 5860/9741 [00:13<00:07, 501.89it/s] 61%|██████████████████████████████████████████████████████████▊                                      | 5911/9741 [00:13<00:07, 503.50it/s] 61%|███████████████████████████████████████████████████████████▎                                     | 5962/9741 [00:13<00:07, 504.80it/s] 62%|███████████████████████████████████████████████████████████▉                                     | 6013/9741 [00:13<00:07, 505.05it/s] 62%|████████████████████████████████████████████████████████████▍                                    | 6064/9741 [00:13<00:07, 504.39it/s] 63%|████████████████████████████████████████████████████████████▉                                    | 6115/9741 [00:13<00:07, 502.30it/s] 63%|█████████████████████████████████████████████████████████████▍                                   | 6166/9741 [00:13<00:07, 503.24it/s] 64%|█████████████████████████████████████████████████████████████▉                                   | 6217/9741 [00:13<00:06, 504.36it/s] 64%|██████████████████████████████████████████████████████████████▍                                  | 6268/9741 [00:13<00:06, 504.16it/s] 65%|██████████████████████████████████████████████████████████████▉                                  | 6319/9741 [00:14<00:06, 502.60it/s] 65%|███████████████████████████████████████████████████████████████▍                                 | 6370/9741 [00:14<00:06, 503.78it/s] 66%|███████████████████████████████████████████████████████████████▉                                 | 6421/9741 [00:14<00:06, 500.18it/s] 66%|████████████████████████████████████████████████████████████████▍                                | 6472/9741 [00:14<00:06, 501.73it/s] 67%|████████████████████████████████████████████████████████████████▉                                | 6523/9741 [00:14<00:06, 502.70it/s] 67%|█████████████████████████████████████████████████████████████████▍                               | 6574/9741 [00:14<00:06, 500.99it/s] 68%|█████████████████████████████████████████████████████████████████▉                               | 6625/9741 [00:14<00:06, 501.67it/s] 69%|██████████████████████████████████████████████████████████████████▍                              | 6676/9741 [00:14<00:06, 503.06it/s] 69%|██████████████████████████████████████████████████████████████████▉                              | 6727/9741 [00:14<00:05, 503.31it/s] 70%|███████████████████████████████████████████████████████████████████▍                             | 6778/9741 [00:14<00:05, 501.47it/s] 70%|████████████████████████████████████████████████████████████████████                             | 6829/9741 [00:15<00:05, 502.69it/s] 71%|████████████████████████████████████████████████████████████████████▌                            | 6880/9741 [00:15<00:05, 503.62it/s] 71%|█████████████████████████████████████████████████████████████████████                            | 6931/9741 [00:15<00:05, 504.05it/s] 72%|█████████████████████████████████████████████████████████████████████▌                           | 6982/9741 [00:15<00:05, 504.58it/s] 72%|██████████████████████████████████████████████████████████████████████                           | 7033/9741 [00:15<00:05, 502.37it/s] 73%|██████████████████████████████████████████████████████████████████████▌                          | 7084/9741 [00:15<00:05, 494.77it/s] 73%|███████████████████████████████████████████████████████████████████████                          | 7134/9741 [00:15<00:05, 486.09it/s] 74%|███████████████████████████████████████████████████████████████████████▌                         | 7185/9741 [00:15<00:05, 491.46it/s] 74%|████████████████████████████████████████████████████████████████████████                         | 7235/9741 [00:15<00:05, 492.04it/s] 75%|████████████████████████████████████████████████████████████████████████▌                        | 7285/9741 [00:15<00:05, 490.52it/s] 75%|█████████████████████████████████████████████████████████████████████████                        | 7336/9741 [00:16<00:04, 494.48it/s] 76%|█████████████████████████████████████████████████████████████████████████▌                       | 7387/9741 [00:16<00:04, 497.51it/s] 76%|██████████████████████████████████████████████████████████████████████████                       | 7438/9741 [00:16<00:04, 499.14it/s] 77%|██████████████████████████████████████████████████████████████████████████▌                      | 7488/9741 [00:16<00:05, 439.27it/s] 77%|███████████████████████████████████████████████████████████████████████████                      | 7539/9741 [00:16<00:04, 456.50it/s] 78%|███████████████████████████████████████████████████████████████████████████▌                     | 7590/9741 [00:16<00:04, 469.61it/s] 78%|████████████████████████████████████████████████████████████████████████████                     | 7641/9741 [00:16<00:04, 479.37it/s] 79%|████████████████████████████████████████████████████████████████████████████▌                    | 7691/9741 [00:16<00:04, 483.26it/s] 79%|█████████████████████████████████████████████████████████████████████████████                    | 7742/9741 [00:16<00:04, 489.47it/s] 80%|█████████████████████████████████████████████████████████████████████████████▌                   | 7793/9741 [00:17<00:03, 493.39it/s] 81%|██████████████████████████████████████████████████████████████████████████████                   | 7844/9741 [00:17<00:03, 496.29it/s] 81%|██████████████████████████████████████████████████████████████████████████████▌                  | 7894/9741 [00:17<00:03, 495.79it/s] 82%|███████████████████████████████████████████████████████████████████████████████                  | 7945/9741 [00:17<00:03, 498.01it/s] 82%|███████████████████████████████████████████████████████████████████████████████▌                 | 7996/9741 [00:17<00:03, 499.29it/s] 83%|████████████████████████████████████████████████████████████████████████████████▏                | 8047/9741 [00:17<00:03, 499.54it/s] 83%|████████████████████████████████████████████████████████████████████████████████▋                | 8097/9741 [00:17<00:03, 494.59it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▏               | 8147/9741 [00:17<00:03, 494.25it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▋               | 8198/9741 [00:17<00:03, 496.53it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▏              | 8248/9741 [00:17<00:03, 497.55it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▋              | 8299/9741 [00:18<00:02, 498.37it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▏             | 8349/9741 [00:18<00:02, 496.76it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▋             | 8400/9741 [00:18<00:02, 498.25it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▏            | 8451/9741 [00:18<00:02, 499.42it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▋            | 8502/9741 [00:18<00:02, 500.52it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▏           | 8553/9741 [00:18<00:02, 500.56it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▋           | 8604/9741 [00:18<00:02, 498.31it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▏          | 8655/9741 [00:18<00:02, 498.88it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▋          | 8706/9741 [00:18<00:02, 499.69it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▏         | 8756/9741 [00:18<00:01, 499.71it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▋         | 8806/9741 [00:19<00:01, 497.09it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▏        | 8857/9741 [00:19<00:01, 498.10it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▋        | 8908/9741 [00:19<00:01, 499.10it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▏       | 8958/9741 [00:19<00:01, 499.01it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▋       | 9008/9741 [00:19<00:01, 498.91it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▏      | 9058/9741 [00:19<00:01, 496.11it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████████▋      | 9109/9741 [00:19<00:01, 497.32it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▏     | 9160/9741 [00:19<00:01, 498.50it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████▋     | 9211/9741 [00:19<00:01, 499.10it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▏    | 9261/9741 [00:19<00:00, 496.42it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▋    | 9312/9741 [00:20<00:00, 497.62it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▏   | 9363/9741 [00:20<00:00, 498.68it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▋   | 9414/9741 [00:20<00:00, 499.29it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████▏  | 9464/9741 [00:20<00:00, 499.10it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▋  | 9514/9741 [00:20<00:00, 496.65it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████▏ | 9564/9741 [00:20<00:00, 497.63it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▋ | 9614/9741 [00:20<00:00, 497.91it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▏| 9664/9741 [00:20<00:00, 498.03it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████▋| 9714/9741 [00:20<00:00, 495.55it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:20<00:00, 465.63it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:04<00:09,  4.97s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.34s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.53s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.03s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.40s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.34s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.39s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.38s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.55s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.89s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.89s/it]
[2023-08-18 08:45:29,555] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.94s/it]
[2023-08-18 08:45:39,256] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 08:45:39,256] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fe1676fdf10>
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 08:45:39,257] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fe1676fddf0>
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 08:45:39,258] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 08:45:39,259] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.475557804107666 seconds
Loading extension module utils...
Time to load utils op: 0.505009651184082 seconds
Loading extension module utils...
Time to load utils op: 0.5044829845428467 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
So the final answer is 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
So the final answer is 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: Stella and Twinkle filled up the truck at the rate of 250 blocks per hour per person, a total of 2*250 = <<250*2=500>>500 blocks per hour for both.
After working for four hours, Stella and Twinkle had filled 4*500 = <<4*500=2000>>2000 blocks into the truck.
The number of blocks they had to put into the truck for it to be full is 6000-2000 = <<6000-2000=4000>>4000
When 6 more people joined Stella and Twinkle, a total of 2+6 = <<2+6=8>>8 people were filling the truck now.
Working at the rate of 250 blocks per person, the eight people filled the truck with 250*8 = <<250*8=2000>>2000 blocks in one hour.
If there were 4000 blocks that still needed to be put into the truck, the 8 people took 4000/2000 = <<4000/2000=2>>2 hours to fill the truck with the blocks.
The total time it took to fill up the tank is 4+2 = <<4+2=6>>6 hours.
So the final answer is 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: Total drunk: 8.5 + 9.5 = <<8.5+9.5=18>>18 pints
18 pints * 2 = <<18*2=36>>36 cups
The two boys drank a total of 36 cups of liquid yesterday.
So the final answer is 36

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o7-tgsm8k-s10-rTrue
Time to load utils op: 0.3041799068450928 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:42<34:39, 42.45s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:24<33:49, 42.28s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:06<32:50, 41.92s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [02:47<31:59, 41.72s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:29<31:17, 41.73s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:11<30:38, 41.79s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [04:52<29:55, 41.75s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [05:34<29:18, 41.86s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [06:16<28:32, 41.77s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [06:58<27:49, 41.74s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [07:39<27:07, 41.73s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [08:21<26:28, 41.80s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [09:03<25:47, 41.82s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [09:45<25:07, 41.86s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [10:27<24:24, 41.85s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [11:09<23:41, 41.81s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [11:50<22:55, 41.69s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [12:31<22:09, 41.56s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [13:13<21:28, 41.56s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [13:55<20:50, 41.70s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [14:37<20:07, 41.65s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [15:18<19:24, 41.60s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [15:59<18:40, 41.51s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [16:41<17:57, 41.44s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [17:22<17:17, 41.50s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [18:04<16:38, 41.60s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [18:46<15:58, 41.67s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [19:28<15:19, 41.77s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [20:10<14:38, 41.83s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [20:52<13:58, 41.94s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [21:34<13:16, 41.91s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [22:16<12:36, 42.01s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [22:58<11:51, 41.84s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [23:40<11:10, 41.94s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [24:22<10:29, 41.99s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [25:04<09:48, 42.01s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [25:45<09:04, 41.87s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [26:28<08:23, 41.97s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [27:09<07:39, 41.79s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [27:50<06:56, 41.69s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [28:32<06:14, 41.59s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [29:14<05:34, 41.77s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [29:56<04:52, 41.74s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [30:38<04:10, 41.81s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [31:19<03:28, 41.73s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [31:56<02:40, 40.13s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [32:37<02:01, 40.52s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [33:07<01:14, 37.30s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [33:48<00:38, 38.61s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [34:30<00:00, 39.59s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [34:30<00:00, 41.42s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.1519} | lm_loss 7.7322 | avg. gen lenth: 349.828
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 8
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 09:20:19,853] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 8
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o8-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                                  | 27/9741 [00:00<00:37, 262.31it/s]  1%|▌                                                                                                  | 54/9741 [00:00<00:36, 262.91it/s]  1%|▊                                                                                                  | 81/9741 [00:00<00:36, 263.89it/s]  1%|█                                                                                                 | 108/9741 [00:00<00:36, 265.01it/s]  1%|█▎                                                                                                | 135/9741 [00:00<00:36, 263.63it/s]  2%|█▋                                                                                                | 162/9741 [00:00<00:36, 262.93it/s]  2%|█▉                                                                                                | 189/9741 [00:00<00:36, 258.30it/s]  2%|██▏                                                                                               | 215/9741 [00:00<00:37, 256.12it/s]  2%|██▍                                                                                               | 241/9741 [00:00<00:36, 257.11it/s]  3%|██▋                                                                                               | 267/9741 [00:01<00:36, 257.61it/s]  3%|██▉                                                                                               | 293/9741 [00:01<00:36, 258.23it/s]  3%|███▏                                                                                              | 320/9741 [00:01<00:36, 260.59it/s]  4%|███▍                                                                                              | 347/9741 [00:01<00:35, 262.18it/s]  4%|███▊                                                                                              | 374/9741 [00:01<00:35, 263.49it/s]  4%|████                                                                                              | 401/9741 [00:01<00:35, 264.62it/s]  4%|████▎                                                                                             | 428/9741 [00:01<00:35, 262.93it/s]  5%|████▌                                                                                             | 455/9741 [00:01<00:35, 260.80it/s]  5%|████▊                                                                                             | 482/9741 [00:01<00:35, 261.64it/s]  5%|█████                                                                                             | 509/9741 [00:01<00:35, 262.99it/s]  6%|█████▍                                                                                            | 536/9741 [00:02<00:34, 263.92it/s]  6%|█████▋                                                                                            | 563/9741 [00:02<00:34, 264.47it/s]  6%|█████▉                                                                                            | 590/9741 [00:02<00:34, 265.09it/s]  6%|██████▏                                                                                           | 617/9741 [00:02<00:34, 265.15it/s]  7%|██████▍                                                                                           | 644/9741 [00:02<00:34, 265.33it/s]  7%|██████▊                                                                                           | 679/9741 [00:02<00:31, 289.42it/s]  7%|███████▏                                                                                          | 720/9741 [00:02<00:27, 323.43it/s]  8%|███████▋                                                                                          | 761/9741 [00:02<00:25, 347.63it/s]  8%|████████                                                                                          | 802/9741 [00:02<00:24, 364.63it/s]  9%|████████▍                                                                                         | 843/9741 [00:02<00:23, 376.16it/s]  9%|████████▉                                                                                         | 883/9741 [00:03<00:23, 380.58it/s]  9%|█████████▎                                                                                        | 924/9741 [00:03<00:22, 387.07it/s] 10%|█████████▋                                                                                        | 965/9741 [00:03<00:22, 391.80it/s] 10%|██████████                                                                                       | 1006/9741 [00:03<00:22, 394.75it/s] 11%|██████████▍                                                                                      | 1047/9741 [00:03<00:21, 396.38it/s] 11%|██████████▊                                                                                      | 1088/9741 [00:03<00:21, 398.43it/s] 12%|███████████▏                                                                                     | 1128/9741 [00:03<00:21, 396.88it/s] 12%|███████████▋                                                                                     | 1169/9741 [00:03<00:21, 398.13it/s] 12%|████████████                                                                                     | 1210/9741 [00:03<00:21, 399.25it/s] 13%|████████████▍                                                                                    | 1251/9741 [00:03<00:21, 399.96it/s] 13%|████████████▊                                                                                    | 1292/9741 [00:04<00:21, 400.59it/s] 14%|█████████████▎                                                                                   | 1333/9741 [00:04<00:20, 400.41it/s] 14%|█████████████▋                                                                                   | 1374/9741 [00:04<00:21, 397.98it/s] 15%|██████████████                                                                                   | 1414/9741 [00:04<00:20, 397.08it/s] 15%|██████████████▍                                                                                  | 1455/9741 [00:04<00:20, 398.28it/s] 15%|██████████████▉                                                                                  | 1496/9741 [00:04<00:20, 399.12it/s] 16%|███████████████▎                                                                                 | 1537/9741 [00:04<00:20, 399.81it/s] 16%|███████████████▋                                                                                 | 1577/9741 [00:04<00:20, 398.06it/s] 17%|████████████████                                                                                 | 1618/9741 [00:04<00:20, 398.92it/s] 17%|████████████████▌                                                                                | 1659/9741 [00:05<00:20, 399.80it/s] 17%|████████████████▉                                                                                | 1699/9741 [00:05<00:20, 398.64it/s] 18%|█████████████████▎                                                                               | 1740/9741 [00:05<00:20, 399.14it/s] 18%|█████████████████▋                                                                               | 1781/9741 [00:05<00:19, 399.96it/s] 19%|██████████████████▏                                                                              | 1821/9741 [00:05<00:21, 372.49it/s] 19%|██████████████████▌                                                                              | 1862/9741 [00:05<00:20, 380.43it/s] 20%|██████████████████▉                                                                              | 1902/9741 [00:05<00:20, 382.71it/s] 20%|███████████████████▎                                                                             | 1943/9741 [00:05<00:20, 388.10it/s] 20%|███████████████████▊                                                                             | 1984/9741 [00:05<00:19, 391.80it/s] 21%|████████████████████▏                                                                            | 2024/9741 [00:05<00:19, 391.78it/s] 21%|████████████████████▌                                                                            | 2064/9741 [00:06<00:19, 393.90it/s] 22%|████████████████████▉                                                                            | 2104/9741 [00:06<00:19, 395.49it/s] 22%|█████████████████████▎                                                                           | 2145/9741 [00:06<00:19, 396.96it/s] 22%|█████████████████████▊                                                                           | 2186/9741 [00:06<00:18, 398.02it/s] 23%|██████████████████████▏                                                                          | 2226/9741 [00:06<00:18, 398.59it/s] 23%|██████████████████████▌                                                                          | 2266/9741 [00:06<00:18, 396.10it/s] 24%|██████████████████████▉                                                                          | 2306/9741 [00:06<00:18, 397.24it/s] 24%|███████████████████████▎                                                                         | 2346/9741 [00:06<00:18, 396.86it/s] 25%|███████████████████████▊                                                                         | 2387/9741 [00:06<00:18, 398.04it/s] 25%|████████████████████████▏                                                                        | 2427/9741 [00:06<00:18, 394.97it/s] 25%|████████████████████████▌                                                                        | 2467/9741 [00:07<00:18, 395.31it/s] 26%|████████████████████████▉                                                                        | 2507/9741 [00:07<00:18, 391.05it/s] 26%|█████████████████████████▎                                                                       | 2547/9741 [00:07<00:18, 392.93it/s] 27%|█████████████████████████▊                                                                       | 2587/9741 [00:07<00:18, 394.46it/s] 27%|██████████████████████████▏                                                                      | 2627/9741 [00:07<00:17, 395.73it/s] 27%|██████████████████████████▌                                                                      | 2667/9741 [00:07<00:17, 396.66it/s] 28%|██████████████████████████▉                                                                      | 2707/9741 [00:07<00:17, 394.10it/s] 28%|███████████████████████████▎                                                                     | 2747/9741 [00:07<00:17, 395.12it/s] 29%|███████████████████████████▊                                                                     | 2787/9741 [00:07<00:17, 395.58it/s] 29%|████████████████████████████▏                                                                    | 2827/9741 [00:07<00:17, 396.00it/s] 29%|████████████████████████████▌                                                                    | 2867/9741 [00:08<00:17, 396.69it/s] 30%|████████████████████████████▉                                                                    | 2907/9741 [00:08<00:17, 397.06it/s] 30%|█████████████████████████████▎                                                                   | 2947/9741 [00:08<00:17, 392.36it/s] 31%|█████████████████████████████▋                                                                   | 2987/9741 [00:08<00:17, 393.38it/s] 31%|██████████████████████████████▏                                                                  | 3027/9741 [00:08<00:17, 394.68it/s] 31%|██████████████████████████████▌                                                                  | 3067/9741 [00:08<00:16, 395.08it/s] 32%|██████████████████████████████▉                                                                  | 3107/9741 [00:08<00:16, 396.12it/s] 32%|███████████████████████████████▎                                                                 | 3147/9741 [00:08<00:16, 396.36it/s] 33%|███████████████████████████████▋                                                                 | 3187/9741 [00:08<00:16, 393.95it/s] 33%|████████████████████████████████▏                                                                | 3227/9741 [00:08<00:16, 394.80it/s] 34%|████████████████████████████████▌                                                                | 3267/9741 [00:09<00:16, 395.30it/s] 34%|████████████████████████████████▉                                                                | 3307/9741 [00:09<00:16, 395.74it/s] 34%|█████████████████████████████████▎                                                               | 3347/9741 [00:09<00:16, 395.57it/s] 35%|█████████████████████████████████▋                                                               | 3387/9741 [00:09<00:16, 393.08it/s] 35%|██████████████████████████████████▏                                                              | 3427/9741 [00:09<00:16, 394.26it/s] 36%|██████████████████████████████████▌                                                              | 3467/9741 [00:09<00:15, 394.70it/s] 36%|██████████████████████████████████▉                                                              | 3507/9741 [00:09<00:15, 394.75it/s] 36%|███████████████████████████████████▎                                                             | 3547/9741 [00:09<00:15, 395.14it/s] 37%|███████████████████████████████████▋                                                             | 3587/9741 [00:09<00:15, 395.08it/s] 37%|████████████████████████████████████                                                             | 3627/9741 [00:10<00:15, 392.13it/s] 38%|████████████████████████████████████▌                                                            | 3667/9741 [00:10<00:15, 393.10it/s] 38%|████████████████████████████████████▉                                                            | 3707/9741 [00:10<00:15, 394.42it/s] 38%|█████████████████████████████████████▎                                                           | 3747/9741 [00:10<00:15, 394.70it/s] 39%|█████████████████████████████████████▋                                                           | 3787/9741 [00:10<00:15, 395.19it/s] 39%|██████████████████████████████████████                                                           | 3827/9741 [00:10<00:15, 393.13it/s] 40%|██████████████████████████████████████▌                                                          | 3867/9741 [00:10<00:15, 388.67it/s] 40%|██████████████████████████████████████▉                                                          | 3907/9741 [00:10<00:14, 391.36it/s] 41%|███████████████████████████████████████▎                                                         | 3947/9741 [00:10<00:14, 392.66it/s] 41%|███████████████████████████████████████▋                                                         | 3987/9741 [00:10<00:14, 393.49it/s] 41%|████████████████████████████████████████                                                         | 4027/9741 [00:11<00:14, 395.11it/s] 42%|████████████████████████████████████████▍                                                        | 4067/9741 [00:11<00:14, 392.63it/s] 42%|████████████████████████████████████████▉                                                        | 4107/9741 [00:11<00:14, 393.78it/s] 43%|█████████████████████████████████████████▎                                                       | 4147/9741 [00:11<00:14, 395.11it/s] 43%|█████████████████████████████████████████▋                                                       | 4187/9741 [00:11<00:14, 395.85it/s] 43%|██████████████████████████████████████████                                                       | 4227/9741 [00:11<00:13, 396.66it/s] 44%|██████████████████████████████████████████▍                                                      | 4267/9741 [00:11<00:13, 397.56it/s] 44%|██████████████████████████████████████████▉                                                      | 4307/9741 [00:11<00:13, 394.73it/s] 45%|███████████████████████████████████████████▎                                                     | 4347/9741 [00:11<00:13, 395.48it/s] 45%|███████████████████████████████████████████▋                                                     | 4387/9741 [00:11<00:13, 396.26it/s] 45%|████████████████████████████████████████████                                                     | 4427/9741 [00:12<00:13, 396.91it/s] 46%|████████████████████████████████████████████▍                                                    | 4467/9741 [00:12<00:13, 397.12it/s] 46%|████████████████████████████████████████████▉                                                    | 4507/9741 [00:12<00:13, 397.18it/s] 47%|█████████████████████████████████████████████▎                                                   | 4547/9741 [00:12<00:14, 358.68it/s] 47%|█████████████████████████████████████████████▋                                                   | 4587/9741 [00:12<00:13, 369.88it/s] 48%|██████████████████████████████████████████████                                                   | 4627/9741 [00:12<00:13, 378.29it/s] 48%|██████████████████████████████████████████████▍                                                  | 4667/9741 [00:12<00:13, 384.30it/s] 48%|██████████████████████████████████████████████▊                                                  | 4707/9741 [00:12<00:12, 388.85it/s] 49%|███████████████████████████████████████████████▎                                                 | 4747/9741 [00:13<00:19, 261.70it/s] 49%|███████████████████████████████████████████████▋                                                 | 4787/9741 [00:13<00:17, 291.16it/s] 50%|████████████████████████████████████████████████                                                 | 4827/9741 [00:13<00:15, 316.71it/s] 50%|████████████████████████████████████████████████▍                                                | 4867/9741 [00:13<00:14, 336.10it/s] 50%|████████████████████████████████████████████████▊                                                | 4907/9741 [00:13<00:13, 352.51it/s] 51%|█████████████████████████████████████████████████▎                                               | 4947/9741 [00:13<00:13, 363.34it/s] 51%|█████████████████████████████████████████████████▋                                               | 4987/9741 [00:13<00:12, 373.21it/s] 52%|██████████████████████████████████████████████████                                               | 5027/9741 [00:13<00:12, 380.47it/s] 52%|██████████████████████████████████████████████████▍                                              | 5067/9741 [00:13<00:12, 385.86it/s] 52%|██████████████████████████████████████████████████▊                                              | 5107/9741 [00:13<00:11, 389.87it/s] 53%|███████████████████████████████████████████████████▎                                             | 5147/9741 [00:14<00:11, 392.36it/s] 53%|███████████████████████████████████████████████████▋                                             | 5187/9741 [00:14<00:11, 391.35it/s] 54%|████████████████████████████████████████████████████                                             | 5227/9741 [00:14<00:11, 393.45it/s] 54%|████████████████████████████████████████████████████▍                                            | 5267/9741 [00:14<00:11, 394.41it/s] 54%|████████████████████████████████████████████████████▊                                            | 5307/9741 [00:14<00:11, 395.75it/s] 55%|█████████████████████████████████████████████████████▏                                           | 5347/9741 [00:14<00:11, 396.57it/s] 55%|█████████████████████████████████████████████████████▋                                           | 5387/9741 [00:14<00:10, 397.47it/s] 56%|██████████████████████████████████████████████████████                                           | 5427/9741 [00:14<00:10, 395.06it/s] 56%|██████████████████████████████████████████████████████▍                                          | 5467/9741 [00:14<00:10, 396.45it/s] 57%|██████████████████████████████████████████████████████▊                                          | 5508/9741 [00:14<00:10, 399.98it/s] 57%|███████████████████████████████████████████████████████▎                                         | 5549/9741 [00:15<00:10, 402.43it/s] 57%|███████████████████████████████████████████████████████▋                                         | 5590/9741 [00:15<00:10, 391.31it/s] 58%|████████████████████████████████████████████████████████                                         | 5630/9741 [00:15<00:10, 393.40it/s] 58%|████████████████████████████████████████████████████████▍                                        | 5671/9741 [00:15<00:10, 397.66it/s] 59%|████████████████████████████████████████████████████████▉                                        | 5712/9741 [00:15<00:10, 401.08it/s] 59%|█████████████████████████████████████████████████████████▎                                       | 5753/9741 [00:15<00:09, 403.54it/s] 59%|█████████████████████████████████████████████████████████▋                                       | 5794/9741 [00:15<00:09, 405.09it/s] 60%|██████████████████████████████████████████████████████████                                       | 5835/9741 [00:15<00:09, 406.29it/s] 60%|██████████████████████████████████████████████████████████▌                                      | 5876/9741 [00:15<00:09, 403.79it/s] 61%|██████████████████████████████████████████████████████████▉                                      | 5917/9741 [00:15<00:09, 405.28it/s] 61%|███████████████████████████████████████████████████████████▎                                     | 5958/9741 [00:16<00:09, 406.44it/s] 62%|███████████████████████████████████████████████████████████▋                                     | 5999/9741 [00:16<00:09, 407.15it/s] 62%|████████████████████████████████████████████████████████████▏                                    | 6040/9741 [00:16<00:09, 407.89it/s] 62%|████████████████████████████████████████████████████████████▌                                    | 6081/9741 [00:16<00:09, 405.45it/s] 63%|████████████████████████████████████████████████████████████▉                                    | 6122/9741 [00:16<00:08, 406.47it/s] 63%|█████████████████████████████████████████████████████████████▎                                   | 6163/9741 [00:16<00:09, 392.84it/s] 64%|█████████████████████████████████████████████████████████████▊                                   | 6204/9741 [00:16<00:08, 396.59it/s] 64%|██████████████████████████████████████████████████████████████▏                                  | 6245/9741 [00:16<00:08, 398.24it/s] 65%|██████████████████████████████████████████████████████████████▌                                  | 6287/9741 [00:16<00:08, 402.00it/s] 65%|███████████████████████████████████████████████████████████████                                  | 6328/9741 [00:16<00:08, 401.63it/s] 65%|███████████████████████████████████████████████████████████████▍                                 | 6370/9741 [00:17<00:08, 404.16it/s] 66%|███████████████████████████████████████████████████████████████▊                                 | 6411/9741 [00:17<00:08, 405.48it/s] 66%|████████████████████████████████████████████████████████████████▎                                | 6453/9741 [00:17<00:08, 407.29it/s] 67%|████████████████████████████████████████████████████████████████▋                                | 6495/9741 [00:17<00:07, 408.34it/s] 67%|█████████████████████████████████████████████████████████████████                                | 6536/9741 [00:17<00:07, 406.16it/s] 68%|█████████████████████████████████████████████████████████████████▍                               | 6577/9741 [00:17<00:07, 406.93it/s] 68%|█████████████████████████████████████████████████████████████████▉                               | 6618/9741 [00:17<00:07, 407.66it/s] 68%|██████████████████████████████████████████████████████████████████▎                              | 6660/9741 [00:17<00:07, 408.74it/s] 69%|██████████████████████████████████████████████████████████████████▋                              | 6701/9741 [00:17<00:07, 409.10it/s] 69%|███████████████████████████████████████████████████████████████████▏                             | 6743/9741 [00:18<00:07, 409.72it/s] 70%|███████████████████████████████████████████████████████████████████▌                             | 6784/9741 [00:18<00:07, 407.02it/s] 70%|███████████████████████████████████████████████████████████████████▉                             | 6826/9741 [00:18<00:07, 408.24it/s] 71%|████████████████████████████████████████████████████████████████████▍                            | 6868/9741 [00:18<00:07, 409.10it/s] 71%|████████████████████████████████████████████████████████████████████▊                            | 6910/9741 [00:18<00:06, 409.84it/s] 71%|█████████████████████████████████████████████████████████████████████▏                           | 6951/9741 [00:18<00:06, 406.70it/s] 72%|█████████████████████████████████████████████████████████████████████▋                           | 6992/9741 [00:18<00:06, 404.47it/s] 72%|██████████████████████████████████████████████████████████████████████                           | 7033/9741 [00:18<00:06, 406.04it/s] 73%|██████████████████████████████████████████████████████████████████████▍                          | 7075/9741 [00:18<00:06, 407.37it/s] 73%|██████████████████████████████████████████████████████████████████████▊                          | 7117/9741 [00:18<00:06, 408.28it/s] 73%|███████████████████████████████████████████████████████████████████████▎                         | 7159/9741 [00:19<00:06, 409.18it/s] 74%|███████████████████████████████████████████████████████████████████████▋                         | 7201/9741 [00:19<00:06, 409.43it/s] 74%|████████████████████████████████████████████████████████████████████████                         | 7242/9741 [00:19<00:06, 406.69it/s] 75%|████████████████████████████████████████████████████████████████████████▌                        | 7284/9741 [00:19<00:06, 407.88it/s] 75%|████████████████████████████████████████████████████████████████████████▉                        | 7325/9741 [00:19<00:05, 408.48it/s] 76%|█████████████████████████████████████████████████████████████████████████▎                       | 7367/9741 [00:19<00:05, 408.94it/s] 76%|█████████████████████████████████████████████████████████████████████████▊                       | 7409/9741 [00:19<00:05, 409.42it/s] 76%|██████████████████████████████████████████████████████████████████████████▏                      | 7450/9741 [00:19<00:06, 375.50it/s] 77%|██████████████████████████████████████████████████████████████████████████▌                      | 7492/9741 [00:19<00:05, 385.37it/s] 77%|███████████████████████████████████████████████████████████████████████████                      | 7533/9741 [00:19<00:05, 392.15it/s] 78%|███████████████████████████████████████████████████████████████████████████▍                     | 7574/9741 [00:20<00:05, 397.10it/s] 78%|███████████████████████████████████████████████████████████████████████████▊                     | 7614/9741 [00:20<00:05, 397.48it/s] 79%|████████████████████████████████████████████████████████████████████████████▏                    | 7655/9741 [00:20<00:05, 401.12it/s] 79%|████████████████████████████████████████████████████████████████████████████▋                    | 7696/9741 [00:20<00:05, 400.60it/s] 79%|█████████████████████████████████████████████████████████████████████████████                    | 7738/9741 [00:20<00:04, 404.00it/s] 80%|█████████████████████████████████████████████████████████████████████████████▍                   | 7779/9741 [00:20<00:04, 405.30it/s] 80%|█████████████████████████████████████████████████████████████████████████████▊                   | 7820/9741 [00:20<00:04, 406.64it/s] 81%|██████████████████████████████████████████████████████████████████████████████▎                  | 7861/9741 [00:20<00:04, 407.50it/s] 81%|██████████████████████████████████████████████████████████████████████████████▋                  | 7902/9741 [00:20<00:04, 405.58it/s] 82%|███████████████████████████████████████████████████████████████████████████████                  | 7943/9741 [00:20<00:04, 406.66it/s] 82%|███████████████████████████████████████████████████████████████████████████████▌                 | 7984/9741 [00:21<00:04, 395.03it/s] 82%|███████████████████████████████████████████████████████████████████████████████▉                 | 8025/9741 [00:21<00:04, 397.85it/s] 83%|████████████████████████████████████████████████████████████████████████████████▎                | 8066/9741 [00:21<00:04, 400.38it/s] 83%|████████████████████████████████████████████████████████████████████████████████▋                | 8107/9741 [00:21<00:04, 402.85it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▏               | 8148/9741 [00:21<00:03, 401.65it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▌               | 8189/9741 [00:21<00:03, 403.36it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▉               | 8230/9741 [00:21<00:03, 404.61it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▎              | 8271/9741 [00:21<00:03, 405.51it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▊              | 8312/9741 [00:21<00:03, 402.21it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▏             | 8353/9741 [00:22<00:03, 399.18it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▌             | 8394/9741 [00:22<00:03, 401.16it/s] 87%|███████████████████████████████████████████████████████████████████████████████████▉             | 8435/9741 [00:22<00:03, 402.98it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▍            | 8476/9741 [00:22<00:03, 403.85it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▊            | 8517/9741 [00:22<00:03, 405.27it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▏           | 8558/9741 [00:22<00:02, 405.54it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▋           | 8599/9741 [00:22<00:02, 403.18it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████           | 8640/9741 [00:22<00:02, 403.99it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▍          | 8681/9741 [00:22<00:02, 404.92it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████▊          | 8722/9741 [00:22<00:02, 405.34it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▎         | 8763/9741 [00:23<00:02, 405.31it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▋         | 8804/9741 [00:23<00:02, 402.61it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████         | 8845/9741 [00:23<00:02, 403.27it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▍        | 8886/9741 [00:23<00:02, 404.21it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████▉        | 8927/9741 [00:23<00:02, 405.33it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▎       | 8968/9741 [00:23<00:01, 405.93it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▋       | 9009/9741 [00:23<00:01, 402.72it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████       | 9050/9741 [00:23<00:01, 401.17it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▌      | 9091/9741 [00:23<00:01, 402.55it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████████▉      | 9132/9741 [00:23<00:01, 403.60it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▎     | 9173/9741 [00:24<00:01, 404.70it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████▊     | 9214/9741 [00:24<00:01, 404.98it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▏    | 9255/9741 [00:24<00:01, 403.01it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▌    | 9296/9741 [00:24<00:01, 404.24it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▉    | 9337/9741 [00:24<00:00, 405.36it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▍   | 9378/9741 [00:24<00:00, 406.16it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▊   | 9419/9741 [00:24<00:00, 406.45it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████▏  | 9460/9741 [00:24<00:00, 406.12it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▌  | 9501/9741 [00:24<00:00, 403.69it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████  | 9542/9741 [00:24<00:00, 404.71it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████▍ | 9583/9741 [00:25<00:00, 405.23it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▊ | 9624/9741 [00:25<00:00, 405.68it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▏| 9665/9741 [00:25<00:00, 405.70it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████▋| 9706/9741 [00:25<00:00, 403.02it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:25<00:00, 382.87it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.39s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.37s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:04,  4.99s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.40s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.36s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.38s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.56s/it]
Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:09<00:04,  4.97s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.89s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.89s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.01s/it]
[2023-08-18 09:21:38,349] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.34s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.52s/it]
[2023-08-18 09:21:46,743] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 09:21:46,744] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 09:21:46,744] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 09:21:46,744] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 09:21:46,744] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 09:21:46,744] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7ff91281e310>
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7ff91281ee50>
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 09:21:46,745] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 09:21:46,746] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 09:21:46,746] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5275514125823975 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
So the final answer is 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
So the final answer is 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: Stella and Twinkle filled up the truck at the rate of 250 blocks per hour per person, a total of 2*250 = <<250*2=500>>500 blocks per hour for both.
After working for four hours, Stella and Twinkle had filled 4*500 = <<4*500=2000>>2000 blocks into the truck.
The number of blocks they had to put into the truck for it to be full is 6000-2000 = <<6000-2000=4000>>4000
When 6 more people joined Stella and Twinkle, a total of 2+6 = <<2+6=8>>8 people were filling the truck now.
Working at the rate of 250 blocks per person, the eight people filled the truck with 250*8 = <<250*8=2000>>2000 blocks in one hour.
If there were 4000 blocks that still needed to be put into the truck, the 8 people took 4000/2000 = <<4000/2000=2>>2 hours to fill the truck with the blocks.
The total time it took to fill up the tank is 4+2 = <<4+2=6>>6 hours.
So the final answer is 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: Total drunk: 8.5 + 9.5 = <<8.5+9.5=18>>18 pints
18 pints * 2 = <<18*2=36>>36 cups
The two boys drank a total of 36 cups of liquid yesterday.
So the final answer is 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: Each carton has an area of 4*4*5 = <<4*4*5=80>>80 square inches.
Each shipping box has an area of 20*20*20 = <<20*20*20=8000>>8000 square inches
The total number of cartons that will fit into each box is 8000/80 = <<8000/80=100>>100
Since there are 3 widgets in each carton, the total number of cartons in each box will be 3*100 = <<3*100=300>>300
So the final answer is 300

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o8-tgsm8k-s10-rTrue
Loading extension module utils...
Time to load utils op: 0.5046164989471436 seconds
Loading extension module utils...
Time to load utils op: 0.5046017169952393 seconds
Loading extension module utils...
Time to load utils op: 0.404679536819458 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:41<34:02, 41.68s/it]Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 1880710 closing signal SIGTERM
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 1880712 closing signal SIGTERM
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 1880713 closing signal SIGTERM
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 1 (pid: 1880711) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
  <NO_OTHER_FAILURES>
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-18_09:22:37
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 1880711)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 9
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 09:22:42,138] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 9
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o9-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  0%|▏                                                                                                  | 24/9741 [00:00<00:41, 234.78it/s]  0%|▍                                                                                                  | 48/9741 [00:00<00:41, 235.36it/s]  1%|▋                                                                                                  | 72/9741 [00:00<00:40, 235.93it/s]  1%|▉                                                                                                  | 96/9741 [00:00<00:40, 236.49it/s]  1%|█▏                                                                                                | 120/9741 [00:00<00:40, 236.63it/s]  1%|█▍                                                                                                | 144/9741 [00:00<00:40, 236.64it/s]  2%|█▋                                                                                                | 168/9741 [00:00<00:40, 236.43it/s]  2%|█▉                                                                                                | 192/9741 [00:00<00:41, 232.60it/s]  2%|██▏                                                                                               | 216/9741 [00:00<00:41, 230.67it/s]  2%|██▍                                                                                               | 240/9741 [00:01<00:40, 232.44it/s]  3%|██▋                                                                                               | 264/9741 [00:01<00:40, 233.45it/s]  3%|██▉                                                                                               | 288/9741 [00:01<00:40, 233.95it/s]  3%|███▏                                                                                              | 312/9741 [00:01<00:40, 234.69it/s]  3%|███▍                                                                                              | 336/9741 [00:01<00:40, 234.98it/s]  4%|███▌                                                                                              | 360/9741 [00:01<00:39, 235.13it/s]  4%|███▊                                                                                              | 384/9741 [00:01<00:39, 235.45it/s]  4%|████                                                                                              | 408/9741 [00:01<00:44, 211.63it/s]  4%|████▎                                                                                             | 430/9741 [00:01<00:46, 200.73it/s]  5%|████▌                                                                                             | 451/9741 [00:02<00:49, 187.79it/s]  5%|████▋                                                                                             | 471/9741 [00:02<00:51, 179.79it/s]  5%|████▉                                                                                             | 490/9741 [00:02<00:51, 178.93it/s]  5%|█████                                                                                             | 509/9741 [00:02<00:53, 171.56it/s]  5%|█████▎                                                                                            | 527/9741 [00:02<00:56, 163.82it/s]  6%|█████▍                                                                                            | 544/9741 [00:02<00:55, 164.41it/s]  6%|█████▋                                                                                            | 561/9741 [00:02<00:57, 160.82it/s]  6%|█████▊                                                                                            | 578/9741 [00:02<00:56, 163.08it/s]  6%|█████▉                                                                                            | 595/9741 [00:02<00:55, 164.27it/s]  6%|██████▏                                                                                           | 612/9741 [00:03<00:56, 161.24it/s]  7%|██████▍                                                                                           | 634/9741 [00:03<00:51, 177.77it/s]  7%|██████▌                                                                                           | 655/9741 [00:03<00:48, 187.05it/s]  7%|██████▊                                                                                           | 679/9741 [00:03<00:44, 201.67it/s]  7%|███████                                                                                           | 703/9741 [00:03<00:42, 212.53it/s]  7%|███████▎                                                                                          | 727/9741 [00:03<00:40, 219.99it/s]  8%|███████▌                                                                                          | 751/9741 [00:03<00:39, 225.53it/s]  8%|███████▊                                                                                          | 775/9741 [00:03<00:39, 229.41it/s]  8%|████████                                                                                          | 799/9741 [00:03<00:38, 232.36it/s]  8%|████████▎                                                                                         | 823/9741 [00:03<00:38, 234.27it/s]  9%|████████▌                                                                                         | 847/9741 [00:04<00:37, 235.54it/s]  9%|████████▊                                                                                         | 871/9741 [00:04<00:37, 236.13it/s]  9%|█████████                                                                                         | 895/9741 [00:04<00:37, 234.65it/s]  9%|█████████▏                                                                                        | 919/9741 [00:04<00:37, 235.65it/s] 10%|█████████▍                                                                                        | 943/9741 [00:04<00:37, 236.57it/s] 10%|█████████▋                                                                                        | 967/9741 [00:04<00:36, 237.26it/s] 10%|█████████▉                                                                                        | 991/9741 [00:04<00:36, 237.76it/s] 10%|██████████                                                                                       | 1015/9741 [00:04<00:36, 238.15it/s] 11%|██████████▎                                                                                      | 1039/9741 [00:04<00:36, 238.47it/s] 11%|██████████▌                                                                                      | 1063/9741 [00:04<00:36, 238.64it/s] 11%|██████████▊                                                                                      | 1087/9741 [00:05<00:36, 238.60it/s] 11%|███████████                                                                                      | 1111/9741 [00:05<00:36, 236.51it/s] 12%|███████████▎                                                                                     | 1135/9741 [00:05<00:36, 237.25it/s] 12%|███████████▌                                                                                     | 1159/9741 [00:05<00:36, 237.67it/s] 12%|███████████▊                                                                                     | 1183/9741 [00:05<00:35, 238.04it/s] 12%|████████████                                                                                     | 1207/9741 [00:05<00:35, 237.07it/s] 13%|████████████▎                                                                                    | 1231/9741 [00:05<00:35, 236.58it/s] 13%|████████████▍                                                                                    | 1255/9741 [00:05<00:35, 237.16it/s] 13%|████████████▋                                                                                    | 1279/9741 [00:05<00:35, 237.45it/s] 13%|████████████▉                                                                                    | 1303/9741 [00:05<00:35, 237.70it/s] 14%|█████████████▏                                                                                   | 1327/9741 [00:06<00:35, 238.01it/s] 14%|█████████████▍                                                                                   | 1351/9741 [00:06<00:35, 236.08it/s] 14%|█████████████▋                                                                                   | 1375/9741 [00:06<00:35, 236.57it/s] 14%|█████████████▉                                                                                   | 1399/9741 [00:06<00:35, 237.08it/s] 15%|██████████████▏                                                                                  | 1423/9741 [00:06<00:35, 236.36it/s] 15%|██████████████▍                                                                                  | 1447/9741 [00:06<00:35, 236.62it/s] 15%|██████████████▋                                                                                  | 1471/9741 [00:06<00:34, 236.95it/s] 15%|██████████████▉                                                                                  | 1495/9741 [00:06<00:34, 236.68it/s] 16%|███████████████▏                                                                                 | 1519/9741 [00:06<00:34, 236.82it/s] 16%|███████████████▎                                                                                 | 1543/9741 [00:06<00:34, 237.07it/s] 16%|███████████████▌                                                                                 | 1567/9741 [00:07<00:34, 235.39it/s] 16%|███████████████▊                                                                                 | 1591/9741 [00:07<00:34, 236.05it/s] 17%|████████████████                                                                                 | 1615/9741 [00:07<00:34, 236.52it/s] 17%|████████████████▎                                                                                | 1639/9741 [00:07<00:34, 235.00it/s] 17%|████████████████▌                                                                                | 1663/9741 [00:07<00:34, 236.02it/s] 17%|████████████████▊                                                                                | 1687/9741 [00:07<00:34, 236.49it/s] 18%|█████████████████                                                                                | 1711/9741 [00:07<00:33, 236.96it/s] 18%|█████████████████▍                                                                               | 1746/9741 [00:07<00:29, 270.36it/s] 18%|█████████████████▋                                                                               | 1782/9741 [00:07<00:26, 296.77it/s] 19%|██████████████████                                                                               | 1812/9741 [00:08<00:28, 273.73it/s] 19%|██████████████████▍                                                                              | 1848/9741 [00:08<00:26, 297.79it/s] 19%|██████████████████▊                                                                              | 1883/9741 [00:08<00:25, 312.01it/s] 20%|███████████████████                                                                              | 1919/9741 [00:08<00:24, 325.58it/s] 20%|███████████████████▍                                                                             | 1955/9741 [00:08<00:23, 335.03it/s] 20%|███████████████████▊                                                                             | 1991/9741 [00:08<00:22, 342.07it/s] 21%|████████████████████▏                                                                            | 2026/9741 [00:08<00:22, 343.02it/s] 21%|████████████████████▌                                                                            | 2062/9741 [00:08<00:22, 347.28it/s] 22%|████████████████████▉                                                                            | 2098/9741 [00:08<00:21, 350.35it/s] 22%|█████████████████████▎                                                                           | 2134/9741 [00:08<00:21, 353.07it/s] 22%|█████████████████████▌                                                                           | 2170/9741 [00:09<00:21, 354.76it/s] 23%|█████████████████████▉                                                                           | 2206/9741 [00:09<00:21, 355.43it/s] 23%|██████████████████████▎                                                                          | 2242/9741 [00:09<00:21, 356.58it/s] 23%|██████████████████████▋                                                                          | 2278/9741 [00:09<00:21, 354.65it/s] 24%|███████████████████████                                                                          | 2314/9741 [00:09<00:20, 355.79it/s] 24%|███████████████████████▍                                                                         | 2350/9741 [00:09<00:20, 356.45it/s] 24%|███████████████████████▊                                                                         | 2386/9741 [00:09<00:20, 357.31it/s] 25%|████████████████████████                                                                         | 2422/9741 [00:09<00:20, 357.93it/s] 25%|████████████████████████▍                                                                        | 2458/9741 [00:09<00:20, 358.41it/s] 26%|████████████████████████▊                                                                        | 2494/9741 [00:09<00:20, 355.43it/s] 26%|█████████████████████████▏                                                                       | 2530/9741 [00:10<00:20, 355.05it/s] 26%|█████████████████████████▌                                                                       | 2566/9741 [00:10<00:20, 355.94it/s] 27%|█████████████████████████▉                                                                       | 2602/9741 [00:10<00:19, 357.07it/s] 27%|██████████████████████████▎                                                                      | 2638/9741 [00:10<00:19, 357.44it/s] 27%|██████████████████████████▋                                                                      | 2674/9741 [00:10<00:19, 357.88it/s] 28%|██████████████████████████▉                                                                      | 2710/9741 [00:10<00:19, 355.14it/s] 28%|███████████████████████████▎                                                                     | 2746/9741 [00:10<00:19, 356.00it/s] 29%|███████████████████████████▋                                                                     | 2782/9741 [00:10<00:19, 356.33it/s] 29%|████████████████████████████                                                                     | 2818/9741 [00:10<00:19, 356.61it/s] 29%|████████████████████████████▍                                                                    | 2854/9741 [00:10<00:19, 357.08it/s] 30%|████████████████████████████▊                                                                    | 2890/9741 [00:11<00:19, 357.11it/s] 30%|█████████████████████████████▏                                                                   | 2926/9741 [00:11<00:19, 354.86it/s] 30%|█████████████████████████████▍                                                                   | 2962/9741 [00:11<00:19, 355.62it/s] 31%|█████████████████████████████▊                                                                   | 2998/9741 [00:11<00:18, 356.61it/s] 31%|██████████████████████████████▏                                                                  | 3034/9741 [00:11<00:18, 356.63it/s] 32%|██████████████████████████████▌                                                                  | 3070/9741 [00:11<00:18, 355.69it/s] 32%|██████████████████████████████▉                                                                  | 3106/9741 [00:11<00:18, 356.01it/s] 32%|███████████████████████████████▎                                                                 | 3142/9741 [00:11<00:18, 356.27it/s] 33%|███████████████████████████████▋                                                                 | 3178/9741 [00:11<00:18, 353.92it/s] 33%|████████████████████████████████                                                                 | 3214/9741 [00:11<00:18, 354.78it/s] 33%|████████████████████████████████▎                                                                | 3250/9741 [00:12<00:18, 355.71it/s] 34%|████████████████████████████████▋                                                                | 3286/9741 [00:12<00:18, 356.18it/s] 34%|█████████████████████████████████                                                                | 3322/9741 [00:12<00:18, 356.41it/s] 34%|█████████████████████████████████▍                                                               | 3358/9741 [00:12<00:17, 355.36it/s] 35%|█████████████████████████████████▊                                                               | 3394/9741 [00:12<00:17, 353.17it/s] 35%|██████████████████████████████████▏                                                              | 3430/9741 [00:12<00:17, 354.03it/s] 36%|██████████████████████████████████▌                                                              | 3466/9741 [00:12<00:17, 354.00it/s] 36%|██████████████████████████████████▊                                                              | 3502/9741 [00:12<00:17, 354.32it/s] 36%|███████████████████████████████████▏                                                             | 3538/9741 [00:12<00:17, 354.35it/s] 37%|███████████████████████████████████▌                                                             | 3574/9741 [00:12<00:17, 354.56it/s] 37%|███████████████████████████████████▉                                                             | 3610/9741 [00:13<00:17, 351.82it/s] 37%|████████████████████████████████████▎                                                            | 3646/9741 [00:13<00:17, 353.03it/s] 38%|████████████████████████████████████▋                                                            | 3682/9741 [00:13<00:17, 353.87it/s] 38%|█████████████████████████████████████                                                            | 3718/9741 [00:13<00:17, 353.97it/s] 39%|█████████████████████████████████████▍                                                           | 3754/9741 [00:13<00:16, 353.35it/s] 39%|█████████████████████████████████████▋                                                           | 3790/9741 [00:13<00:16, 353.81it/s] 39%|██████████████████████████████████████                                                           | 3826/9741 [00:13<00:16, 354.72it/s] 40%|██████████████████████████████████████▍                                                          | 3862/9741 [00:13<00:16, 352.94it/s] 40%|██████████████████████████████████████▊                                                          | 3898/9741 [00:13<00:16, 354.41it/s] 40%|███████████████████████████████████████▏                                                         | 3934/9741 [00:13<00:16, 355.47it/s] 41%|███████████████████████████████████████▌                                                         | 3970/9741 [00:14<00:16, 356.07it/s] 41%|███████████████████████████████████████▉                                                         | 4006/9741 [00:14<00:16, 356.98it/s] 41%|████████████████████████████████████████▏                                                        | 4042/9741 [00:14<00:15, 357.49it/s] 42%|████████████████████████████████████████▌                                                        | 4078/9741 [00:14<00:15, 355.08it/s] 42%|████████████████████████████████████████▉                                                        | 4114/9741 [00:14<00:15, 355.85it/s] 43%|█████████████████████████████████████████▎                                                       | 4150/9741 [00:14<00:15, 354.09it/s] 43%|█████████████████████████████████████████▋                                                       | 4186/9741 [00:14<00:15, 354.79it/s] 43%|██████████████████████████████████████████                                                       | 4222/9741 [00:14<00:15, 354.89it/s] 44%|██████████████████████████████████████████▍                                                      | 4258/9741 [00:14<00:15, 355.30it/s] 44%|██████████████████████████████████████████▊                                                      | 4294/9741 [00:14<00:15, 353.07it/s] 44%|███████████████████████████████████████████                                                      | 4330/9741 [00:15<00:15, 354.14it/s] 45%|███████████████████████████████████████████▍                                                     | 4366/9741 [00:15<00:15, 355.09it/s] 45%|███████████████████████████████████████████▊                                                     | 4402/9741 [00:15<00:14, 355.95it/s] 46%|████████████████████████████████████████████▏                                                    | 4438/9741 [00:15<00:14, 356.21it/s] 46%|████████████████████████████████████████████▌                                                    | 4474/9741 [00:15<00:14, 356.58it/s] 46%|████████████████████████████████████████████▉                                                    | 4510/9741 [00:15<00:14, 356.81it/s] 47%|█████████████████████████████████████████████▎                                                   | 4546/9741 [00:15<00:16, 318.22it/s] 47%|█████████████████████████████████████████████▋                                                   | 4582/9741 [00:15<00:15, 328.99it/s] 47%|█████████████████████████████████████████████▉                                                   | 4618/9741 [00:15<00:15, 336.99it/s] 48%|██████████████████████████████████████████████▎                                                  | 4654/9741 [00:16<00:14, 343.17it/s] 48%|██████████████████████████████████████████████▋                                                  | 4690/9741 [00:16<00:14, 347.52it/s] 49%|███████████████████████████████████████████████                                                  | 4726/9741 [00:16<00:14, 350.70it/s] 49%|███████████████████████████████████████████████▍                                                 | 4762/9741 [00:16<00:20, 241.99it/s] 49%|███████████████████████████████████████████████▊                                                 | 4798/9741 [00:16<00:18, 267.88it/s] 50%|████████████████████████████████████████████████▏                                                | 4834/9741 [00:16<00:16, 289.46it/s] 50%|████████████████████████████████████████████████▍                                                | 4869/9741 [00:16<00:16, 304.26it/s] 50%|████████████████████████████████████████████████▊                                                | 4905/9741 [00:16<00:15, 318.53it/s] 51%|█████████████████████████████████████████████████▏                                               | 4941/9741 [00:17<00:14, 329.55it/s] 51%|█████████████████████████████████████████████████▌                                               | 4976/9741 [00:17<00:14, 335.13it/s] 51%|█████████████████████████████████████████████████▉                                               | 5012/9741 [00:17<00:13, 341.43it/s] 52%|██████████████████████████████████████████████████▎                                              | 5048/9741 [00:17<00:13, 346.28it/s] 52%|██████████████████████████████████████████████████▋                                              | 5084/9741 [00:17<00:13, 349.58it/s] 53%|██████████████████████████████████████████████████▉                                              | 5120/9741 [00:17<00:13, 350.46it/s] 53%|███████████████████████████████████████████████████▎                                             | 5156/9741 [00:17<00:13, 352.05it/s] 53%|███████████████████████████████████████████████████▋                                             | 5192/9741 [00:17<00:12, 350.67it/s] 54%|████████████████████████████████████████████████████                                             | 5228/9741 [00:17<00:12, 352.57it/s] 54%|████████████████████████████████████████████████████▍                                            | 5264/9741 [00:17<00:12, 351.38it/s] 54%|████████████████████████████████████████████████████▊                                            | 5300/9741 [00:18<00:12, 352.83it/s] 55%|█████████████████████████████████████████████████████▏                                           | 5336/9741 [00:18<00:12, 354.15it/s] 55%|█████████████████████████████████████████████████████▍                                           | 5372/9741 [00:18<00:12, 355.23it/s] 56%|█████████████████████████████████████████████████████▊                                           | 5408/9741 [00:18<00:12, 351.81it/s] 56%|██████████████████████████████████████████████████████▏                                          | 5444/9741 [00:18<00:12, 353.56it/s] 56%|██████████████████████████████████████████████████████▌                                          | 5480/9741 [00:18<00:11, 355.16it/s] 57%|██████████████████████████████████████████████████████▉                                          | 5517/9741 [00:18<00:11, 357.97it/s] 57%|███████████████████████████████████████████████████████▎                                         | 5554/9741 [00:18<00:11, 360.57it/s] 57%|███████████████████████████████████████████████████████▋                                         | 5591/9741 [00:18<00:11, 362.18it/s] 58%|████████████████████████████████████████████████████████                                         | 5628/9741 [00:18<00:11, 361.38it/s] 58%|████████████████████████████████████████████████████████▍                                        | 5665/9741 [00:19<00:11, 359.57it/s] 59%|████████████████████████████████████████████████████████▊                                        | 5702/9741 [00:19<00:11, 361.73it/s] 59%|█████████████████████████████████████████████████████████▏                                       | 5739/9741 [00:19<00:11, 363.69it/s] 59%|█████████████████████████████████████████████████████████▌                                       | 5776/9741 [00:19<00:10, 364.89it/s] 60%|█████████████████████████████████████████████████████████▉                                       | 5813/9741 [00:19<00:10, 365.65it/s] 60%|██████████████████████████████████████████████████████████▎                                      | 5850/9741 [00:19<00:10, 365.23it/s] 60%|██████████████████████████████████████████████████████████▌                                      | 5887/9741 [00:19<00:10, 362.81it/s] 61%|██████████████████████████████████████████████████████████▉                                      | 5924/9741 [00:19<00:10, 361.26it/s] 61%|███████████████████████████████████████████████████████████▎                                     | 5961/9741 [00:19<00:10, 362.94it/s] 62%|███████████████████████████████████████████████████████████▋                                     | 5998/9741 [00:19<00:10, 364.12it/s] 62%|████████████████████████████████████████████████████████████                                     | 6035/9741 [00:20<00:10, 365.25it/s] 62%|████████████████████████████████████████████████████████████▍                                    | 6072/9741 [00:20<00:10, 365.47it/s] 63%|████████████████████████████████████████████████████████████▊                                    | 6109/9741 [00:20<00:09, 363.69it/s] 63%|█████████████████████████████████████████████████████████████▏                                   | 6146/9741 [00:20<00:09, 364.37it/s] 63%|█████████████████████████████████████████████████████████████▌                                   | 6183/9741 [00:20<00:09, 364.96it/s] 64%|█████████████████████████████████████████████████████████████▉                                   | 6220/9741 [00:20<00:09, 365.15it/s] 64%|██████████████████████████████████████████████████████████████▎                                  | 6257/9741 [00:20<00:09, 365.32it/s] 65%|██████████████████████████████████████████████████████████████▋                                  | 6294/9741 [00:20<00:09, 365.96it/s] 65%|███████████████████████████████████████████████████████████████                                  | 6331/9741 [00:20<00:09, 362.92it/s] 65%|███████████████████████████████████████████████████████████████▍                                 | 6368/9741 [00:20<00:09, 364.32it/s] 66%|███████████████████████████████████████████████████████████████▊                                 | 6405/9741 [00:21<00:09, 365.39it/s] 66%|████████████████████████████████████████████████████████████████▏                                | 6442/9741 [00:21<00:09, 365.90it/s] 67%|████████████████████████████████████████████████████████████████▌                                | 6479/9741 [00:21<00:08, 365.90it/s] 67%|████████████████████████████████████████████████████████████████▉                                | 6516/9741 [00:21<00:08, 365.53it/s] 67%|█████████████████████████████████████████████████████████████████▎                               | 6553/9741 [00:21<00:08, 363.08it/s] 68%|█████████████████████████████████████████████████████████████████▌                               | 6590/9741 [00:21<00:08, 364.20it/s] 68%|█████████████████████████████████████████████████████████████████▉                               | 6627/9741 [00:21<00:08, 364.96it/s] 68%|██████████████████████████████████████████████████████████████████▎                              | 6664/9741 [00:21<00:08, 365.73it/s] 69%|██████████████████████████████████████████████████████████████████▋                              | 6701/9741 [00:21<00:08, 365.78it/s] 69%|███████████████████████████████████████████████████████████████████                              | 6738/9741 [00:21<00:08, 366.32it/s] 70%|███████████████████████████████████████████████████████████████████▍                             | 6775/9741 [00:22<00:08, 364.36it/s] 70%|███████████████████████████████████████████████████████████████████▊                             | 6812/9741 [00:22<00:08, 365.22it/s] 70%|████████████████████████████████████████████████████████████████████▏                            | 6849/9741 [00:22<00:07, 365.35it/s] 71%|████████████████████████████████████████████████████████████████████▌                            | 6886/9741 [00:22<00:07, 365.36it/s] 71%|████████████████████████████████████████████████████████████████████▉                            | 6923/9741 [00:22<00:07, 365.78it/s] 71%|█████████████████████████████████████████████████████████████████████▎                           | 6960/9741 [00:22<00:07, 366.20it/s] 72%|█████████████████████████████████████████████████████████████████████▋                           | 6997/9741 [00:22<00:07, 363.73it/s] 72%|██████████████████████████████████████████████████████████████████████                           | 7034/9741 [00:22<00:07, 364.81it/s] 73%|██████████████████████████████████████████████████████████████████████▍                          | 7071/9741 [00:22<00:07, 365.81it/s] 73%|██████████████████████████████████████████████████████████████████████▊                          | 7108/9741 [00:22<00:07, 366.32it/s] 73%|███████████████████████████████████████████████████████████████████████▏                         | 7145/9741 [00:23<00:07, 366.50it/s] 74%|███████████████████████████████████████████████████████████████████████▌                         | 7182/9741 [00:23<00:06, 366.28it/s] 74%|███████████████████████████████████████████████████████████████████████▉                         | 7219/9741 [00:23<00:06, 363.38it/s] 74%|████████████████████████████████████████████████████████████████████████▎                        | 7256/9741 [00:23<00:06, 363.98it/s] 75%|████████████████████████████████████████████████████████████████████████▌                        | 7293/9741 [00:23<00:06, 364.87it/s] 75%|████████████████████████████████████████████████████████████████████████▉                        | 7330/9741 [00:23<00:06, 365.31it/s] 76%|█████████████████████████████████████████████████████████████████████████▎                       | 7367/9741 [00:23<00:06, 365.71it/s] 76%|█████████████████████████████████████████████████████████████████████████▋                       | 7404/9741 [00:23<00:06, 366.25it/s] 76%|██████████████████████████████████████████████████████████████████████████                       | 7441/9741 [00:23<00:06, 330.77it/s] 77%|██████████████████████████████████████████████████████████████████████████▍                      | 7478/9741 [00:24<00:06, 340.26it/s] 77%|██████████████████████████████████████████████████████████████████████████▊                      | 7515/9741 [00:24<00:06, 347.11it/s] 78%|███████████████████████████████████████████████████████████████████████████▏                     | 7551/9741 [00:24<00:06, 350.69it/s] 78%|███████████████████████████████████████████████████████████████████████████▌                     | 7588/9741 [00:24<00:06, 354.85it/s] 78%|███████████████████████████████████████████████████████████████████████████▉                     | 7625/9741 [00:24<00:05, 357.84it/s] 79%|████████████████████████████████████████████████████████████████████████████▎                    | 7662/9741 [00:24<00:05, 359.98it/s] 79%|████████████████████████████████████████████████████████████████████████████▋                    | 7699/9741 [00:24<00:05, 359.06it/s] 79%|█████████████████████████████████████████████████████████████████████████████                    | 7736/9741 [00:24<00:05, 361.81it/s] 80%|█████████████████████████████████████████████████████████████████████████████▍                   | 7773/9741 [00:24<00:05, 362.91it/s] 80%|█████████████████████████████████████████████████████████████████████████████▊                   | 7810/9741 [00:24<00:05, 363.61it/s] 81%|██████████████████████████████████████████████████████████████████████████████▏                  | 7847/9741 [00:25<00:05, 363.64it/s] 81%|██████████████████████████████████████████████████████████████████████████████▌                  | 7884/9741 [00:25<00:05, 363.95it/s] 81%|██████████████████████████████████████████████████████████████████████████████▉                  | 7921/9741 [00:25<00:05, 362.43it/s] 82%|███████████████████████████████████████████████████████████████████████████████▏                 | 7958/9741 [00:25<00:04, 363.26it/s] 82%|███████████████████████████████████████████████████████████████████████████████▌                 | 7995/9741 [00:25<00:04, 363.43it/s] 82%|███████████████████████████████████████████████████████████████████████████████▉                 | 8032/9741 [00:25<00:04, 363.90it/s] 83%|████████████████████████████████████████████████████████████████████████████████▎                | 8069/9741 [00:25<00:04, 363.48it/s] 83%|████████████████████████████████████████████████████████████████████████████████▋                | 8106/9741 [00:25<00:04, 364.49it/s] 84%|█████████████████████████████████████████████████████████████████████████████████                | 8143/9741 [00:25<00:04, 361.94it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▍               | 8180/9741 [00:25<00:04, 362.74it/s] 84%|█████████████████████████████████████████████████████████████████████████████████▊               | 8217/9741 [00:26<00:04, 363.63it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▏              | 8254/9741 [00:26<00:04, 364.26it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▌              | 8291/9741 [00:26<00:03, 363.96it/s] 85%|██████████████████████████████████████████████████████████████████████████████████▉              | 8328/9741 [00:26<00:03, 364.16it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▎             | 8365/9741 [00:26<00:03, 361.97it/s] 86%|███████████████████████████████████████████████████████████████████████████████████▋             | 8402/9741 [00:26<00:03, 362.89it/s] 87%|████████████████████████████████████████████████████████████████████████████████████             | 8439/9741 [00:26<00:03, 363.82it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▍            | 8476/9741 [00:26<00:03, 363.67it/s] 87%|████████████████████████████████████████████████████████████████████████████████████▊            | 8513/9741 [00:26<00:03, 364.14it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▏           | 8550/9741 [00:26<00:03, 363.32it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████▌           | 8587/9741 [00:27<00:03, 361.26it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████▉           | 8624/9741 [00:27<00:03, 362.10it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▏          | 8661/9741 [00:27<00:02, 362.25it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████▌          | 8698/9741 [00:27<00:02, 361.45it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████▉          | 8735/9741 [00:27<00:02, 362.21it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▎         | 8772/9741 [00:27<00:02, 362.03it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████▋         | 8809/9741 [00:27<00:02, 360.06it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████         | 8846/9741 [00:27<00:02, 361.32it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████▍        | 8883/9741 [00:27<00:02, 362.48it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████▊        | 8920/9741 [00:28<00:02, 363.42it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▏       | 8957/9741 [00:28<00:02, 364.16it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████▌       | 8994/9741 [00:28<00:02, 364.34it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████████▉       | 9031/9741 [00:28<00:01, 361.48it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▎      | 9068/9741 [00:28<00:01, 361.97it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████▋      | 9105/9741 [00:28<00:01, 362.31it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████      | 9142/9741 [00:28<00:01, 362.94it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████▍     | 9179/9741 [00:28<00:01, 363.43it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████▊     | 9216/9741 [00:28<00:01, 363.62it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▏    | 9253/9741 [00:28<00:01, 364.14it/s] 95%|████████████████████████████████████████████████████████████████████████████████████████████▌    | 9290/9741 [00:29<00:01, 361.87it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████▉    | 9327/9741 [00:29<00:01, 362.84it/s] 96%|█████████████████████████████████████████████████████████████████████████████████████████████▏   | 9364/9741 [00:29<00:01, 363.11it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▌   | 9401/9741 [00:29<00:00, 362.92it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████▉   | 9438/9741 [00:29<00:00, 363.28it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████▎  | 9475/9741 [00:29<00:00, 363.35it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▋  | 9512/9741 [00:29<00:00, 360.80it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████  | 9549/9741 [00:29<00:00, 361.72it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████▍ | 9586/9741 [00:29<00:00, 361.84it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████▊ | 9623/9741 [00:29<00:00, 362.73it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████▏| 9660/9741 [00:30<00:00, 362.96it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████▌| 9697/9741 [00:30<00:00, 363.20it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████▉| 9734/9741 [00:30<00:00, 360.36it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:30<00:00, 321.72it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.38s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.29s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.03s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.04s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.34s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.31s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.16s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.12s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.52s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
[2023-08-18 09:24:04,152] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.64s/it]
[2023-08-18 09:24:17,082] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 09:24:17,083] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f409733be80>
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 09:24:17,084] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f409733bdc0>
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 09:24:17,085] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 09:24:17,086] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 09:24:17,086] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.563382625579834 seconds
Loading extension module utils...
Time to load utils op: 0.40480589866638184 seconds
Loading extension module utils...
Time to load utils op: 0.5046086311340332 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
So the final answer is 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
So the final answer is 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: Stella and Twinkle filled up the truck at the rate of 250 blocks per hour per person, a total of 2*250 = <<250*2=500>>500 blocks per hour for both.
After working for four hours, Stella and Twinkle had filled 4*500 = <<4*500=2000>>2000 blocks into the truck.
The number of blocks they had to put into the truck for it to be full is 6000-2000 = <<6000-2000=4000>>4000
When 6 more people joined Stella and Twinkle, a total of 2+6 = <<2+6=8>>8 people were filling the truck now.
Working at the rate of 250 blocks per person, the eight people filled the truck with 250*8 = <<250*8=2000>>2000 blocks in one hour.
If there were 4000 blocks that still needed to be put into the truck, the 8 people took 4000/2000 = <<4000/2000=2>>2 hours to fill the truck with the blocks.
The total time it took to fill up the tank is 4+2 = <<4+2=6>>6 hours.
So the final answer is 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: Total drunk: 8.5 + 9.5 = <<8.5+9.5=18>>18 pints
18 pints * 2 = <<18*2=36>>36 cups
The two boys drank a total of 36 cups of liquid yesterday.
So the final answer is 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: Each carton has an area of 4*4*5 = <<4*4*5=80>>80 square inches.
Each shipping box has an area of 20*20*20 = <<20*20*20=8000>>8000 square inches
The total number of cartons that will fit into each box is 8000/80 = <<8000/80=100>>100
Since there are 3 widgets in each carton, the total number of cartons in each box will be 3*100 = <<3*100=300>>300
So the final answer is 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: Queenie will earn $150 x 5 = $<<150*5=750>>750 for working 5 days.
She will receive an additional $5 x 4 = $<<5*4=20>>20 for overtime pay.
Hence, Queenie will receive a total of $750 + $20 = $<<750+20=770>>770.
So the final answer is 770

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o9-tgsm8k-s10-rTrue
Loading extension module utils...
Time to load utils op: 0.6047039031982422 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:41<34:16, 41.97s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:22<33:00, 41.27s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:03<32:06, 40.99s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [02:44<31:20, 40.88s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [03:25<30:40, 40.90s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [04:05<29:58, 40.87s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [04:46<29:16, 40.84s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [05:27<28:33, 40.80s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [06:08<27:51, 40.77s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [06:48<27:09, 40.75s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [07:16<23:48, 36.62s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [07:56<23:58, 37.84s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [08:37<23:54, 38.78s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [09:18<23:34, 39.29s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [09:58<23:09, 39.71s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [10:39<22:43, 40.09s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [11:20<22:10, 40.33s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [12:01<21:37, 40.54s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [12:42<20:56, 40.53s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [13:23<20:22, 40.75s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [14:04<19:41, 40.76s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [14:44<19:01, 40.77s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [15:25<18:20, 40.74s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [16:06<17:38, 40.72s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [16:47<16:58, 40.75s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [17:27<16:18, 40.76s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [18:09<15:39, 40.86s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [18:50<14:59, 40.90s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [19:30<14:18, 40.89s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [20:12<13:39, 40.99s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [20:53<12:58, 40.96s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [21:33<12:17, 40.97s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [22:15<11:36, 40.98s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [22:55<10:55, 40.97s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [23:36<10:14, 40.97s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [24:17<09:33, 40.97s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [24:58<08:52, 40.94s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [25:39<08:11, 40.99s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [26:20<07:30, 40.91s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [27:01<06:48, 40.90s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [27:42<06:08, 40.91s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [28:23<05:27, 40.97s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [29:04<04:46, 40.90s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [29:45<04:06, 41.00s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [30:26<03:25, 41.07s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [31:07<02:43, 40.99s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [31:48<02:03, 41.04s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [32:29<01:22, 41.04s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [33:10<00:40, 40.99s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [33:51<00:00, 41.08s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [33:51<00:00, 40.64s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.3338} | lm_loss 7.694 | avg. gen lenth: 367.12
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

[nltk_data]   Package punkt is already up-to-date!
[2023-08-18 09:58:20,574] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  3%|██▊                                                                                              | 282/9741 [00:00<00:03, 2817.33it/s]  6%|█████▋                                                                                           | 569/9741 [00:00<00:03, 2847.66it/s]  9%|████████▌                                                                                        | 859/9741 [00:00<00:03, 2869.48it/s] 12%|███████████▎                                                                                    | 1151/9741 [00:00<00:02, 2887.65it/s] 15%|██████████████▏                                                                                 | 1440/9741 [00:00<00:02, 2884.77it/s] 18%|█████████████████                                                                               | 1731/9741 [00:00<00:02, 2892.74it/s] 21%|███████████████████▉                                                                            | 2021/9741 [00:00<00:02, 2868.85it/s] 24%|██████████████████████▊                                                                         | 2311/9741 [00:00<00:02, 2876.11it/s] 27%|█████████████████████████▋                                                                      | 2602/9741 [00:00<00:02, 2885.21it/s] 30%|████████████████████████████▍                                                                   | 2891/9741 [00:01<00:02, 2811.68it/s] 33%|███████████████████████████████▎                                                                | 3176/9741 [00:01<00:02, 2823.07it/s] 36%|██████████████████████████████████▏                                                             | 3463/9741 [00:01<00:02, 2836.95it/s] 38%|████████████████████████████████████▉                                                           | 3750/9741 [00:01<00:02, 2845.95it/s] 41%|███████████████████████████████████████▊                                                        | 4039/9741 [00:01<00:01, 2858.28it/s] 44%|██████████████████████████████████████████▋                                                     | 4327/9741 [00:01<00:01, 2863.31it/s] 47%|█████████████████████████████████████████████▍                                                  | 4614/9741 [00:01<00:01, 2828.81it/s] 50%|████████████████████████████████████████████████▎                                               | 4898/9741 [00:01<00:02, 2131.38it/s] 53%|███████████████████████████████████████████████████                                             | 5182/9741 [00:01<00:01, 2302.59it/s] 56%|█████████████████████████████████████████████████████▉                                          | 5468/9741 [00:02<00:01, 2444.90it/s] 60%|█████████████████████████████████████████████████████████▉                                      | 5879/9741 [00:02<00:01, 2891.12it/s] 65%|██████████████████████████████████████████████████████████████▍                                 | 6339/9741 [00:02<00:01, 3362.80it/s] 70%|██████████████████████████████████████████████████████████████████▉                             | 6798/9741 [00:02<00:00, 3710.55it/s] 75%|███████████████████████████████████████████████████████████████████████▌                        | 7261/9741 [00:02<00:00, 3974.77it/s] 79%|███████████████████████████████████████████████████████████████████████████▉                    | 7707/9741 [00:02<00:00, 4116.23it/s] 84%|████████████████████████████████████████████████████████████████████████████████▌               | 8172/9741 [00:02<00:00, 4273.00it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████           | 8635/9741 [00:02<00:00, 4377.29it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████████▋      | 9097/9741 [00:02<00:00, 4447.86it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▏ | 9559/9741 [00:02<00:00, 4498.43it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:02<00:00, 3280.78it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.01s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.50s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.52s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:11,  5.52s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.09s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.40s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.41s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.43s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.60s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.66s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.87s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.98s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.15s/it]
[2023-08-18 09:59:20,023] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-18 09:59:28,398] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 09:59:28,399] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 09:59:28,399] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 09:59:28,399] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 09:59:28,399] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 09:59:28,399] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f689e885310>
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f689e885e50>
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 09:59:28,400] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 09:59:28,401] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 09:59:28,401] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3729240894317627 seconds
Loading extension module utils...
Time to load utils op: 0.30422472953796387 seconds
Loading extension module utils...
Time to load utils op: 0.40444374084472656 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Time to load utils op: 0.4042534828186035 seconds
Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s10-rFalse
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:58<47:45, 58.48s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:57<46:52, 58.60s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:43<41:28, 52.94s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:40<41:47, 54.52s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:38<41:54, 55.87s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [05:36<41:25, 56.48s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [06:13<35:59, 50.22s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [07:11<36:56, 52.77s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [08:04<36:02, 52.73s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [09:01<36:04, 54.12s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [09:52<34:25, 52.97s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [10:50<34:37, 54.68s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [11:44<33:29, 54.30s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [12:35<31:58, 53.30s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [13:31<31:41, 54.33s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [14:28<31:15, 55.17s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [15:25<30:30, 55.48s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [16:24<30:10, 56.57s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [17:22<29:34, 57.24s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [18:20<28:36, 57.22s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [19:16<27:29, 56.89s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [20:13<26:35, 56.98s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [20:50<22:56, 50.97s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [21:48<22:56, 52.96s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [22:45<22:37, 54.31s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [23:42<22:04, 55.17s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [24:02<17:04, 44.55s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [25:01<17:58, 49.02s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [26:01<18:13, 52.09s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [26:19<14:01, 42.07s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [27:17<14:50, 46.89s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [28:15<15:01, 50.07s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [29:12<14:48, 52.25s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [30:11<14:25, 54.09s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [31:03<13:24, 53.62s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [32:01<12:48, 54.89s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [32:59<12:04, 55.70s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [33:25<09:21, 46.82s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [33:56<07:44, 42.23s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [34:53<07:47, 46.70s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [35:50<07:27, 49.68s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [36:38<06:33, 49.22s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [37:37<06:05, 52.22s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [38:35<05:23, 53.96s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [39:22<04:18, 51.69s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [40:14<03:27, 51.81s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [40:51<02:21, 47.27s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [41:49<01:41, 50.69s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [42:46<00:52, 52.50s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [43:44<00:00, 54.13s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [43:44<00:00, 52.49s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 4.0037} | lm_loss 8.1312 | avg. gen lenth: 263.084
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 10:45:29,960] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  2%|█▉                                                                                               | 194/9741 [00:00<00:04, 1930.97it/s]  4%|███▉                                                                                             | 390/9741 [00:00<00:04, 1942.91it/s]  6%|█████▊                                                                                           | 586/9741 [00:00<00:04, 1947.38it/s]  8%|███████▊                                                                                         | 783/9741 [00:00<00:04, 1953.85it/s] 10%|█████████▊                                                                                       | 980/9741 [00:00<00:04, 1959.04it/s] 12%|███████████▌                                                                                    | 1178/9741 [00:00<00:04, 1965.84it/s] 14%|█████████████▌                                                                                  | 1375/9741 [00:00<00:04, 1962.56it/s] 16%|███████████████▍                                                                                | 1572/9741 [00:00<00:04, 1963.33it/s] 18%|█████████████████▍                                                                              | 1769/9741 [00:00<00:04, 1937.20it/s] 20%|███████████████████▎                                                                            | 1963/9741 [00:01<00:04, 1898.95it/s] 22%|█████████████████████▎                                                                          | 2158/9741 [00:01<00:03, 1911.66it/s] 24%|███████████████████████▏                                                                        | 2354/9741 [00:01<00:03, 1923.25it/s] 26%|█████████████████████████▏                                                                      | 2550/9741 [00:01<00:03, 1932.64it/s] 28%|███████████████████████████                                                                     | 2745/9741 [00:01<00:03, 1937.04it/s] 30%|████████████████████████████▉                                                                   | 2941/9741 [00:01<00:03, 1941.82it/s] 32%|██████████████████████████████▉                                                                 | 3137/9741 [00:01<00:03, 1946.66it/s] 34%|████████████████████████████████▊                                                               | 3334/9741 [00:01<00:03, 1951.45it/s] 36%|██████████████████████████████████▊                                                             | 3530/9741 [00:01<00:03, 1950.76it/s] 38%|████████████████████████████████████▋                                                           | 3726/9741 [00:01<00:03, 1946.35it/s] 40%|██████████████████████████████████████▋                                                         | 3922/9741 [00:02<00:02, 1950.13it/s] 42%|████████████████████████████████████████▌                                                       | 4118/9741 [00:02<00:02, 1950.27it/s] 44%|██████████████████████████████████████████▌                                                     | 4314/9741 [00:02<00:02, 1950.28it/s] 46%|████████████████████████████████████████████▍                                                   | 4510/9741 [00:02<00:02, 1951.76it/s] 48%|██████████████████████████████████████████████▌                                                 | 4724/9741 [00:02<00:02, 2006.59it/s] 51%|████████████████████████████████████████████████▌                                               | 4925/9741 [00:02<00:02, 1876.96it/s] 54%|███████████████████████████████████████████████████▍                                            | 5221/9741 [00:02<00:02, 2186.00it/s] 57%|██████████████████████████████████████████████████████▍                                         | 5520/9741 [00:02<00:01, 2418.89it/s] 60%|█████████████████████████████████████████████████████████▍                                      | 5830/9741 [00:02<00:01, 2617.20it/s] 63%|████████████████████████████████████████████████████████████▌                                   | 6140/9741 [00:02<00:01, 2759.45it/s] 66%|███████████████████████████████████████████████████████████████▌                                | 6451/9741 [00:03<00:01, 2861.00it/s] 69%|██████████████████████████████████████████████████████████████████▌                             | 6760/9741 [00:03<00:01, 2925.38it/s] 72%|█████████████████████████████████████████████████████████████████████▌                          | 7062/9741 [00:03<00:00, 2953.33it/s] 76%|████████████████████████████████████████████████████████████████████████▋                       | 7373/9741 [00:03<00:00, 2998.81it/s] 79%|███████████████████████████████████████████████████████████████████████████▋                    | 7674/9741 [00:03<00:00, 2977.65it/s] 82%|██████████████████████████████████████████████████████████████████████████████▋                 | 7987/9741 [00:03<00:00, 3022.05it/s] 85%|█████████████████████████████████████████████████████████████████████████████████▊              | 8301/9741 [00:03<00:00, 3055.02it/s] 88%|████████████████████████████████████████████████████████████████████████████████████▉           | 8613/9741 [00:03<00:00, 3072.20it/s] 92%|███████████████████████████████████████████████████████████████████████████████████████▉        | 8926/9741 [00:03<00:00, 3086.91it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████     | 9239/9741 [00:03<00:00, 3099.55it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████▏ | 9551/9741 [00:04<00:00, 3104.01it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:04<00:00, 2370.28it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.24s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.46s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.43s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.50s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.08s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.12s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.54s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.04s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.17s/it]
[2023-08-18 10:46:26,907] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:15<00:08,  8.35s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:21<00:00,  7.27s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:21<00:00,  7.27s/it]
[2023-08-18 10:46:45,142] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 10:46:45,143] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f61c13b9e80>
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 10:46:45,144] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f61c13b9dc0>
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 10:46:45,145] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 10:46:45,145] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3616511821746826 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s10-rFalse
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.30426454544067383 seconds
Time to load utils op: 0.30423998832702637 seconds
Loading extension module utils...
Time to load utils op: 0.30445075035095215 seconds
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:55<45:20, 55.52s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:51<44:51, 56.08s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:47<43:40, 55.75s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:44<43:15, 56.43s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:42<42:32, 56.73s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [05:38<41:31, 56.63s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [06:34<40:27, 56.46s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [07:30<39:20, 56.20s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [08:18<36:38, 53.63s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [09:14<36:14, 54.36s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [10:11<35:57, 55.33s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [11:08<35:14, 55.65s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [12:04<34:21, 55.72s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [12:59<33:24, 55.68s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [13:54<32:22, 55.51s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [14:51<31:40, 55.88s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [15:46<30:35, 55.63s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [16:42<29:40, 55.65s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [17:39<29:01, 56.17s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [18:36<28:07, 56.26s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [19:32<27:14, 56.35s/it]Evaluating commonsenseqa :  44%|█████████████████████████████████                                          | 22/50 [20:27<26:07, 56.00s/it]Evaluating commonsenseqa :  46%|██████████████████████████████████▌                                        | 23/50 [20:53<21:09, 47.02s/it]Evaluating commonsenseqa :  48%|████████████████████████████████████                                       | 24/50 [21:49<21:33, 49.74s/it]Evaluating commonsenseqa :  50%|█████████████████████████████████████▌                                     | 25/50 [22:23<18:42, 44.89s/it]Evaluating commonsenseqa :  52%|███████████████████████████████████████                                    | 26/50 [23:19<19:17, 48.22s/it]Evaluating commonsenseqa :  54%|████████████████████████████████████████▌                                  | 27/50 [24:17<19:33, 51.03s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████████████                                 | 28/50 [25:13<19:14, 52.49s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████▌                               | 29/50 [25:48<16:34, 47.36s/it]Evaluating commonsenseqa :  60%|█████████████████████████████████████████████                              | 30/50 [26:44<16:37, 49.89s/it]Evaluating commonsenseqa :  62%|██████████████████████████████████████████████▌                            | 31/50 [27:39<16:20, 51.59s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████████                           | 32/50 [28:36<15:56, 53.12s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████▌                         | 33/50 [29:33<15:23, 54.31s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████████                        | 34/50 [30:29<14:36, 54.80s/it]Evaluating commonsenseqa :  70%|████████████████████████████████████████████████████▌                      | 35/50 [31:25<13:49, 55.29s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████████                     | 36/50 [32:21<12:53, 55.26s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████▌                   | 37/50 [33:17<12:01, 55.51s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████████                  | 38/50 [34:13<11:10, 55.84s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████████▌                | 39/50 [34:55<09:28, 51.66s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████████               | 40/50 [35:52<08:53, 53.32s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████▍             | 41/50 [36:44<07:54, 52.72s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████████████████            | 42/50 [37:41<07:12, 54.07s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████████▌          | 43/50 [38:37<06:22, 54.68s/it]Evaluating commonsenseqa :  88%|██████████████████████████████████████████████████████████████████         | 44/50 [39:11<04:50, 48.47s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████▌       | 45/50 [40:06<04:12, 50.52s/it]Evaluating commonsenseqa :  92%|█████████████████████████████████████████████████████████████████████      | 46/50 [41:03<03:29, 52.49s/it]Evaluating commonsenseqa :  94%|██████████████████████████████████████████████████████████████████████▌    | 47/50 [41:59<02:40, 53.41s/it]Evaluating commonsenseqa :  96%|████████████████████████████████████████████████████████████████████████   | 48/50 [42:32<01:34, 47.25s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████▌ | 49/50 [43:29<00:50, 50.13s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [44:10<00:00, 47.56s/it]Evaluating commonsenseqa : 100%|███████████████████████████████████████████████████████████████████████████| 50/50 [44:10<00:00, 53.02s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.7523} | lm_loss 8.1317 | avg. gen lenth: 266.56
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-18 11:31:04,282] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                             | 0/9741 [00:00<?, ?it/s]  1%|█▍                                                                                               | 146/9741 [00:00<00:06, 1450.58it/s]  3%|██▉                                                                                              | 292/9741 [00:00<00:06, 1450.25it/s]  5%|████▎                                                                                            | 439/9741 [00:00<00:06, 1456.24it/s]  6%|█████▊                                                                                           | 587/9741 [00:00<00:06, 1462.44it/s]  8%|███████▎                                                                                         | 734/9741 [00:00<00:06, 1463.96it/s]  9%|████████▊                                                                                        | 882/9741 [00:00<00:06, 1469.08it/s] 11%|██████████▏                                                                                     | 1031/9741 [00:00<00:05, 1472.92it/s] 12%|███████████▌                                                                                    | 1179/9741 [00:00<00:05, 1451.94it/s] 14%|█████████████                                                                                   | 1326/9741 [00:00<00:05, 1456.65it/s] 15%|██████████████▌                                                                                 | 1473/9741 [00:01<00:05, 1458.21it/s] 17%|███████████████▉                                                                                | 1620/9741 [00:01<00:05, 1461.52it/s] 18%|█████████████████▍                                                                              | 1770/9741 [00:01<00:05, 1471.56it/s] 20%|██████████████████▉                                                                             | 1918/9741 [00:01<00:05, 1433.63it/s] 21%|████████████████████▎                                                                           | 2064/9741 [00:01<00:05, 1440.28it/s] 23%|█████████████████████▊                                                                          | 2212/9741 [00:01<00:05, 1449.33it/s] 24%|███████████████████████▎                                                                        | 2360/9741 [00:01<00:05, 1456.39it/s] 26%|████████████████████████▋                                                                       | 2508/9741 [00:01<00:04, 1463.21it/s] 27%|██████████████████████████▏                                                                     | 2655/9741 [00:01<00:04, 1459.95it/s] 29%|███████████████████████████▌                                                                    | 2802/9741 [00:01<00:04, 1454.87it/s] 30%|█████████████████████████████                                                                   | 2949/9741 [00:02<00:04, 1458.39it/s] 32%|██████████████████████████████▌                                                                 | 3096/9741 [00:02<00:04, 1461.81it/s] 33%|███████████████████████████████▉                                                                | 3244/9741 [00:02<00:04, 1464.64it/s] 35%|█████████████████████████████████▍                                                              | 3392/9741 [00:02<00:04, 1466.96it/s] 36%|██████████████████████████████████▉                                                             | 3539/9741 [00:02<00:04, 1464.68it/s] 38%|████████████████████████████████████▌                                                           | 3713/9741 [00:02<00:03, 1546.05it/s] 40%|██████████████████████████████████████▊                                                         | 3940/9741 [00:02<00:03, 1761.32it/s] 43%|█████████████████████████████████████████                                                       | 4166/9741 [00:02<00:02, 1908.55it/s] 45%|███████████████████████████████████████████▎                                                    | 4392/9741 [00:02<00:02, 2011.42it/s] 47%|█████████████████████████████████████████████▎                                                  | 4603/9741 [00:02<00:02, 2040.37it/s] 49%|███████████████████████████████████████████████▍                                                | 4808/9741 [00:03<00:02, 1670.51it/s] 52%|█████████████████████████████████████████████████▋                                              | 5036/9741 [00:03<00:02, 1826.28it/s] 54%|███████████████████████████████████████████████████▉                                            | 5264/9741 [00:03<00:02, 1947.86it/s] 56%|██████████████████████████████████████████████████████▏                                         | 5492/9741 [00:03<00:02, 2038.29it/s] 59%|████████████████████████████████████████████████████████▍                                       | 5729/9741 [00:03<00:01, 2130.59it/s] 61%|██████████████████████████████████████████████████████████▊                                     | 5965/9741 [00:03<00:01, 2196.41it/s] 64%|█████████████████████████████████████████████████████████████                                   | 6202/9741 [00:03<00:01, 2245.04it/s] 66%|███████████████████████████████████████████████████████████████▍                                | 6439/9741 [00:03<00:01, 2281.32it/s] 69%|█████████████████████████████████████████████████████████████████▊                              | 6676/9741 [00:03<00:01, 2306.87it/s] 71%|████████████████████████████████████████████████████████████████████▏                           | 6915/9741 [00:04<00:01, 2330.40it/s] 73%|██████████████████████████████████████████████████████████████████████▍                         | 7153/9741 [00:04<00:01, 2342.84it/s] 76%|████████████████████████████████████████████████████████████████████████▊                       | 7390/9741 [00:04<00:01, 2350.22it/s] 78%|███████████████████████████████████████████████████████████████████████████▏                    | 7626/9741 [00:04<00:00, 2314.57it/s] 81%|█████████████████████████████████████████████████████████████████████████████▍                  | 7858/9741 [00:04<00:00, 2302.40it/s] 83%|███████████████████████████████████████████████████████████████████████████████▊                | 8093/9741 [00:04<00:00, 2315.84it/s] 86%|██████████████████████████████████████████████████████████████████████████████████              | 8329/9741 [00:04<00:00, 2326.96it/s] 88%|████████████████████████████████████████████████████████████████████████████████████▍           | 8565/9741 [00:04<00:00, 2334.90it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████▋         | 8799/9741 [00:04<00:00, 2335.31it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████████       | 9033/9741 [00:04<00:00, 2335.53it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████▎    | 9268/9741 [00:05<00:00, 2339.11it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████████▋  | 9504/9741 [00:05<00:00, 2343.27it/s]100%|███████████████████████████████████████████████████████████████████████████████████████████████▉| 9739/9741 [00:05<00:00, 2327.32it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:05<00:00, 1867.34it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                     | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.11s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.14s/it]Loading checkpoint shards:  33%|█████████████████████████▋                                                   | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:09<00:04,  4.96s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:09<00:04,  4.95s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:10<00:05,  5.19s/it]Loading checkpoint shards:  67%|███████████████████████████████████████████████████▎                         | 2/3 [00:11<00:05,  5.57s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.33s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.52s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.33s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.51s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.63s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.88s/it]Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.05s/it]
[2023-08-18 11:32:02,095] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-18 11:32:09,081] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-18 11:32:09,082] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-18 11:32:09,083] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-18 11:32:09,083] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-18 11:32:09,083] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-18 11:32:09,083] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fdf7cdc3e80>
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-18 11:32:09,084] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fdf7cdc3dc0>
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-18 11:32:09,085] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-18 11:32:09,086] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-18 11:32:09,086] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.36560750007629395 seconds
Loading extension module utils...
Time to load utils op: 0.30417633056640625 seconds
Loading extension module utils...
Time to load utils op: 0.3042750358581543 seconds
Loading extension module utils...
Time to load utils op: 0.3043520450592041 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                    | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s10-rFalse
Evaluating commonsenseqa :   2%|█▌                                                                          | 1/50 [00:55<45:39, 55.90s/it]Evaluating commonsenseqa :   4%|███                                                                         | 2/50 [01:51<44:21, 55.44s/it]Evaluating commonsenseqa :   6%|████▌                                                                       | 3/50 [02:46<43:26, 55.46s/it]Evaluating commonsenseqa :   8%|██████                                                                      | 4/50 [03:41<42:30, 55.44s/it]Evaluating commonsenseqa :  10%|███████▌                                                                    | 5/50 [04:37<41:38, 55.53s/it]Evaluating commonsenseqa :  12%|█████████                                                                   | 6/50 [05:10<34:58, 47.68s/it]Evaluating commonsenseqa :  14%|██████████▋                                                                 | 7/50 [06:00<34:45, 48.50s/it]Evaluating commonsenseqa :  16%|████████████▏                                                               | 8/50 [06:54<35:15, 50.36s/it]Evaluating commonsenseqa :  18%|█████████████▋                                                              | 9/50 [07:22<29:36, 43.33s/it]Evaluating commonsenseqa :  20%|███████████████                                                            | 10/50 [07:58<27:22, 41.06s/it]Evaluating commonsenseqa :  22%|████████████████▌                                                          | 11/50 [08:53<29:31, 45.41s/it]Evaluating commonsenseqa :  24%|██████████████████                                                         | 12/50 [09:48<30:38, 48.38s/it]Evaluating commonsenseqa :  26%|███████████████████▌                                                       | 13/50 [10:43<31:02, 50.34s/it]Evaluating commonsenseqa :  28%|█████████████████████                                                      | 14/50 [11:38<31:00, 51.68s/it]Evaluating commonsenseqa :  30%|██████████████████████▌                                                    | 15/50 [12:34<30:50, 52.88s/it]Evaluating commonsenseqa :  32%|████████████████████████                                                   | 16/50 [13:18<28:31, 50.35s/it]Evaluating commonsenseqa :  34%|█████████████████████████▌                                                 | 17/50 [13:43<23:26, 42.62s/it]Evaluating commonsenseqa :  36%|███████████████████████████                                                | 18/50 [14:08<19:56, 37.39s/it]Evaluating commonsenseqa :  38%|████████████████████████████▌                                              | 19/50 [15:02<21:57, 42.50s/it]Evaluating commonsenseqa :  40%|██████████████████████████████                                             | 20/50 [15:58<23:12, 46.43s/it]Evaluating commonsenseqa :  42%|███████████████████████████████▌                                           | 21/50 [16:53<23:38, 48.92s/it]