PYTHONPATH=/home/ylu130/workspace/in-context-generalization
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i0-s1-rTrue --seed 1 --rationales --num-in-domain 0
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 18:32:39,128] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i0-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i0-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  3%|████▊                                                                                                                                             | 323/9741 [00:00<00:02, 3229.76it/s]  7%|█████████▋                                                                                                                                        | 647/9741 [00:00<00:02, 3235.27it/s] 10%|██████████████▌                                                                                                                                   | 975/9741 [00:00<00:02, 3255.64it/s] 13%|███████████████████▍                                                                                                                             | 1302/9741 [00:00<00:02, 3260.90it/s] 17%|████████████████████████▏                                                                                                                        | 1629/9741 [00:00<00:02, 3257.21it/s] 20%|█████████████████████████████                                                                                                                    | 1955/9741 [00:00<00:02, 3239.65it/s] 23%|█████████████████████████████████▉                                                                                                               | 2279/9741 [00:00<00:02, 3235.14it/s] 27%|██████████████████████████████████████▊                                                                                                          | 2607/9741 [00:00<00:02, 3247.02it/s] 30%|███████████████████████████████████████████▋                                                                                                     | 2932/9741 [00:00<00:02, 3182.42it/s] 33%|████████████████████████████████████████████████▍                                                                                                | 3253/9741 [00:01<00:02, 3188.27it/s] 37%|█████████████████████████████████████████████████████▏                                                                                           | 3575/9741 [00:01<00:01, 3197.51it/s] 40%|██████████████████████████████████████████████████████████                                                                                       | 3901/9741 [00:01<00:01, 3215.54it/s] 43%|██████████████████████████████████████████████████████████████▉                                                                                  | 4225/9741 [00:01<00:01, 3221.43it/s] 47%|███████████████████████████████████████████████████████████████████▋                                                                             | 4548/9741 [00:01<00:01, 3184.22it/s] 50%|████████████████████████████████████████████████████████████████████████▍                                                                        | 4867/9741 [00:01<00:02, 2369.39it/s] 53%|█████████████████████████████████████████████████████████████████████████████▎                                                                   | 5191/9741 [00:01<00:01, 2578.16it/s] 57%|██████████████████████████████████████████████████████████████████████████████████                                                               | 5515/9741 [00:01<00:01, 2746.78it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████                                                          | 5849/9741 [00:01<00:01, 2905.17it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████                                                     | 6186/9741 [00:02<00:01, 3033.57it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████                                                | 6522/9741 [00:02<00:01, 3124.96it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▏                                          | 6862/9741 [00:02<00:00, 3202.07it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                     | 7204/9741 [00:02<00:00, 3265.23it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                | 7536/9741 [00:02<00:00, 3274.00it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                         | 8015/9741 [00:02<00:00, 3720.53it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                  | 8538/9741 [00:02<00:00, 4167.38it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊          | 9056/9741 [00:02<00:00, 4468.15it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 9578/9741 [00:02<00:00, 4690.65it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:02<00:00, 3401.69it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.19s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.12s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.50s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.05s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.10s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.31s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.11s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.46s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.63s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.64s/it]
[2023-08-10 18:33:33,152] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.86s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.49s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
[2023-08-10 18:33:43,446] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 18:33:43,447] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 18:33:43,447] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 18:33:43,447] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 18:33:43,447] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 18:33:43,447] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 18:33:43,447] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fae4307fe80>
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fae43fff910>
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 18:33:43,448] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 18:33:43,449] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 18:33:43,449] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 18:33:43,449] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 18:33:43,449] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 18:33:43,449] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 18:33:43,449] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 18:33:43,449] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 18:33:43,449] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 18:33:43,449] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.33704042434692383 seconds
Loading extension module utils...
Time to load utils op: 0.40442872047424316 seconds
Loading extension module utils...
Time to load utils op: 0.304257869720459 seconds
Loading extension module utils...
Time to load utils op: 0.4045538902282715 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:


### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i0-s1-rTrue
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:59<48:16, 59.12s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:59<47:54, 59.88s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:26<35:12, 44.96s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:59<30:50, 40.23s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:59<35:25, 47.23s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:36<32:03, 43.71s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:20<31:23, 43.80s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:51<27:57, 39.95s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:08<22:15, 32.57s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [06:25<18:34, 27.85s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:24<24:12, 37.25s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:11<25:28, 40.22s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [08:31<21:02, 34.13s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:31<25:10, 41.96s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:05<23:04, 39.55s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [10:57<24:31, 43.27s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:20<20:27, 37.18s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [11:49<18:37, 34.93s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [12:19<17:09, 33.22s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [12:42<15:04, 30.14s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [13:29<17:00, 35.19s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [14:12<17:32, 37.60s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [14:40<15:41, 34.88s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [15:40<18:22, 42.39s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [16:39<19:39, 47.17s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [17:39<20:26, 51.11s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:26<19:06, 49.86s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [18:53<15:46, 43.01s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [19:04<11:45, 33.59s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [20:04<13:47, 41.38s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [21:04<14:49, 46.83s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:02<15:06, 50.35s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [22:53<14:21, 50.66s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [23:22<11:42, 43.93s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [23:58<10:24, 41.61s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [24:50<10:27, 44.79s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [25:05<07:46, 35.87s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [25:23<06:05, 30.47s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [26:10<06:31, 35.55s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [26:23<04:47, 28.72s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [26:49<04:11, 27.93s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [27:49<04:59, 37.43s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [27:57<03:20, 28.70s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [28:13<02:29, 24.90s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [29:13<02:56, 35.22s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [30:02<02:38, 39.57s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [30:21<01:39, 33.24s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [30:42<00:59, 29.62s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [31:07<00:28, 28.11s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [31:59<00:00, 35.27s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [31:59<00:00, 38.38s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 5.3955} | lm_loss 7.4626 | avg. gen lenth: 133.256
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s1-rTrue --seed 1 --rationales --num-in-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 19:07:37,636] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 1
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9740 [00:00<?, ?it/s]  1%|█▍                                                                                                                                                  | 95/9740 [00:00<00:10, 948.24it/s]  2%|██▉                                                                                                                                                | 191/9740 [00:00<00:10, 953.78it/s]  3%|████▎                                                                                                                                              | 287/9740 [00:00<00:09, 955.55it/s]  4%|█████▊                                                                                                                                             | 384/9740 [00:00<00:09, 957.61it/s]  5%|███████▏                                                                                                                                           | 480/9740 [00:00<00:09, 955.93it/s]  6%|████████▋                                                                                                                                          | 576/9740 [00:00<00:09, 954.65it/s]  7%|██████████▏                                                                                                                                        | 672/9740 [00:00<00:09, 954.38it/s]  8%|███████████▌                                                                                                                                       | 768/9740 [00:00<00:09, 940.57it/s]  9%|█████████████                                                                                                                                      | 863/9740 [00:00<00:09, 943.24it/s] 10%|██████████████▍                                                                                                                                    | 958/9740 [00:01<00:09, 944.34it/s] 11%|███████████████▊                                                                                                                                  | 1055/9740 [00:01<00:09, 949.85it/s] 12%|█████████████████▎                                                                                                                                | 1151/9740 [00:01<00:09, 951.90it/s] 13%|██████████████████▋                                                                                                                               | 1247/9740 [00:01<00:08, 953.31it/s] 14%|████████████████████▏                                                                                                                             | 1343/9740 [00:01<00:08, 952.72it/s] 15%|█████████████████████▌                                                                                                                            | 1439/9740 [00:01<00:08, 951.57it/s] 16%|███████████████████████                                                                                                                           | 1535/9740 [00:01<00:08, 952.34it/s] 17%|████████████████████████▌                                                                                                                        | 1651/9740 [00:01<00:07, 1012.93it/s] 18%|██████████████████████████▋                                                                                                                      | 1789/9740 [00:01<00:07, 1113.17it/s] 20%|████████████████████████████▊                                                                                                                    | 1934/9740 [00:01<00:06, 1212.75it/s] 21%|██████████████████████████████▉                                                                                                                  | 2079/9740 [00:02<00:05, 1281.31it/s] 23%|█████████████████████████████████▏                                                                                                               | 2226/9740 [00:02<00:05, 1335.30it/s] 24%|███████████████████████████████████▎                                                                                                             | 2372/9740 [00:02<00:05, 1371.79it/s] 26%|█████████████████████████████████████▍                                                                                                           | 2518/9740 [00:02<00:05, 1396.80it/s] 27%|███████████████████████████████████████▋                                                                                                         | 2665/9740 [00:02<00:04, 1416.87it/s] 29%|█████████████████████████████████████████▊                                                                                                       | 2810/9740 [00:02<00:04, 1425.33it/s] 30%|███████████████████████████████████████████▉                                                                                                     | 2955/9740 [00:02<00:04, 1431.37it/s] 32%|██████████████████████████████████████████████▏                                                                                                  | 3101/9740 [00:02<00:04, 1438.09it/s] 33%|████████████████████████████████████████████████▎                                                                                                | 3246/9740 [00:02<00:04, 1440.87it/s] 35%|██████████████████████████████████████████████████▍                                                                                              | 3391/9740 [00:02<00:04, 1442.41it/s] 36%|████████████████████████████████████████████████████▋                                                                                            | 3536/9740 [00:03<00:04, 1443.66it/s] 38%|██████████████████████████████████████████████████████▊                                                                                          | 3681/9740 [00:03<00:04, 1444.16it/s] 39%|████████████████████████████████████████████████████████▉                                                                                        | 3828/9740 [00:03<00:04, 1449.67it/s] 41%|███████████████████████████████████████████████████████████▏                                                                                     | 3974/9740 [00:03<00:03, 1451.50it/s] 42%|█████████████████████████████████████████████████████████████▎                                                                                   | 4120/9740 [00:03<00:03, 1450.97it/s] 44%|███████████████████████████████████████████████████████████████▌                                                                                 | 4266/9740 [00:03<00:03, 1453.31it/s] 45%|█████████████████████████████████████████████████████████████████▋                                                                               | 4412/9740 [00:03<00:03, 1450.77it/s] 47%|███████████████████████████████████████████████████████████████████▊                                                                             | 4558/9740 [00:03<00:03, 1419.15it/s] 48%|██████████████████████████████████████████████████████████████████████                                                                           | 4704/9740 [00:03<00:03, 1429.59it/s] 50%|████████████████████████████████████████████████████████████████████████▏                                                                        | 4848/9740 [00:04<00:04, 1117.30it/s] 51%|██████████████████████████████████████████████████████████████████████████▎                                                                      | 4993/9740 [00:04<00:03, 1197.91it/s] 53%|████████████████████████████████████████████████████████████████████████████▌                                                                    | 5139/9740 [00:04<00:03, 1264.31it/s] 54%|██████████████████████████████████████████████████████████████████████████████▋                                                                  | 5285/9740 [00:04<00:03, 1315.40it/s] 56%|████████████████████████████████████████████████████████████████████████████████▊                                                                | 5427/9740 [00:04<00:03, 1343.52it/s] 57%|███████████████████████████████████████████████████████████████████████████████████                                                              | 5578/9740 [00:04<00:02, 1388.73it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▎                                                           | 5729/9740 [00:04<00:02, 1423.32it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▌                                                         | 5881/9740 [00:04<00:02, 1448.91it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▊                                                       | 6034/9740 [00:04<00:02, 1470.57it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████                                                     | 6183/9740 [00:04<00:02, 1475.22it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▎                                                  | 6334/9740 [00:05<00:02, 1485.42it/s] 67%|████████████████████████████████████████████████████████████████████████████████████████████████▌                                                | 6486/9740 [00:05<00:02, 1494.69it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▊                                              | 6636/9740 [00:05<00:02, 1496.21it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████                                            | 6788/9740 [00:05<00:01, 1502.44it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▎                                         | 6941/9740 [00:05<00:01, 1508.49it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                       | 7093/9740 [00:05<00:01, 1511.30it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                     | 7245/9740 [00:05<00:01, 1512.80it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████                                   | 7397/9740 [00:05<00:01, 1500.91it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                | 7548/9740 [00:05<00:01, 1444.20it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                              | 7700/9740 [00:05<00:01, 1464.40it/s] 81%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                            | 7852/9740 [00:06<00:01, 1480.46it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                         | 8003/9740 [00:06<00:01, 1488.97it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                       | 8155/9740 [00:06<00:01, 1497.22it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                     | 8307/9740 [00:06<00:00, 1503.66it/s] 87%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                   | 8459/9740 [00:06<00:00, 1507.20it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                | 8610/9740 [00:06<00:00, 1507.81it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍              | 8762/9740 [00:06<00:00, 1510.95it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋            | 8914/9740 [00:06<00:00, 1512.20it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉          | 9066/9740 [00:06<00:00, 1512.39it/s] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏       | 9218/9740 [00:06<00:00, 1514.55it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍     | 9370/9740 [00:07<00:00, 1503.77it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋   | 9521/9740 [00:07<00:00, 1502.56it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████ | 9674/9740 [00:07<00:00, 1507.76it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9740/9740 [00:07<00:00, 1334.08it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.03s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.15s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.29s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.91s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:04,  4.99s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.42s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.42s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.40s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.55s/it]
[2023-08-10 19:08:35,885] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.38s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.56s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.94s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.97s/it]
[2023-08-10 19:08:45,547] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 19:08:45,549] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 19:08:45,550] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 19:08:45,550] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 19:08:45,550] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 19:08:45,550] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7ff5ba846e80>
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 19:08:45,551] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7ff5beb7b910>
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 19:08:45,552] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 19:08:45,552] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3808588981628418 seconds
Loading extension module utils...
Time to load utils op: 0.30417895317077637 seconds
Loading extension module utils...
Time to load utils op: 0.40486645698547363 seconds
Loading extension module utils...
Time to load utils op: 0.4043238162994385 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Where could you find some plumbing that would not be of use to you if you are thirsty? Choices:  A: oil refineries B: wall C: show D: own home E: water fountain
Rationales: 1. The question asks where you would find some plumbing that would not be useful in relieving your thirst.
2. This means we're looking for a place where plumbing exists, but it doesn't carry potable water.
3. Analyzing the options:
   - Oil refineries (Option A) use extensive plumbing, but it's for transporting oil, not water.
   - The Wall (Option B) might have plumbing inside it for water transportation, which you could possibly use if you were thirsty.
   - The Show (Option C) could refer to a variety of things, including shows with plumbing displays. But these would probably have potable water.
   - Own home (Option D) would assuredly have useful plumbing for drinking water.
   - Water fountain (Option E) definitely would have plumbing carrying potable water.
4. Hence, the answer is the oil refineries (Option A) as there wouldn't be drinkable water there.
Answer: A: oil refineries

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s1-rTrue
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:54<44:14, 54.17s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:37<38:12, 47.76s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:30<39:17, 50.16s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:22<38:54, 50.76s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:14<38:29, 51.31s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [05:06<37:44, 51.47s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [06:00<37:26, 52.25s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:53<36:45, 52.52s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:45<35:53, 52.52s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:30<33:26, 50.15s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [09:23<33:12, 51.08s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [10:16<32:38, 51.53s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [11:08<31:57, 51.83s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [11:51<29:28, 49.13s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [12:44<29:18, 50.23s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [13:36<28:44, 50.73s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [14:28<28:10, 51.24s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [15:21<27:30, 51.57s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [16:04<25:17, 48.96s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [16:34<21:40, 43.35s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [17:26<22:15, 46.05s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [18:19<22:25, 48.05s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [19:13<22:22, 49.73s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [20:05<21:55, 50.58s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [20:58<21:21, 51.24s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [21:50<20:39, 51.64s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [22:42<19:47, 51.62s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [23:35<19:06, 52.13s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [24:28<18:18, 52.29s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [25:21<17:30, 52.53s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [26:13<16:36, 52.42s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [27:07<15:48, 52.69s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [27:56<14:38, 51.67s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [28:49<13:51, 51.99s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [29:43<13:09, 52.63s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [30:34<12:12, 52.35s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [31:28<11:27, 52.86s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [32:23<10:40, 53.35s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [33:17<09:47, 53.43s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [34:09<08:50, 53.07s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [34:38<06:52, 45.89s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [35:31<06:24, 48.12s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [36:24<05:46, 49.54s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [37:09<04:48, 48.10s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [38:02<04:08, 49.66s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [38:28<02:50, 42.53s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [39:22<02:18, 46.01s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [40:15<01:35, 47.98s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [41:08<00:49, 49.61s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [42:01<00:00, 50.70s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [42:01<00:00, 50.44s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.6651} | lm_loss 7.4921 | avg. gen lenth: 269.42
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s1-rTrue --seed 1 --rationales --num-in-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 19:51:21,790] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 2
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9739 [00:00<?, ?it/s]  1%|▊                                                                                                                                                   | 55/9739 [00:00<00:17, 545.60it/s]  1%|█▋                                                                                                                                                 | 111/9739 [00:00<00:17, 549.27it/s]  2%|██▌                                                                                                                                                | 167/9739 [00:00<00:17, 551.09it/s]  2%|███▎                                                                                                                                               | 223/9739 [00:00<00:17, 548.29it/s]  3%|████▏                                                                                                                                              | 279/9739 [00:00<00:17, 549.44it/s]  3%|█████                                                                                                                                              | 335/9739 [00:00<00:17, 549.53it/s]  4%|█████▉                                                                                                                                             | 390/9739 [00:00<00:17, 549.39it/s]  5%|██████▋                                                                                                                                            | 445/9739 [00:00<00:17, 535.01it/s]  5%|███████▌                                                                                                                                           | 500/9739 [00:00<00:17, 538.17it/s]  6%|████████▍                                                                                                                                          | 555/9739 [00:01<00:16, 541.38it/s]  6%|█████████▏                                                                                                                                         | 610/9739 [00:01<00:16, 543.45it/s]  7%|██████████                                                                                                                                         | 665/9739 [00:01<00:16, 543.45it/s]  7%|██████████▊                                                                                                                                        | 720/9739 [00:01<00:16, 544.72it/s]  8%|███████████▋                                                                                                                                       | 775/9739 [00:01<00:16, 545.96it/s]  9%|████████████▌                                                                                                                                      | 830/9739 [00:01<00:16, 546.40it/s]  9%|█████████████▎                                                                                                                                     | 885/9739 [00:01<00:16, 545.55it/s] 10%|██████████████▏                                                                                                                                    | 940/9739 [00:01<00:16, 546.86it/s] 10%|███████████████                                                                                                                                    | 995/9739 [00:01<00:16, 544.25it/s] 11%|███████████████▋                                                                                                                                  | 1050/9739 [00:01<00:15, 545.11it/s] 11%|████████████████▌                                                                                                                                 | 1106/9739 [00:02<00:15, 547.21it/s] 12%|█████████████████▍                                                                                                                                | 1161/9739 [00:02<00:15, 545.66it/s] 12%|██████████████████▏                                                                                                                               | 1216/9739 [00:02<00:15, 546.26it/s] 13%|███████████████████                                                                                                                               | 1271/9739 [00:02<00:15, 546.68it/s] 14%|████████████████████                                                                                                                              | 1339/9739 [00:02<00:14, 586.42it/s] 15%|█████████████████████▎                                                                                                                            | 1423/9739 [00:02<00:12, 661.69it/s] 15%|██████████████████████▌                                                                                                                           | 1507/9739 [00:02<00:11, 714.00it/s] 16%|███████████████████████▊                                                                                                                          | 1590/9739 [00:02<00:10, 747.91it/s] 17%|█████████████████████████                                                                                                                         | 1674/9739 [00:02<00:10, 774.58it/s] 18%|██████████████████████████▎                                                                                                                       | 1758/9739 [00:02<00:10, 793.72it/s] 19%|███████████████████████████▌                                                                                                                      | 1838/9739 [00:03<00:10, 782.08it/s] 20%|████████████████████████████▊                                                                                                                     | 1922/9739 [00:03<00:09, 796.58it/s] 21%|██████████████████████████████                                                                                                                    | 2006/9739 [00:03<00:09, 807.29it/s] 21%|███████████████████████████████▎                                                                                                                  | 2089/9739 [00:03<00:09, 811.62it/s] 22%|████████████████████████████████▌                                                                                                                 | 2173/9739 [00:03<00:09, 819.25it/s] 23%|█████████████████████████████████▊                                                                                                                | 2256/9739 [00:03<00:09, 821.37it/s] 24%|███████████████████████████████████                                                                                                               | 2340/9739 [00:03<00:08, 825.14it/s] 25%|████████████████████████████████████▎                                                                                                             | 2424/9739 [00:03<00:08, 828.76it/s] 26%|█████████████████████████████████████▌                                                                                                            | 2507/9739 [00:03<00:08, 827.88it/s] 27%|██████████████████████████████████████▊                                                                                                           | 2591/9739 [00:03<00:08, 830.40it/s] 27%|████████████████████████████████████████                                                                                                          | 2675/9739 [00:04<00:08, 831.92it/s] 28%|█████████████████████████████████████████▎                                                                                                        | 2759/9739 [00:04<00:08, 829.94it/s] 29%|██████████████████████████████████████████▌                                                                                                       | 2843/9739 [00:04<00:08, 831.21it/s] 30%|███████████████████████████████████████████▉                                                                                                      | 2927/9739 [00:04<00:08, 830.48it/s] 31%|█████████████████████████████████████████████▏                                                                                                    | 3011/9739 [00:04<00:08, 826.70it/s] 32%|██████████████████████████████████████████████▍                                                                                                   | 3095/9739 [00:04<00:08, 828.34it/s] 33%|███████████████████████████████████████████████▋                                                                                                  | 3178/9739 [00:04<00:07, 828.49it/s] 33%|████████████████████████████████████████████████▉                                                                                                 | 3262/9739 [00:04<00:07, 829.64it/s] 34%|██████████████████████████████████████████████████▏                                                                                               | 3346/9739 [00:04<00:07, 831.05it/s] 35%|███████████████████████████████████████████████████▍                                                                                              | 3430/9739 [00:04<00:07, 829.00it/s] 36%|████████████████████████████████████████████████████▋                                                                                             | 3514/9739 [00:05<00:07, 830.66it/s] 37%|█████████████████████████████████████████████████████▉                                                                                            | 3598/9739 [00:05<00:07, 831.65it/s] 38%|███████████████████████████████████████████████████████▏                                                                                          | 3682/9739 [00:05<00:07, 830.40it/s] 39%|████████████████████████████████████████████████████████▍                                                                                         | 3766/9739 [00:05<00:07, 832.52it/s] 40%|█████████████████████████████████████████████████████████▋                                                                                        | 3850/9739 [00:05<00:07, 831.59it/s] 40%|██████████████████████████████████████████████████████████▉                                                                                       | 3934/9739 [00:05<00:06, 833.47it/s] 41%|████████████████████████████████████████████████████████████▏                                                                                     | 4018/9739 [00:05<00:06, 833.48it/s] 42%|█████████████████████████████████████████████████████████████▍                                                                                    | 4102/9739 [00:05<00:06, 822.04it/s] 43%|██████████████████████████████████████████████████████████████▊                                                                                   | 4186/9739 [00:05<00:06, 825.13it/s] 44%|████████████████████████████████████████████████████████████████                                                                                  | 4270/9739 [00:05<00:06, 827.88it/s] 45%|█████████████████████████████████████████████████████████████████▎                                                                                | 4353/9739 [00:06<00:06, 827.77it/s] 46%|██████████████████████████████████████████████████████████████████▌                                                                               | 4437/9739 [00:06<00:06, 829.78it/s] 46%|███████████████████████████████████████████████████████████████████▊                                                                              | 4520/9739 [00:06<00:06, 796.23it/s] 47%|█████████████████████████████████████████████████████████████████████                                                                             | 4604/9739 [00:06<00:06, 806.94it/s] 48%|██████████████████████████████████████████████████████████████████████▎                                                                           | 4688/9739 [00:06<00:06, 815.71it/s] 49%|███████████████████████████████████████████████████████████████████████▌                                                                          | 4770/9739 [00:06<00:08, 617.09it/s] 50%|████████████████████████████████████████████████████████████████████████▊                                                                         | 4854/9739 [00:06<00:07, 669.20it/s] 51%|██████████████████████████████████████████████████████████████████████████                                                                        | 4938/9739 [00:06<00:06, 711.68it/s] 52%|███████████████████████████████████████████████████████████████████████████▏                                                                      | 5019/9739 [00:06<00:06, 737.08it/s] 52%|████████████████████████████████████████████████████████████████████████████▌                                                                     | 5103/9739 [00:07<00:06, 763.70it/s] 53%|█████████████████████████████████████████████████████████████████████████████▋                                                                    | 5186/9739 [00:07<00:05, 780.92it/s] 54%|███████████████████████████████████████████████████████████████████████████████                                                                   | 5270/9739 [00:07<00:05, 795.95it/s] 55%|████████████████████████████████████████████████████████████████████████████████▎                                                                 | 5354/9739 [00:07<00:05, 806.69it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▌                                                                | 5437/9739 [00:07<00:05, 810.90it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▊                                                               | 5523/9739 [00:07<00:05, 822.86it/s] 58%|████████████████████████████████████████████████████████████████████████████████████                                                              | 5610/9739 [00:07<00:04, 836.63it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▍                                                            | 5697/9739 [00:07<00:04, 844.62it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▋                                                           | 5785/9739 [00:07<00:04, 852.55it/s] 60%|████████████████████████████████████████████████████████████████████████████████████████                                                          | 5872/9739 [00:08<00:04, 854.92it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▎                                                        | 5960/9739 [00:08<00:04, 859.71it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▋                                                       | 6047/9739 [00:08<00:04, 862.74it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▉                                                      | 6134/9739 [00:08<00:04, 857.04it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▎                                                    | 6221/9739 [00:08<00:04, 859.78it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▌                                                   | 6308/9739 [00:08<00:03, 857.87it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▊                                                  | 6395/9739 [00:08<00:03, 861.36it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▏                                                | 6482/9739 [00:08<00:03, 862.65it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▍                                               | 6569/9739 [00:08<00:03, 861.18it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▊                                              | 6656/9739 [00:08<00:03, 862.04it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████                                             | 6743/9739 [00:09<00:03, 863.90it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▍                                           | 6830/9739 [00:09<00:03, 862.66it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▋                                          | 6917/9739 [00:09<00:03, 863.25it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                         | 7004/9739 [00:09<00:03, 861.39it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                       | 7091/9739 [00:09<00:03, 862.87it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                      | 7178/9739 [00:09<00:02, 863.95it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                     | 7265/9739 [00:09<00:02, 861.94it/s] 75%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                   | 7352/9739 [00:09<00:02, 863.33it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                  | 7439/9739 [00:09<00:02, 863.70it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                 | 7526/9739 [00:09<00:02, 831.16it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                               | 7613/9739 [00:10<00:02, 841.20it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                              | 7699/9739 [00:10<00:02, 845.98it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                             | 7786/9739 [00:10<00:02, 852.84it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                            | 7873/9739 [00:10<00:02, 856.47it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                          | 7960/9739 [00:10<00:02, 858.70it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                         | 8047/9739 [00:10<00:01, 859.65it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                        | 8134/9739 [00:10<00:01, 860.01it/s] 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                      | 8221/9739 [00:10<00:01, 862.36it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                     | 8308/9739 [00:10<00:01, 863.32it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                    | 8395/9739 [00:10<00:01, 861.76it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                  | 8482/9739 [00:11<00:01, 863.69it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                 | 8569/9739 [00:11<00:01, 863.90it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 8656/9739 [00:11<00:01, 862.23it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 8743/9739 [00:11<00:01, 864.17it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎             | 8830/9739 [00:11<00:01, 861.62it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋            | 8917/9739 [00:11<00:00, 863.07it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉           | 9004/9739 [00:11<00:00, 861.94it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎         | 9091/9739 [00:11<00:00, 859.30it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌        | 9178/9739 [00:11<00:00, 860.27it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉       | 9265/9739 [00:11<00:00, 858.82it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏     | 9352/9739 [00:12<00:00, 860.17it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌    | 9439/9739 [00:12<00:00, 860.75it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊   | 9526/9739 [00:12<00:00, 859.07it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████  | 9613/9739 [00:12<00:00, 860.05it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍| 9700/9739 [00:12<00:00, 859.22it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9739/9739 [00:12<00:00, 778.93it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.20s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.38s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.19s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.09s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.10s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.55s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.58s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.64s/it]
[2023-08-10 19:52:25,473] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.22s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.29s/it]
[2023-08-10 19:52:39,193] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 19:52:39,194] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 19:52:39,194] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 19:52:39,194] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 19:52:39,195] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 19:52:39,195] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 19:52:39,195] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 19:52:39,195] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 19:52:39,195] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 19:52:39,195] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 19:52:39,195] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 19:52:39,195] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fcd97b0fe80>
[2023-08-10 19:52:39,195] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 19:52:39,195] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 19:52:39,196] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fcd97a25910>
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 19:52:39,197] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 19:52:39,198] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 19:52:39,198] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.448077917098999 seconds
Loading extension module utils...
Time to load utils op: 0.40468382835388184 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Where could you find some plumbing that would not be of use to you if you are thirsty? Choices:  A: oil refineries B: wall C: show D: own home E: water fountain
Rationales: 1. The question is asking for a type of plumbing that would not help quench thirst. 
2. This means we are looking for a source of plumbing that does not provide drinkable water. 
3. We know that plumbing in our own home (D) and water fountains (E) both usually provide drinkable water. 
4. A wall (B) could have plumbing inside it for water flow, but again this water would typically be drinkable. 
5. A show (C) is vague, but if it's referring to a place like a concert or theater, they typically have drinkable water available.
6. An oil refinery (A), however, has plumbing which is used for the processing and refining of oil, not water. 
7. Therefore, the type of plumbing in an oil refinery would not be of use to you if you are thirsty. So, the answer is A: oil refineries.
Answer: A: oil refineries

Input: When a person is beginning work, what aren't they doing yet? Choices:  A: working B: resting C: tiredness D: accomplishing E: momentum
Rationales: 1. The question asked what a person isn't doing yet when they are beginning work. This involves identifying activities that are not immediate consequences of beginning work.
2. It is difficult to make assumptions about a person's physical state, so options B: resting and C: tiredness aren't appropriate because they don't necessarily correlate with starting work. 
3. "Working" is not the correct answer, because if a person is beginning work, they are technically already in the process of working.
4. Option E: momentum is not applicable as it's not a verb or something you could do as per the theme of the question. 
5. Therefore, option D: accomplishing is the most logical answer. This is because accomplishing suggests the person has already reached some level of success or completion in their work, which would not be possible if they are only just beginning. So, when a person is beginning work, they can't be accomplishing yet.
Answer: D: accomplishing

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.40432238578796387 seconds
Loading extension module utils...
Time to load utils op: 0.404674768447876 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:49<40:14, 49.28s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:38<39:15, 49.08s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:27<38:23, 49.01s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:50<29:55, 39.02s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:38<31:39, 42.21s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:22<31:15, 42.63s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:59<29:23, 41.00s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:48<30:26, 43.49s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:38<31:03, 45.46s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:27<31:03, 46.58s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:15<30:32, 46.99s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:03<30:02, 47.43s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:52<29:32, 47.91s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:42<29:03, 48.42s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:31<28:24, 48.71s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [12:20<27:39, 48.80s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [13:08<26:37, 48.40s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:57<25:54, 48.58s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:45<25:01, 48.45s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:33<24:06, 48.22s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:22<23:27, 48.52s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [17:11<22:41, 48.62s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:58<21:38, 48.08s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:46<20:51, 48.13s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [19:35<20:11, 48.44s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [20:20<18:58, 47.42s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [21:08<18:17, 47.70s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:57<17:33, 47.90s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [22:45<16:50, 48.13s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [23:35<16:08, 48.43s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [24:24<15:28, 48.87s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [24:50<12:35, 42.00s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [25:39<12:29, 44.08s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [26:28<12:06, 45.42s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [27:12<11:14, 44.99s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [28:01<10:45, 46.13s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [28:49<10:09, 46.88s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [29:39<09:33, 47.81s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [30:29<08:51, 48.32s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [31:17<08:03, 48.36s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [32:05<07:14, 48.24s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [32:54<06:28, 48.53s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [33:43<05:39, 48.52s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [34:32<04:52, 48.73s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [35:20<04:02, 48.59s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [36:10<03:15, 48.85s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [36:58<02:26, 48.74s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [37:48<01:37, 48.96s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [38:36<00:48, 48.78s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:25<00:00, 48.68s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:25<00:00, 47.30s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.25} | lm_loss 7.4211 | avg. gen lenth: 291.716
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i3-s1-rTrue --seed 1 --rationales --num-in-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 20:32:10,724] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i3-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 3
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i3-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9738 [00:00<?, ?it/s]  0%|▌                                                                                                                                                   | 34/9738 [00:00<00:28, 338.14it/s]  1%|█                                                                                                                                                   | 69/9738 [00:00<00:28, 339.38it/s]  1%|█▌                                                                                                                                                 | 104/9738 [00:00<00:28, 340.37it/s]  1%|██                                                                                                                                                 | 139/9738 [00:00<00:28, 340.50it/s]  2%|██▋                                                                                                                                                | 174/9738 [00:00<00:28, 340.77it/s]  2%|███▏                                                                                                                                               | 209/9738 [00:00<00:28, 339.02it/s]  3%|███▋                                                                                                                                               | 244/9738 [00:00<00:27, 339.88it/s]  3%|████▏                                                                                                                                              | 278/9738 [00:00<00:28, 334.62it/s]  3%|████▋                                                                                                                                              | 312/9738 [00:00<00:28, 335.95it/s]  4%|█████▏                                                                                                                                             | 347/9738 [00:01<00:27, 337.38it/s]  4%|█████▊                                                                                                                                             | 382/9738 [00:01<00:27, 338.21it/s]  4%|██████▎                                                                                                                                            | 416/9738 [00:01<00:27, 338.59it/s]  5%|██████▊                                                                                                                                            | 450/9738 [00:01<00:27, 336.98it/s]  5%|███████▎                                                                                                                                           | 485/9738 [00:01<00:27, 338.01it/s]  5%|███████▊                                                                                                                                           | 520/9738 [00:01<00:27, 338.81it/s]  6%|████████▎                                                                                                                                          | 554/9738 [00:01<00:27, 338.83it/s]  6%|████████▉                                                                                                                                          | 589/9738 [00:01<00:26, 339.25it/s]  6%|█████████▍                                                                                                                                         | 623/9738 [00:01<00:27, 336.65it/s]  7%|█████████▉                                                                                                                                         | 657/9738 [00:01<00:27, 335.68it/s]  7%|██████████▍                                                                                                                                        | 692/9738 [00:02<00:26, 337.39it/s]  7%|██████████▉                                                                                                                                        | 726/9738 [00:02<00:26, 338.03it/s]  8%|███████████▍                                                                                                                                       | 761/9738 [00:02<00:26, 338.78it/s]  8%|████████████                                                                                                                                       | 796/9738 [00:02<00:26, 339.54it/s]  9%|████████████▌                                                                                                                                      | 831/9738 [00:02<00:26, 339.77it/s]  9%|█████████████▎                                                                                                                                     | 881/9738 [00:02<00:22, 385.58it/s] 10%|██████████████                                                                                                                                     | 932/9738 [00:02<00:20, 421.49it/s] 10%|██████████████▊                                                                                                                                    | 984/9738 [00:02<00:19, 449.80it/s] 11%|███████████████▌                                                                                                                                  | 1036/9738 [00:02<00:18, 469.99it/s] 11%|████████████████▎                                                                                                                                 | 1088/9738 [00:02<00:17, 484.19it/s] 12%|█████████████████                                                                                                                                 | 1139/9738 [00:03<00:17, 491.48it/s] 12%|█████████████████▊                                                                                                                                | 1191/9738 [00:03<00:17, 498.86it/s] 13%|██████████████████▋                                                                                                                               | 1243/9738 [00:03<00:16, 503.83it/s] 13%|███████████████████▍                                                                                                                              | 1295/9738 [00:03<00:16, 507.82it/s] 14%|████████████████████▏                                                                                                                             | 1346/9738 [00:03<00:16, 508.07it/s] 14%|████████████████████▉                                                                                                                             | 1398/9738 [00:03<00:16, 510.70it/s] 15%|█████████████████████▋                                                                                                                            | 1450/9738 [00:03<00:16, 512.95it/s] 15%|██████████████████████▌                                                                                                                           | 1502/9738 [00:03<00:16, 513.93it/s] 16%|███████████████████████▎                                                                                                                          | 1554/9738 [00:03<00:15, 515.29it/s] 16%|████████████████████████                                                                                                                          | 1606/9738 [00:03<00:15, 513.22it/s] 17%|████████████████████████▊                                                                                                                         | 1658/9738 [00:04<00:15, 514.85it/s] 18%|█████████████████████████▋                                                                                                                        | 1710/9738 [00:04<00:15, 514.45it/s] 18%|██████████████████████████▍                                                                                                                       | 1762/9738 [00:04<00:15, 515.65it/s] 19%|███████████████████████████▏                                                                                                                      | 1814/9738 [00:04<00:15, 496.04it/s] 19%|███████████████████████████▉                                                                                                                      | 1866/9738 [00:04<00:15, 501.79it/s] 20%|████████████████████████████▊                                                                                                                     | 1918/9738 [00:04<00:15, 505.81it/s] 20%|█████████████████████████████▌                                                                                                                    | 1970/9738 [00:04<00:15, 508.05it/s] 21%|██████████████████████████████▎                                                                                                                   | 2021/9738 [00:04<00:15, 508.42it/s] 21%|███████████████████████████████                                                                                                                   | 2073/9738 [00:04<00:15, 510.13it/s] 22%|███████████████████████████████▊                                                                                                                  | 2125/9738 [00:04<00:14, 511.33it/s] 22%|████████████████████████████████▋                                                                                                                 | 2177/9738 [00:05<00:14, 512.75it/s] 23%|█████████████████████████████████▍                                                                                                                | 2229/9738 [00:05<00:14, 514.01it/s] 23%|██████████████████████████████████▏                                                                                                               | 2281/9738 [00:05<00:14, 512.77it/s] 24%|██████████████████████████████████▉                                                                                                               | 2333/9738 [00:05<00:14, 513.52it/s] 24%|███████████████████████████████████▊                                                                                                              | 2385/9738 [00:05<00:14, 514.76it/s] 25%|████████████████████████████████████▌                                                                                                             | 2437/9738 [00:05<00:14, 497.72it/s] 26%|█████████████████████████████████████▎                                                                                                            | 2487/9738 [00:05<00:14, 498.19it/s] 26%|██████████████████████████████████████                                                                                                            | 2539/9738 [00:05<00:14, 503.02it/s] 27%|██████████████████████████████████████▊                                                                                                           | 2591/9738 [00:05<00:14, 507.51it/s] 27%|███████████████████████████████████████▋                                                                                                          | 2643/9738 [00:06<00:13, 509.90it/s] 28%|████████████████████████████████████████▍                                                                                                         | 2695/9738 [00:06<00:13, 511.56it/s] 28%|█████████████████████████████████████████▏                                                                                                        | 2747/9738 [00:06<00:13, 510.47it/s] 29%|█████████████████████████████████████████▉                                                                                                        | 2799/9738 [00:06<00:13, 511.71it/s] 29%|██████████████████████████████████████████▋                                                                                                       | 2851/9738 [00:06<00:13, 512.99it/s] 30%|███████████████████████████████████████████▌                                                                                                      | 2903/9738 [00:06<00:13, 514.42it/s] 30%|████████████████████████████████████████████▎                                                                                                     | 2955/9738 [00:06<00:13, 513.22it/s] 31%|█████████████████████████████████████████████                                                                                                     | 3007/9738 [00:06<00:13, 514.83it/s] 31%|█████████████████████████████████████████████▊                                                                                                    | 3059/9738 [00:06<00:12, 514.85it/s] 32%|██████████████████████████████████████████████▋                                                                                                   | 3111/9738 [00:06<00:12, 515.08it/s] 32%|███████████████████████████████████████████████▍                                                                                                  | 3163/9738 [00:07<00:12, 508.52it/s] 33%|████████████████████████████████████████████████▏                                                                                                 | 3215/9738 [00:07<00:12, 510.70it/s] 34%|████████████████████████████████████████████████▉                                                                                                 | 3267/9738 [00:07<00:12, 512.44it/s] 34%|█████████████████████████████████████████████████▊                                                                                                | 3319/9738 [00:07<00:12, 513.62it/s] 35%|██████████████████████████████████████████████████▌                                                                                               | 3371/9738 [00:07<00:12, 514.10it/s] 35%|███████████████████████████████████████████████████▎                                                                                              | 3423/9738 [00:07<00:12, 512.51it/s] 36%|████████████████████████████████████████████████████                                                                                              | 3475/9738 [00:07<00:12, 513.38it/s] 36%|████████████████████████████████████████████████████▉                                                                                             | 3527/9738 [00:07<00:12, 513.80it/s] 37%|█████████████████████████████████████████████████████▋                                                                                            | 3579/9738 [00:07<00:11, 513.97it/s] 37%|██████████████████████████████████████████████████████▍                                                                                           | 3631/9738 [00:07<00:11, 512.73it/s] 38%|███████████████████████████████████████████████████████▏                                                                                          | 3683/9738 [00:08<00:11, 513.67it/s] 38%|███████████████████████████████████████████████████████▉                                                                                          | 3735/9738 [00:08<00:11, 514.80it/s] 39%|████████████████████████████████████████████████████████▊                                                                                         | 3787/9738 [00:08<00:11, 514.55it/s] 39%|█████████████████████████████████████████████████████████▌                                                                                        | 3839/9738 [00:08<00:11, 507.62it/s] 40%|██████████████████████████████████████████████████████████▎                                                                                       | 3891/9738 [00:08<00:11, 510.36it/s] 40%|███████████████████████████████████████████████████████████                                                                                       | 3943/9738 [00:08<00:11, 512.24it/s] 41%|███████████████████████████████████████████████████████████▉                                                                                      | 3995/9738 [00:08<00:11, 513.23it/s] 42%|████████████████████████████████████████████████████████████▋                                                                                     | 4047/9738 [00:08<00:11, 514.10it/s] 42%|█████████████████████████████████████████████████████████████▍                                                                                    | 4099/9738 [00:08<00:10, 512.77it/s] 43%|██████████████████████████████████████████████████████████████▏                                                                                   | 4151/9738 [00:08<00:10, 513.09it/s] 43%|███████████████████████████████████████████████████████████████                                                                                   | 4203/9738 [00:09<00:10, 513.45it/s] 44%|███████████████████████████████████████████████████████████████▊                                                                                  | 4255/9738 [00:09<00:10, 514.20it/s] 44%|████████████████████████████████████████████████████████████████▌                                                                                 | 4307/9738 [00:09<00:10, 512.57it/s] 45%|█████████████████████████████████████████████████████████████████▎                                                                                | 4359/9738 [00:09<00:10, 513.45it/s] 45%|██████████████████████████████████████████████████████████████████▏                                                                               | 4411/9738 [00:09<00:10, 514.30it/s] 46%|██████████████████████████████████████████████████████████████████▉                                                                               | 4463/9738 [00:09<00:10, 513.74it/s] 46%|███████████████████████████████████████████████████████████████████▋                                                                              | 4515/9738 [00:09<00:11, 468.76it/s] 47%|████████████████████████████████████████████████████████████████████▍                                                                             | 4567/9738 [00:09<00:10, 481.33it/s] 47%|█████████████████████████████████████████████████████████████████████▎                                                                            | 4619/9738 [00:09<00:10, 491.33it/s] 48%|██████████████████████████████████████████████████████████████████████                                                                            | 4671/9738 [00:09<00:10, 498.39it/s] 49%|██████████████████████████████████████████████████████████████████████▊                                                                           | 4723/9738 [00:10<00:09, 502.52it/s] 49%|███████████████████████████████████████████████████████████████████████▌                                                                          | 4774/9738 [00:10<00:13, 361.45it/s] 50%|████████████████████████████████████████████████████████████████████████▎                                                                         | 4826/9738 [00:10<00:12, 397.50it/s] 50%|█████████████████████████████████████████████████████████████████████████▏                                                                        | 4878/9738 [00:10<00:11, 426.64it/s] 51%|█████████████████████████████████████████████████████████████████████████▉                                                                        | 4930/9738 [00:10<00:10, 449.97it/s] 51%|██████████████████████████████████████████████████████████████████████████▋                                                                       | 4982/9738 [00:10<00:10, 466.55it/s] 52%|███████████████████████████████████████████████████████████████████████████▍                                                                      | 5034/9738 [00:10<00:09, 480.40it/s] 52%|████████████████████████████████████████████████████████████████████████████▎                                                                     | 5086/9738 [00:10<00:09, 490.12it/s] 53%|█████████████████████████████████████████████████████████████████████████████                                                                     | 5138/9738 [00:11<00:09, 497.45it/s] 53%|█████████████████████████████████████████████████████████████████████████████▊                                                                    | 5189/9738 [00:11<00:09, 501.04it/s] 54%|██████████████████████████████████████████████████████████████████████████████▌                                                                   | 5241/9738 [00:11<00:08, 505.44it/s] 54%|███████████████████████████████████████████████████████████████████████████████▎                                                                  | 5293/9738 [00:11<00:08, 508.69it/s] 55%|████████████████████████████████████████████████████████████████████████████████▏                                                                 | 5345/9738 [00:11<00:08, 511.16it/s] 55%|████████████████████████████████████████████████████████████████████████████████▉                                                                 | 5397/9738 [00:11<00:08, 512.44it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▋                                                                | 5449/9738 [00:11<00:08, 511.36it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▍                                                               | 5502/9738 [00:11<00:08, 515.07it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▎                                                              | 5556/9738 [00:11<00:08, 520.54it/s] 58%|████████████████████████████████████████████████████████████████████████████████████                                                              | 5610/9738 [00:11<00:07, 523.77it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▉                                                             | 5663/9738 [00:12<00:07, 524.70it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▋                                                            | 5717/9738 [00:12<00:07, 527.37it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▌                                                           | 5771/9738 [00:12<00:07, 529.05it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▎                                                          | 5825/9738 [00:12<00:07, 530.21it/s] 60%|████████████████████████████████████████████████████████████████████████████████████████▏                                                         | 5879/9738 [00:12<00:07, 528.19it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▉                                                         | 5933/9738 [00:12<00:07, 529.43it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▊                                                        | 5987/9738 [00:12<00:07, 530.76it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▌                                                       | 6041/9738 [00:12<00:06, 531.46it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▍                                                      | 6095/9738 [00:12<00:06, 530.39it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▏                                                     | 6149/9738 [00:12<00:06, 530.67it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████                                                     | 6203/9738 [00:13<00:06, 528.35it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▊                                                    | 6256/9738 [00:13<00:06, 527.94it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▌                                                   | 6309/9738 [00:13<00:06, 526.91it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▍                                                  | 6363/9738 [00:13<00:06, 528.21it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▏                                                 | 6417/9738 [00:13<00:06, 529.64it/s] 66%|█████████████████████████████████████████████████████████████████████████████████████████████████                                                 | 6471/9738 [00:13<00:06, 530.06it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▊                                                | 6525/9738 [00:13<00:06, 530.22it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▋                                               | 6579/9738 [00:13<00:05, 528.84it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▍                                              | 6632/9738 [00:13<00:05, 528.63it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▏                                             | 6686/9738 [00:13<00:05, 529.12it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████                                             | 6740/9738 [00:14<00:05, 529.69it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▊                                            | 6793/9738 [00:14<00:05, 528.51it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▋                                           | 6847/9738 [00:14<00:05, 529.58it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▍                                          | 6901/9738 [00:14<00:05, 530.27it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                         | 6955/9738 [00:14<00:05, 530.52it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████                                         | 7009/9738 [00:14<00:05, 527.77it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                        | 7063/9738 [00:14<00:05, 528.63it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                       | 7117/9738 [00:14<00:04, 529.31it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                      | 7171/9738 [00:14<00:04, 529.78it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                     | 7224/9738 [00:14<00:04, 528.11it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████                                     | 7277/9738 [00:15<00:04, 528.65it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                    | 7330/9738 [00:15<00:04, 528.73it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                   | 7384/9738 [00:15<00:04, 529.50it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                  | 7437/9738 [00:15<00:04, 528.97it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 7490/9738 [00:15<00:04, 503.67it/s] 77%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                 | 7543/9738 [00:15<00:04, 510.97it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                | 7596/9738 [00:15<00:04, 516.39it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                               | 7649/9738 [00:15<00:04, 520.05it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                              | 7702/9738 [00:15<00:03, 521.06it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                             | 7756/9738 [00:16<00:03, 524.11it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                             | 7809/9738 [00:16<00:03, 525.75it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                            | 7863/9738 [00:16<00:03, 527.33it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 7916/9738 [00:16<00:03, 526.44it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                          | 7970/9738 [00:16<00:03, 527.62it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                         | 8024/9738 [00:16<00:03, 528.39it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                         | 8077/9738 [00:16<00:03, 528.54it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                        | 8130/9738 [00:16<00:03, 527.42it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                       | 8183/9738 [00:16<00:02, 528.14it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                      | 8237/9738 [00:16<00:02, 529.01it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                     | 8290/9738 [00:17<00:02, 528.96it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                     | 8344/9738 [00:17<00:02, 529.35it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                    | 8397/9738 [00:17<00:02, 527.90it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 8451/9738 [00:17<00:02, 528.66it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 8505/9738 [00:17<00:02, 529.08it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                 | 8558/9738 [00:17<00:02, 528.61it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                 | 8611/9738 [00:17<00:02, 526.41it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                | 8664/9738 [00:17<00:02, 527.15it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋               | 8717/9738 [00:17<00:01, 527.90it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍              | 8770/9738 [00:17<00:01, 528.33it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎             | 8823/9738 [00:18<00:01, 526.09it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████             | 8876/9738 [00:18<00:01, 526.06it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊            | 8929/9738 [00:18<00:01, 526.83it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋           | 8982/9738 [00:18<00:01, 527.38it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍          | 9035/9738 [00:18<00:01, 525.94it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎         | 9088/9738 [00:18<00:01, 526.63it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████         | 9142/9738 [00:18<00:01, 527.80it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊        | 9195/9738 [00:18<00:01, 527.92it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋       | 9248/9738 [00:18<00:00, 527.97it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍      | 9301/9738 [00:18<00:00, 525.76it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏     | 9354/9738 [00:19<00:00, 526.69it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 9407/9738 [00:19<00:00, 527.43it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊    | 9460/9738 [00:19<00:00, 527.65it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋   | 9513/9738 [00:19<00:00, 526.27it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍  | 9566/9738 [00:19<00:00, 526.70it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏ | 9619/9738 [00:19<00:00, 527.11it/s] 99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████ | 9672/9738 [00:19<00:00, 527.46it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊| 9725/9738 [00:19<00:00, 524.98it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9738/9738 [00:19<00:00, 492.48it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.35s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.12s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.05s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.37s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.49s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.24s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.63s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.99s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.63s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]
[2023-08-10 20:33:24,638] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-10 20:33:31,368] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 20:33:31,369] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 20:33:31,369] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 20:33:31,369] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 20:33:31,369] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 20:33:31,369] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 20:33:31,369] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 20:33:31,369] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 20:33:31,369] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 20:33:31,369] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 20:33:31,369] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fb064480e80>
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fb063ed4910>
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 20:33:31,370] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 20:33:31,371] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 20:33:31,371] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 20:33:31,371] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 20:33:31,371] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 20:33:31,371] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 20:33:31,371] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.431384801864624 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Where could you find some plumbing that would not be of use to you if you are thirsty? Choices:  A: oil refineries B: wall C: show D: own home E: water fountain
Rationales: 1. The question is asking us for a place where there is plumbing but it will not be usable if we are thirsty.
2. This implies that the plumbing in this place does not contain or supply water that we can drink.
3. Looking at the choices, we proceed to eliminate the options where plumbing can provide drinkable water.
4. In our own home (D), we certainly have plumbing system that delivers drinkable water. So, D: own home is not the correct answer.
5. Plumbing in a water fountain (E) is also designed to provide drinkable water flow, so E: water fountain is not the right answer.
6. Option B: wall and C: show are vague and do not convey coherent meaning in relation to plumbing or drinking water specifically.
7. This leaves us with A: oil refineries, which indeed has extensive plumbing system.
8. However, the plumbing in oil refineries is used for flow of various types of oil and by-products, none of which are drinkable.
9. Therefore, A: oil refineries is the correct answer. It has plumbing but not of any use if we are thirsting for water.
Answer: A: oil refineries

Input: When a person is beginning work, what aren't they doing yet? Choices:  A: working B: resting C: tiredness D: accomplishing E: momentum
Rationales: 1. The question asks what a person isn't doing when they are beginning work.
2. We need to assess each option in regard to this situation.
3. Option A: working - this can't be the correct answer because when a person is beginning work, they are in fact working.
4. Option B: resting - similarly, this can't be the correct answer either because when a person is beginning work, they are not resting.
5. Option C: tiredness - this couldn't be right, as tiredness is a state of feeling and not an action. Besides, it is possible that a person could begin working while feeling tired.
6. Option D: accomplishing - this option fits the scenario, as accomplishing refers to having achieved something significant or completing a task. When a person is only beginning their work, they are still in the progress of doing it and haven't achieved or completed anything yet.  
7. Option E: momentum - this can't be the correct answer because momentum refers to the force gained by a moving object, or could metaphorically mean a series of successful events. This may be built up during the course of working, hence can be done when the person is beginning work.
8. Therefore, the answer is D: accomplishing.
Answer: D: accomplishing

Input: Where might I find pens with a company logo? Choices:  A: office B: on a pencil C: write sentences on paper D: school E: backpack
Rationales: 1. The question is asking where to find pens with a company logo on them. 
2. The first step is to understand what the question is asking. 
3. Pens with company logos are usually distributed by companies to employees or at corporate events for promotional purposes.
4. Thus, these pens are often found in associative locations such as offices, rather than on another pen or paper, or in non-related places like school or a backpack. 
5. Among the choices given, only "office" fits this categorization. 
6. Therefore, the answer is A: office.
Answer: A: office

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i3-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.3043959140777588 seconds
Loading extension module utils...
Time to load utils op: 0.40434861183166504 seconds
Loading extension module utils...
Time to load utils op: 0.504967451095581 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:46<37:35, 46.04s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:31<36:27, 45.57s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:03<31:05, 39.69s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:37<28:28, 37.13s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:23<30:15, 40.34s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:09<31:00, 42.29s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:54<31:05, 43.39s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:40<30:53, 44.14s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:25<30:24, 44.50s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:10<29:41, 44.54s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:42<26:20, 40.52s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:26<26:27, 41.77s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:10<26:14, 42.55s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:40<23:12, 38.68s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:26<23:47, 40.79s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:11<23:49, 42.05s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:56<23:36, 42.92s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [12:41<23:16, 43.64s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [13:27<22:49, 44.18s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:12<22:18, 44.60s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [14:57<21:35, 44.66s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [15:42<20:53, 44.78s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [16:27<20:14, 44.97s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [17:02<18:11, 41.97s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [17:48<17:58, 43.15s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [18:33<17:26, 43.60s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [19:18<16:54, 44.09s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [20:04<16:23, 44.68s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:50<15:46, 45.06s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:14<12:51, 38.58s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [21:58<12:48, 40.46s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:44<12:34, 41.90s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:29<12:08, 42.86s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [24:16<11:44, 44.01s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [25:01<11:04, 44.31s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [25:46<10:25, 44.70s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [26:31<09:41, 44.70s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:57<07:49, 39.13s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [27:42<07:29, 40.84s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [28:26<06:59, 41.95s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [29:12<06:28, 43.15s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [29:57<05:49, 43.67s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [30:43<05:09, 44.23s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [31:28<04:27, 44.51s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [32:13<03:43, 44.64s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [32:59<03:00, 45.05s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [33:44<02:15, 45.15s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [34:10<01:18, 39.45s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [34:55<00:41, 41.07s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:40<00:00, 42.20s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:40<00:00, 42.81s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.346} | lm_loss 7.4207 | avg. gen lenth: 294.22
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i4-s1-rTrue --seed 1 --rationales --num-in-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[2023-08-10 21:10:19,320] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i4-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 4
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i4-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9737 [00:00<?, ?it/s]  0%|▎                                                                                                                                                   | 22/9737 [00:00<00:44, 219.37it/s]  0%|▋                                                                                                                                                   | 45/9737 [00:00<00:44, 219.85it/s]  1%|█                                                                                                                                                   | 68/9737 [00:00<00:43, 220.12it/s]  1%|█▍                                                                                                                                                  | 91/9737 [00:00<00:43, 220.22it/s]  1%|█▋                                                                                                                                                 | 114/9737 [00:00<00:43, 220.46it/s]  1%|██                                                                                                                                                 | 137/9737 [00:00<00:43, 220.77it/s]  2%|██▍                                                                                                                                                | 160/9737 [00:00<00:43, 218.93it/s]  2%|██▋                                                                                                                                                | 182/9737 [00:00<00:43, 218.22it/s]  2%|███                                                                                                                                                | 204/9737 [00:00<00:43, 217.07it/s]  2%|███▍                                                                                                                                               | 226/9737 [00:01<00:43, 217.93it/s]  3%|███▊                                                                                                                                               | 249/9737 [00:01<00:43, 218.65it/s]  3%|████                                                                                                                                               | 272/9737 [00:01<00:43, 219.28it/s]  3%|████▍                                                                                                                                              | 295/9737 [00:01<00:42, 219.62it/s]  3%|████▊                                                                                                                                              | 318/9737 [00:01<00:42, 219.90it/s]  4%|█████▏                                                                                                                                             | 341/9737 [00:01<00:42, 220.01it/s]  4%|█████▍                                                                                                                                             | 364/9737 [00:01<00:42, 220.03it/s]  4%|█████▊                                                                                                                                             | 387/9737 [00:01<00:42, 217.82it/s]  4%|██████▏                                                                                                                                            | 409/9737 [00:01<00:42, 218.23it/s]  4%|██████▌                                                                                                                                            | 431/9737 [00:01<00:43, 216.14it/s]  5%|██████▊                                                                                                                                            | 454/9737 [00:02<00:42, 217.50it/s]  5%|███████▏                                                                                                                                           | 477/9737 [00:02<00:42, 218.32it/s]  5%|███████▌                                                                                                                                           | 500/9737 [00:02<00:42, 219.03it/s]  5%|███████▉                                                                                                                                           | 523/9737 [00:02<00:41, 219.56it/s]  6%|████████▏                                                                                                                                          | 546/9737 [00:02<00:41, 219.89it/s]  6%|████████▌                                                                                                                                          | 568/9737 [00:02<00:41, 219.78it/s]  6%|█████████                                                                                                                                          | 601/9737 [00:02<00:36, 252.12it/s]  7%|█████████▌                                                                                                                                         | 635/9737 [00:02<00:32, 276.49it/s]  7%|██████████                                                                                                                                         | 668/9737 [00:02<00:31, 292.14it/s]  7%|██████████▌                                                                                                                                        | 702/9737 [00:02<00:29, 305.00it/s]  8%|███████████                                                                                                                                        | 736/9737 [00:03<00:28, 313.87it/s]  8%|███████████▌                                                                                                                                       | 770/9737 [00:03<00:27, 320.41it/s]  8%|████████████▏                                                                                                                                      | 804/9737 [00:03<00:27, 324.98it/s]  9%|████████████▋                                                                                                                                      | 838/9737 [00:03<00:27, 328.03it/s]  9%|█████████████▏                                                                                                                                     | 872/9737 [00:03<00:26, 330.08it/s]  9%|█████████████▋                                                                                                                                     | 906/9737 [00:03<00:26, 329.65it/s] 10%|██████████████▏                                                                                                                                    | 940/9737 [00:03<00:26, 331.15it/s] 10%|██████████████▋                                                                                                                                    | 974/9737 [00:03<00:26, 331.99it/s] 10%|███████████████                                                                                                                                   | 1008/9737 [00:03<00:26, 332.07it/s] 11%|███████████████▌                                                                                                                                  | 1042/9737 [00:04<00:26, 333.28it/s] 11%|████████████████▏                                                                                                                                 | 1076/9737 [00:04<00:25, 334.07it/s] 11%|████████████████▋                                                                                                                                 | 1110/9737 [00:04<00:26, 331.57it/s] 12%|█████████████████▏                                                                                                                                | 1144/9737 [00:04<00:25, 331.85it/s] 12%|█████████████████▋                                                                                                                                | 1178/9737 [00:04<00:25, 332.80it/s] 12%|██████████████████▏                                                                                                                               | 1212/9737 [00:04<00:25, 332.96it/s] 13%|██████████████████▋                                                                                                                               | 1246/9737 [00:04<00:25, 333.36it/s] 13%|███████████████████▏                                                                                                                              | 1280/9737 [00:04<00:25, 333.16it/s] 13%|███████████████████▋                                                                                                                              | 1314/9737 [00:04<00:25, 332.68it/s] 14%|████████████████████▏                                                                                                                             | 1348/9737 [00:04<00:25, 331.17it/s] 14%|████████████████████▋                                                                                                                             | 1382/9737 [00:05<00:25, 331.97it/s] 15%|█████████████████████▏                                                                                                                            | 1416/9737 [00:05<00:25, 332.60it/s] 15%|█████████████████████▋                                                                                                                            | 1450/9737 [00:05<00:24, 333.05it/s] 15%|██████████████████████▎                                                                                                                           | 1484/9737 [00:05<00:24, 333.34it/s] 16%|██████████████████████▊                                                                                                                           | 1518/9737 [00:05<00:24, 332.97it/s] 16%|███████████████████████▎                                                                                                                          | 1552/9737 [00:05<00:24, 333.09it/s] 16%|███████████████████████▊                                                                                                                          | 1586/9737 [00:05<00:24, 328.66it/s] 17%|████████████████████████▎                                                                                                                         | 1620/9737 [00:05<00:24, 329.82it/s] 17%|████████████████████████▊                                                                                                                         | 1654/9737 [00:05<00:24, 331.30it/s] 17%|█████████████████████████▎                                                                                                                        | 1688/9737 [00:05<00:24, 331.10it/s] 18%|█████████████████████████▊                                                                                                                        | 1722/9737 [00:06<00:24, 331.88it/s] 18%|██████████████████████████▎                                                                                                                       | 1756/9737 [00:06<00:23, 332.57it/s] 18%|██████████████████████████▊                                                                                                                       | 1790/9737 [00:06<00:25, 315.59it/s] 19%|███████████████████████████▎                                                                                                                      | 1824/9737 [00:06<00:24, 320.40it/s] 19%|███████████████████████████▊                                                                                                                      | 1858/9737 [00:06<00:24, 324.18it/s] 19%|████████████████████████████▎                                                                                                                     | 1892/9737 [00:06<00:24, 326.84it/s] 20%|████████████████████████████▉                                                                                                                     | 1926/9737 [00:06<00:23, 328.62it/s] 20%|█████████████████████████████▍                                                                                                                    | 1960/9737 [00:06<00:23, 329.66it/s] 20%|█████████████████████████████▉                                                                                                                    | 1994/9737 [00:06<00:23, 330.96it/s] 21%|██████████████████████████████▍                                                                                                                   | 2028/9737 [00:07<00:23, 326.89it/s] 21%|██████████████████████████████▉                                                                                                                   | 2062/9737 [00:07<00:23, 328.55it/s] 22%|███████████████████████████████▍                                                                                                                  | 2095/9737 [00:07<00:23, 328.88it/s] 22%|███████████████████████████████▉                                                                                                                  | 2129/9737 [00:07<00:23, 329.98it/s] 22%|████████████████████████████████▍                                                                                                                 | 2163/9737 [00:07<00:22, 329.76it/s] 23%|████████████████████████████████▉                                                                                                                 | 2196/9737 [00:07<00:22, 329.52it/s] 23%|█████████████████████████████████▍                                                                                                                | 2230/9737 [00:07<00:22, 329.89it/s] 23%|█████████████████████████████████▉                                                                                                                | 2263/9737 [00:07<00:22, 329.02it/s] 24%|██████████████████████████████████▍                                                                                                               | 2297/9737 [00:07<00:22, 330.35it/s] 24%|██████████████████████████████████▉                                                                                                               | 2331/9737 [00:07<00:22, 330.48it/s] 24%|███████████████████████████████████▍                                                                                                              | 2365/9737 [00:08<00:22, 331.38it/s] 25%|███████████████████████████████████▉                                                                                                              | 2399/9737 [00:08<00:22, 332.00it/s] 25%|████████████████████████████████████▍                                                                                                             | 2433/9737 [00:08<00:21, 332.94it/s] 25%|████████████████████████████████████▉                                                                                                             | 2467/9737 [00:08<00:22, 330.26it/s] 26%|█████████████████████████████████████▌                                                                                                            | 2501/9737 [00:08<00:22, 328.20it/s] 26%|██████████████████████████████████████                                                                                                            | 2535/9737 [00:08<00:21, 329.26it/s] 26%|██████████████████████████████████████▌                                                                                                           | 2569/9737 [00:08<00:21, 329.58it/s] 27%|███████████████████████████████████████                                                                                                           | 2603/9737 [00:08<00:21, 330.24it/s] 27%|███████████████████████████████████████▌                                                                                                          | 2637/9737 [00:08<00:21, 330.91it/s] 27%|████████████████████████████████████████                                                                                                          | 2671/9737 [00:08<00:21, 331.67it/s] 28%|████████████████████████████████████████▌                                                                                                         | 2705/9737 [00:09<00:21, 329.93it/s] 28%|█████████████████████████████████████████                                                                                                         | 2739/9737 [00:09<00:21, 330.59it/s] 28%|█████████████████████████████████████████▌                                                                                                        | 2773/9737 [00:09<00:21, 331.04it/s] 29%|██████████████████████████████████████████                                                                                                        | 2807/9737 [00:09<00:20, 331.57it/s] 29%|██████████████████████████████████████████▌                                                                                                       | 2841/9737 [00:09<00:20, 331.97it/s] 30%|███████████████████████████████████████████                                                                                                       | 2875/9737 [00:09<00:20, 332.46it/s] 30%|███████████████████████████████████████████▌                                                                                                      | 2909/9737 [00:09<00:20, 330.08it/s] 30%|████████████████████████████████████████████▏                                                                                                     | 2943/9737 [00:09<00:20, 327.93it/s] 31%|████████████████████████████████████████████▌                                                                                                     | 2976/9737 [00:09<00:20, 327.48it/s] 31%|█████████████████████████████████████████████                                                                                                     | 3009/9737 [00:09<00:20, 327.97it/s] 31%|█████████████████████████████████████████████▋                                                                                                    | 3043/9737 [00:10<00:20, 329.27it/s] 32%|██████████████████████████████████████████████▏                                                                                                   | 3077/9737 [00:10<00:20, 330.17it/s] 32%|██████████████████████████████████████████████▋                                                                                                   | 3111/9737 [00:10<00:20, 330.93it/s] 32%|███████████████████████████████████████████████▏                                                                                                  | 3145/9737 [00:10<00:19, 331.36it/s] 33%|███████████████████████████████████████████████▋                                                                                                  | 3179/9737 [00:10<00:19, 330.21it/s] 33%|████████████████████████████████████████████████▏                                                                                                 | 3213/9737 [00:10<00:19, 331.16it/s] 33%|████████████████████████████████████████████████▋                                                                                                 | 3247/9737 [00:10<00:19, 331.95it/s] 34%|█████████████████████████████████████████████████▏                                                                                                | 3281/9737 [00:10<00:19, 332.05it/s] 34%|█████████████████████████████████████████████████▋                                                                                                | 3315/9737 [00:10<00:19, 331.52it/s] 34%|██████████████████████████████████████████████████▏                                                                                               | 3349/9737 [00:11<00:19, 329.97it/s] 35%|██████████████████████████████████████████████████▋                                                                                               | 3382/9737 [00:11<00:19, 327.48it/s] 35%|███████████████████████████████████████████████████▏                                                                                              | 3416/9737 [00:11<00:19, 329.11it/s] 35%|███████████████████████████████████████████████████▋                                                                                              | 3450/9737 [00:11<00:19, 329.99it/s] 36%|████████████████████████████████████████████████████▏                                                                                             | 3484/9737 [00:11<00:18, 330.32it/s] 36%|████████████████████████████████████████████████████▊                                                                                             | 3518/9737 [00:11<00:18, 330.18it/s] 36%|█████████████████████████████████████████████████████▎                                                                                            | 3552/9737 [00:11<00:18, 330.94it/s] 37%|█████████████████████████████████████████████████████▊                                                                                            | 3586/9737 [00:11<00:18, 331.19it/s] 37%|██████████████████████████████████████████████████████▎                                                                                           | 3620/9737 [00:11<00:18, 329.53it/s] 38%|██████████████████████████████████████████████████████▊                                                                                           | 3654/9737 [00:11<00:18, 329.64it/s] 38%|███████████████████████████████████████████████████████▎                                                                                          | 3688/9737 [00:12<00:18, 330.41it/s] 38%|███████████████████████████████████████████████████████▊                                                                                          | 3722/9737 [00:12<00:18, 331.00it/s] 39%|████████████████████████████████████████████████████████▎                                                                                         | 3756/9737 [00:12<00:18, 331.44it/s] 39%|████████████████████████████████████████████████████████▊                                                                                         | 3790/9737 [00:12<00:17, 331.84it/s] 39%|█████████████████████████████████████████████████████████▎                                                                                        | 3824/9737 [00:12<00:17, 332.32it/s] 40%|█████████████████████████████████████████████████████████▊                                                                                        | 3858/9737 [00:12<00:17, 330.62it/s] 40%|██████████████████████████████████████████████████████████▎                                                                                       | 3892/9737 [00:12<00:17, 331.29it/s] 40%|██████████████████████████████████████████████████████████▊                                                                                       | 3926/9737 [00:12<00:17, 331.16it/s] 41%|███████████████████████████████████████████████████████████▍                                                                                      | 3960/9737 [00:12<00:17, 331.32it/s] 41%|███████████████████████████████████████████████████████████▉                                                                                      | 3994/9737 [00:12<00:17, 331.58it/s] 41%|████████████████████████████████████████████████████████████▍                                                                                     | 4028/9737 [00:13<00:17, 331.17it/s] 42%|████████████████████████████████████████████████████████████▉                                                                                     | 4062/9737 [00:13<00:17, 329.62it/s] 42%|█████████████████████████████████████████████████████████████▍                                                                                    | 4095/9737 [00:13<00:17, 329.61it/s] 42%|█████████████████████████████████████████████████████████████▉                                                                                    | 4129/9737 [00:13<00:16, 330.02it/s] 43%|██████████████████████████████████████████████████████████████▍                                                                                   | 4163/9737 [00:13<00:16, 330.68it/s] 43%|██████████████████████████████████████████████████████████████▉                                                                                   | 4197/9737 [00:13<00:16, 331.23it/s] 43%|███████████████████████████████████████████████████████████████▍                                                                                  | 4231/9737 [00:13<00:16, 330.86it/s] 44%|███████████████████████████████████████████████████████████████▉                                                                                  | 4265/9737 [00:13<00:16, 329.46it/s] 44%|████████████████████████████████████████████████████████████████▍                                                                                 | 4298/9737 [00:13<00:16, 327.73it/s] 44%|████████████████████████████████████████████████████████████████▉                                                                                 | 4331/9737 [00:13<00:16, 328.08it/s] 45%|█████████████████████████████████████████████████████████████████▍                                                                                | 4365/9737 [00:14<00:16, 329.29it/s] 45%|█████████████████████████████████████████████████████████████████▉                                                                                | 4399/9737 [00:14<00:16, 330.56it/s] 46%|██████████████████████████████████████████████████████████████████▍                                                                               | 4433/9737 [00:14<00:16, 330.95it/s] 46%|██████████████████████████████████████████████████████████████████▉                                                                               | 4467/9737 [00:14<00:15, 331.14it/s] 46%|███████████████████████████████████████████████████████████████████▍                                                                              | 4501/9737 [00:14<00:15, 331.22it/s] 47%|███████████████████████████████████████████████████████████████████▉                                                                              | 4535/9737 [00:14<00:17, 303.31it/s] 47%|████████████████████████████████████████████████████████████████████▍                                                                             | 4568/9737 [00:14<00:16, 310.59it/s] 47%|█████████████████████████████████████████████████████████████████████                                                                             | 4602/9737 [00:14<00:16, 316.96it/s] 48%|█████████████████████████████████████████████████████████████████████▌                                                                            | 4636/9737 [00:14<00:15, 321.47it/s] 48%|██████████████████████████████████████████████████████████████████████                                                                            | 4670/9737 [00:15<00:15, 324.50it/s] 48%|██████████████████████████████████████████████████████████████████████▌                                                                           | 4704/9737 [00:15<00:15, 326.73it/s] 49%|███████████████████████████████████████████████████████████████████████                                                                           | 4738/9737 [00:15<00:15, 328.65it/s] 49%|███████████████████████████████████████████████████████████████████████▌                                                                          | 4771/9737 [00:15<00:22, 223.43it/s] 49%|████████████████████████████████████████████████████████████████████████                                                                          | 4805/9737 [00:15<00:19, 247.77it/s] 50%|████████████████████████████████████████████████████████████████████████▌                                                                         | 4838/9737 [00:15<00:18, 265.95it/s] 50%|█████████████████████████████████████████████████████████████████████████                                                                         | 4871/9737 [00:15<00:17, 281.76it/s] 50%|█████████████████████████████████████████████████████████████████████████▌                                                                        | 4904/9737 [00:15<00:16, 294.29it/s] 51%|██████████████████████████████████████████████████████████████████████████                                                                        | 4938/9737 [00:16<00:15, 304.50it/s] 51%|██████████████████████████████████████████████████████████████████████████▌                                                                       | 4971/9737 [00:16<00:15, 310.79it/s] 51%|███████████████████████████████████████████████████████████████████████████                                                                       | 5005/9737 [00:16<00:14, 316.95it/s] 52%|███████████████████████████████████████████████████████████████████████████▌                                                                      | 5039/9737 [00:16<00:14, 321.37it/s] 52%|████████████████████████████████████████████████████████████████████████████                                                                      | 5072/9737 [00:16<00:14, 323.33it/s] 52%|████████████████████████████████████████████████████████████████████████████▌                                                                     | 5106/9737 [00:16<00:14, 325.97it/s] 53%|█████████████████████████████████████████████████████████████████████████████                                                                     | 5140/9737 [00:16<00:14, 328.09it/s] 53%|█████████████████████████████████████████████████████████████████████████████▌                                                                    | 5173/9737 [00:16<00:13, 327.73it/s] 53%|██████████████████████████████████████████████████████████████████████████████                                                                    | 5206/9737 [00:16<00:13, 328.01it/s] 54%|██████████████████████████████████████████████████████████████████████████████▌                                                                   | 5239/9737 [00:16<00:13, 327.75it/s] 54%|███████████████████████████████████████████████████████████████████████████████                                                                   | 5273/9737 [00:17<00:13, 328.95it/s] 55%|███████████████████████████████████████████████████████████████████████████████▌                                                                  | 5307/9737 [00:17<00:13, 330.33it/s] 55%|████████████████████████████████████████████████████████████████████████████████                                                                  | 5341/9737 [00:17<00:13, 330.44it/s] 55%|████████████████████████████████████████████████████████████████████████████████▌                                                                 | 5375/9737 [00:17<00:13, 330.74it/s] 56%|█████████████████████████████████████████████████████████████████████████████████                                                                 | 5409/9737 [00:17<00:13, 329.18it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▌                                                                | 5443/9737 [00:17<00:13, 329.92it/s] 56%|██████████████████████████████████████████████████████████████████████████████████                                                                | 5477/9737 [00:17<00:12, 330.75it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▋                                                               | 5512/9737 [00:17<00:12, 333.95it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▏                                                              | 5547/9737 [00:17<00:12, 336.47it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▋                                                              | 5581/9737 [00:17<00:12, 335.39it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▏                                                             | 5615/9737 [00:18<00:12, 334.71it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▋                                                             | 5649/9737 [00:18<00:12, 332.19it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▏                                                            | 5684/9737 [00:18<00:12, 334.86it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▊                                                            | 5719/9737 [00:18<00:11, 336.97it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▎                                                           | 5754/9737 [00:18<00:11, 338.62it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▊                                                           | 5789/9737 [00:18<00:11, 339.63it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▎                                                          | 5824/9737 [00:18<00:11, 340.39it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▊                                                          | 5859/9737 [00:18<00:11, 338.14it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▍                                                         | 5894/9737 [00:18<00:11, 339.04it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▉                                                         | 5929/9737 [00:18<00:11, 339.60it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▍                                                        | 5963/9737 [00:19<00:11, 336.19it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▉                                                        | 5997/9737 [00:19<00:11, 336.21it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▍                                                       | 6032/9737 [00:19<00:10, 337.97it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▉                                                       | 6067/9737 [00:19<00:10, 338.83it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▍                                                      | 6101/9737 [00:19<00:10, 337.66it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████                                                      | 6136/9737 [00:19<00:10, 338.56it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▌                                                     | 6171/9737 [00:19<00:10, 339.34it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████                                                     | 6205/9737 [00:19<00:10, 337.36it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▌                                                    | 6240/9737 [00:19<00:10, 338.20it/s] 64%|██████████████████████████████████████████████████████████████████████████████████████████████                                                    | 6274/9737 [00:19<00:10, 337.51it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▌                                                   | 6308/9737 [00:20<00:10, 336.78it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████                                                   | 6342/9737 [00:20<00:10, 336.27it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▌                                                  | 6376/9737 [00:20<00:09, 336.51it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▏                                                 | 6411/9737 [00:20<00:09, 337.87it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▋                                                 | 6446/9737 [00:20<00:09, 339.33it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▏                                                | 6480/9737 [00:20<00:09, 339.29it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▋                                                | 6514/9737 [00:20<00:09, 337.93it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▏                                               | 6548/9737 [00:20<00:09, 334.68it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▋                                               | 6583/9737 [00:20<00:09, 336.33it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                                              | 6618/9737 [00:21<00:09, 337.78it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▊                                              | 6653/9737 [00:21<00:09, 339.01it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▎                                             | 6687/9737 [00:21<00:08, 339.20it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▊                                             | 6722/9737 [00:21<00:08, 339.50it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████▎                                            | 6757/9737 [00:21<00:08, 339.84it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▊                                            | 6791/9737 [00:21<00:08, 335.16it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▎                                           | 6826/9737 [00:21<00:08, 336.90it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▉                                           | 6861/9737 [00:21<00:08, 338.10it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▍                                          | 6896/9737 [00:21<00:08, 339.01it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▉                                          | 6931/9737 [00:21<00:08, 339.62it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                         | 6965/9737 [00:22<00:08, 339.13it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                         | 6999/9737 [00:22<00:08, 337.98it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                        | 7033/9737 [00:22<00:07, 338.30it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                        | 7067/9737 [00:22<00:07, 337.62it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                       | 7101/9737 [00:22<00:07, 337.23it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                       | 7135/9737 [00:22<00:07, 335.11it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                      | 7169/9737 [00:22<00:07, 336.38it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████                                      | 7204/9737 [00:22<00:07, 337.77it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                     | 7238/9737 [00:22<00:07, 336.89it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████                                     | 7273/9737 [00:22<00:07, 337.99it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                    | 7308/9737 [00:23<00:07, 338.86it/s] 75%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████                                    | 7342/9737 [00:23<00:07, 336.56it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                   | 7377/9737 [00:23<00:06, 337.73it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                  | 7412/9737 [00:23<00:06, 338.77it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                  | 7446/9737 [00:23<00:07, 300.68it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 7480/9737 [00:23<00:07, 310.01it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 7514/9737 [00:23<00:06, 318.28it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                | 7549/9737 [00:23<00:06, 324.60it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                | 7583/9737 [00:23<00:06, 328.83it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                               | 7618/9737 [00:24<00:06, 331.98it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                               | 7652/9737 [00:24<00:06, 333.33it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                              | 7686/9737 [00:24<00:06, 333.11it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                              | 7721/9737 [00:24<00:06, 335.72it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                             | 7756/9737 [00:24<00:05, 337.35it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                             | 7790/9737 [00:24<00:05, 336.39it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                            | 7824/9737 [00:24<00:05, 336.66it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                            | 7859/9737 [00:24<00:05, 337.87it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                           | 7893/9737 [00:24<00:05, 338.22it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                           | 7927/9737 [00:24<00:05, 335.45it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                          | 7962/9737 [00:25<00:05, 337.01it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                          | 7997/9737 [00:25<00:05, 338.36it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                         | 8032/9737 [00:25<00:05, 339.07it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                         | 8066/9737 [00:25<00:04, 338.72it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                        | 8101/9737 [00:25<00:04, 339.25it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                        | 8135/9737 [00:25<00:04, 338.06it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                       | 8169/9737 [00:25<00:04, 337.45it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                       | 8203/9737 [00:25<00:04, 337.97it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                      | 8238/9737 [00:25<00:04, 338.81it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                      | 8272/9737 [00:25<00:04, 338.99it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                     | 8306/9737 [00:26<00:04, 337.41it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                     | 8340/9737 [00:26<00:04, 337.86it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                    | 8374/9737 [00:26<00:04, 337.05it/s] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                    | 8409/9737 [00:26<00:03, 337.93it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                   | 8444/9737 [00:26<00:03, 339.08it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                   | 8478/9737 [00:26<00:03, 338.71it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                  | 8513/9737 [00:26<00:03, 339.51it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                 | 8547/9737 [00:26<00:03, 339.64it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 8581/9737 [00:26<00:03, 338.18it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                | 8615/9737 [00:26<00:03, 336.36it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                | 8649/9737 [00:27<00:03, 336.06it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏               | 8683/9737 [00:27<00:03, 336.40it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋               | 8717/9737 [00:27<00:03, 337.00it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏              | 8752/9737 [00:27<00:02, 337.95it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋              | 8786/9737 [00:27<00:02, 338.47it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎             | 8820/9737 [00:27<00:02, 337.41it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 8854/9737 [00:27<00:02, 338.15it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎            | 8888/9737 [00:27<00:02, 338.46it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊            | 8923/9737 [00:27<00:02, 339.32it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎           | 8958/9737 [00:27<00:02, 339.65it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊           | 8992/9737 [00:28<00:02, 337.90it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎          | 9026/9737 [00:28<00:02, 337.97it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊          | 9060/9737 [00:28<00:02, 335.96it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎         | 9094/9737 [00:28<00:01, 336.87it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 9128/9737 [00:28<00:01, 337.25it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍        | 9163/9737 [00:28<00:01, 338.11it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉        | 9198/9737 [00:28<00:01, 338.87it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍       | 9233/9737 [00:28<00:01, 339.34it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉       | 9267/9737 [00:28<00:01, 337.50it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍      | 9301/9737 [00:28<00:01, 337.62it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉      | 9336/9737 [00:29<00:01, 338.62it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍     | 9370/9737 [00:29<00:01, 339.00it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 9405/9737 [00:29<00:00, 339.58it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌    | 9439/9737 [00:29<00:00, 337.80it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████    | 9473/9737 [00:29<00:00, 331.79it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌   | 9507/9737 [00:29<00:00, 327.96it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████   | 9541/9737 [00:29<00:00, 331.23it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 9576/9737 [00:29<00:00, 333.95it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████  | 9611/9737 [00:29<00:00, 335.78it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌ | 9645/9737 [00:30<00:00, 336.92it/s] 99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏| 9679/9737 [00:30<00:00, 336.77it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋| 9713/9737 [00:30<00:00, 335.76it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9737/9737 [00:30<00:00, 321.42it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.74s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.94s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.39s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.88s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.89s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.26s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.31s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.31s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.63s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.87s/it]
[2023-08-10 21:11:41,966] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-10 21:11:48,727] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 21:11:48,728] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 21:11:48,728] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 21:11:48,728] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 21:11:48,728] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 21:11:48,728] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fcf28dc1e80>
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fcf288c5370>
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 21:11:48,729] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 21:11:48,730] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 21:11:48,730] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5142145156860352 seconds
Loading extension module utils...
Time to load utils op: 0.40447521209716797 seconds
Loading extension module utils...
Time to load utils op: 0.5047941207885742 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
Time to load utils op: 0.4043729305267334 seconds
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Where could you find some plumbing that would not be of use to you if you are thirsty? Choices:  A: oil refineries B: wall C: show D: own home E: water fountain
Rationales: Intermediate reasoning steps:

1. The question is asking where you could find some plumbing that wouldn't be useful to you if you are thirsty.
2. First, consider what the question is implying, which is that the place should have plumbing, but that plumbing doesn't contain or provide potable water, i.e., water safe to drink when you're thirsty.
3. Beginning with the given choices, option B: wall. A wall may have pipes running through it, but those pipes usually supply to some sort of outlet, which if it is for water, could be useful if you're thirsty. So, this isn't the answer.
4. Next, look at option C: show. While this is a general term, it could potentially mean a theater show or a concert where there might be water fountains or concession stands offering water. This option is too vague without a proper context and hence can't be clearly ruled out or confirmed.
5. Then there's option D: own home. In your own home, you'd have taps and faucets with running water that would be very handy if you were thirsty. So, this option is ruled out.
6. Now, consider option E: water fountain. Clearly, a water fountain would be very useful if you're thirsty, hence this is not the answer.
7. Finally, consider option A: oil refineries. Oil refineries indeed have a very complex system of plumbing. However, this plumbing is used for the processing and transport of oil and not for water. Oil is harmful if ingested, making this plumbing useless for quenching thirst. 
8. Therefore, the answer is A: oil refineries.
Answer: A: oil refineries

Input: When a person is beginning work, what aren't they doing yet? Choices:  A: working B: resting C: tiredness D: accomplishing E: momentum
Rationales: 1. The term "beginning work" signifies that a person is just about to start or has just started their work.
2. This implies that they have yet to make significant progress or achievements in the task or job they are undertaking.
3. They might be working (option A) already because they are beginning to do so.
4. They aren't likely resting (option B) since the term "beginning work" suggests they are in a phase of activity, not rest.
5. Feeling tiredness (option C) can occur at any stage, so it's not specifically related to the beginning of work.
6. The term "momentum" (option E) in this context means making progress in work. Since they are just beginning, they may be starting to gain momentum, but it's not something they're "not doing yet."
7. Therefore, by process of elimination and considering the definitions of the options in relation to the question, the answer would be D: accomplishing, because it's something that usually comes after some duration of work, not at the very beginning when a person is just starting.
Answer: D: accomplishing

Input: Where might I find pens with a company logo? Choices:  A: office B: on a pencil C: write sentences on paper D: school E: backpack
Rationales: 1. The question asks where you might find pens with a company logo.
2. The options provided are an office, on a pencil, write sentences on paper, school, and a backpack.
3. We can consider each option separately.
4. First, pens might be found in an office, especially ones with company logos as they're often provided by employers.
5. Second, pens are not usually found on pencils, let alone ones with a company logo.
6. Third, "write sentences on paper" is not a place, hence a pen cannot be found there.
7. Fourth, while pens might be found at school, they are not typically adorned with company logos.
8. Lastly, a backpack could contain pens, however, it is not specified that those pens would have a company logo.
9. Given these considerations, the most likely place to find pens with a company logo is at an office.
Answer: A: office

Input: Billy called out to John, and listened for what? Choices:  A: silence B: response C: communication D: hanging up E: whisper
Rationales: 1. The question refers to an interaction between two persons - Billy and John.
2. The interaction starts with Billy calling out to John. The "called out" phrase indicates that Billy is attempting to communicate with John.
3. The next part of the question reads "and listened for what?" This implies that after initiating the communication, Billy is expecting something in return.
4. Now, considering the options: A: silence would be the absence of response, which is not what Billy is expecting. C: communication is a broad term, and doesn't specify what Billy is listening for. D: hanging up is not applicable in this context of calling out. E: whisper - this would mean Billy is expecting a quiet response, which is very specific and the question does not hint towards this expectation.
5. So, the best answer is B: response, as Billy, after calling out to John, would naturally be listening for a response.
Answer: B: response

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i4-s1-rTrue
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:41<33:39, 41.21s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:23<33:28, 41.84s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:05<32:47, 41.87s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:47<32:10, 41.97s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:30<31:38, 42.19s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:12<31:02, 42.32s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:55<30:24, 42.44s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:37<29:40, 42.40s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:19<28:57, 42.37s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:02<28:15, 42.38s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:44<27:32, 42.38s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:26<26:48, 42.32s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:09<26:07, 42.37s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:51<25:23, 42.32s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:33<24:41, 42.33s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:16<24:01, 42.39s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:38<19:59, 36.34s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [12:20<20:17, 38.04s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [13:02<20:16, 39.25s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [13:45<20:04, 40.15s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [14:27<19:44, 40.85s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [15:09<19:12, 41.18s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [15:52<18:43, 41.60s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [16:34<18:05, 41.74s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [17:16<17:29, 41.96s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [17:58<16:47, 41.96s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:41<16:11, 42.22s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:24<15:31, 42.36s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:06<14:48, 42.31s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [20:49<14:10, 42.52s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [21:31<13:25, 42.37s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:13<12:42, 42.39s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [22:55<11:58, 42.28s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [23:33<10:55, 40.94s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:15<10:18, 41.26s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [24:57<09:41, 41.55s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [25:40<09:03, 41.80s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:14<07:53, 39.44s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [26:56<07:21, 40.16s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [27:37<06:45, 40.56s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [28:19<06:08, 40.95s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [29:01<05:29, 41.24s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [29:43<04:49, 41.40s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [30:24<04:08, 41.48s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [30:55<03:11, 38.22s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [31:36<02:36, 39.09s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [32:18<01:59, 39.95s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [33:00<01:20, 40.47s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [33:42<00:40, 40.90s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:23<00:00, 41.12s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:23<00:00, 41.27s/it]
name: commonsenseqa | {'exact_match': 2.8, 'rougeL': 5.2371} | lm_loss 7.5873 | avg. gen lenth: 303.18
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s1-rFalse --seed 1 --num-in-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 21:47:03,162] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 1
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9740 [00:00<?, ?it/s]  2%|███▎                                                                                                                                              | 225/9740 [00:00<00:04, 2247.48it/s]  5%|██████▊                                                                                                                                           | 454/9740 [00:00<00:04, 2268.64it/s]  7%|██████████▎                                                                                                                                       | 684/9740 [00:00<00:03, 2278.55it/s]  9%|█████████████▋                                                                                                                                    | 914/9740 [00:00<00:03, 2286.90it/s] 12%|█████████████████                                                                                                                                | 1146/9740 [00:00<00:03, 2295.10it/s] 14%|████████████████████▍                                                                                                                            | 1376/9740 [00:00<00:03, 2294.52it/s] 16%|███████████████████████▉                                                                                                                         | 1606/9740 [00:00<00:03, 2290.86it/s] 19%|███████████████████████████▎                                                                                                                     | 1836/9740 [00:00<00:03, 2275.73it/s] 21%|██████████████████████████████▋                                                                                                                  | 2064/9740 [00:00<00:03, 2221.57it/s] 24%|██████████████████████████████████                                                                                                               | 2291/9740 [00:01<00:03, 2234.34it/s] 26%|█████████████████████████████████████▌                                                                                                           | 2520/9740 [00:01<00:03, 2248.76it/s] 28%|████████████████████████████████████████▉                                                                                                        | 2748/9740 [00:01<00:03, 2256.21it/s] 31%|████████████████████████████████████████████▎                                                                                                    | 2976/9740 [00:01<00:02, 2261.85it/s] 33%|███████████████████████████████████████████████▋                                                                                                 | 3205/9740 [00:01<00:02, 2268.95it/s] 35%|███████████████████████████████████████████████████▏                                                                                             | 3435/9740 [00:01<00:02, 2275.38it/s] 38%|██████████████████████████████████████████████████████▌                                                                                          | 3663/9740 [00:01<00:02, 2273.73it/s] 40%|█████████████████████████████████████████████████████████▉                                                                                       | 3893/9740 [00:01<00:02, 2281.13it/s] 42%|█████████████████████████████████████████████████████████████▍                                                                                   | 4123/9740 [00:01<00:02, 2285.30it/s] 45%|████████████████████████████████████████████████████████████████▊                                                                                | 4352/9740 [00:01<00:02, 2273.73it/s] 47%|████████████████████████████████████████████████████████████████████▏                                                                            | 4580/9740 [00:02<00:02, 2238.17it/s] 49%|███████████████████████████████████████████████████████████████████████▌                                                                         | 4804/9740 [00:02<00:03, 1637.95it/s] 52%|███████████████████████████████████████████████████████████████████████████▋                                                                     | 5084/9740 [00:02<00:02, 1911.62it/s] 56%|████████████████████████████████████████████████████████████████████████████████▊                                                                | 5430/9740 [00:02<00:01, 2301.49it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▏                                                          | 5791/9740 [00:02<00:01, 2647.05it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▌                                                     | 6154/9740 [00:02<00:01, 2915.12it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████                                                | 6518/9740 [00:02<00:01, 3117.38it/s] 71%|██████████████████████████████████████████████████████████████████████████████████████████████████████▍                                          | 6882/9740 [00:02<00:00, 3266.41it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                     | 7246/9740 [00:02<00:00, 3372.85it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                | 7591/9740 [00:03<00:00, 3374.72it/s] 82%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                          | 7950/9740 [00:03<00:00, 3436.84it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                     | 8302/9740 [00:03<00:00, 3460.81it/s] 89%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                | 8664/9740 [00:03<00:00, 3507.33it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍          | 9029/9740 [00:03<00:00, 3547.24it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋     | 9387/9740 [00:03<00:00, 3555.51it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9740/9740 [00:03<00:00, 2669.71it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.50s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.43s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.70s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.35s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.57s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.59s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.58s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.89s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.09s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.10s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.22s/it]
[2023-08-10 21:47:59,846] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.16s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.25s/it]
[2023-08-10 21:48:11,954] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 21:48:11,954] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 21:48:11,955] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 21:48:11,955] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 21:48:11,955] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 21:48:11,955] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 21:48:11,955] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 21:48:11,955] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 21:48:11,955] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 21:48:11,955] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 21:48:11,955] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 21:48:11,955] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fee6e38fe80>
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fee8ce40910>
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 21:48:11,956] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 21:48:11,957] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 21:48:11,957] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 21:48:11,957] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 21:48:11,957] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.37891411781311035 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Where could you find some plumbing that would not be of use to you if you are thirsty? Choices:  A: oil refineries B: wall C: show D: own home E: water fountain
Answer: A: oil refineries

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.30703067779541016 seconds
Loading extension module utils...
Time to load utils op: 0.3041355609893799 seconds
Loading extension module utils...
Time to load utils op: 0.4042658805847168 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:17<14:18, 17.51s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:15<33:07, 41.42s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:13<38:13, 48.79s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:10<39:58, 52.15s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:07<40:28, 53.96s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [05:06<40:43, 55.54s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [06:04<40:30, 56.53s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [07:02<39:52, 56.97s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [08:00<39:11, 57.36s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:26<31:36, 47.42s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [09:23<32:48, 50.46s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [10:22<33:41, 53.20s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [11:21<33:43, 54.69s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [12:19<33:31, 55.87s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [12:41<26:38, 45.68s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [13:05<22:12, 39.19s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [13:31<19:14, 34.99s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [14:28<22:13, 41.68s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:57<19:35, 37.93s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:45<20:23, 40.79s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:38<21:30, 44.49s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:58<17:26, 37.37s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:21<14:46, 32.83s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:18<17:27, 40.30s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:57<16:32, 39.69s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:38<16:01, 40.05s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:16<15:07, 39.46s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [20:42<13:01, 35.53s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [21:06<11:12, 32.04s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:04<13:15, 39.75s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [22:40<12:14, 38.68s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [23:29<12:31, 41.76s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [24:26<13:11, 46.53s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:24<13:18, 49.91s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:11<12:14, 48.94s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [27:09<12:04, 51.76s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [28:07<11:34, 53.45s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [29:04<10:57, 54.77s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [30:02<10:13, 55.74s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [30:58<09:16, 55.64s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [31:53<08:19, 55.52s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [32:35<06:52, 51.53s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [33:32<06:11, 53.02s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [34:14<04:58, 49.75s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [35:12<04:20, 52.10s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [35:46<03:07, 46.89s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [36:45<02:30, 50.32s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [37:43<01:45, 52.65s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [38:41<00:54, 54.43s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:28<00:00, 52.07s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:28<00:00, 47.37s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 5.0835} | lm_loss 7.301 | avg. gen lenth: 183.864
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s1-rFalse --seed 1 --num-in-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 22:27:46,888] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 2
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9739 [00:00<?, ?it/s]  2%|██▋                                                                                                                                               | 183/9739 [00:00<00:05, 1829.87it/s]  4%|█████▌                                                                                                                                            | 367/9739 [00:00<00:05, 1835.43it/s]  6%|████████▎                                                                                                                                         | 553/9739 [00:00<00:04, 1842.13it/s]  8%|███████████                                                                                                                                       | 738/9739 [00:00<00:04, 1845.03it/s]  9%|█████████████▊                                                                                                                                    | 925/9739 [00:00<00:04, 1852.24it/s] 11%|████████████████▌                                                                                                                                | 1111/9739 [00:00<00:04, 1854.72it/s] 13%|███████████████████▎                                                                                                                             | 1297/9739 [00:00<00:04, 1854.83it/s] 15%|██████████████████████                                                                                                                           | 1483/9739 [00:00<00:04, 1851.97it/s] 17%|████████████████████████▊                                                                                                                        | 1669/9739 [00:00<00:04, 1853.29it/s] 19%|███████████████████████████▌                                                                                                                     | 1855/9739 [00:01<00:04, 1781.86it/s] 21%|██████████████████████████████▎                                                                                                                  | 2039/9739 [00:01<00:04, 1797.57it/s] 23%|█████████████████████████████████                                                                                                                | 2224/9739 [00:01<00:04, 1812.64it/s] 25%|███████████████████████████████████▉                                                                                                             | 2410/9739 [00:01<00:04, 1825.06it/s] 27%|██████████████████████████████████████▋                                                                                                          | 2595/9739 [00:01<00:03, 1830.22it/s] 29%|█████████████████████████████████████████▍                                                                                                       | 2779/9739 [00:01<00:03, 1828.30it/s] 30%|████████████████████████████████████████████▏                                                                                                    | 2964/9739 [00:01<00:03, 1832.61it/s] 32%|██████████████████████████████████████████████▉                                                                                                  | 3149/9739 [00:01<00:03, 1837.01it/s] 34%|█████████████████████████████████████████████████▋                                                                                               | 3335/9739 [00:01<00:03, 1841.83it/s] 36%|████████████████████████████████████████████████████▍                                                                                            | 3520/9739 [00:01<00:03, 1840.57it/s] 38%|███████████████████████████████████████████████████████▏                                                                                         | 3705/9739 [00:02<00:03, 1833.91it/s] 40%|██████████████████████████████████████████████████████████▍                                                                                      | 3927/9739 [00:02<00:02, 1947.20it/s] 43%|██████████████████████████████████████████████████████████████▋                                                                                  | 4210/9739 [00:02<00:02, 2209.00it/s] 46%|██████████████████████████████████████████████████████████████████▉                                                                              | 4492/9739 [00:02<00:02, 2389.68it/s] 49%|██████████████████████████████████████████████████████████████████████▌                                                                          | 4740/9739 [00:02<00:02, 1938.88it/s] 52%|██████████████████████████████████████████████████████████████████████████▋                                                                      | 5018/9739 [00:02<00:02, 2152.33it/s] 54%|██████████████████████████████████████████████████████████████████████████████▉                                                                  | 5299/9739 [00:02<00:01, 2326.36it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▏                                                             | 5584/9739 [00:02<00:01, 2470.30it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▌                                                         | 5878/9739 [00:02<00:01, 2601.62it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▉                                                     | 6175/9739 [00:03<00:01, 2706.21it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▎                                                | 6470/9739 [00:03<00:01, 2775.93it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▋                                            | 6766/9739 [00:03<00:01, 2828.15it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                       | 7065/9739 [00:03<00:00, 2874.67it/s] 76%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                   | 7364/9739 [00:03<00:00, 2906.06it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████                               | 7657/9739 [00:03<00:00, 2898.40it/s] 82%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                          | 7954/9739 [00:03<00:00, 2919.12it/s] 85%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                      | 8252/9739 [00:03<00:00, 2936.99it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                 | 8549/9739 [00:03<00:00, 2945.76it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋             | 8844/9739 [00:03<00:00, 2941.52it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████         | 9141/9739 [00:04<00:00, 2947.39it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌    | 9438/9739 [00:04<00:00, 2953.14it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉| 9734/9739 [00:04<00:00, 2950.18it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9739/9739 [00:04<00:00, 2312.50it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.95s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.25s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.56s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.54s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.93s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.30s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.29s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]
[2023-08-10 22:28:41,609] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.62s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.73s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.93s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.87s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]
[2023-08-10 22:28:53,469] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 22:28:53,470] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f7551817e80>
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 22:28:53,471] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f75518e0910>
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 22:28:53,472] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 22:28:53,473] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 22:28:53,473] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.36029767990112305 seconds
Loading extension module utils...
Time to load utils op: 0.2039937973022461 seconds
Loading extension module utils...
Time to load utils op: 0.3042287826538086 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Where could you find some plumbing that would not be of use to you if you are thirsty? Choices:  A: oil refineries B: wall C: show D: own home E: water fountain
Answer: A: oil refineries

Input: When a person is beginning work, what aren't they doing yet? Choices:  A: working B: resting C: tiredness D: accomplishing E: momentum
Answer: D: accomplishing

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.40455126762390137 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:57<47:18, 57.93s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:42<40:04, 50.09s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:33<39:32, 50.48s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:57<30:45, 40.12s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:54<34:31, 46.04s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:05<25:01, 34.13s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:02<29:53, 41.72s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:50<30:38, 43.78s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:27<28:25, 41.60s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:24<30:46, 46.17s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:05<29:08, 44.84s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:48<27:57, 44.14s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:44<29:23, 47.67s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:31<28:32, 47.58s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:13<26:42, 45.79s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:39<22:42, 40.06s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:36<24:47, 45.09s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:07<21:49, 40.93s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [13:39<19:37, 38.00s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:26<20:28, 40.96s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:23<22:01, 45.58s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:20<22:50, 48.93s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [16:52<19:47, 44.00s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [17:27<17:55, 41.38s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [17:39<13:30, 32.43s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [18:36<15:57, 39.89s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:54<12:46, 33.32s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:21<11:27, 31.26s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:17<13:34, 38.78s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:13<14:40, 44.05s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [21:50<13:16, 41.93s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:27<12:07, 40.44s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:14<12:00, 42.40s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [24:01<11:37, 43.57s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:45<10:58, 43.90s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [25:22<09:44, 41.74s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [25:37<07:19, 33.81s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:34<08:07, 40.65s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [27:30<08:17, 45.27s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [28:27<08:09, 48.93s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [29:14<07:14, 48.33s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [29:34<05:17, 39.74s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [30:17<04:45, 40.78s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [31:13<04:31, 45.23s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [31:33<03:08, 37.76s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [32:20<02:42, 40.62s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [33:09<02:09, 43.11s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [33:52<01:26, 43.04s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [34:50<00:47, 47.35s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:23<00:00, 43.03s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:23<00:00, 42.46s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.812} | lm_loss 7.1342 | avg. gen lenth: 160.972
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i3-s1-rFalse --seed 1 --num-in-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 23:07:50,834] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i3-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 3
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i3-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9738 [00:00<?, ?it/s]  2%|██▎                                                                                                                                               | 153/9738 [00:00<00:06, 1525.59it/s]  3%|████▌                                                                                                                                             | 306/9738 [00:00<00:06, 1525.70it/s]  5%|██████▉                                                                                                                                           | 461/9738 [00:00<00:06, 1533.29it/s]  6%|█████████▏                                                                                                                                        | 616/9738 [00:00<00:05, 1536.44it/s]  8%|███████████▌                                                                                                                                      | 770/9738 [00:00<00:05, 1535.24it/s] 10%|█████████████▉                                                                                                                                    | 926/9738 [00:00<00:05, 1540.94it/s] 11%|████████████████                                                                                                                                 | 1082/9738 [00:00<00:05, 1546.03it/s] 13%|██████████████████▍                                                                                                                              | 1237/9738 [00:00<00:05, 1536.10it/s] 14%|████████████████████▋                                                                                                                            | 1391/9738 [00:00<00:05, 1500.49it/s] 16%|███████████████████████                                                                                                                          | 1545/9738 [00:01<00:05, 1510.58it/s] 17%|█████████████████████████▎                                                                                                                       | 1700/9738 [00:01<00:05, 1519.38it/s] 19%|███████████████████████████▌                                                                                                                     | 1853/9738 [00:01<00:05, 1491.98it/s] 21%|█████████████████████████████▉                                                                                                                   | 2007/9738 [00:01<00:05, 1505.48it/s] 22%|████████████████████████████████▏                                                                                                                | 2160/9738 [00:01<00:05, 1511.30it/s] 24%|███████████████████████████████████▎                                                                                                             | 2370/9738 [00:01<00:04, 1685.20it/s] 27%|██████████████████████████████████████▊                                                                                                          | 2605/9738 [00:01<00:03, 1882.21it/s] 29%|██████████████████████████████████████████▏                                                                                                      | 2836/9738 [00:01<00:03, 2009.40it/s] 31%|█████████████████████████████████████████████▋                                                                                                   | 3066/9738 [00:01<00:03, 2095.93it/s] 34%|█████████████████████████████████████████████████                                                                                                | 3296/9738 [00:01<00:02, 2154.16it/s] 36%|████████████████████████████████████████████████████▌                                                                                            | 3527/9738 [00:02<00:02, 2200.72it/s] 39%|████████████████████████████████████████████████████████                                                                                         | 3761/9738 [00:02<00:02, 2242.10it/s] 41%|███████████████████████████████████████████████████████████▌                                                                                     | 3996/9738 [00:02<00:02, 2272.06it/s] 43%|██████████████████████████████████████████████████████████████▉                                                                                  | 4229/9738 [00:02<00:02, 2288.55it/s] 46%|██████████████████████████████████████████████████████████████████▍                                                                              | 4458/9738 [00:02<00:02, 2232.30it/s] 48%|█████████████████████████████████████████████████████████████████████▋                                                                           | 4682/9738 [00:02<00:02, 2221.95it/s] 50%|█████████████████████████████████████████████████████████████████████████                                                                        | 4905/9738 [00:02<00:02, 1743.86it/s] 53%|████████████████████████████████████████████████████████████████████████████▍                                                                    | 5136/9738 [00:02<00:02, 1883.12it/s] 55%|███████████████████████████████████████████████████████████████████████████████▉                                                                 | 5366/9738 [00:02<00:02, 1990.28it/s] 58%|███████████████████████████████████████████████████████████████████████████████████▍                                                             | 5603/9738 [00:03<00:01, 2091.91it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████                                                          | 5845/9738 [00:03<00:01, 2183.39it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▌                                                      | 6079/9738 [00:03<00:01, 2227.82it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████                                                   | 6320/9738 [00:03<00:01, 2279.01it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▋                                               | 6562/9738 [00:03<00:01, 2318.42it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▎                                           | 6807/9738 [00:03<00:01, 2354.38it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████                                        | 7053/9738 [00:03<00:01, 2382.60it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                    | 7298/9738 [00:03<00:01, 2399.84it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                | 7539/9738 [00:03<00:00, 2376.59it/s] 80%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                             | 7778/9738 [00:03<00:00, 2376.21it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                         | 8017/9738 [00:04<00:00, 2378.76it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                      | 8263/9738 [00:04<00:00, 2401.66it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                  | 8508/9738 [00:04<00:00, 2415.72it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎              | 8751/9738 [00:04<00:00, 2419.60it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉           | 8994/9738 [00:04<00:00, 2415.51it/s] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 9236/9738 [00:04<00:00, 2380.48it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏   | 9480/9738 [00:04<00:00, 2397.80it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊| 9723/9738 [00:04<00:00, 2406.23it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9738/9738 [00:04<00:00, 2051.23it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.41s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.90s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:06<00:12,  6.23s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.77s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.64s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:13<00:06,  6.85s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.83s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.98s/it]
[2023-08-10 23:08:47,981] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.75s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.86s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.13s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:19<00:00,  6.41s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:19<00:00,  6.44s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.68s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.70s/it]
[2023-08-10 23:09:08,919] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 23:09:08,920] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 23:09:08,921] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 23:09:08,921] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 23:09:08,921] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 23:09:08,921] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 23:09:08,921] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 23:09:08,921] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fda6c836e80>
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 23:09:08,922] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fda6c2b8910>
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 23:09:08,923] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 23:09:08,923] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4353451728820801 seconds
Loading extension module utils...
Time to load utils op: 0.40480566024780273 seconds
Loading extension module utils...
Time to load utils op: 0.5048642158508301 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]Time to load utils op: 0.5047883987426758 seconds
############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Where could you find some plumbing that would not be of use to you if you are thirsty? Choices:  A: oil refineries B: wall C: show D: own home E: water fountain
Answer: A: oil refineries

Input: When a person is beginning work, what aren't they doing yet? Choices:  A: working B: resting C: tiredness D: accomplishing E: momentum
Answer: D: accomplishing

Input: Where might I find pens with a company logo? Choices:  A: office B: on a pencil C: write sentences on paper D: school E: backpack
Answer: A: office

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i3-s1-rFalse
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:47<39:00, 47.76s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:23<32:43, 40.91s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [01:43<24:30, 31.29s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:02<20:08, 26.28s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [02:58<27:54, 37.21s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [03:52<31:27, 42.90s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:43<32:35, 45.47s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:34<33:07, 47.32s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:00<27:39, 40.49s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [06:25<23:45, 35.63s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:15<26:10, 40.26s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [07:43<23:09, 36.55s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [08:05<19:45, 32.04s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [08:46<20:47, 34.65s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [09:42<24:02, 41.21s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [10:24<23:26, 41.38s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [10:43<19:01, 34.60s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [10:58<15:22, 28.84s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [11:55<19:11, 37.14s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [12:48<21:01, 42.03s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [13:43<22:13, 46.00s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [14:38<22:38, 48.53s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [15:16<20:23, 45.32s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [15:30<15:39, 36.12s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [16:19<16:40, 40.01s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [17:07<16:55, 42.33s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:03<17:50, 46.52s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [18:14<13:06, 35.76s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [18:41<11:36, 33.16s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [19:32<12:49, 38.46s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [20:29<13:54, 43.90s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [21:25<14:16, 47.56s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [21:51<11:39, 41.13s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [22:35<11:11, 41.96s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [23:04<09:30, 38.01s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [23:58<10:02, 43.05s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [24:55<10:13, 47.20s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [25:31<08:45, 43.76s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [26:28<08:44, 47.67s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [27:23<08:18, 49.90s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [27:47<06:20, 42.28s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [28:46<06:17, 47.19s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [29:41<05:47, 49.64s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [30:17<04:32, 45.35s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [30:48<03:25, 41.16s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [31:44<03:02, 45.64s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [32:39<02:25, 48.43s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [33:35<01:41, 50.67s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [34:30<00:51, 51.93s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:26<00:00, 53.10s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:26<00:00, 42.52s/it]
name: commonsenseqa | {'exact_match': 1.6, 'rougeL': 5.7874} | lm_loss 7.192 | avg. gen lenth: 165.928
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i4-s1-rFalse --seed 1 --num-in-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 23:45:59,553] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i4-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 4
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i4-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9737 [00:00<?, ?it/s]  1%|█▉                                                                                                                                                | 129/9737 [00:00<00:07, 1283.06it/s]  3%|███▊                                                                                                                                              | 258/9737 [00:00<00:07, 1286.86it/s]  4%|█████▊                                                                                                                                            | 389/9737 [00:00<00:07, 1294.68it/s]  5%|███████▊                                                                                                                                          | 519/9737 [00:00<00:07, 1295.26it/s]  7%|█████████▋                                                                                                                                        | 649/9737 [00:00<00:07, 1296.55it/s]  8%|███████████▋                                                                                                                                      | 779/9737 [00:00<00:06, 1295.62it/s]  9%|█████████████▋                                                                                                                                    | 910/9737 [00:00<00:06, 1297.93it/s] 11%|███████████████▌                                                                                                                                 | 1041/9737 [00:00<00:06, 1301.46it/s] 12%|█████████████████▍                                                                                                                               | 1172/9737 [00:00<00:06, 1302.12it/s] 13%|███████████████████▍                                                                                                                             | 1303/9737 [00:01<00:06, 1275.67it/s] 15%|█████████████████████▎                                                                                                                           | 1432/9737 [00:01<00:06, 1277.78it/s] 16%|███████████████████████▎                                                                                                                         | 1563/9737 [00:01<00:06, 1283.90it/s] 17%|█████████████████████████▏                                                                                                                       | 1694/9737 [00:01<00:06, 1289.51it/s] 19%|███████████████████████████▏                                                                                                                     | 1823/9737 [00:01<00:06, 1263.03it/s] 20%|█████████████████████████████                                                                                                                    | 1953/9737 [00:01<00:06, 1271.88it/s] 21%|███████████████████████████████                                                                                                                  | 2082/9737 [00:01<00:06, 1275.78it/s] 23%|████████████████████████████████▉                                                                                                                | 2212/9737 [00:01<00:05, 1282.70it/s] 24%|██████████████████████████████████▉                                                                                                              | 2342/9737 [00:01<00:05, 1285.17it/s] 25%|████████████████████████████████████▊                                                                                                            | 2472/9737 [00:01<00:05, 1289.04it/s] 27%|██████████████████████████████████████▋                                                                                                          | 2601/9737 [00:02<00:05, 1284.69it/s] 28%|████████████████████████████████████████▋                                                                                                        | 2730/9737 [00:02<00:05, 1281.55it/s] 30%|███████████████████████████████████████████                                                                                                      | 2893/9737 [00:02<00:04, 1384.41it/s] 32%|█████████████████████████████████████████████▉                                                                                                   | 3087/9737 [00:02<00:04, 1548.31it/s] 34%|████████████████████████████████████████████████▊                                                                                                | 3276/9737 [00:02<00:03, 1648.10it/s] 36%|███████████████████████████████████████████████████▌                                                                                             | 3462/9737 [00:02<00:03, 1711.21it/s] 38%|██████████████████████████████████████████████████████▍                                                                                          | 3657/9737 [00:02<00:03, 1779.87it/s] 40%|█████████████████████████████████████████████████████████▍                                                                                       | 3855/9737 [00:02<00:03, 1837.90it/s] 42%|████████████████████████████████████████████████████████████▎                                                                                    | 4051/9737 [00:02<00:03, 1873.95it/s] 44%|███████████████████████████████████████████████████████████████▏                                                                                 | 4246/9737 [00:02<00:02, 1896.32it/s] 46%|██████████████████████████████████████████████████████████████████▏                                                                              | 4442/9737 [00:03<00:02, 1915.25it/s] 48%|█████████████████████████████████████████████████████████████████████                                                                            | 4634/9737 [00:03<00:02, 1895.07it/s] 50%|███████████████████████████████████████████████████████████████████████▊                                                                         | 4824/9737 [00:03<00:03, 1425.18it/s] 52%|██████████████████████████████████████████████████████████████████████████▊                                                                      | 5020/9737 [00:03<00:03, 1553.06it/s] 54%|█████████████████████████████████████████████████████████████████████████████▋                                                                   | 5213/9737 [00:03<00:02, 1648.06it/s] 56%|████████████████████████████████████████████████████████████████████████████████▍                                                                | 5405/9737 [00:03<00:02, 1719.61it/s] 58%|███████████████████████████████████████████████████████████████████████████████████▍                                                             | 5607/9737 [00:03<00:02, 1800.81it/s] 60%|██████████████████████████████████████████████████████████████████████████████████████▌                                                          | 5813/9737 [00:03<00:02, 1873.39it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▌                                                       | 6016/9737 [00:03<00:01, 1916.78it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▋                                                    | 6222/9737 [00:04<00:01, 1955.77it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▋                                                 | 6427/9737 [00:04<00:01, 1982.39it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▋                                              | 6631/9737 [00:04<00:01, 1997.56it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▊                                           | 6837/9737 [00:04<00:01, 2016.00it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                        | 7040/9737 [00:04<00:01, 2017.11it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                     | 7246/9737 [00:04<00:01, 2029.09it/s] 77%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                  | 7450/9737 [00:04<00:01, 1936.67it/s] 79%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                               | 7650/9737 [00:04<00:01, 1952.51it/s] 81%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                            | 7853/9737 [00:04<00:00, 1973.01it/s] 83%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                         | 8058/9737 [00:04<00:00, 1995.01it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                      | 8265/9737 [00:05<00:00, 2015.33it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                  | 8470/9737 [00:05<00:00, 2025.19it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏               | 8675/9737 [00:05<00:00, 2031.55it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏            | 8879/9737 [00:05<00:00, 2033.25it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎         | 9083/9737 [00:05<00:00, 2028.25it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎      | 9287/9737 [00:05<00:00, 2030.14it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎   | 9491/9737 [00:05<00:00, 2031.53it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎| 9695/9737 [00:05<00:00, 2028.23it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9737/9737 [00:05<00:00, 1682.55it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.54s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.58s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:06<00:12,  6.05s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.73s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.36s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.61s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.49s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.85s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.65s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.84s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.04s/it]
[2023-08-10 23:46:58,035] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.99s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.30s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.47s/it]
[2023-08-10 23:47:15,586] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 23:47:15,587] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 23:47:15,588] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 23:47:15,588] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 23:47:15,588] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 23:47:15,588] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fd2c96a5e80>
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 23:47:15,589] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fd2c917c910>
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 23:47:15,590] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 23:47:15,591] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 23:47:15,591] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 23:47:15,591] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 23:47:15,591] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3791391849517822 seconds
Loading extension module utils...
Time to load utils op: 0.20421934127807617 seconds
Loading extension module utils...
Time to load utils op: 0.404491662979126 seconds
Loading extension module utils...
Time to load utils op: 0.30451273918151855 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Where could you find some plumbing that would not be of use to you if you are thirsty? Choices:  A: oil refineries B: wall C: show D: own home E: water fountain
Answer: A: oil refineries

Input: When a person is beginning work, what aren't they doing yet? Choices:  A: working B: resting C: tiredness D: accomplishing E: momentum
Answer: D: accomplishing

Input: Where might I find pens with a company logo? Choices:  A: office B: on a pencil C: write sentences on paper D: school E: backpack
Answer: A: office

Input: Billy called out to John, and listened for what? Choices:  A: silence B: response C: communication D: hanging up E: whisper
Answer: B: response

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i4-s1-rFalse
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:24<20:05, 24.60s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:19<33:56, 42.43s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:14<37:51, 48.33s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:55<34:35, 45.12s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:49<36:27, 48.61s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:24<32:15, 43.99s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:59<29:21, 40.97s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:36<27:44, 39.64s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [05:58<23:16, 34.06s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [06:51<26:43, 40.09s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:14<22:32, 34.67s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [07:36<19:30, 30.81s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [08:03<18:26, 29.90s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:00<22:41, 37.82s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [09:54<25:01, 42.91s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [10:22<21:41, 38.27s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:05<21:50, 39.71s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [11:30<18:51, 35.35s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [12:26<21:23, 41.41s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [13:02<19:57, 39.91s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [13:57<21:25, 44.32s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [14:51<22:09, 47.47s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [15:16<18:18, 40.68s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [16:04<18:32, 42.80s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [16:35<16:21, 39.27s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [17:31<17:42, 44.25s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:26<18:12, 47.50s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:21<18:17, 49.88s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:18<18:08, 51.83s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:14<17:43, 53.19s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [22:03<16:26, 51.92s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:55<15:33, 51.84s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:22<12:35, 44.46s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [24:09<12:04, 45.25s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:37<10:00, 40.00s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [25:32<10:22, 44.44s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [26:00<08:35, 39.67s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:23<06:56, 34.75s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [26:55<06:11, 33.74s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [27:50<06:41, 40.15s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [28:45<06:42, 44.72s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [29:40<06:21, 47.67s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [29:52<04:18, 36.89s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [30:47<04:14, 42.44s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [31:22<03:21, 40.28s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [31:46<02:21, 35.37s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [32:26<01:50, 36.85s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [33:06<01:15, 37.51s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [34:00<00:42, 42.50s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:30<00:00, 38.75s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:30<00:00, 41.40s/it]
name: commonsenseqa | {'exact_match': 0.8, 'rougeL': 4.2863} | lm_loss 7.2717 | avg. gen lenth: 171.64
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s10-rTrue --seed 10 --rationales --num-in-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 00:23:42,999] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 1
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9740 [00:00<?, ?it/s]  1%|█▎                                                                                                                                                  | 85/9740 [00:00<00:11, 840.92it/s]  2%|██▌                                                                                                                                                | 171/9740 [00:00<00:11, 846.92it/s]  3%|███▊                                                                                                                                               | 256/9740 [00:00<00:11, 843.86it/s]  4%|█████▏                                                                                                                                             | 342/9740 [00:00<00:11, 847.45it/s]  4%|██████▍                                                                                                                                            | 427/9740 [00:00<00:10, 847.07it/s]  5%|███████▋                                                                                                                                           | 513/9740 [00:00<00:10, 848.96it/s]  6%|█████████                                                                                                                                          | 598/9740 [00:00<00:10, 849.20it/s]  7%|██████████▎                                                                                                                                        | 683/9740 [00:00<00:10, 848.26it/s]  8%|███████████▌                                                                                                                                       | 769/9740 [00:00<00:10, 849.17it/s]  9%|████████████▉                                                                                                                                      | 855/9740 [00:01<00:10, 851.14it/s] 10%|██████████████▏                                                                                                                                    | 941/9740 [00:01<00:10, 848.35it/s] 11%|███████████████▍                                                                                                                                  | 1026/9740 [00:01<00:10, 835.41it/s] 11%|████████████████▋                                                                                                                                 | 1110/9740 [00:01<00:10, 836.14it/s] 12%|█████████████████▉                                                                                                                                | 1195/9740 [00:01<00:10, 839.83it/s] 13%|███████████████████▏                                                                                                                              | 1280/9740 [00:01<00:10, 841.78it/s] 14%|████████████████████▍                                                                                                                             | 1365/9740 [00:01<00:09, 842.19it/s] 15%|█████████████████████▋                                                                                                                            | 1450/9740 [00:01<00:09, 843.69it/s] 16%|███████████████████████                                                                                                                           | 1535/9740 [00:01<00:09, 845.03it/s] 17%|████████████████████████▎                                                                                                                         | 1620/9740 [00:01<00:09, 843.85it/s] 18%|█████████████████████████▌                                                                                                                        | 1705/9740 [00:02<00:09, 845.21it/s] 18%|██████████████████████████▊                                                                                                                       | 1790/9740 [00:02<00:09, 821.43it/s] 19%|████████████████████████████                                                                                                                      | 1873/9740 [00:02<00:09, 822.88it/s] 20%|█████████████████████████████▎                                                                                                                    | 1958/9740 [00:02<00:09, 829.59it/s] 21%|██████████████████████████████▌                                                                                                                   | 2043/9740 [00:02<00:09, 833.00it/s] 22%|███████████████████████████████▉                                                                                                                  | 2128/9740 [00:02<00:09, 835.86it/s] 23%|█████████████████████████████████▊                                                                                                                | 2255/9740 [00:02<00:07, 963.67it/s] 24%|███████████████████████████████████▌                                                                                                             | 2385/9740 [00:02<00:06, 1062.77it/s] 26%|█████████████████████████████████████▍                                                                                                           | 2514/9740 [00:02<00:06, 1130.49it/s] 27%|███████████████████████████████████████▎                                                                                                         | 2644/9740 [00:02<00:06, 1179.66it/s] 28%|█████████████████████████████████████████▎                                                                                                       | 2773/9740 [00:03<00:05, 1211.24it/s] 30%|███████████████████████████████████████████▏                                                                                                     | 2903/9740 [00:03<00:05, 1236.97it/s] 31%|█████████████████████████████████████████████▏                                                                                                   | 3033/9740 [00:03<00:05, 1253.30it/s] 32%|███████████████████████████████████████████████                                                                                                  | 3162/9740 [00:03<00:05, 1263.03it/s] 34%|█████████████████████████████████████████████████                                                                                                | 3293/9740 [00:03<00:05, 1274.16it/s] 35%|██████████████████████████████████████████████████▉                                                                                              | 3422/9740 [00:03<00:04, 1278.32it/s] 36%|████████████████████████████████████████████████████▉                                                                                            | 3552/9740 [00:03<00:04, 1282.82it/s] 38%|██████████████████████████████████████████████████████▊                                                                                          | 3681/9740 [00:03<00:04, 1280.49it/s] 39%|████████████████████████████████████████████████████████▋                                                                                        | 3811/9740 [00:03<00:04, 1284.75it/s] 40%|██████████████████████████████████████████████████████████▋                                                                                      | 3940/9740 [00:03<00:04, 1285.43it/s] 42%|████████████████████████████████████████████████████████████▌                                                                                    | 4069/9740 [00:04<00:04, 1284.25it/s] 43%|██████████████████████████████████████████████████████████████▍                                                                                  | 4198/9740 [00:04<00:04, 1283.65it/s] 44%|████████████████████████████████████████████████████████████████▍                                                                                | 4327/9740 [00:04<00:04, 1284.09it/s] 46%|██████████████████████████████████████████████████████████████████▎                                                                              | 4457/9740 [00:04<00:04, 1286.70it/s] 47%|████████████████████████████████████████████████████████████████████▎                                                                            | 4586/9740 [00:04<00:04, 1256.76it/s] 48%|██████████████████████████████████████████████████████████████████████▏                                                                          | 4716/9740 [00:04<00:03, 1268.50it/s] 50%|████████████████████████████████████████████████████████████████████████                                                                         | 4843/9740 [00:04<00:04, 1005.12it/s] 51%|█████████████████████████████████████████████████████████████████████████▉                                                                       | 4968/9740 [00:04<00:04, 1065.95it/s] 52%|███████████████████████████████████████████████████████████████████████████▉                                                                     | 5097/9740 [00:04<00:04, 1124.76it/s] 54%|█████████████████████████████████████████████████████████████████████████████▊                                                                   | 5226/9740 [00:05<00:03, 1168.38it/s] 55%|███████████████████████████████████████████████████████████████████████████████▋                                                                 | 5355/9740 [00:05<00:03, 1202.51it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▋                                                               | 5484/9740 [00:05<00:03, 1224.94it/s] 58%|███████████████████████████████████████████████████████████████████████████████████▋                                                             | 5619/9740 [00:05<00:03, 1260.54it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▋                                                           | 5754/9740 [00:05<00:03, 1285.17it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▋                                                         | 5888/9740 [00:05<00:02, 1300.98it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▋                                                       | 6024/9740 [00:05<00:02, 1315.76it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▋                                                     | 6158/9740 [00:05<00:02, 1321.68it/s] 65%|█████████████████████████████████████████████████████████████████████████████████████████████▋                                                   | 6293/9740 [00:05<00:02, 1329.34it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▋                                                 | 6427/9740 [00:05<00:02, 1330.67it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▋                                               | 6561/9740 [00:06<00:02, 1332.52it/s] 69%|███████████████████████████████████████████████████████████████████████████████████████████████████▋                                             | 6695/9740 [00:06<00:02, 1321.38it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                                           | 6829/9740 [00:06<00:02, 1326.31it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▋                                         | 6964/9740 [00:06<00:02, 1332.62it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                       | 7099/9740 [00:06<00:01, 1334.94it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                     | 7234/9740 [00:06<00:01, 1336.63it/s] 76%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                   | 7370/9740 [00:06<00:01, 1341.12it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 7505/9740 [00:06<00:01, 1304.63it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                               | 7639/9740 [00:06<00:01, 1314.10it/s] 80%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                             | 7773/9740 [00:06<00:01, 1319.66it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 7908/9740 [00:07<00:01, 1325.92it/s] 83%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                         | 8043/9740 [00:07<00:01, 1331.08it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                       | 8178/9740 [00:07<00:01, 1333.85it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                     | 8313/9740 [00:07<00:01, 1336.64it/s] 87%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                   | 8447/9740 [00:07<00:00, 1322.11it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 8581/9740 [00:07<00:00, 1324.56it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊               | 8716/9740 [00:07<00:00, 1329.44it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 8850/9740 [00:07<00:00, 1330.56it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊           | 8985/9740 [00:07<00:00, 1334.75it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 9119/9740 [00:07<00:00, 1335.58it/s] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊       | 9254/9740 [00:08<00:00, 1338.16it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊     | 9388/9740 [00:08<00:00, 1337.03it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊   | 9522/9740 [00:08<00:00, 1337.05it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊ | 9657/9740 [00:08<00:00, 1338.83it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9740/9740 [00:08<00:00, 1155.32it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.41s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.24s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.97s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.42s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.30s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.43s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.59s/it]
[2023-08-11 00:24:42,883] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.88s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.03s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
[2023-08-11 00:24:53,298] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 00:24:53,298] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f09301f6e80>
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 00:24:53,299] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f090eed2910>
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 00:24:53,300] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 00:24:53,300] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3553926944732666 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Fabric is cut to order at what type of seller? Choices:  A: curtains B: tailor shop C: clothing store D: sewing room E: hardware store
Rationales: 1. The question is asking where fabric is cut specifically to order. This implies somewhere where the cutting of fabric is done according to specific measurements or requirements of the customer. 
2. We can first eliminate choices that generally do not deal with cutting fabric. These choices are A: curtains. Curtains are not a place or seller type where fabric can be cut. And E: hardware store. They typically sell tools and equipment, not fabrics.
3. Next, consider C: clothing store. While clothing stores do sell items made from fabric, they usually sell ready-made clothes and do not typically offer fabric-cutting services.
4. D: sewing room could potentially be a place where fabric is cut, but it does not necessarily refer to a seller or business. Individuals might cut fabric in sewing rooms, but it's not a specific type of seller.
5. This leaves us with B: tailor shop. Tailors work directly with fabric, cutting and modifying it to fit specific customer's measurements. They are well-known for providing services in which fabric is cut specifically to order.
6. Therefore, the answer is B: tailor shop.
Answer: B: tailor shop

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s10-rTrue
Loading extension module utils...
Time to load utils op: 0.30440592765808105 seconds
Loading extension module utils...
Time to load utils op: 0.40433764457702637 seconds
Loading extension module utils...
Time to load utils op: 0.3042595386505127 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:53<43:28, 53.23s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:36<37:47, 47.24s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:28<38:48, 49.55s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:20<38:49, 50.64s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:13<38:26, 51.25s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [05:02<36:58, 50.41s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:54<36:32, 50.99s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:30<32:21, 46.22s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:55<27:08, 39.71s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:47<28:56, 43.41s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:39<30:00, 46.16s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:33<30:37, 48.35s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [10:24<30:24, 49.30s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [11:16<30:08, 50.24s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [12:08<29:36, 50.76s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [13:02<29:12, 51.56s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [13:46<27:10, 49.42s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [14:38<26:39, 49.99s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [15:18<24:16, 46.99s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [16:10<24:22, 48.75s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [17:03<24:05, 49.83s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [17:56<23:39, 50.70s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [18:47<22:55, 50.96s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [19:39<22:15, 51.36s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [20:32<21:35, 51.82s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [21:25<20:51, 52.16s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [22:18<20:02, 52.27s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [23:10<19:11, 52.34s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [24:03<18:21, 52.44s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [24:55<17:29, 52.47s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [25:47<16:32, 52.22s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [26:25<14:21, 47.88s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [27:19<14:05, 49.73s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [28:12<13:30, 50.63s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [28:32<10:25, 41.68s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [29:12<09:32, 40.93s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [30:04<09:37, 44.39s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [30:57<09:23, 46.95s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [31:49<08:52, 48.41s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [32:41<08:15, 49.58s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [33:34<07:34, 50.53s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [34:05<05:57, 44.65s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [34:57<05:28, 47.00s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [35:47<04:47, 47.93s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [36:40<04:06, 49.26s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [37:26<03:13, 48.30s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [38:19<02:29, 49.72s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [39:12<01:41, 50.65s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [40:04<00:51, 51.02s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [40:51<00:00, 49.92s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [40:51<00:00, 49.03s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.539} | lm_loss 7.3648 | avg. gen lenth: 274.688
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s10-rTrue --seed 10 --rationales --num-in-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 01:07:12,474] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 2
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9739 [00:00<?, ?it/s]  1%|▊                                                                                                                                                   | 55/9739 [00:00<00:17, 541.35it/s]  1%|█▋                                                                                                                                                 | 110/9739 [00:00<00:17, 545.32it/s]  2%|██▍                                                                                                                                                | 165/9739 [00:00<00:17, 545.68it/s]  2%|███▎                                                                                                                                               | 220/9739 [00:00<00:17, 543.64it/s]  3%|████▏                                                                                                                                              | 275/9739 [00:00<00:17, 544.32it/s]  3%|████▉                                                                                                                                              | 330/9739 [00:00<00:17, 545.06it/s]  4%|█████▊                                                                                                                                             | 385/9739 [00:00<00:17, 545.78it/s]  5%|██████▋                                                                                                                                            | 440/9739 [00:00<00:17, 543.99it/s]  5%|███████▍                                                                                                                                           | 495/9739 [00:00<00:17, 534.44it/s]  6%|████████▎                                                                                                                                          | 550/9739 [00:01<00:17, 536.93it/s]  6%|█████████▏                                                                                                                                         | 605/9739 [00:01<00:16, 538.62it/s]  7%|█████████▉                                                                                                                                         | 659/9739 [00:01<00:16, 538.60it/s]  7%|██████████▊                                                                                                                                        | 714/9739 [00:01<00:16, 540.64it/s]  8%|███████████▌                                                                                                                                       | 769/9739 [00:01<00:16, 542.30it/s]  8%|████████████▍                                                                                                                                      | 824/9739 [00:01<00:16, 543.73it/s]  9%|█████████████▎                                                                                                                                     | 879/9739 [00:01<00:16, 544.11it/s] 10%|██████████████                                                                                                                                     | 934/9739 [00:01<00:16, 542.02it/s] 10%|██████████████▉                                                                                                                                    | 989/9739 [00:01<00:16, 542.83it/s] 11%|███████████████▋                                                                                                                                  | 1044/9739 [00:01<00:16, 538.81it/s] 11%|████████████████▍                                                                                                                                 | 1099/9739 [00:02<00:16, 539.58it/s] 12%|█████████████████▎                                                                                                                                | 1153/9739 [00:02<00:15, 539.24it/s] 12%|██████████████████                                                                                                                                | 1208/9739 [00:02<00:15, 540.26it/s] 13%|███████████████████                                                                                                                               | 1271/9739 [00:02<00:14, 566.01it/s] 14%|████████████████████▎                                                                                                                             | 1354/9739 [00:02<00:13, 643.75it/s] 15%|█████████████████████▌                                                                                                                            | 1437/9739 [00:02<00:11, 699.11it/s] 16%|██████████████████████▊                                                                                                                           | 1520/9739 [00:02<00:11, 737.96it/s] 16%|████████████████████████                                                                                                                          | 1602/9739 [00:02<00:10, 762.23it/s] 17%|█████████████████████████▎                                                                                                                        | 1685/9739 [00:02<00:10, 781.95it/s] 18%|██████████████████████████▌                                                                                                                       | 1768/9739 [00:02<00:10, 795.07it/s] 19%|███████████████████████████▋                                                                                                                      | 1848/9739 [00:03<00:10, 779.22it/s] 20%|████████████████████████████▉                                                                                                                     | 1931/9739 [00:03<00:09, 792.41it/s] 21%|██████████████████████████████▏                                                                                                                   | 2014/9739 [00:03<00:09, 801.68it/s] 22%|███████████████████████████████▍                                                                                                                  | 2096/9739 [00:03<00:09, 806.87it/s] 22%|████████████████████████████████▋                                                                                                                 | 2179/9739 [00:03<00:09, 813.74it/s] 23%|█████████████████████████████████▉                                                                                                                | 2262/9739 [00:03<00:09, 816.53it/s] 24%|███████████████████████████████████▏                                                                                                              | 2345/9739 [00:03<00:09, 819.96it/s] 25%|████████████████████████████████████▍                                                                                                             | 2429/9739 [00:03<00:08, 823.20it/s] 26%|█████████████████████████████████████▋                                                                                                            | 2512/9739 [00:03<00:08, 822.78it/s] 27%|██████████████████████████████████████▉                                                                                                           | 2596/9739 [00:03<00:08, 825.02it/s] 28%|████████████████████████████████████████▏                                                                                                         | 2679/9739 [00:04<00:08, 826.10it/s] 28%|█████████████████████████████████████████▍                                                                                                        | 2762/9739 [00:04<00:08, 823.90it/s] 29%|██████████████████████████████████████████▋                                                                                                       | 2845/9739 [00:04<00:08, 825.13it/s] 30%|███████████████████████████████████████████▉                                                                                                      | 2928/9739 [00:04<00:08, 823.60it/s] 31%|█████████████████████████████████████████████▏                                                                                                    | 3011/9739 [00:04<00:08, 824.16it/s] 32%|██████████████████████████████████████████████▍                                                                                                   | 3094/9739 [00:04<00:08, 823.73it/s] 33%|███████████████████████████████████████████████▋                                                                                                  | 3177/9739 [00:04<00:07, 822.80it/s] 33%|████████████████████████████████████████████████▉                                                                                                 | 3261/9739 [00:04<00:07, 825.12it/s] 34%|██████████████████████████████████████████████████▏                                                                                               | 3344/9739 [00:04<00:07, 825.34it/s] 35%|███████████████████████████████████████████████████▍                                                                                              | 3427/9739 [00:04<00:07, 824.34it/s] 36%|████████████████████████████████████████████████████▌                                                                                             | 3510/9739 [00:05<00:07, 824.82it/s] 37%|█████████████████████████████████████████████████████▉                                                                                            | 3594/9739 [00:05<00:07, 826.43it/s] 38%|███████████████████████████████████████████████████████                                                                                           | 3677/9739 [00:05<00:07, 824.34it/s] 39%|████████████████████████████████████████████████████████▍                                                                                         | 3761/9739 [00:05<00:07, 826.36it/s] 39%|█████████████████████████████████████████████████████████▋                                                                                        | 3844/9739 [00:05<00:07, 824.28it/s] 40%|██████████████████████████████████████████████████████████▊                                                                                       | 3927/9739 [00:05<00:07, 825.38it/s] 41%|████████████████████████████████████████████████████████████                                                                                      | 4010/9739 [00:05<00:06, 825.02it/s] 42%|█████████████████████████████████████████████████████████████▎                                                                                    | 4093/9739 [00:05<00:06, 817.21it/s] 43%|██████████████████████████████████████████████████████████████▌                                                                                   | 4176/9739 [00:05<00:06, 819.96it/s] 44%|███████████████████████████████████████████████████████████████▊                                                                                  | 4259/9739 [00:05<00:06, 822.57it/s] 45%|█████████████████████████████████████████████████████████████████                                                                                 | 4342/9739 [00:06<00:06, 821.65it/s] 45%|██████████████████████████████████████████████████████████████████▎                                                                               | 4425/9739 [00:06<00:06, 823.28it/s] 46%|███████████████████████████████████████████████████████████████████▌                                                                              | 4508/9739 [00:06<00:06, 824.97it/s] 47%|████████████████████████████████████████████████████████████████████▊                                                                             | 4591/9739 [00:06<00:06, 795.89it/s] 48%|██████████████████████████████████████████████████████████████████████                                                                            | 4674/9739 [00:06<00:06, 803.93it/s] 49%|███████████████████████████████████████████████████████████████████████▎                                                                          | 4755/9739 [00:06<00:08, 602.93it/s] 50%|████████████████████████████████████████████████████████████████████████▌                                                                         | 4838/9739 [00:06<00:07, 655.93it/s] 51%|█████████████████████████████████████████████████████████████████████████▊                                                                        | 4921/9739 [00:06<00:06, 699.14it/s] 51%|███████████████████████████████████████████████████████████████████████████                                                                       | 5003/9739 [00:06<00:06, 730.82it/s] 52%|████████████████████████████████████████████████████████████████████████████▏                                                                     | 5083/9739 [00:07<00:06, 749.09it/s] 53%|█████████████████████████████████████████████████████████████████████████████▍                                                                    | 5165/9739 [00:07<00:05, 768.15it/s] 54%|██████████████████████████████████████████████████████████████████████████████▋                                                                   | 5247/9739 [00:07<00:05, 782.62it/s] 55%|███████████████████████████████████████████████████████████████████████████████▉                                                                  | 5330/9739 [00:07<00:05, 794.79it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▏                                                                | 5412/9739 [00:07<00:05, 800.52it/s] 56%|██████████████████████████████████████████████████████████████████████████████████▍                                                               | 5496/9739 [00:07<00:05, 810.67it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▋                                                              | 5583/9739 [00:07<00:05, 825.67it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▉                                                             | 5669/9739 [00:07<00:04, 833.78it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▎                                                           | 5756/9739 [00:07<00:04, 842.19it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▌                                                          | 5843/9739 [00:08<00:04, 848.73it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▉                                                         | 5929/9739 [00:08<00:04, 851.66it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▏                                                       | 6016/9739 [00:08<00:04, 855.79it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▍                                                      | 6103/9739 [00:08<00:04, 857.24it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▊                                                     | 6189/9739 [00:08<00:04, 850.44it/s] 64%|██████████████████████████████████████████████████████████████████████████████████████████████                                                    | 6275/9739 [00:08<00:04, 827.18it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▎                                                  | 6359/9739 [00:08<00:04, 830.76it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▌                                                 | 6444/9739 [00:08<00:03, 836.32it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▊                                                | 6528/9739 [00:08<00:03, 816.57it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                                              | 6615/9739 [00:08<00:03, 829.75it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▍                                             | 6702/9739 [00:09<00:03, 839.86it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▊                                            | 6788/9739 [00:09<00:03, 844.68it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████                                           | 6875/9739 [00:09<00:03, 850.91it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                         | 6962/9739 [00:09<00:03, 854.72it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                        | 7048/9739 [00:09<00:03, 853.30it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                       | 7134/9739 [00:09<00:03, 854.94it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                     | 7220/9739 [00:09<00:02, 854.79it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                    | 7306/9739 [00:09<00:02, 846.22it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                   | 7392/9739 [00:09<00:02, 848.43it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                  | 7477/9739 [00:09<00:02, 807.97it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                | 7563/9739 [00:10<00:02, 822.30it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                               | 7650/9739 [00:10<00:02, 834.93it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                              | 7736/9739 [00:10<00:02, 840.98it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                            | 7823/9739 [00:10<00:02, 847.19it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                           | 7908/9739 [00:10<00:02, 847.94it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                          | 7993/9739 [00:10<00:02, 848.50it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                         | 8079/9739 [00:10<00:01, 851.80it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                       | 8165/9739 [00:10<00:01, 852.76it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 8252/9739 [00:10<00:01, 856.30it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                     | 8339/9739 [00:10<00:01, 857.74it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                   | 8425/9739 [00:11<00:01, 857.93it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 8511/9739 [00:11<00:01, 858.51it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                 | 8597/9739 [00:11<00:01, 857.25it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏               | 8684/9739 [00:11<00:01, 858.13it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍              | 8771/9739 [00:11<00:01, 859.60it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 8857/9739 [00:11<00:01, 857.14it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████            | 8944/9739 [00:11<00:00, 859.32it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎          | 9030/9739 [00:11<00:00, 855.18it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋         | 9117/9739 [00:11<00:00, 857.17it/s] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉        | 9204/9739 [00:11<00:00, 858.03it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎      | 9290/9739 [00:12<00:00, 856.38it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌     | 9377/9739 [00:12<00:00, 858.48it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊    | 9463/9739 [00:12<00:00, 858.70it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏  | 9549/9739 [00:12<00:00, 856.00it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍ | 9635/9739 [00:12<00:00, 852.63it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋| 9721/9739 [00:12<00:00, 850.10it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9739/9739 [00:12<00:00, 773.18it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.97s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.36s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.31s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.28s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.87s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.07s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.24s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.28s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]
[2023-08-11 01:08:16,663] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.73s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.90s/it]
[2023-08-11 01:08:29,408] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 01:08:29,409] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 01:08:29,410] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 01:08:29,410] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 01:08:29,410] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 01:08:29,410] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 01:08:29,410] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 01:08:29,410] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f91bcf68e80>
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 01:08:29,411] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f91bce7d910>
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 01:08:29,412] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 01:08:29,412] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.40856194496154785 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Fabric is cut to order at what type of seller? Choices:  A: curtains B: tailor shop C: clothing store D: sewing room E: hardware store
Rationales: 1. First we need to understand the key information in the question which is 'Fabric is cut to order.'
2. This clue suggests the answer will be a place where people go to get custom-made items from fabric.
3. Regarding our choices, let's consider each. 
4. A: Curtains is not a type of seller, but an item that could potentially be made from fabric.
5. C: Clothing Store: although fabric is used here, clothes there are usually pre-made and not cut to order, hence it is not a perfect match.
6. D: Sewing Room: This is a place where sewing activity happens. However, it doesn't specify that it is a place where fabric is cut to order. So, it can't be correct.
7. E: Hardware Store: This is typically a place where tools and hardware parts are sold for home improvement. So, it does not fit with the key information.
8. B: Tailor shop: This is a place where fabric is traditionally measured and cut according to individual orders or preferences. They make clothes to "fit" their customers perfectly.
9. From the above considerations, we can conclude that the answer is B. Tailor Shop, as this is where fabric is commonly cut to order.
Answer: B: tailor shop

Input: Where are you if your reading magazines while waiting for a vehicle on rails? Choices:  A: vegetables B: market C: doctor D: train station E: bookstore
Rationales: 1. The question is asking about a location where one would be typically waiting for a vehicle that runs on rails, while doing an activity such as reading magazines. 
2. The choice A: vegetables isn't a location itself. So, it is immediately ruled out.
3. The choice B: market and C: doctor and E: bookstore do not usually have vehicles on rails. So, these options can be ruled out.
4. The choice D: train station is fitting to the context. You usually wait for a train (which is a vehicle that runs on rails) at a train station, and it's quite common to read a magazine while waiting.
5. Therefore, the answer is D: train station.
Answer: D: train station

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s10-rTrue
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.40426039695739746 seconds
Time to load utils op: 0.40430736541748047 seconds
Loading extension module utils...
Time to load utils op: 0.40467405319213867 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:49<40:49, 50.00s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:38<39:04, 48.85s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:27<38:30, 49.15s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:15<37:26, 48.83s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:04<36:34, 48.78s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:31<30:17, 41.30s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:16<30:23, 42.40s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:04<31:07, 44.46s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:54<31:25, 46.00s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:43<31:18, 46.97s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:32<31:00, 47.70s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:22<30:37, 48.36s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [10:11<29:54, 48.51s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:59<28:58, 48.30s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:48<28:20, 48.59s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [12:37<27:36, 48.72s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [13:26<26:54, 48.93s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [14:16<26:09, 49.04s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [15:04<25:14, 48.86s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:54<24:33, 49.10s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:42<23:34, 48.77s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [17:30<22:42, 48.66s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [18:12<20:57, 46.56s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [19:00<20:24, 47.09s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [19:48<19:43, 47.35s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [20:37<19:02, 47.62s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [21:26<18:25, 48.06s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [22:14<17:41, 48.24s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [23:03<16:57, 48.43s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [23:52<16:08, 48.45s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [24:40<15:21, 48.48s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [25:29<14:34, 48.56s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [26:18<13:49, 48.82s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [27:06<12:56, 48.55s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [27:54<12:06, 48.43s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [28:44<11:21, 48.71s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [29:32<10:33, 48.71s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [30:21<09:43, 48.65s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [31:10<08:57, 48.87s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [31:24<06:24, 38.43s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [32:13<06:12, 41.34s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [33:01<05:47, 43.48s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [33:51<05:17, 45.43s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [34:39<04:36, 46.10s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [35:28<03:54, 46.96s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [36:17<03:10, 47.73s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [37:06<02:24, 48.15s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [37:55<01:36, 48.38s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [38:45<00:48, 48.67s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:33<00:00, 48.72s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:33<00:00, 47.48s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.4126} | lm_loss 7.5619 | avg. gen lenth: 304.936
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i3-s10-rTrue --seed 10 --rationales --num-in-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 01:49:16,503] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i3-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 3
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i3-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9738 [00:00<?, ?it/s]  0%|▍                                                                                                                                                   | 32/9738 [00:00<00:30, 314.59it/s]  1%|▉                                                                                                                                                   | 64/9738 [00:00<00:30, 316.13it/s]  1%|█▍                                                                                                                                                  | 96/9738 [00:00<00:30, 317.87it/s]  1%|█▉                                                                                                                                                 | 128/9738 [00:00<00:30, 318.41it/s]  2%|██▍                                                                                                                                                | 160/9738 [00:00<00:30, 318.65it/s]  2%|██▉                                                                                                                                                | 192/9738 [00:00<00:30, 317.91it/s]  2%|███▍                                                                                                                                               | 224/9738 [00:00<00:30, 311.99it/s]  3%|███▊                                                                                                                                               | 256/9738 [00:00<00:30, 313.82it/s]  3%|████▎                                                                                                                                              | 288/9738 [00:00<00:29, 315.27it/s]  3%|████▊                                                                                                                                              | 320/9738 [00:01<00:29, 316.17it/s]  4%|█████▎                                                                                                                                             | 352/9738 [00:01<00:29, 316.82it/s]  4%|█████▊                                                                                                                                             | 384/9738 [00:01<00:29, 317.25it/s]  4%|██████▎                                                                                                                                            | 416/9738 [00:01<00:29, 317.45it/s]  5%|██████▊                                                                                                                                            | 448/9738 [00:01<00:29, 316.30it/s]  5%|███████▏                                                                                                                                           | 480/9738 [00:01<00:29, 316.88it/s]  5%|███████▋                                                                                                                                           | 512/9738 [00:01<00:29, 317.17it/s]  6%|████████▏                                                                                                                                          | 544/9738 [00:01<00:29, 314.74it/s]  6%|████████▋                                                                                                                                          | 576/9738 [00:01<00:29, 315.18it/s]  6%|█████████▏                                                                                                                                         | 608/9738 [00:01<00:28, 315.98it/s]  7%|█████████▋                                                                                                                                         | 640/9738 [00:02<00:28, 316.56it/s]  7%|██████████▏                                                                                                                                        | 672/9738 [00:02<00:28, 315.21it/s]  7%|██████████▋                                                                                                                                        | 704/9738 [00:02<00:28, 316.10it/s]  8%|███████████                                                                                                                                        | 736/9738 [00:02<00:28, 316.77it/s]  8%|███████████▊                                                                                                                                       | 784/9738 [00:02<00:24, 363.61it/s]  9%|████████████▌                                                                                                                                      | 833/9738 [00:02<00:22, 398.94it/s]  9%|█████████████▎                                                                                                                                     | 882/9738 [00:02<00:20, 422.50it/s] 10%|██████████████                                                                                                                                     | 931/9738 [00:02<00:20, 439.80it/s] 10%|██████████████▊                                                                                                                                    | 979/9738 [00:02<00:19, 451.34it/s] 11%|███████████████▍                                                                                                                                  | 1028/9738 [00:02<00:18, 460.18it/s] 11%|████████████████▏                                                                                                                                 | 1076/9738 [00:03<00:18, 463.91it/s] 12%|████████████████▊                                                                                                                                 | 1124/9738 [00:03<00:18, 466.64it/s] 12%|█████████████████▌                                                                                                                                | 1173/9738 [00:03<00:18, 470.79it/s] 13%|██████████████████▎                                                                                                                               | 1221/9738 [00:03<00:17, 473.45it/s] 13%|███████████████████                                                                                                                               | 1270/9738 [00:03<00:17, 475.55it/s] 14%|███████████████████▊                                                                                                                              | 1319/9738 [00:03<00:17, 477.20it/s] 14%|████████████████████▍                                                                                                                             | 1367/9738 [00:03<00:17, 476.21it/s] 15%|█████████████████████▏                                                                                                                            | 1415/9738 [00:03<00:17, 476.98it/s] 15%|█████████████████████▉                                                                                                                            | 1463/9738 [00:03<00:17, 477.82it/s] 16%|██████████████████████▋                                                                                                                           | 1511/9738 [00:03<00:17, 478.39it/s] 16%|███████████████████████▍                                                                                                                          | 1560/9738 [00:04<00:17, 479.27it/s] 17%|████████████████████████                                                                                                                          | 1608/9738 [00:04<00:17, 477.14it/s] 17%|████████████████████████▊                                                                                                                         | 1657/9738 [00:04<00:16, 478.32it/s] 18%|█████████████████████████▌                                                                                                                        | 1705/9738 [00:04<00:16, 473.67it/s] 18%|██████████████████████████▎                                                                                                                       | 1754/9738 [00:04<00:16, 475.80it/s] 19%|███████████████████████████                                                                                                                       | 1802/9738 [00:04<00:17, 447.71it/s] 19%|███████████████████████████▋                                                                                                                      | 1850/9738 [00:04<00:17, 455.99it/s] 19%|████████████████████████████▍                                                                                                                     | 1898/9738 [00:04<00:16, 461.97it/s] 20%|█████████████████████████████▏                                                                                                                    | 1946/9738 [00:04<00:16, 466.52it/s] 20%|█████████████████████████████▉                                                                                                                    | 1994/9738 [00:04<00:16, 469.62it/s] 21%|██████████████████████████████▌                                                                                                                   | 2042/9738 [00:05<00:16, 469.52it/s] 21%|███████████████████████████████▎                                                                                                                  | 2090/9738 [00:05<00:16, 471.07it/s] 22%|████████████████████████████████                                                                                                                  | 2138/9738 [00:05<00:16, 472.89it/s] 22%|████████████████████████████████▊                                                                                                                 | 2186/9738 [00:05<00:15, 474.35it/s] 23%|█████████████████████████████████▍                                                                                                                | 2234/9738 [00:05<00:15, 475.63it/s] 23%|██████████████████████████████████▏                                                                                                               | 2282/9738 [00:05<00:15, 474.16it/s] 24%|██████████████████████████████████▉                                                                                                               | 2330/9738 [00:05<00:15, 472.59it/s] 24%|███████████████████████████████████▋                                                                                                              | 2378/9738 [00:05<00:15, 474.40it/s] 25%|████████████████████████████████████▎                                                                                                             | 2426/9738 [00:05<00:15, 476.00it/s] 25%|█████████████████████████████████████                                                                                                             | 2474/9738 [00:05<00:15, 474.83it/s] 26%|█████████████████████████████████████▊                                                                                                            | 2522/9738 [00:06<00:15, 475.57it/s] 26%|██████████████████████████████████████▌                                                                                                           | 2570/9738 [00:06<00:15, 476.37it/s] 27%|███████████████████████████████████████▎                                                                                                          | 2618/9738 [00:06<00:14, 476.97it/s] 27%|███████████████████████████████████████▉                                                                                                          | 2666/9738 [00:06<00:14, 476.90it/s] 28%|████████████████████████████████████████▋                                                                                                         | 2714/9738 [00:06<00:14, 474.71it/s] 28%|█████████████████████████████████████████▍                                                                                                        | 2762/9738 [00:06<00:14, 475.35it/s] 29%|██████████████████████████████████████████▏                                                                                                       | 2810/9738 [00:06<00:14, 475.63it/s] 29%|██████████████████████████████████████████▊                                                                                                       | 2858/9738 [00:06<00:14, 476.85it/s] 30%|███████████████████████████████████████████▌                                                                                                      | 2906/9738 [00:06<00:14, 477.56it/s] 30%|████████████████████████████████████████████▎                                                                                                     | 2954/9738 [00:07<00:14, 475.76it/s] 31%|█████████████████████████████████████████████                                                                                                     | 3002/9738 [00:07<00:14, 476.34it/s] 31%|█████████████████████████████████████████████▋                                                                                                    | 3050/9738 [00:07<00:14, 476.72it/s] 32%|██████████████████████████████████████████████▍                                                                                                   | 3098/9738 [00:07<00:13, 475.23it/s] 32%|███████████████████████████████████████████████▏                                                                                                  | 3146/9738 [00:07<00:13, 476.00it/s] 33%|███████████████████████████████████████████████▉                                                                                                  | 3194/9738 [00:07<00:13, 474.80it/s] 33%|████████████████████████████████████████████████▌                                                                                                 | 3242/9738 [00:07<00:13, 475.83it/s] 34%|█████████████████████████████████████████████████▎                                                                                                | 3290/9738 [00:07<00:13, 476.14it/s] 34%|██████████████████████████████████████████████████                                                                                                | 3338/9738 [00:07<00:13, 476.28it/s] 35%|██████████████████████████████████████████████████▊                                                                                               | 3386/9738 [00:07<00:13, 475.10it/s] 35%|███████████████████████████████████████████████████▍                                                                                              | 3434/9738 [00:08<00:13, 475.33it/s] 36%|████████████████████████████████████████████████████▏                                                                                             | 3482/9738 [00:08<00:13, 475.53it/s] 36%|████████████████████████████████████████████████████▉                                                                                             | 3530/9738 [00:08<00:13, 475.64it/s] 37%|█████████████████████████████████████████████████████▋                                                                                            | 3578/9738 [00:08<00:12, 476.09it/s] 37%|██████████████████████████████████████████████████████▎                                                                                           | 3626/9738 [00:08<00:12, 474.70it/s] 38%|███████████████████████████████████████████████████████                                                                                           | 3674/9738 [00:08<00:12, 475.60it/s] 38%|███████████████████████████████████████████████████████▊                                                                                          | 3722/9738 [00:08<00:12, 476.52it/s] 39%|████████████████████████████████████████████████████████▌                                                                                         | 3770/9738 [00:08<00:12, 477.13it/s] 39%|█████████████████████████████████████████████████████████▏                                                                                        | 3818/9738 [00:08<00:12, 477.09it/s] 40%|█████████████████████████████████████████████████████████▉                                                                                        | 3866/9738 [00:08<00:12, 475.62it/s] 40%|██████████████████████████████████████████████████████████▋                                                                                       | 3914/9738 [00:09<00:12, 475.00it/s] 41%|███████████████████████████████████████████████████████████▍                                                                                      | 3962/9738 [00:09<00:12, 475.43it/s] 41%|████████████████████████████████████████████████████████████                                                                                      | 4010/9738 [00:09<00:12, 476.41it/s] 42%|████████████████████████████████████████████████████████████▊                                                                                     | 4058/9738 [00:09<00:11, 476.70it/s] 42%|█████████████████████████████████████████████████████████████▌                                                                                    | 4106/9738 [00:09<00:11, 474.50it/s] 43%|██████████████████████████████████████████████████████████████▎                                                                                   | 4154/9738 [00:09<00:11, 474.80it/s] 43%|██████████████████████████████████████████████████████████████▉                                                                                   | 4202/9738 [00:09<00:11, 475.32it/s] 44%|███████████████████████████████████████████████████████████████▋                                                                                  | 4250/9738 [00:09<00:11, 475.54it/s] 44%|████████████████████████████████████████████████████████████████▍                                                                                 | 4298/9738 [00:09<00:11, 474.47it/s] 45%|█████████████████████████████████████████████████████████████████▏                                                                                | 4346/9738 [00:09<00:11, 475.24it/s] 45%|█████████████████████████████████████████████████████████████████▉                                                                                | 4394/9738 [00:10<00:11, 475.46it/s] 46%|██████████████████████████████████████████████████████████████████▌                                                                               | 4442/9738 [00:10<00:11, 475.45it/s] 46%|███████████████████████████████████████████████████████████████████▎                                                                              | 4490/9738 [00:10<00:11, 476.04it/s] 47%|████████████████████████████████████████████████████████████████████                                                                              | 4538/9738 [00:10<00:11, 449.41it/s] 47%|████████████████████████████████████████████████████████████████████▊                                                                             | 4586/9738 [00:10<00:11, 456.96it/s] 48%|█████████████████████████████████████████████████████████████████████▍                                                                            | 4634/9738 [00:10<00:11, 462.83it/s] 48%|██████████████████████████████████████████████████████████████████████▏                                                                           | 4682/9738 [00:10<00:10, 467.04it/s] 49%|██████████████████████████████████████████████████████████████████████▉                                                                           | 4730/9738 [00:10<00:10, 469.50it/s] 49%|███████████████████████████████████████████████████████████████████████▋                                                                          | 4778/9738 [00:10<00:13, 367.58it/s] 50%|████████████████████████████████████████████████████████████████████████▎                                                                         | 4826/9738 [00:11<00:12, 393.77it/s] 50%|█████████████████████████████████████████████████████████████████████████                                                                         | 4873/9738 [00:11<00:11, 413.58it/s] 51%|█████████████████████████████████████████████████████████████████████████▊                                                                        | 4921/9738 [00:11<00:11, 429.90it/s] 51%|██████████████████████████████████████████████████████████████████████████▍                                                                       | 4968/9738 [00:11<00:10, 440.54it/s] 52%|███████████████████████████████████████████████████████████████████████████▏                                                                      | 5016/9738 [00:11<00:10, 450.19it/s] 52%|███████████████████████████████████████████████████████████████████████████▉                                                                      | 5064/9738 [00:11<00:10, 457.22it/s] 52%|████████████████████████████████████████████████████████████████████████████▋                                                                     | 5112/9738 [00:11<00:10, 462.13it/s] 53%|█████████████████████████████████████████████████████████████████████████████▎                                                                    | 5160/9738 [00:11<00:09, 465.68it/s] 53%|██████████████████████████████████████████████████████████████████████████████                                                                    | 5207/9738 [00:11<00:09, 466.41it/s] 54%|██████████████████████████████████████████████████████████████████████████████▊                                                                   | 5255/9738 [00:11<00:09, 468.61it/s] 54%|███████████████████████████████████████████████████████████████████████████████▌                                                                  | 5303/9738 [00:12<00:09, 470.06it/s] 55%|████████████████████████████████████████████████████████████████████████████████▏                                                                 | 5351/9738 [00:12<00:09, 471.09it/s] 55%|████████████████████████████████████████████████████████████████████████████████▉                                                                 | 5399/9738 [00:12<00:09, 469.71it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▋                                                                | 5447/9738 [00:12<00:09, 471.04it/s] 56%|██████████████████████████████████████████████████████████████████████████████████▍                                                               | 5495/9738 [00:12<00:09, 469.16it/s] 57%|███████████████████████████████████████████████████████████████████████████████████                                                               | 5544/9738 [00:12<00:08, 474.95it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▊                                                              | 5593/9738 [00:12<00:08, 479.25it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▌                                                             | 5642/9738 [00:12<00:08, 480.39it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▎                                                            | 5691/9738 [00:12<00:08, 482.90it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████                                                            | 5740/9738 [00:12<00:08, 484.98it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▊                                                           | 5790/9738 [00:13<00:08, 486.48it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▌                                                          | 5840/9738 [00:13<00:07, 487.87it/s] 60%|████████████████████████████████████████████████████████████████████████████████████████▎                                                         | 5889/9738 [00:13<00:07, 487.34it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████                                                         | 5939/9738 [00:13<00:07, 488.80it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▊                                                        | 5989/9738 [00:13<00:07, 489.60it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▌                                                       | 6039/9738 [00:13<00:07, 490.42it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▎                                                      | 6089/9738 [00:13<00:07, 488.91it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████                                                      | 6139/9738 [00:13<00:07, 489.63it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▊                                                     | 6189/9738 [00:13<00:07, 491.13it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▌                                                    | 6239/9738 [00:13<00:07, 491.33it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▎                                                   | 6289/9738 [00:14<00:07, 487.30it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████                                                   | 6338/9738 [00:14<00:06, 486.98it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▊                                                  | 6388/9738 [00:14<00:06, 488.34it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▌                                                 | 6438/9738 [00:14<00:06, 489.24it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▎                                                | 6488/9738 [00:14<00:06, 489.97it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████                                                | 6537/9738 [00:14<00:06, 488.64it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▊                                               | 6587/9738 [00:14<00:06, 490.06it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▌                                              | 6637/9738 [00:14<00:06, 490.75it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▎                                             | 6687/9738 [00:14<00:06, 491.89it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████                                             | 6737/9738 [00:15<00:06, 492.28it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▊                                            | 6787/9738 [00:15<00:06, 490.97it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▌                                           | 6837/9738 [00:15<00:05, 492.06it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▎                                          | 6887/9738 [00:15<00:05, 492.85it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████                                          | 6937/9738 [00:15<00:05, 493.46it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                         | 6987/9738 [00:15<00:05, 491.69it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                        | 7037/9738 [00:15<00:05, 492.27it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                       | 7087/9738 [00:15<00:05, 492.39it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████                                       | 7137/9738 [00:15<00:05, 486.86it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                      | 7187/9738 [00:15<00:05, 488.59it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                     | 7236/9738 [00:16<00:05, 486.41it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                    | 7286/9738 [00:16<00:05, 488.70it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                    | 7336/9738 [00:16<00:04, 489.78it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                   | 7386/9738 [00:16<00:04, 491.31it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                  | 7436/9738 [00:16<00:04, 491.90it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 7486/9738 [00:16<00:05, 447.43it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                 | 7536/9738 [00:16<00:04, 459.70it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                | 7586/9738 [00:16<00:04, 469.16it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                               | 7636/9738 [00:16<00:04, 475.48it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                              | 7685/9738 [00:16<00:04, 478.55it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                              | 7735/9738 [00:17<00:04, 483.34it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                             | 7785/9738 [00:17<00:04, 486.06it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                            | 7835/9738 [00:17<00:03, 488.00it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                           | 7885/9738 [00:17<00:03, 488.91it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                           | 7934/9738 [00:17<00:03, 483.06it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                          | 7983/9738 [00:17<00:03, 485.05it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                         | 8033/9738 [00:17<00:03, 487.11it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 8083/9738 [00:17<00:03, 488.37it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                        | 8132/9738 [00:17<00:03, 487.54it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                       | 8182/9738 [00:17<00:03, 488.60it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                      | 8232/9738 [00:18<00:03, 489.48it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                     | 8282/9738 [00:18<00:02, 490.23it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                     | 8332/9738 [00:18<00:02, 490.96it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                    | 8382/9738 [00:18<00:02, 489.31it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                   | 8432/9738 [00:18<00:02, 490.34it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                  | 8482/9738 [00:18<00:02, 490.84it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                  | 8532/9738 [00:18<00:02, 491.04it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 8582/9738 [00:18<00:02, 489.57it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                | 8632/9738 [00:18<00:02, 490.05it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏               | 8682/9738 [00:19<00:02, 490.33it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉               | 8732/9738 [00:19<00:02, 490.58it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋              | 8782/9738 [00:19<00:01, 490.31it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍             | 8832/9738 [00:19<00:01, 488.78it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏            | 8882/9738 [00:19<00:01, 489.57it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉            | 8932/9738 [00:19<00:01, 490.21it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋           | 8982/9738 [00:19<00:01, 490.53it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍          | 9032/9738 [00:19<00:01, 486.05it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏         | 9082/9738 [00:19<00:01, 487.39it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉         | 9131/9738 [00:19<00:01, 488.02it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋        | 9180/9738 [00:20<00:01, 488.44it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍       | 9230/9738 [00:20<00:01, 489.03it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████       | 9279/9738 [00:20<00:00, 487.86it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊      | 9329/9738 [00:20<00:00, 489.08it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌     | 9379/9738 [00:20<00:00, 490.15it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎    | 9429/9738 [00:20<00:00, 490.51it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████    | 9479/9738 [00:20<00:00, 490.82it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊   | 9529/9738 [00:20<00:00, 489.28it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 9579/9738 [00:20<00:00, 489.85it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎ | 9629/9738 [00:20<00:00, 490.01it/s] 99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████ | 9679/9738 [00:21<00:00, 490.15it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊| 9729/9738 [00:21<00:00, 488.67it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9738/9738 [00:21<00:00, 460.01it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.03s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.32s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.49s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.33s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.90s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.46s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.44s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.30s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]
[2023-08-11 01:50:28,691] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.87s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
[2023-08-11 01:50:39,167] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 01:50:39,168] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 01:50:39,168] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 01:50:39,168] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 01:50:39,168] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 01:50:39,168] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f681a5c2e80>
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 01:50:39,169] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f681a3d4910>
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 01:50:39,170] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 01:50:39,171] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 01:50:39,171] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 01:50:39,171] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 01:50:39,171] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.46674251556396484 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Fabric is cut to order at what type of seller? Choices:  A: curtains B: tailor shop C: clothing store D: sewing room E: hardware store
Rationales: Step 1: Assess the question and its context which is about fabric being cut to order at a particular place - implying some sort of custom clothing work is under consideration.
Step 2: Look at the different choices, which are A: curtains, B: tailor shop, C: clothing store, D: sewing room, and E: hardware store.
Step 3: Eliminate the unrelated and unsuitable options. Curtains (Choice A) and hardware store (Choice E) are not places where fabric is custom-cut to order - curtains are a type of home furnishing while a hardware store is associated with selling tools and equipment. 
Step 4: Evaluate the remaining three options. While a clothing store (Choice C) and a sewing room (Choice D) could potentially involve fabric cutting, they usually do not cut fabric to specific customer's order.
Step 5: The remaining option is a tailor shop (Choice B) - this is a place where customers’ measurements are taken and fabric is cut and sewn to order, fitting the definition of a place where "fabric is cut to order" perfectly. Hence, it is the correct choice.
Answer: B: tailor shop

Input: Where are you if your reading magazines while waiting for a vehicle on rails? Choices:  A: vegetables B: market C: doctor D: train station E: bookstore
Rationales: 1. The question asks where you might be if you're "waiting for a vehicle on rails". 
2. Consider the possible places where you can wait for such a vehicle. 
3. The choices provided are vegetables, market, doctor, train station, and bookstore. 
4. Vegetables are not a place, so that can be eliminated. 
5. You can't wait for a train at a doctor's office or a bookstore, so these options can also be eliminated. 
6. Although there could be a rail-based form of transport in a market, it's uncommon and not a typical place where one would wait for such a vehicle.
7. Therefore, the most logical answer, and the only one that logically fits the scenario, is D: train station, since this is the usual place where people wait for a vehicle on rails, such as a train.
Answer: D: train station

Input: What would need oil to be used? Choices:  A: ground B: human  body C: repair shop D: combustion engines E: service station
Rationales: Step 1: Consider each choice one by one.
Step 2: Consider choice A: Ground – Oil is not typically used in direct application to the ground or soil. Therefore, it is not the correct answer.
Step 3: Consider choice B: Human body – While oil-based products can be used for skincare or other personal care, humans do not inherently need oil for functioning like the combustion engines do. Therefore, it is not the correct answer.
Step 4: Consider choice C: Repair Shop – While the equipment in a repair shop might need oil, it's the equipment, not the shop itself, that requires oil. Therefore, this choice is not the correct answer.
Step 5: Consider choice D: Combustion Engines – Combustion engines, which often power cars and other machinery, require oil for lubrication and helping to maintain the temperature within the engine. Hence, this choice is the correct answer.
Step 6: Even though we have found the correct answer, for completeness' sake let's consider choice E: Service Station – Similar to the repair shop, the machines and vehicles serviced at a service station might need oil, but the station itself does not inherently require oil. Therefore, this choice is not the correct answer.
Answer: D: combustion engines

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i3-s10-rTrue
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5050132274627686 seconds
Time to load utils op: 0.504763126373291 seconds
Loading extension module utils...
Time to load utils op: 0.5045864582061768 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:44<36:33, 44.76s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:29<35:41, 44.62s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:14<35:08, 44.85s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:58<34:12, 44.61s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:25<28:46, 38.38s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:00<27:04, 36.91s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:44<28:09, 39.30s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:20<26:47, 38.27s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:05<27:31, 40.29s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [06:32<24:11, 36.28s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:16<25:09, 38.71s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:00<25:35, 40.40s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [08:45<25:40, 41.63s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:30<25:34, 42.62s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:14<25:09, 43.13s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [10:58<24:38, 43.49s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:27<21:24, 38.92s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [12:11<21:34, 40.46s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [12:55<21:29, 41.60s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [13:39<21:10, 42.35s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [14:23<20:46, 42.97s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [15:08<20:12, 43.31s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [15:52<19:41, 43.76s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [16:37<19:03, 43.96s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [17:21<18:24, 44.16s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [18:06<17:41, 44.24s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:51<17:01, 44.41s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:35<16:18, 44.47s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:20<15:36, 44.58s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:04<14:50, 44.51s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [21:49<14:08, 44.65s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:35<13:26, 44.81s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:20<12:42, 44.87s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [24:05<12:01, 45.07s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:50<11:15, 45.04s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [25:25<09:46, 41.86s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [26:09<09:12, 42.49s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:53<08:37, 43.13s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [27:36<07:54, 43.13s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [28:21<07:16, 43.63s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [29:05<06:34, 43.82s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [29:51<05:54, 44.26s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [30:36<05:11, 44.48s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [31:20<04:26, 44.48s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [32:00<03:36, 43.25s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [32:45<02:54, 43.65s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [33:30<02:12, 44.00s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [34:15<01:28, 44.29s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [35:00<00:44, 44.69s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:45<00:00, 44.76s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:45<00:00, 42.92s/it]
name: commonsenseqa | {'exact_match': 0.8, 'rougeL': 3.0523} | lm_loss 7.3289 | avg. gen lenth: 306.2
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i4-s10-rTrue --seed 10 --rationales --num-in-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[2023-08-11 02:27:50,254] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i4-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 4
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i4-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9737 [00:00<?, ?it/s]  0%|▍                                                                                                                                                   | 27/9737 [00:00<00:36, 267.75it/s]  1%|▊                                                                                                                                                   | 54/9737 [00:00<00:36, 268.84it/s]  1%|█▏                                                                                                                                                  | 81/9737 [00:00<00:35, 268.88it/s]  1%|█▋                                                                                                                                                 | 108/9737 [00:00<00:35, 269.25it/s]  1%|██                                                                                                                                                 | 135/9737 [00:00<00:35, 269.17it/s]  2%|██▍                                                                                                                                                | 163/9737 [00:00<00:35, 269.59it/s]  2%|██▊                                                                                                                                                | 190/9737 [00:00<00:35, 265.76it/s]  2%|███▎                                                                                                                                               | 217/9737 [00:00<00:36, 264.44it/s]  3%|███▋                                                                                                                                               | 244/9737 [00:00<00:35, 265.50it/s]  3%|████                                                                                                                                               | 271/9737 [00:01<00:35, 266.49it/s]  3%|████▍                                                                                                                                              | 298/9737 [00:01<00:35, 267.36it/s]  3%|████▉                                                                                                                                              | 325/9737 [00:01<00:35, 267.77it/s]  4%|█████▎                                                                                                                                             | 352/9737 [00:01<00:35, 267.93it/s]  4%|█████▋                                                                                                                                             | 379/9737 [00:01<00:34, 268.18it/s]  4%|██████▏                                                                                                                                            | 406/9737 [00:01<00:34, 268.48it/s]  4%|██████▌                                                                                                                                            | 433/9737 [00:01<00:34, 266.83it/s]  5%|██████▉                                                                                                                                            | 460/9737 [00:01<00:34, 265.75it/s]  5%|███████▎                                                                                                                                           | 487/9737 [00:01<00:34, 266.23it/s]  5%|███████▊                                                                                                                                           | 514/9737 [00:01<00:34, 266.96it/s]  6%|████████▏                                                                                                                                          | 546/9737 [00:02<00:32, 282.05it/s]  6%|████████▊                                                                                                                                          | 587/9737 [00:02<00:28, 319.20it/s]  6%|█████████▍                                                                                                                                         | 628/9737 [00:02<00:26, 345.31it/s]  7%|██████████                                                                                                                                         | 669/9737 [00:02<00:25, 362.13it/s]  7%|██████████▋                                                                                                                                        | 710/9737 [00:02<00:24, 375.52it/s]  8%|███████████▎                                                                                                                                       | 751/9737 [00:02<00:23, 385.34it/s]  8%|███████████▉                                                                                                                                       | 792/9737 [00:02<00:22, 391.81it/s]  9%|████████████▌                                                                                                                                      | 833/9737 [00:02<00:22, 396.78it/s]  9%|█████████████▏                                                                                                                                     | 874/9737 [00:02<00:22, 400.05it/s]  9%|█████████████▊                                                                                                                                     | 915/9737 [00:02<00:22, 398.91it/s] 10%|██████████████▍                                                                                                                                    | 956/9737 [00:03<00:21, 400.63it/s] 10%|███████████████                                                                                                                                    | 997/9737 [00:03<00:21, 402.09it/s] 11%|███████████████▌                                                                                                                                  | 1038/9737 [00:03<00:21, 403.32it/s] 11%|████████████████▏                                                                                                                                 | 1079/9737 [00:03<00:21, 403.77it/s] 12%|████████████████▊                                                                                                                                 | 1120/9737 [00:03<00:21, 402.01it/s] 12%|█████████████████▍                                                                                                                                | 1161/9737 [00:03<00:21, 402.36it/s] 12%|██████████████████                                                                                                                                | 1202/9737 [00:03<00:21, 402.70it/s] 13%|██████████████████▋                                                                                                                               | 1243/9737 [00:03<00:21, 402.85it/s] 13%|███████████████████▎                                                                                                                              | 1284/9737 [00:03<00:20, 403.35it/s] 14%|███████████████████▊                                                                                                                              | 1325/9737 [00:03<00:20, 402.87it/s] 14%|████████████████████▍                                                                                                                             | 1366/9737 [00:04<00:20, 399.95it/s] 14%|█████████████████████                                                                                                                             | 1407/9737 [00:04<00:20, 399.86it/s] 15%|█████████████████████▋                                                                                                                            | 1448/9737 [00:04<00:20, 400.30it/s] 15%|██████████████████████▎                                                                                                                           | 1489/9737 [00:04<00:20, 398.30it/s] 16%|██████████████████████▉                                                                                                                           | 1530/9737 [00:04<00:20, 398.84it/s] 16%|███████████████████████▌                                                                                                                          | 1570/9737 [00:04<00:20, 397.75it/s] 17%|████████████████████████▏                                                                                                                         | 1611/9737 [00:04<00:20, 398.51it/s] 17%|████████████████████████▊                                                                                                                         | 1652/9737 [00:04<00:20, 399.16it/s] 17%|█████████████████████████▍                                                                                                                        | 1693/9737 [00:04<00:20, 399.70it/s] 18%|█████████████████████████▉                                                                                                                        | 1733/9737 [00:04<00:20, 399.74it/s] 18%|██████████████████████████▌                                                                                                                       | 1773/9737 [00:05<00:19, 399.77it/s] 19%|███████████████████████████▏                                                                                                                      | 1813/9737 [00:05<00:20, 380.07it/s] 19%|███████████████████████████▊                                                                                                                      | 1853/9737 [00:05<00:20, 385.28it/s] 19%|████████████████████████████▍                                                                                                                     | 1893/9737 [00:05<00:20, 388.95it/s] 20%|████████████████████████████▉                                                                                                                     | 1933/9737 [00:05<00:19, 391.43it/s] 20%|█████████████████████████████▌                                                                                                                    | 1973/9737 [00:05<00:19, 393.25it/s] 21%|██████████████████████████████▏                                                                                                                   | 2013/9737 [00:05<00:19, 390.74it/s] 21%|██████████████████████████████▊                                                                                                                   | 2053/9737 [00:05<00:19, 389.98it/s] 21%|███████████████████████████████▍                                                                                                                  | 2093/9737 [00:05<00:19, 391.30it/s] 22%|███████████████████████████████▉                                                                                                                  | 2133/9737 [00:06<00:19, 392.58it/s] 22%|████████████████████████████████▌                                                                                                                 | 2173/9737 [00:06<00:19, 393.70it/s] 23%|█████████████████████████████████▏                                                                                                                | 2213/9737 [00:06<00:19, 394.59it/s] 23%|█████████████████████████████████▊                                                                                                                | 2253/9737 [00:06<00:19, 393.52it/s] 24%|██████████████████████████████████▍                                                                                                               | 2293/9737 [00:06<00:18, 394.95it/s] 24%|██████████████████████████████████▉                                                                                                               | 2333/9737 [00:06<00:18, 395.36it/s] 24%|███████████████████████████████████▌                                                                                                              | 2373/9737 [00:06<00:18, 396.19it/s] 25%|████████████████████████████████████▏                                                                                                             | 2413/9737 [00:06<00:18, 396.58it/s] 25%|████████████████████████████████████▊                                                                                                             | 2453/9737 [00:06<00:18, 396.33it/s] 26%|█████████████████████████████████████▍                                                                                                            | 2493/9737 [00:06<00:18, 390.64it/s] 26%|█████████████████████████████████████▉                                                                                                            | 2533/9737 [00:07<00:18, 391.11it/s] 26%|██████████████████████████████████████▌                                                                                                           | 2573/9737 [00:07<00:18, 392.18it/s] 27%|███████████████████████████████████████▏                                                                                                          | 2613/9737 [00:07<00:18, 393.36it/s] 27%|███████████████████████████████████████▊                                                                                                          | 2653/9737 [00:07<00:17, 394.29it/s] 28%|████████████████████████████████████████▍                                                                                                         | 2693/9737 [00:07<00:17, 394.38it/s] 28%|████████████████████████████████████████▉                                                                                                         | 2733/9737 [00:07<00:17, 392.29it/s] 28%|█████████████████████████████████████████▌                                                                                                        | 2773/9737 [00:07<00:17, 393.14it/s] 29%|██████████████████████████████████████████▏                                                                                                       | 2813/9737 [00:07<00:17, 393.66it/s] 29%|██████████████████████████████████████████▊                                                                                                       | 2853/9737 [00:07<00:17, 394.37it/s] 30%|███████████████████████████████████████████▍                                                                                                      | 2893/9737 [00:07<00:17, 394.60it/s] 30%|███████████████████████████████████████████▉                                                                                                      | 2933/9737 [00:08<00:17, 392.19it/s] 31%|████████████████████████████████████████████▌                                                                                                     | 2973/9737 [00:08<00:17, 392.10it/s] 31%|█████████████████████████████████████████████▏                                                                                                    | 3013/9737 [00:08<00:17, 391.66it/s] 31%|█████████████████████████████████████████████▊                                                                                                    | 3053/9737 [00:08<00:17, 390.98it/s] 32%|██████████████████████████████████████████████▍                                                                                                   | 3093/9737 [00:08<00:16, 390.87it/s] 32%|██████████████████████████████████████████████▉                                                                                                   | 3133/9737 [00:08<00:16, 391.24it/s] 33%|███████████████████████████████████████████████▌                                                                                                  | 3173/9737 [00:08<00:16, 388.97it/s] 33%|████████████████████████████████████████████████▏                                                                                                 | 3213/9737 [00:08<00:16, 389.64it/s] 33%|████████████████████████████████████████████████▊                                                                                                 | 3253/9737 [00:08<00:16, 390.31it/s] 34%|█████████████████████████████████████████████████▍                                                                                                | 3293/9737 [00:08<00:16, 390.58it/s] 34%|█████████████████████████████████████████████████▉                                                                                                | 3333/9737 [00:09<00:16, 390.54it/s] 35%|██████████████████████████████████████████████████▌                                                                                               | 3373/9737 [00:09<00:16, 390.97it/s] 35%|███████████████████████████████████████████████████▏                                                                                              | 3413/9737 [00:09<00:16, 389.38it/s] 35%|███████████████████████████████████████████████████▊                                                                                              | 3453/9737 [00:09<00:16, 389.55it/s] 36%|████████████████████████████████████████████████████▍                                                                                             | 3493/9737 [00:09<00:16, 390.14it/s] 36%|████████████████████████████████████████████████████▉                                                                                             | 3533/9737 [00:09<00:15, 390.18it/s] 37%|█████████████████████████████████████████████████████▌                                                                                            | 3573/9737 [00:09<00:15, 390.14it/s] 37%|██████████████████████████████████████████████████████▏                                                                                           | 3613/9737 [00:09<00:15, 388.36it/s] 38%|██████████████████████████████████████████████████████▊                                                                                           | 3652/9737 [00:09<00:15, 388.79it/s] 38%|███████████████████████████████████████████████████████▎                                                                                          | 3692/9737 [00:09<00:15, 389.32it/s] 38%|███████████████████████████████████████████████████████▉                                                                                          | 3732/9737 [00:10<00:15, 390.14it/s] 39%|████████████████████████████████████████████████████████▌                                                                                         | 3772/9737 [00:10<00:15, 390.65it/s] 39%|█████████████████████████████████████████████████████████▏                                                                                        | 3812/9737 [00:10<00:15, 391.07it/s] 40%|█████████████████████████████████████████████████████████▊                                                                                        | 3852/9737 [00:10<00:15, 389.59it/s] 40%|██████████████████████████████████████████████████████████▎                                                                                       | 3892/9737 [00:10<00:14, 390.21it/s] 40%|██████████████████████████████████████████████████████████▉                                                                                       | 3932/9737 [00:10<00:14, 390.75it/s] 41%|███████████████████████████████████████████████████████████▌                                                                                      | 3972/9737 [00:10<00:14, 390.83it/s] 41%|████████████████████████████████████████████████████████████▏                                                                                     | 4012/9737 [00:10<00:14, 390.64it/s] 42%|████████████████████████████████████████████████████████████▊                                                                                     | 4052/9737 [00:10<00:14, 390.57it/s] 42%|█████████████████████████████████████████████████████████████▎                                                                                    | 4092/9737 [00:11<00:14, 389.39it/s] 42%|█████████████████████████████████████████████████████████████▉                                                                                    | 4132/9737 [00:11<00:14, 389.65it/s] 43%|██████████████████████████████████████████████████████████████▌                                                                                   | 4172/9737 [00:11<00:14, 390.13it/s] 43%|███████████████████████████████████████████████████████████████▏                                                                                  | 4212/9737 [00:11<00:14, 390.58it/s] 44%|███████████████████████████████████████████████████████████████▊                                                                                  | 4252/9737 [00:11<00:14, 390.86it/s] 44%|████████████████████████████████████████████████████████████████▎                                                                                 | 4292/9737 [00:11<00:13, 389.26it/s] 44%|████████████████████████████████████████████████████████████████▉                                                                                 | 4332/9737 [00:11<00:13, 389.72it/s] 45%|█████████████████████████████████████████████████████████████████▌                                                                                | 4372/9737 [00:11<00:13, 390.52it/s] 45%|██████████████████████████████████████████████████████████████████▏                                                                               | 4412/9737 [00:11<00:13, 390.23it/s] 46%|██████████████████████████████████████████████████████████████████▊                                                                               | 4452/9737 [00:11<00:13, 389.36it/s] 46%|███████████████████████████████████████████████████████████████████▎                                                                              | 4491/9737 [00:12<00:13, 389.51it/s] 47%|███████████████████████████████████████████████████████████████████▉                                                                              | 4530/9737 [00:12<00:14, 360.36it/s] 47%|████████████████████████████████████████████████████████████████████▌                                                                             | 4570/9737 [00:12<00:14, 368.85it/s] 47%|█████████████████████████████████████████████████████████████████████                                                                             | 4609/9737 [00:12<00:13, 374.86it/s] 48%|█████████████████████████████████████████████████████████████████████▋                                                                            | 4649/9737 [00:12<00:13, 379.34it/s] 48%|██████████████████████████████████████████████████████████████████████▎                                                                           | 4688/9737 [00:12<00:13, 381.67it/s] 49%|██████████████████████████████████████████████████████████████████████▉                                                                           | 4727/9737 [00:12<00:13, 383.27it/s] 49%|███████████████████████████████████████████████████████████████████████▍                                                                          | 4766/9737 [00:12<00:17, 292.09it/s] 49%|████████████████████████████████████████████████████████████████████████                                                                          | 4805/9737 [00:12<00:15, 315.47it/s] 50%|████████████████████████████████████████████████████████████████████████▋                                                                         | 4844/9737 [00:13<00:14, 333.94it/s] 50%|█████████████████████████████████████████████████████████████████████████▏                                                                        | 4883/9737 [00:13<00:13, 348.26it/s] 51%|█████████████████████████████████████████████████████████████████████████▊                                                                        | 4922/9737 [00:13<00:13, 359.30it/s] 51%|██████████████████████████████████████████████████████████████████████████▎                                                                       | 4960/9737 [00:13<00:13, 363.68it/s] 51%|██████████████████████████████████████████████████████████████████████████▉                                                                       | 4999/9737 [00:13<00:12, 370.92it/s] 52%|███████████████████████████████████████████████████████████████████████████▌                                                                      | 5039/9737 [00:13<00:12, 377.30it/s] 52%|████████████████████████████████████████████████████████████████████████████▏                                                                     | 5078/9737 [00:13<00:12, 380.73it/s] 53%|████████████████████████████████████████████████████████████████████████████▋                                                                     | 5118/9737 [00:13<00:12, 383.70it/s] 53%|█████████████████████████████████████████████████████████████████████████████▎                                                                    | 5158/9737 [00:13<00:11, 386.03it/s] 53%|█████████████████████████████████████████████████████████████████████████████▉                                                                    | 5197/9737 [00:13<00:11, 385.52it/s] 54%|██████████████████████████████████████████████████████████████████████████████▌                                                                   | 5237/9737 [00:14<00:11, 387.11it/s] 54%|███████████████████████████████████████████████████████████████████████████████▏                                                                  | 5277/9737 [00:14<00:11, 388.43it/s] 55%|███████████████████████████████████████████████████████████████████████████████▋                                                                  | 5317/9737 [00:14<00:11, 389.47it/s] 55%|████████████████████████████████████████████████████████████████████████████████▎                                                                 | 5357/9737 [00:14<00:11, 390.12it/s] 55%|████████████████████████████████████████████████████████████████████████████████▉                                                                 | 5397/9737 [00:14<00:11, 390.45it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▌                                                                | 5437/9737 [00:14<00:11, 389.15it/s] 56%|██████████████████████████████████████████████████████████████████████████████████                                                                | 5477/9737 [00:14<00:10, 390.37it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▋                                                               | 5518/9737 [00:14<00:10, 394.57it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▎                                                              | 5559/9737 [00:14<00:10, 397.73it/s] 58%|███████████████████████████████████████████████████████████████████████████████████▉                                                              | 5600/9737 [00:15<00:10, 398.87it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▌                                                             | 5640/9737 [00:15<00:10, 398.86it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▏                                                            | 5681/9737 [00:15<00:10, 400.89it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▊                                                            | 5722/9737 [00:15<00:09, 402.12it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▍                                                           | 5763/9737 [00:15<00:09, 402.96it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████                                                           | 5804/9737 [00:15<00:09, 403.56it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▋                                                          | 5845/9737 [00:15<00:09, 403.55it/s] 60%|████████████████████████████████████████████████████████████████████████████████████████▎                                                         | 5886/9737 [00:15<00:09, 401.48it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▊                                                         | 5927/9737 [00:15<00:09, 402.34it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▍                                                        | 5968/9737 [00:15<00:09, 403.18it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████                                                        | 6009/9737 [00:16<00:09, 403.63it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▋                                                       | 6050/9737 [00:16<00:09, 404.11it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▎                                                      | 6091/9737 [00:16<00:09, 402.68it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▉                                                      | 6132/9737 [00:16<00:08, 403.33it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▌                                                     | 6173/9737 [00:16<00:08, 404.07it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▏                                                    | 6214/9737 [00:16<00:08, 404.29it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▊                                                    | 6255/9737 [00:16<00:08, 404.15it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▍                                                   | 6296/9737 [00:16<00:08, 402.81it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████                                                   | 6337/9737 [00:16<00:08, 401.51it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▋                                                  | 6378/9737 [00:16<00:08, 402.33it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▏                                                 | 6419/9737 [00:17<00:08, 402.96it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▊                                                 | 6460/9737 [00:17<00:08, 403.09it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▍                                                | 6501/9737 [00:17<00:08, 403.51it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████                                                | 6542/9737 [00:17<00:07, 401.21it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▋                                               | 6583/9737 [00:17<00:07, 401.85it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▎                                              | 6624/9737 [00:17<00:07, 402.37it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▉                                              | 6665/9737 [00:17<00:07, 403.18it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▌                                             | 6706/9737 [00:17<00:07, 403.45it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████▏                                            | 6747/9737 [00:17<00:07, 403.96it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▊                                            | 6788/9737 [00:17<00:07, 402.46it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▍                                           | 6829/9737 [00:18<00:07, 403.07it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████                                           | 6870/9737 [00:18<00:07, 403.65it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▋                                          | 6911/9737 [00:18<00:06, 403.86it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                         | 6952/9737 [00:18<00:06, 404.04it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                         | 6993/9737 [00:18<00:06, 399.35it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                        | 7034/9737 [00:18<00:06, 400.64it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████                                        | 7075/9737 [00:18<00:06, 401.94it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                       | 7116/9737 [00:18<00:06, 402.77it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                      | 7157/9737 [00:18<00:06, 403.55it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                      | 7198/9737 [00:18<00:06, 404.07it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                     | 7239/9737 [00:19<00:06, 402.34it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                    | 7280/9737 [00:19<00:06, 403.00it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                    | 7321/9737 [00:19<00:05, 403.60it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                   | 7362/9737 [00:19<00:05, 402.40it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████                                   | 7403/9737 [00:19<00:05, 402.24it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                  | 7444/9737 [00:19<00:06, 378.88it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 7485/9737 [00:19<00:05, 385.69it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                 | 7526/9737 [00:19<00:05, 390.72it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                | 7567/9737 [00:19<00:05, 394.87it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                | 7608/9737 [00:20<00:05, 397.63it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                               | 7648/9737 [00:20<00:05, 395.53it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                              | 7688/9737 [00:20<00:05, 396.07it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                              | 7729/9737 [00:20<00:05, 398.96it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                             | 7770/9737 [00:20<00:04, 400.43it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                             | 7811/9737 [00:20<00:04, 401.52it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                            | 7852/9737 [00:20<00:04, 402.66it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                           | 7893/9737 [00:20<00:04, 403.61it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                           | 7934/9737 [00:20<00:04, 402.10it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                          | 7975/9737 [00:20<00:04, 402.98it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                         | 8016/9737 [00:21<00:04, 403.51it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                         | 8057/9737 [00:21<00:04, 403.69it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                        | 8098/9737 [00:21<00:04, 404.13it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                        | 8139/9737 [00:21<00:03, 402.77it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                       | 8180/9737 [00:21<00:03, 403.19it/s] 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                      | 8221/9737 [00:21<00:03, 403.74it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                      | 8262/9737 [00:21<00:03, 403.53it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                     | 8303/9737 [00:21<00:03, 403.11it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                     | 8344/9737 [00:21<00:03, 399.81it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                    | 8384/9737 [00:21<00:03, 397.69it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                   | 8425/9737 [00:22<00:03, 399.75it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                   | 8466/9737 [00:22<00:03, 401.05it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 8507/9737 [00:22<00:03, 402.00it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                 | 8548/9737 [00:22<00:02, 402.22it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                 | 8589/9737 [00:22<00:02, 400.34it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                | 8630/9737 [00:22<00:02, 401.19it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                | 8671/9737 [00:22<00:02, 401.99it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋               | 8712/9737 [00:22<00:02, 402.79it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏              | 8753/9737 [00:22<00:02, 402.97it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊              | 8794/9737 [00:22<00:02, 403.22it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍             | 8835/9737 [00:23<00:02, 401.86it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████             | 8876/9737 [00:23<00:02, 402.52it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋            | 8917/9737 [00:23<00:02, 403.01it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎           | 8958/9737 [00:23<00:01, 403.24it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉           | 8999/9737 [00:23<00:01, 403.33it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌          | 9040/9737 [00:23<00:01, 397.88it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏         | 9081/9737 [00:23<00:01, 399.21it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 9122/9737 [00:23<00:01, 400.42it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍        | 9163/9737 [00:23<00:01, 401.59it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████        | 9204/9737 [00:23<00:01, 402.39it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 9245/9737 [00:24<00:01, 402.91it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏      | 9286/9737 [00:24<00:01, 401.38it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊      | 9327/9737 [00:24<00:01, 402.06it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍     | 9368/9737 [00:24<00:00, 402.26it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 9409/9737 [00:24<00:00, 402.23it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋    | 9450/9737 [00:24<00:00, 402.45it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎   | 9491/9737 [00:24<00:00, 400.57it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉   | 9532/9737 [00:24<00:00, 400.86it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 9573/9737 [00:24<00:00, 400.95it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏ | 9614/9737 [00:25<00:00, 400.88it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊ | 9655/9737 [00:25<00:00, 401.12it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍| 9696/9737 [00:25<00:00, 401.74it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9737/9737 [00:25<00:00, 400.19it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9737/9737 [00:25<00:00, 384.71it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.06s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.12s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.14s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.03s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.15s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.04s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.23s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.61s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.42s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.60s/it]
[2023-08-11 02:29:06,951] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.63s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]
[2023-08-11 02:29:16,179] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 02:29:16,180] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fa0cf731e80>
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 02:29:16,180] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fa0cf5f4910>
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 02:29:16,181] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 02:29:16,181] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.49608659744262695 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.40462255477905273 seconds
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Fabric is cut to order at what type of seller? Choices:  A: curtains B: tailor shop C: clothing store D: sewing room E: hardware store
Rationales: 1. Start by understanding the question: where is fabric cut to order? This means we are looking for a place where fabric is specifically cut based on individual requirements.
2. Now, we can eliminate some of the choices based on our understanding of the question.
3. Looking at option A: curtains. This is not a type of seller but a type of product. Hence it cannot be the answer.
4. Next, option C: clothing store. Though fabric is used here, it's mostly for ready-made clothes. They do not typically cut fabric to individual specifications. So, this is incorrect.
5. Option D: sewing room. This is a place where fabric could potentially be cut, but it is not a type of seller. It's more of a workspace for sewing. 
6. Option E: hardware store. This is a place where one can buy hardware goods, not fabric. So, this option doesn't fit the criteria.
7. That leaves us with option B: tailor shop. Tailors measure and cut fabric to fit their individual customers. They definitely fall under the type of sellers that cut fabric to order.
8. Therefore, the answer is B: tailor shop.
Answer: B: tailor shop

Input: Where are you if your reading magazines while waiting for a vehicle on rails? Choices:  A: vegetables B: market C: doctor D: train station E: bookstore
Rationales: 1. The question mentions that you're waiting for a vehicle on rails.
2. Among all the given choices, vegetables, market, doctor, bookstore, and train station,
3. Only vehicles that run on rails, called trains, are found at train stations.
4. Thus, the answer is a train station.
Answer: D: train station

Input: What would need oil to be used? Choices:  A: ground B: human  body C: repair shop D: combustion engines E: service station
Rationales: Reasoning:

The question is asking what would need oil to be used among the given choices.

Looking at the options:
A: The ground - Even though there's oil in the ground (crude oil), it doesn't need oil to function or be used. So, A can be eliminated.
B: Human body - Humans need fats and oils in their diet for health, yet this is different from the oil mentioned in the question. So we can eliminate B.
C: Repair shop - A repair shop might use oil for some machines or vehicles, but it's not the shop itself that needs the oil. Therefore, C can be eliminated.
D: Combustion engines - They need oil for lubrication, cooling, cleaning and internal functionality. The presence of oil in a combustion engine prevents overheating and reduces wear on moving parts. It is needed to function properly.
E: Service station - Same as with a repair shop, a service station might sell oil or use it in servicing vehicles, but the station itself does not directly need oil to operate. Thus, E can be eliminated. 

So, the best choice among the given options is D: Combustion engines, which necessarily need oil to operate smoothly.
Answer: D: combustion engines

Input: What is person probably feeling that plans on stopping being married to their spouse? Choices:  A: detachment B: bankruptcy C: sad D: fights E: wrong
Rationales: Step 1: Analyze the question, which is asking for the probable emotional state of someone who's considering or planning to end their marriage.
Step 2: Understanding the process of stopping being married to someone can indicate the person is feeling emotional disconnect which can be described as detachment.
Step 3: Evaluate each choice individually:
 A: Detachment - This is a feeling of emotional disconnect or withdrawal, which is likely if someone is considering ending their marriage.
 B: Bankruptcy - This is a financial state, not a feeling.
 C: Sad - Although sadness is likely present, the question is more about a particular emotional state that would make someone consider ending their marriage.
 D: Fights - These are conflicts or arguments, not an emotional state per se.
 E: Wrong - This could be a state of moral judgement rather than an emotional state.
Step 4: Based on the evaluation in step 3, the choice that best fits the question is A: detachment. So, the answer is A: detachment.
Answer: A: detachment

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i4-s10-rTrue
Time to load utils op: 0.40451788902282715 seconds
Loading extension module utils...
Time to load utils op: 0.40444493293762207 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:43<35:46, 43.81s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:27<35:06, 43.88s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:11<34:10, 43.63s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:54<33:20, 43.48s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:37<32:37, 43.50s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:21<31:58, 43.60s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:04<31:06, 43.41s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:47<30:21, 43.37s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:31<29:34, 43.28s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:13<28:45, 43.13s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:57<28:02, 43.15s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:40<27:23, 43.24s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:23<26:42, 43.32s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:07<26:00, 43.35s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:51<25:20, 43.45s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:33<24:31, 43.27s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:17<23:48, 43.30s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:00<23:06, 43.33s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [13:43<22:17, 43.16s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:26<21:35, 43.19s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:10<20:53, 43.22s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [15:53<20:08, 43.18s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [16:36<19:26, 43.21s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [17:20<18:46, 43.34s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:00<17:38, 42.34s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [18:42<17:00, 42.51s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [19:16<15:18, 39.95s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:59<14:58, 40.86s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:43<14:33, 41.61s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:26<14:02, 42.10s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [22:10<13:28, 42.58s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:54<12:53, 42.95s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:37<12:11, 43.04s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [24:21<11:33, 43.32s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [25:04<10:50, 43.35s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [25:48<10:07, 43.39s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [26:19<08:35, 39.65s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:50<07:25, 37.14s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [27:34<07:10, 39.14s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [28:17<06:42, 40.29s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [29:00<06:10, 41.21s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [29:43<05:33, 41.72s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [30:26<04:55, 42.28s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [31:09<04:14, 42.48s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [31:49<03:28, 41.72s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [32:33<02:49, 42.26s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [33:16<02:07, 42.53s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [33:54<01:22, 41.24s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [34:38<00:42, 42.06s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:22<00:00, 42.48s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:22<00:00, 42.44s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 2.8094} | lm_loss 7.4534 | avg. gen lenth: 314.752
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s10-rFalse --seed 10 --num-in-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 03:05:13,978] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 1
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9740 [00:00<?, ?it/s]  2%|███▍                                                                                                                                              | 232/9740 [00:00<00:04, 2315.64it/s]  5%|███████                                                                                                                                           | 468/9740 [00:00<00:03, 2340.92it/s]  7%|██████████▌                                                                                                                                       | 704/9740 [00:00<00:03, 2348.22it/s] 10%|██████████████                                                                                                                                    | 942/9740 [00:00<00:03, 2359.12it/s] 12%|█████████████████▌                                                                                                                               | 1180/9740 [00:00<00:03, 2365.85it/s] 15%|█████████████████████                                                                                                                            | 1417/9740 [00:00<00:03, 2365.81it/s] 17%|████████████████████████▋                                                                                                                        | 1655/9740 [00:00<00:03, 2368.39it/s] 19%|████████████████████████████▏                                                                                                                    | 1892/9740 [00:00<00:03, 2343.76it/s] 22%|███████████████████████████████▋                                                                                                                 | 2127/9740 [00:00<00:03, 2286.15it/s] 24%|███████████████████████████████████▏                                                                                                             | 2362/9740 [00:01<00:03, 2303.25it/s] 27%|██████████████████████████████████████▋                                                                                                          | 2598/9740 [00:01<00:03, 2319.92it/s] 29%|██████████████████████████████████████████▏                                                                                                      | 2831/9740 [00:01<00:02, 2319.81it/s] 31%|█████████████████████████████████████████████▋                                                                                                   | 3066/9740 [00:01<00:02, 2326.97it/s] 34%|█████████████████████████████████████████████████▏                                                                                               | 3303/9740 [00:01<00:02, 2338.61it/s] 36%|████████████████████████████████████████████████████▋                                                                                            | 3537/9740 [00:01<00:02, 2338.74it/s] 39%|████████████████████████████████████████████████████████▏                                                                                        | 3773/9740 [00:01<00:02, 2344.24it/s] 41%|███████████████████████████████████████████████████████████▋                                                                                     | 4008/9740 [00:01<00:02, 2326.21it/s] 44%|███████████████████████████████████████████████████████████████▏                                                                                 | 4244/9740 [00:01<00:02, 2335.23it/s] 46%|██████████████████████████████████████████████████████████████████▋                                                                              | 4479/9740 [00:01<00:02, 2337.65it/s] 48%|██████████████████████████████████████████████████████████████████████▏                                                                          | 4713/9740 [00:02<00:02, 2315.80it/s] 51%|█████████████████████████████████████████████████████████████████████████▌                                                                       | 4945/9740 [00:02<00:02, 1663.11it/s] 53%|█████████████████████████████████████████████████████████████████████████████▏                                                                   | 5181/9740 [00:02<00:02, 1825.39it/s] 56%|████████████████████████████████████████████████████████████████████████████████▋                                                                | 5418/9740 [00:02<00:02, 1959.91it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▎                                                            | 5661/9740 [00:02<00:01, 2083.35it/s] 61%|███████████████████████████████████████████████████████████████████████████████████████▉                                                         | 5908/9740 [00:02<00:01, 2188.40it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▋                                                     | 6156/9740 [00:02<00:01, 2267.69it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▎                                                 | 6401/9740 [00:02<00:01, 2319.12it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                                              | 6647/9740 [00:02<00:01, 2357.50it/s] 71%|██████████████████████████████████████████████████████████████████████████████████████████████████████▋                                          | 6896/9740 [00:03<00:01, 2393.80it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                      | 7145/9740 [00:03<00:01, 2419.68it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████                                   | 7394/9740 [00:03<00:00, 2439.22it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                               | 7640/9740 [00:03<00:00, 2418.16it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                           | 7886/9740 [00:03<00:00, 2429.72it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                       | 8201/9740 [00:03<00:00, 2641.85it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 8579/9740 [00:03<00:00, 2979.01it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎           | 8957/9740 [00:03<00:00, 3216.48it/s] 96%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉      | 9333/9740 [00:03<00:00, 3378.73it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌| 9710/9740 [00:03<00:00, 3495.06it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9740/9740 [00:03<00:00, 2454.34it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.88s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.35s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.66s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:06<00:12,  6.39s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.96s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.42s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.59s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.91s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.31s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.22s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.33s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.10s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.37s/it]
[2023-08-11 03:06:11,438] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-11 03:06:21,550] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 03:06:21,550] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fa994f07e80>
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 03:06:21,551] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fa99498c910>
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 03:06:21,552] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 03:06:21,553] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 03:06:21,553] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 03:06:21,553] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4140965938568115 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Fabric is cut to order at what type of seller? Choices:  A: curtains B: tailor shop C: clothing store D: sewing room E: hardware store
Answer: B: tailor shop

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.4044828414916992 seconds
Loading extension module utils...
Time to load utils op: 0.4046342372894287 seconds
Loading extension module utils...
Time to load utils op: 0.4046621322631836 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:40<33:05, 40.52s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:38<40:43, 50.90s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:36<42:26, 54.19s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:29<41:11, 53.74s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:27<41:24, 55.20s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [05:11<37:34, 51.24s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [06:07<37:53, 52.88s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:57<36:24, 52.02s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:27<30:50, 45.14s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:25<32:41, 49.04s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [09:24<33:47, 51.98s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [10:11<31:59, 50.50s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [10:33<25:54, 42.00s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [11:25<26:55, 44.88s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [12:22<28:23, 48.68s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [12:52<24:24, 43.07s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [13:49<25:59, 47.25s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [14:22<22:52, 42.89s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:46<19:11, 37.15s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:44<21:40, 43.36s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:34<21:58, 45.45s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [17:29<22:36, 48.44s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [18:26<22:56, 50.97s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [19:23<22:52, 52.78s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [20:21<22:40, 54.43s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [21:02<20:05, 50.23s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [22:00<20:12, 52.71s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [22:59<19:58, 54.49s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [23:17<15:17, 43.69s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [24:16<16:02, 48.15s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [24:42<13:06, 41.38s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [25:37<13:39, 45.54s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [26:34<13:54, 49.09s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [27:15<12:23, 46.46s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [27:36<09:43, 38.91s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [28:06<08:26, 36.15s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [28:42<07:51, 36.27s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [29:10<06:44, 33.67s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:39<05:54, 32.22s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [30:37<06:40, 40.03s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [31:33<06:44, 44.98s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:47<04:45, 35.67s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [32:46<04:57, 42.47s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [33:26<04:11, 41.97s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:51<03:04, 36.85s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:47<02:50, 42.62s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [35:45<02:21, 47.20s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [36:44<01:41, 50.64s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [37:40<00:52, 52.30s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [38:23<00:00, 49.53s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [38:23<00:00, 46.07s/it]
name: commonsenseqa | {'exact_match': 1.2, 'rougeL': 4.6277} | lm_loss 7.1774 | avg. gen lenth: 179.6
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s10-rFalse --seed 10 --num-in-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 03:47:17,819] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 2
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9739 [00:00<?, ?it/s]  2%|██▊                                                                                                                                               | 185/9739 [00:00<00:05, 1848.67it/s]  4%|█████▌                                                                                                                                            | 372/9739 [00:00<00:05, 1860.04it/s]  6%|████████▍                                                                                                                                         | 560/9739 [00:00<00:04, 1868.83it/s]  8%|███████████▏                                                                                                                                      | 749/9739 [00:00<00:04, 1874.76it/s] 10%|██████████████                                                                                                                                    | 939/9739 [00:00<00:04, 1881.35it/s] 12%|████████████████▊                                                                                                                                | 1128/9739 [00:00<00:04, 1884.07it/s] 14%|███████████████████▌                                                                                                                             | 1317/9739 [00:00<00:04, 1883.59it/s] 15%|██████████████████████▍                                                                                                                          | 1506/9739 [00:00<00:04, 1881.10it/s] 17%|█████████████████████████▏                                                                                                                       | 1695/9739 [00:00<00:04, 1881.61it/s] 19%|████████████████████████████                                                                                                                     | 1884/9739 [00:01<00:04, 1802.17it/s] 21%|██████████████████████████████▊                                                                                                                  | 2070/9739 [00:01<00:04, 1818.96it/s] 23%|█████████████████████████████████▌                                                                                                               | 2257/9739 [00:01<00:04, 1832.73it/s] 25%|████████████████████████████████████▍                                                                                                            | 2447/9739 [00:01<00:03, 1850.18it/s] 27%|███████████████████████████████████████▏                                                                                                         | 2634/9739 [00:01<00:03, 1855.99it/s] 29%|█████████████████████████████████████████▉                                                                                                       | 2820/9739 [00:01<00:03, 1855.03it/s] 31%|████████████████████████████████████████████▊                                                                                                    | 3009/9739 [00:01<00:03, 1863.24it/s] 33%|███████████████████████████████████████████████▌                                                                                                 | 3197/9739 [00:01<00:03, 1866.80it/s] 35%|██████████████████████████████████████████████████▍                                                                                              | 3385/9739 [00:01<00:03, 1868.88it/s] 37%|█████████████████████████████████████████████████████▏                                                                                           | 3572/9739 [00:01<00:03, 1869.04it/s] 39%|███████████████████████████████████████████████████████▉                                                                                         | 3759/9739 [00:02<00:03, 1863.76it/s] 41%|██████████████████████████████████████████████████████████▊                                                                                      | 3946/9739 [00:02<00:03, 1863.76it/s] 42%|█████████████████████████████████████████████████████████████▌                                                                                   | 4134/9739 [00:02<00:03, 1867.05it/s] 45%|█████████████████████████████████████████████████████████████████▍                                                                               | 4392/9739 [00:02<00:02, 2078.49it/s] 48%|█████████████████████████████████████████████████████████████████████▍                                                                           | 4662/9739 [00:02<00:02, 2264.14it/s] 50%|████████████████████████████████████████████████████████████████████████▊                                                                        | 4889/9739 [00:02<00:02, 1842.08it/s] 53%|████████████████████████████████████████████████████████████████████████████▉                                                                    | 5171/9739 [00:02<00:02, 2091.11it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▏                                                               | 5453/9739 [00:02<00:01, 2286.78it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▌                                                           | 5749/9739 [00:02<00:01, 2472.73it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████                                                       | 6048/9739 [00:02<00:01, 2619.42it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▍                                                  | 6346/9739 [00:03<00:01, 2721.37it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                                              | 6644/9739 [00:03<00:01, 2796.20it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▎                                         | 6935/9739 [00:03<00:00, 2827.17it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                     | 7234/9739 [00:03<00:00, 2875.22it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                 | 7524/9739 [00:03<00:00, 2867.63it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                            | 7823/9739 [00:03<00:00, 2903.87it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                        | 8122/9739 [00:03<00:00, 2928.93it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                   | 8423/9739 [00:03<00:00, 2951.09it/s] 90%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊               | 8723/9739 [00:03<00:00, 2962.72it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎          | 9024/9739 [00:04<00:00, 2975.90it/s] 96%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊      | 9322/9739 [00:04<00:00, 2975.04it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏ | 9620/9739 [00:04<00:00, 2961.43it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9739/9739 [00:04<00:00, 2294.24it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.98s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.39s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.88s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.91s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.87s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.58s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.62s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:12<00:06,  6.35s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.26s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.43s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.90s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.06s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.98s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.18s/it]
[2023-08-11 03:48:15,905] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:18<00:00,  6.19s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:18<00:00,  6.19s/it]
[2023-08-11 03:48:32,162] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 03:48:32,163] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 03:48:32,164] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 03:48:32,164] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 03:48:32,164] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 03:48:32,164] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 03:48:32,164] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 03:48:32,164] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 03:48:32,164] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 03:48:32,164] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 03:48:32,164] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f5abdae2e80>
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 03:48:32,165] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f5abd52a910>
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 03:48:32,166] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 03:48:32,166] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.36197948455810547 seconds
Loading extension module utils...
Time to load utils op: 0.3044583797454834 seconds
Loading extension module utils...
Time to load utils op: 0.3045923709869385 seconds
Loading extension module utils...
Time to load utils op: 0.3041391372680664 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Fabric is cut to order at what type of seller? Choices:  A: curtains B: tailor shop C: clothing store D: sewing room E: hardware store
Answer: B: tailor shop

Input: Where are you if your reading magazines while waiting for a vehicle on rails? Choices:  A: vegetables B: market C: doctor D: train station E: bookstore
Answer: D: train station

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s10-rFalse
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:58<47:50, 58.57s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:55<46:08, 57.68s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:52<44:50, 57.25s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:49<43:47, 57.12s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:26<37:32, 50.06s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:57<31:55, 43.53s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:13<24:45, 34.56s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:10<29:14, 41.77s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:43<26:34, 38.90s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:06<22:44, 34.12s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:05<26:58, 41.50s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:42<25:32, 40.34s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:12<22:46, 36.94s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:22<17:22, 28.96s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:11<20:27, 35.07s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:08<23:29, 41.47s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:05<25:28, 46.33s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:03<26:28, 49.63s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [13:22<21:00, 40.67s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:18<22:30, 45.02s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:15<23:31, 48.66s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:12<23:54, 51.24s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:02<22:56, 51.00s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:00<22:59, 53.06s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:58<22:40, 54.41s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:40<20:14, 50.62s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:27<18:59, 49.53s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [20:45<14:43, 40.18s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [21:42<15:51, 45.32s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:58<12:09, 36.50s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [22:48<12:49, 40.48s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [23:26<11:56, 39.82s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [24:20<12:25, 43.87s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:17<12:49, 48.08s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:15<12:44, 50.95s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [27:12<12:17, 52.71s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [27:59<11:02, 50.98s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [28:41<09:41, 48.45s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:37<09:17, 50.70s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [30:34<08:46, 52.63s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [31:30<08:01, 53.49s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:48<05:43, 42.90s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [32:46<05:30, 47.25s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [33:43<05:01, 50.22s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [34:41<04:22, 52.52s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [35:31<03:27, 51.82s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [36:26<02:38, 52.90s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [37:22<01:47, 53.86s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [38:18<00:54, 54.52s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:15<00:00, 55.26s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:15<00:00, 47.12s/it]
name: commonsenseqa | {'exact_match': 1.6, 'rougeL': 5.8001} | lm_loss 7.1373 | avg. gen lenth: 179.808
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i3-s10-rFalse --seed 10 --num-in-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 04:27:56,849] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i3-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 3
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i3-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9738 [00:00<?, ?it/s]  2%|██▎                                                                                                                                               | 154/9738 [00:00<00:06, 1538.98it/s]  3%|████▋                                                                                                                                             | 309/9738 [00:00<00:06, 1542.09it/s]  5%|██████▉                                                                                                                                           | 465/9738 [00:00<00:05, 1549.52it/s]  6%|█████████▎                                                                                                                                        | 621/9738 [00:00<00:05, 1553.58it/s]  8%|███████████▋                                                                                                                                      | 778/9738 [00:00<00:05, 1556.30it/s] 10%|██████████████                                                                                                                                    | 935/9738 [00:00<00:05, 1558.51it/s] 11%|████████████████▎                                                                                                                                | 1093/9738 [00:00<00:05, 1564.55it/s] 13%|██████████████████▌                                                                                                                              | 1250/9738 [00:00<00:05, 1562.76it/s] 14%|████████████████████▉                                                                                                                            | 1407/9738 [00:00<00:05, 1526.41it/s] 16%|███████████████████████▎                                                                                                                         | 1563/9738 [00:01<00:05, 1531.55it/s] 18%|█████████████████████████▌                                                                                                                       | 1720/9738 [00:01<00:05, 1541.46it/s] 19%|███████████████████████████▉                                                                                                                     | 1875/9738 [00:01<00:05, 1511.43it/s] 21%|██████████████████████████████▏                                                                                                                  | 2030/9738 [00:01<00:05, 1521.11it/s] 22%|████████████████████████████████▌                                                                                                                | 2186/9738 [00:01<00:04, 1529.74it/s] 24%|██████████████████████████████████▊                                                                                                              | 2342/9738 [00:01<00:04, 1537.38it/s] 26%|█████████████████████████████████████▏                                                                                                           | 2499/9738 [00:01<00:04, 1543.91it/s] 27%|███████████████████████████████████████▌                                                                                                         | 2655/9738 [00:01<00:04, 1548.01it/s] 29%|█████████████████████████████████████████▊                                                                                                       | 2810/9738 [00:01<00:04, 1546.24it/s] 30%|████████████████████████████████████████████▏                                                                                                    | 2965/9738 [00:01<00:04, 1543.78it/s] 32%|██████████████████████████████████████████████▍                                                                                                  | 3120/9738 [00:02<00:04, 1544.36it/s] 34%|████████████████████████████████████████████████▊                                                                                                | 3276/9738 [00:02<00:04, 1548.65it/s] 35%|███████████████████████████████████████████████████                                                                                              | 3432/9738 [00:02<00:04, 1550.31it/s] 37%|█████████████████████████████████████████████████████▍                                                                                           | 3588/9738 [00:02<00:03, 1548.61it/s] 38%|███████████████████████████████████████████████████████▊                                                                                         | 3745/9738 [00:02<00:03, 1552.87it/s] 41%|██████████████████████████████████████████████████████████▊                                                                                      | 3950/9738 [00:02<00:03, 1699.98it/s] 43%|██████████████████████████████████████████████████████████████▎                                                                                  | 4186/9738 [00:02<00:02, 1897.06it/s] 45%|█████████████████████████████████████████████████████████████████▊                                                                               | 4422/9738 [00:02<00:02, 2034.18it/s] 48%|█████████████████████████████████████████████████████████████████████▏                                                                           | 4646/9738 [00:02<00:02, 2093.54it/s] 50%|████████████████████████████████████████████████████████████████████████▎                                                                        | 4856/9738 [00:03<00:02, 1642.30it/s] 52%|███████████████████████████████████████████████████████████████████████████▊                                                                     | 5091/9738 [00:03<00:02, 1819.61it/s] 55%|███████████████████████████████████████████████████████████████████████████████▎                                                                 | 5327/9738 [00:03<00:02, 1960.07it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▉                                                              | 5566/9738 [00:03<00:02, 2076.36it/s] 60%|██████████████████████████████████████████████████████████████████████████████████████▌                                                          | 5813/9738 [00:03<00:01, 2186.08it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▏                                                      | 6061/9738 [00:03<00:01, 2268.95it/s] 65%|█████████████████████████████████████████████████████████████████████████████████████████████▊                                                   | 6304/9738 [00:03<00:01, 2314.10it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▌                                               | 6550/9738 [00:03<00:01, 2353.71it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▏                                           | 6797/9738 [00:03<00:01, 2386.24it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                        | 7045/9738 [00:03<00:01, 2413.18it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                    | 7293/9738 [00:04<00:01, 2432.16it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                | 7538/9738 [00:04<00:00, 2407.34it/s] 80%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                             | 7785/9738 [00:04<00:00, 2423.60it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                         | 8033/9738 [00:04<00:00, 2440.19it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                     | 8280/9738 [00:04<00:00, 2447.75it/s] 88%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                  | 8527/9738 [00:04<00:00, 2452.97it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋              | 8774/9738 [00:04<00:00, 2457.09it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎          | 9022/9738 [00:04<00:00, 2461.82it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████       | 9269/9738 [00:04<00:00, 2461.17it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋   | 9516/9738 [00:04<00:00, 2440.39it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9738/9738 [00:05<00:00, 1940.04it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.11s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.44s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.96s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.41s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.33s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.51s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.85s/it]
[2023-08-11 04:28:53,600] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.73s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
[2023-08-11 04:29:02,131] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 04:29:02,132] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 04:29:02,133] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 04:29:02,133] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 04:29:02,133] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 04:29:02,133] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 04:29:02,133] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 04:29:02,133] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 04:29:02,133] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 04:29:02,133] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fb8f43f9e80>
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 04:29:02,134] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fb8f209b910>
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 04:29:02,135] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 04:29:02,135] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.351276159286499 seconds
Loading extension module utils...
Time to load utils op: 0.20411062240600586 seconds
Loading extension module utils...
Time to load utils op: 0.30432939529418945 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Fabric is cut to order at what type of seller? Choices:  A: curtains B: tailor shop C: clothing store D: sewing room E: hardware store
Answer: B: tailor shop

Input: Where are you if your reading magazines while waiting for a vehicle on rails? Choices:  A: vegetables B: market C: doctor D: train station E: bookstore
Answer: D: train station

Input: What would need oil to be used? Choices:  A: ground B: human  body C: repair shop D: combustion engines E: service station
Answer: D: combustion engines

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i3-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.30413389205932617 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:23<19:07, 23.42s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:20<34:26, 43.05s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [01:39<25:19, 32.34s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:00<21:07, 27.55s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [02:56<28:33, 38.09s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [03:47<31:06, 42.41s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:43<33:27, 46.68s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:08<28:02, 40.06s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:06<31:02, 45.42s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [06:45<28:57, 43.43s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:19<26:22, 40.58s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:14<28:34, 45.11s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [08:33<22:59, 37.27s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:31<26:05, 43.50s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:27<27:33, 47.25s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:13<26:29, 46.76s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:41<22:35, 41.08s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [11:52<17:07, 32.11s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [12:48<20:19, 39.35s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [13:36<20:54, 41.83s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [14:31<22:07, 45.78s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [15:25<22:32, 48.31s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [16:20<22:40, 50.40s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [17:16<22:32, 52.02s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:12<22:06, 53.07s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:08<21:34, 53.93s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [19:27<16:42, 43.57s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:50<13:41, 37.34s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:46<15:04, 43.08s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:11<12:30, 37.55s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [22:07<13:41, 43.22s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:35<11:32, 38.46s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:05<10:12, 36.04s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [23:52<10:27, 39.22s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:49<11:07, 44.52s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [25:40<10:52, 46.62s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [26:18<09:33, 44.13s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [27:16<09:37, 48.11s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [27:48<07:55, 43.23s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [28:45<07:53, 47.38s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [29:18<06:27, 43.04s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [30:14<06:16, 47.03s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [31:10<05:48, 49.79s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [31:39<04:20, 43.36s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [32:19<03:31, 42.32s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [32:57<02:44, 41.19s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [33:55<02:18, 46.09s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [34:27<01:24, 42.10s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [35:23<00:46, 46.26s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [36:00<00:00, 43.53s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [36:00<00:00, 43.22s/it]
name: commonsenseqa | {'exact_match': 1.2, 'rougeL': 4.7241} | lm_loss 7.0993 | avg. gen lenth: 164.508
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i4-s10-rFalse --seed 10 --num-in-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 05:06:55,631] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i4-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 4
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i4-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9737 [00:00<?, ?it/s]  1%|█▉                                                                                                                                                | 127/9737 [00:00<00:07, 1269.78it/s]  3%|███▊                                                                                                                                              | 255/9737 [00:00<00:07, 1272.42it/s]  4%|█████▊                                                                                                                                            | 384/9737 [00:00<00:07, 1280.11it/s]  5%|███████▋                                                                                                                                          | 513/9737 [00:00<00:07, 1281.11it/s]  7%|█████████▋                                                                                                                                        | 642/9737 [00:00<00:07, 1282.97it/s]  8%|███████████▌                                                                                                                                      | 771/9737 [00:00<00:06, 1284.36it/s]  9%|█████████████▍                                                                                                                                    | 900/9737 [00:00<00:06, 1285.04it/s] 11%|███████████████▎                                                                                                                                 | 1029/9737 [00:00<00:06, 1285.83it/s] 12%|█████████████████▏                                                                                                                               | 1158/9737 [00:00<00:06, 1256.16it/s] 13%|███████████████████▏                                                                                                                             | 1286/9737 [00:01<00:06, 1262.46it/s] 15%|█████████████████████                                                                                                                            | 1415/9737 [00:01<00:06, 1268.09it/s] 16%|██████████████████████▉                                                                                                                          | 1544/9737 [00:01<00:06, 1273.06it/s] 17%|████████████████████████▉                                                                                                                        | 1673/9737 [00:01<00:06, 1277.71it/s] 18%|██████████████████████████▊                                                                                                                      | 1801/9737 [00:01<00:06, 1254.52it/s] 20%|████████████████████████████▋                                                                                                                    | 1929/9737 [00:01<00:06, 1261.82it/s] 21%|██████████████████████████████▋                                                                                                                  | 2057/9737 [00:01<00:06, 1266.40it/s] 22%|████████████████████████████████▌                                                                                                                | 2186/9737 [00:01<00:05, 1270.69it/s] 24%|██████████████████████████████████▍                                                                                                              | 2315/9737 [00:01<00:05, 1274.19it/s] 25%|████████████████████████████████████▍                                                                                                            | 2443/9737 [00:01<00:05, 1273.63it/s] 26%|██████████████████████████████████████▎                                                                                                          | 2571/9737 [00:02<00:05, 1271.20it/s] 28%|████████████████████████████████████████▏                                                                                                        | 2700/9737 [00:02<00:05, 1273.71it/s] 29%|██████████████████████████████████████████                                                                                                       | 2828/9737 [00:02<00:05, 1274.89it/s] 31%|████████████████████████████████████████████▋                                                                                                    | 3004/9737 [00:02<00:04, 1418.19it/s] 33%|███████████████████████████████████████████████▋                                                                                                 | 3200/9737 [00:02<00:04, 1579.57it/s] 35%|██████████████████████████████████████████████████▌                                                                                              | 3395/9737 [00:02<00:03, 1689.61it/s] 37%|█████████████████████████████████████████████████████▍                                                                                           | 3591/9737 [00:02<00:03, 1768.95it/s] 39%|████████████████████████████████████████████████████████▎                                                                                        | 3785/9737 [00:02<00:03, 1818.48it/s] 41%|███████████████████████████████████████████████████████████▎                                                                                     | 3981/9737 [00:02<00:03, 1860.16it/s] 43%|██████████████████████████████████████████████████████████████▏                                                                                  | 4177/9737 [00:02<00:02, 1888.82it/s] 45%|█████████████████████████████████████████████████████████████████                                                                                | 4368/9737 [00:03<00:02, 1894.79it/s] 47%|███████████████████████████████████████████████████████████████████▉                                                                             | 4558/9737 [00:03<00:02, 1860.48it/s] 49%|██████████████████████████████████████████████████████████████████████▋                                                                          | 4745/9737 [00:03<00:03, 1427.80it/s] 51%|█████████████████████████████████████████████████████████████████████████▍                                                                       | 4933/9737 [00:03<00:03, 1538.01it/s] 53%|████████████████████████████████████████████████████████████████████████████▎                                                                    | 5128/9737 [00:03<00:02, 1643.13it/s] 55%|███████████████████████████████████████████████████████████████████████████████▎                                                                 | 5323/9737 [00:03<00:02, 1725.34it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▏                                                              | 5520/9737 [00:03<00:02, 1792.08it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▏                                                           | 5723/9737 [00:03<00:02, 1858.19it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▎                                                        | 5927/9737 [00:03<00:01, 1908.16it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▎                                                     | 6131/9737 [00:04<00:01, 1945.08it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▎                                                  | 6330/9737 [00:04<00:01, 1956.20it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▏                                               | 6528/9737 [00:04<00:01, 1951.24it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▏                                            | 6729/9737 [00:04<00:01, 1968.56it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▏                                         | 6932/9737 [00:04<00:01, 1985.40it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                      | 7136/9737 [00:04<00:01, 1999.43it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                   | 7339/9737 [00:04<00:01, 2007.38it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                | 7541/9737 [00:04<00:01, 1967.65it/s] 80%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                             | 7745/9737 [00:04<00:01, 1987.50it/s] 82%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                          | 7948/9737 [00:04<00:00, 1999.86it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                       | 8153/9737 [00:05<00:00, 2012.24it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                    | 8358/9737 [00:05<00:00, 2020.66it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                 | 8563/9737 [00:05<00:00, 2029.05it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌              | 8767/9737 [00:05<00:00, 2030.24it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌           | 8971/9737 [00:05<00:00, 2031.63it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋        | 9175/9737 [00:05<00:00, 2033.15it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋     | 9380/9737 [00:05<00:00, 2036.50it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋  | 9584/9737 [00:05<00:00, 2036.13it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9737/9737 [00:05<00:00, 1670.96it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.02s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.20s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.32s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.87s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.25s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.41s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.46s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.26s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.44s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
[2023-08-11 05:07:53,331] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.92s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
[2023-08-11 05:08:02,600] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 05:08:02,601] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 05:08:02,601] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 05:08:02,601] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 05:08:02,601] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 05:08:02,601] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fefcceeae80>
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fefcce34910>
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 05:08:02,602] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 05:08:02,603] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 05:08:02,603] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3689076900482178 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Fabric is cut to order at what type of seller? Choices:  A: curtains B: tailor shop C: clothing store D: sewing room E: hardware store
Answer: B: tailor shop

Input: Where are you if your reading magazines while waiting for a vehicle on rails? Choices:  A: vegetables B: market C: doctor D: train station E: bookstore
Answer: D: train station

Input: What would need oil to be used? Choices:  A: ground B: human  body C: repair shop D: combustion engines E: service station
Answer: D: combustion engines

Input: What is person probably feeling that plans on stopping being married to their spouse? Choices:  A: detachment B: bankruptcy C: sad D: fights E: wrong
Answer: A: detachment

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i4-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.3041267395019531 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.30421924591064453 seconds
Time to load utils op: 0.4046337604522705 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:50<40:56, 50.13s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:10<25:51, 32.33s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:05<33:45, 43.10s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:03<37:31, 48.94s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:00<38:43, 51.63s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:51<37:43, 51.45s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:32<34:35, 48.26s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:26<34:56, 49.92s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:21<35:08, 51.42s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:14<34:43, 52.09s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [09:09<34:26, 52.99s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [10:06<34:12, 54.02s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [11:00<33:22, 54.11s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [11:55<32:42, 54.51s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [12:50<31:51, 54.61s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [13:15<25:53, 45.69s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [14:11<26:50, 48.80s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [14:42<23:11, 43.47s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [15:27<22:41, 43.93s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [16:22<23:31, 47.06s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:46<19:29, 40.33s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [17:42<20:55, 44.84s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [18:35<21:21, 47.45s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [19:29<21:23, 49.36s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [20:24<21:13, 50.95s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [21:19<20:56, 52.35s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [21:30<15:13, 39.71s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:58<13:18, 36.31s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [22:51<14:26, 41.28s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [23:45<15:01, 45.09s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [24:40<15:13, 48.08s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [24:54<11:21, 37.84s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [25:22<09:55, 35.03s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:46<08:26, 31.68s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:26<08:31, 34.07s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [26:58<07:48, 33.45s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [27:26<06:54, 31.91s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [27:51<05:59, 29.95s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [28:13<05:00, 27.32s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [29:08<05:57, 35.74s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [29:51<05:41, 38.00s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [30:47<05:45, 43.24s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [31:34<05:11, 44.45s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [32:30<04:47, 47.90s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:18<04:00, 48.02s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:14<03:20, 50.18s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [34:27<01:57, 39.08s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [34:50<01:08, 34.20s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [35:46<00:40, 40.84s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [36:13<00:00, 36.60s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [36:13<00:00, 43.46s/it]
name: commonsenseqa | {'exact_match': 2.0, 'rougeL': 6.4178} | lm_loss 7.1454 | avg. gen lenth: 173.232
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s20-rTrue --seed 20 --rationales --num-in-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 05:45:29,320] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s20-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 1
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s20-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9740 [00:00<?, ?it/s]  1%|█▍                                                                                                                                                  | 95/9740 [00:00<00:10, 947.88it/s]  2%|██▉                                                                                                                                                | 191/9740 [00:00<00:10, 950.83it/s]  3%|████▎                                                                                                                                              | 287/9740 [00:00<00:09, 949.92it/s]  4%|█████▊                                                                                                                                             | 383/9740 [00:00<00:09, 952.80it/s]  5%|███████▏                                                                                                                                           | 479/9740 [00:00<00:09, 952.71it/s]  6%|████████▋                                                                                                                                          | 575/9740 [00:00<00:09, 953.74it/s]  7%|██████████▏                                                                                                                                        | 671/9740 [00:00<00:09, 952.90it/s]  8%|███████████▌                                                                                                                                       | 767/9740 [00:00<00:09, 954.66it/s]  9%|█████████████                                                                                                                                      | 863/9740 [00:00<00:09, 939.01it/s] 10%|██████████████▍                                                                                                                                    | 958/9740 [00:01<00:09, 940.77it/s] 11%|███████████████▊                                                                                                                                  | 1055/9740 [00:01<00:09, 947.14it/s] 12%|█████████████████▎                                                                                                                                | 1151/9740 [00:01<00:09, 949.48it/s] 13%|██████████████████▋                                                                                                                               | 1247/9740 [00:01<00:08, 950.86it/s] 14%|████████████████████▏                                                                                                                             | 1343/9740 [00:01<00:08, 951.83it/s] 15%|█████████████████████▌                                                                                                                            | 1439/9740 [00:01<00:08, 952.85it/s] 16%|███████████████████████                                                                                                                           | 1535/9740 [00:01<00:08, 954.55it/s] 17%|████████████████████████▍                                                                                                                         | 1631/9740 [00:01<00:08, 954.39it/s] 18%|██████████████████████████                                                                                                                       | 1751/9740 [00:01<00:07, 1026.29it/s] 19%|████████████████████████████                                                                                                                     | 1886/9740 [00:01<00:07, 1120.92it/s] 21%|██████████████████████████████▏                                                                                                                  | 2031/9740 [00:02<00:06, 1217.13it/s] 22%|████████████████████████████████▍                                                                                                                | 2177/9740 [00:02<00:05, 1289.49it/s] 24%|██████████████████████████████████▌                                                                                                              | 2322/9740 [00:02<00:05, 1334.81it/s] 25%|████████████████████████████████████▊                                                                                                            | 2469/9740 [00:02<00:05, 1375.20it/s] 27%|██████████████████████████████████████▉                                                                                                          | 2615/9740 [00:02<00:05, 1398.58it/s] 28%|█████████████████████████████████████████                                                                                                        | 2760/9740 [00:02<00:04, 1412.95it/s] 30%|███████████████████████████████████████████▎                                                                                                     | 2907/9740 [00:02<00:04, 1428.38it/s] 31%|█████████████████████████████████████████████▍                                                                                                   | 3053/9740 [00:02<00:04, 1436.94it/s] 33%|███████████████████████████████████████████████▋                                                                                                 | 3200/9740 [00:02<00:04, 1444.18it/s] 34%|█████████████████████████████████████████████████▊                                                                                               | 3347/9740 [00:02<00:04, 1451.88it/s] 36%|████████████████████████████████████████████████████                                                                                             | 3493/9740 [00:03<00:04, 1453.19it/s] 37%|██████████████████████████████████████████████████████▏                                                                                          | 3639/9740 [00:03<00:04, 1451.49it/s] 39%|████████████████████████████████████████████████████████▎                                                                                        | 3786/9740 [00:03<00:04, 1455.34it/s] 40%|██████████████████████████████████████████████████████████▌                                                                                      | 3932/9740 [00:03<00:03, 1456.71it/s] 42%|████████████████████████████████████████████████████████████▋                                                                                    | 4079/9740 [00:03<00:03, 1458.07it/s] 43%|██████████████████████████████████████████████████████████████▉                                                                                  | 4226/9740 [00:03<00:03, 1458.79it/s] 45%|█████████████████████████████████████████████████████████████████                                                                                | 4373/9740 [00:03<00:03, 1459.21it/s] 46%|███████████████████████████████████████████████████████████████████▎                                                                             | 4519/9740 [00:03<00:03, 1425.96it/s] 48%|█████████████████████████████████████████████████████████████████████▍                                                                           | 4666/9740 [00:03<00:03, 1436.35it/s] 49%|███████████████████████████████████████████████████████████████████████▌                                                                         | 4810/9740 [00:04<00:04, 1110.81it/s] 51%|█████████████████████████████████████████████████████████████████████████▊                                                                       | 4955/9740 [00:04<00:04, 1193.38it/s] 52%|███████████████████████████████████████████████████████████████████████████▉                                                                     | 5101/9740 [00:04<00:03, 1261.43it/s] 54%|██████████████████████████████████████████████████████████████████████████████                                                                   | 5247/9740 [00:04<00:03, 1313.29it/s] 55%|████████████████████████████████████████████████████████████████████████████████▎                                                                | 5393/9740 [00:04<00:03, 1354.04it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▌                                                              | 5542/9740 [00:04<00:03, 1390.52it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▊                                                            | 5694/9740 [00:04<00:02, 1425.65it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████                                                          | 5847/9740 [00:04<00:02, 1453.86it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▎                                                       | 5999/9740 [00:04<00:02, 1473.14it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▌                                                     | 6151/9740 [00:04<00:02, 1485.22it/s] 65%|█████████████████████████████████████████████████████████████████████████████████████████████▊                                                   | 6303/9740 [00:05<00:02, 1494.32it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████                                                 | 6454/9740 [00:05<00:02, 1498.57it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▎                                              | 6605/9740 [00:05<00:02, 1500.11it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▌                                            | 6758/9740 [00:05<00:01, 1507.25it/s] 71%|██████████████████████████████████████████████████████████████████████████████████████████████████████▊                                          | 6910/9740 [00:05<00:01, 1509.31it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                       | 7062/9740 [00:05<00:01, 1511.04it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                     | 7214/9740 [00:05<00:01, 1513.42it/s] 76%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                   | 7367/9740 [00:05<00:01, 1516.03it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                 | 7519/9740 [00:05<00:01, 1471.76it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                              | 7670/9740 [00:05<00:01, 1481.68it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                            | 7822/9740 [00:06<00:01, 1491.75it/s] 82%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                          | 7973/9740 [00:06<00:01, 1495.33it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                        | 8125/9740 [00:06<00:01, 1500.37it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                     | 8276/9740 [00:06<00:00, 1502.32it/s] 87%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                   | 8427/9740 [00:06<00:00, 1502.92it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 8578/9740 [00:06<00:00, 1503.76it/s] 90%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉               | 8730/9740 [00:06<00:00, 1505.99it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏            | 8881/9740 [00:06<00:00, 1505.91it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍          | 9033/9740 [00:06<00:00, 1507.41it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋        | 9185/9740 [00:06<00:00, 1508.39it/s] 96%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉      | 9336/9740 [00:07<00:00, 1508.33it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏   | 9487/9740 [00:07<00:00, 1490.68it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍ | 9639/9740 [00:07<00:00, 1497.23it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9740/9740 [00:07<00:00, 1329.92it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.95s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.17s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.37s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.18s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.22s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.11s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.57s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.60s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]
[2023-08-11 05:46:28,106] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.42s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.90s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.03s/it]
[2023-08-11 05:46:42,450] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 05:46:42,452] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 05:46:42,452] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 05:46:42,452] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 05:46:42,452] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 05:46:42,452] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f9f3bdefe80>
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 05:46:42,453] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f9f336d8910>
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 05:46:42,454] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 05:46:42,455] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 05:46:42,455] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 05:46:42,455] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4676806926727295 seconds
Loading extension module utils...
Time to load utils op: 0.40431714057922363 seconds
Loading extension module utils...
Time to load utils op: 0.4033024311065674 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: The machine was very intricate, it was quite an what? Choices:  A: box B: apparatus C: appliance D: wash dishes E: implement
Rationales: 1. The given phrase describes "the machine" as being "very intricate". This indicates that the machine is complicated and detailed. 
2. We are looking for a word that matches this description in the given choices.
3. The choice A: 'box' is not equivalent to the description. A box is usually simple, not intricate or complex.
4. Choice B: 'apparatus', refers to a complex or technical device or piece of equipment.
5. The choice C: 'appliance' does not suit the description as appliances are usually common household items.
6. Choice D: 'wash dishes' is not logical as it doesn't match the description of an intricate machine.
7. Choice E: 'implement' does not fit because an implement usually refers to a tool or utensil serving a specific purpose.
8. In conclusion, after analyzing all of the choices, choice B: 'apparatus' is the most fitting answer because the word aligns with the description of "the machine" in the sentence.
Answer: B: apparatus

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s20-rTrue
Time to load utils op: 0.5048422813415527 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:53<43:33, 53.33s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:45<41:58, 52.47s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:37<40:52, 52.19s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:10<34:14, 44.66s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:03<35:47, 47.72s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:56<36:24, 49.66s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:33<32:33, 45.43s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:26<33:26, 47.77s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:18<33:41, 49.31s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:10<33:26, 50.16s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [09:03<33:01, 50.81s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:56<32:35, 51.46s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [10:48<31:51, 51.66s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [11:41<31:18, 52.17s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [12:27<29:14, 50.14s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [13:19<28:43, 50.69s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [14:13<28:24, 51.66s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [15:05<27:41, 51.91s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [15:57<26:52, 52.00s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [16:51<26:12, 52.43s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [17:43<25:15, 52.27s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [18:35<24:25, 52.35s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [19:28<23:40, 52.61s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [20:21<22:51, 52.75s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [21:14<21:56, 52.65s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [22:07<21:05, 52.72s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [22:59<20:12, 52.72s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [23:52<19:17, 52.60s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [24:44<18:19, 52.38s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [25:36<17:27, 52.35s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [26:29<16:39, 52.58s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [27:22<15:50, 52.83s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [28:05<14:05, 49.76s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [28:58<13:32, 50.81s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [29:51<12:53, 51.54s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [30:44<12:05, 51.82s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [31:12<09:41, 44.74s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [32:02<09:14, 46.19s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [32:54<08:48, 48.07s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [33:47<08:14, 49.42s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [34:40<07:34, 50.49s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [35:32<06:48, 51.06s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [36:24<06:00, 51.44s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [37:19<05:13, 52.21s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [38:11<04:22, 52.40s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [39:05<03:30, 52.71s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [39:59<02:39, 53.16s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [40:51<01:45, 52.82s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [41:18<00:44, 44.99s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [42:11<00:00, 47.55s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [42:11<00:00, 50.63s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.112} | lm_loss 7.5648 | avg. gen lenth: 319.932
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s20-rTrue --seed 20 --rationales --num-in-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 06:29:33,425] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s20-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 2
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s20-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9739 [00:00<?, ?it/s]  1%|▊                                                                                                                                                   | 53/9739 [00:00<00:18, 526.87it/s]  1%|█▋                                                                                                                                                 | 111/9739 [00:00<00:17, 553.66it/s]  2%|██▌                                                                                                                                                | 169/9739 [00:00<00:16, 563.40it/s]  2%|███▍                                                                                                                                               | 226/9739 [00:00<00:16, 563.73it/s]  3%|████▎                                                                                                                                              | 284/9739 [00:00<00:16, 566.14it/s]  4%|█████▏                                                                                                                                             | 342/9739 [00:00<00:16, 567.81it/s]  4%|██████                                                                                                                                             | 399/9739 [00:00<00:16, 560.76it/s]  5%|██████▉                                                                                                                                            | 456/9739 [00:00<00:16, 558.59it/s]  5%|███████▋                                                                                                                                           | 513/9739 [00:00<00:16, 561.32it/s]  6%|████████▌                                                                                                                                          | 571/9739 [00:01<00:16, 564.28it/s]  6%|█████████▍                                                                                                                                         | 629/9739 [00:01<00:16, 566.34it/s]  7%|██████████▎                                                                                                                                        | 686/9739 [00:01<00:16, 554.89it/s]  8%|███████████▏                                                                                                                                       | 744/9739 [00:01<00:16, 559.80it/s]  8%|████████████                                                                                                                                       | 802/9739 [00:01<00:15, 564.69it/s]  9%|████████████▉                                                                                                                                      | 860/9739 [00:01<00:15, 568.00it/s]  9%|█████████████▊                                                                                                                                     | 917/9739 [00:01<00:15, 567.27it/s] 10%|██████████████▋                                                                                                                                    | 974/9739 [00:01<00:15, 563.96it/s] 11%|███████████████▍                                                                                                                                  | 1032/9739 [00:01<00:15, 566.31it/s] 11%|████████████████▎                                                                                                                                 | 1090/9739 [00:01<00:15, 568.25it/s] 12%|█████████████████▏                                                                                                                                | 1147/9739 [00:02<00:15, 567.66it/s] 12%|██████████████████                                                                                                                                | 1205/9739 [00:02<00:15, 568.35it/s] 13%|██████████████████▉                                                                                                                               | 1262/9739 [00:02<00:15, 557.95it/s] 14%|███████████████████▊                                                                                                                              | 1320/9739 [00:02<00:14, 562.13it/s] 14%|█████████████████████                                                                                                                             | 1403/9739 [00:02<00:13, 639.20it/s] 15%|██████████████████████▎                                                                                                                           | 1491/9739 [00:02<00:11, 708.36it/s] 16%|███████████████████████▋                                                                                                                          | 1578/9739 [00:02<00:10, 753.91it/s] 17%|████████████████████████▉                                                                                                                         | 1665/9739 [00:02<00:10, 787.41it/s] 18%|██████████████████████████▎                                                                                                                       | 1752/9739 [00:02<00:09, 809.98it/s] 19%|███████████████████████████▍                                                                                                                      | 1834/9739 [00:02<00:09, 803.52it/s] 20%|████████████████████████████▊                                                                                                                     | 1920/9739 [00:03<00:09, 818.85it/s] 21%|██████████████████████████████                                                                                                                    | 2008/9739 [00:03<00:09, 835.15it/s] 22%|███████████████████████████████▍                                                                                                                  | 2094/9739 [00:03<00:09, 841.87it/s] 22%|████████████████████████████████▋                                                                                                                 | 2182/9739 [00:03<00:08, 851.13it/s] 23%|██████████████████████████████████                                                                                                                | 2269/9739 [00:03<00:08, 855.02it/s] 24%|███████████████████████████████████▎                                                                                                              | 2357/9739 [00:03<00:08, 860.79it/s] 25%|████████████████████████████████████▋                                                                                                             | 2444/9739 [00:03<00:08, 863.28it/s] 26%|█████████████████████████████████████▉                                                                                                            | 2531/9739 [00:03<00:08, 858.66it/s] 27%|███████████████████████████████████████▏                                                                                                          | 2618/9739 [00:03<00:08, 861.68it/s] 28%|████████████████████████████████████████▌                                                                                                         | 2705/9739 [00:03<00:08, 861.07it/s] 29%|█████████████████████████████████████████▊                                                                                                        | 2792/9739 [00:04<00:08, 863.00it/s] 30%|███████████████████████████████████████████▏                                                                                                      | 2879/9739 [00:04<00:07, 864.22it/s] 30%|████████████████████████████████████████████▍                                                                                                     | 2966/9739 [00:04<00:07, 863.62it/s] 31%|█████████████████████████████████████████████▊                                                                                                    | 3053/9739 [00:04<00:07, 857.06it/s] 32%|███████████████████████████████████████████████                                                                                                   | 3140/9739 [00:04<00:07, 860.76it/s] 33%|████████████████████████████████████████████████▍                                                                                                 | 3227/9739 [00:04<00:07, 861.17it/s] 34%|█████████████████████████████████████████████████▋                                                                                                | 3315/9739 [00:04<00:07, 864.27it/s] 35%|███████████████████████████████████████████████████                                                                                               | 3402/9739 [00:04<00:07, 863.25it/s] 36%|████████████████████████████████████████████████████▎                                                                                             | 3489/9739 [00:04<00:07, 864.13it/s] 37%|█████████████████████████████████████████████████████▌                                                                                            | 3576/9739 [00:04<00:07, 864.83it/s] 38%|██████████████████████████████████████████████████████▉                                                                                           | 3663/9739 [00:05<00:07, 863.50it/s] 39%|████████████████████████████████████████████████████████▏                                                                                         | 3751/9739 [00:05<00:06, 865.61it/s] 39%|█████████████████████████████████████████████████████████▌                                                                                        | 3838/9739 [00:05<00:06, 863.79it/s] 40%|██████████████████████████████████████████████████████████▊                                                                                       | 3925/9739 [00:05<00:06, 862.17it/s] 41%|████████████████████████████████████████████████████████████▏                                                                                     | 4012/9739 [00:05<00:06, 841.97it/s] 42%|█████████████████████████████████████████████████████████████▍                                                                                    | 4098/9739 [00:05<00:06, 844.91it/s] 43%|██████████████████████████████████████████████████████████████▋                                                                                   | 4184/9739 [00:05<00:06, 847.60it/s] 44%|████████████████████████████████████████████████████████████████                                                                                  | 4271/9739 [00:05<00:06, 852.64it/s] 45%|█████████████████████████████████████████████████████████████████▎                                                                                | 4357/9739 [00:05<00:06, 854.76it/s] 46%|██████████████████████████████████████████████████████████████████▌                                                                               | 4444/9739 [00:05<00:06, 857.94it/s] 47%|███████████████████████████████████████████████████████████████████▉                                                                              | 4530/9739 [00:06<00:06, 819.59it/s] 47%|█████████████████████████████████████████████████████████████████████▏                                                                            | 4616/9739 [00:06<00:06, 829.96it/s] 48%|██████████████████████████████████████████████████████████████████████▌                                                                           | 4704/9739 [00:06<00:05, 842.08it/s] 49%|███████████████████████████████████████████████████████████████████████▊                                                                          | 4789/9739 [00:06<00:07, 624.12it/s] 50%|█████████████████████████████████████████████████████████████████████████                                                                         | 4875/9739 [00:06<00:07, 678.78it/s] 51%|██████████████████████████████████████████████████████████████████████████▎                                                                       | 4960/9739 [00:06<00:06, 721.95it/s] 52%|███████████████████████████████████████████████████████████████████████████▋                                                                      | 5047/9739 [00:06<00:06, 759.56it/s] 53%|████████████████████████████████████████████████████████████████████████████▉                                                                     | 5134/9739 [00:06<00:05, 788.40it/s] 54%|██████████████████████████████████████████████████████████████████████████████▎                                                                   | 5220/9739 [00:07<00:05, 807.36it/s] 54%|███████████████████████████████████████████████████████████████████████████████▌                                                                  | 5307/9739 [00:07<00:05, 824.42it/s] 55%|████████████████████████████████████████████████████████████████████████████████▊                                                                 | 5394/9739 [00:07<00:05, 836.41it/s] 56%|██████████████████████████████████████████████████████████████████████████████████▏                                                               | 5480/9739 [00:07<00:05, 843.15it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▍                                                              | 5569/9739 [00:07<00:04, 855.86it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▊                                                             | 5659/9739 [00:07<00:04, 866.49it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▏                                                           | 5749/9739 [00:07<00:04, 873.64it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▌                                                          | 5838/9739 [00:07<00:04, 878.18it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▊                                                         | 5928/9739 [00:07<00:04, 882.91it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▏                                                       | 6018/9739 [00:07<00:04, 887.82it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▌                                                      | 6108/9739 [00:08<00:04, 888.72it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▉                                                     | 6197/9739 [00:08<00:03, 888.91it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▎                                                   | 6287/9739 [00:08<00:03, 891.49it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▌                                                  | 6377/9739 [00:08<00:03, 892.80it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▉                                                 | 6467/9739 [00:08<00:03, 886.42it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▎                                               | 6556/9739 [00:08<00:03, 881.56it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▋                                              | 6647/9739 [00:08<00:03, 887.76it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▉                                             | 6736/9739 [00:08<00:03, 879.52it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▎                                           | 6824/9739 [00:08<00:03, 876.37it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▋                                          | 6915/9739 [00:08<00:03, 883.60it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                         | 7004/9739 [00:09<00:03, 883.81it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                       | 7095/9739 [00:09<00:02, 889.57it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                      | 7186/9739 [00:09<00:02, 894.67it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████                                     | 7276/9739 [00:09<00:02, 894.45it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                   | 7367/9739 [00:09<00:02, 896.76it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                  | 7457/9739 [00:09<00:02, 865.72it/s] 77%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                 | 7546/9739 [00:09<00:02, 871.36it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                               | 7637/9739 [00:09<00:02, 880.30it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                              | 7726/9739 [00:09<00:02, 882.25it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                            | 7817/9739 [00:09<00:02, 888.29it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                           | 7906/9739 [00:10<00:02, 888.04it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                          | 7997/9739 [00:10<00:01, 892.02it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 8087/9739 [00:10<00:01, 892.75it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                       | 8177/9739 [00:10<00:01, 894.16it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                      | 8268/9739 [00:10<00:01, 896.48it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                    | 8358/9739 [00:10<00:01, 892.60it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 8448/9739 [00:10<00:01, 894.62it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                  | 8539/9739 [00:10<00:01, 897.93it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                | 8629/9739 [00:10<00:01, 895.65it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋               | 8719/9739 [00:10<00:01, 895.75it/s] 90%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████              | 8809/9739 [00:11<00:01, 893.10it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍            | 8900/9739 [00:11<00:00, 895.31it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊           | 8990/9739 [00:11<00:00, 895.24it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 9080/9739 [00:11<00:00, 892.17it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍        | 9170/9739 [00:11<00:00, 892.61it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊       | 9260/9739 [00:11<00:00, 892.65it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏     | 9351/9739 [00:11<00:00, 895.66it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌    | 9442/9739 [00:11<00:00, 897.53it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉   | 9532/9739 [00:11<00:00, 895.77it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏ | 9622/9739 [00:11<00:00, 894.79it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌| 9712/9739 [00:12<00:00, 891.67it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9739/9739 [00:12<00:00, 804.08it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.92s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.64s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.70s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.96s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.51s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.50s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:12<00:06,  6.29s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.33s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.93s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.08s/it]
[2023-08-11 06:30:38,367] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.89s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.08s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.22s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.45s/it]
[2023-08-11 06:30:53,059] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 06:30:53,060] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 06:30:53,060] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f561046ae80>
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 06:30:53,061] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f5610269910>
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 06:30:53,062] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 06:30:53,063] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5039560794830322 seconds
Time to load utils op: 0.4049549102783203 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5074701309204102 seconds
Time to load utils op: 0.5045621395111084 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: The machine was very intricate, it was quite an what? Choices:  A: box B: apparatus C: appliance D: wash dishes E: implement
Rationales: 1. The sentence asks for a suitable noun to describe the complexity of the machine. 
2. The first option, 'box', is not suitable because although a box could possibly contain complex things, it is not complex in itself.
3. The second option, 'apparatus', refers to a complex piece of equipment or machinery, making it a suitable choice.
4. The term 'appliance', the third option, is generally used to refer to devices that perform specific tasks, usually in a household setting, but it doesn’t necessarily imply complexity.
5. 'Wash dishes', the fourth choice, is a verb phrase and doesn't fit the structure of the sentence.
6. The last option, 'implement', is used to refer to tools or instruments that are meant for a particular purpose, but it doesn’t necessarily denote complexity.
7. Therefore, the only choice that fits the sentence correctly and reflects the complexity of the machine is 'apparatus'. 
8. Hence, the answer is B: apparatus.
Answer: B: apparatus

Input: Where do you get petrol? Choices:  A: burn hot B: fuel tank C: burn hot D: car E: gas station
Rationales: 1. "Where" initially tells us that the answer requires a location.
2. The question is basically asking where petrol is usually acquired.
3. So, it is a place where petrol is typically available.
4. We can immediately rule out option A: burn hot and option C: burn hot, as they are not locations.
5. Next we check option B: fuel tank. Though a fuel tank does contain petrol, it’s not a place where you can get petrol. So, this option doesn't answer the question.
6. Looking at option D: car. We put petrol in the car, but we do not get petrol from a car. So, this option can’t answer the question either.
7. Finally, we look at option E: gas station. A gas station is indeed a location where we go to get petrol.
8. Therefore, the answer is E: gas station.
Answer: E: gas station

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s20-rTrue
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:49<40:03, 49.06s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:38<39:26, 49.30s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:27<38:27, 49.11s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:14<37:03, 48.35s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:03<36:31, 48.70s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:51<35:20, 48.20s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:31<32:49, 45.79s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:23<33:18, 47.58s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:12<32:54, 48.15s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:47<29:25, 44.15s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:37<29:40, 45.64s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:26<29:37, 46.78s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [10:15<29:18, 47.52s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [11:05<28:52, 48.13s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:53<28:10, 48.29s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [12:42<27:30, 48.55s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [13:31<26:40, 48.50s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [14:06<23:46, 44.58s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:55<23:40, 45.81s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:44<23:22, 46.75s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:32<22:51, 47.28s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [17:20<22:10, 47.51s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [18:10<21:42, 48.23s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:59<20:57, 48.35s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [19:48<20:17, 48.68s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [20:38<19:31, 48.81s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [21:09<16:45, 43.73s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:59<16:39, 45.42s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [22:48<16:20, 46.69s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [23:35<15:32, 46.62s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [24:24<14:58, 47.28s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [25:13<14:23, 47.96s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [26:03<13:42, 48.36s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [26:52<12:58, 48.66s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [27:42<12:14, 48.95s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [28:31<11:26, 49.04s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [29:19<10:35, 48.88s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [30:08<09:45, 48.79s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [30:44<08:15, 45.06s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [31:33<07:40, 46.02s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [32:21<07:01, 46.79s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [33:10<06:19, 47.47s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [34:00<05:36, 48.10s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [34:48<04:48, 48.10s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [35:37<04:01, 48.31s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [36:26<03:14, 48.66s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [37:16<02:26, 48.93s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [38:04<01:37, 48.80s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [38:51<00:48, 48.34s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:41<00:00, 48.73s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:41<00:00, 47.63s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.2321} | lm_loss 7.3595 | avg. gen lenth: 310.184
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i3-s20-rTrue --seed 20 --rationales --num-in-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 07:11:07,413] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i3-s20-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 3
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i3-s20-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9738 [00:00<?, ?it/s]  0%|▋                                                                                                                                                   | 42/9738 [00:00<00:23, 419.93it/s]  1%|█▎                                                                                                                                                  | 85/9738 [00:00<00:22, 421.26it/s]  1%|█▉                                                                                                                                                 | 128/9738 [00:00<00:22, 422.54it/s]  2%|██▌                                                                                                                                                | 171/9738 [00:00<00:22, 422.83it/s]  2%|███▏                                                                                                                                               | 214/9738 [00:00<00:22, 420.53it/s]  3%|███▉                                                                                                                                               | 257/9738 [00:00<00:22, 421.55it/s]  3%|████▌                                                                                                                                              | 300/9738 [00:00<00:22, 421.98it/s]  4%|█████▏                                                                                                                                             | 343/9738 [00:00<00:22, 413.95it/s]  4%|█████▊                                                                                                                                             | 385/9738 [00:00<00:22, 415.26it/s]  4%|██████▍                                                                                                                                            | 428/9738 [00:01<00:22, 414.23it/s]  5%|███████                                                                                                                                            | 471/9738 [00:01<00:22, 416.60it/s]  5%|███████▊                                                                                                                                           | 514/9738 [00:01<00:22, 418.24it/s]  6%|████████▍                                                                                                                                          | 557/9738 [00:01<00:21, 419.53it/s]  6%|█████████                                                                                                                                          | 600/9738 [00:01<00:21, 419.87it/s]  7%|█████████▉                                                                                                                                         | 655/9738 [00:01<00:19, 455.77it/s]  7%|██████████▊                                                                                                                                        | 719/9738 [00:01<00:17, 509.53it/s]  8%|███████████▊                                                                                                                                       | 782/9738 [00:01<00:16, 543.92it/s]  9%|████████████▊                                                                                                                                      | 846/9738 [00:01<00:15, 570.85it/s]  9%|█████████████▋                                                                                                                                     | 908/9738 [00:01<00:15, 582.99it/s] 10%|██████████████▋                                                                                                                                    | 972/9738 [00:02<00:14, 598.98it/s] 11%|███████████████▌                                                                                                                                  | 1036/9738 [00:02<00:14, 611.02it/s] 11%|████████████████▍                                                                                                                                 | 1100/9738 [00:02<00:13, 619.59it/s] 12%|█████████████████▍                                                                                                                                | 1163/9738 [00:02<00:13, 622.13it/s] 13%|██████████████████▍                                                                                                                               | 1226/9738 [00:02<00:13, 624.35it/s] 13%|███████████████████▎                                                                                                                              | 1290/9738 [00:02<00:13, 628.39it/s] 14%|████████████████████▎                                                                                                                             | 1353/9738 [00:02<00:13, 628.17it/s] 15%|█████████████████████▏                                                                                                                            | 1417/9738 [00:02<00:13, 629.70it/s] 15%|██████████████████████▏                                                                                                                           | 1481/9738 [00:02<00:13, 631.66it/s] 16%|███████████████████████▏                                                                                                                          | 1545/9738 [00:02<00:12, 633.41it/s] 17%|████████████████████████                                                                                                                          | 1609/9738 [00:03<00:12, 628.33it/s] 17%|█████████████████████████                                                                                                                         | 1673/9738 [00:03<00:12, 630.47it/s] 18%|██████████████████████████                                                                                                                        | 1737/9738 [00:03<00:12, 631.59it/s] 18%|███████████████████████████                                                                                                                       | 1801/9738 [00:03<00:13, 609.35it/s] 19%|███████████████████████████▉                                                                                                                      | 1865/9738 [00:03<00:12, 616.29it/s] 20%|████████████████████████████▉                                                                                                                     | 1929/9738 [00:03<00:12, 621.63it/s] 20%|█████████████████████████████▉                                                                                                                    | 1993/9738 [00:03<00:12, 625.50it/s] 21%|██████████████████████████████▊                                                                                                                   | 2056/9738 [00:03<00:12, 625.58it/s] 22%|███████████████████████████████▊                                                                                                                  | 2120/9738 [00:03<00:12, 627.79it/s] 22%|████████████████████████████████▋                                                                                                                 | 2183/9738 [00:03<00:12, 628.38it/s] 23%|█████████████████████████████████▋                                                                                                                | 2246/9738 [00:04<00:11, 628.17it/s] 24%|██████████████████████████████████▋                                                                                                               | 2310/9738 [00:04<00:11, 630.22it/s] 24%|███████████████████████████████████▌                                                                                                              | 2374/9738 [00:04<00:11, 630.45it/s] 25%|████████████████████████████████████▌                                                                                                             | 2438/9738 [00:04<00:11, 625.95it/s] 26%|█████████████████████████████████████▍                                                                                                            | 2501/9738 [00:04<00:11, 623.93it/s] 26%|██████████████████████████████████████▍                                                                                                           | 2565/9738 [00:04<00:11, 627.19it/s] 27%|███████████████████████████████████████▍                                                                                                          | 2629/9738 [00:04<00:11, 629.89it/s] 28%|████████████████████████████████████████▍                                                                                                         | 2693/9738 [00:04<00:11, 631.31it/s] 28%|█████████████████████████████████████████▎                                                                                                        | 2757/9738 [00:04<00:11, 629.94it/s] 29%|██████████████████████████████████████████▎                                                                                                       | 2821/9738 [00:04<00:10, 630.82it/s] 30%|███████████████████████████████████████████▎                                                                                                      | 2885/9738 [00:05<00:10, 632.25it/s] 30%|████████████████████████████████████████████▏                                                                                                     | 2949/9738 [00:05<00:10, 630.71it/s] 31%|█████████████████████████████████████████████▏                                                                                                    | 3013/9738 [00:05<00:10, 633.34it/s] 32%|██████████████████████████████████████████████▏                                                                                                   | 3077/9738 [00:05<00:10, 633.22it/s] 32%|███████████████████████████████████████████████                                                                                                   | 3141/9738 [00:05<00:10, 634.78it/s] 33%|████████████████████████████████████████████████                                                                                                  | 3205/9738 [00:05<00:10, 633.43it/s] 34%|█████████████████████████████████████████████████                                                                                                 | 3269/9738 [00:05<00:10, 631.25it/s] 34%|█████████████████████████████████████████████████▉                                                                                                | 3333/9738 [00:05<00:10, 631.81it/s] 35%|██████████████████████████████████████████████████▉                                                                                               | 3397/9738 [00:05<00:10, 630.81it/s] 36%|███████████████████████████████████████████████████▉                                                                                              | 3461/9738 [00:05<00:09, 630.94it/s] 36%|████████████████████████████████████████████████████▊                                                                                             | 3525/9738 [00:06<00:09, 632.23it/s] 37%|█████████████████████████████████████████████████████▊                                                                                            | 3589/9738 [00:06<00:09, 632.99it/s] 38%|██████████████████████████████████████████████████████▊                                                                                           | 3653/9738 [00:06<00:09, 631.52it/s] 38%|███████████████████████████████████████████████████████▋                                                                                          | 3717/9738 [00:06<00:09, 632.64it/s] 39%|████████████████████████████████████████████████████████▋                                                                                         | 3781/9738 [00:06<00:09, 633.53it/s] 39%|█████████████████████████████████████████████████████████▋                                                                                        | 3845/9738 [00:06<00:09, 631.99it/s] 40%|██████████████████████████████████████████████████████████▌                                                                                       | 3909/9738 [00:06<00:09, 633.69it/s] 41%|███████████████████████████████████████████████████████████▌                                                                                      | 3973/9738 [00:06<00:09, 634.79it/s] 41%|████████████████████████████████████████████████████████████▌                                                                                     | 4037/9738 [00:06<00:08, 635.25it/s] 42%|█████████████████████████████████████████████████████████████▍                                                                                    | 4101/9738 [00:07<00:08, 632.17it/s] 43%|██████████████████████████████████████████████████████████████▍                                                                                   | 4165/9738 [00:07<00:08, 633.52it/s] 43%|███████████████████████████████████████████████████████████████▍                                                                                  | 4229/9738 [00:07<00:08, 633.73it/s] 44%|████████████████████████████████████████████████████████████████▎                                                                                 | 4293/9738 [00:07<00:08, 632.81it/s] 45%|█████████████████████████████████████████████████████████████████▎                                                                                | 4357/9738 [00:07<00:08, 632.48it/s] 45%|██████████████████████████████████████████████████████████████████▎                                                                               | 4421/9738 [00:07<00:08, 632.94it/s] 46%|███████████████████████████████████████████████████████████████████▏                                                                              | 4485/9738 [00:07<00:08, 633.71it/s] 47%|████████████████████████████████████████████████████████████████████▏                                                                             | 4549/9738 [00:07<00:08, 600.42it/s] 47%|█████████████████████████████████████████████████████████████████████▏                                                                            | 4613/9738 [00:07<00:08, 611.15it/s] 48%|██████████████████████████████████████████████████████████████████████                                                                            | 4677/9738 [00:07<00:08, 618.34it/s] 49%|███████████████████████████████████████████████████████████████████████                                                                           | 4741/9738 [00:08<00:11, 450.58it/s] 49%|████████████████████████████████████████████████████████████████████████                                                                          | 4805/9738 [00:08<00:09, 493.35it/s] 50%|█████████████████████████████████████████████████████████████████████████                                                                         | 4869/9738 [00:08<00:09, 528.32it/s] 51%|█████████████████████████████████████████████████████████████████████████▉                                                                        | 4933/9738 [00:08<00:08, 555.99it/s] 51%|██████████████████████████████████████████████████████████████████████████▉                                                                       | 4996/9738 [00:08<00:08, 574.94it/s] 52%|███████████████████████████████████████████████████████████████████████████▊                                                                      | 5060/9738 [00:08<00:07, 591.68it/s] 53%|████████████████████████████████████████████████████████████████████████████▊                                                                     | 5124/9738 [00:08<00:07, 603.77it/s] 53%|█████████████████████████████████████████████████████████████████████████████▊                                                                    | 5187/9738 [00:08<00:07, 609.83it/s] 54%|██████████████████████████████████████████████████████████████████████████████▋                                                                   | 5251/9738 [00:08<00:07, 617.48it/s] 55%|███████████████████████████████████████████████████████████████████████████████▋                                                                  | 5315/9738 [00:09<00:07, 621.25it/s] 55%|████████████████████████████████████████████████████████████████████████████████▋                                                                 | 5379/9738 [00:09<00:06, 625.61it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▌                                                                | 5442/9738 [00:09<00:06, 625.53it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▌                                                               | 5507/9738 [00:09<00:06, 631.68it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▌                                                              | 5573/9738 [00:09<00:06, 639.35it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▌                                                             | 5638/9738 [00:09<00:06, 641.51it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▌                                                            | 5704/9738 [00:09<00:06, 645.81it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▌                                                           | 5770/9738 [00:09<00:06, 649.04it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▍                                                          | 5836/9738 [00:09<00:05, 651.45it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▍                                                         | 5902/9738 [00:09<00:05, 650.62it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▍                                                        | 5968/9738 [00:10<00:05, 651.50it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▍                                                       | 6034/9738 [00:10<00:05, 653.25it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▍                                                      | 6100/9738 [00:10<00:05, 651.33it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▍                                                     | 6166/9738 [00:10<00:05, 652.65it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▍                                                    | 6232/9738 [00:10<00:05, 653.20it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▍                                                   | 6298/9738 [00:10<00:05, 653.77it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▍                                                  | 6364/9738 [00:10<00:05, 652.57it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▍                                                 | 6430/9738 [00:10<00:05, 653.64it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▍                                                | 6496/9738 [00:10<00:04, 652.55it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▍                                               | 6562/9738 [00:10<00:04, 650.14it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▎                                              | 6628/9738 [00:11<00:04, 651.49it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▎                                             | 6694/9738 [00:11<00:04, 653.08it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████▎                                            | 6760/9738 [00:11<00:04, 651.62it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▎                                           | 6826/9738 [00:11<00:04, 652.59it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▎                                          | 6892/9738 [00:11<00:04, 653.56it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                         | 6958/9738 [00:11<00:04, 653.45it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                        | 7024/9738 [00:11<00:04, 651.14it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                       | 7090/9738 [00:11<00:04, 652.68it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                      | 7156/9738 [00:11<00:03, 651.78it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                     | 7222/9738 [00:12<00:03, 643.33it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                    | 7287/9738 [00:12<00:03, 643.88it/s] 75%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                   | 7352/9738 [00:12<00:03, 645.66it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                  | 7418/9738 [00:12<00:03, 648.58it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 7483/9738 [00:12<00:03, 620.75it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                | 7547/9738 [00:12<00:03, 623.87it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                               | 7613/9738 [00:12<00:03, 632.51it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████                               | 7678/9738 [00:12<00:03, 636.03it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                              | 7744/9738 [00:12<00:03, 641.28it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                             | 7809/9738 [00:12<00:02, 643.28it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                            | 7874/9738 [00:13<00:02, 644.98it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                           | 7939/9738 [00:13<00:02, 645.82it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                          | 8005/9738 [00:13<00:02, 647.79it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                         | 8071/9738 [00:13<00:02, 649.71it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                        | 8136/9738 [00:13<00:02, 649.09it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                       | 8202/9738 [00:13<00:02, 650.36it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                      | 8268/9738 [00:13<00:02, 651.38it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                     | 8334/9738 [00:13<00:02, 652.44it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                    | 8400/9738 [00:13<00:02, 651.32it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                   | 8466/9738 [00:13<00:01, 652.60it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                  | 8532/9738 [00:14<00:01, 651.79it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                 | 8598/9738 [00:14<00:01, 642.31it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                | 8663/9738 [00:14<00:01, 643.01it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊               | 8729/9738 [00:14<00:01, 646.12it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊              | 8795/9738 [00:14<00:01, 647.77it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 8860/9738 [00:14<00:01, 647.21it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊            | 8926/9738 [00:14<00:01, 649.38it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊           | 8992/9738 [00:14<00:01, 650.24it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊          | 9058/9738 [00:14<00:01, 648.62it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 9124/9738 [00:14<00:00, 649.70it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊        | 9190/9738 [00:15<00:00, 650.67it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊       | 9256/9738 [00:15<00:00, 648.95it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋      | 9321/9738 [00:15<00:00, 648.73it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋     | 9386/9738 [00:15<00:00, 647.89it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋    | 9452/9738 [00:15<00:00, 649.64it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋   | 9517/9738 [00:15<00:00, 647.63it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋  | 9583/9738 [00:15<00:00, 648.44it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋ | 9649/9738 [00:15<00:00, 649.63it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋| 9714/9738 [00:15<00:00, 641.68it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9738/9738 [00:15<00:00, 612.47it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.07s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.24s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.19s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.17s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.12s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.15s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.12s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.15s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.63s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.52s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]
[2023-08-11 07:12:14,931] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.49s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]
[2023-08-11 07:12:22,232] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 07:12:22,233] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 07:12:22,233] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 07:12:22,233] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 07:12:22,233] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 07:12:22,233] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fa86524fe80>
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fa864e99910>
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 07:12:22,234] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 07:12:22,235] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 07:12:22,235] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.44057703018188477 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: The machine was very intricate, it was quite an what? Choices:  A: box B: apparatus C: appliance D: wash dishes E: implement
Rationales: 1. Begin by understanding the context in which the word is being required. One key concept is the phrase "very intricate" which describes the noun we're seeking.
2. We may start to eliminate words that don't fit the context. For instance, "box" may not be described as intricate, so "A: box" can be crossed out.
3. Consider the option D: wash dishes. This option appears to be less fitting as a 'wash dishes' does not typically align with the description of being intricate. So we exclude this option.
4. The option C: "appliance" could be intricate but is not the best match among the choices as appliances often refer to common household devices like a fridge or oven.
5. The option E: "implement" is usually used to refer to a tool or utensil, which is less plausible to be very intricate.
6. The option B: "apparatus" fits best with'very intricate' as it typically refers to a complex machine or device, so it's the best choice.
Answer: B: apparatus

Input: Where do you get petrol? Choices:  A: burn hot B: fuel tank C: burn hot D: car E: gas station
Rationales: 1. First, let's rule out the choices that do not have any connection with getting petrol by examining their definitions.
2. "Burn hot" refers to high temperature combustion, it is not a place where you can retrieve oil, so both A: burn hot and C: burn hot are incorrect.
3. A "fuel tank" refers to the container of petrol or fuel within a vehicle, but we do not get petrol from there, hence B: fuel tank is incorrect.
4. A "car" uses petrol for it to function, however, it is not the source of petrol. So, D: car is incorrect as well.
5. E: gas station is where petrol (also known as gasoline) is being sold / it's where you get petrol for your car. 
6. Therefore, the answer is E: gas station.
Answer: E: gas station

Input: Where might a television used at night be? Choices:  A: cabinet B: house C: apartment D: bedroom E: woods
Rationales: 1. The question asks where a television that is used at night might be located.
2. Considering each of the options, a television could be in a cabinet, a house, an apartment, a bedroom, or the woods.
3. A cabinet is a possible location, but not a common place where one would use a television, especially at nighttime.
4. A house or an apartment is a broad location, it can be anywhere inside a house or an apartment, but it doesn't specify where exactly within these places.
5. The woods is an unlikely location since it is usually outdoors and lacks access to power and signal necessary for a television to function.
6. A bedroom is a common place where a television might be used at night.
7. Therefore, the most reasonable answer is D: bedroom.
Answer: D: bedroom

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i3-s20-rTrue
Loading extension module utils...
Time to load utils op: 0.40446996688842773 seconds
Loading extension module utils...
Time to load utils op: 0.4042973518371582 seconds
Loading extension module utils...
Time to load utils op: 0.40416574478149414 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:46<37:37, 46.08s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:32<37:06, 46.38s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:18<36:05, 46.08s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:05<35:29, 46.30s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:42<32:21, 43.15s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:29<32:30, 44.34s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:14<31:52, 44.49s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:59<31:15, 44.65s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:45<30:58, 45.34s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:32<30:25, 45.63s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:03<26:50, 41.29s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:50<27:11, 42.94s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:35<26:58, 43.74s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:22<26:46, 44.64s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:08<26:17, 45.08s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:55<25:48, 45.54s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:41<25:11, 45.81s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:28<24:31, 45.99s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:03<22:02, 42.66s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:49<21:50, 43.68s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:35<21:27, 44.39s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:21<21:00, 45.02s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:07<20:24, 45.35s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [17:53<19:43, 45.54s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:40<19:05, 45.82s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:26<18:20, 45.86s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:13<17:42, 46.18s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [20:34<14:09, 38.61s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [21:20<14:22, 41.09s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:06<14:08, 42.44s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [22:52<13:46, 43.52s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [23:38<13:18, 44.36s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [24:25<12:44, 44.94s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:12<12:11, 45.69s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [25:58<11:27, 45.81s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [26:45<10:43, 45.98s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [27:32<10:02, 46.32s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [28:18<09:15, 46.31s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [28:59<08:13, 44.85s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [29:47<07:35, 45.55s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [30:33<06:52, 45.85s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:20<06:09, 46.14s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [32:06<05:23, 46.18s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [32:53<04:38, 46.36s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:40<03:52, 46.40s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:27<03:07, 46.79s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [35:14<02:20, 46.75s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [36:00<01:33, 46.66s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [36:47<00:46, 46.57s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:33<00:00, 46.53s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:33<00:00, 45.07s/it]
name: commonsenseqa | {'exact_match': 0.8, 'rougeL': 4.1672} | lm_loss 7.3644 | avg. gen lenth: 286.808
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i4-s20-rTrue --seed 20 --rationales --num-in-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[2023-08-11 07:50:21,239] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i4-s20-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 4
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i4-s20-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9737 [00:00<?, ?it/s]  0%|▎                                                                                                                                                   | 24/9737 [00:00<00:40, 239.27it/s]  1%|▋                                                                                                                                                   | 49/9737 [00:00<00:40, 239.80it/s]  1%|█                                                                                                                                                   | 74/9737 [00:00<00:40, 240.18it/s]  1%|█▌                                                                                                                                                  | 99/9737 [00:00<00:40, 240.88it/s]  1%|█▊                                                                                                                                                 | 124/9737 [00:00<00:39, 240.90it/s]  2%|██▏                                                                                                                                                | 149/9737 [00:00<00:39, 241.04it/s]  2%|██▋                                                                                                                                                | 174/9737 [00:00<00:40, 237.65it/s]  2%|██▉                                                                                                                                                | 198/9737 [00:00<00:40, 237.82it/s]  2%|███▎                                                                                                                                               | 222/9737 [00:00<00:40, 236.69it/s]  3%|███▋                                                                                                                                               | 246/9737 [00:01<00:39, 237.50it/s]  3%|████                                                                                                                                               | 271/9737 [00:01<00:39, 238.36it/s]  3%|████▍                                                                                                                                              | 295/9737 [00:01<00:39, 238.63it/s]  3%|████▊                                                                                                                                              | 319/9737 [00:01<00:39, 238.91it/s]  4%|█████▏                                                                                                                                             | 343/9737 [00:01<00:39, 239.14it/s]  4%|█████▌                                                                                                                                             | 367/9737 [00:01<00:39, 239.33it/s]  4%|█████▉                                                                                                                                             | 392/9737 [00:01<00:39, 239.61it/s]  4%|██████▎                                                                                                                                            | 416/9737 [00:01<00:39, 237.12it/s]  5%|██████▋                                                                                                                                            | 440/9737 [00:01<00:39, 235.85it/s]  5%|███████                                                                                                                                            | 464/9737 [00:01<00:39, 236.87it/s]  5%|███████▎                                                                                                                                           | 488/9737 [00:02<00:38, 237.40it/s]  5%|███████▋                                                                                                                                           | 512/9737 [00:02<00:38, 237.90it/s]  6%|████████▎                                                                                                                                          | 548/9737 [00:02<00:33, 274.23it/s]  6%|████████▊                                                                                                                                          | 585/9737 [00:02<00:30, 301.49it/s]  6%|█████████▍                                                                                                                                         | 622/9737 [00:02<00:28, 320.73it/s]  7%|█████████▉                                                                                                                                         | 658/9737 [00:02<00:27, 332.05it/s]  7%|██████████▍                                                                                                                                        | 695/9737 [00:02<00:26, 342.24it/s]  8%|███████████                                                                                                                                        | 732/9737 [00:02<00:25, 348.93it/s]  8%|███████████▌                                                                                                                                       | 769/9737 [00:02<00:25, 354.09it/s]  8%|████████████▏                                                                                                                                      | 806/9737 [00:02<00:24, 358.06it/s]  9%|████████████▋                                                                                                                                      | 843/9737 [00:03<00:24, 360.58it/s]  9%|█████████████▎                                                                                                                                     | 880/9737 [00:03<00:24, 362.53it/s]  9%|█████████████▊                                                                                                                                     | 917/9737 [00:03<00:24, 361.49it/s] 10%|██████████████▍                                                                                                                                    | 954/9737 [00:03<00:24, 362.45it/s] 10%|██████████████▉                                                                                                                                    | 991/9737 [00:03<00:24, 363.47it/s] 11%|███████████████▍                                                                                                                                  | 1028/9737 [00:03<00:23, 364.13it/s] 11%|███████████████▉                                                                                                                                  | 1065/9737 [00:03<00:23, 364.66it/s] 11%|████████████████▌                                                                                                                                 | 1102/9737 [00:03<00:23, 363.98it/s] 12%|█████████████████                                                                                                                                 | 1139/9737 [00:03<00:23, 362.51it/s] 12%|█████████████████▋                                                                                                                                | 1176/9737 [00:03<00:23, 363.46it/s] 12%|██████████████████▏                                                                                                                               | 1213/9737 [00:04<00:23, 363.60it/s] 13%|██████████████████▋                                                                                                                               | 1250/9737 [00:04<00:23, 363.98it/s] 13%|███████████████████▎                                                                                                                              | 1287/9737 [00:04<00:23, 364.03it/s] 14%|███████████████████▊                                                                                                                              | 1324/9737 [00:04<00:23, 363.89it/s] 14%|████████████████████▍                                                                                                                             | 1361/9737 [00:04<00:23, 362.34it/s] 14%|████████████████████▉                                                                                                                             | 1398/9737 [00:04<00:22, 362.78it/s] 15%|█████████████████████▌                                                                                                                            | 1435/9737 [00:04<00:22, 363.44it/s] 15%|██████████████████████                                                                                                                            | 1472/9737 [00:04<00:22, 364.03it/s] 15%|██████████████████████▋                                                                                                                           | 1509/9737 [00:04<00:22, 364.11it/s] 16%|███████████████████████▏                                                                                                                          | 1546/9737 [00:04<00:22, 364.35it/s] 16%|███████████████████████▋                                                                                                                          | 1583/9737 [00:05<00:22, 362.05it/s] 17%|████████████████████████▎                                                                                                                         | 1620/9737 [00:05<00:22, 362.78it/s] 17%|████████████████████████▊                                                                                                                         | 1657/9737 [00:05<00:22, 363.44it/s] 17%|█████████████████████████▍                                                                                                                        | 1694/9737 [00:05<00:22, 363.72it/s] 18%|█████████████████████████▉                                                                                                                        | 1731/9737 [00:05<00:21, 364.00it/s] 18%|██████████████████████████▌                                                                                                                       | 1768/9737 [00:05<00:21, 363.78it/s] 19%|███████████████████████████                                                                                                                       | 1805/9737 [00:05<00:23, 343.52it/s] 19%|███████████████████████████▌                                                                                                                      | 1842/9737 [00:05<00:22, 349.42it/s] 19%|████████████████████████████▏                                                                                                                     | 1879/9737 [00:05<00:22, 353.52it/s] 20%|████████████████████████████▋                                                                                                                     | 1916/9737 [00:06<00:21, 356.64it/s] 20%|█████████████████████████████▎                                                                                                                    | 1953/9737 [00:06<00:21, 358.71it/s] 20%|█████████████████████████████▊                                                                                                                    | 1990/9737 [00:06<00:21, 360.49it/s] 21%|██████████████████████████████▍                                                                                                                   | 2027/9737 [00:06<00:21, 359.81it/s] 21%|██████████████████████████████▉                                                                                                                   | 2064/9737 [00:06<00:21, 361.01it/s] 22%|███████████████████████████████▌                                                                                                                  | 2101/9737 [00:06<00:21, 361.79it/s] 22%|████████████████████████████████                                                                                                                  | 2138/9737 [00:06<00:20, 362.69it/s] 22%|████████████████████████████████▌                                                                                                                 | 2175/9737 [00:06<00:20, 362.85it/s] 23%|█████████████████████████████████▏                                                                                                                | 2212/9737 [00:06<00:20, 363.24it/s] 23%|█████████████████████████████████▋                                                                                                                | 2249/9737 [00:06<00:20, 358.80it/s] 23%|██████████████████████████████████▎                                                                                                               | 2286/9737 [00:07<00:20, 360.65it/s] 24%|██████████████████████████████████▊                                                                                                               | 2323/9737 [00:07<00:20, 361.64it/s] 24%|███████████████████████████████████▍                                                                                                              | 2360/9737 [00:07<00:20, 362.66it/s] 25%|███████████████████████████████████▉                                                                                                              | 2397/9737 [00:07<00:20, 363.43it/s] 25%|████████████████████████████████████▍                                                                                                             | 2434/9737 [00:07<00:20, 363.71it/s] 25%|█████████████████████████████████████                                                                                                             | 2471/9737 [00:07<00:20, 362.17it/s] 26%|█████████████████████████████████████▌                                                                                                            | 2508/9737 [00:07<00:19, 362.83it/s] 26%|██████████████████████████████████████▏                                                                                                           | 2545/9737 [00:07<00:19, 362.89it/s] 27%|██████████████████████████████████████▋                                                                                                           | 2582/9737 [00:07<00:19, 363.53it/s] 27%|███████████████████████████████████████▎                                                                                                          | 2619/9737 [00:07<00:19, 364.08it/s] 27%|███████████████████████████████████████▊                                                                                                          | 2656/9737 [00:08<00:19, 363.53it/s] 28%|████████████████████████████████████████▍                                                                                                         | 2693/9737 [00:08<00:19, 363.34it/s] 28%|████████████████████████████████████████▉                                                                                                         | 2730/9737 [00:08<00:19, 358.66it/s] 28%|█████████████████████████████████████████▍                                                                                                        | 2767/9737 [00:08<00:19, 360.04it/s] 29%|██████████████████████████████████████████                                                                                                        | 2804/9737 [00:08<00:19, 360.91it/s] 29%|██████████████████████████████████████████▌                                                                                                       | 2841/9737 [00:08<00:19, 361.88it/s] 30%|███████████████████████████████████████████▏                                                                                                      | 2878/9737 [00:08<00:18, 362.63it/s] 30%|███████████████████████████████████████████▋                                                                                                      | 2915/9737 [00:08<00:18, 363.06it/s] 30%|████████████████████████████████████████████▎                                                                                                     | 2952/9737 [00:08<00:18, 361.25it/s] 31%|████████████████████████████████████████████▊                                                                                                     | 2989/9737 [00:08<00:18, 362.24it/s] 31%|█████████████████████████████████████████████▎                                                                                                    | 3026/9737 [00:09<00:18, 362.77it/s] 31%|█████████████████████████████████████████████▉                                                                                                    | 3063/9737 [00:09<00:18, 362.40it/s] 32%|██████████████████████████████████████████████▍                                                                                                   | 3100/9737 [00:09<00:18, 362.74it/s] 32%|███████████████████████████████████████████████                                                                                                   | 3137/9737 [00:09<00:18, 362.80it/s] 33%|███████████████████████████████████████████████▌                                                                                                  | 3174/9737 [00:09<00:18, 361.12it/s] 33%|████████████████████████████████████████████████▏                                                                                                 | 3211/9737 [00:09<00:18, 358.75it/s] 33%|████████████████████████████████████████████████▋                                                                                                 | 3248/9737 [00:09<00:17, 360.59it/s] 34%|█████████████████████████████████████████████████▎                                                                                                | 3285/9737 [00:09<00:17, 361.21it/s] 34%|█████████████████████████████████████████████████▊                                                                                                | 3322/9737 [00:09<00:17, 361.77it/s] 34%|██████████████████████████████████████████████████▎                                                                                               | 3359/9737 [00:10<00:17, 362.27it/s] 35%|██████████████████████████████████████████████████▉                                                                                               | 3396/9737 [00:10<00:17, 360.25it/s] 35%|███████████████████████████████████████████████████▍                                                                                              | 3433/9737 [00:10<00:17, 361.05it/s] 36%|████████████████████████████████████████████████████                                                                                              | 3470/9737 [00:10<00:17, 361.56it/s] 36%|████████████████████████████████████████████████████▌                                                                                             | 3507/9737 [00:10<00:17, 361.17it/s] 36%|█████████████████████████████████████████████████████▏                                                                                            | 3544/9737 [00:10<00:17, 361.67it/s] 37%|█████████████████████████████████████████████████████▋                                                                                            | 3581/9737 [00:10<00:17, 361.51it/s] 37%|██████████████████████████████████████████████████████▏                                                                                           | 3618/9737 [00:10<00:16, 360.02it/s] 38%|██████████████████████████████████████████████████████▊                                                                                           | 3655/9737 [00:10<00:16, 360.65it/s] 38%|███████████████████████████████████████████████████████▎                                                                                          | 3692/9737 [00:10<00:16, 361.25it/s] 38%|███████████████████████████████████████████████████████▉                                                                                          | 3729/9737 [00:11<00:16, 361.87it/s] 39%|████████████████████████████████████████████████████████▍                                                                                         | 3766/9737 [00:11<00:16, 361.82it/s] 39%|█████████████████████████████████████████████████████████                                                                                         | 3803/9737 [00:11<00:16, 361.53it/s] 39%|█████████████████████████████████████████████████████████▌                                                                                        | 3840/9737 [00:11<00:16, 360.06it/s] 40%|██████████████████████████████████████████████████████████▏                                                                                       | 3877/9737 [00:11<00:16, 361.17it/s] 40%|██████████████████████████████████████████████████████████▋                                                                                       | 3914/9737 [00:11<00:16, 361.60it/s] 41%|███████████████████████████████████████████████████████████▏                                                                                      | 3951/9737 [00:11<00:16, 361.21it/s] 41%|███████████████████████████████████████████████████████████▊                                                                                      | 3988/9737 [00:11<00:15, 361.58it/s] 41%|████████████████████████████████████████████████████████████▎                                                                                     | 4025/9737 [00:11<00:15, 362.10it/s] 42%|████████████████████████████████████████████████████████████▉                                                                                     | 4062/9737 [00:11<00:15, 360.37it/s] 42%|█████████████████████████████████████████████████████████████▍                                                                                    | 4099/9737 [00:12<00:15, 361.12it/s] 42%|██████████████████████████████████████████████████████████████                                                                                    | 4136/9737 [00:12<00:15, 361.55it/s] 43%|██████████████████████████████████████████████████████████████▌                                                                                   | 4173/9737 [00:12<00:15, 361.32it/s] 43%|███████████████████████████████████████████████████████████████▏                                                                                  | 4210/9737 [00:12<00:15, 361.93it/s] 44%|███████████████████████████████████████████████████████████████▋                                                                                  | 4247/9737 [00:12<00:15, 362.50it/s] 44%|████████████████████████████████████████████████████████████████▏                                                                                 | 4284/9737 [00:12<00:14, 363.67it/s] 44%|████████████████████████████████████████████████████████████████▊                                                                                 | 4321/9737 [00:12<00:14, 361.54it/s] 45%|█████████████████████████████████████████████████████████████████▎                                                                                | 4358/9737 [00:12<00:14, 362.38it/s] 45%|█████████████████████████████████████████████████████████████████▉                                                                                | 4395/9737 [00:12<00:14, 362.80it/s] 46%|██████████████████████████████████████████████████████████████████▍                                                                               | 4432/9737 [00:12<00:14, 362.76it/s] 46%|███████████████████████████████████████████████████████████████████                                                                               | 4469/9737 [00:13<00:14, 363.36it/s] 46%|███████████████████████████████████████████████████████████████████▌                                                                              | 4506/9737 [00:13<00:14, 363.61it/s] 47%|████████████████████████████████████████████████████████████████████                                                                              | 4543/9737 [00:13<00:15, 330.38it/s] 47%|████████████████████████████████████████████████████████████████████▋                                                                             | 4580/9737 [00:13<00:15, 339.52it/s] 47%|█████████████████████████████████████████████████████████████████████▏                                                                            | 4617/9737 [00:13<00:14, 346.52it/s] 48%|█████████████████████████████████████████████████████████████████████▊                                                                            | 4654/9737 [00:13<00:14, 351.79it/s] 48%|██████████████████████████████████████████████████████████████████████▎                                                                           | 4691/9737 [00:13<00:14, 355.74it/s] 49%|██████████████████████████████████████████████████████████████████████▉                                                                           | 4728/9737 [00:13<00:13, 358.53it/s] 49%|███████████████████████████████████████████████████████████████████████▍                                                                          | 4765/9737 [00:14<00:19, 251.85it/s] 49%|████████████████████████████████████████████████████████████████████████                                                                          | 4802/9737 [00:14<00:17, 277.38it/s] 50%|████████████████████████████████████████████████████████████████████████▌                                                                         | 4839/9737 [00:14<00:16, 298.44it/s] 50%|█████████████████████████████████████████████████████████████████████████                                                                         | 4876/9737 [00:14<00:15, 315.40it/s] 50%|█████████████████████████████████████████████████████████████████████████▋                                                                        | 4913/9737 [00:14<00:14, 328.91it/s] 51%|██████████████████████████████████████████████████████████████████████████▏                                                                       | 4949/9737 [00:14<00:14, 337.26it/s] 51%|██████████████████████████████████████████████████████████████████████████▊                                                                       | 4986/9737 [00:14<00:13, 345.25it/s] 52%|███████████████████████████████████████████████████████████████████████████▎                                                                      | 5023/9737 [00:14<00:13, 350.81it/s] 52%|███████████████████████████████████████████████████████████████████████████▊                                                                      | 5060/9737 [00:14<00:13, 354.94it/s] 52%|████████████████████████████████████████████████████████████████████████████▍                                                                     | 5097/9737 [00:14<00:12, 358.01it/s] 53%|████████████████████████████████████████████████████████████████████████████▉                                                                     | 5134/9737 [00:15<00:12, 360.22it/s] 53%|█████████████████████████████████████████████████████████████████████████████▌                                                                    | 5171/9737 [00:15<00:12, 361.96it/s] 53%|██████████████████████████████████████████████████████████████████████████████                                                                    | 5208/9737 [00:15<00:12, 360.80it/s] 54%|██████████████████████████████████████████████████████████████████████████████▋                                                                   | 5245/9737 [00:15<00:12, 361.56it/s] 54%|███████████████████████████████████████████████████████████████████████████████▏                                                                  | 5282/9737 [00:15<00:12, 362.40it/s] 55%|███████████████████████████████████████████████████████████████████████████████▊                                                                  | 5319/9737 [00:15<00:12, 360.44it/s] 55%|████████████████████████████████████████████████████████████████████████████████▎                                                                 | 5356/9737 [00:15<00:12, 361.36it/s] 55%|████████████████████████████████████████████████████████████████████████████████▊                                                                 | 5393/9737 [00:15<00:11, 362.09it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▍                                                                | 5430/9737 [00:15<00:11, 359.32it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▉                                                                | 5467/9737 [00:16<00:11, 360.95it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▌                                                               | 5505/9737 [00:16<00:11, 363.91it/s] 57%|███████████████████████████████████████████████████████████████████████████████████                                                               | 5543/9737 [00:16<00:11, 366.30it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▋                                                              | 5580/9737 [00:16<00:11, 366.46it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▏                                                             | 5618/9737 [00:16<00:11, 368.91it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▊                                                             | 5655/9737 [00:16<00:11, 368.94it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▎                                                            | 5693/9737 [00:16<00:10, 370.92it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▉                                                            | 5731/9737 [00:16<00:10, 372.23it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▌                                                           | 5769/9737 [00:16<00:10, 373.01it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████                                                           | 5807/9737 [00:16<00:10, 373.80it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▋                                                          | 5845/9737 [00:17<00:10, 373.85it/s] 60%|████████████████████████████████████████████████████████████████████████████████████████▏                                                         | 5883/9737 [00:17<00:10, 372.86it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▊                                                         | 5921/9737 [00:17<00:10, 373.77it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▎                                                        | 5959/9737 [00:17<00:10, 373.80it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▉                                                        | 5997/9737 [00:17<00:10, 374.00it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▍                                                       | 6035/9737 [00:17<00:09, 374.71it/s] 62%|███████████████████████████████████████████████████████████████████████████████████████████                                                       | 6073/9737 [00:17<00:09, 374.84it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▋                                                      | 6111/9737 [00:17<00:09, 373.26it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▏                                                     | 6149/9737 [00:17<00:09, 373.26it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▊                                                     | 6187/9737 [00:17<00:09, 373.74it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▎                                                    | 6225/9737 [00:18<00:09, 373.65it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▉                                                    | 6263/9737 [00:18<00:09, 373.79it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▍                                                   | 6301/9737 [00:18<00:09, 374.47it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████                                                   | 6339/9737 [00:18<00:09, 373.01it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▌                                                  | 6377/9737 [00:18<00:08, 373.58it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▏                                                 | 6415/9737 [00:18<00:08, 374.38it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▊                                                 | 6453/9737 [00:18<00:08, 374.18it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▎                                                | 6491/9737 [00:18<00:08, 374.21it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▉                                                | 6529/9737 [00:18<00:08, 374.09it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▍                                               | 6567/9737 [00:18<00:08, 372.54it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████                                               | 6605/9737 [00:19<00:08, 370.83it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▌                                              | 6643/9737 [00:19<00:08, 372.11it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▏                                             | 6681/9737 [00:19<00:08, 372.70it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▋                                             | 6719/9737 [00:19<00:08, 373.46it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████▎                                            | 6757/9737 [00:19<00:07, 374.46it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▉                                            | 6795/9737 [00:19<00:07, 372.88it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▍                                           | 6833/9737 [00:19<00:07, 373.84it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████                                           | 6871/9737 [00:19<00:07, 374.50it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▌                                          | 6909/9737 [00:19<00:07, 374.50it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                         | 6947/9737 [00:19<00:07, 374.98it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                         | 6985/9737 [00:20<00:07, 375.02it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                        | 7023/9737 [00:20<00:07, 373.25it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                        | 7061/9737 [00:20<00:07, 374.22it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                       | 7099/9737 [00:20<00:07, 374.51it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████                                       | 7137/9737 [00:20<00:06, 374.93it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                      | 7175/9737 [00:20<00:06, 374.97it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                     | 7213/9737 [00:20<00:06, 372.38it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                     | 7251/9737 [00:20<00:06, 371.32it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                    | 7289/9737 [00:20<00:06, 372.43it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                    | 7327/9737 [00:20<00:06, 373.24it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                   | 7365/9737 [00:21<00:06, 374.16it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████                                   | 7403/9737 [00:21<00:06, 374.58it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                  | 7441/9737 [00:21<00:06, 351.88it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 7479/9737 [00:21<00:06, 357.62it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 7517/9737 [00:21<00:06, 362.03it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                | 7555/9737 [00:21<00:05, 365.47it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                | 7593/9737 [00:21<00:05, 367.95it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                               | 7631/9737 [00:21<00:05, 370.07it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                               | 7669/9737 [00:21<00:05, 369.46it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                              | 7707/9737 [00:22<00:05, 371.40it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                             | 7745/9737 [00:22<00:05, 373.01it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                             | 7783/9737 [00:22<00:05, 373.48it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                            | 7821/9737 [00:22<00:05, 374.03it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                            | 7859/9737 [00:22<00:05, 371.42it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                           | 7897/9737 [00:22<00:04, 369.66it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                           | 7935/9737 [00:22<00:04, 371.21it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                          | 7973/9737 [00:22<00:04, 371.67it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                          | 8011/9737 [00:22<00:04, 371.74it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                         | 8049/9737 [00:22<00:04, 371.50it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                        | 8087/9737 [00:23<00:04, 372.12it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                        | 8125/9737 [00:23<00:04, 371.02it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                       | 8163/9737 [00:23<00:04, 371.56it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                       | 8201/9737 [00:23<00:04, 371.79it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                      | 8239/9737 [00:23<00:04, 372.07it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                      | 8277/9737 [00:23<00:03, 371.87it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                     | 8315/9737 [00:23<00:03, 372.79it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                    | 8353/9737 [00:23<00:03, 371.71it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                    | 8391/9737 [00:23<00:03, 372.44it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                   | 8429/9737 [00:23<00:03, 373.33it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                   | 8467/9737 [00:24<00:03, 370.22it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 8505/9737 [00:24<00:03, 371.29it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                  | 8543/9737 [00:24<00:03, 371.98it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 8581/9737 [00:24<00:03, 371.29it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                | 8619/9737 [00:24<00:03, 372.35it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 8657/9737 [00:24<00:02, 372.92it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍               | 8695/9737 [00:24<00:02, 373.47it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉               | 8733/9737 [00:24<00:02, 373.66it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌              | 8771/9737 [00:24<00:02, 373.55it/s] 90%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████              | 8809/9737 [00:24<00:02, 372.00it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋             | 8847/9737 [00:25<00:02, 372.43it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏            | 8885/9737 [00:25<00:02, 373.09it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊            | 8923/9737 [00:25<00:02, 373.84it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎           | 8961/9737 [00:25<00:02, 373.99it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉           | 8999/9737 [00:25<00:01, 373.71it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌          | 9037/9737 [00:25<00:01, 372.37it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 9075/9737 [00:25<00:01, 372.79it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋         | 9113/9737 [00:25<00:01, 372.90it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏        | 9151/9737 [00:25<00:01, 373.06it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊        | 9189/9737 [00:26<00:01, 373.44it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎       | 9227/9737 [00:26<00:01, 373.43it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉       | 9265/9737 [00:26<00:01, 371.89it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍      | 9303/9737 [00:26<00:01, 372.13it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████      | 9341/9737 [00:26<00:01, 372.58it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋     | 9379/9737 [00:26<00:00, 373.07it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏    | 9417/9737 [00:26<00:00, 373.09it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊    | 9455/9737 [00:26<00:00, 373.31it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎   | 9493/9737 [00:26<00:00, 371.48it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉   | 9531/9737 [00:26<00:00, 372.04it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍  | 9569/9737 [00:27<00:00, 372.58it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████  | 9607/9737 [00:27<00:00, 373.01it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌ | 9645/9737 [00:27<00:00, 373.49it/s] 99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏| 9683/9737 [00:27<00:00, 373.97it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊| 9721/9737 [00:27<00:00, 371.82it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9737/9737 [00:27<00:00, 354.35it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.34s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.24s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.45s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.18s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.14s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.10s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.39s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.50s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]
[2023-08-11 07:51:40,306] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
[2023-08-11 07:51:53,861] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 07:51:53,862] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 07:51:53,862] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 07:51:53,862] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 07:51:53,862] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 07:51:53,862] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f803e3eae80>
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f803b2ef910>
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 07:51:53,863] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 07:51:53,864] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 07:51:53,864] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 07:51:53,864] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 07:51:53,864] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 07:51:53,864] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 07:51:53,864] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 07:51:53,864] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 07:51:53,864] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 07:51:53,864] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 07:51:53,864] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5207366943359375 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]Time to load utils op: 0.4044482707977295 seconds
############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: The machine was very intricate, it was quite an what? Choices:  A: box B: apparatus C: appliance D: wash dishes E: implement
Rationales: 1. The key words in the sentence are "machine" and "intricate". So we need a noun that relates to these two descriptors. 
2. Let's analyze the options.
3. The word "box" is just a container; it doesn't suggest anything intricate and it doesn't naturally align with "machine", so A is not likely the answer.
4. The term "appliance" usually refers to a piece of electrical equipment used for domestic chores, not necessarily described as intricate or complex. So C isn't the likely answer.
5. "Wash dishes" is an action, not a noun that describes a complex machine, therefore D is not valid.
6. An "implement" usually refers to a tool or utensil, sometimes simple and often hand-held and not necessarily intricate, so E is not the correct answer.
7. Finally we have "apparatus". It's a noun that refers to a complex piece of machinery. This aligns with both "machine" and "intricate" in the sentence. 
8. Therefore, B: "apparatus" is the correct answer.
Answer: B: apparatus

Input: Where do you get petrol? Choices:  A: burn hot B: fuel tank C: burn hot D: car E: gas station
Rationales: 1. In the given question, we are asked about the place we acquire petrol.
2. Hence, it is clear that the answer would be a location or a place.
3. Let's analyze each of the given options.
4. The option A: burn hot and C: burn hot indicates a state of something, specifically a state of high temperature. This does not answer the question, so both options are not correct.
5. The option B: fuel tank is related to petrol as it's a place where we store petrol in our vehicles. But it's not where we get petrol from.
6. The option D: car, again it is something where the petrol is used, not where it is obtained from.
7. The option E: gas station, on the other hand, is a place where petrol is sold. This place is technically where most of us obtain petrol for vehicular use.
8. Therefore, by the process of elimination and relevant reasoning, the answer is E: gas station.
Answer: E: gas station

Input: Where might a television used at night be? Choices:  A: cabinet B: house C: apartment D: bedroom E: woods
Rationales: 1. The question is asking us to identify a location where a television might be used at night.
2. If we look closely, the question is not only asking for a location of a television but rather a location of a television specifically used at night.
3. An important hint here is the use of the word "night", which indicates a place where someone would likely be during the nighttime hours.
4. An immediate place that comes to mind is a residential area, where people live and remain at night.
5. Now, let's consider each choice.
6. A 'cabinet' is indeed a place where one might store a television, but its use isn't necessarily associated with nighttime.
7. Similarly, a 'house' or an 'apartment' are both places where one might find a television, but these answers are both too broad and still don't address the "used at night" aspect of the question.
8. 'Woods' wouldn't usually be a place where a television is placed or used, especially not at night.
9. The 'bedroom', however, is a place where people commonly use a television at night. A person might retire to their bedroom at night and use their television prior to sleeping.
10. Hence the answer is D: bedroom.
Answer: D: bedroom

Input: The knowledge was expensive to get, where was it being gained? Choices:  A: university B: book C: field D: meeting E: class
Rationales: 1. The question states that the knowledge was expensive to get. 
2. We need to consider what each of the options A through E generally cost to access and whether they're likely to be described as "expensive."
3. Getting knowledge from a book (option B) is generally not too expensive, as books can be purchased, borrowed for free from a library, or read online at a relatively low cost.
4. Gaining knowledge in the field (Option C) doesn't always involve a cost, as this could relate to gaining experience by simply partaking in certain related activities.
5. Attending a meeting (Option D) is generally free as well.
6. Taking a class (Option E) could potentially be expensive, but often, individual classes are part of a larger program, such as those offered at universities.
7. Exploring option A, we find that attending a university to gain knowledge often involves tuition fees, which can be quite expensive. 
8. Considering these factors, we infer that the knowledge 'expensive to get' was being gained at a University, so the answer is A: University.
Answer: A: university

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i4-s20-rTrue
Loading extension module utils...
Time to load utils op: 0.6049864292144775 seconds
Loading extension module utils...
Time to load utils op: 0.5044782161712646 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:43<35:26, 43.40s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:26<34:25, 43.04s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:08<33:21, 42.59s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:51<32:45, 42.72s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:33<31:56, 42.59s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:16<31:16, 42.64s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:58<30:33, 42.65s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:41<29:48, 42.58s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:23<29:03, 42.52s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:06<28:18, 42.47s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:49<27:42, 42.64s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:31<26:58, 42.59s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:13<26:13, 42.53s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:56<25:30, 42.51s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:39<24:52, 42.63s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:21<24:06, 42.54s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:04<23:21, 42.48s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [12:46<22:40, 42.50s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [13:29<21:58, 42.52s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [13:56<18:57, 37.91s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [14:38<18:54, 39.13s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [15:20<18:42, 40.10s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [16:04<18:31, 41.17s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [16:46<18:01, 41.61s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [17:29<17:26, 41.88s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [18:12<16:50, 42.12s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:54<16:11, 42.23s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:36<15:29, 42.24s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:19<14:46, 42.24s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:01<14:05, 42.26s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [21:44<13:29, 42.58s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:22<12:18, 41.02s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:05<11:48, 41.70s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [23:47<11:10, 41.92s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:13<09:17, 37.17s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [24:56<09:03, 38.81s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [25:39<08:40, 40.02s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:21<08:06, 40.52s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [27:03<07:33, 41.21s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [27:46<06:55, 41.58s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [28:28<06:16, 41.78s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [29:11<05:35, 41.99s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [29:53<04:54, 42.12s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [30:35<04:13, 42.23s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [31:18<03:31, 42.25s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [32:00<02:49, 42.27s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [32:43<02:07, 42.38s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [33:25<01:24, 42.45s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [34:08<00:42, 42.55s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:51<00:00, 42.52s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:51<00:00, 41.82s/it]
name: commonsenseqa | {'exact_match': 1.2, 'rougeL': 3.4467} | lm_loss 7.4099 | avg. gen lenth: 336.492
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s20-rFalse --seed 20 --num-in-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 08:26:59,430] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 1
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9740 [00:00<?, ?it/s]  2%|███▌                                                                                                                                              | 239/9740 [00:00<00:03, 2386.98it/s]  5%|███████▏                                                                                                                                          | 482/9740 [00:00<00:03, 2407.83it/s]  7%|██████████▉                                                                                                                                       | 726/9740 [00:00<00:03, 2417.85it/s] 10%|██████████████▌                                                                                                                                   | 969/9740 [00:00<00:03, 2421.57it/s] 12%|██████████████████                                                                                                                               | 1214/9740 [00:00<00:03, 2431.13it/s] 15%|█████████████████████▋                                                                                                                           | 1458/9740 [00:00<00:03, 2432.55it/s] 17%|█████████████████████████▎                                                                                                                       | 1703/9740 [00:00<00:03, 2437.72it/s] 20%|████████████████████████████▉                                                                                                                    | 1947/9740 [00:00<00:03, 2411.13it/s] 22%|████████████████████████████████▌                                                                                                                | 2190/9740 [00:00<00:03, 2414.64it/s] 25%|████████████████████████████████████▎                                                                                                            | 2436/9740 [00:01<00:03, 2425.67it/s] 28%|███████████████████████████████████████▉                                                                                                         | 2680/9740 [00:01<00:02, 2427.49it/s] 30%|███████████████████████████████████████████▌                                                                                                     | 2924/9740 [00:01<00:02, 2426.36it/s] 33%|███████████████████████████████████████████████▏                                                                                                 | 3167/9740 [00:01<00:02, 2386.73it/s] 35%|██████████████████████████████████████████████████▋                                                                                              | 3408/9740 [00:01<00:02, 2391.31it/s] 37%|██████████████████████████████████████████████████████▎                                                                                          | 3649/9740 [00:01<00:02, 2396.62it/s] 40%|█████████████████████████████████████████████████████████▉                                                                                       | 3893/9740 [00:01<00:02, 2408.35it/s] 42%|█████████████████████████████████████████████████████████████▌                                                                                   | 4137/9740 [00:01<00:02, 2416.17it/s] 45%|█████████████████████████████████████████████████████████████████▏                                                                               | 4380/9740 [00:01<00:02, 2419.76it/s] 47%|████████████████████████████████████████████████████████████████████▊                                                                            | 4623/9740 [00:01<00:02, 2382.29it/s] 50%|████████████████████████████████████████████████████████████████████████▍                                                                        | 4862/9740 [00:02<00:02, 2024.68it/s] 52%|███████████████████████████████████████████████████████████████████████████▉                                                                     | 5104/9740 [00:02<00:02, 2128.23it/s] 55%|███████████████████████████████████████████████████████████████████████████████▌                                                                 | 5347/9740 [00:02<00:01, 2209.24it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▏                                                             | 5591/9740 [00:02<00:01, 2272.63it/s] 60%|██████████████████████████████████████████████████████████████████████████████████████▉                                                          | 5842/9740 [00:02<00:01, 2339.29it/s] 63%|██████████████████████████████████████████████████████████████████████████████████████████▋                                                      | 6093/9740 [00:02<00:01, 2388.48it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▍                                                  | 6344/9740 [00:02<00:01, 2422.91it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████                                              | 6657/9740 [00:02<00:01, 2629.63it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                        | 7045/9740 [00:02<00:00, 2999.98it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                  | 7436/9740 [00:02<00:00, 3270.58it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                            | 7805/9740 [00:03<00:00, 3394.93it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                       | 8196/9740 [00:03<00:00, 3546.42it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                 | 8585/9740 [00:03<00:00, 3646.91it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌           | 8974/9740 [00:03<00:00, 3718.78it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎     | 9360/9740 [00:03<00:00, 3760.11it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9740/9740 [00:03<00:00, 2720.51it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.03s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.48s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.12s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.93s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.37s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.55s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.62s/it]
[2023-08-11 08:27:54,571] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.13s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.30s/it]
[2023-08-11 08:28:13,158] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 08:28:13,158] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f40690d4e80>
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 08:28:13,159] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f40628d8910>
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 08:28:13,160] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 08:28:13,160] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3589315414428711 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: The machine was very intricate, it was quite an what? Choices:  A: box B: apparatus C: appliance D: wash dishes E: implement
Answer: B: apparatus

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s20-rFalse
Loading extension module utils...
Time to load utils op: 0.3042900562286377 seconds
Loading extension module utils...
Time to load utils op: 0.40421462059020996 seconds
Loading extension module utils...
Time to load utils op: 0.4043128490447998 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:59<48:37, 59.53s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:38<37:50, 47.30s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:21<35:26, 45.25s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:17<38:13, 49.85s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:15<39:31, 52.71s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [05:13<39:58, 54.52s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [06:13<40:14, 56.16s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [07:11<39:41, 56.71s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:55<36:05, 52.82s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:16<28:40, 43.00s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:59<27:55, 42.95s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:39<26:45, 42.24s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [10:38<29:03, 47.13s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [11:30<29:06, 48.52s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:55<24:09, 41.42s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [12:53<26:24, 46.59s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [13:51<27:28, 49.96s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [14:49<27:52, 52.27s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [15:48<28:03, 54.31s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [16:45<27:39, 55.32s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [17:42<26:54, 55.68s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [18:39<26:13, 56.19s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [19:38<25:39, 57.04s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [20:36<24:47, 57.22s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [21:35<24:07, 57.89s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [22:14<20:48, 52.04s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [23:13<20:43, 54.08s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [23:57<18:46, 51.22s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [24:55<18:39, 53.32s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [25:38<16:40, 50.02s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [26:20<15:07, 47.74s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [27:17<15:09, 50.52s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [28:14<14:53, 52.58s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [29:11<14:22, 53.88s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [29:30<10:47, 43.20s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [29:56<08:53, 38.13s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [30:31<08:04, 37.30s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [31:30<08:45, 43.79s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [32:07<07:37, 41.63s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [32:56<07:19, 43.94s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [33:12<05:19, 35.48s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [33:45<04:37, 34.74s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [34:41<04:48, 41.22s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [35:04<03:34, 35.73s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [36:02<03:31, 42.37s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [36:31<02:33, 38.36s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [36:55<01:41, 33.91s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [37:35<01:11, 35.85s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [38:09<00:35, 35.38s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:06<00:00, 41.94s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:06<00:00, 46.94s/it]
name: commonsenseqa | {'exact_match': 0.8, 'rougeL': 5.0032} | lm_loss 7.2169 | avg. gen lenth: 191.444
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s20-rFalse --seed 20 --num-in-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 09:07:28,760] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 2
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9739 [00:00<?, ?it/s]  2%|███                                                                                                                                               | 201/9739 [00:00<00:04, 2007.76it/s]  4%|██████                                                                                                                                            | 405/9739 [00:00<00:04, 2024.65it/s]  6%|█████████▏                                                                                                                                        | 610/9739 [00:00<00:04, 2032.84it/s]  8%|████████████▏                                                                                                                                     | 816/9739 [00:00<00:04, 2039.90it/s] 10%|███████████████▏                                                                                                                                 | 1022/9739 [00:00<00:04, 2045.93it/s] 13%|██████████████████▎                                                                                                                              | 1228/9739 [00:00<00:04, 2048.60it/s] 15%|█████████████████████▎                                                                                                                           | 1433/9739 [00:00<00:04, 2046.53it/s] 17%|████████████████████████▍                                                                                                                        | 1639/9739 [00:00<00:03, 2048.49it/s] 19%|███████████████████████████▍                                                                                                                     | 1844/9739 [00:00<00:04, 1971.41it/s] 21%|██████████████████████████████▍                                                                                                                  | 2047/9739 [00:01<00:03, 1986.67it/s] 23%|█████████████████████████████████▍                                                                                                               | 2250/9739 [00:01<00:03, 1998.73it/s] 25%|████████████████████████████████████▌                                                                                                            | 2457/9739 [00:01<00:03, 2018.30it/s] 27%|███████████████████████████████████████▋                                                                                                         | 2662/9739 [00:01<00:03, 2025.68it/s] 29%|██████████████████████████████████████████▋                                                                                                      | 2866/9739 [00:01<00:03, 2029.23it/s] 32%|█████████████████████████████████████████████▋                                                                                                   | 3070/9739 [00:01<00:03, 2025.02it/s] 34%|████████████████████████████████████████████████▊                                                                                                | 3276/9739 [00:01<00:03, 2034.55it/s] 36%|███████████████████████████████████████████████████▊                                                                                             | 3481/9739 [00:01<00:03, 2038.24it/s] 38%|██████████████████████████████████████████████████████▉                                                                                          | 3686/9739 [00:01<00:02, 2039.93it/s] 40%|█████████████████████████████████████████████████████████▉                                                                                       | 3891/9739 [00:01<00:02, 2038.47it/s] 42%|████████████████████████████████████████████████████████████▉                                                                                    | 4095/9739 [00:02<00:02, 2037.72it/s] 44%|████████████████████████████████████████████████████████████████                                                                                 | 4300/9739 [00:02<00:02, 2039.53it/s] 46%|███████████████████████████████████████████████████████████████████                                                                              | 4506/9739 [00:02<00:02, 2042.96it/s] 48%|██████████████████████████████████████████████████████████████████████▏                                                                          | 4711/9739 [00:02<00:02, 2013.45it/s] 50%|█████████████████████████████████████████████████████████████████████████▏                                                                       | 4913/9739 [00:02<00:03, 1466.86it/s] 53%|████████████████████████████████████████████████████████████████████████████▏                                                                    | 5119/9739 [00:02<00:02, 1604.76it/s] 55%|███████████████████████████████████████████████████████████████████████████████▎                                                                 | 5325/9739 [00:02<00:02, 1718.83it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▎                                                              | 5532/9739 [00:02<00:02, 1811.35it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▌                                                           | 5745/9739 [00:02<00:02, 1896.70it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▋                                                        | 5958/9739 [00:03<00:01, 1960.09it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▉                                                     | 6171/9739 [00:03<00:01, 2008.66it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▉                                                  | 6377/9739 [00:03<00:01, 2017.78it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████                                               | 6589/9739 [00:03<00:01, 2044.69it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▎                                           | 6802/9739 [00:03<00:01, 2069.41it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                        | 7016/9739 [00:03<00:01, 2089.27it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                    | 7301/9739 [00:03<00:01, 2314.10it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                               | 7611/9739 [00:03<00:00, 2547.17it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                          | 7937/9739 [00:03<00:00, 2758.19it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                      | 8266/9739 [00:03<00:00, 2915.58it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                 | 8592/9739 [00:04<00:00, 3016.94it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊            | 8917/9739 [00:04<00:00, 3085.58it/s] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 9242/9739 [00:04<00:00, 3133.48it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍  | 9568/9739 [00:04<00:00, 3170.72it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9739/9739 [00:04<00:00, 2209.21it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.39s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.45s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.63s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.37s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.50s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.46s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.92s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.91s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.06s/it]
[2023-08-11 09:08:26,637] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-11 09:08:37,320] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 09:08:37,321] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 09:08:37,322] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 09:08:37,322] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 09:08:37,322] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 09:08:37,322] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f50822ede80>
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 09:08:37,323] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f50821bb910>
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 09:08:37,324] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 09:08:37,325] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3398749828338623 seconds
Loading extension module utils...
Time to load utils op: 0.20453405380249023 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: The machine was very intricate, it was quite an what? Choices:  A: box B: apparatus C: appliance D: wash dishes E: implement
Answer: B: apparatus

Input: Where do you get petrol? Choices:  A: burn hot B: fuel tank C: burn hot D: car E: gas station
Answer: E: gas station

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s20-rFalse
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.3046092987060547 seconds
Time to load utils op: 0.3044576644897461 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:21<17:09, 21.00s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:18<34:03, 42.56s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [01:58<32:27, 41.43s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:56<36:49, 48.04s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:37<34:06, 45.49s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:35<36:28, 49.73s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:33<37:34, 52.44s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:32<38:01, 54.33s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:30<37:56, 55.52s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:17<35:19, 52.98s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [09:16<35:34, 54.72s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:47<30:04, 47.49s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [10:11<24:57, 40.47s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:26<19:41, 32.83s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:05<20:13, 34.66s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:47<20:53, 36.87s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:40<22:53, 41.62s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:37<24:40, 46.27s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:32<25:17, 48.96s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:09<22:41, 45.38s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:06<23:36, 48.83s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:45<21:20, 45.74s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:42<22:11, 49.33s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:39<22:23, 51.67s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [19:08<18:36, 44.68s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [20:05<19:20, 48.34s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:35<16:27, 42.96s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:14<15:16, 41.65s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [22:11<16:10, 46.22s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:49<14:40, 44.03s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [23:46<15:06, 47.71s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [24:11<12:18, 41.05s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [25:10<13:10, 46.48s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:52<12:01, 45.11s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:49<12:10, 48.71s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [27:17<09:52, 42.34s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [27:39<07:51, 36.24s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [28:37<08:34, 42.90s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [28:54<06:23, 34.87s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [29:15<05:07, 30.78s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [29:53<04:57, 33.06s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [30:33<04:41, 35.13s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [31:28<04:48, 41.17s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [32:19<04:24, 44.14s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:09<03:48, 45.79s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:06<03:16, 49.11s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [34:16<01:52, 37.40s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [34:42<01:08, 34.08s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [35:28<00:37, 37.44s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [36:26<00:00, 43.63s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [36:26<00:00, 43.72s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 4.5716} | lm_loss 7.0403 | avg. gen lenth: 168.6
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i3-s20-rFalse --seed 20 --num-in-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 09:46:22,646] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i3-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 3
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i3-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9738 [00:00<?, ?it/s]  2%|██▌                                                                                                                                               | 173/9738 [00:00<00:05, 1726.56it/s]  4%|█████▏                                                                                                                                            | 347/9738 [00:00<00:05, 1732.71it/s]  5%|███████▊                                                                                                                                          | 523/9738 [00:00<00:05, 1742.63it/s]  7%|██████████▍                                                                                                                                       | 699/9738 [00:00<00:05, 1747.15it/s]  9%|█████████████▏                                                                                                                                    | 876/9738 [00:00<00:05, 1754.55it/s] 11%|███████████████▋                                                                                                                                 | 1053/9738 [00:00<00:04, 1756.66it/s] 13%|██████████████████▎                                                                                                                              | 1229/9738 [00:00<00:05, 1664.00it/s] 14%|████████████████████▉                                                                                                                            | 1404/9738 [00:00<00:04, 1687.91it/s] 16%|███████████████████████▍                                                                                                                         | 1574/9738 [00:00<00:05, 1620.15it/s] 18%|█████████████████████████▉                                                                                                                       | 1746/9738 [00:01<00:04, 1647.79it/s] 20%|████████████████████████████▍                                                                                                                    | 1912/9738 [00:01<00:04, 1598.13it/s] 21%|███████████████████████████████                                                                                                                  | 2083/9738 [00:01<00:04, 1629.42it/s] 23%|█████████████████████████████████▌                                                                                                               | 2256/9738 [00:01<00:04, 1657.49it/s] 25%|████████████████████████████████████▏                                                                                                            | 2431/9738 [00:01<00:04, 1683.08it/s] 27%|██████████████████████████████████████▊                                                                                                          | 2605/9738 [00:01<00:04, 1697.47it/s] 29%|█████████████████████████████████████████▎                                                                                                       | 2776/9738 [00:01<00:04, 1699.67it/s] 30%|███████████████████████████████████████████▉                                                                                                     | 2949/9738 [00:01<00:03, 1708.21it/s] 32%|██████████████████████████████████████████████▌                                                                                                  | 3124/9738 [00:01<00:03, 1718.64it/s] 34%|█████████████████████████████████████████████████                                                                                                | 3296/9738 [00:01<00:03, 1716.90it/s] 36%|███████████████████████████████████████████████████▋                                                                                             | 3469/9738 [00:02<00:03, 1718.60it/s] 37%|██████████████████████████████████████████████████████▏                                                                                          | 3642/9738 [00:02<00:03, 1719.54it/s] 39%|████████████████████████████████████████████████████████▊                                                                                        | 3817/9738 [00:02<00:03, 1727.49it/s] 41%|███████████████████████████████████████████████████████████▍                                                                                     | 3992/9738 [00:02<00:03, 1732.43it/s] 43%|██████████████████████████████████████████████████████████████                                                                                   | 4167/9738 [00:02<00:03, 1734.87it/s] 45%|████████████████████████████████████████████████████████████████▋                                                                                | 4342/9738 [00:02<00:03, 1736.67it/s] 46%|███████████████████████████████████████████████████████████████████▏                                                                             | 4516/9738 [00:02<00:03, 1706.30it/s] 49%|██████████████████████████████████████████████████████████████████████▌                                                                          | 4741/9738 [00:02<00:03, 1422.49it/s] 51%|██████████████████████████████████████████████████████████████████████████▍                                                                      | 5003/9738 [00:02<00:02, 1713.54it/s] 54%|██████████████████████████████████████████████████████████████████████████████▍                                                                  | 5269/9738 [00:03<00:02, 1956.03it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▍                                                              | 5537/9738 [00:03<00:01, 2150.56it/s] 60%|██████████████████████████████████████████████████████████████████████████████████████▌                                                          | 5815/9738 [00:03<00:01, 2323.17it/s] 63%|██████████████████████████████████████████████████████████████████████████████████████████▋                                                      | 6092/9738 [00:03<00:01, 2449.20it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▊                                                  | 6370/9738 [00:03<00:01, 2542.34it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                                              | 6647/9738 [00:03<00:01, 2606.47it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▏                                         | 6927/9738 [00:03<00:01, 2661.66it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                     | 7206/9738 [00:03<00:00, 2699.18it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 7479/9738 [00:03<00:00, 2686.44it/s] 80%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                             | 7756/9738 [00:03<00:00, 2709.85it/s] 83%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                         | 8035/9738 [00:04<00:00, 2731.44it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                     | 8314/9738 [00:04<00:00, 2747.59it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                 | 8592/9738 [00:04<00:00, 2755.77it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████             | 8869/9738 [00:04<00:00, 2759.42it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏        | 9148/9738 [00:04<00:00, 2767.58it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎    | 9427/9738 [00:04<00:00, 2771.67it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌| 9705/9738 [00:04<00:00, 2773.31it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9738/9738 [00:04<00:00, 2080.33it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.07s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.04s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.46s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.98s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.06s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.37s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.33s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.51s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.63s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.63s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
[2023-08-11 09:47:19,136] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.90s/it]
[2023-08-11 09:47:26,583] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 09:47:26,584] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 09:47:26,584] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f37b09efe80>
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 09:47:26,585] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f37b5fd8910>
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 09:47:26,586] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 09:47:26,587] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 09:47:26,587] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 09:47:26,587] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 09:47:26,587] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 09:47:26,587] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 09:47:26,587] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 09:47:26,587] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 09:47:26,587] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 09:47:26,587] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.37098145484924316 seconds
Loading extension module utils...
Time to load utils op: 0.30440855026245117 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: The machine was very intricate, it was quite an what? Choices:  A: box B: apparatus C: appliance D: wash dishes E: implement
Answer: B: apparatus

Input: Where do you get petrol? Choices:  A: burn hot B: fuel tank C: burn hot D: car E: gas station
Answer: E: gas station

Input: Where might a television used at night be? Choices:  A: cabinet B: house C: apartment D: bedroom E: woods
Answer: D: bedroom

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i3-s20-rFalse
Loading extension module utils...
Time to load utils op: 0.4063727855682373 seconds
Loading extension module utils...
Time to load utils op: 0.40445518493652344 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:58<47:27, 58.11s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:24<31:26, 39.30s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [01:50<26:17, 33.57s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:05<19:55, 26.00s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:02<27:50, 37.12s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [03:45<28:43, 39.18s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:40<31:50, 44.43s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:36<33:33, 47.95s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:05<28:46, 42.11s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:01<30:59, 46.50s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:54<31:29, 48.45s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:21<26:34, 41.96s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:07<26:38, 43.21s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:04<28:18, 47.19s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:51<27:34, 47.27s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:10<21:55, 38.70s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:39<19:44, 35.89s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [12:08<18:00, 33.76s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [13:04<20:55, 40.50s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [13:50<21:06, 42.21s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [14:46<22:23, 46.33s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [15:41<22:45, 48.78s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [16:20<20:39, 45.90s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [16:46<17:17, 39.90s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [17:42<18:41, 44.85s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [18:19<16:57, 42.39s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:55<15:27, 40.32s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:51<16:32, 45.10s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:30<15:10, 43.34s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:26<15:42, 47.11s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [22:06<14:12, 44.87s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:43<12:47, 42.66s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:08<10:36, 37.44s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [23:44<09:52, 37.02s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:41<10:43, 42.87s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [25:21<09:49, 42.09s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [26:12<09:42, 44.80s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:53<08:42, 43.51s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [27:50<08:42, 47.50s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [28:23<07:13, 43.31s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [29:12<06:45, 45.11s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [29:29<04:53, 36.65s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [29:55<03:54, 33.46s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [30:51<04:01, 40.18s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [31:45<03:41, 44.40s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [32:42<03:11, 47.99s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [33:33<02:27, 49.05s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [34:31<01:43, 51.51s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [34:54<00:43, 43.07s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:45<00:00, 45.58s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:45<00:00, 42.92s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 4.7711} | lm_loss 7.0636 | avg. gen lenth: 172.68
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i4-s20-rFalse --seed 20 --num-in-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 10:24:11,349] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i4-s20-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 4
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i4-s20-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 20
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9737 [00:00<?, ?it/s]  1%|██▏                                                                                                                                               | 143/9737 [00:00<00:06, 1423.68it/s]  3%|████▎                                                                                                                                             | 286/9737 [00:00<00:06, 1427.31it/s]  4%|██████▍                                                                                                                                           | 430/9737 [00:00<00:06, 1431.68it/s]  6%|████████▌                                                                                                                                         | 575/9737 [00:00<00:06, 1435.33it/s]  7%|██████████▊                                                                                                                                       | 719/9737 [00:00<00:06, 1434.81it/s]  9%|████████████▉                                                                                                                                     | 865/9737 [00:00<00:06, 1442.45it/s] 10%|███████████████                                                                                                                                  | 1010/9737 [00:00<00:06, 1443.16it/s] 12%|█████████████████▏                                                                                                                               | 1157/9737 [00:00<00:05, 1448.56it/s] 13%|███████████████████▍                                                                                                                             | 1302/9737 [00:00<00:05, 1422.84it/s] 15%|█████████████████████▌                                                                                                                           | 1445/9737 [00:01<00:05, 1418.44it/s] 16%|███████████████████████▋                                                                                                                         | 1588/9737 [00:01<00:05, 1421.52it/s] 18%|█████████████████████████▊                                                                                                                       | 1733/9737 [00:01<00:05, 1429.44it/s] 19%|███████████████████████████▉                                                                                                                     | 1876/9737 [00:01<00:05, 1401.85it/s] 21%|██████████████████████████████                                                                                                                   | 2020/9737 [00:01<00:05, 1412.31it/s] 22%|████████████████████████████████▏                                                                                                                | 2164/9737 [00:01<00:05, 1419.32it/s] 24%|██████████████████████████████████▎                                                                                                              | 2308/9737 [00:01<00:05, 1423.37it/s] 25%|████████████████████████████████████▌                                                                                                            | 2453/9737 [00:01<00:05, 1430.22it/s] 27%|██████████████████████████████████████▋                                                                                                          | 2597/9737 [00:01<00:04, 1430.56it/s] 28%|████████████████████████████████████████▊                                                                                                        | 2741/9737 [00:01<00:04, 1422.74it/s] 30%|██████████████████████████████████████████▉                                                                                                      | 2885/9737 [00:02<00:04, 1426.11it/s] 31%|█████████████████████████████████████████████                                                                                                    | 3029/9737 [00:02<00:04, 1429.57it/s] 33%|███████████████████████████████████████████████▏                                                                                                 | 3172/9737 [00:02<00:04, 1429.34it/s] 34%|█████████████████████████████████████████████████▍                                                                                               | 3317/9737 [00:02<00:04, 1434.10it/s] 36%|███████████████████████████████████████████████████▉                                                                                             | 3488/9737 [00:02<00:04, 1514.55it/s] 38%|███████████████████████████████████████████████████████▏                                                                                         | 3705/9737 [00:02<00:03, 1710.45it/s] 40%|██████████████████████████████████████████████████████████▍                                                                                      | 3924/9737 [00:02<00:03, 1851.67it/s] 43%|█████████████████████████████████████████████████████████████▋                                                                                   | 4143/9737 [00:02<00:02, 1952.48it/s] 45%|████████████████████████████████████████████████████████████████▉                                                                                | 4361/9737 [00:02<00:02, 2018.52it/s] 47%|███████████████████████████████████████████████████████████████████▉                                                                             | 4566/9737 [00:02<00:02, 2027.23it/s] 49%|███████████████████████████████████████████████████████████████████████                                                                          | 4769/9737 [00:03<00:03, 1588.46it/s] 51%|██████████████████████████████████████████████████████████████████████████▏                                                                      | 4981/9737 [00:03<00:02, 1721.24it/s] 53%|█████████████████████████████████████████████████████████████████████████████▍                                                                   | 5199/9737 [00:03<00:02, 1841.01it/s] 56%|████████████████████████████████████████████████████████████████████████████████▋                                                                | 5417/9737 [00:03<00:02, 1931.97it/s] 58%|████████████████████████████████████████████████████████████████████████████████████                                                             | 5642/9737 [00:03<00:02, 2020.26it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▍                                                         | 5870/9737 [00:03<00:01, 2093.70it/s] 63%|██████████████████████████████████████████████████████████████████████████████████████████▊                                                      | 6098/9737 [00:03<00:01, 2146.49it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▏                                                  | 6325/9737 [00:03<00:01, 2181.25it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▌                                               | 6552/9737 [00:03<00:01, 2205.72it/s] 70%|████████████████████████████████████████████████████████████████████████████████████████████████████▉                                            | 6780/9737 [00:04<00:01, 2227.44it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                        | 7006/9737 [00:04<00:01, 2234.41it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                     | 7234/9737 [00:04<00:01, 2246.60it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████                                  | 7460/9737 [00:04<00:01, 2222.84it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                              | 7686/9737 [00:04<00:00, 2233.33it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                           | 7910/9737 [00:04<00:00, 2225.03it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                       | 8137/9737 [00:04<00:00, 2237.38it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                    | 8365/9737 [00:04<00:00, 2248.75it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                 | 8594/9737 [00:04<00:00, 2257.86it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎             | 8822/9737 [00:04<00:00, 2263.34it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊          | 9050/9737 [00:05<00:00, 2266.64it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏      | 9277/9737 [00:05<00:00, 2265.19it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌   | 9504/9737 [00:05<00:00, 2261.97it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉| 9731/9737 [00:05<00:00, 2262.44it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9737/9737 [00:05<00:00, 1826.74it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.27s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.43s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.59s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.28s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.42s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.92s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.91s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.83s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.98s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.13s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.31s/it]
[2023-08-11 10:25:09,975] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.29s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]
[2023-08-11 10:25:19,567] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 10:25:19,567] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f8cc7c0ee80>
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 10:25:19,568] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f8cc75a3910>
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 10:25:19,569] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 10:25:19,569] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.3305044174194336 seconds
Time to load utils op: 0.20427370071411133 seconds
Loading extension module utils...
Time to load utils op: 0.30417537689208984 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: The machine was very intricate, it was quite an what? Choices:  A: box B: apparatus C: appliance D: wash dishes E: implement
Answer: B: apparatus

Input: Where do you get petrol? Choices:  A: burn hot B: fuel tank C: burn hot D: car E: gas station
Answer: E: gas station

Input: Where might a television used at night be? Choices:  A: cabinet B: house C: apartment D: bedroom E: woods
Answer: D: bedroom

Input: The knowledge was expensive to get, where was it being gained? Choices:  A: university B: book C: field D: meeting E: class
Answer: A: university

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i4-s20-rFalse
Loading extension module utils...
Time to load utils op: 0.30462646484375 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:53<44:02, 53.93s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:20<30:28, 38.09s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:00<30:24, 38.82s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:11<21:19, 27.81s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:07<28:30, 38.01s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [03:24<22:35, 30.81s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:21<28:08, 39.26s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [04:43<23:43, 33.90s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [05:39<27:46, 40.66s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [06:13<25:48, 38.71s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:09<28:38, 44.07s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [07:55<28:17, 44.67s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [08:29<25:26, 41.25s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:26<27:36, 46.02s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [09:43<21:48, 37.40s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [10:29<22:36, 39.90s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [10:58<20:13, 36.77s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [11:51<22:12, 41.65s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [12:08<17:39, 34.19s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [12:28<14:57, 29.91s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [13:05<15:28, 32.03s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [14:01<18:17, 39.18s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [14:43<17:58, 39.93s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [15:37<19:13, 44.36s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [16:33<19:51, 47.68s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [17:04<17:07, 42.80s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [17:41<15:40, 40.90s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [18:02<12:51, 35.08s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [18:29<11:28, 32.78s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [18:53<09:58, 29.94s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [19:49<11:59, 37.88s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [20:45<13:00, 43.38s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [21:41<13:19, 47.04s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [22:09<11:01, 41.37s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [23:00<11:02, 44.14s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [23:21<08:42, 37.31s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [24:16<09:14, 42.68s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [25:12<09:17, 46.45s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [25:51<08:08, 44.45s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [26:15<06:22, 38.24s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [27:11<06:31, 43.52s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [28:07<06:17, 47.22s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [28:52<05:26, 46.67s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [29:11<03:49, 38.21s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [30:06<03:36, 43.39s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [31:01<03:07, 46.96s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [31:42<02:15, 45.19s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [32:34<01:34, 47.23s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [33:29<00:49, 49.53s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:08<00:00, 46.36s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:08<00:00, 40.97s/it]
name: commonsenseqa | {'exact_match': 1.6, 'rougeL': 5.6978} | lm_loss 7.1009 | avg. gen lenth: 160.152
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s30-rTrue --seed 30 --rationales --num-in-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 11:01:15,027] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i1-s30-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 1
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s30-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9740 [00:00<?, ?it/s]  1%|█▋                                                                                                                                                | 110/9740 [00:00<00:08, 1096.30it/s]  2%|███▎                                                                                                                                              | 220/9740 [00:00<00:08, 1096.94it/s]  3%|████▉                                                                                                                                             | 331/9740 [00:00<00:08, 1101.04it/s]  5%|██████▋                                                                                                                                           | 442/9740 [00:00<00:08, 1101.30it/s]  6%|████████▎                                                                                                                                         | 553/9740 [00:00<00:08, 1102.16it/s]  7%|█████████▉                                                                                                                                        | 664/9740 [00:00<00:08, 1103.04it/s]  8%|███████████▋                                                                                                                                      | 776/9740 [00:00<00:08, 1106.21it/s]  9%|█████████████▎                                                                                                                                    | 887/9740 [00:00<00:07, 1107.33it/s] 10%|██████████████▉                                                                                                                                   | 998/9740 [00:00<00:08, 1089.51it/s] 11%|████████████████▌                                                                                                                                | 1109/9740 [00:01<00:07, 1093.71it/s] 13%|██████████████████▏                                                                                                                              | 1220/9740 [00:01<00:07, 1097.41it/s] 14%|███████████████████▊                                                                                                                             | 1331/9740 [00:01<00:07, 1100.97it/s] 15%|█████████████████████▍                                                                                                                           | 1442/9740 [00:01<00:07, 1100.74it/s] 16%|███████████████████████▏                                                                                                                         | 1554/9740 [00:01<00:07, 1104.26it/s] 17%|████████████████████████▊                                                                                                                        | 1665/9740 [00:01<00:07, 1103.86it/s] 18%|██████████████████████████▍                                                                                                                      | 1777/9740 [00:01<00:07, 1105.90it/s] 19%|████████████████████████████                                                                                                                     | 1888/9740 [00:01<00:07, 1083.80it/s] 21%|█████████████████████████████▊                                                                                                                   | 1999/9740 [00:01<00:07, 1089.67it/s] 22%|███████████████████████████████▍                                                                                                                 | 2109/9740 [00:01<00:07, 1088.04it/s] 23%|█████████████████████████████████                                                                                                                | 2220/9740 [00:02<00:06, 1093.86it/s] 24%|██████████████████████████████████▋                                                                                                              | 2331/9740 [00:02<00:06, 1097.10it/s] 25%|████████████████████████████████████▎                                                                                                            | 2443/9740 [00:02<00:06, 1101.40it/s] 26%|██████████████████████████████████████                                                                                                           | 2554/9740 [00:02<00:06, 1100.53it/s] 27%|███████████████████████████████████████▋                                                                                                         | 2666/9740 [00:02<00:06, 1103.69it/s] 29%|█████████████████████████████████████████▊                                                                                                       | 2808/9740 [00:02<00:05, 1197.92it/s] 31%|████████████████████████████████████████████▎                                                                                                    | 2977/9740 [00:02<00:05, 1343.61it/s] 32%|██████████████████████████████████████████████▊                                                                                                  | 3146/9740 [00:02<00:04, 1445.29it/s] 34%|█████████████████████████████████████████████████▎                                                                                               | 3315/9740 [00:02<00:04, 1517.82it/s] 36%|███████████████████████████████████████████████████▊                                                                                             | 3483/9740 [00:02<00:03, 1565.95it/s] 37%|██████████████████████████████████████████████████████▎                                                                                          | 3651/9740 [00:03<00:03, 1599.93it/s] 39%|████████████████████████████████████████████████████████▉                                                                                        | 3821/9740 [00:03<00:03, 1627.10it/s] 41%|███████████████████████████████████████████████████████████▍                                                                                     | 3990/9740 [00:03<00:03, 1643.73it/s] 43%|█████████████████████████████████████████████████████████████▉                                                                                   | 4159/9740 [00:03<00:03, 1655.73it/s] 44%|████████████████████████████████████████████████████████████████▍                                                                                | 4328/9740 [00:03<00:03, 1663.62it/s] 46%|██████████████████████████████████████████████████████████████████▉                                                                              | 4498/9740 [00:03<00:03, 1672.97it/s] 48%|█████████████████████████████████████████████████████████████████████▍                                                                           | 4666/9740 [00:03<00:03, 1649.03it/s] 50%|███████████████████████████████████████████████████████████████████████▉                                                                         | 4831/9740 [00:03<00:03, 1414.07it/s] 51%|██████████████████████████████████████████████████████████████████████████▍                                                                      | 4999/9740 [00:03<00:03, 1483.97it/s] 53%|████████████████████████████████████████████████████████████████████████████▉                                                                    | 5169/9740 [00:03<00:02, 1542.24it/s] 55%|███████████████████████████████████████████████████████████████████████████████▍                                                                 | 5338/9740 [00:04<00:02, 1582.17it/s] 57%|█████████████████████████████████████████████████████████████████████████████████▉                                                               | 5508/9740 [00:04<00:02, 1614.61it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▋                                                            | 5685/9740 [00:04<00:02, 1657.23it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▎                                                         | 5861/9740 [00:04<00:02, 1686.49it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▉                                                       | 6039/9740 [00:04<00:02, 1711.90it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▌                                                    | 6215/9740 [00:04<00:02, 1725.21it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▏                                                 | 6391/9740 [00:04<00:01, 1733.92it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▊                                               | 6567/9740 [00:04<00:01, 1738.99it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▍                                            | 6744/9740 [00:04<00:01, 1747.41it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████                                          | 6921/9740 [00:04<00:01, 1752.81it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                       | 7098/9740 [00:05<00:01, 1756.91it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                    | 7275/9740 [00:05<00:01, 1759.41it/s] 77%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                  | 7452/9740 [00:05<00:01, 1735.36it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                               | 7629/9740 [00:05<00:01, 1744.51it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                            | 7806/9740 [00:05<00:01, 1749.29it/s] 82%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                          | 7983/9740 [00:05<00:01, 1754.17it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                       | 8161/9740 [00:05<00:00, 1760.30it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                    | 8338/9740 [00:05<00:00, 1751.07it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 8515/9740 [00:05<00:00, 1754.05it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍               | 8691/9740 [00:06<00:00, 1755.26it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████             | 8868/9740 [00:06<00:00, 1757.46it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋          | 9045/9740 [00:06<00:00, 1760.00it/s] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎       | 9223/9740 [00:06<00:00, 1763.57it/s] 97%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉     | 9400/9740 [00:06<00:00, 1764.44it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 9577/9740 [00:06<00:00, 1762.72it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9740/9740 [00:06<00:00, 1476.00it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.31s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.44s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:06<00:12,  6.02s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.90s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.09s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.52s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.86s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.28s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]
[2023-08-11 11:02:12,394] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.85s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.05s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.28s/it]
[2023-08-11 11:02:24,157] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 11:02:24,158] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 11:02:24,158] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 11:02:24,158] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 11:02:24,158] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 11:02:24,158] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f6906e5de80>
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 11:02:24,159] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f692df54910>
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 11:02:24,160] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 11:02:24,161] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 11:02:24,161] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4033517837524414 seconds
Loading extension module utils...
Time to load utils op: 0.3042764663696289 seconds
Loading extension module utils...
Time to load utils op: 0.40456271171569824 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: The lab results had been compiled, the scientist began analysing the data because he wanted what? Choices:  A: learn more about B: headache C: do math D: enlightened E: better understanding
Rationales: 1. The question statement mentions that a scientist is analyzing data after compiling lab results.
2. This implies that the scientist is in a quest for knowledge or understanding something.
3. Thus, the answer should align with the scientist's intention to gain insights about something.
4. Among the given choices, "headache" and "do math" don't align with his intent, these can be ruled out.
5. "Learning more about" and "enlightened" might be indirectly related.
6. But, the most direct and befitting option that aligns with his intention of analysis is to gain a "better understanding."
7. So, the answer is E: better understanding.
Answer: E: better understanding

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i1-s30-rTrue
Loading extension module utils...
Time to load utils op: 0.40459537506103516 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:55<45:36, 55.84s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:49<43:49, 54.77s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:43<42:36, 54.39s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:18<35:39, 46.52s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:48<30:35, 40.79s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:42<33:03, 45.08s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:35<34:18, 47.87s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:31<35:12, 50.29s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:25<35:06, 51.37s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:19<34:56, 52.41s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [09:14<34:33, 53.16s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [10:08<33:42, 53.23s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [11:01<32:54, 53.36s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [11:40<29:24, 49.03s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [12:34<29:26, 50.48s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [13:27<29:01, 51.22s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [14:08<26:27, 48.09s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [15:02<26:39, 49.99s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [15:57<26:35, 51.48s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [16:51<26:06, 52.22s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [17:44<25:23, 52.53s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [18:39<24:50, 53.22s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [19:33<23:59, 53.30s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [20:25<23:00, 53.08s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [21:19<22:13, 53.35s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [22:14<21:28, 53.67s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [23:08<20:35, 53.70s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [24:01<19:39, 53.63s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [24:55<18:47, 53.70s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [25:50<18:04, 54.24s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [26:45<17:11, 54.31s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [27:39<16:17, 54.30s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [28:33<15:21, 54.20s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [29:28<14:29, 54.32s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [30:22<13:35, 54.36s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [31:17<12:44, 54.63s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [32:13<11:52, 54.79s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [33:06<10:53, 54.47s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [34:01<09:59, 54.50s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [34:54<09:01, 54.13s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [35:48<08:05, 53.98s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [36:41<07:11, 53.90s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [37:35<06:17, 53.87s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [38:30<05:25, 54.20s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [39:24<04:29, 53.96s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [40:18<03:36, 54.03s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [41:13<02:42, 54.26s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [42:06<01:47, 53.93s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [43:01<00:54, 54.26s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [43:55<00:00, 54.17s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [43:55<00:00, 52.71s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.4095} | lm_loss 7.4193 | avg. gen lenth: 295.036
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s30-rTrue --seed 30 --rationales --num-in-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 11:46:29,176] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i2-s30-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 2
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s30-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 30
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9739 [00:00<?, ?it/s]  0%|▋                                                                                                                                                   | 45/9739 [00:00<00:21, 444.98it/s]  1%|█▎                                                                                                                                                  | 90/9739 [00:00<00:21, 447.05it/s]  1%|██                                                                                                                                                 | 135/9739 [00:00<00:21, 448.10it/s]  2%|██▋                                                                                                                                                | 180/9739 [00:00<00:21, 447.48it/s]  2%|███▍                                                                                                                                               | 225/9739 [00:00<00:21, 442.95it/s]  3%|████                                                                                                                                               | 270/9739 [00:00<00:21, 444.04it/s]  3%|████▊                                                                                                                                              | 315/9739 [00:00<00:21, 445.21it/s]  4%|█████▍                                                                                                                                             | 360/9739 [00:00<00:21, 438.70it/s]  4%|██████                                                                                                                                             | 405/9739 [00:00<00:21, 441.20it/s]  5%|██████▊                                                                                                                                            | 450/9739 [00:01<00:21, 440.98it/s]  5%|███████▍                                                                                                                                           | 495/9739 [00:01<00:20, 442.78it/s]  6%|████████▏                                                                                                                                          | 540/9739 [00:01<00:20, 444.16it/s]  6%|████████▊                                                                                                                                          | 585/9739 [00:01<00:20, 444.86it/s]  6%|█████████▌                                                                                                                                         | 630/9739 [00:01<00:20, 445.37it/s]  7%|██████████▏                                                                                                                                        | 675/9739 [00:01<00:20, 444.53it/s]  7%|██████████▊                                                                                                                                        | 720/9739 [00:01<00:20, 445.33it/s]  8%|███████████▌                                                                                                                                       | 765/9739 [00:01<00:20, 445.97it/s]  8%|████████████▏                                                                                                                                      | 810/9739 [00:01<00:20, 441.36it/s]  9%|████████████▉                                                                                                                                      | 855/9739 [00:01<00:20, 442.74it/s]  9%|█████████████▌                                                                                                                                     | 900/9739 [00:02<00:20, 441.76it/s] 10%|██████████████▎                                                                                                                                    | 945/9739 [00:02<00:19, 443.70it/s] 10%|██████████████▉                                                                                                                                    | 990/9739 [00:02<00:19, 445.20it/s] 11%|███████████████▌                                                                                                                                  | 1035/9739 [00:02<00:19, 446.49it/s] 11%|████████████████▏                                                                                                                                 | 1080/9739 [00:02<00:19, 447.04it/s] 12%|████████████████▊                                                                                                                                 | 1125/9739 [00:02<00:19, 445.74it/s] 12%|█████████████████▌                                                                                                                                | 1170/9739 [00:02<00:19, 446.31it/s] 13%|██████████████████▍                                                                                                                               | 1229/9739 [00:02<00:17, 487.28it/s] 13%|███████████████████▍                                                                                                                              | 1297/9739 [00:02<00:15, 543.55it/s] 14%|████████████████████▍                                                                                                                             | 1362/9739 [00:02<00:14, 574.57it/s] 15%|█████████████████████▍                                                                                                                            | 1429/9739 [00:03<00:13, 602.30it/s] 15%|██████████████████████▍                                                                                                                           | 1496/9739 [00:03<00:13, 619.94it/s] 16%|███████████████████████▍                                                                                                                          | 1562/9739 [00:03<00:12, 631.49it/s] 17%|████████████████████████▍                                                                                                                         | 1628/9739 [00:03<00:12, 638.90it/s] 17%|█████████████████████████▍                                                                                                                        | 1695/9739 [00:03<00:12, 646.49it/s] 18%|██████████████████████████▍                                                                                                                       | 1761/9739 [00:03<00:12, 648.22it/s] 19%|███████████████████████████▎                                                                                                                      | 1826/9739 [00:03<00:12, 632.18it/s] 19%|████████████████████████████▍                                                                                                                     | 1893/9739 [00:03<00:12, 642.49it/s] 20%|█████████████████████████████▍                                                                                                                    | 1961/9739 [00:03<00:11, 651.35it/s] 21%|██████████████████████████████▍                                                                                                                   | 2028/9739 [00:03<00:11, 655.21it/s] 22%|███████████████████████████████▍                                                                                                                  | 2096/9739 [00:04<00:11, 659.99it/s] 22%|████████████████████████████████▍                                                                                                                 | 2164/9739 [00:04<00:11, 663.57it/s] 23%|█████████████████████████████████▍                                                                                                                | 2232/9739 [00:04<00:11, 665.75it/s] 24%|██████████████████████████████████▍                                                                                                               | 2299/9739 [00:04<00:11, 665.59it/s] 24%|███████████████████████████████████▍                                                                                                              | 2367/9739 [00:04<00:11, 666.85it/s] 25%|████████████████████████████████████▍                                                                                                             | 2434/9739 [00:04<00:10, 666.72it/s] 26%|█████████████████████████████████████▍                                                                                                            | 2501/9739 [00:04<00:10, 665.88it/s] 26%|██████████████████████████████████████▌                                                                                                           | 2569/9739 [00:04<00:10, 667.43it/s] 27%|███████████████████████████████████████▌                                                                                                          | 2637/9739 [00:04<00:10, 668.31it/s] 28%|████████████████████████████████████████▌                                                                                                         | 2704/9739 [00:04<00:10, 667.46it/s] 28%|█████████████████████████████████████████▌                                                                                                        | 2772/9739 [00:05<00:10, 669.11it/s] 29%|██████████████████████████████████████████▌                                                                                                       | 2840/9739 [00:05<00:10, 670.21it/s] 30%|███████████████████████████████████████████▌                                                                                                      | 2908/9739 [00:05<00:10, 671.62it/s] 31%|████████████████████████████████████████████▌                                                                                                     | 2976/9739 [00:05<00:10, 668.92it/s] 31%|█████████████████████████████████████████████▋                                                                                                    | 3044/9739 [00:05<00:09, 670.03it/s] 32%|██████████████████████████████████████████████▋                                                                                                   | 3112/9739 [00:05<00:09, 670.28it/s] 33%|███████████████████████████████████████████████▋                                                                                                  | 3180/9739 [00:05<00:09, 668.81it/s] 33%|████████████████████████████████████████████████▋                                                                                                 | 3247/9739 [00:05<00:09, 667.04it/s] 34%|█████████████████████████████████████████████████▋                                                                                                | 3315/9739 [00:05<00:09, 669.17it/s] 35%|██████████████████████████████████████████████████▋                                                                                               | 3382/9739 [00:05<00:09, 668.82it/s] 35%|███████████████████████████████████████████████████▋                                                                                              | 3450/9739 [00:06<00:09, 670.03it/s] 36%|████████████████████████████████████████████████████▋                                                                                             | 3518/9739 [00:06<00:09, 670.41it/s] 37%|█████████████████████████████████████████████████████▊                                                                                            | 3586/9739 [00:06<00:09, 670.83it/s] 38%|██████████████████████████████████████████████████████▊                                                                                           | 3654/9739 [00:06<00:09, 669.57it/s] 38%|███████████████████████████████████████████████████████▊                                                                                          | 3722/9739 [00:06<00:08, 670.50it/s] 39%|████████████████████████████████████████████████████████▊                                                                                         | 3790/9739 [00:06<00:08, 671.76it/s] 40%|█████████████████████████████████████████████████████████▊                                                                                        | 3858/9739 [00:06<00:08, 667.10it/s] 40%|██████████████████████████████████████████████████████████▊                                                                                       | 3925/9739 [00:06<00:08, 667.26it/s] 41%|███████████████████████████████████████████████████████████▊                                                                                      | 3992/9739 [00:06<00:08, 667.91it/s] 42%|████████████████████████████████████████████████████████████▊                                                                                     | 4059/9739 [00:06<00:08, 659.97it/s] 42%|█████████████████████████████████████████████████████████████▊                                                                                    | 4127/9739 [00:07<00:08, 663.04it/s] 43%|██████████████████████████████████████████████████████████████▉                                                                                   | 4195/9739 [00:07<00:08, 666.30it/s] 44%|███████████████████████████████████████████████████████████████▉                                                                                  | 4263/9739 [00:07<00:08, 668.94it/s] 44%|████████████████████████████████████████████████████████████████▉                                                                                 | 4330/9739 [00:07<00:08, 666.39it/s] 45%|█████████████████████████████████████████████████████████████████▉                                                                                | 4398/9739 [00:07<00:07, 668.86it/s] 46%|██████████████████████████████████████████████████████████████████▉                                                                               | 4466/9739 [00:07<00:07, 669.77it/s] 47%|███████████████████████████████████████████████████████████████████▉                                                                              | 4533/9739 [00:07<00:08, 641.46it/s] 47%|████████████████████████████████████████████████████████████████████▉                                                                             | 4601/9739 [00:07<00:07, 650.09it/s] 48%|█████████████████████████████████████████████████████████████████████▉                                                                            | 4667/9739 [00:07<00:07, 650.90it/s] 49%|██████████████████████████████████████████████████████████████████████▉                                                                           | 4733/9739 [00:08<00:07, 651.45it/s] 49%|███████████████████████████████████████████████████████████████████████▉                                                                          | 4799/9739 [00:08<00:10, 487.10it/s] 50%|████████████████████████████████████████████████████████████████████████▉                                                                         | 4865/9739 [00:08<00:09, 526.78it/s] 51%|█████████████████████████████████████████████████████████████████████████▉                                                                        | 4933/9739 [00:08<00:08, 563.76it/s] 51%|██████████████████████████████████████████████████████████████████████████▉                                                                       | 5000/9739 [00:08<00:08, 591.22it/s] 52%|███████████████████████████████████████████████████████████████████████████▉                                                                      | 5068/9739 [00:08<00:07, 614.13it/s] 53%|████████████████████████████████████████████████████████████████████████████▉                                                                     | 5136/9739 [00:08<00:07, 630.47it/s] 53%|█████████████████████████████████████████████████████████████████████████████▉                                                                    | 5203/9739 [00:08<00:07, 640.83it/s] 54%|███████████████████████████████████████████████████████████████████████████████                                                                   | 5271/9739 [00:08<00:06, 649.32it/s] 55%|████████████████████████████████████████████████████████████████████████████████                                                                  | 5338/9739 [00:09<00:06, 652.64it/s] 55%|█████████████████████████████████████████████████████████████████████████████████                                                                 | 5405/9739 [00:09<00:06, 655.08it/s] 56%|██████████████████████████████████████████████████████████████████████████████████                                                                | 5473/9739 [00:09<00:06, 659.76it/s] 57%|███████████████████████████████████████████████████████████████████████████████████                                                               | 5543/9739 [00:09<00:06, 670.81it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▏                                                             | 5612/9739 [00:09<00:06, 675.43it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▏                                                            | 5682/9739 [00:09<00:05, 680.25it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▏                                                           | 5751/9739 [00:09<00:05, 679.67it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▎                                                          | 5821/9739 [00:09<00:05, 685.50it/s] 60%|████████████████████████████████████████████████████████████████████████████████████████▎                                                         | 5890/9739 [00:09<00:05, 686.16it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▎                                                        | 5960/9739 [00:09<00:05, 689.06it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▍                                                       | 6030/9739 [00:10<00:05, 691.73it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▍                                                      | 6100/9739 [00:10<00:05, 691.77it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▍                                                     | 6170/9739 [00:10<00:05, 692.62it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▌                                                    | 6240/9739 [00:10<00:05, 688.60it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▌                                                   | 6309/9739 [00:10<00:04, 686.31it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▋                                                  | 6379/9739 [00:10<00:04, 689.84it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▋                                                 | 6450/9739 [00:10<00:04, 692.91it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▋                                                | 6520/9739 [00:10<00:04, 693.98it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▊                                               | 6590/9739 [00:10<00:04, 688.25it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▊                                              | 6659/9739 [00:10<00:04, 685.98it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▉                                             | 6729/9739 [00:11<00:04, 687.76it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▉                                            | 6799/9739 [00:11<00:04, 688.74it/s] 71%|██████████████████████████████████████████████████████████████████████████████████████████████████████▉                                           | 6869/9739 [00:11<00:04, 691.01it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████                                          | 6939/9739 [00:11<00:04, 690.11it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████                                         | 7009/9739 [00:11<00:03, 683.62it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████                                        | 7079/9739 [00:11<00:03, 687.58it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                      | 7149/9739 [00:11<00:03, 691.12it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                     | 7219/9739 [00:11<00:03, 691.13it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                    | 7289/9739 [00:11<00:03, 692.67it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                   | 7359/9739 [00:11<00:03, 692.19it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                  | 7429/9739 [00:12<00:03, 692.42it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                 | 7499/9739 [00:12<00:03, 660.34it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                | 7568/9739 [00:12<00:03, 666.56it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                               | 7638/9739 [00:12<00:03, 675.43it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                              | 7708/9739 [00:12<00:02, 680.30it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                             | 7778/9739 [00:12<00:02, 685.46it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                            | 7847/9739 [00:12<00:02, 683.63it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 7916/9739 [00:12<00:02, 682.37it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                          | 7986/9739 [00:12<00:02, 686.45it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                         | 8056/9739 [00:13<00:02, 689.22it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                        | 8126/9739 [00:13<00:02, 690.07it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                       | 8196/9739 [00:13<00:02, 692.21it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                      | 8266/9739 [00:13<00:02, 694.09it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                     | 8336/9739 [00:13<00:02, 693.11it/s] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                    | 8406/9739 [00:13<00:01, 693.93it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                   | 8476/9739 [00:13<00:01, 694.86it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                  | 8546/9739 [00:13<00:01, 695.58it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                | 8616/9739 [00:13<00:01, 693.51it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏               | 8686/9739 [00:13<00:01, 686.59it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎              | 8756/9739 [00:14<00:01, 688.49it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎             | 8826/9739 [00:14<00:01, 689.74it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎            | 8896/9739 [00:14<00:01, 692.23it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍           | 8966/9739 [00:14<00:01, 694.24it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍          | 9036/9739 [00:14<00:01, 693.02it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌         | 9106/9739 [00:14<00:00, 694.57it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌        | 9177/9739 [00:14<00:00, 696.71it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 9247/9739 [00:14<00:00, 697.41it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋      | 9317/9739 [00:14<00:00, 696.29it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋     | 9387/9739 [00:14<00:00, 696.64it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊    | 9457/9739 [00:15<00:00, 694.07it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊   | 9527/9739 [00:15<00:00, 693.62it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉  | 9598/9739 [00:15<00:00, 695.56it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉ | 9668/9739 [00:15<00:00, 696.16it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉| 9738/9739 [00:15<00:00, 692.35it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9739/9739 [00:15<00:00, 631.32it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.97s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.58s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.97s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.93s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.88s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.45s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.52s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.33s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.49s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.28s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.80s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.03s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.85s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.04s/it]
[2023-08-11 11:47:37,716] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-11 11:47:44,894] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 11:47:44,895] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 11:47:44,895] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 11:47:44,895] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 11:47:44,895] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 11:47:44,895] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f9d7b37fe80>
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 11:47:44,896] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f9d86816910>
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 11:47:44,897] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 11:47:44,898] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 11:47:44,898] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 11:47:44,898] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 11:47:44,898] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4438207149505615 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5045678615570068 seconds
Time to load utils op: 0.5043420791625977 seconds
Loading extension module utils...
Time to load utils op: 0.4053032398223877 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: The lab results had been compiled, the scientist began analysing the data because he wanted what? Choices:  A: learn more about B: headache C: do math D: enlightened E: better understanding
Rationales: The question asks why the scientist began analysing the data after the lab results had been compiled. 

Analysis of the provided choices reveals:

Choice A suggests that the scientist just wanted to "learn more". While this could potentially be true, it is a bit too vague considering the specific circumstance of just having compiled lab results. 

Choice B suggests that the scientist wanted a "headache". This is unlikely – usually people don't desire pain or discomfort.

Choice C is "do math". While analyzing data often involves math, it is not an end goal but a means to achieve an end goal.

Choice D is "enlightened". This term is too vague and broad for a specific scientific activity such as data analysis.

Lastly, choice E is "better understanding". In the context of the question, this makes the most sense. Scientists analyze data to get a better understanding of the results of their experiments. 

Therefore, after reviewing the question and the options, the answer would be choice E - "better understanding".
Answer: E: better understanding

Input: I needed to find out how to contact a person with a certain name, where should I look? Choices:  A: directory B: michigan C: roster D: phone book E: certificate
Rationales: 1. Begin by understanding the question, which asks where one should look if they need to find contact information for a person with a specific name.
2. We evaluate each choice.
3. Looking at choice A: a directory. While it's possible to find people's numbers in a directory, it's not guaranteed. A directory might be for a specific purpose or business, not for general people.
4. Choice B is Michigan. This is a geographical location, not a source of information, so it cannot be the right answer.
5. Choice C is a roster. Rosters usually contain names of members or participants, but not always their contacts, so it's not the most reliable option.
6. Choice D is a phone book, this is specifically designed to store people's contact information, including their names and phone numbers. Therefore, this seems like the most likely choice.
7. The last choice E is a certificate which is a document that certifies an action, behavior, requirement, or attainment, so it won't be helpful in this situation.
8. After eliminating all the other choices, we can determine that a phone book is the best solution in order to obtain contact information for a particular person. Therefore, the answer is D. Phone Book.
Answer: D: phone book

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i2-s30-rTrue
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:49<40:19, 49.39s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:30<35:33, 44.44s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:17<35:41, 45.57s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:02<34:56, 45.58s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:50<34:41, 46.26s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:38<34:20, 46.82s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:26<33:54, 47.32s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:14<33:09, 47.38s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:02<32:29, 47.55s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:38<29:19, 43.98s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:26<29:26, 45.30s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:14<29:10, 46.05s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [10:01<28:36, 46.38s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:41<26:46, 44.63s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:29<26:36, 45.60s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [12:17<26:11, 46.23s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [13:04<25:36, 46.55s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:52<25:00, 46.90s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:39<24:19, 47.09s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:27<23:41, 47.39s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:14<22:49, 47.21s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [17:02<22:05, 47.32s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:50<21:24, 47.56s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:37<20:33, 47.44s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [19:25<19:50, 47.61s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [20:13<19:02, 47.59s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [21:00<18:09, 47.37s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:48<17:27, 47.60s/it]