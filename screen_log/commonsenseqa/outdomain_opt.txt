PYTHONPATH=/home/ylu130/workspace/in-context-generalization
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-21 17:33:12,218] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o1-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  2%|█▌                                                                                 | 190/9741 [00:00<00:05, 1899.37it/s]  4%|███▎                                                                               | 392/9741 [00:00<00:04, 1965.04it/s]  6%|█████                                                                              | 594/9741 [00:00<00:04, 1990.06it/s]  8%|██████▊                                                                            | 799/9741 [00:00<00:04, 2010.06it/s] 10%|████████▍                                                                         | 1005/9741 [00:00<00:04, 2026.40it/s] 12%|██████████▏                                                                       | 1211/9741 [00:00<00:04, 2037.27it/s] 15%|███████████▉                                                                      | 1416/9741 [00:00<00:04, 2039.90it/s] 17%|█████████████▋                                                                    | 1621/9741 [00:00<00:03, 2042.69it/s] 19%|███████████████▎                                                                  | 1826/9741 [00:00<00:03, 2035.76it/s] 21%|█████████████████                                                                 | 2030/9741 [00:01<00:03, 1989.75it/s] 23%|██████████████████▊                                                               | 2234/9741 [00:01<00:03, 2002.99it/s] 25%|████████████████████▌                                                             | 2440/9741 [00:01<00:03, 2018.62it/s] 27%|██████████████████████▎                                                           | 2645/9741 [00:01<00:03, 2025.90it/s] 29%|███████████████████████▉                                                          | 2848/9741 [00:01<00:03, 2024.41it/s] 31%|█████████████████████████▋                                                        | 3053/9741 [00:01<00:03, 2030.97it/s] 33%|███████████████████████████▍                                                      | 3258/9741 [00:01<00:03, 2036.45it/s] 36%|█████████████████████████████▏                                                    | 3463/9741 [00:01<00:03, 2039.88it/s] 38%|██████████████████████████████▉                                                   | 3668/9741 [00:01<00:02, 2037.65it/s] 40%|████████████████████████████████▌                                                 | 3874/9741 [00:01<00:02, 2044.02it/s] 42%|██████████████████████████████████▎                                               | 4079/9741 [00:02<00:02, 2040.69it/s] 44%|████████████████████████████████████                                              | 4284/9741 [00:02<00:02, 2043.42it/s] 46%|█████████████████████████████████████▊                                            | 4489/9741 [00:02<00:02, 2027.37it/s] 48%|███████████████████████████████████████▌                                          | 4698/9741 [00:02<00:02, 2044.28it/s] 50%|█████████████████████████████████████████▎                                        | 4903/9741 [00:02<00:03, 1502.82it/s] 53%|███████████████████████████████████████████▏                                      | 5131/9741 [00:02<00:02, 1687.82it/s] 56%|█████████████████████████████████████████████▊                                    | 5447/9741 [00:02<00:02, 2061.49it/s] 59%|████████████████████████████████████████████████▌                                 | 5768/9741 [00:02<00:01, 2366.00it/s] 62%|███████████████████████████████████████████████████                               | 6072/9741 [00:02<00:01, 2548.31it/s] 65%|█████████████████████████████████████████████████████▋                            | 6379/9741 [00:03<00:01, 2694.55it/s] 69%|████████████████████████████████████████████████████████▍                         | 6701/9741 [00:03<00:01, 2844.15it/s] 72%|███████████████████████████████████████████████████████████                       | 7012/9741 [00:03<00:00, 2919.46it/s] 75%|█████████████████████████████████████████████████████████████▋                    | 7331/9741 [00:03<00:00, 2998.53it/s] 78%|████████████████████████████████████████████████████████████████▎                 | 7636/9741 [00:03<00:00, 3006.09it/s] 82%|██████████████████████████████████████████████████████████████████▉               | 7955/9741 [00:03<00:00, 3059.54it/s] 85%|█████████████████████████████████████████████████████████████████████▋            | 8277/9741 [00:03<00:00, 3105.86it/s] 88%|████████████████████████████████████████████████████████████████████████▎         | 8597/9741 [00:03<00:00, 3133.65it/s] 92%|███████████████████████████████████████████████████████████████████████████       | 8919/9741 [00:03<00:00, 3156.53it/s] 95%|█████████████████████████████████████████████████████████████████████████████▊    | 9240/9741 [00:03<00:00, 3171.46it/s] 98%|████████████████████████████████████████████████████████████████████████████████▍ | 9562/9741 [00:04<00:00, 3183.85it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:04<00:00, 2377.08it/s]
Load End
Num instances: 1000
[2023-08-21 17:33:27,244] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 17:33:30,118] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 17:33:30,118] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fea2f42aa60>
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 17:33:30,119] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fea2f42a940>
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 17:33:30,120] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 17:33:30,120] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4434196949005127 seconds
Loading extension module utils...
Time to load utils op: 0.5047733783721924 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o1-tgsm8k-s1-rTrue
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [01:05<53:17, 65.25s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [02:10<52:05, 65.12s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [03:16<51:31, 65.79s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [04:19<49:37, 64.74s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [05:24<48:21, 64.49s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [06:28<47:22, 64.61s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [07:32<46:06, 64.33s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [08:36<44:50, 64.07s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [09:39<43:40, 63.90s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [10:43<42:29, 63.73s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [11:45<41:14, 63.45s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [12:50<40:29, 63.94s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [13:51<38:52, 63.03s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [14:54<37:42, 62.86s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [15:56<36:37, 62.78s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [17:00<35:41, 62.99s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [18:03<34:40, 63.03s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [19:06<33:40, 63.13s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [20:11<32:47, 63.46s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [21:13<31:36, 63.21s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [22:15<30:19, 62.73s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [23:18<29:16, 62.73s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [24:21<28:21, 63.01s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [25:26<27:30, 63.50s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [26:31<26:36, 63.85s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [27:34<25:30, 63.78s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [28:37<24:18, 63.43s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [29:43<23:32, 64.19s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [30:46<22:21, 63.88s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [31:49<21:11, 63.59s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [32:52<20:06, 63.51s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [33:57<19:08, 63.83s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [35:01<18:08, 64.02s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [36:04<16:59, 63.74s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [37:10<16:06, 64.43s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [38:13<14:55, 63.97s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [39:18<13:54, 64.20s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [40:22<12:50, 64.20s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [41:26<11:45, 64.16s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [42:30<10:41, 64.13s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [43:34<09:35, 63.91s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [44:36<08:27, 63.44s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [45:39<07:23, 63.30s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [46:42<06:19, 63.18s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [47:45<05:15, 63.19s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [48:47<04:11, 62.92s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [49:51<03:09, 63.21s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [50:54<02:06, 63.15s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [51:59<01:03, 63.73s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [53:05<00:00, 64.21s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [53:05<00:00, 63.70s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.1391} | avg. gen lenth: 337.474
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

using world size: 2
[2023-08-21 18:26:41,957] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o2-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▊                                                                                    | 91/9741 [00:00<00:10, 901.59it/s]  2%|█▌                                                                                  | 184/9741 [00:00<00:10, 918.06it/s]  3%|██▍                                                                                 | 280/9741 [00:00<00:10, 934.21it/s]  4%|███▏                                                                                | 376/9741 [00:00<00:09, 943.75it/s]  5%|████                                                                                | 472/9741 [00:00<00:09, 948.43it/s]  6%|████▉                                                                               | 568/9741 [00:00<00:09, 952.17it/s]  7%|█████▋                                                                              | 665/9741 [00:00<00:09, 957.26it/s]  8%|██████▌                                                                             | 762/9741 [00:00<00:09, 961.17it/s]  9%|███████▍                                                                            | 859/9741 [00:00<00:09, 938.42it/s] 10%|████████▏                                                                           | 955/9741 [00:01<00:09, 943.66it/s] 11%|████████▉                                                                          | 1052/9741 [00:01<00:09, 951.38it/s] 12%|█████████▊                                                                         | 1149/9741 [00:01<00:08, 955.29it/s] 13%|██████████▋                                                                       | 1273/9741 [00:01<00:08, 1039.37it/s] 15%|███████████▉                                                                      | 1418/9741 [00:01<00:07, 1161.73it/s] 16%|█████████████▏                                                                    | 1563/9741 [00:01<00:06, 1248.15it/s] 18%|██████████████▍                                                                   | 1710/9741 [00:01<00:06, 1312.14it/s] 19%|███████████████▌                                                                  | 1848/9741 [00:01<00:05, 1331.01it/s] 20%|████████████████▊                                                                 | 1993/9741 [00:01<00:05, 1366.23it/s] 22%|█████████████████▉                                                                | 2138/9741 [00:01<00:05, 1389.78it/s] 23%|███████████████████▏                                                              | 2284/9741 [00:02<00:05, 1408.50it/s] 25%|████████████████████▍                                                             | 2431/9741 [00:02<00:05, 1424.85it/s] 26%|█████████████████████▋                                                            | 2578/9741 [00:02<00:04, 1435.77it/s] 28%|██████████████████████▉                                                           | 2723/9741 [00:02<00:04, 1439.89it/s] 29%|████████████████████████▏                                                         | 2870/9741 [00:02<00:04, 1447.81it/s] 31%|█████████████████████████▍                                                        | 3017/9741 [00:02<00:04, 1452.51it/s] 32%|██████████████████████████▋                                                       | 3163/9741 [00:02<00:04, 1450.14it/s] 34%|███████████████████████████▊                                                      | 3310/9741 [00:02<00:04, 1455.88it/s] 35%|█████████████████████████████                                                     | 3456/9741 [00:02<00:04, 1456.80it/s] 37%|██████████████████████████████▎                                                   | 3602/9741 [00:02<00:04, 1451.95it/s] 38%|███████████████████████████████▌                                                  | 3748/9741 [00:03<00:04, 1452.90it/s] 40%|████████████████████████████████▊                                                 | 3894/9741 [00:03<00:04, 1449.28it/s] 41%|██████████████████████████████████                                                | 4039/9741 [00:03<00:03, 1430.33it/s] 43%|███████████████████████████████████▏                                              | 4185/9741 [00:03<00:03, 1437.56it/s] 44%|████████████████████████████████████▍                                             | 4331/9741 [00:03<00:03, 1442.59it/s] 46%|█████████████████████████████████████▋                                            | 4477/9741 [00:03<00:03, 1447.15it/s] 47%|██████████████████████████████████████▉                                           | 4622/9741 [00:03<00:03, 1405.51it/s] 49%|████████████████████████████████████████                                          | 4763/9741 [00:03<00:04, 1077.77it/s] 50%|█████████████████████████████████████████▎                                        | 4907/9741 [00:03<00:04, 1165.05it/s] 52%|██████████████████████████████████████████▌                                       | 5050/9741 [00:04<00:03, 1233.11it/s] 53%|███████████████████████████████████████████▋                                      | 5194/9741 [00:04<00:03, 1286.75it/s] 55%|████████████████████████████████████████████▉                                     | 5339/9741 [00:04<00:03, 1330.96it/s] 56%|██████████████████████████████████████████████▏                                   | 5482/9741 [00:04<00:03, 1358.38it/s] 58%|███████████████████████████████████████████████▎                                  | 5627/9741 [00:04<00:02, 1383.90it/s] 59%|████████████████████████████████████████████████▌                                 | 5772/9741 [00:04<00:02, 1401.03it/s] 61%|█████████████████████████████████████████████████▊                                | 5915/9741 [00:04<00:02, 1407.91it/s] 62%|███████████████████████████████████████████████████                               | 6061/9741 [00:04<00:02, 1421.24it/s] 64%|████████████████████████████████████████████████████▏                             | 6206/9741 [00:04<00:02, 1427.82it/s] 65%|█████████████████████████████████████████████████████▍                            | 6350/9741 [00:04<00:02, 1402.34it/s] 67%|██████████████████████████████████████████████████████▋                           | 6494/9741 [00:05<00:02, 1410.70it/s] 68%|███████████████████████████████████████████████████████▊                          | 6637/9741 [00:05<00:02, 1414.01it/s] 70%|█████████████████████████████████████████████████████████                         | 6781/9741 [00:05<00:02, 1421.65it/s] 71%|██████████████████████████████████████████████████████████▎                       | 6926/9741 [00:05<00:01, 1429.06it/s] 73%|███████████████████████████████████████████████████████████▌                      | 7071/9741 [00:05<00:01, 1433.30it/s] 74%|████████████████████████████████████████████████████████████▋                     | 7215/9741 [00:05<00:01, 1432.32it/s] 76%|█████████████████████████████████████████████████████████████▉                    | 7360/9741 [00:05<00:01, 1434.94it/s] 77%|███████████████████████████████████████████████████████████████▏                  | 7504/9741 [00:05<00:01, 1391.69it/s] 78%|████████████████████████████████████████████████████████████████▎                 | 7646/9741 [00:05<00:01, 1398.19it/s] 80%|█████████████████████████████████████████████████████████████████▌                | 7788/9741 [00:05<00:01, 1403.22it/s] 81%|██████████████████████████████████████████████████████████████████▊               | 7931/9741 [00:06<00:01, 1408.54it/s] 83%|███████████████████████████████████████████████████████████████████▉              | 8075/9741 [00:06<00:01, 1415.47it/s] 84%|█████████████████████████████████████████████████████████████████████▏            | 8218/9741 [00:06<00:01, 1417.81it/s] 86%|██████████████████████████████████████████████████████████████████████▎           | 8360/9741 [00:06<00:00, 1413.61it/s] 87%|███████████████████████████████████████████████████████████████████████▌          | 8504/9741 [00:06<00:00, 1418.99it/s] 89%|████████████████████████████████████████████████████████████████████████▊         | 8646/9741 [00:06<00:00, 1418.56it/s] 90%|█████████████████████████████████████████████████████████████████████████▉        | 8789/9741 [00:06<00:00, 1420.41it/s] 92%|███████████████████████████████████████████████████████████████████████████▏      | 8932/9741 [00:06<00:00, 1420.11it/s] 93%|████████████████████████████████████████████████████████████████████████████▍     | 9075/9741 [00:06<00:00, 1419.36it/s] 95%|█████████████████████████████████████████████████████████████████████████████▌    | 9217/9741 [00:06<00:00, 1414.14it/s] 96%|██████████████████████████████████████████████████████████████████████████████▊   | 9359/9741 [00:07<00:00, 1412.94it/s] 98%|███████████████████████████████████████████████████████████████████████████████▉  | 9501/9741 [00:07<00:00, 1391.18it/s] 99%|█████████████████████████████████████████████████████████████████████████████████▏| 9643/9741 [00:07<00:00, 1397.13it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:07<00:00, 1325.42it/s]
Load End
Num instances: 1000
[2023-08-21 18:27:00,179] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 18:27:03,244] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 18:27:03,244] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7ff236166a60>
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 18:27:03,245] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7ff236166940>
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 18:27:03,246] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 18:27:03,246] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4313321113586426 seconds
Loading extension module utils...
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Time to load utils op: 0.30437779426574707 seconds
Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o2-tgsm8k-s1-rTrue
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:54<44:36, 54.63s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:48<43:09, 53.95s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:40<41:46, 53.32s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:34<41:03, 53.56s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [04:28<40:15, 53.68s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [05:22<39:21, 53.68s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [06:15<38:29, 53.71s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [07:08<37:23, 53.42s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [08:01<36:20, 53.18s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [08:55<35:38, 53.46s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [09:48<34:43, 53.43s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [10:43<34:09, 53.94s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [11:38<33:18, 54.01s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [12:30<32:11, 53.65s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [13:25<31:22, 53.80s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [14:18<30:23, 53.62s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [15:10<29:17, 53.26s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [16:04<28:29, 53.41s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [16:57<27:32, 53.29s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [17:51<26:44, 53.47s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [18:45<25:55, 53.65s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [19:39<25:03, 53.69s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [20:32<24:03, 53.47s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [21:26<23:15, 53.68s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [22:18<22:10, 53.24s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [23:13<21:29, 53.71s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [24:06<20:33, 53.64s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [25:00<19:42, 53.74s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [25:54<18:46, 53.64s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [26:48<17:57, 53.87s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [27:41<16:58, 53.59s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [28:35<16:03, 53.54s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [29:30<15:18, 54.03s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [30:23<14:22, 53.93s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [31:16<13:23, 53.55s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [32:10<12:31, 53.70s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [33:04<11:36, 53.61s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [33:57<10:44, 53.69s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [34:51<09:49, 53.61s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [35:44<08:53, 53.37s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [36:37<08:01, 53.49s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [37:32<07:09, 53.73s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [38:26<06:17, 53.92s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [39:19<05:21, 53.56s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [40:13<04:29, 53.87s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [41:08<03:36, 54.08s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [42:02<02:41, 53.95s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [42:55<01:47, 53.82s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [43:49<00:53, 53.74s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [44:42<00:00, 53.74s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [44:42<00:00, 53.66s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.4321} | avg. gen lenth: 413.456
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-21 19:11:56,021] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o3-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                    | 70/9741 [00:00<00:13, 697.34it/s]  1%|█▏                                                                                  | 142/9741 [00:00<00:13, 707.67it/s]  2%|█▊                                                                                  | 215/9741 [00:00<00:13, 716.03it/s]  3%|██▍                                                                                 | 289/9741 [00:00<00:13, 722.89it/s]  4%|███▏                                                                                | 363/9741 [00:00<00:12, 728.69it/s]  4%|███▊                                                                                | 438/9741 [00:00<00:12, 733.04it/s]  5%|████▍                                                                               | 513/9741 [00:00<00:12, 737.97it/s]  6%|█████                                                                               | 588/9741 [00:00<00:12, 740.27it/s]  7%|█████▋                                                                              | 663/9741 [00:00<00:12, 721.37it/s]  8%|██████▎                                                                             | 737/9741 [00:01<00:12, 724.58it/s]  8%|███████                                                                             | 812/9741 [00:01<00:12, 730.81it/s]  9%|███████▋                                                                            | 886/9741 [00:01<00:12, 732.46it/s] 10%|████████▎                                                                           | 961/9741 [00:01<00:11, 736.16it/s] 11%|████████▊                                                                          | 1036/9741 [00:01<00:11, 739.95it/s] 11%|█████████▍                                                                         | 1111/9741 [00:01<00:11, 740.36it/s] 12%|██████████                                                                         | 1186/9741 [00:01<00:11, 739.12it/s] 13%|██████████▋                                                                        | 1261/9741 [00:01<00:11, 740.67it/s] 14%|███████████▍                                                                       | 1336/9741 [00:01<00:11, 739.04it/s] 14%|████████████                                                                       | 1410/9741 [00:01<00:11, 738.72it/s] 15%|████████████▋                                                                      | 1485/9741 [00:02<00:11, 740.11it/s] 16%|█████████████▎                                                                     | 1560/9741 [00:02<00:11, 738.66it/s] 17%|█████████████▉                                                                     | 1634/9741 [00:02<00:10, 738.67it/s] 18%|██████████████▌                                                                    | 1709/9741 [00:02<00:10, 739.36it/s] 18%|███████████████▏                                                                   | 1783/9741 [00:02<00:11, 722.29it/s] 19%|███████████████▉                                                                   | 1866/9741 [00:02<00:10, 752.95it/s] 20%|████████████████▊                                                                  | 1978/9741 [00:02<00:09, 859.81it/s] 21%|█████████████████▊                                                                 | 2088/9741 [00:02<00:08, 930.59it/s] 23%|██████████████████▋                                                                | 2199/9741 [00:02<00:07, 983.34it/s] 24%|███████████████████▍                                                              | 2310/9741 [00:02<00:07, 1019.05it/s] 25%|████████████████████▍                                                             | 2422/9741 [00:03<00:06, 1046.77it/s] 26%|█████████████████████▎                                                            | 2532/9741 [00:03<00:06, 1061.11it/s] 27%|██████████████████████▏                                                           | 2639/9741 [00:03<00:06, 1062.71it/s] 28%|███████████████████████▏                                                          | 2749/9741 [00:03<00:06, 1072.07it/s] 29%|████████████████████████                                                          | 2860/9741 [00:03<00:06, 1081.96it/s] 30%|█████████████████████████                                                         | 2970/9741 [00:03<00:06, 1086.73it/s] 32%|█████████████████████████▉                                                        | 3081/9741 [00:03<00:06, 1093.30it/s] 33%|██████████████████████████▊                                                       | 3191/9741 [00:03<00:05, 1094.56it/s] 34%|███████████████████████████▊                                                      | 3302/9741 [00:03<00:05, 1098.46it/s] 35%|████████████████████████████▋                                                     | 3412/9741 [00:03<00:05, 1098.71it/s] 36%|█████████████████████████████▋                                                    | 3522/9741 [00:04<00:05, 1097.61it/s] 37%|██████████████████████████████▌                                                   | 3633/9741 [00:04<00:05, 1098.70it/s] 38%|███████████████████████████████▌                                                  | 3745/9741 [00:04<00:05, 1102.67it/s] 40%|████████████████████████████████▍                                                 | 3856/9741 [00:04<00:05, 1102.25it/s] 41%|█████████████████████████████████▍                                                | 3967/9741 [00:04<00:05, 1104.08it/s] 42%|██████████████████████████████████▎                                               | 4078/9741 [00:04<00:05, 1102.88it/s] 43%|███████████████████████████████████▎                                              | 4189/9741 [00:04<00:05, 1101.58it/s] 44%|████████████████████████████████████▏                                             | 4300/9741 [00:04<00:04, 1097.75it/s] 45%|█████████████████████████████████████                                             | 4410/9741 [00:04<00:04, 1087.16it/s] 46%|██████████████████████████████████████                                            | 4519/9741 [00:04<00:05, 1037.38it/s] 48%|██████████████████████████████████████▉                                           | 4629/9741 [00:05<00:04, 1055.13it/s] 49%|████████████████████████████████████████▎                                          | 4735/9741 [00:05<00:06, 815.97it/s] 50%|█████████████████████████████████████████▎                                         | 4845/9741 [00:05<00:05, 883.48it/s] 51%|██████████████████████████████████████████▏                                        | 4955/9741 [00:05<00:05, 938.66it/s] 52%|███████████████████████████████████████████▏                                       | 5066/9741 [00:05<00:04, 983.28it/s] 53%|███████████████████████████████████████████▌                                      | 5176/9741 [00:05<00:04, 1013.57it/s] 54%|████████████████████████████████████████████▌                                     | 5287/9741 [00:05<00:04, 1038.36it/s] 55%|█████████████████████████████████████████████▍                                    | 5396/9741 [00:05<00:04, 1051.20it/s] 57%|██████████████████████████████████████████████▎                                   | 5506/9741 [00:05<00:03, 1064.56it/s] 58%|███████████████████████████████████████████████▎                                  | 5616/9741 [00:06<00:03, 1073.94it/s] 59%|████████████████████████████████████████████████▏                                 | 5727/9741 [00:06<00:03, 1083.65it/s] 60%|█████████████████████████████████████████████████▏                                | 5837/9741 [00:06<00:03, 1087.15it/s] 61%|██████████████████████████████████████████████████                                | 5947/9741 [00:06<00:03, 1089.55it/s] 62%|██████████████████████████████████████████████████▉                               | 6057/9741 [00:06<00:03, 1045.64it/s] 63%|███████████████████████████████████████████████████▉                              | 6166/9741 [00:06<00:03, 1057.00it/s] 64%|████████████████████████████████████████████████████▊                             | 6275/9741 [00:06<00:03, 1063.13it/s] 66%|█████████████████████████████████████████████████████▋                            | 6384/9741 [00:06<00:03, 1068.90it/s] 67%|██████████████████████████████████████████████████████▋                           | 6493/9741 [00:06<00:03, 1074.75it/s] 68%|███████████████████████████████████████████████████████▌                          | 6602/9741 [00:06<00:02, 1077.87it/s] 69%|████████████████████████████████████████████████████████▍                         | 6710/9741 [00:07<00:02, 1064.82it/s] 70%|█████████████████████████████████████████████████████████▍                        | 6819/9741 [00:07<00:02, 1069.81it/s] 71%|██████████████████████████████████████████████████████████▎                       | 6929/9741 [00:07<00:02, 1076.39it/s] 72%|███████████████████████████████████████████████████████████▏                      | 7038/9741 [00:07<00:02, 1077.82it/s] 73%|████████████████████████████████████████████████████████████▏                     | 7148/9741 [00:07<00:02, 1081.78it/s] 74%|█████████████████████████████████████████████████████████████                     | 7257/9741 [00:07<00:02, 1079.62it/s] 76%|██████████████████████████████████████████████████████████████                    | 7366/9741 [00:07<00:02, 1082.15it/s] 77%|██████████████████████████████████████████████████████████████▉                   | 7475/9741 [00:07<00:02, 1039.73it/s] 78%|███████████████████████████████████████████████████████████████▊                  | 7584/9741 [00:07<00:02, 1051.88it/s] 79%|████████████████████████████████████████████████████████████████▊                 | 7692/9741 [00:08<00:01, 1059.37it/s] 80%|█████████████████████████████████████████████████████████████████▋                | 7801/9741 [00:08<00:01, 1066.32it/s] 81%|██████████████████████████████████████████████████████████████████▌               | 7909/9741 [00:08<00:01, 1069.30it/s] 82%|███████████████████████████████████████████████████████████████████▍              | 8018/9741 [00:08<00:01, 1073.40it/s] 83%|████████████████████████████████████████████████████████████████████▍             | 8127/9741 [00:08<00:01, 1075.56it/s] 85%|█████████████████████████████████████████████████████████████████████▎            | 8236/9741 [00:08<00:01, 1078.79it/s] 86%|██████████████████████████████████████████████████████████████████████▏           | 8344/9741 [00:08<00:01, 1076.96it/s] 87%|███████████████████████████████████████████████████████████████████████▏          | 8452/9741 [00:08<00:01, 1077.64it/s] 88%|████████████████████████████████████████████████████████████████████████          | 8560/9741 [00:08<00:01, 1076.57it/s] 89%|████████████████████████████████████████████████████████████████████████▉         | 8668/9741 [00:08<00:00, 1075.21it/s] 90%|█████████████████████████████████████████████████████████████████████████▉        | 8776/9741 [00:09<00:00, 1073.82it/s] 91%|██████████████████████████████████████████████████████████████████████████▊       | 8884/9741 [00:09<00:00, 1074.40it/s] 92%|███████████████████████████████████████████████████████████████████████████▋      | 8992/9741 [00:09<00:00, 1075.59it/s] 93%|████████████████████████████████████████████████████████████████████████████▌     | 9100/9741 [00:09<00:00, 1070.47it/s] 95%|█████████████████████████████████████████████████████████████████████████████▌    | 9208/9741 [00:09<00:00, 1070.80it/s] 96%|██████████████████████████████████████████████████████████████████████████████▍   | 9316/9741 [00:09<00:00, 1068.26it/s] 97%|███████████████████████████████████████████████████████████████████████████████▎  | 9424/9741 [00:09<00:00, 1069.49it/s] 98%|████████████████████████████████████████████████████████████████████████████████▏ | 9531/9741 [00:09<00:00, 1067.09it/s] 99%|█████████████████████████████████████████████████████████████████████████████████▏| 9638/9741 [00:09<00:00, 1067.85it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:09<00:00, 981.23it/s]
Load End
Num instances: 1000
[2023-08-21 19:12:17,151] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 19:12:19,874] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 19:12:19,874] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7faf4bd93a60>
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 19:12:19,875] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7faf4bd93940>
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 19:12:19,876] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 19:12:19,876] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.45754194259643555 seconds
Loading extension module utils...
Time to load utils op: 0.5049591064453125 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o3-tgsm8k-s1-rTrue
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:49<40:23, 49.46s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:41<40:53, 51.11s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:29<38:55, 49.69s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:18<37:47, 49.29s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [04:07<36:54, 49.22s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [04:56<36:07, 49.27s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [05:45<35:10, 49.07s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [06:35<34:32, 49.35s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [07:23<33:26, 48.93s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [08:11<32:23, 48.58s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [09:00<31:40, 48.73s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [09:51<31:19, 49.45s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [10:40<30:28, 49.42s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [11:30<29:41, 49.48s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [12:19<28:43, 49.24s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [13:07<27:45, 48.98s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [13:56<26:53, 48.89s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [14:45<26:06, 48.96s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [15:34<25:21, 49.10s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [16:23<24:29, 48.97s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [17:11<23:30, 48.64s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [17:59<22:36, 48.43s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [18:47<21:45, 48.36s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [19:36<21:06, 48.73s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [20:26<20:21, 48.85s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [21:13<19:24, 48.53s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [22:01<18:30, 48.27s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [22:49<17:42, 48.29s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [23:38<16:56, 48.38s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [24:27<16:08, 48.45s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [25:17<15:29, 48.95s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [26:05<14:37, 48.76s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [26:54<13:49, 48.77s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [27:42<12:58, 48.65s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [28:31<12:11, 48.76s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [29:20<11:22, 48.75s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [30:08<10:31, 48.60s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [30:58<09:47, 48.97s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [31:47<09:00, 49.10s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [32:36<08:08, 48.85s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [33:24<07:17, 48.56s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [34:12<06:27, 48.49s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [35:00<05:38, 48.40s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [35:48<04:50, 48.37s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [36:37<04:02, 48.59s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [37:27<03:15, 48.81s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [38:16<02:26, 48.89s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [39:04<01:37, 48.57s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [39:53<00:48, 48.91s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [40:42<00:00, 48.87s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [40:42<00:00, 48.85s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.409} | avg. gen lenth: 433.884
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

using world size: 2
[2023-08-21 19:53:10,021] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o4-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                    | 58/9741 [00:00<00:16, 571.66it/s]  1%|█                                                                                   | 118/9741 [00:00<00:16, 583.84it/s]  2%|█▌                                                                                  | 178/9741 [00:00<00:16, 587.14it/s]  2%|██                                                                                  | 238/9741 [00:00<00:16, 591.72it/s]  3%|██▌                                                                                 | 299/9741 [00:00<00:15, 595.36it/s]  4%|███                                                                                 | 360/9741 [00:00<00:15, 598.43it/s]  4%|███▋                                                                                | 421/9741 [00:00<00:15, 599.22it/s]  5%|████▏                                                                               | 481/9741 [00:00<00:15, 592.90it/s]  6%|████▋                                                                               | 542/9741 [00:00<00:15, 595.97it/s]  6%|█████▏                                                                              | 604/9741 [00:01<00:15, 600.53it/s]  7%|█████▋                                                                              | 665/9741 [00:01<00:15, 601.24it/s]  7%|██████▎                                                                             | 726/9741 [00:01<00:14, 603.80it/s]  8%|██████▊                                                                             | 788/9741 [00:01<00:14, 606.12it/s]  9%|███████▎                                                                            | 849/9741 [00:01<00:14, 607.08it/s]  9%|███████▉                                                                            | 921/9741 [00:01<00:13, 640.46it/s] 10%|████████▌                                                                          | 1012/9741 [00:01<00:12, 721.11it/s] 11%|█████████▍                                                                         | 1104/9741 [00:01<00:11, 778.91it/s] 12%|██████████▏                                                                        | 1196/9741 [00:01<00:10, 818.76it/s] 13%|██████████▉                                                                        | 1288/9741 [00:01<00:09, 847.40it/s] 14%|███████████▊                                                                       | 1379/9741 [00:02<00:09, 865.72it/s] 15%|████████████▌                                                                      | 1471/9741 [00:02<00:09, 880.48it/s] 16%|█████████████▎                                                                     | 1562/9741 [00:02<00:09, 887.17it/s] 17%|██████████████                                                                     | 1654/9741 [00:02<00:09, 894.25it/s] 18%|██████████████▉                                                                    | 1746/9741 [00:02<00:08, 900.68it/s] 19%|███████████████▋                                                                   | 1837/9741 [00:02<00:08, 882.17it/s] 20%|████████████████▍                                                                  | 1928/9741 [00:02<00:08, 889.97it/s] 21%|█████████████████▏                                                                 | 2018/9741 [00:02<00:08, 892.85it/s] 22%|█████████████████▉                                                                 | 2109/9741 [00:02<00:08, 897.69it/s] 23%|██████████████████▊                                                                | 2201/9741 [00:02<00:08, 902.10it/s] 24%|███████████████████▌                                                               | 2292/9741 [00:03<00:08, 901.64it/s] 24%|████████████████████▎                                                              | 2383/9741 [00:03<00:08, 893.29it/s] 25%|█████████████████████                                                              | 2473/9741 [00:03<00:08, 890.60it/s] 26%|█████████████████████▊                                                             | 2563/9741 [00:03<00:08, 891.42it/s] 27%|██████████████████████▌                                                            | 2653/9741 [00:03<00:07, 893.09it/s] 28%|███████████████████████▎                                                           | 2743/9741 [00:03<00:07, 891.98it/s] 29%|████████████████████████▏                                                          | 2833/9741 [00:03<00:07, 892.06it/s] 30%|████████████████████████▉                                                          | 2923/9741 [00:03<00:07, 892.95it/s] 31%|█████████████████████████▋                                                         | 3013/9741 [00:03<00:07, 894.14it/s] 32%|██████████████████████████▍                                                        | 3103/9741 [00:03<00:07, 893.25it/s] 33%|███████████████████████████▏                                                       | 3193/9741 [00:04<00:07, 888.49it/s] 34%|███████████████████████████▉                                                       | 3282/9741 [00:04<00:07, 886.87it/s] 35%|████████████████████████████▋                                                      | 3371/9741 [00:04<00:07, 883.78it/s] 36%|█████████████████████████████▍                                                     | 3460/9741 [00:04<00:07, 884.72it/s] 36%|██████████████████████████████▏                                                    | 3549/9741 [00:04<00:07, 884.22it/s] 37%|██████████████████████████████▉                                                    | 3638/9741 [00:04<00:06, 882.37it/s] 38%|███████████████████████████████▊                                                   | 3727/9741 [00:04<00:06, 883.99it/s] 39%|████████████████████████████████▌                                                  | 3816/9741 [00:04<00:06, 882.73it/s] 40%|█████████████████████████████████▎                                                 | 3905/9741 [00:04<00:06, 884.46it/s] 41%|██████████████████████████████████                                                 | 3994/9741 [00:04<00:06, 885.02it/s] 42%|██████████████████████████████████▊                                                | 4083/9741 [00:05<00:06, 884.57it/s] 43%|███████████████████████████████████▌                                               | 4172/9741 [00:05<00:06, 885.26it/s] 44%|████████████████████████████████████▎                                              | 4261/9741 [00:05<00:06, 881.55it/s] 45%|█████████████████████████████████████                                              | 4350/9741 [00:05<00:06, 882.38it/s] 46%|█████████████████████████████████████▊                                             | 4439/9741 [00:05<00:06, 882.79it/s] 46%|██████████████████████████████████████▌                                            | 4528/9741 [00:05<00:06, 850.04it/s] 47%|███████████████████████████████████████▎                                           | 4617/9741 [00:05<00:05, 860.05it/s] 48%|████████████████████████████████████████                                           | 4706/9741 [00:05<00:05, 866.69it/s] 49%|████████████████████████████████████████▊                                          | 4793/9741 [00:05<00:06, 712.17it/s] 50%|█████████████████████████████████████████▌                                         | 4881/9741 [00:06<00:06, 754.84it/s] 51%|██████████████████████████████████████████▎                                        | 4963/9741 [00:06<00:06, 771.87it/s] 52%|███████████████████████████████████████████                                        | 5050/9741 [00:06<00:05, 798.76it/s] 53%|███████████████████████████████████████████▊                                       | 5138/9741 [00:06<00:05, 820.03it/s] 54%|████████████████████████████████████████████▌                                      | 5225/9741 [00:06<00:05, 833.88it/s] 55%|█████████████████████████████████████████████▎                                     | 5313/9741 [00:06<00:05, 846.02it/s] 55%|██████████████████████████████████████████████                                     | 5400/9741 [00:06<00:05, 850.36it/s] 56%|██████████████████████████████████████████████▊                                    | 5488/9741 [00:06<00:04, 857.82it/s] 57%|███████████████████████████████████████████████▌                                   | 5576/9741 [00:06<00:04, 863.28it/s] 58%|████████████████████████████████████████████████▎                                  | 5663/9741 [00:06<00:04, 863.31it/s] 59%|█████████████████████████████████████████████████                                  | 5752/9741 [00:07<00:04, 869.97it/s] 60%|█████████████████████████████████████████████████▊                                 | 5840/9741 [00:07<00:04, 870.17it/s] 61%|██████████████████████████████████████████████████▌                                | 5928/9741 [00:07<00:04, 872.53it/s] 62%|███████████████████████████████████████████████████▎                               | 6016/9741 [00:07<00:04, 872.31it/s] 63%|████████████████████████████████████████████████████                               | 6104/9741 [00:07<00:04, 868.89it/s] 64%|████████████████████████████████████████████████████▊                              | 6192/9741 [00:07<00:04, 870.41it/s] 64%|█████████████████████████████████████████████████████▌                             | 6280/9741 [00:07<00:03, 868.58it/s] 65%|██████████████████████████████████████████████████████▎                            | 6368/9741 [00:07<00:03, 869.38it/s] 66%|███████████████████████████████████████████████████████                            | 6455/9741 [00:07<00:03, 867.22it/s] 67%|███████████████████████████████████████████████████████▋                           | 6542/9741 [00:07<00:03, 865.73it/s] 68%|████████████████████████████████████████████████████████▍                          | 6629/9741 [00:08<00:03, 866.48it/s] 69%|█████████████████████████████████████████████████████████▏                         | 6717/9741 [00:08<00:03, 868.94it/s] 70%|█████████████████████████████████████████████████████████▉                         | 6805/9741 [00:08<00:03, 869.98it/s] 71%|██████████████████████████████████████████████████████████▋                        | 6893/9741 [00:08<00:03, 870.02it/s] 72%|███████████████████████████████████████████████████████████▍                       | 6981/9741 [00:08<00:03, 869.14it/s] 73%|████████████████████████████████████████████████████████████▏                      | 7070/9741 [00:08<00:03, 873.28it/s] 73%|████████████████████████████████████████████████████████████▉                      | 7159/9741 [00:08<00:02, 876.03it/s] 74%|█████████████████████████████████████████████████████████████▋                     | 7247/9741 [00:08<00:02, 875.38it/s] 75%|██████████████████████████████████████████████████████████████▍                    | 7335/9741 [00:08<00:02, 875.10it/s] 76%|███████████████████████████████████████████████████████████████▏                   | 7423/9741 [00:08<00:02, 842.05it/s] 77%|███████████████████████████████████████████████████████████████▉                   | 7510/9741 [00:09<00:02, 847.85it/s] 78%|████████████████████████████████████████████████████████████████▋                  | 7598/9741 [00:09<00:02, 854.54it/s] 79%|█████████████████████████████████████████████████████████████████▍                 | 7686/9741 [00:09<00:02, 859.56it/s] 80%|██████████████████████████████████████████████████████████████████▏                | 7774/9741 [00:09<00:02, 864.74it/s] 81%|██████████████████████████████████████████████████████████████████▉                | 7862/9741 [00:09<00:02, 867.39it/s] 82%|███████████████████████████████████████████████████████████████████▋               | 7949/9741 [00:09<00:02, 866.52it/s] 83%|████████████████████████████████████████████████████████████████████▍              | 8037/9741 [00:09<00:01, 867.94it/s] 83%|█████████████████████████████████████████████████████████████████████▏             | 8124/9741 [00:09<00:01, 866.98it/s] 84%|█████████████████████████████████████████████████████████████████████▉             | 8212/9741 [00:09<00:01, 869.44it/s] 85%|██████████████████████████████████████████████████████████████████████▋            | 8300/9741 [00:09<00:01, 870.79it/s] 86%|███████████████████████████████████████████████████████████████████████▍           | 8388/9741 [00:10<00:01, 870.05it/s] 87%|████████████████████████████████████████████████████████████████████████▏          | 8476/9741 [00:10<00:01, 869.43it/s] 88%|████████████████████████████████████████████████████████████████████████▉          | 8563/9741 [00:10<00:01, 866.83it/s] 89%|█████████████████████████████████████████████████████████████████████████▋         | 8650/9741 [00:10<00:01, 864.33it/s] 90%|██████████████████████████████████████████████████████████████████████████▍        | 8738/9741 [00:10<00:01, 866.41it/s] 91%|███████████████████████████████████████████████████████████████████████████▏       | 8825/9741 [00:10<00:01, 865.78it/s] 91%|███████████████████████████████████████████████████████████████████████████▉       | 8913/9741 [00:10<00:00, 868.45it/s] 92%|████████████████████████████████████████████████████████████████████████████▋      | 9000/9741 [00:10<00:00, 867.79it/s] 93%|█████████████████████████████████████████████████████████████████████████████▍     | 9087/9741 [00:10<00:00, 867.77it/s] 94%|██████████████████████████████████████████████████████████████████████████████▏    | 9174/9741 [00:10<00:00, 867.31it/s] 95%|██████████████████████████████████████████████████████████████████████████████▉    | 9261/9741 [00:11<00:00, 867.20it/s] 96%|███████████████████████████████████████████████████████████████████████████████▋   | 9349/9741 [00:11<00:00, 868.59it/s] 97%|████████████████████████████████████████████████████████████████████████████████▍  | 9436/9741 [00:11<00:00, 868.86it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▏ | 9523/9741 [00:11<00:00, 868.04it/s] 99%|█████████████████████████████████████████████████████████████████████████████████▉ | 9610/9741 [00:11<00:00, 866.73it/s]100%|██████████████████████████████████████████████████████████████████████████████████▋| 9697/9741 [00:11<00:00, 864.70it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:11<00:00, 835.87it/s]
Load End
Num instances: 1000
[2023-08-21 19:53:33,099] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 19:53:35,981] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 19:53:35,982] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 19:53:35,982] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 19:53:35,982] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 19:53:35,982] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 19:53:35,982] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 19:53:35,982] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 19:53:35,982] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 19:53:35,982] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f590defda60>
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f590defd940>
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-21 19:53:35,983] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 19:53:35,984] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 19:53:35,984] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 19:53:35,984] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 19:53:35,984] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.47977256774902344 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
So the final answer is 3

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o4-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.4045267105102539 seconds
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:44<36:16, 44.42s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:28<35:28, 44.35s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:13<34:45, 44.38s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [02:57<34:00, 44.36s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [03:41<33:18, 44.41s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [04:26<32:28, 44.29s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [05:11<31:54, 44.51s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [05:55<31:08, 44.50s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [06:39<30:23, 44.47s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [07:23<29:26, 44.15s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [08:07<28:38, 44.06s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [08:50<27:51, 43.98s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [09:36<27:19, 44.32s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [10:20<26:40, 44.45s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [11:05<25:54, 44.43s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [11:49<25:12, 44.47s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [12:34<24:26, 44.44s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [13:18<23:41, 44.41s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [14:02<22:54, 44.33s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [14:47<22:11, 44.38s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [15:31<21:27, 44.38s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [16:15<20:36, 44.18s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [16:59<19:55, 44.28s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [17:44<19:12, 44.33s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [18:28<18:28, 44.33s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [19:12<17:44, 44.37s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [19:57<17:02, 44.47s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [20:42<16:20, 44.58s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [21:27<15:36, 44.57s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [22:11<14:51, 44.57s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [22:56<14:10, 44.78s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [23:41<13:23, 44.67s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [24:26<12:40, 44.71s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [25:10<11:54, 44.66s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [25:55<11:08, 44.59s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [26:38<10:20, 44.33s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [27:23<09:36, 44.32s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [28:08<08:54, 44.58s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [28:53<08:11, 44.72s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [29:38<07:27, 44.74s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [30:22<06:42, 44.68s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [31:06<05:54, 44.34s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [31:50<05:11, 44.47s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [32:34<04:25, 44.28s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [33:18<03:40, 44.13s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [34:02<02:56, 44.15s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [34:46<02:11, 43.95s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [35:30<01:28, 44.01s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [36:15<00:44, 44.35s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [37:00<00:00, 44.38s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [37:00<00:00, 44.40s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.3034} | avg. gen lenth: 439.78
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 5
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-21 20:30:43,695] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 5
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o5-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  0%|▍                                                                                    | 45/9741 [00:00<00:21, 440.92it/s]  1%|▊                                                                                    | 91/9741 [00:00<00:21, 447.78it/s]  1%|█▏                                                                                  | 137/9741 [00:00<00:21, 451.34it/s]  2%|█▌                                                                                  | 183/9741 [00:00<00:21, 450.55it/s]  2%|█▉                                                                                  | 229/9741 [00:00<00:20, 453.87it/s]  3%|██▎                                                                                 | 275/9741 [00:00<00:20, 455.77it/s]  3%|██▊                                                                                 | 322/9741 [00:00<00:20, 457.47it/s]  4%|███▏                                                                                | 368/9741 [00:00<00:20, 448.75it/s]  4%|███▌                                                                                | 414/9741 [00:00<00:20, 449.66it/s]  5%|███▉                                                                                | 461/9741 [00:01<00:20, 453.74it/s]  5%|████▍                                                                               | 508/9741 [00:01<00:20, 455.75it/s]  6%|████▊                                                                               | 555/9741 [00:01<00:20, 457.77it/s]  6%|█████▏                                                                              | 602/9741 [00:01<00:19, 459.19it/s]  7%|█████▋                                                                              | 657/9741 [00:01<00:18, 484.36it/s]  7%|██████▎                                                                             | 728/9741 [00:01<00:16, 549.46it/s]  8%|██████▉                                                                             | 798/9741 [00:01<00:15, 592.28it/s]  9%|███████▍                                                                            | 868/9741 [00:01<00:14, 622.43it/s] 10%|████████                                                                            | 937/9741 [00:01<00:13, 640.73it/s] 10%|████████▌                                                                          | 1008/9741 [00:01<00:13, 659.95it/s] 11%|█████████▏                                                                         | 1079/9741 [00:02<00:12, 674.01it/s] 12%|█████████▊                                                                         | 1149/9741 [00:02<00:12, 681.75it/s] 13%|██████████▍                                                                        | 1219/9741 [00:02<00:12, 685.76it/s] 13%|██████████▉                                                                        | 1289/9741 [00:02<00:12, 689.52it/s] 14%|███████████▌                                                                       | 1359/9741 [00:02<00:12, 689.96it/s] 15%|████████████▏                                                                      | 1429/9741 [00:02<00:12, 691.25it/s] 15%|████████████▊                                                                      | 1499/9741 [00:02<00:11, 692.42it/s] 16%|█████████████▎                                                                     | 1569/9741 [00:02<00:11, 691.60it/s] 17%|█████████████▉                                                                     | 1639/9741 [00:02<00:11, 690.24it/s] 18%|██████████████▌                                                                    | 1709/9741 [00:02<00:11, 691.61it/s] 18%|███████████████▏                                                                   | 1779/9741 [00:03<00:11, 672.85it/s] 19%|███████████████▋                                                                   | 1847/9741 [00:03<00:11, 666.98it/s] 20%|████████████████▎                                                                  | 1916/9741 [00:03<00:11, 671.63it/s] 20%|████████████████▉                                                                  | 1985/9741 [00:03<00:11, 675.09it/s] 21%|█████████████████▍                                                                 | 2053/9741 [00:03<00:11, 675.33it/s] 22%|██████████████████                                                                 | 2122/9741 [00:03<00:11, 677.27it/s] 22%|██████████████████▋                                                                | 2190/9741 [00:03<00:11, 677.68it/s] 23%|███████████████████▏                                                               | 2258/9741 [00:03<00:11, 677.92it/s] 24%|███████████████████▊                                                               | 2327/9741 [00:03<00:10, 680.22it/s] 25%|████████████████████▍                                                              | 2396/9741 [00:03<00:10, 680.09it/s] 25%|█████████████████████                                                              | 2465/9741 [00:04<00:10, 678.09it/s] 26%|█████████████████████▌                                                             | 2533/9741 [00:04<00:10, 677.75it/s] 27%|██████████████████████▏                                                            | 2602/9741 [00:04<00:10, 678.83it/s] 27%|██████████████████████▊                                                            | 2670/9741 [00:04<00:10, 677.41it/s] 28%|███████████████████████▎                                                           | 2738/9741 [00:04<00:10, 677.24it/s] 29%|███████████████████████▉                                                           | 2806/9741 [00:04<00:10, 675.49it/s] 30%|████████████████████████▍                                                          | 2874/9741 [00:04<00:10, 676.58it/s] 30%|█████████████████████████                                                          | 2942/9741 [00:04<00:10, 674.38it/s] 31%|█████████████████████████▋                                                         | 3010/9741 [00:04<00:10, 672.45it/s] 32%|██████████████████████████▏                                                        | 3078/9741 [00:04<00:09, 673.27it/s] 32%|██████████████████████████▊                                                        | 3146/9741 [00:05<00:09, 673.90it/s] 33%|███████████████████████████▍                                                       | 3214/9741 [00:05<00:09, 675.27it/s] 34%|███████████████████████████▉                                                       | 3282/9741 [00:05<00:09, 676.55it/s] 34%|████████████████████████████▌                                                      | 3350/9741 [00:05<00:09, 674.94it/s] 35%|█████████████████████████████                                                      | 3418/9741 [00:05<00:09, 674.29it/s] 36%|█████████████████████████████▋                                                     | 3487/9741 [00:05<00:09, 677.52it/s] 36%|██████████████████████████████▎                                                    | 3555/9741 [00:05<00:09, 674.58it/s] 37%|██████████████████████████████▊                                                    | 3623/9741 [00:05<00:09, 672.52it/s] 38%|███████████████████████████████▍                                                   | 3691/9741 [00:05<00:09, 671.74it/s] 39%|████████████████████████████████                                                   | 3759/9741 [00:05<00:08, 671.17it/s] 39%|████████████████████████████████▌                                                  | 3827/9741 [00:06<00:08, 657.99it/s] 40%|█████████████████████████████████▏                                                 | 3894/9741 [00:06<00:08, 660.13it/s] 41%|█████████████████████████████████▊                                                 | 3961/9741 [00:06<00:08, 660.98it/s] 41%|██████████████████████████████████▎                                                | 4028/9741 [00:06<00:08, 663.40it/s] 42%|██████████████████████████████████▉                                                | 4096/9741 [00:06<00:08, 667.40it/s] 43%|███████████████████████████████████▍                                               | 4164/9741 [00:06<00:08, 668.58it/s] 43%|████████████████████████████████████                                               | 4231/9741 [00:06<00:08, 666.73it/s] 44%|████████████████████████████████████▌                                              | 4298/9741 [00:06<00:08, 663.92it/s] 45%|█████████████████████████████████████▏                                             | 4365/9741 [00:06<00:08, 664.37it/s] 45%|█████████████████████████████████████▊                                             | 4432/9741 [00:06<00:07, 664.17it/s] 46%|██████████████████████████████████████▎                                            | 4499/9741 [00:07<00:08, 623.79it/s] 47%|██████████████████████████████████████▉                                            | 4566/9741 [00:07<00:08, 636.65it/s] 48%|███████████████████████████████████████▍                                           | 4633/9741 [00:07<00:07, 643.93it/s] 48%|████████████████████████████████████████                                           | 4700/9741 [00:07<00:07, 649.12it/s] 49%|████████████████████████████████████████▌                                          | 4766/9741 [00:07<00:10, 478.86it/s] 50%|█████████████████████████████████████████▏                                         | 4832/9741 [00:07<00:09, 521.42it/s] 50%|█████████████████████████████████████████▋                                         | 4896/9741 [00:07<00:08, 550.88it/s] 51%|██████████████████████████████████████████▎                                        | 4962/9741 [00:07<00:08, 578.94it/s] 52%|██████████████████████████████████████████▊                                        | 5028/9741 [00:08<00:07, 599.76it/s] 52%|███████████████████████████████████████████▍                                       | 5094/9741 [00:08<00:07, 616.08it/s] 53%|███████████████████████████████████████████▉                                       | 5159/9741 [00:08<00:07, 625.72it/s] 54%|████████████████████████████████████████████▌                                      | 5225/9741 [00:08<00:07, 634.48it/s] 54%|█████████████████████████████████████████████                                      | 5291/9741 [00:08<00:06, 640.11it/s] 55%|█████████████████████████████████████████████▋                                     | 5357/9741 [00:08<00:06, 644.51it/s] 56%|██████████████████████████████████████████████▏                                    | 5423/9741 [00:08<00:06, 648.68it/s] 56%|██████████████████████████████████████████████▊                                    | 5489/9741 [00:08<00:06, 651.27it/s] 57%|███████████████████████████████████████████████▎                                   | 5556/9741 [00:08<00:06, 654.17it/s] 58%|███████████████████████████████████████████████▉                                   | 5622/9741 [00:08<00:06, 652.33it/s] 58%|████████████████████████████████████████████████▍                                  | 5688/9741 [00:09<00:06, 652.88it/s] 59%|█████████████████████████████████████████████████                                  | 5754/9741 [00:09<00:06, 652.82it/s] 60%|█████████████████████████████████████████████████▌                                 | 5820/9741 [00:09<00:05, 653.96it/s] 60%|██████████████████████████████████████████████████▏                                | 5886/9741 [00:09<00:05, 652.94it/s] 61%|██████████████████████████████████████████████████▋                                | 5952/9741 [00:09<00:05, 653.25it/s] 62%|███████████████████████████████████████████████████▎                               | 6018/9741 [00:09<00:05, 653.92it/s] 62%|███████████████████████████████████████████████████▊                               | 6084/9741 [00:09<00:05, 652.23it/s] 63%|████████████████████████████████████████████████████▍                              | 6151/9741 [00:09<00:05, 654.85it/s] 64%|████████████████████████████████████████████████████▉                              | 6218/9741 [00:09<00:05, 657.21it/s] 65%|█████████████████████████████████████████████████████▌                             | 6284/9741 [00:09<00:05, 656.43it/s] 65%|██████████████████████████████████████████████████████                             | 6350/9741 [00:10<00:05, 657.33it/s] 66%|██████████████████████████████████████████████████████▋                            | 6417/9741 [00:10<00:05, 658.97it/s] 67%|███████████████████████████████████████████████████████▏                           | 6483/9741 [00:10<00:04, 657.94it/s] 67%|███████████████████████████████████████████████████████▊                           | 6549/9741 [00:10<00:04, 655.81it/s] 68%|████████████████████████████████████████████████████████▎                          | 6615/9741 [00:10<00:04, 656.61it/s] 69%|████████████████████████████████████████████████████████▉                          | 6681/9741 [00:10<00:04, 656.73it/s] 69%|█████████████████████████████████████████████████████████▍                         | 6747/9741 [00:10<00:04, 654.63it/s] 70%|██████████████████████████████████████████████████████████                         | 6813/9741 [00:10<00:04, 654.94it/s] 71%|██████████████████████████████████████████████████████████▌                        | 6880/9741 [00:10<00:04, 656.86it/s] 71%|███████████████████████████████████████████████████████████▏                       | 6946/9741 [00:10<00:04, 657.20it/s] 72%|███████████████████████████████████████████████████████████▋                       | 7012/9741 [00:11<00:04, 655.61it/s] 73%|████████████████████████████████████████████████████████████▎                      | 7079/9741 [00:11<00:04, 657.28it/s] 73%|████████████████████████████████████████████████████████████▉                      | 7146/9741 [00:11<00:03, 658.71it/s] 74%|█████████████████████████████████████████████████████████████▍                     | 7212/9741 [00:11<00:03, 656.95it/s] 75%|██████████████████████████████████████████████████████████████                     | 7279/9741 [00:11<00:03, 658.37it/s] 75%|██████████████████████████████████████████████████████████████▌                    | 7346/9741 [00:11<00:03, 660.12it/s] 76%|███████████████████████████████████████████████████████████████▏                   | 7413/9741 [00:11<00:03, 632.33it/s] 77%|███████████████████████████████████████████████████████████████▋                   | 7478/9741 [00:11<00:03, 636.92it/s] 77%|████████████████████████████████████████████████████████████████▎                  | 7544/9741 [00:11<00:03, 642.24it/s] 78%|████████████████████████████████████████████████████████████████▊                  | 7611/9741 [00:11<00:03, 649.07it/s] 79%|█████████████████████████████████████████████████████████████████▍                 | 7677/9741 [00:12<00:03, 649.00it/s] 79%|█████████████████████████████████████████████████████████████████▉                 | 7742/9741 [00:12<00:03, 637.12it/s] 80%|██████████████████████████████████████████████████████████████████▌                | 7806/9741 [00:12<00:03, 637.69it/s] 81%|███████████████████████████████████████████████████████████████████                | 7870/9741 [00:12<00:02, 636.02it/s] 81%|███████████████████████████████████████████████████████████████████▌               | 7935/9741 [00:12<00:02, 637.36it/s] 82%|████████████████████████████████████████████████████████████████████▏              | 7999/9741 [00:12<00:02, 637.93it/s] 83%|████████████████████████████████████████████████████████████████████▋              | 8063/9741 [00:12<00:02, 638.52it/s] 83%|█████████████████████████████████████████████████████████████████████▏             | 8127/9741 [00:12<00:02, 638.04it/s] 84%|█████████████████████████████████████████████████████████████████████▊             | 8192/9741 [00:12<00:02, 639.61it/s] 85%|██████████████████████████████████████████████████████████████████████▎            | 8257/9741 [00:13<00:02, 640.17it/s] 85%|██████████████████████████████████████████████████████████████████████▉            | 8322/9741 [00:13<00:02, 638.47it/s] 86%|███████████████████████████████████████████████████████████████████████▍           | 8387/9741 [00:13<00:02, 639.59it/s] 87%|████████████████████████████████████████████████████████████████████████           | 8452/9741 [00:13<00:02, 642.28it/s] 87%|████████████████████████████████████████████████████████████████████████▌          | 8518/9741 [00:13<00:01, 646.25it/s] 88%|█████████████████████████████████████████████████████████████████████████▏         | 8583/9741 [00:13<00:01, 646.45it/s] 89%|█████████████████████████████████████████████████████████████████████████▋         | 8649/9741 [00:13<00:01, 649.95it/s] 89%|██████████████████████████████████████████████████████████████████████████▎        | 8715/9741 [00:13<00:01, 650.23it/s] 90%|██████████████████████████████████████████████████████████████████████████▊        | 8781/9741 [00:13<00:01, 650.88it/s] 91%|███████████████████████████████████████████████████████████████████████████▍       | 8847/9741 [00:13<00:01, 653.10it/s] 91%|███████████████████████████████████████████████████████████████████████████▉       | 8913/9741 [00:14<00:01, 654.97it/s] 92%|████████████████████████████████████████████████████████████████████████████▌      | 8979/9741 [00:14<00:01, 655.60it/s] 93%|█████████████████████████████████████████████████████████████████████████████      | 9045/9741 [00:14<00:01, 653.38it/s] 94%|█████████████████████████████████████████████████████████████████████████████▋     | 9111/9741 [00:14<00:00, 654.14it/s] 94%|██████████████████████████████████████████████████████████████████████████████▏    | 9177/9741 [00:14<00:00, 650.55it/s] 95%|██████████████████████████████████████████████████████████████████████████████▊    | 9243/9741 [00:14<00:00, 648.94it/s] 96%|███████████████████████████████████████████████████████████████████████████████▎   | 9309/9741 [00:14<00:00, 651.36it/s] 96%|███████████████████████████████████████████████████████████████████████████████▉   | 9376/9741 [00:14<00:00, 654.16it/s] 97%|████████████████████████████████████████████████████████████████████████████████▍  | 9442/9741 [00:14<00:00, 655.59it/s] 98%|█████████████████████████████████████████████████████████████████████████████████  | 9508/9741 [00:14<00:00, 653.59it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▌ | 9574/9741 [00:15<00:00, 652.97it/s] 99%|██████████████████████████████████████████████████████████████████████████████████▏| 9640/9741 [00:15<00:00, 649.33it/s]100%|██████████████████████████████████████████████████████████████████████████████████▋| 9705/9741 [00:15<00:00, 646.22it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:15<00:00, 636.90it/s]
Load End
Num instances: 1000
[2023-08-21 20:31:10,094] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 20:31:12,633] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 20:31:12,633] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f7c6c323a60>
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 20:31:12,634] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f7c6c323940>
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 20:31:12,635] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 20:31:12,635] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.46372032165527344 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
So the final answer is 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
So the final answer is 27

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o5-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.5047574043273926 seconds
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:39<32:13, 39.45s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:18<31:22, 39.23s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [01:57<30:29, 38.92s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [02:36<29:55, 39.04s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [03:16<29:34, 39.44s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [03:56<28:57, 39.49s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [04:34<28:06, 39.22s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [05:13<27:25, 39.18s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [05:52<26:37, 38.96s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [06:31<26:02, 39.06s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [07:12<25:47, 39.68s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [07:51<24:55, 39.34s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [08:30<24:18, 39.42s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [09:10<23:43, 39.54s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [09:49<23:01, 39.46s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [10:29<22:19, 39.40s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [11:08<21:43, 39.49s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [11:49<21:15, 39.87s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [12:29<20:36, 39.87s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [13:08<19:50, 39.69s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [13:47<19:06, 39.54s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [14:26<18:21, 39.35s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [15:07<17:50, 39.64s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [15:46<17:06, 39.48s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [16:25<16:21, 39.28s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [17:04<15:40, 39.17s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [17:42<14:59, 39.11s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [18:22<14:22, 39.22s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [19:01<13:41, 39.10s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [19:40<13:03, 39.20s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [20:20<12:27, 39.33s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [20:59<11:46, 39.25s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [21:38<11:06, 39.23s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [22:18<10:31, 39.44s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [22:57<09:51, 39.42s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [23:37<09:13, 39.55s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [24:16<08:32, 39.42s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [24:56<07:53, 39.50s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [25:35<07:12, 39.33s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [26:14<06:33, 39.38s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [26:55<05:56, 39.65s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [27:34<05:15, 39.44s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [28:12<04:34, 39.22s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [28:52<03:56, 39.37s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [29:31<03:16, 39.27s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [30:10<02:36, 39.08s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [30:50<01:57, 39.33s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [31:29<01:18, 39.25s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [32:08<00:39, 39.27s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [32:48<00:00, 39.41s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [32:48<00:00, 39.37s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.2587} | avg. gen lenth: 438.188
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 6
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-21 21:04:12,109] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 6
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o6-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                    | 38/9741 [00:00<00:26, 371.09it/s]  1%|▋                                                                                    | 77/9741 [00:00<00:25, 378.14it/s]  1%|█                                                                                   | 116/9741 [00:00<00:25, 380.83it/s]  2%|█▎                                                                                  | 155/9741 [00:00<00:25, 382.87it/s]  2%|█▋                                                                                  | 194/9741 [00:00<00:24, 382.02it/s]  2%|██                                                                                  | 233/9741 [00:00<00:24, 383.73it/s]  3%|██▎                                                                                 | 272/9741 [00:00<00:24, 384.84it/s]  3%|██▋                                                                                 | 311/9741 [00:00<00:24, 378.03it/s]  4%|███                                                                                 | 350/9741 [00:00<00:24, 379.57it/s]  4%|███▎                                                                                | 390/9741 [00:01<00:24, 383.02it/s]  4%|███▋                                                                                | 429/9741 [00:01<00:24, 382.07it/s]  5%|████                                                                                | 468/9741 [00:01<00:24, 384.37it/s]  5%|████▍                                                                               | 508/9741 [00:01<00:23, 386.27it/s]  6%|████▋                                                                               | 547/9741 [00:01<00:23, 387.20it/s]  6%|█████                                                                               | 586/9741 [00:01<00:23, 387.27it/s]  6%|█████▍                                                                              | 625/9741 [00:01<00:23, 386.62it/s]  7%|█████▋                                                                              | 665/9741 [00:01<00:23, 388.00it/s]  7%|██████                                                                              | 704/9741 [00:01<00:23, 386.38it/s]  8%|██████▍                                                                             | 744/9741 [00:01<00:23, 387.62it/s]  8%|██████▊                                                                             | 783/9741 [00:02<00:23, 388.30it/s]  8%|███████                                                                             | 823/9741 [00:02<00:22, 389.54it/s]  9%|███████▍                                                                            | 869/9741 [00:02<00:21, 410.10it/s] 10%|████████                                                                            | 928/9741 [00:02<00:19, 462.83it/s] 10%|████████▌                                                                           | 987/9741 [00:02<00:17, 498.90it/s] 11%|████████▉                                                                          | 1046/9741 [00:02<00:16, 524.42it/s] 11%|█████████▍                                                                         | 1104/9741 [00:02<00:15, 540.36it/s] 12%|█████████▉                                                                         | 1163/9741 [00:02<00:15, 554.07it/s] 13%|██████████▍                                                                        | 1221/9741 [00:02<00:15, 561.70it/s] 13%|██████████▉                                                                        | 1280/9741 [00:02<00:14, 567.56it/s] 14%|███████████▍                                                                       | 1338/9741 [00:03<00:14, 571.13it/s] 14%|███████████▉                                                                       | 1396/9741 [00:03<00:14, 566.58it/s] 15%|████████████▍                                                                      | 1455/9741 [00:03<00:14, 570.85it/s] 16%|████████████▉                                                                      | 1513/9741 [00:03<00:14, 572.59it/s] 16%|█████████████▍                                                                     | 1571/9741 [00:03<00:14, 572.62it/s] 17%|█████████████▉                                                                     | 1629/9741 [00:03<00:14, 573.91it/s] 17%|██████████████▎                                                                    | 1687/9741 [00:03<00:13, 575.59it/s] 18%|██████████████▊                                                                    | 1745/9741 [00:03<00:13, 576.57it/s] 19%|███████████████▎                                                                   | 1803/9741 [00:03<00:14, 549.87it/s] 19%|███████████████▊                                                                   | 1861/9741 [00:03<00:14, 558.11it/s] 20%|████████████████▎                                                                  | 1919/9741 [00:04<00:13, 563.63it/s] 20%|████████████████▊                                                                  | 1977/9741 [00:04<00:13, 567.61it/s] 21%|█████████████████▎                                                                 | 2034/9741 [00:04<00:13, 568.26it/s] 21%|█████████████████▊                                                                 | 2091/9741 [00:04<00:13, 567.91it/s] 22%|██████████████████▎                                                                | 2148/9741 [00:04<00:13, 568.36it/s] 23%|██████████████████▊                                                                | 2206/9741 [00:04<00:13, 569.59it/s] 23%|███████████████████▎                                                               | 2263/9741 [00:04<00:13, 568.16it/s] 24%|███████████████████▊                                                               | 2321/9741 [00:04<00:13, 569.03it/s] 24%|████████████████████▎                                                              | 2379/9741 [00:04<00:12, 570.71it/s] 25%|████████████████████▊                                                              | 2437/9741 [00:04<00:12, 571.76it/s] 26%|█████████████████████▎                                                             | 2495/9741 [00:05<00:12, 569.69it/s] 26%|█████████████████████▊                                                             | 2553/9741 [00:05<00:12, 569.90it/s] 27%|██████████████████████▏                                                            | 2610/9741 [00:05<00:12, 569.46it/s] 27%|██████████████████████▋                                                            | 2667/9741 [00:05<00:12, 568.22it/s] 28%|███████████████████████▏                                                           | 2725/9741 [00:05<00:12, 568.91it/s] 29%|███████████████████████▋                                                           | 2783/9741 [00:05<00:12, 569.61it/s] 29%|████████████████████████▏                                                          | 2841/9741 [00:05<00:12, 570.14it/s] 30%|████████████████████████▋                                                          | 2899/9741 [00:05<00:12, 568.34it/s] 30%|█████████████████████████▏                                                         | 2956/9741 [00:05<00:11, 567.85it/s] 31%|█████████████████████████▋                                                         | 3014/9741 [00:05<00:11, 568.59it/s] 32%|██████████████████████████▏                                                        | 3071/9741 [00:06<00:11, 559.38it/s] 32%|██████████████████████████▋                                                        | 3127/9741 [00:06<00:11, 557.48it/s] 33%|███████████████████████████▏                                                       | 3184/9741 [00:06<00:11, 559.79it/s] 33%|███████████████████████████▌                                                       | 3241/9741 [00:06<00:11, 561.47it/s] 34%|████████████████████████████                                                       | 3298/9741 [00:06<00:11, 561.93it/s] 34%|████████████████████████████▌                                                      | 3355/9741 [00:06<00:11, 559.74it/s] 35%|█████████████████████████████                                                      | 3412/9741 [00:06<00:11, 560.40it/s] 36%|█████████████████████████████▌                                                     | 3469/9741 [00:06<00:11, 560.20it/s] 36%|██████████████████████████████                                                     | 3526/9741 [00:06<00:11, 559.63it/s] 37%|██████████████████████████████▌                                                    | 3582/9741 [00:07<00:11, 557.76it/s] 37%|██████████████████████████████▉                                                    | 3638/9741 [00:07<00:10, 558.31it/s] 38%|███████████████████████████████▍                                                   | 3695/9741 [00:07<00:10, 558.91it/s] 39%|███████████████████████████████▉                                                   | 3752/9741 [00:07<00:10, 559.24it/s] 39%|████████████████████████████████▍                                                  | 3808/9741 [00:07<00:10, 557.28it/s] 40%|████████████████████████████████▉                                                  | 3865/9741 [00:07<00:10, 558.85it/s] 40%|█████████████████████████████████▍                                                 | 3922/9741 [00:07<00:10, 560.96it/s] 41%|█████████████████████████████████▉                                                 | 3979/9741 [00:07<00:10, 562.13it/s] 41%|██████████████████████████████████▍                                                | 4036/9741 [00:07<00:10, 558.60it/s] 42%|██████████████████████████████████▉                                                | 4093/9741 [00:07<00:10, 559.79it/s] 43%|███████████████████████████████████▎                                               | 4150/9741 [00:08<00:09, 560.49it/s] 43%|███████████████████████████████████▊                                               | 4207/9741 [00:08<00:09, 561.16it/s] 44%|████████████████████████████████████▎                                              | 4264/9741 [00:08<00:09, 559.43it/s] 44%|████████████████████████████████████▊                                              | 4321/9741 [00:08<00:09, 560.91it/s] 45%|█████████████████████████████████████▎                                             | 4378/9741 [00:08<00:09, 561.75it/s] 46%|█████████████████████████████████████▊                                             | 4435/9741 [00:08<00:09, 561.60it/s] 46%|██████████████████████████████████████▎                                            | 4492/9741 [00:08<00:09, 528.11it/s] 47%|██████████████████████████████████████▊                                            | 4549/9741 [00:08<00:09, 537.46it/s] 47%|███████████████████████████████████████▏                                           | 4606/9741 [00:08<00:09, 544.18it/s] 48%|███████████████████████████████████████▋                                           | 4662/9741 [00:08<00:09, 548.06it/s] 48%|████████████████████████████████████████▏                                          | 4717/9741 [00:09<00:12, 404.83it/s] 49%|████████████████████████████████████████▋                                          | 4773/9741 [00:09<00:11, 440.41it/s] 50%|█████████████████████████████████████████▏                                         | 4829/9741 [00:09<00:10, 468.58it/s] 50%|█████████████████████████████████████████▌                                         | 4885/9741 [00:09<00:09, 491.52it/s] 51%|██████████████████████████████████████████                                         | 4941/9741 [00:09<00:09, 507.78it/s] 51%|██████████████████████████████████████████▌                                        | 4997/9741 [00:09<00:09, 520.99it/s] 52%|███████████████████████████████████████████                                        | 5053/9741 [00:09<00:08, 530.49it/s] 52%|███████████████████████████████████████████▌                                       | 5109/9741 [00:09<00:08, 537.14it/s] 53%|████████████████████████████████████████████                                       | 5164/9741 [00:09<00:08, 540.31it/s] 54%|████████████████████████████████████████████▍                                      | 5220/9741 [00:10<00:08, 544.36it/s] 54%|████████████████████████████████████████████▉                                      | 5276/9741 [00:10<00:08, 548.37it/s] 55%|█████████████████████████████████████████████▍                                     | 5333/9741 [00:10<00:07, 552.14it/s] 55%|█████████████████████████████████████████████▉                                     | 5389/9741 [00:10<00:07, 552.58it/s] 56%|██████████████████████████████████████████████▍                                    | 5446/9741 [00:10<00:07, 555.19it/s] 56%|██████████████████████████████████████████████▉                                    | 5503/9741 [00:10<00:07, 556.72it/s] 57%|███████████████████████████████████████████████▍                                   | 5560/9741 [00:10<00:07, 558.05it/s] 58%|███████████████████████████████████████████████▊                                   | 5616/9741 [00:10<00:07, 556.60it/s] 58%|████████████████████████████████████████████████▎                                  | 5672/9741 [00:10<00:07, 557.46it/s] 59%|████████████████████████████████████████████████▊                                  | 5729/9741 [00:11<00:07, 558.37it/s] 59%|█████████████████████████████████████████████████▎                                 | 5786/9741 [00:11<00:07, 559.25it/s] 60%|█████████████████████████████████████████████████▊                                 | 5842/9741 [00:11<00:06, 557.71it/s] 61%|██████████████████████████████████████████████████▎                                | 5899/9741 [00:11<00:06, 558.44it/s] 61%|██████████████████████████████████████████████████▋                                | 5955/9741 [00:11<00:06, 557.22it/s] 62%|███████████████████████████████████████████████████▏                               | 6011/9741 [00:11<00:06, 556.07it/s] 62%|███████████████████████████████████████████████████▋                               | 6067/9741 [00:11<00:06, 553.08it/s] 63%|████████████████████████████████████████████████████▏                              | 6123/9741 [00:11<00:06, 553.20it/s] 63%|████████████████████████████████████████████████████▋                              | 6179/9741 [00:11<00:06, 554.09it/s] 64%|█████████████████████████████████████████████████████▏                             | 6235/9741 [00:11<00:06, 555.14it/s] 65%|█████████████████████████████████████████████████████▌                             | 6291/9741 [00:12<00:06, 554.09it/s] 65%|██████████████████████████████████████████████████████                             | 6347/9741 [00:12<00:06, 555.52it/s] 66%|██████████████████████████████████████████████████████▌                            | 6403/9741 [00:12<00:06, 546.80it/s] 66%|███████████████████████████████████████████████████████                            | 6459/9741 [00:12<00:05, 549.31it/s] 67%|███████████████████████████████████████████████████████▌                           | 6514/9741 [00:12<00:05, 548.66it/s] 67%|███████████████████████████████████████████████████████▉                           | 6570/9741 [00:12<00:05, 550.33it/s] 68%|████████████████████████████████████████████████████████▍                          | 6626/9741 [00:12<00:05, 552.06it/s] 69%|████████████████████████████████████████████████████████▉                          | 6682/9741 [00:12<00:05, 552.84it/s] 69%|█████████████████████████████████████████████████████████▍                         | 6738/9741 [00:12<00:05, 552.21it/s] 70%|█████████████████████████████████████████████████████████▉                         | 6794/9741 [00:12<00:05, 553.83it/s] 70%|██████████████████████████████████████████████████████████▎                        | 6850/9741 [00:13<00:05, 554.92it/s] 71%|██████████████████████████████████████████████████████████▊                        | 6906/9741 [00:13<00:05, 555.66it/s] 71%|███████████████████████████████████████████████████████████▎                       | 6962/9741 [00:13<00:05, 554.59it/s] 72%|███████████████████████████████████████████████████████████▊                       | 7018/9741 [00:13<00:04, 554.45it/s] 73%|████████████████████████████████████████████████████████████▎                      | 7074/9741 [00:13<00:04, 554.76it/s] 73%|████████████████████████████████████████████████████████████▊                      | 7130/9741 [00:13<00:04, 555.18it/s] 74%|█████████████████████████████████████████████████████████████▏                     | 7186/9741 [00:13<00:04, 553.98it/s] 74%|█████████████████████████████████████████████████████████████▋                     | 7242/9741 [00:13<00:04, 554.79it/s] 75%|██████████████████████████████████████████████████████████████▏                    | 7298/9741 [00:13<00:04, 555.69it/s] 75%|██████████████████████████████████████████████████████████████▋                    | 7354/9741 [00:13<00:04, 556.07it/s] 76%|███████████████████████████████████████████████████████████████▏                   | 7410/9741 [00:14<00:04, 528.39it/s] 77%|███████████████████████████████████████████████████████████████▌                   | 7466/9741 [00:14<00:04, 536.19it/s] 77%|████████████████████████████████████████████████████████████████                   | 7522/9741 [00:14<00:04, 540.79it/s] 78%|████████████████████████████████████████████████████████████████▌                  | 7577/9741 [00:14<00:04, 540.03it/s] 78%|█████████████████████████████████████████████████████████████████                  | 7632/9741 [00:14<00:03, 542.59it/s] 79%|█████████████████████████████████████████████████████████████████▍                 | 7687/9741 [00:14<00:03, 541.44it/s] 79%|█████████████████████████████████████████████████████████████████▉                 | 7743/9741 [00:14<00:03, 545.20it/s] 80%|██████████████████████████████████████████████████████████████████▍                | 7799/9741 [00:14<00:03, 547.28it/s] 81%|██████████████████████████████████████████████████████████████████▉                | 7855/9741 [00:14<00:03, 549.23it/s] 81%|███████████████████████████████████████████████████████████████████▍               | 7910/9741 [00:14<00:03, 548.71it/s] 82%|███████████████████████████████████████████████████████████████████▉               | 7966/9741 [00:15<00:03, 549.93it/s] 82%|████████████████████████████████████████████████████████████████████▎              | 8022/9741 [00:15<00:03, 550.21it/s] 83%|████████████████████████████████████████████████████████████████████▊              | 8078/9741 [00:15<00:03, 549.96it/s] 84%|█████████████████████████████████████████████████████████████████████▎             | 8134/9741 [00:15<00:02, 548.68it/s] 84%|█████████████████████████████████████████████████████████████████████▊             | 8190/9741 [00:15<00:02, 550.02it/s] 85%|██████████████████████████████████████████████████████████████████████▎            | 8246/9741 [00:15<00:02, 551.09it/s] 85%|██████████████████████████████████████████████████████████████████████▋            | 8302/9741 [00:15<00:02, 551.17it/s] 86%|███████████████████████████████████████████████████████████████████████▏           | 8358/9741 [00:15<00:02, 550.12it/s] 86%|███████████████████████████████████████████████████████████████████████▋           | 8414/9741 [00:15<00:02, 551.64it/s] 87%|████████████████████████████████████████████████████████████████████████▏          | 8471/9741 [00:15<00:02, 554.07it/s] 88%|████████████████████████████████████████████████████████████████████████▋          | 8527/9741 [00:16<00:02, 555.54it/s] 88%|█████████████████████████████████████████████████████████████████████████▏         | 8583/9741 [00:16<00:02, 552.96it/s] 89%|█████████████████████████████████████████████████████████████████████████▌         | 8639/9741 [00:16<00:01, 554.22it/s] 89%|██████████████████████████████████████████████████████████████████████████         | 8695/9741 [00:16<00:01, 555.73it/s] 90%|██████████████████████████████████████████████████████████████████████████▌        | 8751/9741 [00:16<00:01, 556.75it/s] 90%|███████████████████████████████████████████████████████████████████████████        | 8807/9741 [00:16<00:01, 554.41it/s] 91%|███████████████████████████████████████████████████████████████████████████▌       | 8863/9741 [00:16<00:01, 555.64it/s] 92%|████████████████████████████████████████████████████████████████████████████       | 8920/9741 [00:16<00:01, 557.30it/s] 92%|████████████████████████████████████████████████████████████████████████████▍      | 8976/9741 [00:16<00:01, 557.87it/s] 93%|████████████████████████████████████████████████████████████████████████████▉      | 9032/9741 [00:16<00:01, 556.05it/s] 93%|█████████████████████████████████████████████████████████████████████████████▍     | 9088/9741 [00:17<00:01, 556.15it/s] 94%|█████████████████████████████████████████████████████████████████████████████▉     | 9144/9741 [00:17<00:01, 556.38it/s] 94%|██████████████████████████████████████████████████████████████████████████████▍    | 9200/9741 [00:17<00:00, 556.97it/s] 95%|██████████████████████████████████████████████████████████████████████████████▊    | 9256/9741 [00:17<00:00, 555.28it/s] 96%|███████████████████████████████████████████████████████████████████████████████▎   | 9313/9741 [00:17<00:00, 556.72it/s] 96%|███████████████████████████████████████████████████████████████████████████████▊   | 9369/9741 [00:17<00:00, 557.00it/s] 97%|████████████████████████████████████████████████████████████████████████████████▎  | 9425/9741 [00:17<00:00, 557.31it/s] 97%|████████████████████████████████████████████████████████████████████████████████▊  | 9481/9741 [00:17<00:00, 554.72it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▎ | 9537/9741 [00:17<00:00, 553.55it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▋ | 9593/9741 [00:18<00:00, 553.06it/s] 99%|██████████████████████████████████████████████████████████████████████████████████▏| 9649/9741 [00:18<00:00, 553.66it/s]100%|██████████████████████████████████████████████████████████████████████████████████▋| 9705/9741 [00:18<00:00, 552.31it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:18<00:00, 533.21it/s]
Load End
Num instances: 1000
[2023-08-21 21:04:41,615] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 21:04:45,771] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 21:04:45,771] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f6e28e55a60>
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 21:04:45,772] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f6e28e55940>
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 21:04:45,773] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 21:04:45,773] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4559798240661621 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Time to load utils op: 0.3045485019683838 seconds
Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
So the final answer is 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
So the final answer is 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: Max finished history in 20 * 2 = <<20*2=40>>40 minutes.
Finishing geography took the most time, which is 40 * 3 = <<40*3=120>>120 minutes.
In total, for all three subjects, Max needed 20 + 40 + 120 = <<20+40+120=180>>180 minutes.
So the final answer is 180

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o6-tgsm8k-s1-rTrue
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:38<31:33, 38.64s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:15<30:07, 37.66s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [01:52<29:19, 37.43s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [02:29<28:27, 37.12s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [03:06<27:57, 37.29s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [03:44<27:22, 37.32s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [04:21<26:35, 37.10s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [04:57<25:55, 37.03s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [05:34<25:14, 36.93s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [06:11<24:31, 36.79s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [06:47<23:52, 36.74s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [07:24<23:22, 36.90s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [08:02<22:51, 37.08s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [08:41<22:31, 37.55s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [09:18<21:55, 37.60s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [09:56<21:17, 37.58s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [10:33<20:31, 37.30s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [11:10<19:52, 37.26s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [11:47<19:13, 37.21s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [12:24<18:36, 37.20s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [13:02<18:04, 37.40s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [13:39<17:25, 37.34s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [14:16<16:44, 37.21s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [14:54<16:11, 37.37s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [15:32<15:38, 37.52s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [16:09<14:57, 37.41s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [16:46<14:20, 37.42s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [17:23<13:38, 37.22s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [18:00<12:59, 37.10s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [18:37<12:23, 37.15s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [19:14<11:43, 37.03s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [19:51<11:05, 36.97s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [20:28<10:30, 37.10s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [21:05<09:52, 37.06s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [21:42<09:14, 36.93s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [22:19<08:40, 37.20s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [22:56<08:01, 37.02s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [23:33<07:23, 36.93s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [24:09<06:45, 36.88s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [24:46<06:08, 36.82s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [25:23<05:30, 36.76s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [25:59<04:53, 36.67s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [26:36<04:17, 36.80s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [27:13<03:41, 36.89s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [27:50<03:03, 36.77s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [28:27<02:27, 36.83s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [29:03<01:50, 36.71s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [29:40<01:13, 36.76s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [30:17<00:36, 36.87s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [30:54<00:00, 36.78s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [30:54<00:00, 37.09s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.1491} | avg. gen lenth: 458.894
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 7
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-21 21:35:50,470] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 7
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o7-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                    | 34/9741 [00:00<00:29, 333.27it/s]  1%|▌                                                                                    | 69/9741 [00:00<00:28, 337.60it/s]  1%|▉                                                                                   | 104/9741 [00:00<00:28, 339.25it/s]  1%|█▏                                                                                  | 139/9741 [00:00<00:28, 340.24it/s]  2%|█▌                                                                                  | 174/9741 [00:00<00:28, 339.59it/s]  2%|█▊                                                                                  | 209/9741 [00:00<00:28, 340.05it/s]  3%|██                                                                                  | 244/9741 [00:00<00:27, 340.80it/s]  3%|██▍                                                                                 | 279/9741 [00:00<00:28, 335.04it/s]  3%|██▋                                                                                 | 314/9741 [00:00<00:27, 337.53it/s]  4%|███                                                                                 | 349/9741 [00:01<00:27, 340.21it/s]  4%|███▎                                                                                | 384/9741 [00:01<00:27, 341.89it/s]  4%|███▌                                                                                | 419/9741 [00:01<00:27, 341.56it/s]  5%|███▉                                                                                | 454/9741 [00:01<00:27, 343.54it/s]  5%|████▏                                                                               | 489/9741 [00:01<00:26, 345.11it/s]  5%|████▌                                                                               | 524/9741 [00:01<00:26, 345.96it/s]  6%|████▊                                                                               | 559/9741 [00:01<00:26, 346.27it/s]  6%|█████                                                                               | 594/9741 [00:01<00:26, 346.23it/s]  6%|█████▍                                                                              | 629/9741 [00:01<00:26, 341.37it/s]  7%|█████▋                                                                              | 664/9741 [00:01<00:26, 342.45it/s]  7%|██████                                                                              | 699/9741 [00:02<00:26, 343.50it/s]  8%|██████▎                                                                             | 734/9741 [00:02<00:26, 343.72it/s]  8%|██████▊                                                                             | 785/9741 [00:02<00:22, 390.88it/s]  9%|███████▏                                                                            | 837/9741 [00:02<00:20, 428.49it/s]  9%|███████▋                                                                            | 889/9741 [00:02<00:19, 453.34it/s] 10%|████████                                                                            | 941/9741 [00:02<00:18, 472.84it/s] 10%|████████▌                                                                           | 991/9741 [00:02<00:18, 479.52it/s] 11%|████████▉                                                                          | 1043/9741 [00:02<00:17, 491.23it/s] 11%|█████████▎                                                                         | 1095/9741 [00:02<00:17, 498.16it/s] 12%|█████████▊                                                                         | 1148/9741 [00:02<00:17, 504.91it/s] 12%|██████████▏                                                                        | 1199/9741 [00:03<00:16, 504.10it/s] 13%|██████████▋                                                                        | 1251/9741 [00:03<00:16, 507.29it/s] 13%|███████████                                                                        | 1303/9741 [00:03<00:16, 510.41it/s] 14%|███████████▌                                                                       | 1355/9741 [00:03<00:16, 509.13it/s] 14%|███████████▉                                                                       | 1407/9741 [00:03<00:16, 510.66it/s] 15%|████████████▍                                                                      | 1459/9741 [00:03<00:16, 511.38it/s] 16%|████████████▊                                                                      | 1511/9741 [00:03<00:16, 511.85it/s] 16%|█████████████▎                                                                     | 1563/9741 [00:03<00:16, 509.95it/s] 17%|█████████████▊                                                                     | 1615/9741 [00:03<00:15, 510.18it/s] 17%|██████████████▏                                                                    | 1667/9741 [00:03<00:15, 511.17it/s] 18%|██████████████▋                                                                    | 1719/9741 [00:04<00:15, 511.78it/s] 18%|███████████████                                                                    | 1771/9741 [00:04<00:16, 486.28it/s] 19%|███████████████▌                                                                   | 1823/9741 [00:04<00:16, 493.88it/s] 19%|███████████████▉                                                                   | 1874/9741 [00:04<00:15, 498.26it/s] 20%|████████████████▍                                                                  | 1926/9741 [00:04<00:15, 502.83it/s] 20%|████████████████▊                                                                  | 1978/9741 [00:04<00:15, 505.86it/s] 21%|█████████████████▎                                                                 | 2029/9741 [00:04<00:15, 506.00it/s] 21%|█████████████████▋                                                                 | 2080/9741 [00:04<00:15, 506.52it/s] 22%|██████████████████▏                                                                | 2131/9741 [00:04<00:15, 507.22it/s] 22%|██████████████████▌                                                                | 2183/9741 [00:04<00:14, 508.44it/s] 23%|███████████████████                                                                | 2234/9741 [00:05<00:14, 505.69it/s] 23%|███████████████████▍                                                               | 2285/9741 [00:05<00:14, 505.88it/s] 24%|███████████████████▉                                                               | 2336/9741 [00:05<00:14, 505.21it/s] 25%|████████████████████▎                                                              | 2387/9741 [00:05<00:14, 502.88it/s] 25%|████████████████████▊                                                              | 2438/9741 [00:05<00:14, 504.47it/s] 26%|█████████████████████▏                                                             | 2489/9741 [00:05<00:14, 503.40it/s] 26%|█████████████████████▋                                                             | 2540/9741 [00:05<00:14, 504.27it/s] 27%|██████████████████████                                                             | 2591/9741 [00:05<00:14, 502.80it/s] 27%|██████████████████████▌                                                            | 2642/9741 [00:05<00:14, 502.52it/s] 28%|██████████████████████▉                                                            | 2693/9741 [00:06<00:14, 499.91it/s] 28%|███████████████████████▎                                                           | 2743/9741 [00:06<00:14, 493.82it/s] 29%|███████████████████████▊                                                           | 2794/9741 [00:06<00:14, 496.08it/s] 29%|████████████████████████▏                                                          | 2845/9741 [00:06<00:13, 497.98it/s] 30%|████████████████████████▋                                                          | 2895/9741 [00:06<00:13, 497.35it/s] 30%|█████████████████████████                                                          | 2946/9741 [00:06<00:13, 498.48it/s] 31%|█████████████████████████▌                                                         | 2997/9741 [00:06<00:13, 499.79it/s] 31%|█████████████████████████▉                                                         | 3047/9741 [00:06<00:13, 499.33it/s] 32%|██████████████████████████▍                                                        | 3098/9741 [00:06<00:13, 499.69it/s] 32%|██████████████████████████▊                                                        | 3148/9741 [00:06<00:13, 497.41it/s] 33%|███████████████████████████▎                                                       | 3199/9741 [00:07<00:13, 498.73it/s] 33%|███████████████████████████▋                                                       | 3250/9741 [00:07<00:12, 499.46it/s] 34%|████████████████████████████                                                       | 3300/9741 [00:07<00:12, 498.98it/s] 34%|████████████████████████████▌                                                      | 3350/9741 [00:07<00:12, 496.31it/s] 35%|████████████████████████████▉                                                      | 3400/9741 [00:07<00:12, 496.02it/s] 35%|█████████████████████████████▍                                                     | 3450/9741 [00:07<00:12, 495.15it/s] 36%|█████████████████████████████▊                                                     | 3500/9741 [00:07<00:12, 494.88it/s] 36%|██████████████████████████████▏                                                    | 3550/9741 [00:07<00:12, 495.25it/s] 37%|██████████████████████████████▋                                                    | 3600/9741 [00:07<00:12, 489.13it/s] 37%|███████████████████████████████                                                    | 3650/9741 [00:07<00:12, 491.82it/s] 38%|███████████████████████████████▌                                                   | 3700/9741 [00:08<00:12, 492.57it/s] 38%|███████████████████████████████▉                                                   | 3750/9741 [00:08<00:12, 493.52it/s] 39%|████████████████████████████████▍                                                  | 3800/9741 [00:08<00:12, 494.37it/s] 40%|████████████████████████████████▊                                                  | 3850/9741 [00:08<00:11, 493.49it/s] 40%|█████████████████████████████████▏                                                 | 3900/9741 [00:08<00:11, 494.74it/s] 41%|█████████████████████████████████▋                                                 | 3950/9741 [00:08<00:11, 495.29it/s] 41%|██████████████████████████████████                                                 | 4000/9741 [00:08<00:11, 495.54it/s] 42%|██████████████████████████████████▌                                                | 4050/9741 [00:08<00:11, 493.52it/s] 42%|██████████████████████████████████▉                                                | 4100/9741 [00:08<00:11, 494.04it/s] 43%|███████████████████████████████████▎                                               | 4150/9741 [00:08<00:11, 493.93it/s] 43%|███████████████████████████████████▊                                               | 4200/9741 [00:09<00:11, 493.07it/s] 44%|████████████████████████████████████▏                                              | 4250/9741 [00:09<00:11, 493.84it/s] 44%|████████████████████████████████████▋                                              | 4300/9741 [00:09<00:11, 492.13it/s] 45%|█████████████████████████████████████                                              | 4350/9741 [00:09<00:10, 492.90it/s] 45%|█████████████████████████████████████▍                                             | 4400/9741 [00:09<00:10, 493.51it/s] 46%|█████████████████████████████████████▉                                             | 4450/9741 [00:09<00:10, 493.43it/s] 46%|██████████████████████████████████████▎                                            | 4500/9741 [00:09<00:11, 461.77it/s] 47%|██████████████████████████████████████▊                                            | 4550/9741 [00:09<00:11, 470.49it/s] 47%|███████████████████████████████████████▏                                           | 4599/9741 [00:09<00:10, 476.08it/s] 48%|███████████████████████████████████████▌                                           | 4649/9741 [00:09<00:10, 481.14it/s] 48%|████████████████████████████████████████                                           | 4698/9741 [00:10<00:10, 483.69it/s] 49%|████████████████████████████████████████▍                                          | 4747/9741 [00:10<00:14, 348.72it/s] 49%|████████████████████████████████████████▊                                          | 4796/9741 [00:10<00:12, 381.03it/s] 50%|█████████████████████████████████████████▎                                         | 4845/9741 [00:10<00:12, 407.17it/s] 50%|█████████████████████████████████████████▋                                         | 4894/9741 [00:10<00:11, 428.08it/s] 51%|██████████████████████████████████████████                                         | 4943/9741 [00:10<00:10, 443.09it/s] 51%|██████████████████████████████████████████▌                                        | 4992/9741 [00:10<00:10, 455.32it/s] 52%|██████████████████████████████████████████▉                                        | 5041/9741 [00:10<00:10, 464.25it/s] 52%|███████████████████████████████████████████▎                                       | 5090/9741 [00:11<00:09, 470.94it/s] 53%|███████████████████████████████████████████▊                                       | 5139/9741 [00:11<00:09, 473.83it/s] 53%|████████████████████████████████████████████▏                                      | 5188/9741 [00:11<00:09, 477.79it/s] 54%|████████████████████████████████████████████▌                                      | 5237/9741 [00:11<00:09, 479.49it/s] 54%|█████████████████████████████████████████████                                      | 5286/9741 [00:11<00:09, 480.82it/s] 55%|█████████████████████████████████████████████▍                                     | 5335/9741 [00:11<00:09, 483.29it/s] 55%|█████████████████████████████████████████████▉                                     | 5384/9741 [00:11<00:09, 483.20it/s] 56%|██████████████████████████████████████████████▎                                    | 5433/9741 [00:11<00:08, 484.14it/s] 56%|██████████████████████████████████████████████▋                                    | 5482/9741 [00:11<00:08, 484.49it/s] 57%|███████████████████████████████████████████████▏                                   | 5532/9741 [00:11<00:08, 486.37it/s] 57%|███████████████████████████████████████████████▌                                   | 5581/9741 [00:12<00:08, 487.41it/s] 58%|███████████████████████████████████████████████▉                                   | 5630/9741 [00:12<00:08, 486.10it/s] 58%|████████████████████████████████████████████████▍                                  | 5679/9741 [00:12<00:08, 479.54it/s] 59%|████████████████████████████████████████████████▊                                  | 5727/9741 [00:12<00:08, 471.73it/s] 59%|█████████████████████████████████████████████████▏                                 | 5775/9741 [00:12<00:08, 468.89it/s] 60%|█████████████████████████████████████████████████▌                                 | 5824/9741 [00:12<00:08, 473.38it/s] 60%|██████████████████████████████████████████████████                                 | 5874/9741 [00:12<00:08, 478.86it/s] 61%|██████████████████████████████████████████████████▍                                | 5924/9741 [00:12<00:07, 482.68it/s] 61%|██████████████████████████████████████████████████▉                                | 5974/9741 [00:12<00:07, 486.64it/s] 62%|███████████████████████████████████████████████████▎                               | 6024/9741 [00:12<00:07, 487.82it/s] 62%|███████████████████████████████████████████████████▋                               | 6073/9741 [00:13<00:07, 485.73it/s] 63%|████████████████████████████████████████████████████▏                              | 6123/9741 [00:13<00:07, 488.16it/s] 63%|████████████████████████████████████████████████████▌                              | 6173/9741 [00:13<00:07, 489.69it/s] 64%|█████████████████████████████████████████████████████                              | 6223/9741 [00:13<00:07, 490.54it/s] 64%|█████████████████████████████████████████████████████▍                             | 6273/9741 [00:13<00:07, 489.00it/s] 65%|█████████████████████████████████████████████████████▊                             | 6322/9741 [00:13<00:07, 471.52it/s] 65%|██████████████████████████████████████████████████████▎                            | 6372/9741 [00:13<00:07, 477.36it/s] 66%|██████████████████████████████████████████████████████▋                            | 6422/9741 [00:13<00:06, 482.09it/s] 66%|███████████████████████████████████████████████████████▏                           | 6472/9741 [00:13<00:06, 484.66it/s] 67%|███████████████████████████████████████████████████████▌                           | 6521/9741 [00:13<00:06, 485.18it/s] 67%|███████████████████████████████████████████████████████▉                           | 6571/9741 [00:14<00:06, 487.02it/s] 68%|████████████████████████████████████████████████████████▍                          | 6621/9741 [00:14<00:06, 488.58it/s] 68%|████████████████████████████████████████████████████████▊                          | 6670/9741 [00:14<00:06, 488.77it/s] 69%|█████████████████████████████████████████████████████████▎                         | 6719/9741 [00:14<00:06, 482.68it/s] 69%|█████████████████████████████████████████████████████████▋                         | 6768/9741 [00:14<00:06, 480.82it/s] 70%|██████████████████████████████████████████████████████████                         | 6817/9741 [00:14<00:06, 483.10it/s] 70%|██████████████████████████████████████████████████████████▌                        | 6866/9741 [00:14<00:05, 484.76it/s] 71%|██████████████████████████████████████████████████████████▉                        | 6915/9741 [00:14<00:05, 486.08it/s] 71%|███████████████████████████████████████████████████████████▎                       | 6964/9741 [00:14<00:05, 485.37it/s] 72%|███████████████████████████████████████████████████████████▊                       | 7013/9741 [00:15<00:05, 486.22it/s] 73%|████████████████████████████████████████████████████████████▏                      | 7063/9741 [00:15<00:05, 487.39it/s] 73%|████████████████████████████████████████████████████████████▌                      | 7112/9741 [00:15<00:05, 487.95it/s] 74%|█████████████████████████████████████████████████████████████                      | 7162/9741 [00:15<00:05, 488.64it/s] 74%|█████████████████████████████████████████████████████████████▍                     | 7211/9741 [00:15<00:05, 486.87it/s] 75%|█████████████████████████████████████████████████████████████▊                     | 7260/9741 [00:15<00:05, 487.59it/s] 75%|██████████████████████████████████████████████████████████████▎                    | 7309/9741 [00:15<00:04, 487.67it/s] 76%|██████████████████████████████████████████████████████████████▋                    | 7358/9741 [00:15<00:04, 487.63it/s] 76%|███████████████████████████████████████████████████████████████                    | 7407/9741 [00:15<00:04, 487.01it/s] 77%|███████████████████████████████████████████████████████████████▌                   | 7456/9741 [00:15<00:05, 447.20it/s] 77%|███████████████████████████████████████████████████████████████▉                   | 7505/9741 [00:16<00:04, 458.42it/s] 78%|████████████████████████████████████████████████████████████████▎                  | 7554/9741 [00:16<00:04, 467.07it/s] 78%|████████████████████████████████████████████████████████████████▊                  | 7604/9741 [00:16<00:04, 473.90it/s] 79%|█████████████████████████████████████████████████████████████████▏                 | 7653/9741 [00:16<00:04, 476.51it/s] 79%|█████████████████████████████████████████████████████████████████▋                 | 7702/9741 [00:16<00:04, 480.23it/s] 80%|██████████████████████████████████████████████████████████████████                 | 7752/9741 [00:16<00:04, 483.68it/s] 80%|██████████████████████████████████████████████████████████████████▍                | 7801/9741 [00:16<00:04, 483.68it/s] 81%|██████████████████████████████████████████████████████████████████▉                | 7850/9741 [00:16<00:03, 484.16it/s] 81%|███████████████████████████████████████████████████████████████████▎               | 7899/9741 [00:16<00:03, 483.61it/s] 82%|███████████████████████████████████████████████████████████████████▋               | 7948/9741 [00:16<00:03, 485.27it/s] 82%|████████████████████████████████████████████████████████████████████▏              | 7997/9741 [00:17<00:03, 486.49it/s] 83%|████████████████████████████████████████████████████████████████████▌              | 8047/9741 [00:17<00:03, 487.58it/s] 83%|████████████████████████████████████████████████████████████████████▉              | 8096/9741 [00:17<00:03, 486.71it/s] 84%|█████████████████████████████████████████████████████████████████████▍             | 8146/9741 [00:17<00:03, 487.73it/s] 84%|█████████████████████████████████████████████████████████████████████▊             | 8196/9741 [00:17<00:03, 488.85it/s] 85%|██████████████████████████████████████████████████████████████████████▎            | 8245/9741 [00:17<00:03, 488.85it/s] 85%|██████████████████████████████████████████████████████████████████████▋            | 8294/9741 [00:17<00:02, 487.78it/s] 86%|███████████████████████████████████████████████████████████████████████            | 8343/9741 [00:17<00:02, 485.54it/s] 86%|███████████████████████████████████████████████████████████████████████▌           | 8392/9741 [00:17<00:02, 485.49it/s] 87%|███████████████████████████████████████████████████████████████████████▉           | 8441/9741 [00:17<00:02, 486.01it/s] 87%|████████████████████████████████████████████████████████████████████████▎          | 8490/9741 [00:18<00:02, 487.11it/s] 88%|████████████████████████████████████████████████████████████████████████▊          | 8540/9741 [00:18<00:02, 488.20it/s] 88%|█████████████████████████████████████████████████████████████████████████▏         | 8589/9741 [00:18<00:02, 486.56it/s] 89%|█████████████████████████████████████████████████████████████████████████▌         | 8638/9741 [00:18<00:02, 487.21it/s] 89%|██████████████████████████████████████████████████████████████████████████         | 8687/9741 [00:18<00:02, 487.97it/s] 90%|██████████████████████████████████████████████████████████████████████████▍        | 8737/9741 [00:18<00:02, 488.59it/s] 90%|██████████████████████████████████████████████████████████████████████████▊        | 8786/9741 [00:18<00:01, 484.67it/s] 91%|███████████████████████████████████████████████████████████████████████████▎       | 8835/9741 [00:18<00:01, 485.80it/s] 91%|███████████████████████████████████████████████████████████████████████████▋       | 8884/9741 [00:18<00:01, 486.99it/s] 92%|████████████████████████████████████████████████████████████████████████████       | 8933/9741 [00:18<00:01, 484.36it/s] 92%|████████████████████████████████████████████████████████████████████████████▌      | 8983/9741 [00:19<00:01, 486.22it/s] 93%|████████████████████████████████████████████████████████████████████████████▉      | 9032/9741 [00:19<00:01, 486.13it/s] 93%|█████████████████████████████████████████████████████████████████████████████▍     | 9082/9741 [00:19<00:01, 488.33it/s] 94%|█████████████████████████████████████████████████████████████████████████████▊     | 9132/9741 [00:19<00:01, 489.29it/s] 94%|██████████████████████████████████████████████████████████████████████████████▏    | 9181/9741 [00:19<00:01, 484.02it/s] 95%|██████████████████████████████████████████████████████████████████████████████▋    | 9230/9741 [00:19<00:01, 482.91it/s] 95%|███████████████████████████████████████████████████████████████████████████████    | 9279/9741 [00:19<00:00, 484.69it/s] 96%|███████████████████████████████████████████████████████████████████████████████▍   | 9328/9741 [00:19<00:00, 485.62it/s] 96%|███████████████████████████████████████████████████████████████████████████████▉   | 9377/9741 [00:19<00:00, 486.16it/s] 97%|████████████████████████████████████████████████████████████████████████████████▎  | 9426/9741 [00:19<00:00, 486.78it/s] 97%|████████████████████████████████████████████████████████████████████████████████▋  | 9475/9741 [00:20<00:00, 484.47it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▏ | 9524/9741 [00:20<00:00, 484.45it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▌ | 9573/9741 [00:20<00:00, 484.39it/s] 99%|█████████████████████████████████████████████████████████████████████████████████▉ | 9622/9741 [00:20<00:00, 484.41it/s] 99%|██████████████████████████████████████████████████████████████████████████████████▍| 9671/9741 [00:20<00:00, 484.36it/s]100%|██████████████████████████████████████████████████████████████████████████████████▊| 9720/9741 [00:20<00:00, 482.04it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:20<00:00, 471.82it/s]
Load End
Num instances: 1000
[2023-08-21 21:36:22,327] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 21:36:25,130] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 21:36:25,131] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f81cf70aa60>
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 21:36:25,131] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f81cf70a940>
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 21:36:25,132] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 21:36:25,132] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.45428466796875 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
So the final answer is 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
So the final answer is 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: Max finished history in 20 * 2 = <<20*2=40>>40 minutes.
Finishing geography took the most time, which is 40 * 3 = <<40*3=120>>120 minutes.
In total, for all three subjects, Max needed 20 + 40 + 120 = <<20+40+120=180>>180 minutes.
So the final answer is 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: If Sophia ate 1/6 of the pie, then 6/6 - 1/6 = 5/6 is left in the fridge.
Let x be the pie's original weight.
The current weight of the pie can be described by 5x/6=1200 grams
So, 5x=7200.
And, the original weight is x = <<1440=1440>>1440 grams.
So, Sophia ate 1440 grams original - 1200 grams after= <<1440-1200=240>>240 grams of pie.
So the final answer is 240

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o7-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.5050289630889893 seconds
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:35<28:51, 35.33s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:10<28:11, 35.23s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [01:45<27:34, 35.20s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [02:20<26:57, 35.16s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [02:55<26:13, 34.96s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [03:30<25:40, 35.01s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [04:05<25:04, 34.99s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [04:40<24:29, 34.99s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [05:15<23:55, 35.02s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [05:50<23:21, 35.04s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [06:25<22:48, 35.09s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [07:00<22:08, 34.95s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [07:35<21:33, 34.96s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [08:10<21:02, 35.06s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [08:45<20:22, 34.94s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [09:20<19:51, 35.04s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [09:55<19:10, 34.87s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [10:30<18:36, 34.88s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [11:04<18:01, 34.90s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [11:40<17:28, 34.95s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [12:14<16:53, 34.94s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [12:49<16:17, 34.92s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [13:24<15:41, 34.87s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [13:59<15:09, 34.99s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [14:34<14:33, 34.92s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [15:10<14:02, 35.09s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [15:45<13:26, 35.07s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [16:19<12:49, 34.98s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [16:54<12:15, 35.02s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [17:29<11:37, 34.89s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [18:04<11:02, 34.87s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [18:39<10:27, 34.85s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [19:14<09:54, 34.98s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [19:49<09:19, 34.95s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [20:24<08:44, 34.96s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [20:59<08:08, 34.89s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [21:33<07:33, 34.85s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [22:09<07:00, 35.00s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [22:44<06:24, 34.96s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [23:20<05:52, 35.27s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [23:55<05:16, 35.20s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [24:29<04:39, 34.97s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [25:04<04:05, 35.04s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [25:39<03:29, 34.91s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [26:14<02:54, 34.93s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [26:50<02:21, 35.26s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [27:24<01:45, 35.06s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [27:59<01:10, 35.02s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [28:34<00:34, 35.00s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [29:09<00:00, 34.89s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [29:09<00:00, 34.99s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.1376} | avg. gen lenth: 449.17
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 8
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-21 22:05:48,458] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 8
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o8-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                    | 31/9741 [00:00<00:32, 303.39it/s]  1%|▌                                                                                    | 62/9741 [00:00<00:31, 307.17it/s]  1%|▊                                                                                    | 94/9741 [00:00<00:31, 309.47it/s]  1%|█                                                                                   | 126/9741 [00:00<00:30, 310.81it/s]  2%|█▎                                                                                  | 158/9741 [00:00<00:30, 311.47it/s]  2%|█▋                                                                                  | 190/9741 [00:00<00:30, 310.46it/s]  2%|█▉                                                                                  | 222/9741 [00:00<00:30, 312.04it/s]  3%|██▏                                                                                 | 254/9741 [00:00<00:30, 306.51it/s]  3%|██▍                                                                                 | 286/9741 [00:00<00:30, 307.88it/s]  3%|██▋                                                                                 | 318/9741 [00:01<00:30, 308.78it/s]  4%|███                                                                                 | 350/9741 [00:01<00:30, 309.61it/s]  4%|███▎                                                                                | 382/9741 [00:01<00:30, 310.07it/s]  4%|███▌                                                                                | 414/9741 [00:01<00:30, 308.48it/s]  5%|███▊                                                                                | 446/9741 [00:01<00:30, 309.12it/s]  5%|████                                                                                | 478/9741 [00:01<00:29, 310.22it/s]  5%|████▍                                                                               | 510/9741 [00:01<00:29, 311.17it/s]  6%|████▋                                                                               | 542/9741 [00:01<00:29, 309.44it/s]  6%|████▉                                                                               | 574/9741 [00:01<00:29, 309.91it/s]  6%|█████▏                                                                              | 606/9741 [00:01<00:29, 310.56it/s]  7%|█████▌                                                                              | 638/9741 [00:02<00:29, 308.06it/s]  7%|█████▊                                                                              | 669/9741 [00:02<00:30, 302.24it/s]  7%|██████                                                                              | 700/9741 [00:02<00:29, 304.14it/s]  8%|██████▎                                                                             | 732/9741 [00:02<00:29, 305.83it/s]  8%|██████▌                                                                             | 763/9741 [00:02<00:29, 302.06it/s]  8%|██████▊                                                                             | 794/9741 [00:02<00:29, 302.33it/s]  9%|███████▏                                                                            | 832/9741 [00:02<00:27, 324.24it/s]  9%|███████▌                                                                            | 878/9741 [00:02<00:24, 362.85it/s]  9%|███████▉                                                                            | 925/9741 [00:02<00:22, 392.12it/s] 10%|████████▍                                                                           | 972/9741 [00:02<00:21, 412.75it/s] 10%|████████▋                                                                          | 1019/9741 [00:03<00:20, 426.98it/s] 11%|█████████                                                                          | 1065/9741 [00:03<00:19, 436.59it/s] 11%|█████████▍                                                                         | 1111/9741 [00:03<00:19, 441.59it/s] 12%|█████████▊                                                                         | 1158/9741 [00:03<00:19, 447.69it/s] 12%|██████████▎                                                                        | 1205/9741 [00:03<00:18, 452.46it/s] 13%|██████████▋                                                                        | 1252/9741 [00:03<00:18, 455.54it/s] 13%|███████████                                                                        | 1298/9741 [00:03<00:18, 456.74it/s] 14%|███████████▍                                                                       | 1344/9741 [00:03<00:18, 454.63it/s] 14%|███████████▊                                                                       | 1390/9741 [00:03<00:18, 454.54it/s] 15%|████████████▏                                                                      | 1436/9741 [00:04<00:18, 455.53it/s] 15%|████████████▋                                                                      | 1482/9741 [00:04<00:18, 456.25it/s] 16%|█████████████                                                                      | 1528/9741 [00:04<00:18, 456.01it/s] 16%|█████████████▍                                                                     | 1574/9741 [00:04<00:17, 454.04it/s] 17%|█████████████▊                                                                     | 1620/9741 [00:04<00:17, 453.23it/s] 17%|██████████████▏                                                                    | 1666/9741 [00:04<00:17, 454.02it/s] 18%|██████████████▌                                                                    | 1712/9741 [00:04<00:17, 451.67it/s] 18%|██████████████▉                                                                    | 1758/9741 [00:04<00:17, 452.12it/s] 19%|███████████████▎                                                                   | 1804/9741 [00:04<00:18, 433.76it/s] 19%|███████████████▊                                                                   | 1850/9741 [00:04<00:17, 438.74it/s] 19%|████████████████▏                                                                  | 1895/9741 [00:05<00:17, 439.19it/s] 20%|████████████████▌                                                                  | 1940/9741 [00:05<00:17, 441.65it/s] 20%|████████████████▉                                                                  | 1986/9741 [00:05<00:17, 443.01it/s] 21%|█████████████████▎                                                                 | 2032/9741 [00:05<00:17, 446.20it/s] 21%|█████████████████▋                                                                 | 2078/9741 [00:05<00:17, 448.53it/s] 22%|██████████████████                                                                 | 2123/9741 [00:05<00:16, 448.87it/s] 22%|██████████████████▍                                                                | 2169/9741 [00:05<00:16, 450.47it/s] 23%|██████████████████▊                                                                | 2215/9741 [00:05<00:17, 440.92it/s] 23%|███████████████████▎                                                               | 2261/9741 [00:05<00:16, 444.05it/s] 24%|███████████████████▋                                                               | 2306/9741 [00:05<00:16, 445.72it/s] 24%|████████████████████                                                               | 2351/9741 [00:06<00:16, 446.24it/s] 25%|████████████████████▍                                                              | 2396/9741 [00:06<00:16, 447.05it/s] 25%|████████████████████▊                                                              | 2441/9741 [00:06<00:16, 440.18it/s] 26%|█████████████████████▏                                                             | 2486/9741 [00:06<00:16, 441.56it/s] 26%|█████████████████████▌                                                             | 2531/9741 [00:06<00:16, 443.90it/s] 26%|█████████████████████▉                                                             | 2577/9741 [00:06<00:16, 445.81it/s] 27%|██████████████████████▎                                                            | 2623/9741 [00:06<00:15, 447.59it/s] 27%|██████████████████████▋                                                            | 2668/9741 [00:06<00:15, 445.92it/s] 28%|███████████████████████                                                            | 2713/9741 [00:06<00:15, 446.21it/s] 28%|███████████████████████▌                                                           | 2758/9741 [00:06<00:15, 444.08it/s] 29%|███████████████████████▉                                                           | 2803/9741 [00:07<00:15, 443.46it/s] 29%|████████████████████████▎                                                          | 2848/9741 [00:07<00:15, 443.57it/s] 30%|████████████████████████▋                                                          | 2893/9741 [00:07<00:15, 444.02it/s] 30%|█████████████████████████                                                          | 2938/9741 [00:07<00:15, 437.08it/s] 31%|█████████████████████████▍                                                         | 2983/9741 [00:07<00:15, 439.34it/s] 31%|█████████████████████████▊                                                         | 3027/9741 [00:07<00:15, 434.78it/s] 32%|██████████████████████████▏                                                        | 3072/9741 [00:07<00:15, 437.32it/s] 32%|██████████████████████████▌                                                        | 3117/9741 [00:07<00:15, 439.72it/s] 32%|██████████████████████████▉                                                        | 3161/9741 [00:07<00:14, 438.83it/s] 33%|███████████████████████████▎                                                       | 3206/9741 [00:07<00:14, 440.97it/s] 33%|███████████████████████████▋                                                       | 3251/9741 [00:08<00:14, 442.30it/s] 34%|████████████████████████████                                                       | 3296/9741 [00:08<00:14, 441.98it/s] 34%|████████████████████████████▍                                                      | 3341/9741 [00:08<00:14, 435.02it/s] 35%|████████████████████████████▊                                                      | 3385/9741 [00:08<00:14, 435.65it/s] 35%|█████████████████████████████▏                                                     | 3430/9741 [00:08<00:14, 438.32it/s] 36%|█████████████████████████████▌                                                     | 3474/9741 [00:08<00:14, 427.93it/s] 36%|█████████████████████████████▉                                                     | 3517/9741 [00:08<00:14, 425.94it/s] 37%|██████████████████████████████▎                                                    | 3562/9741 [00:08<00:14, 430.78it/s] 37%|██████████████████████████████▋                                                    | 3606/9741 [00:08<00:14, 431.90it/s] 37%|███████████████████████████████                                                    | 3651/9741 [00:09<00:13, 435.19it/s] 38%|███████████████████████████████▍                                                   | 3695/9741 [00:09<00:13, 436.60it/s] 38%|███████████████████████████████▊                                                   | 3739/9741 [00:09<00:13, 437.42it/s] 39%|████████████████████████████████▏                                                  | 3784/9741 [00:09<00:13, 438.24it/s] 39%|████████████████████████████████▌                                                  | 3828/9741 [00:09<00:13, 437.60it/s] 40%|████████████████████████████████▉                                                  | 3872/9741 [00:09<00:13, 438.03it/s] 40%|█████████████████████████████████▎                                                 | 3916/9741 [00:09<00:13, 436.96it/s] 41%|█████████████████████████████████▋                                                 | 3960/9741 [00:09<00:13, 428.71it/s] 41%|██████████████████████████████████                                                 | 4003/9741 [00:09<00:13, 427.05it/s] 42%|██████████████████████████████████▍                                                | 4046/9741 [00:09<00:13, 427.00it/s] 42%|██████████████████████████████████▊                                                | 4090/9741 [00:10<00:13, 429.87it/s] 42%|███████████████████████████████████▏                                               | 4134/9741 [00:10<00:12, 431.94it/s] 43%|███████████████████████████████████▌                                               | 4178/9741 [00:10<00:12, 433.51it/s] 43%|███████████████████████████████████▉                                               | 4222/9741 [00:10<00:12, 434.70it/s] 44%|████████████████████████████████████▎                                              | 4266/9741 [00:10<00:12, 434.02it/s] 44%|████████████████████████████████████▋                                              | 4311/9741 [00:10<00:12, 435.96it/s] 45%|█████████████████████████████████████                                              | 4355/9741 [00:10<00:12, 436.97it/s] 45%|█████████████████████████████████████▍                                             | 4399/9741 [00:10<00:12, 437.84it/s] 46%|█████████████████████████████████████▊                                             | 4443/9741 [00:10<00:12, 432.17it/s] 46%|██████████████████████████████████████▏                                            | 4487/9741 [00:10<00:13, 401.62it/s] 47%|██████████████████████████████████████▌                                            | 4531/9741 [00:11<00:12, 411.68it/s] 47%|██████████████████████████████████████▉                                            | 4576/9741 [00:11<00:12, 420.00it/s] 47%|███████████████████████████████████████▎                                           | 4619/9741 [00:11<00:12, 419.95it/s] 48%|███████████████████████████████████████▋                                           | 4663/9741 [00:11<00:11, 423.41it/s] 48%|████████████████████████████████████████                                           | 4707/9741 [00:11<00:11, 426.00it/s] 49%|████████████████████████████████████████▍                                          | 4750/9741 [00:11<00:14, 333.60it/s] 49%|████████████████████████████████████████▊                                          | 4794/9741 [00:11<00:13, 358.75it/s] 50%|█████████████████████████████████████████▏                                         | 4838/9741 [00:11<00:12, 378.70it/s] 50%|█████████████████████████████████████████▌                                         | 4880/9741 [00:11<00:12, 388.74it/s] 51%|█████████████████████████████████████████▉                                         | 4921/9741 [00:12<00:12, 393.10it/s] 51%|██████████████████████████████████████████▎                                        | 4965/9741 [00:12<00:11, 404.49it/s] 51%|██████████████████████████████████████████▋                                        | 5009/9741 [00:12<00:11, 412.81it/s] 52%|███████████████████████████████████████████                                        | 5053/9741 [00:12<00:11, 418.58it/s] 52%|███████████████████████████████████████████▍                                       | 5097/9741 [00:12<00:10, 423.29it/s] 53%|███████████████████████████████████████████▊                                       | 5141/9741 [00:12<00:10, 425.46it/s] 53%|████████████████████████████████████████████▏                                      | 5185/9741 [00:12<00:10, 429.01it/s] 54%|████████████████████████████████████████████▌                                      | 5229/9741 [00:12<00:10, 431.38it/s] 54%|████████████████████████████████████████████▉                                      | 5273/9741 [00:12<00:10, 427.86it/s] 55%|█████████████████████████████████████████████▎                                     | 5316/9741 [00:12<00:10, 426.54it/s] 55%|█████████████████████████████████████████████▋                                     | 5359/9741 [00:13<00:10, 421.68it/s] 55%|██████████████████████████████████████████████                                     | 5402/9741 [00:13<00:10, 423.19it/s] 56%|██████████████████████████████████████████████▍                                    | 5445/9741 [00:13<00:10, 420.63it/s] 56%|██████████████████████████████████████████████▊                                    | 5489/9741 [00:13<00:10, 423.93it/s] 57%|███████████████████████████████████████████████▏                                   | 5533/9741 [00:13<00:09, 426.67it/s] 57%|███████████████████████████████████████████████▌                                   | 5577/9741 [00:13<00:09, 428.69it/s] 58%|███████████████████████████████████████████████▉                                   | 5620/9741 [00:13<00:09, 427.57it/s] 58%|████████████████████████████████████████████████▎                                  | 5663/9741 [00:13<00:09, 422.64it/s] 59%|████████████████████████████████████████████████▌                                  | 5706/9741 [00:13<00:09, 419.63it/s] 59%|████████████████████████████████████████████████▉                                  | 5750/9741 [00:14<00:09, 423.53it/s] 59%|█████████████████████████████████████████████████▎                                 | 5794/9741 [00:14<00:09, 426.32it/s] 60%|█████████████████████████████████████████████████▋                                 | 5837/9741 [00:14<00:09, 425.55it/s] 60%|██████████████████████████████████████████████████                                 | 5881/9741 [00:14<00:09, 428.05it/s] 61%|██████████████████████████████████████████████████▍                                | 5925/9741 [00:14<00:08, 428.95it/s] 61%|██████████████████████████████████████████████████▊                                | 5968/9741 [00:14<00:08, 428.76it/s] 62%|███████████████████████████████████████████████████▏                               | 6011/9741 [00:14<00:08, 428.84it/s] 62%|███████████████████████████████████████████████████▌                               | 6054/9741 [00:14<00:08, 426.84it/s] 63%|███████████████████████████████████████████████████▉                               | 6097/9741 [00:14<00:08, 427.45it/s] 63%|████████████████████████████████████████████████████▎                              | 6140/9741 [00:14<00:08, 427.66it/s] 63%|████████████████████████████████████████████████████▋                              | 6183/9741 [00:15<00:08, 428.08it/s] 64%|█████████████████████████████████████████████████████                              | 6226/9741 [00:15<00:08, 427.84it/s] 64%|█████████████████████████████████████████████████████▍                             | 6269/9741 [00:15<00:08, 422.01it/s] 65%|█████████████████████████████████████████████████████▊                             | 6312/9741 [00:15<00:08, 418.96it/s] 65%|██████████████████████████████████████████████████████▏                            | 6355/9741 [00:15<00:08, 421.06it/s] 66%|██████████████████████████████████████████████████████▌                            | 6398/9741 [00:15<00:07, 423.51it/s] 66%|██████████████████████████████████████████████████████▉                            | 6441/9741 [00:15<00:07, 421.53it/s] 67%|███████████████████████████████████████████████████████▏                           | 6484/9741 [00:15<00:07, 422.40it/s] 67%|███████████████████████████████████████████████████████▌                           | 6527/9741 [00:15<00:07, 421.84it/s] 67%|███████████████████████████████████████████████████████▉                           | 6570/9741 [00:15<00:07, 424.17it/s] 68%|████████████████████████████████████████████████████████▎                          | 6613/9741 [00:16<00:07, 425.15it/s] 68%|████████████████████████████████████████████████████████▋                          | 6657/9741 [00:16<00:07, 426.90it/s] 69%|█████████████████████████████████████████████████████████                          | 6701/9741 [00:16<00:07, 428.75it/s] 69%|█████████████████████████████████████████████████████████▍                         | 6744/9741 [00:16<00:07, 424.79it/s] 70%|█████████████████████████████████████████████████████████▊                         | 6787/9741 [00:16<00:06, 424.43it/s] 70%|██████████████████████████████████████████████████████████▏                        | 6830/9741 [00:16<00:06, 420.41it/s] 71%|██████████████████████████████████████████████████████████▌                        | 6874/9741 [00:16<00:06, 423.85it/s] 71%|██████████████████████████████████████████████████████████▉                        | 6918/9741 [00:16<00:06, 425.91it/s] 71%|███████████████████████████████████████████████████████████▎                       | 6961/9741 [00:16<00:06, 426.02it/s] 72%|███████████████████████████████████████████████████████████▋                       | 7005/9741 [00:16<00:06, 428.22it/s] 72%|████████████████████████████████████████████████████████████                       | 7049/9741 [00:17<00:06, 429.88it/s] 73%|████████████████████████████████████████████████████████████▍                      | 7093/9741 [00:17<00:06, 430.65it/s] 73%|████████████████████████████████████████████████████████████▊                      | 7137/9741 [00:17<00:06, 431.36it/s] 74%|█████████████████████████████████████████████████████████████▏                     | 7181/9741 [00:17<00:06, 425.51it/s] 74%|█████████████████████████████████████████████████████████████▌                     | 7224/9741 [00:17<00:06, 418.87it/s] 75%|█████████████████████████████████████████████████████████████▉                     | 7267/9741 [00:17<00:05, 421.57it/s] 75%|██████████████████████████████████████████████████████████████▎                    | 7310/9741 [00:17<00:05, 423.49it/s] 75%|██████████████████████████████████████████████████████████████▋                    | 7354/9741 [00:17<00:05, 425.62it/s] 76%|███████████████████████████████████████████████████████████████                    | 7398/9741 [00:17<00:05, 427.09it/s] 76%|███████████████████████████████████████████████████████████████▍                   | 7441/9741 [00:18<00:05, 404.25it/s] 77%|███████████████████████████████████████████████████████████████▊                   | 7485/9741 [00:18<00:05, 412.46it/s] 77%|████████████████████████████████████████████████████████████████▏                  | 7527/9741 [00:18<00:05, 411.45it/s] 78%|████████████████████████████████████████████████████████████████▌                  | 7571/9741 [00:18<00:05, 417.57it/s] 78%|████████████████████████████████████████████████████████████████▉                  | 7615/9741 [00:18<00:05, 422.57it/s] 79%|█████████████████████████████████████████████████████████████████▎                 | 7658/9741 [00:18<00:04, 423.21it/s] 79%|█████████████████████████████████████████████████████████████████▋                 | 7702/9741 [00:18<00:04, 425.36it/s] 80%|██████████████████████████████████████████████████████████████████                 | 7746/9741 [00:18<00:04, 427.75it/s] 80%|██████████████████████████████████████████████████████████████████▍                | 7790/9741 [00:18<00:04, 428.90it/s] 80%|██████████████████████████████████████████████████████████████████▊                | 7834/9741 [00:18<00:04, 430.06it/s] 81%|███████████████████████████████████████████████████████████████████▏               | 7878/9741 [00:19<00:04, 428.56it/s] 81%|███████████████████████████████████████████████████████████████████▌               | 7922/9741 [00:19<00:04, 429.73it/s] 82%|███████████████████████████████████████████████████████████████████▊               | 7965/9741 [00:19<00:04, 413.43it/s] 82%|████████████████████████████████████████████████████████████████████▏              | 8008/9741 [00:19<00:04, 416.79it/s] 83%|████████████████████████████████████████████████████████████████████▌              | 8052/9741 [00:19<00:04, 421.60it/s] 83%|████████████████████████████████████████████████████████████████████▉              | 8095/9741 [00:19<00:03, 424.02it/s] 84%|█████████████████████████████████████████████████████████████████████▎             | 8139/9741 [00:19<00:03, 428.00it/s] 84%|█████████████████████████████████████████████████████████████████████▋             | 8183/9741 [00:19<00:03, 430.95it/s] 84%|██████████████████████████████████████████████████████████████████████             | 8227/9741 [00:19<00:03, 432.75it/s] 85%|██████████████████████████████████████████████████████████████████████▍            | 8271/9741 [00:19<00:03, 434.46it/s] 85%|██████████████████████████████████████████████████████████████████████▊            | 8315/9741 [00:20<00:03, 433.46it/s] 86%|███████████████████████████████████████████████████████████████████████▏           | 8359/9741 [00:20<00:03, 435.06it/s] 86%|███████████████████████████████████████████████████████████████████████▌           | 8403/9741 [00:20<00:03, 430.63it/s] 87%|███████████████████████████████████████████████████████████████████████▉           | 8447/9741 [00:20<00:03, 429.96it/s] 87%|████████████████████████████████████████████████████████████████████████▎          | 8491/9741 [00:20<00:02, 426.42it/s] 88%|████████████████████████████████████████████████████████████████████████▋          | 8535/9741 [00:20<00:02, 428.50it/s] 88%|█████████████████████████████████████████████████████████████████████████          | 8578/9741 [00:20<00:02, 427.33it/s] 89%|█████████████████████████████████████████████████████████████████████████▍         | 8622/9741 [00:20<00:02, 429.33it/s] 89%|█████████████████████████████████████████████████████████████████████████▊         | 8666/9741 [00:20<00:02, 431.08it/s] 89%|██████████████████████████████████████████████████████████████████████████▏        | 8710/9741 [00:20<00:02, 433.02it/s] 90%|██████████████████████████████████████████████████████████████████████████▌        | 8754/9741 [00:21<00:02, 434.16it/s] 90%|██████████████████████████████████████████████████████████████████████████▉        | 8798/9741 [00:21<00:02, 432.48it/s] 91%|███████████████████████████████████████████████████████████████████████████▎       | 8842/9741 [00:21<00:02, 433.15it/s] 91%|███████████████████████████████████████████████████████████████████████████▋       | 8886/9741 [00:21<00:01, 433.70it/s] 92%|████████████████████████████████████████████████████████████████████████████       | 8930/9741 [00:21<00:01, 434.45it/s] 92%|████████████████████████████████████████████████████████████████████████████▍      | 8974/9741 [00:21<00:01, 434.20it/s] 93%|████████████████████████████████████████████████████████████████████████████▊      | 9018/9741 [00:21<00:01, 432.43it/s] 93%|█████████████████████████████████████████████████████████████████████████████▏     | 9062/9741 [00:21<00:01, 433.44it/s] 93%|█████████████████████████████████████████████████████████████████████████████▌     | 9106/9741 [00:21<00:01, 434.59it/s] 94%|█████████████████████████████████████████████████████████████████████████████▉     | 9150/9741 [00:21<00:01, 435.15it/s] 94%|██████████████████████████████████████████████████████████████████████████████▎    | 9194/9741 [00:22<00:01, 435.85it/s] 95%|██████████████████████████████████████████████████████████████████████████████▋    | 9238/9741 [00:22<00:01, 433.69it/s] 95%|███████████████████████████████████████████████████████████████████████████████    | 9282/9741 [00:22<00:01, 431.62it/s] 96%|███████████████████████████████████████████████████████████████████████████████▍   | 9326/9741 [00:22<00:00, 430.56it/s] 96%|███████████████████████████████████████████████████████████████████████████████▊   | 9370/9741 [00:22<00:00, 431.42it/s] 97%|████████████████████████████████████████████████████████████████████████████████▏  | 9414/9741 [00:22<00:00, 431.71it/s] 97%|████████████████████████████████████████████████████████████████████████████████▌  | 9458/9741 [00:22<00:00, 430.23it/s] 98%|████████████████████████████████████████████████████████████████████████████████▉  | 9502/9741 [00:22<00:00, 430.19it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▎ | 9546/9741 [00:22<00:00, 430.02it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▋ | 9590/9741 [00:23<00:00, 428.66it/s] 99%|██████████████████████████████████████████████████████████████████████████████████ | 9633/9741 [00:23<00:00, 429.02it/s] 99%|██████████████████████████████████████████████████████████████████████████████████▍| 9676/9741 [00:23<00:00, 428.76it/s]100%|██████████████████████████████████████████████████████████████████████████████████▊| 9719/9741 [00:23<00:00, 426.50it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:23<00:00, 416.94it/s]
Load End
Num instances: 1000
[2023-08-21 22:06:23,383] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 22:06:26,125] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 22:06:26,127] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 22:06:26,127] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 22:06:26,127] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 22:06:26,127] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 22:06:26,127] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 22:06:26,128] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 22:06:26,128] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 22:06:26,128] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 22:06:26,128] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 22:06:26,128] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 22:06:26,128] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f5d585c2a60>
[2023-08-21 22:06:26,128] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 22:06:26,128] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 22:06:26,128] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 22:06:26,128] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 22:06:26,128] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 22:06:26,128] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 22:06:26,129] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f5d585c2940>
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 22:06:26,130] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 22:06:26,131] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 22:06:26,131] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 22:06:26,131] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.45505666732788086 seconds
Loading extension module utils...
Time to load utils op: 0.504899263381958 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
So the final answer is 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
So the final answer is 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: Max finished history in 20 * 2 = <<20*2=40>>40 minutes.
Finishing geography took the most time, which is 40 * 3 = <<40*3=120>>120 minutes.
In total, for all three subjects, Max needed 20 + 40 + 120 = <<20+40+120=180>>180 minutes.
So the final answer is 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: If Sophia ate 1/6 of the pie, then 6/6 - 1/6 = 5/6 is left in the fridge.
Let x be the pie's original weight.
The current weight of the pie can be described by 5x/6=1200 grams
So, 5x=7200.
And, the original weight is x = <<1440=1440>>1440 grams.
So, Sophia ate 1440 grams original - 1200 grams after= <<1440-1200=240>>240 grams of pie.
So the final answer is 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: After using the coupon, the final price comes to 67 - 4 = <<67-4=63>>63 dollars.
With three people, they each need to pay 63 / 3 = <<63/3=21>>21 dollars each.
So the final answer is 21

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o8-tgsm8k-s1-rTrue
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:35<28:40, 35.11s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:09<27:46, 34.73s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [01:43<27:05, 34.59s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [02:18<26:26, 34.49s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [02:52<25:41, 34.26s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [03:26<25:01, 34.12s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [04:00<24:26, 34.11s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [04:34<23:56, 34.21s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [05:08<23:24, 34.26s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [05:42<22:45, 34.14s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [06:16<22:07, 34.03s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [06:50<21:28, 33.90s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [07:24<20:55, 33.93s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [07:58<20:25, 34.03s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [08:32<19:54, 34.13s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [09:06<19:21, 34.15s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [09:41<18:46, 34.12s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [10:15<18:11, 34.10s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [10:49<17:43, 34.30s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [11:23<17:06, 34.20s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [11:57<16:30, 34.16s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [12:31<15:55, 34.12s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [13:05<15:18, 34.02s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [13:39<14:44, 34.01s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [14:13<14:09, 33.98s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [14:47<13:33, 33.91s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [15:22<13:08, 34.28s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [15:56<12:31, 34.17s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [16:29<11:52, 33.91s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [17:03<11:17, 33.86s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [17:36<10:41, 33.75s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [18:10<10:05, 33.65s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [18:44<09:33, 33.76s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [19:17<08:58, 33.65s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [19:51<08:23, 33.57s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [20:24<07:50, 33.63s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [20:58<07:17, 33.66s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [21:32<06:43, 33.62s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [22:06<06:11, 33.74s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [22:39<05:37, 33.72s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [23:13<05:03, 33.75s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [23:47<04:29, 33.66s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [24:20<03:55, 33.70s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [24:54<03:22, 33.68s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [25:27<02:47, 33.59s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [26:01<02:14, 33.56s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [26:34<01:40, 33.53s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [27:08<01:06, 33.47s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [27:41<00:33, 33.51s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [28:15<00:00, 33.48s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [28:15<00:00, 33.91s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.2409} | avg. gen lenth: 452.38
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s1-rTrue --seed 1 --max-prompt-length 2048 --rationales --num-out-domain 9
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-21 22:34:51,309] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 9
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o9-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  0%|▏                                                                                    | 28/9741 [00:00<00:34, 279.17it/s]  1%|▍                                                                                    | 57/9741 [00:00<00:34, 282.43it/s]  1%|▊                                                                                    | 86/9741 [00:00<00:34, 281.11it/s]  1%|▉                                                                                   | 115/9741 [00:00<00:34, 281.25it/s]  1%|█▏                                                                                  | 144/9741 [00:00<00:34, 281.89it/s]  2%|█▍                                                                                  | 173/9741 [00:00<00:34, 279.99it/s]  2%|█▋                                                                                  | 202/9741 [00:00<00:33, 280.81it/s]  2%|█▉                                                                                  | 231/9741 [00:00<00:33, 282.57it/s]  3%|██▏                                                                                 | 260/9741 [00:00<00:33, 283.12it/s]  3%|██▍                                                                                 | 289/9741 [00:01<00:34, 277.94it/s]  3%|██▋                                                                                 | 318/9741 [00:01<00:33, 279.91it/s]  4%|██▉                                                                                 | 347/9741 [00:01<00:33, 280.73it/s]  4%|███▏                                                                                | 376/9741 [00:01<00:33, 281.82it/s]  4%|███▍                                                                                | 405/9741 [00:01<00:33, 280.92it/s]  4%|███▋                                                                                | 434/9741 [00:01<00:32, 282.29it/s]  5%|███▉                                                                                | 463/9741 [00:01<00:32, 282.95it/s]  5%|████▏                                                                               | 492/9741 [00:01<00:32, 283.13it/s]  5%|████▍                                                                               | 521/9741 [00:01<00:32, 284.03it/s]  6%|████▋                                                                               | 550/9741 [00:01<00:32, 284.64it/s]  6%|████▉                                                                               | 579/9741 [00:02<00:32, 281.91it/s]  6%|█████▏                                                                              | 608/9741 [00:02<00:32, 282.29it/s]  7%|█████▍                                                                              | 637/9741 [00:02<00:32, 280.04it/s]  7%|█████▋                                                                              | 666/9741 [00:02<00:32, 281.39it/s]  7%|█████▉                                                                              | 695/9741 [00:02<00:31, 282.70it/s]  7%|██████▏                                                                             | 724/9741 [00:02<00:31, 283.77it/s]  8%|██████▍                                                                             | 753/9741 [00:02<00:31, 284.44it/s]  8%|██████▊                                                                             | 786/9741 [00:02<00:30, 295.89it/s]  9%|███████▏                                                                            | 829/9741 [00:02<00:26, 334.79it/s]  9%|███████▌                                                                            | 871/9741 [00:02<00:24, 359.83it/s]  9%|███████▉                                                                            | 914/9741 [00:03<00:23, 380.14it/s] 10%|████████▎                                                                           | 957/9741 [00:03<00:22, 394.68it/s] 10%|████████▌                                                                          | 1000/9741 [00:03<00:21, 404.31it/s] 11%|████████▉                                                                          | 1043/9741 [00:03<00:21, 411.79it/s] 11%|█████████▎                                                                         | 1086/9741 [00:03<00:20, 414.60it/s] 12%|█████████▌                                                                         | 1129/9741 [00:03<00:20, 419.07it/s] 12%|█████████▉                                                                         | 1172/9741 [00:03<00:20, 419.50it/s] 12%|██████████▎                                                                        | 1215/9741 [00:03<00:20, 420.18it/s] 13%|██████████▋                                                                        | 1258/9741 [00:03<00:20, 422.44it/s] 13%|███████████                                                                        | 1301/9741 [00:03<00:19, 423.86it/s] 14%|███████████▍                                                                       | 1344/9741 [00:04<00:19, 422.99it/s] 14%|███████████▊                                                                       | 1387/9741 [00:04<00:19, 423.16it/s] 15%|████████████▏                                                                      | 1430/9741 [00:04<00:19, 423.40it/s] 15%|████████████▌                                                                      | 1473/9741 [00:04<00:19, 423.22it/s] 16%|████████████▉                                                                      | 1516/9741 [00:04<00:19, 422.82it/s] 16%|█████████████▎                                                                     | 1559/9741 [00:04<00:19, 417.14it/s] 16%|█████████████▋                                                                     | 1602/9741 [00:04<00:19, 419.63it/s] 17%|██████████████                                                                     | 1645/9741 [00:04<00:19, 420.63it/s] 17%|██████████████▍                                                                    | 1688/9741 [00:04<00:19, 422.85it/s] 18%|██████████████▋                                                                    | 1731/9741 [00:05<00:19, 421.52it/s] 18%|███████████████                                                                    | 1774/9741 [00:05<00:20, 398.23it/s] 19%|███████████████▍                                                                   | 1816/9741 [00:05<00:19, 404.07it/s] 19%|███████████████▊                                                                   | 1858/9741 [00:05<00:19, 407.86it/s] 20%|████████████████▏                                                                  | 1901/9741 [00:05<00:19, 412.00it/s] 20%|████████████████▌                                                                  | 1944/9741 [00:05<00:18, 414.44it/s] 20%|████████████████▉                                                                  | 1986/9741 [00:05<00:18, 414.26it/s] 21%|█████████████████▎                                                                 | 2029/9741 [00:05<00:18, 416.22it/s] 21%|█████████████████▋                                                                 | 2071/9741 [00:05<00:18, 415.97it/s] 22%|██████████████████                                                                 | 2113/9741 [00:05<00:18, 412.20it/s] 22%|██████████████████▎                                                                | 2155/9741 [00:06<00:18, 412.56it/s] 23%|██████████████████▋                                                                | 2197/9741 [00:06<00:18, 413.06it/s] 23%|███████████████████                                                                | 2239/9741 [00:06<00:18, 411.73it/s] 23%|███████████████████▍                                                               | 2281/9741 [00:06<00:18, 412.94it/s] 24%|███████████████████▊                                                               | 2323/9741 [00:06<00:17, 413.65it/s] 24%|████████████████████▏                                                              | 2365/9741 [00:06<00:17, 413.11it/s] 25%|████████████████████▌                                                              | 2407/9741 [00:06<00:17, 412.65it/s] 25%|████████████████████▊                                                              | 2449/9741 [00:06<00:17, 409.61it/s] 26%|█████████████████████▏                                                             | 2491/9741 [00:06<00:17, 409.74it/s] 26%|█████████████████████▌                                                             | 2533/9741 [00:06<00:17, 410.76it/s] 26%|█████████████████████▉                                                             | 2575/9741 [00:07<00:17, 411.01it/s] 27%|██████████████████████▎                                                            | 2617/9741 [00:07<00:17, 411.24it/s] 27%|██████████████████████▋                                                            | 2659/9741 [00:07<00:17, 408.97it/s] 28%|███████████████████████                                                            | 2700/9741 [00:07<00:17, 406.23it/s] 28%|███████████████████████▎                                                           | 2741/9741 [00:07<00:17, 405.83it/s] 29%|███████████████████████▋                                                           | 2782/9741 [00:07<00:17, 405.79it/s] 29%|████████████████████████                                                           | 2823/9741 [00:07<00:17, 399.46it/s] 29%|████████████████████████▍                                                          | 2864/9741 [00:07<00:17, 401.74it/s] 30%|████████████████████████▊                                                          | 2905/9741 [00:07<00:17, 400.83it/s] 30%|█████████████████████████                                                          | 2947/9741 [00:07<00:16, 403.95it/s] 31%|█████████████████████████▍                                                         | 2989/9741 [00:08<00:16, 407.00it/s] 31%|█████████████████████████▊                                                         | 3031/9741 [00:08<00:16, 408.82it/s] 32%|██████████████████████████▏                                                        | 3073/9741 [00:08<00:16, 409.96it/s] 32%|██████████████████████████▌                                                        | 3115/9741 [00:08<00:16, 410.50it/s] 32%|██████████████████████████▉                                                        | 3157/9741 [00:08<00:16, 409.43it/s] 33%|███████████████████████████▎                                                       | 3199/9741 [00:08<00:15, 411.18it/s] 33%|███████████████████████████▌                                                       | 3241/9741 [00:08<00:15, 412.13it/s] 34%|███████████████████████████▉                                                       | 3283/9741 [00:08<00:15, 410.92it/s] 34%|████████████████████████████▎                                                      | 3325/9741 [00:08<00:15, 411.03it/s] 35%|████████████████████████████▋                                                      | 3367/9741 [00:09<00:15, 409.68it/s] 35%|█████████████████████████████                                                      | 3409/9741 [00:09<00:15, 410.82it/s] 35%|█████████████████████████████▍                                                     | 3451/9741 [00:09<00:15, 410.86it/s] 36%|█████████████████████████████▊                                                     | 3493/9741 [00:09<00:15, 410.66it/s] 36%|██████████████████████████████                                                     | 3535/9741 [00:09<00:15, 407.68it/s] 37%|██████████████████████████████▍                                                    | 3576/9741 [00:09<00:15, 406.45it/s] 37%|██████████████████████████████▊                                                    | 3617/9741 [00:09<00:15, 407.35it/s] 38%|███████████████████████████████▏                                                   | 3659/9741 [00:09<00:14, 408.26it/s] 38%|███████████████████████████████▌                                                   | 3700/9741 [00:09<00:14, 408.32it/s] 38%|███████████████████████████████▉                                                   | 3741/9741 [00:09<00:14, 408.18it/s] 39%|████████████████████████████████▏                                                  | 3782/9741 [00:10<00:14, 408.04it/s] 39%|████████████████████████████████▌                                                  | 3823/9741 [00:10<00:14, 405.95it/s] 40%|████████████████████████████████▉                                                  | 3864/9741 [00:10<00:14, 406.12it/s] 40%|█████████████████████████████████▎                                                 | 3905/9741 [00:10<00:14, 406.02it/s] 41%|█████████████████████████████████▌                                                 | 3946/9741 [00:10<00:14, 406.19it/s] 41%|█████████████████████████████████▉                                                 | 3987/9741 [00:10<00:14, 406.37it/s] 41%|██████████████████████████████████▎                                                | 4028/9741 [00:10<00:14, 404.70it/s] 42%|██████████████████████████████████▋                                                | 4069/9741 [00:10<00:14, 405.12it/s] 42%|███████████████████████████████████                                                | 4110/9741 [00:10<00:13, 404.35it/s] 43%|███████████████████████████████████▎                                               | 4151/9741 [00:10<00:13, 404.92it/s] 43%|███████████████████████████████████▋                                               | 4192/9741 [00:11<00:13, 404.70it/s] 43%|████████████████████████████████████                                               | 4233/9741 [00:11<00:13, 404.12it/s] 44%|████████████████████████████████████▍                                              | 4274/9741 [00:11<00:13, 402.18it/s] 44%|████████████████████████████████████▊                                              | 4315/9741 [00:11<00:13, 402.46it/s] 45%|█████████████████████████████████████                                              | 4356/9741 [00:11<00:13, 402.82it/s] 45%|█████████████████████████████████████▍                                             | 4397/9741 [00:11<00:13, 403.19it/s] 46%|█████████████████████████████████████▊                                             | 4438/9741 [00:11<00:13, 402.97it/s] 46%|██████████████████████████████████████▏                                            | 4479/9741 [00:11<00:13, 403.27it/s] 46%|██████████████████████████████████████▌                                            | 4520/9741 [00:11<00:13, 377.67it/s] 47%|██████████████████████████████████████▊                                            | 4561/9741 [00:11<00:13, 384.37it/s] 47%|███████████████████████████████████████▏                                           | 4602/9741 [00:12<00:13, 389.86it/s] 48%|███████████████████████████████████████▌                                           | 4643/9741 [00:12<00:12, 393.77it/s] 48%|███████████████████████████████████████▉                                           | 4684/9741 [00:12<00:12, 396.58it/s] 48%|████████████████████████████████████████▎                                          | 4724/9741 [00:12<00:17, 282.09it/s] 49%|████████████████████████████████████████▌                                          | 4765/9741 [00:12<00:16, 310.43it/s] 49%|████████████████████████████████████████▉                                          | 4804/9741 [00:12<00:14, 329.33it/s] 50%|█████████████████████████████████████████▎                                         | 4844/9741 [00:12<00:14, 347.30it/s] 50%|█████████████████████████████████████████▌                                         | 4885/9741 [00:12<00:13, 362.86it/s] 51%|█████████████████████████████████████████▉                                         | 4925/9741 [00:13<00:12, 372.52it/s] 51%|██████████████████████████████████████████▎                                        | 4966/9741 [00:13<00:12, 381.59it/s] 51%|██████████████████████████████████████████▋                                        | 5007/9741 [00:13<00:12, 387.65it/s] 52%|███████████████████████████████████████████                                        | 5048/9741 [00:13<00:11, 392.08it/s] 52%|███████████████████████████████████████████▎                                       | 5089/9741 [00:13<00:11, 395.61it/s] 53%|███████████████████████████████████████████▋                                       | 5130/9741 [00:13<00:11, 398.25it/s] 53%|████████████████████████████████████████████                                       | 5171/9741 [00:13<00:11, 398.34it/s] 54%|████████████████████████████████████████████▍                                      | 5212/9741 [00:13<00:11, 400.07it/s] 54%|████████████████████████████████████████████▊                                      | 5253/9741 [00:13<00:11, 400.99it/s] 54%|█████████████████████████████████████████████                                      | 5294/9741 [00:13<00:11, 400.74it/s] 55%|█████████████████████████████████████████████▍                                     | 5335/9741 [00:14<00:11, 399.81it/s] 55%|█████████████████████████████████████████████▊                                     | 5376/9741 [00:14<00:10, 398.34it/s] 56%|██████████████████████████████████████████████▏                                    | 5417/9741 [00:14<00:10, 399.03it/s] 56%|██████████████████████████████████████████████▍                                    | 5457/9741 [00:14<00:10, 398.11it/s] 56%|██████████████████████████████████████████████▊                                    | 5498/9741 [00:14<00:10, 399.10it/s] 57%|███████████████████████████████████████████████▏                                   | 5539/9741 [00:14<00:10, 400.28it/s] 57%|███████████████████████████████████████████████▌                                   | 5580/9741 [00:14<00:10, 400.73it/s] 58%|███████████████████████████████████████████████▉                                   | 5621/9741 [00:14<00:10, 399.39it/s] 58%|████████████████████████████████████████████████▏                                  | 5661/9741 [00:14<00:10, 398.96it/s] 59%|████████████████████████████████████████████████▌                                  | 5702/9741 [00:14<00:10, 400.21it/s] 59%|████████████████████████████████████████████████▉                                  | 5743/9741 [00:15<00:09, 401.05it/s] 59%|█████████████████████████████████████████████████▎                                 | 5784/9741 [00:15<00:09, 401.74it/s] 60%|█████████████████████████████████████████████████▋                                 | 5825/9741 [00:15<00:09, 399.85it/s] 60%|█████████████████████████████████████████████████▉                                 | 5866/9741 [00:15<00:09, 400.13it/s] 61%|██████████████████████████████████████████████████▎                                | 5907/9741 [00:15<00:09, 400.25it/s] 61%|██████████████████████████████████████████████████▋                                | 5948/9741 [00:15<00:09, 401.16it/s] 61%|███████████████████████████████████████████████████                                | 5989/9741 [00:15<00:09, 401.68it/s] 62%|███████████████████████████████████████████████████▍                               | 6030/9741 [00:15<00:09, 402.18it/s] 62%|███████████████████████████████████████████████████▋                               | 6071/9741 [00:15<00:09, 400.01it/s] 63%|████████████████████████████████████████████████████                               | 6112/9741 [00:15<00:09, 400.80it/s] 63%|████████████████████████████████████████████████████▍                              | 6153/9741 [00:16<00:08, 401.01it/s] 64%|████████████████████████████████████████████████████▊                              | 6194/9741 [00:16<00:08, 401.74it/s] 64%|█████████████████████████████████████████████████████▏                             | 6235/9741 [00:16<00:08, 401.42it/s] 64%|█████████████████████████████████████████████████████▍                             | 6276/9741 [00:16<00:08, 399.61it/s] 65%|█████████████████████████████████████████████████████▊                             | 6317/9741 [00:16<00:08, 400.22it/s] 65%|██████████████████████████████████████████████████████▏                            | 6358/9741 [00:16<00:08, 395.04it/s] 66%|██████████████████████████████████████████████████████▌                            | 6399/9741 [00:16<00:08, 397.16it/s] 66%|██████████████████████████████████████████████████████▊                            | 6440/9741 [00:16<00:08, 398.62it/s] 67%|███████████████████████████████████████████████████████▏                           | 6480/9741 [00:16<00:08, 398.49it/s] 67%|███████████████████████████████████████████████████████▌                           | 6520/9741 [00:17<00:08, 397.31it/s] 67%|███████████████████████████████████████████████████████▉                           | 6561/9741 [00:17<00:07, 398.97it/s] 68%|████████████████████████████████████████████████████████▎                          | 6602/9741 [00:17<00:07, 399.93it/s] 68%|████████████████████████████████████████████████████████▌                          | 6643/9741 [00:17<00:07, 400.65it/s] 69%|████████████████████████████████████████████████████████▉                          | 6684/9741 [00:17<00:07, 400.33it/s] 69%|█████████████████████████████████████████████████████████▎                         | 6725/9741 [00:17<00:07, 398.95it/s] 69%|█████████████████████████████████████████████████████████▋                         | 6765/9741 [00:17<00:07, 394.08it/s] 70%|█████████████████████████████████████████████████████████▉                         | 6806/9741 [00:17<00:07, 397.12it/s] 70%|██████████████████████████████████████████████████████████▎                        | 6847/9741 [00:17<00:07, 399.16it/s] 71%|██████████████████████████████████████████████████████████▋                        | 6888/9741 [00:17<00:07, 400.40it/s] 71%|███████████████████████████████████████████████████████████                        | 6929/9741 [00:18<00:07, 401.42it/s] 72%|███████████████████████████████████████████████████████████▍                       | 6970/9741 [00:18<00:06, 399.84it/s] 72%|███████████████████████████████████████████████████████████▋                       | 7011/9741 [00:18<00:06, 400.56it/s] 72%|████████████████████████████████████████████████████████████                       | 7052/9741 [00:18<00:06, 400.96it/s] 73%|████████████████████████████████████████████████████████████▍                      | 7093/9741 [00:18<00:06, 400.97it/s] 73%|████████████████████████████████████████████████████████████▊                      | 7134/9741 [00:18<00:06, 400.71it/s] 74%|█████████████████████████████████████████████████████████████▏                     | 7175/9741 [00:18<00:06, 400.77it/s] 74%|█████████████████████████████████████████████████████████████▍                     | 7216/9741 [00:18<00:06, 398.88it/s] 74%|█████████████████████████████████████████████████████████████▊                     | 7256/9741 [00:18<00:06, 394.30it/s] 75%|██████████████████████████████████████████████████████████████▏                    | 7296/9741 [00:18<00:06, 395.65it/s] 75%|██████████████████████████████████████████████████████████████▌                    | 7336/9741 [00:19<00:06, 396.30it/s] 76%|██████████████████████████████████████████████████████████████▊                    | 7376/9741 [00:19<00:05, 397.11it/s] 76%|███████████████████████████████████████████████████████████████▏                   | 7416/9741 [00:19<00:06, 355.69it/s] 77%|███████████████████████████████████████████████████████████████▌                   | 7456/9741 [00:19<00:06, 367.29it/s] 77%|███████████████████████████████████████████████████████████████▊                   | 7496/9741 [00:19<00:05, 376.50it/s] 77%|████████████████████████████████████████████████████████████████▏                  | 7536/9741 [00:19<00:05, 382.62it/s] 78%|████████████████████████████████████████████████████████████████▌                  | 7576/9741 [00:19<00:05, 387.28it/s] 78%|████████████████████████████████████████████████████████████████▉                  | 7616/9741 [00:19<00:05, 390.94it/s] 79%|█████████████████████████████████████████████████████████████████▏                 | 7656/9741 [00:19<00:05, 391.23it/s] 79%|█████████████████████████████████████████████████████████████████▌                 | 7696/9741 [00:19<00:05, 393.40it/s] 79%|█████████████████████████████████████████████████████████████████▉                 | 7737/9741 [00:20<00:05, 395.61it/s] 80%|██████████████████████████████████████████████████████████████████▎                | 7777/9741 [00:20<00:04, 396.70it/s] 80%|██████████████████████████████████████████████████████████████████▌                | 7817/9741 [00:20<00:04, 397.59it/s] 81%|██████████████████████████████████████████████████████████████████▉                | 7858/9741 [00:20<00:04, 398.44it/s] 81%|███████████████████████████████████████████████████████████████████▎               | 7898/9741 [00:20<00:04, 397.06it/s] 81%|███████████████████████████████████████████████████████████████████▋               | 7938/9741 [00:20<00:04, 397.65it/s] 82%|███████████████████████████████████████████████████████████████████▉               | 7979/9741 [00:20<00:04, 398.54it/s] 82%|████████████████████████████████████████████████████████████████████▎              | 8019/9741 [00:20<00:04, 398.76it/s] 83%|████████████████████████████████████████████████████████████████████▋              | 8059/9741 [00:20<00:04, 397.40it/s] 83%|█████████████████████████████████████████████████████████████████████              | 8099/9741 [00:21<00:04, 395.01it/s] 84%|█████████████████████████████████████████████████████████████████████▎             | 8139/9741 [00:21<00:04, 396.48it/s] 84%|█████████████████████████████████████████████████████████████████████▋             | 8179/9741 [00:21<00:03, 397.39it/s] 84%|██████████████████████████████████████████████████████████████████████             | 8219/9741 [00:21<00:03, 398.03it/s] 85%|██████████████████████████████████████████████████████████████████████▍            | 8260/9741 [00:21<00:03, 398.73it/s] 85%|██████████████████████████████████████████████████████████████████████▋            | 8300/9741 [00:21<00:03, 399.09it/s] 86%|███████████████████████████████████████████████████████████████████████            | 8340/9741 [00:21<00:03, 397.48it/s] 86%|███████████████████████████████████████████████████████████████████████▍           | 8380/9741 [00:21<00:03, 398.22it/s] 86%|███████████████████████████████████████████████████████████████████████▊           | 8421/9741 [00:21<00:03, 398.78it/s] 87%|████████████████████████████████████████████████████████████████████████           | 8461/9741 [00:21<00:03, 398.69it/s] 87%|████████████████████████████████████████████████████████████████████████▍          | 8501/9741 [00:22<00:03, 398.95it/s] 88%|████████████████████████████████████████████████████████████████████████▊          | 8541/9741 [00:22<00:03, 399.14it/s] 88%|█████████████████████████████████████████████████████████████████████████          | 8581/9741 [00:22<00:02, 397.18it/s] 89%|█████████████████████████████████████████████████████████████████████████▍         | 8621/9741 [00:22<00:02, 397.74it/s] 89%|█████████████████████████████████████████████████████████████████████████▊         | 8662/9741 [00:22<00:02, 398.57it/s] 89%|██████████████████████████████████████████████████████████████████████████▏        | 8702/9741 [00:22<00:02, 398.93it/s] 90%|██████████████████████████████████████████████████████████████████████████▍        | 8742/9741 [00:22<00:02, 399.15it/s] 90%|██████████████████████████████████████████████████████████████████████████▊        | 8782/9741 [00:22<00:02, 397.23it/s] 91%|███████████████████████████████████████████████████████████████████████████▏       | 8822/9741 [00:22<00:02, 397.99it/s] 91%|███████████████████████████████████████████████████████████████████████████▌       | 8862/9741 [00:22<00:02, 397.01it/s] 91%|███████████████████████████████████████████████████████████████████████████▊       | 8902/9741 [00:23<00:02, 397.42it/s] 92%|████████████████████████████████████████████████████████████████████████████▏      | 8943/9741 [00:23<00:02, 398.60it/s] 92%|████████████████████████████████████████████████████████████████████████████▌      | 8983/9741 [00:23<00:01, 398.90it/s] 93%|████████████████████████████████████████████████████████████████████████████▉      | 9023/9741 [00:23<00:01, 396.99it/s] 93%|█████████████████████████████████████████████████████████████████████████████▏     | 9063/9741 [00:23<00:01, 397.70it/s] 93%|█████████████████████████████████████████████████████████████████████████████▌     | 9104/9741 [00:23<00:01, 398.43it/s] 94%|█████████████████████████████████████████████████████████████████████████████▉     | 9144/9741 [00:23<00:01, 394.86it/s] 94%|██████████████████████████████████████████████████████████████████████████████▎    | 9184/9741 [00:23<00:01, 396.14it/s] 95%|██████████████████████████████████████████████████████████████████████████████▌    | 9224/9741 [00:23<00:01, 395.28it/s] 95%|██████████████████████████████████████████████████████████████████████████████▉    | 9264/9741 [00:23<00:01, 396.07it/s] 96%|███████████████████████████████████████████████████████████████████████████████▎   | 9304/9741 [00:24<00:01, 396.93it/s] 96%|███████████████████████████████████████████████████████████████████████████████▌   | 9344/9741 [00:24<00:00, 397.75it/s] 96%|███████████████████████████████████████████████████████████████████████████████▉   | 9385/9741 [00:24<00:00, 398.65it/s] 97%|████████████████████████████████████████████████████████████████████████████████▎  | 9426/9741 [00:24<00:00, 399.22it/s] 97%|████████████████████████████████████████████████████████████████████████████████▋  | 9466/9741 [00:24<00:00, 397.29it/s] 98%|████████████████████████████████████████████████████████████████████████████████▉  | 9506/9741 [00:24<00:00, 397.59it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▎ | 9546/9741 [00:24<00:00, 398.16it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▋ | 9586/9741 [00:24<00:00, 398.42it/s] 99%|██████████████████████████████████████████████████████████████████████████████████ | 9626/9741 [00:24<00:00, 398.72it/s] 99%|██████████████████████████████████████████████████████████████████████████████████▎| 9666/9741 [00:24<00:00, 397.59it/s]100%|██████████████████████████████████████████████████████████████████████████████████▋| 9706/9741 [00:25<00:00, 396.05it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:25<00:00, 387.47it/s]
Load End
Num instances: 1000
[2023-08-21 22:35:27,922] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 22:35:30,643] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 22:35:30,644] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 22:35:30,644] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 22:35:30,644] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 22:35:30,644] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 22:35:30,644] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 22:35:30,644] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fbc2d214a60>
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fbc2d214940>
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-21 22:35:30,645] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 22:35:30,646] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 22:35:30,646] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 22:35:30,646] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 22:35:30,646] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.43807363510131836 seconds
Loading extension module utils...
Time to load utils op: 0.509070634841919 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
So the final answer is 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
So the final answer is 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
So the final answer is 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
So the final answer is 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
So the final answer is 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: Max finished history in 20 * 2 = <<20*2=40>>40 minutes.
Finishing geography took the most time, which is 40 * 3 = <<40*3=120>>120 minutes.
In total, for all three subjects, Max needed 20 + 40 + 120 = <<20+40+120=180>>180 minutes.
So the final answer is 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: If Sophia ate 1/6 of the pie, then 6/6 - 1/6 = 5/6 is left in the fridge.
Let x be the pie's original weight.
The current weight of the pie can be described by 5x/6=1200 grams
So, 5x=7200.
And, the original weight is x = <<1440=1440>>1440 grams.
So, Sophia ate 1440 grams original - 1200 grams after= <<1440-1200=240>>240 grams of pie.
So the final answer is 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: After using the coupon, the final price comes to 67 - 4 = <<67-4=63>>63 dollars.
With three people, they each need to pay 63 / 3 = <<63/3=21>>21 dollars each.
So the final answer is 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: If in six years Tom's brother will be 30 years old, he is currently 30-6 = <<30-6=24>>24 years old.
Since Tom's brother is 4 times as old as Tom's dog, Tom's dog is 24/4 = <<24/4=6>>6 years old currently.
Tom's dog will be 6+6 = <<6+6=12>>12 years old in six years.
So the final answer is 12

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o9-tgsm8k-s1-rTrue
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2484, in sample
    outputs = self(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/models/opt/modeling_opt.py", line 983, in forward
    outputs = self.model.decoder(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/models/opt/modeling_opt.py", line 749, in forward
    layer_outputs = decoder_layer(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/models/opt/modeling_opt.py", line 376, in forward
    hidden_states, self_attn_weights, present_key_value = self.self_attn(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/models/opt/modeling_opt.py", line 276, in forward
    attn_weights = nn.functional.softmax(attn_weights, dim=-1, dtype=torch.float32).to(torch.float16)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call,so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
terminate called after throwing an instance of 'c10::CUDAError'
  what():  CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call,so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Exception raised from create_event_internal at ../c10/cuda/CUDACachingAllocator.cpp:1387 (most recent call first):
frame #0: c10::Error::Error(c10::SourceLocation, std::string) + 0x3e (0x7f618c9ac20e in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libc10.so)
frame #1: <unknown function> + 0x23a21 (0x7f6194072a21 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libc10_cuda.so)
frame #2: c10::cuda::CUDACachingAllocator::raw_delete(void*) + 0x257 (0x7f61940779a7 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libc10_cuda.so)
frame #3: <unknown function> + 0x463338 (0x7f61788f4338 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libtorch_python.so)
frame #4: c10::TensorImpl::release_resources() + 0x175 (0x7f618c9937a5 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libc10.so)
frame #5: <unknown function> + 0x35f355 (0x7f61787f0355 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libtorch_python.so)
frame #6: <unknown function> + 0x678d38 (0x7f6178b09d38 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libtorch_python.so)
frame #7: THPVariable_subclass_dealloc(_object*) + 0x2b5 (0x7f6178b0a0e5 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libtorch_python.so)
frame #8: /home/ylu130/.conda/envs/distllm/bin/python() [0x4e4277]
frame #9: /home/ylu130/.conda/envs/distllm/bin/python() [0x4d9998]
frame #10: _PyModule_ClearDict + 0xe9 (0x55b3b9 in /home/ylu130/.conda/envs/distllm/bin/python)
frame #11: /home/ylu130/.conda/envs/distllm/bin/python() [0x5c263b]
frame #12: Py_FinalizeEx + 0x179 (0x5c10d9 in /home/ylu130/.conda/envs/distllm/bin/python)
frame #13: Py_RunMain + 0x110 (0x5b4210 in /home/ylu130/.conda/envs/distllm/bin/python)
frame #14: Py_BytesMain + 0x39 (0x587a39 in /home/ylu130/.conda/envs/distllm/bin/python)
frame #15: <unknown function> + 0x29d90 (0x7f6194a44d90 in /lib/x86_64-linux-gnu/libc.so.6)
frame #16: __libc_start_main + 0x80 (0x7f6194a44e40 in /lib/x86_64-linux-gnu/libc.so.6)
frame #17: /home/ylu130/.conda/envs/distllm/bin/python() [0x5878ee]

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:31<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 126, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 123, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 107, in evaluate_main
    query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 89, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2484, in sample
    outputs = self(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/models/opt/modeling_opt.py", line 983, in forward
    outputs = self.model.decoder(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/models/opt/modeling_opt.py", line 749, in forward
    layer_outputs = decoder_layer(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/models/opt/modeling_opt.py", line 376, in forward
    hidden_states, self_attn_weights, present_key_value = self.self_attn(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/models/opt/modeling_opt.py", line 276, in forward
    attn_weights = nn.functional.softmax(attn_weights, dim=-1, dtype=torch.float32).to(torch.float16)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call,so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
terminate called after throwing an instance of 'c10::CUDAError'
  what():  CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call,so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Exception raised from create_event_internal at ../c10/cuda/CUDACachingAllocator.cpp:1387 (most recent call first):
frame #0: c10::Error::Error(c10::SourceLocation, std::string) + 0x3e (0x7fbcd586d20e in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libc10.so)
frame #1: <unknown function> + 0x23a21 (0x7fbcd58e4a21 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libc10_cuda.so)
frame #2: c10::cuda::CUDACachingAllocator::raw_delete(void*) + 0x257 (0x7fbcd58e99a7 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libc10_cuda.so)
frame #3: <unknown function> + 0x463338 (0x7fbcc18f4338 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libtorch_python.so)
frame #4: c10::TensorImpl::release_resources() + 0x175 (0x7fbcd58547a5 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libc10.so)
frame #5: <unknown function> + 0x35f355 (0x7fbcc17f0355 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libtorch_python.so)
frame #6: <unknown function> + 0x678d38 (0x7fbcc1b09d38 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libtorch_python.so)
frame #7: THPVariable_subclass_dealloc(_object*) + 0x2b5 (0x7fbcc1b0a0e5 in /home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/lib/libtorch_python.so)
frame #8: /home/ylu130/.conda/envs/distllm/bin/python() [0x4e4277]
frame #9: /home/ylu130/.conda/envs/distllm/bin/python() [0x4d9998]
frame #10: _PyModule_ClearDict + 0xe9 (0x55b3b9 in /home/ylu130/.conda/envs/distllm/bin/python)
frame #11: /home/ylu130/.conda/envs/distllm/bin/python() [0x5c263b]
frame #12: Py_FinalizeEx + 0x179 (0x5c10d9 in /home/ylu130/.conda/envs/distllm/bin/python)
frame #13: Py_RunMain + 0x110 (0x5b4210 in /home/ylu130/.conda/envs/distllm/bin/python)
frame #14: Py_BytesMain + 0x39 (0x587a39 in /home/ylu130/.conda/envs/distllm/bin/python)
frame #15: <unknown function> + 0x29d90 (0x7fbcdd8fcd90 in /lib/x86_64-linux-gnu/libc.so.6)
frame #16: __libc_start_main + 0x80 (0x7fbcdd8fce40 in /lib/x86_64-linux-gnu/libc.so.6)
frame #17: /home/ylu130/.conda/envs/distllm/bin/python() [0x5878ee]

ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: -6) local_rank: 0 (pid: 3435283) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-21_22:36:04
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : -6 (pid: 3435284)
  error_file: <N/A>
  traceback : Signal 6 (SIGABRT) received by PID 3435284
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-21_22:36:04
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : -6 (pid: 3435283)
  error_file: <N/A>
  traceback : Signal 6 (SIGABRT) received by PID 3435283
============================================================
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-21 22:36:08,019] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o1-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  3%|██▍                                                                                | 288/9741 [00:00<00:03, 2872.42it/s]  6%|█████                                                                              | 592/9741 [00:00<00:03, 2966.51it/s]  9%|███████▋                                                                           | 904/9741 [00:00<00:02, 3034.08it/s] 13%|██████████▎                                                                       | 1220/9741 [00:00<00:02, 3082.53it/s] 16%|████████████▉                                                                     | 1535/9741 [00:00<00:02, 3104.42it/s] 19%|███████████████▌                                                                  | 1850/9741 [00:00<00:02, 3118.17it/s] 22%|██████████████████▏                                                               | 2165/9741 [00:00<00:02, 3126.10it/s] 25%|████████████████████▉                                                             | 2481/9741 [00:00<00:02, 3135.76it/s] 29%|███████████████████████▌                                                          | 2795/9741 [00:00<00:02, 3085.38it/s] 32%|██████████████████████████▏                                                       | 3110/9741 [00:01<00:02, 3103.86it/s] 35%|████████████████████████████▊                                                     | 3427/9741 [00:01<00:02, 3121.62it/s] 38%|███████████████████████████████▌                                                  | 3744/9741 [00:01<00:01, 3135.40it/s] 42%|██████████████████████████████████▏                                               | 4065/9741 [00:01<00:01, 3157.85it/s] 45%|████████████████████████████████████▉                                             | 4386/9741 [00:01<00:01, 3173.21it/s] 48%|███████████████████████████████████████▌                                          | 4704/9741 [00:01<00:01, 3147.33it/s] 52%|██████████████████████████████████████████▎                                       | 5019/9741 [00:01<00:01, 2675.46it/s] 55%|████████████████████████████████████████████▉                                     | 5339/9741 [00:01<00:01, 2812.95it/s] 58%|███████████████████████████████████████████████▋                                  | 5661/9741 [00:01<00:01, 2922.91it/s] 61%|██████████████████████████████████████████████████▎                               | 5983/9741 [00:01<00:01, 3004.88it/s] 65%|█████████████████████████████████████████████████████▎                            | 6326/9741 [00:02<00:01, 3126.19it/s] 70%|█████████████████████████████████████████████████████████▍                        | 6819/9741 [00:02<00:00, 3648.78it/s] 75%|█████████████████████████████████████████████████████████████▌                    | 7314/9741 [00:02<00:00, 4029.53it/s] 80%|█████████████████████████████████████████████████████████████████▋                | 7799/9741 [00:02<00:00, 4270.33it/s] 85%|█████████████████████████████████████████████████████████████████████▊            | 8297/9741 [00:02<00:00, 4480.65it/s] 90%|██████████████████████████████████████████████████████████████████████████        | 8791/9741 [00:02<00:00, 4616.59it/s] 95%|██████████████████████████████████████████████████████████████████████████████▏   | 9285/9741 [00:02<00:00, 4711.81it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:02<00:00, 3522.78it/s]
Load End
Num instances: 1000
[2023-08-21 22:36:22,070] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 22:36:26,381] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 22:36:26,382] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 22:36:26,383] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 22:36:26,383] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 22:36:26,383] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 22:36:26,383] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 22:36:26,383] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 22:36:26,383] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 22:36:26,383] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 22:36:26,383] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 22:36:26,383] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 22:36:26,383] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fc541e50a60>
[2023-08-21 22:36:26,383] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fc541e50940>
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 22:36:26,384] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-21 22:36:26,385] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 22:36:26,385] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 22:36:26,385] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 22:36:26,385] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 22:36:26,385] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.475419282913208 seconds
Loading extension module utils...
Time to load utils op: 0.5050234794616699 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o1-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [01:06<53:56, 66.04s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [02:14<53:50, 67.31s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [03:22<52:54, 67.55s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [04:29<51:38, 67.35s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [05:36<50:30, 67.34s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [06:43<49:22, 67.32s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [07:52<48:35, 67.81s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [08:59<47:12, 67.44s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [10:08<46:26, 67.97s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [11:18<45:50, 68.76s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [12:26<44:24, 68.32s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [13:34<43:12, 68.21s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [14:42<42:01, 68.16s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [15:48<40:38, 67.75s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [16:56<39:28, 67.68s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [18:05<38:30, 67.95s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [19:12<37:17, 67.80s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [20:20<36:08, 67.75s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [21:28<35:05, 67.93s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [22:35<33:50, 67.68s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [23:42<32:39, 67.56s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [24:50<31:36, 67.71s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [25:57<30:16, 67.29s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [27:04<29:12, 67.41s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [28:11<28:02, 67.30s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [29:20<27:02, 67.59s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [30:30<26:10, 68.30s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [31:38<25:05, 68.42s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [32:45<23:43, 67.81s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [33:52<22:35, 67.76s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [35:02<21:39, 68.41s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [36:10<20:28, 68.26s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [37:18<19:19, 68.23s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [38:25<18:05, 67.84s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [39:33<16:58, 67.87s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [40:40<15:45, 67.52s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [41:48<14:38, 67.57s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [42:56<13:34, 67.85s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [44:05<12:30, 68.22s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [45:16<11:29, 68.93s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [46:24<10:17, 68.59s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [47:33<09:10, 68.81s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [48:42<08:01, 68.75s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [49:50<06:51, 68.61s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [50:58<05:41, 68.37s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [52:07<04:34, 68.61s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [53:15<03:25, 68.52s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [54:25<02:17, 68.81s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [55:32<01:08, 68.31s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [56:41<00:00, 68.55s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [56:41<00:00, 68.03s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.8596} | avg. gen lenth: 288.742
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-21 23:33:17,856] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o2-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  2%|█▍                                                                                 | 166/9741 [00:00<00:05, 1654.58it/s]  3%|██▉                                                                                | 339/9741 [00:00<00:05, 1698.12it/s]  5%|████▍                                                                              | 514/9741 [00:00<00:05, 1719.75it/s]  7%|█████▉                                                                             | 690/9741 [00:00<00:05, 1733.81it/s]  9%|███████▍                                                                           | 868/9741 [00:00<00:05, 1747.92it/s] 11%|████████▊                                                                         | 1047/9741 [00:00<00:04, 1761.44it/s] 13%|██████████▎                                                                       | 1226/9741 [00:00<00:04, 1769.01it/s] 14%|███████████▊                                                                      | 1405/9741 [00:00<00:04, 1773.12it/s] 16%|█████████████▎                                                                    | 1583/9741 [00:00<00:04, 1746.26it/s] 18%|██████████████▊                                                                   | 1759/9741 [00:01<00:04, 1728.15it/s] 20%|████████████████▎                                                                 | 1937/9741 [00:01<00:04, 1740.55it/s] 22%|█████████████████▊                                                                | 2113/9741 [00:01<00:04, 1745.85it/s] 24%|███████████████████▋                                                              | 2341/9741 [00:01<00:03, 1905.92it/s] 27%|██████████████████████                                                            | 2614/9741 [00:01<00:03, 2152.08it/s] 30%|████████████████████████▎                                                         | 2884/9741 [00:01<00:02, 2315.65it/s] 32%|██████████████████████████▌                                                       | 3156/9741 [00:01<00:02, 2435.22it/s] 35%|████████████████████████████▊                                                     | 3430/9741 [00:01<00:02, 2524.85it/s] 38%|███████████████████████████████▏                                                  | 3701/9741 [00:01<00:02, 2577.84it/s] 41%|█████████████████████████████████▍                                                | 3965/9741 [00:01<00:02, 2595.37it/s] 43%|███████████████████████████████████▋                                              | 4234/9741 [00:02<00:02, 2621.84it/s] 46%|█████████████████████████████████████▊                                            | 4498/9741 [00:02<00:01, 2624.51it/s] 49%|████████████████████████████████████████                                          | 4761/9741 [00:02<00:02, 2296.50it/s] 52%|██████████████████████████████████████████▍                                       | 5034/9741 [00:02<00:01, 2413.77it/s] 54%|████████████████████████████████████████████▋                                     | 5308/9741 [00:02<00:01, 2505.00it/s] 57%|██████████████████████████████████████████████▉                                   | 5583/9741 [00:02<00:01, 2572.83it/s] 60%|█████████████████████████████████████████████████▎                                | 5859/9741 [00:02<00:01, 2625.66it/s] 63%|███████████████████████████████████████████████████▋                              | 6138/9741 [00:02<00:01, 2671.13it/s] 66%|██████████████████████████████████████████████████████                            | 6416/9741 [00:02<00:01, 2700.72it/s] 69%|████████████████████████████████████████████████████████▎                         | 6693/9741 [00:02<00:01, 2718.84it/s] 72%|██████████████████████████████████████████████████████████▋                       | 6972/9741 [00:03<00:01, 2737.80it/s] 74%|█████████████████████████████████████████████████████████████                     | 7251/9741 [00:03<00:00, 2750.56it/s] 77%|███████████████████████████████████████████████████████████████▎                  | 7527/9741 [00:03<00:00, 2660.01it/s] 80%|█████████████████████████████████████████████████████████████████▋                | 7803/9741 [00:03<00:00, 2686.99it/s] 83%|████████████████████████████████████████████████████████████████████              | 8081/9741 [00:03<00:00, 2713.85it/s] 86%|██████████████████████████████████████████████████████████████████████▎           | 8358/9741 [00:03<00:00, 2729.76it/s] 89%|████████████████████████████████████████████████████████████████████████▋         | 8635/9741 [00:03<00:00, 2741.62it/s] 91%|███████████████████████████████████████████████████████████████████████████       | 8913/9741 [00:03<00:00, 2751.99it/s] 94%|█████████████████████████████████████████████████████████████████████████████▍    | 9192/9741 [00:03<00:00, 2760.87it/s] 97%|███████████████████████████████████████████████████████████████████████████████▋  | 9469/9741 [00:03<00:00, 2760.78it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:04<00:00, 2390.17it/s]
Load End
Num instances: 1000
[2023-08-21 23:33:33,360] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-21 23:33:36,247] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-21 23:33:36,247] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fc2a39ada60>
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-21 23:33:36,248] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fc2a39ad940>
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-21 23:33:36,249] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-21 23:33:36,249] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4459857940673828 seconds
Loading extension module utils...
Time to load utils op: 0.5048997402191162 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o2-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [01:02<51:13, 62.73s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [02:05<50:11, 62.73s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [03:08<49:25, 63.10s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [04:09<47:42, 62.22s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [05:12<46:51, 62.48s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [06:16<46:07, 62.90s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [07:19<45:01, 62.82s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [08:18<43:13, 61.75s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [09:20<42:16, 61.85s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [10:25<41:44, 62.62s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [11:27<40:38, 62.52s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [12:30<39:47, 62.83s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [13:34<38:53, 63.06s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [14:36<37:34, 62.62s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [15:37<36:14, 62.13s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [16:39<35:10, 62.08s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [17:41<34:08, 62.08s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [18:43<33:10, 62.20s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [19:45<32:08, 62.20s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [20:46<30:54, 61.82s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [21:47<29:47, 61.64s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [22:49<28:41, 61.49s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [23:51<27:44, 61.65s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [24:53<26:52, 62.03s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [25:56<25:54, 62.17s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [27:00<25:05, 62.73s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [28:02<23:56, 62.44s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [29:04<22:52, 62.40s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [30:05<21:40, 61.94s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [31:05<20:24, 61.23s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [32:08<19:37, 61.96s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [33:11<18:40, 62.23s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [34:14<17:40, 62.39s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [35:17<16:40, 62.51s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [36:20<15:41, 62.76s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [37:22<14:34, 62.45s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [38:26<13:37, 62.86s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [39:29<12:36, 63.07s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [40:33<11:35, 63.22s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [41:36<10:33, 63.40s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [42:40<09:31, 63.48s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [43:42<08:24, 63.06s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [44:44<07:19, 62.73s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [45:46<06:14, 62.48s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [46:48<05:11, 62.29s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [47:50<04:09, 62.32s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [48:54<03:08, 62.73s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [49:59<02:06, 63.27s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [51:03<01:03, 63.56s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [52:07<00:00, 63.73s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [52:07<00:00, 62.55s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.4253} | avg. gen lenth: 313.61
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 00:25:52,503] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o3-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|█▏                                                                                 | 133/9741 [00:00<00:07, 1328.84it/s]  3%|██▎                                                                                | 273/9741 [00:00<00:06, 1369.15it/s]  4%|███▌                                                                               | 414/9741 [00:00<00:06, 1386.27it/s]  6%|████▋                                                                              | 556/9741 [00:00<00:06, 1398.51it/s]  7%|█████▉                                                                             | 698/9741 [00:00<00:06, 1404.61it/s]  9%|███████▏                                                                           | 841/9741 [00:00<00:06, 1411.37it/s] 10%|████████▍                                                                          | 984/9741 [00:00<00:06, 1415.80it/s] 12%|█████████▍                                                                        | 1127/9741 [00:00<00:06, 1419.90it/s] 13%|██████████▋                                                                       | 1269/9741 [00:00<00:06, 1387.67it/s] 14%|███████████▊                                                                      | 1409/9741 [00:01<00:05, 1389.26it/s] 16%|█████████████                                                                     | 1551/9741 [00:01<00:05, 1396.66it/s] 17%|██████████████▎                                                                   | 1694/9741 [00:01<00:05, 1404.75it/s] 19%|███████████████▍                                                                  | 1835/9741 [00:01<00:05, 1388.13it/s] 20%|████████████████▋                                                                 | 1977/9741 [00:01<00:05, 1397.33it/s] 22%|█████████████████▊                                                                | 2119/9741 [00:01<00:05, 1401.94it/s] 23%|███████████████████                                                               | 2262/9741 [00:01<00:05, 1409.02it/s] 25%|████████████████████▏                                                             | 2405/9741 [00:01<00:05, 1415.17it/s] 26%|█████████████████████▍                                                            | 2548/9741 [00:01<00:05, 1417.17it/s] 28%|██████████████████████▋                                                           | 2690/9741 [00:01<00:04, 1416.25it/s] 29%|███████████████████████▊                                                          | 2833/9741 [00:02<00:04, 1417.85it/s] 31%|█████████████████████████                                                         | 2976/9741 [00:02<00:04, 1421.00it/s] 32%|██████████████████████████▎                                                       | 3120/9741 [00:02<00:04, 1425.30it/s] 34%|███████████████████████████▍                                                      | 3264/9741 [00:02<00:04, 1428.26it/s] 35%|████████████████████████████▋                                                     | 3412/9741 [00:02<00:04, 1442.78it/s] 37%|██████████████████████████████▌                                                   | 3626/9741 [00:02<00:03, 1650.05it/s] 39%|████████████████████████████████▎                                                 | 3843/9741 [00:02<00:03, 1805.52it/s] 42%|██████████████████████████████████▏                                               | 4062/9741 [00:02<00:02, 1918.37it/s] 44%|████████████████████████████████████                                              | 4281/9741 [00:02<00:02, 1997.80it/s] 46%|█████████████████████████████████████▋                                            | 4483/9741 [00:02<00:02, 2001.79it/s] 48%|███████████████████████████████████████▌                                          | 4698/9741 [00:03<00:02, 2044.17it/s] 50%|█████████████████████████████████████████▎                                        | 4903/9741 [00:03<00:03, 1586.91it/s] 53%|███████████████████████████████████████████                                       | 5118/9741 [00:03<00:02, 1726.04it/s] 55%|████████████████████████████████████████████▉                                     | 5334/9741 [00:03<00:02, 1839.23it/s] 57%|██████████████████████████████████████████████▋                                   | 5552/9741 [00:03<00:02, 1931.89it/s] 59%|████████████████████████████████████████████████▌                                 | 5769/9741 [00:03<00:01, 1998.30it/s] 61%|██████████████████████████████████████████████████▎                               | 5981/9741 [00:03<00:01, 2033.06it/s] 64%|████████████████████████████████████████████████████▏                             | 6198/9741 [00:03<00:01, 2071.81it/s] 66%|██████████████████████████████████████████████████████                            | 6415/9741 [00:03<00:01, 2099.76it/s] 68%|███████████████████████████████████████████████████████▊                          | 6628/9741 [00:04<00:01, 2103.10it/s] 70%|█████████████████████████████████████████████████████████▌                        | 6841/9741 [00:04<00:01, 2101.85it/s] 72%|███████████████████████████████████████████████████████████▍                      | 7057/9741 [00:04<00:01, 2117.38it/s] 75%|█████████████████████████████████████████████████████████████▏                    | 7273/9741 [00:04<00:01, 2129.82it/s] 77%|███████████████████████████████████████████████████████████████                   | 7487/9741 [00:04<00:01, 2100.61it/s] 79%|████████████████████████████████████████████████████████████████▊                 | 7701/9741 [00:04<00:00, 2110.89it/s] 81%|██████████████████████████████████████████████████████████████████▋               | 7916/9741 [00:04<00:00, 2122.23it/s] 83%|████████████████████████████████████████████████████████████████████▍             | 8131/9741 [00:04<00:00, 2130.07it/s] 86%|██████████████████████████████████████████████████████████████████████▏           | 8345/9741 [00:04<00:00, 2057.06it/s] 88%|███████████████████████████████████████████████████████████████████████▉          | 8552/9741 [00:04<00:00, 2051.87it/s] 90%|█████████████████████████████████████████████████████████████████████████▊        | 8764/9741 [00:05<00:00, 2071.42it/s] 92%|███████████████████████████████████████████████████████████████████████████▌      | 8975/9741 [00:05<00:00, 2080.97it/s] 94%|█████████████████████████████████████████████████████████████████████████████▎    | 9189/9741 [00:05<00:00, 2097.64it/s] 97%|███████████████████████████████████████████████████████████████████████████████▏  | 9402/9741 [00:05<00:00, 2106.89it/s] 99%|████████████████████████████████████████████████████████████████████████████████▉ | 9614/9741 [00:05<00:00, 2108.78it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:05<00:00, 1770.68it/s]
Load End
Num instances: 1000
[2023-08-22 00:26:09,014] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 00:26:11,814] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 00:26:11,815] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 00:26:11,815] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 00:26:11,815] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 00:26:11,815] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 00:26:11,815] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 00:26:11,815] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 00:26:11,815] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 00:26:11,815] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 00:26:11,815] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 00:26:11,815] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fa2de68ca60>
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fa2de68c940>
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 00:26:11,816] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 00:26:11,817] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 00:26:11,817] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 00:26:11,817] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 00:26:11,817] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.43296074867248535 seconds
Loading extension module utils...
Time to load utils op: 0.504685640335083 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o3-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [01:00<49:32, 60.66s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [02:00<48:02, 60.04s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:59<46:49, 59.77s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:58<45:39, 59.54s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [04:59<44:58, 59.96s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [05:58<43:43, 59.63s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [06:59<42:59, 59.99s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [07:57<41:38, 59.49s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [08:59<41:06, 60.15s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [10:00<40:22, 60.57s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [11:00<39:15, 60.40s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [12:00<38:06, 60.18s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [12:59<36:49, 59.71s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [13:59<35:52, 59.78s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [15:00<35:06, 60.20s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [15:59<33:56, 59.91s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [16:58<32:43, 59.51s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [17:57<31:44, 59.53s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [18:57<30:46, 59.56s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [19:56<29:40, 59.35s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [20:56<28:52, 59.74s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [21:57<27:59, 59.98s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [22:57<26:57, 59.90s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [23:56<25:57, 59.89s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [24:57<25:02, 60.11s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [25:56<23:56, 59.85s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [26:56<22:56, 59.85s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [27:58<22:06, 60.30s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [28:58<21:08, 60.42s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [29:59<20:11, 60.57s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [30:59<19:07, 60.38s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [31:58<18:00, 60.05s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [32:59<17:03, 60.21s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [34:01<16:10, 60.66s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [35:01<15:09, 60.61s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [36:04<14:17, 61.22s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [37:06<13:17, 61.37s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [38:06<12:11, 60.95s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [39:07<11:12, 61.15s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [40:08<10:10, 61.08s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [41:08<09:07, 60.85s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [42:07<08:02, 60.29s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [43:08<07:02, 60.35s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [44:08<06:02, 60.44s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [45:08<05:01, 60.21s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [46:08<04:00, 60.13s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [47:09<03:01, 60.37s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [48:10<02:00, 60.40s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [49:11<01:00, 60.85s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [50:12<00:00, 60.75s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [50:12<00:00, 60.25s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.1214} | avg. gen lenth: 348.818
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 01:16:42,052] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o4-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▉                                                                                  | 115/9741 [00:00<00:08, 1144.55it/s]  2%|█▉                                                                                 | 234/9741 [00:00<00:08, 1170.58it/s]  4%|███                                                                                | 355/9741 [00:00<00:07, 1188.09it/s]  5%|████                                                                               | 477/9741 [00:00<00:07, 1198.42it/s]  6%|█████                                                                              | 599/9741 [00:00<00:07, 1202.88it/s]  7%|██████▏                                                                            | 721/9741 [00:00<00:07, 1205.38it/s]  9%|███████▏                                                                           | 844/9741 [00:00<00:07, 1211.42it/s] 10%|████████▏                                                                          | 966/9741 [00:00<00:07, 1210.56it/s] 11%|█████████▏                                                                        | 1088/9741 [00:00<00:07, 1188.83it/s] 12%|██████████▏                                                                       | 1208/9741 [00:01<00:07, 1191.43it/s] 14%|███████████▏                                                                      | 1329/9741 [00:01<00:07, 1196.03it/s] 15%|████████████▏                                                                     | 1450/9741 [00:01<00:06, 1199.80it/s] 16%|█████████████▏                                                                    | 1571/9741 [00:01<00:06, 1202.25it/s] 17%|██████████████▎                                                                   | 1693/9741 [00:01<00:06, 1206.70it/s] 19%|███████████████▎                                                                  | 1825/9741 [00:01<00:06, 1239.40it/s] 21%|████████████████▉                                                                 | 2008/9741 [00:01<00:05, 1415.57it/s] 23%|██████████████████▍                                                               | 2192/9741 [00:01<00:04, 1540.97it/s] 24%|████████████████████                                                              | 2376/9741 [00:01<00:04, 1630.22it/s] 26%|█████████████████████▌                                                            | 2558/9741 [00:01<00:04, 1686.49it/s] 28%|███████████████████████                                                           | 2739/9741 [00:02<00:04, 1722.53it/s] 30%|████████████████████████▌                                                         | 2922/9741 [00:02<00:03, 1753.35it/s] 32%|██████████████████████████▏                                                       | 3107/9741 [00:02<00:03, 1779.77it/s] 34%|███████████████████████████▋                                                      | 3291/9741 [00:02<00:03, 1796.16it/s] 36%|█████████████████████████████▏                                                    | 3474/9741 [00:02<00:03, 1806.01it/s] 38%|██████████████████████████████▊                                                   | 3656/9741 [00:02<00:03, 1808.61it/s] 39%|████████████████████████████████▎                                                 | 3838/9741 [00:02<00:03, 1811.36it/s] 41%|█████████████████████████████████▊                                                | 4022/9741 [00:02<00:03, 1817.86it/s] 43%|███████████████████████████████████▍                                              | 4204/9741 [00:02<00:03, 1816.80it/s] 45%|████████████████████████████████████▉                                             | 4386/9741 [00:02<00:02, 1814.25it/s] 47%|██████████████████████████████████████▍                                           | 4568/9741 [00:03<00:02, 1781.84it/s] 49%|███████████████████████████████████████▉                                          | 4747/9741 [00:03<00:03, 1518.79it/s] 50%|█████████████████████████████████████████▎                                        | 4915/9741 [00:03<00:03, 1560.69it/s] 52%|██████████████████████████████████████████▉                                       | 5096/9741 [00:03<00:02, 1628.78it/s] 54%|████████████████████████████████████████████▍                                     | 5275/9741 [00:03<00:02, 1673.47it/s] 56%|█████████████████████████████████████████████▉                                    | 5455/9741 [00:03<00:02, 1707.24it/s] 58%|███████████████████████████████████████████████▍                                  | 5635/9741 [00:03<00:02, 1734.05it/s] 60%|████████████████████████████████████████████████▉                                 | 5816/9741 [00:03<00:02, 1754.69it/s] 62%|██████████████████████████████████████████████████▍                               | 5995/9741 [00:03<00:02, 1764.89it/s] 63%|███████████████████████████████████████████████████▉                              | 6175/9741 [00:03<00:02, 1774.83it/s] 65%|█████████████████████████████████████████████████████▍                            | 6354/9741 [00:04<00:01, 1775.87it/s] 67%|███████████████████████████████████████████████████████                           | 6534/9741 [00:04<00:01, 1781.33it/s] 69%|████████████████████████████████████████████████████████▌                         | 6715/9741 [00:04<00:01, 1788.11it/s] 71%|██████████████████████████████████████████████████████████                        | 6896/9741 [00:04<00:01, 1791.81it/s] 73%|███████████████████████████████████████████████████████████▌                      | 7076/9741 [00:04<00:01, 1789.68it/s] 74%|█████████████████████████████████████████████████████████████                     | 7256/9741 [00:04<00:01, 1787.79it/s] 76%|██████████████████████████████████████████████████████████████▌                   | 7435/9741 [00:04<00:01, 1761.56it/s] 78%|████████████████████████████████████████████████████████████████                  | 7614/9741 [00:04<00:01, 1768.58it/s] 80%|█████████████████████████████████████████████████████████████████▌                | 7791/9741 [00:04<00:01, 1745.75it/s] 82%|███████████████████████████████████████████████████████████████████               | 7967/9741 [00:04<00:01, 1748.95it/s] 84%|████████████████████████████████████████████████████████████████████▌             | 8146/9741 [00:05<00:00, 1759.17it/s] 85%|██████████████████████████████████████████████████████████████████████            | 8324/9741 [00:05<00:00, 1764.70it/s] 87%|███████████████████████████████████████████████████████████████████████▌          | 8504/9741 [00:05<00:00, 1774.04it/s] 89%|█████████████████████████████████████████████████████████████████████████         | 8682/9741 [00:05<00:00, 1769.65it/s] 91%|██████████████████████████████████████████████████████████████████████████▌       | 8859/9741 [00:05<00:00, 1769.62it/s] 93%|████████████████████████████████████████████████████████████████████████████      | 9037/9741 [00:05<00:00, 1771.13it/s] 95%|█████████████████████████████████████████████████████████████████████████████▌    | 9216/9741 [00:05<00:00, 1776.17it/s] 96%|███████████████████████████████████████████████████████████████████████████████   | 9394/9741 [00:05<00:00, 1774.19it/s] 98%|████████████████████████████████████████████████████████████████████████████████▌ | 9572/9741 [00:05<00:00, 1772.36it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:05<00:00, 1624.66it/s]
Load End
Num instances: 1000
[2023-08-22 01:16:59,230] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 01:17:02,052] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 01:17:02,052] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f250dcbca60>
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 01:17:02,053] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f250dcbc940>
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 01:17:02,054] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 01:17:02,054] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4700629711151123 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o4-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.40447425842285156 seconds
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:57<46:40, 57.15s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:55<46:10, 57.72s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:53<45:30, 58.09s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:49<43:52, 57.23s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [04:48<43:15, 57.68s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [05:46<42:30, 57.96s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [06:43<41:17, 57.62s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [07:40<40:13, 57.46s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [08:37<39:11, 57.35s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [09:37<38:37, 57.95s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [10:35<37:42, 58.00s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [11:32<36:39, 57.89s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [12:31<35:55, 58.25s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [13:29<34:50, 58.07s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [14:27<33:50, 58.02s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [15:26<33:00, 58.26s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [16:24<31:58, 58.15s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [17:23<31:11, 58.49s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [18:21<30:05, 58.23s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [19:18<28:54, 57.83s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [20:16<28:03, 58.04s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [21:15<27:13, 58.33s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [22:14<26:16, 58.37s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [23:12<25:18, 58.39s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [24:10<24:17, 58.32s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [25:09<23:22, 58.44s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [26:07<22:21, 58.30s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [27:04<21:12, 57.86s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [28:02<20:15, 57.87s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [29:00<19:22, 58.12s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [29:59<18:27, 58.27s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [30:55<17:20, 57.78s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [31:52<16:15, 57.41s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [32:52<15:28, 58.05s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [33:50<14:34, 58.27s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [34:48<13:33, 58.09s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [35:45<12:29, 57.63s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [36:42<11:29, 57.50s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [37:40<10:33, 57.58s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [38:38<09:39, 57.92s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [39:36<08:41, 57.98s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [40:34<07:42, 57.78s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [41:31<06:43, 57.60s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [42:29<05:46, 57.80s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [43:26<04:47, 57.58s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [44:26<03:52, 58.15s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [45:24<02:54, 58.08s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [46:21<01:55, 57.93s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [47:19<00:57, 57.89s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [48:17<00:00, 57.83s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [48:17<00:00, 57.94s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.1087} | avg. gen lenth: 359.788
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 5
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 02:05:26,393] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 5
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o5-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▊                                                                                    | 86/9741 [00:00<00:11, 855.91it/s]  2%|█▌                                                                                  | 176/9741 [00:00<00:10, 881.28it/s]  3%|██▎                                                                                 | 267/9741 [00:00<00:10, 894.07it/s]  4%|███                                                                                 | 359/9741 [00:00<00:10, 902.07it/s]  5%|███▉                                                                                | 451/9741 [00:00<00:10, 907.57it/s]  6%|████▋                                                                               | 544/9741 [00:00<00:10, 913.42it/s]  7%|█████▍                                                                              | 636/9741 [00:00<00:09, 913.91it/s]  7%|██████▎                                                                             | 729/9741 [00:00<00:09, 918.83it/s]  8%|███████                                                                             | 821/9741 [00:00<00:09, 900.34it/s]  9%|███████▊                                                                            | 912/9741 [00:01<00:09, 901.57it/s] 10%|████████▌                                                                          | 1004/9741 [00:01<00:09, 906.99it/s] 11%|█████████▎                                                                         | 1096/9741 [00:01<00:09, 910.34it/s] 12%|██████████▏                                                                        | 1189/9741 [00:01<00:09, 913.14it/s] 13%|██████████▉                                                                        | 1281/9741 [00:01<00:09, 913.59it/s] 14%|███████████▉                                                                       | 1394/9741 [00:01<00:08, 976.33it/s] 16%|████████████▉                                                                     | 1533/9741 [00:01<00:07, 1097.84it/s] 17%|██████████████                                                                    | 1673/9741 [00:01<00:06, 1185.59it/s] 19%|███████████████▏                                                                  | 1804/9741 [00:01<00:06, 1222.51it/s] 20%|████████████████▎                                                                 | 1941/9741 [00:01<00:06, 1265.00it/s] 21%|█████████████████▍                                                                | 2077/9741 [00:02<00:05, 1292.92it/s] 23%|██████████████████▋                                                               | 2214/9741 [00:02<00:05, 1313.77it/s] 24%|███████████████████▊                                                              | 2351/9741 [00:02<00:05, 1330.26it/s] 26%|████████████████████▉                                                             | 2490/9741 [00:02<00:05, 1345.28it/s] 27%|██████████████████████                                                            | 2628/9741 [00:02<00:05, 1354.61it/s] 28%|███████████████████████▎                                                          | 2765/9741 [00:02<00:05, 1357.42it/s] 30%|████████████████████████▍                                                         | 2901/9741 [00:02<00:05, 1358.04it/s] 31%|█████████████████████████▌                                                        | 3039/9741 [00:02<00:04, 1361.99it/s] 33%|██████████████████████████▋                                                       | 3176/9741 [00:02<00:04, 1361.98it/s] 34%|███████████████████████████▉                                                      | 3314/9741 [00:02<00:04, 1366.83it/s] 35%|█████████████████████████████                                                     | 3451/9741 [00:03<00:04, 1360.78it/s] 37%|██████████████████████████████▏                                                   | 3588/9741 [00:03<00:04, 1359.01it/s] 38%|███████████████████████████████▎                                                  | 3724/9741 [00:03<00:04, 1343.23it/s] 40%|████████████████████████████████▍                                                 | 3860/9741 [00:03<00:04, 1346.37it/s] 41%|█████████████████████████████████▋                                                | 3997/9741 [00:03<00:04, 1351.96it/s] 42%|██████████████████████████████████▊                                               | 4133/9741 [00:03<00:04, 1353.96it/s] 44%|███████████████████████████████████▉                                              | 4269/9741 [00:03<00:04, 1352.30it/s] 45%|█████████████████████████████████████                                             | 4405/9741 [00:03<00:03, 1354.24it/s] 47%|██████████████████████████████████████▏                                           | 4541/9741 [00:03<00:03, 1312.29it/s] 48%|███████████████████████████████████████▎                                          | 4677/9741 [00:03<00:03, 1326.07it/s] 49%|████████████████████████████████████████▍                                         | 4810/9741 [00:04<00:04, 1035.17it/s] 51%|█████████████████████████████████████████▋                                        | 4945/9741 [00:04<00:04, 1110.95it/s] 52%|██████████████████████████████████████████▊                                       | 5081/9741 [00:04<00:03, 1174.89it/s] 54%|███████████████████████████████████████████▉                                      | 5216/9741 [00:04<00:03, 1220.46it/s] 55%|█████████████████████████████████████████████                                     | 5351/9741 [00:04<00:03, 1256.01it/s] 56%|██████████████████████████████████████████████▏                                   | 5485/9741 [00:04<00:03, 1277.64it/s] 58%|███████████████████████████████████████████████▎                                  | 5620/9741 [00:04<00:03, 1296.25it/s] 59%|████████████████████████████████████████████████▍                                 | 5756/9741 [00:04<00:03, 1312.07it/s] 60%|█████████████████████████████████████████████████▌                                | 5891/9741 [00:04<00:02, 1321.72it/s] 62%|██████████████████████████████████████████████████▋                               | 6027/9741 [00:05<00:02, 1332.99it/s] 63%|███████████████████████████████████████████████████▊                              | 6162/9741 [00:05<00:02, 1336.50it/s] 65%|█████████████████████████████████████████████████████                             | 6297/9741 [00:05<00:02, 1338.20it/s] 66%|██████████████████████████████████████████████████████▏                           | 6433/9741 [00:05<00:02, 1342.62it/s] 67%|███████████████████████████████████████████████████████▎                          | 6568/9741 [00:05<00:02, 1339.50it/s] 69%|████████████████████████████████████████████████████████▍                         | 6703/9741 [00:05<00:02, 1338.89it/s] 70%|█████████████████████████████████████████████████████████▌                        | 6838/9741 [00:05<00:02, 1341.23it/s] 72%|██████████████████████████████████████████████████████████▋                       | 6973/9741 [00:05<00:02, 1340.13it/s] 73%|███████████████████████████████████████████████████████████▊                      | 7108/9741 [00:05<00:01, 1341.23it/s] 74%|████████████████████████████████████████████████████████████▉                     | 7243/9741 [00:05<00:01, 1339.29it/s] 76%|██████████████████████████████████████████████████████████████                    | 7378/9741 [00:06<00:01, 1340.49it/s] 77%|███████████████████████████████████████████████████████████████▏                  | 7513/9741 [00:06<00:01, 1310.58it/s] 78%|████████████████████████████████████████████████████████████████▎                 | 7646/9741 [00:06<00:01, 1314.29it/s] 80%|█████████████████████████████████████████████████████████████████▍                | 7780/9741 [00:06<00:01, 1320.69it/s] 81%|██████████████████████████████████████████████████████████████████▌               | 7913/9741 [00:06<00:01, 1320.64it/s] 83%|███████████████████████████████████████████████████████████████████▋              | 8046/9741 [00:06<00:01, 1297.35it/s] 84%|████████████████████████████████████████████████████████████████████▊             | 8178/9741 [00:06<00:01, 1302.13it/s] 85%|█████████████████████████████████████████████████████████████████████▉            | 8311/9741 [00:06<00:01, 1308.50it/s] 87%|███████████████████████████████████████████████████████████████████████           | 8444/9741 [00:06<00:00, 1313.61it/s] 88%|████████████████████████████████████████████████████████████████████████▏         | 8577/9741 [00:06<00:00, 1316.83it/s] 89%|█████████████████████████████████████████████████████████████████████████▎        | 8709/9741 [00:07<00:00, 1317.31it/s] 91%|██████████████████████████████████████████████████████████████████████████▍       | 8841/9741 [00:07<00:00, 1314.52it/s] 92%|███████████████████████████████████████████████████████████████████████████▌      | 8974/9741 [00:07<00:00, 1316.18it/s] 93%|████████████████████████████████████████████████████████████████████████████▋     | 9106/9741 [00:07<00:00, 1311.94it/s] 95%|█████████████████████████████████████████████████████████████████████████████▊    | 9238/9741 [00:07<00:00, 1312.74it/s] 96%|██████████████████████████████████████████████████████████████████████████████▉   | 9371/9741 [00:07<00:00, 1316.18it/s] 98%|███████████████████████████████████████████████████████████████████████████████▉  | 9503/9741 [00:07<00:00, 1314.39it/s] 99%|█████████████████████████████████████████████████████████████████████████████████ | 9636/9741 [00:07<00:00, 1316.35it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:07<00:00, 1240.90it/s]
Load End
Num instances: 1000
[2023-08-22 02:05:45,322] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 02:05:48,083] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 02:05:48,083] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 02:05:48,083] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 02:05:48,083] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 02:05:48,083] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 02:05:48,083] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f2931e18a60>
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f2931e18940>
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 02:05:48,084] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 02:05:48,085] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 02:05:48,085] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4545278549194336 seconds
Loading extension module utils...
Time to load utils op: 0.5048437118530273 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o5-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:53<43:56, 53.81s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:46<42:44, 53.43s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:41<42:20, 54.06s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:34<40:53, 53.34s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [04:28<40:26, 53.93s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [05:22<39:31, 53.91s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [06:16<38:32, 53.78s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [07:09<37:34, 53.67s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [08:02<36:34, 53.52s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [08:57<35:51, 53.79s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [09:50<34:51, 53.63s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [10:43<33:51, 53.47s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [11:37<32:56, 53.43s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [12:31<32:12, 53.68s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [13:23<31:01, 53.17s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [14:16<30:04, 53.07s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [15:08<29:03, 52.82s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [16:00<28:06, 52.71s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [16:54<27:19, 52.88s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [17:47<26:34, 53.14s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [18:40<25:38, 53.06s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [19:32<24:36, 52.72s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [20:25<23:45, 52.80s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [21:18<22:53, 52.81s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [22:12<22:07, 53.10s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [23:06<21:19, 53.31s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [23:59<20:29, 53.48s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [24:53<19:35, 53.44s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [25:47<18:48, 53.73s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [26:41<17:51, 53.60s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [27:34<16:58, 53.59s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [28:28<16:03, 53.55s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [29:22<15:14, 53.77s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [30:16<14:20, 53.76s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [31:09<13:26, 53.78s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [32:03<12:31, 53.67s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [32:57<11:38, 53.72s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [33:53<10:52, 54.40s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [34:47<09:56, 54.25s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [35:41<09:03, 54.32s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [36:34<08:05, 53.92s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [37:27<07:08, 53.60s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [38:20<06:14, 53.51s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [39:15<05:23, 54.00s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [40:08<04:27, 53.52s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [41:02<03:35, 53.83s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [41:55<02:40, 53.47s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [42:48<01:46, 53.41s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [43:42<00:53, 53.60s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [44:37<00:00, 53.93s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [44:37<00:00, 53.55s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 0.9891} | avg. gen lenth: 397.816
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 6
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 02:51:00,603] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 6
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o6-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▋                                                                                    | 76/9741 [00:00<00:12, 752.44it/s]  2%|█▎                                                                                  | 155/9741 [00:00<00:12, 770.50it/s]  2%|██                                                                                  | 234/9741 [00:00<00:12, 779.11it/s]  3%|██▋                                                                                 | 314/9741 [00:00<00:11, 786.26it/s]  4%|███▍                                                                                | 394/9741 [00:00<00:11, 790.85it/s]  5%|████                                                                                | 474/9741 [00:00<00:11, 792.27it/s]  6%|████▊                                                                               | 555/9741 [00:00<00:11, 795.44it/s]  7%|█████▍                                                                              | 635/9741 [00:00<00:11, 776.79it/s]  7%|██████▏                                                                             | 715/9741 [00:00<00:11, 781.12it/s]  8%|██████▊                                                                             | 796/9741 [00:01<00:11, 787.54it/s]  9%|███████▌                                                                            | 876/9741 [00:01<00:11, 791.02it/s] 10%|████████▎                                                                           | 957/9741 [00:01<00:11, 794.86it/s] 11%|████████▊                                                                          | 1038/9741 [00:01<00:10, 797.54it/s] 11%|█████████▌                                                                         | 1118/9741 [00:01<00:10, 797.75it/s] 12%|██████████▏                                                                        | 1199/9741 [00:01<00:10, 798.46it/s] 13%|██████████▉                                                                        | 1280/9741 [00:01<00:10, 799.03it/s] 14%|███████████▌                                                                       | 1360/9741 [00:01<00:10, 798.30it/s] 15%|████████████▎                                                                      | 1440/9741 [00:01<00:10, 795.84it/s] 16%|████████████▉                                                                      | 1520/9741 [00:01<00:10, 795.54it/s] 16%|█████████████▋                                                                     | 1600/9741 [00:02<00:10, 794.80it/s] 17%|██████████████▎                                                                    | 1681/9741 [00:02<00:10, 796.96it/s] 18%|███████████████▏                                                                   | 1786/9741 [00:02<00:09, 871.38it/s] 20%|████████████████▏                                                                  | 1907/9741 [00:02<00:08, 970.50it/s] 21%|█████████████████                                                                 | 2027/9741 [00:02<00:07, 1037.64it/s] 22%|██████████████████                                                                | 2147/9741 [00:02<00:06, 1085.67it/s] 23%|███████████████████                                                               | 2267/9741 [00:02<00:06, 1117.29it/s] 25%|████████████████████                                                              | 2387/9741 [00:02<00:06, 1140.39it/s] 26%|█████████████████████                                                             | 2506/9741 [00:02<00:06, 1153.22it/s] 27%|██████████████████████                                                            | 2626/9741 [00:02<00:06, 1165.07it/s] 28%|███████████████████████                                                           | 2745/9741 [00:03<00:05, 1171.24it/s] 29%|████████████████████████                                                          | 2863/9741 [00:03<00:05, 1160.45it/s] 31%|█████████████████████████                                                         | 2980/9741 [00:03<00:05, 1162.60it/s] 32%|██████████████████████████                                                        | 3099/9741 [00:03<00:05, 1169.58it/s] 33%|███████████████████████████                                                       | 3219/9741 [00:03<00:05, 1175.90it/s] 34%|████████████████████████████                                                      | 3338/9741 [00:03<00:05, 1179.86it/s] 35%|█████████████████████████████                                                     | 3456/9741 [00:03<00:05, 1177.94it/s] 37%|██████████████████████████████                                                    | 3575/9741 [00:03<00:05, 1176.71it/s] 38%|███████████████████████████████                                                   | 3694/9741 [00:03<00:05, 1179.26it/s] 39%|████████████████████████████████                                                  | 3812/9741 [00:03<00:05, 1178.43it/s] 40%|█████████████████████████████████                                                 | 3931/9741 [00:04<00:04, 1180.53it/s] 42%|██████████████████████████████████                                                | 4050/9741 [00:04<00:04, 1177.52it/s] 43%|███████████████████████████████████                                               | 4169/9741 [00:04<00:04, 1178.92it/s] 44%|████████████████████████████████████                                              | 4287/9741 [00:04<00:04, 1177.23it/s] 45%|█████████████████████████████████████                                             | 4406/9741 [00:04<00:04, 1178.41it/s] 46%|██████████████████████████████████████                                            | 4524/9741 [00:04<00:04, 1144.07it/s] 48%|███████████████████████████████████████                                           | 4642/9741 [00:04<00:04, 1154.47it/s] 49%|████████████████████████████████████████▌                                          | 4758/9741 [00:04<00:05, 897.18it/s] 50%|█████████████████████████████████████████▌                                         | 4875/9741 [00:04<00:05, 964.33it/s] 51%|██████████████████████████████████████████                                        | 4992/9741 [00:05<00:04, 1017.27it/s] 52%|███████████████████████████████████████████                                       | 5110/9741 [00:05<00:04, 1060.89it/s] 54%|████████████████████████████████████████████                                      | 5227/9741 [00:05<00:04, 1090.77it/s] 55%|████████████████████████████████████████████▉                                     | 5345/9741 [00:05<00:03, 1113.56it/s] 56%|█████████████████████████████████████████████▉                                    | 5462/9741 [00:05<00:03, 1128.44it/s] 57%|██████████████████████████████████████████████▉                                   | 5579/9741 [00:05<00:03, 1140.31it/s] 58%|███████████████████████████████████████████████▉                                  | 5696/9741 [00:05<00:03, 1147.68it/s] 60%|████████████████████████████████████████████████▉                                 | 5813/9741 [00:05<00:03, 1154.02it/s] 61%|█████████████████████████████████████████████████▉                                | 5930/9741 [00:05<00:03, 1157.69it/s] 62%|██████████████████████████████████████████████████▉                               | 6048/9741 [00:05<00:03, 1160.72it/s] 63%|███████████████████████████████████████████████████▉                              | 6166/9741 [00:06<00:03, 1163.74it/s] 65%|████████████████████████████████████████████████████▉                             | 6283/9741 [00:06<00:02, 1160.98it/s] 66%|█████████████████████████████████████████████████████▉                            | 6401/9741 [00:06<00:02, 1164.22it/s] 67%|██████████████████████████████████████████████████████▊                           | 6518/9741 [00:06<00:02, 1163.97it/s] 68%|███████████████████████████████████████████████████████▊                          | 6635/9741 [00:06<00:02, 1164.34it/s] 69%|████████████████████████████████████████████████████████▊                         | 6752/9741 [00:06<00:02, 1141.62it/s] 71%|█████████████████████████████████████████████████████████▊                        | 6869/9741 [00:06<00:02, 1147.68it/s] 72%|██████████████████████████████████████████████████████████▊                       | 6984/9741 [00:06<00:02, 1147.66it/s] 73%|███████████████████████████████████████████████████████████▊                      | 7101/9741 [00:06<00:02, 1152.97it/s] 74%|████████████████████████████████████████████████████████████▊                     | 7217/9741 [00:06<00:02, 1152.78it/s] 75%|█████████████████████████████████████████████████████████████▋                    | 7334/9741 [00:07<00:02, 1156.29it/s] 76%|██████████████████████████████████████████████████████████████▋                   | 7450/9741 [00:07<00:02, 1119.83it/s] 78%|███████████████████████████████████████████████████████████████▋                  | 7566/9741 [00:07<00:01, 1130.24it/s] 79%|████████████████████████████████████████████████████████████████▋                 | 7681/9741 [00:07<00:01, 1135.49it/s] 80%|█████████████████████████████████████████████████████████████████▋                | 7798/9741 [00:07<00:01, 1143.42it/s] 81%|██████████████████████████████████████████████████████████████████▌               | 7914/9741 [00:07<00:01, 1147.63it/s] 82%|███████████████████████████████████████████████████████████████████▌              | 8030/9741 [00:07<00:01, 1150.48it/s] 84%|████████████████████████████████████████████████████████████████████▌             | 8146/9741 [00:07<00:01, 1147.97it/s] 85%|█████████████████████████████████████████████████████████████████████▌            | 8262/9741 [00:07<00:01, 1151.11it/s] 86%|██████████████████████████████████████████████████████████████████████▌           | 8378/9741 [00:07<00:01, 1151.46it/s] 87%|███████████████████████████████████████████████████████████████████████▌          | 8495/9741 [00:08<00:01, 1154.27it/s] 88%|████████████████████████████████████████████████████████████████████████▍         | 8611/9741 [00:08<00:00, 1149.98it/s] 90%|█████████████████████████████████████████████████████████████████████████▍        | 8727/9741 [00:08<00:00, 1147.01it/s] 91%|██████████████████████████████████████████████████████████████████████████▍       | 8842/9741 [00:08<00:00, 1146.94it/s] 92%|███████████████████████████████████████████████████████████████████████████▍      | 8958/9741 [00:08<00:00, 1150.13it/s] 93%|████████████████████████████████████████████████████████████████████████████▍     | 9074/9741 [00:08<00:00, 1149.38it/s] 94%|█████████████████████████████████████████████████████████████████████████████▎    | 9189/9741 [00:08<00:00, 1148.34it/s] 96%|██████████████████████████████████████████████████████████████████████████████▎   | 9304/9741 [00:08<00:00, 1140.29it/s] 97%|███████████████████████████████████████████████████████████████████████████████▎  | 9421/9741 [00:08<00:00, 1146.48it/s] 98%|████████████████████████████████████████████████████████████████████████████████▎ | 9537/9741 [00:08<00:00, 1147.95it/s] 99%|█████████████████████████████████████████████████████████████████████████████████▎| 9652/9741 [00:09<00:00, 1147.16it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:09<00:00, 1062.42it/s]
Load End
Num instances: 1000
[2023-08-22 02:51:20,814] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 02:51:23,522] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 02:51:23,523] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f93cf8c4a60>
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 02:51:23,523] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f93cf8c4940>
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 02:51:23,524] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 02:51:23,524] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.43784022331237793 seconds
Loading extension module utils...
Time to load utils op: 0.5048606395721436 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o6-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:51<42:00, 51.43s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:42<41:11, 51.49s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:35<40:43, 51.99s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:27<39:56, 52.09s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [04:20<39:11, 52.26s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [05:13<38:28, 52.46s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [06:04<37:23, 52.17s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [06:55<36:10, 51.67s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [07:48<35:35, 52.07s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [08:41<34:53, 52.34s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [09:31<33:41, 51.83s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [10:23<32:42, 51.64s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [11:15<31:58, 51.85s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [12:07<31:08, 51.91s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [12:59<30:17, 51.94s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [13:52<29:32, 52.14s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [14:43<28:30, 51.84s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [15:34<27:30, 51.59s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [16:26<26:45, 51.79s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [17:17<25:44, 51.50s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [18:08<24:49, 51.35s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [18:59<23:53, 51.21s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [19:49<22:55, 50.93s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [20:40<22:06, 51.03s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [21:32<21:17, 51.09s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [22:23<20:30, 51.25s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [23:15<19:45, 51.55s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [24:06<18:50, 51.40s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [24:58<18:02, 51.54s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [25:51<17:15, 51.78s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [26:45<16:36, 52.44s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [27:36<15:40, 52.26s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [28:29<14:48, 52.24s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [29:20<13:53, 52.09s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [30:13<13:04, 52.31s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [31:05<12:09, 52.10s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [31:56<11:11, 51.69s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [32:48<10:24, 52.02s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [33:40<09:31, 51.96s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [34:34<08:45, 52.52s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [35:26<07:50, 52.27s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [36:17<06:55, 51.96s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [37:09<06:03, 51.90s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [38:00<05:09, 51.58s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [38:51<04:17, 51.46s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [39:44<03:27, 51.95s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [40:35<02:35, 51.86s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [41:28<01:43, 52.00s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [42:19<00:51, 51.89s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [43:12<00:00, 51.96s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [43:12<00:00, 51.84s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.3574} | avg. gen lenth: 381.476
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 7
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 03:34:44,680] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 7
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o7-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                    | 71/9741 [00:00<00:13, 701.44it/s]  1%|█▎                                                                                  | 145/9741 [00:00<00:13, 721.36it/s]  2%|█▉                                                                                  | 219/9741 [00:00<00:13, 726.02it/s]  3%|██▌                                                                                 | 294/9741 [00:00<00:12, 733.02it/s]  4%|███▏                                                                                | 370/9741 [00:00<00:12, 739.58it/s]  5%|███▊                                                                                | 445/9741 [00:00<00:12, 739.80it/s]  5%|████▍                                                                               | 521/9741 [00:00<00:12, 743.53it/s]  6%|█████▏                                                                              | 596/9741 [00:00<00:12, 745.23it/s]  7%|█████▊                                                                              | 671/9741 [00:00<00:12, 727.43it/s]  8%|██████▍                                                                             | 746/9741 [00:01<00:12, 732.85it/s]  8%|███████                                                                             | 821/9741 [00:01<00:12, 737.67it/s]  9%|███████▋                                                                            | 896/9741 [00:01<00:11, 739.59it/s] 10%|████████▎                                                                           | 971/9741 [00:01<00:11, 742.69it/s] 11%|████████▉                                                                          | 1047/9741 [00:01<00:11, 745.15it/s] 12%|█████████▌                                                                         | 1122/9741 [00:01<00:11, 744.99it/s] 12%|██████████▏                                                                        | 1197/9741 [00:01<00:11, 738.85it/s] 13%|██████████▊                                                                        | 1273/9741 [00:01<00:11, 742.32it/s] 14%|███████████▍                                                                       | 1348/9741 [00:01<00:11, 743.87it/s] 15%|████████████                                                                       | 1423/9741 [00:01<00:11, 743.13it/s] 15%|████████████▊                                                                      | 1498/9741 [00:02<00:11, 743.38it/s] 16%|█████████████▍                                                                     | 1573/9741 [00:02<00:10, 743.66it/s] 17%|██████████████                                                                     | 1648/9741 [00:02<00:10, 745.27it/s] 18%|██████████████▋                                                                    | 1723/9741 [00:02<00:10, 746.14it/s] 18%|███████████████▎                                                                   | 1798/9741 [00:02<00:10, 728.89it/s] 19%|███████████████▉                                                                   | 1873/9741 [00:02<00:10, 733.26it/s] 20%|████████████████▌                                                                  | 1948/9741 [00:02<00:10, 736.88it/s] 21%|█████████████████▏                                                                 | 2023/9741 [00:02<00:10, 738.20it/s] 22%|█████████████████▉                                                                 | 2098/9741 [00:02<00:10, 739.09it/s] 22%|██████████████████▌                                                                | 2173/9741 [00:02<00:10, 741.21it/s] 23%|███████████████████▏                                                               | 2248/9741 [00:03<00:10, 741.44it/s] 24%|███████████████████▊                                                               | 2323/9741 [00:03<00:10, 741.34it/s] 25%|████████████████████▍                                                              | 2398/9741 [00:03<00:10, 731.56it/s] 25%|█████████████████████                                                              | 2472/9741 [00:03<00:09, 732.22it/s] 26%|█████████████████████▋                                                             | 2546/9741 [00:03<00:09, 734.34it/s] 27%|██████████████████████▎                                                            | 2621/9741 [00:03<00:09, 737.62it/s] 28%|███████████████████████▎                                                           | 2730/9741 [00:03<00:08, 842.15it/s] 29%|████████████████████████▏                                                          | 2841/9741 [00:03<00:07, 920.32it/s] 30%|█████████████████████████▏                                                         | 2952/9741 [00:03<00:06, 974.47it/s] 31%|█████████████████████████▊                                                        | 3064/9741 [00:03<00:06, 1015.22it/s] 33%|██████████████████████████▋                                                       | 3175/9741 [00:04<00:06, 1041.98it/s] 34%|███████████████████████████▋                                                      | 3286/9741 [00:04<00:06, 1062.02it/s] 35%|████████████████████████████▌                                                     | 3396/9741 [00:04<00:05, 1072.17it/s] 36%|█████████████████████████████▌                                                    | 3507/9741 [00:04<00:05, 1080.77it/s] 37%|██████████████████████████████▍                                                   | 3617/9741 [00:04<00:05, 1084.93it/s] 38%|███████████████████████████████▎                                                  | 3726/9741 [00:04<00:05, 1047.19it/s] 39%|████████████████████████████████▎                                                 | 3836/9741 [00:04<00:05, 1061.06it/s] 41%|█████████████████████████████████▏                                                | 3947/9741 [00:04<00:05, 1074.42it/s] 42%|██████████████████████████████████▏                                               | 4057/9741 [00:04<00:05, 1079.80it/s] 43%|███████████████████████████████████                                               | 4168/9741 [00:04<00:05, 1086.18it/s] 44%|████████████████████████████████████                                              | 4278/9741 [00:05<00:05, 1089.66it/s] 45%|████████████████████████████████████▉                                             | 4389/9741 [00:05<00:04, 1093.19it/s] 46%|█████████████████████████████████████▊                                            | 4499/9741 [00:05<00:04, 1061.85it/s] 47%|██████████████████████████████████████▊                                           | 4609/9741 [00:05<00:04, 1071.75it/s] 48%|████████████████████████████████████████▏                                          | 4717/9741 [00:05<00:06, 819.63it/s] 50%|█████████████████████████████████████████▏                                         | 4827/9741 [00:05<00:05, 885.99it/s] 51%|██████████████████████████████████████████                                         | 4936/9741 [00:05<00:05, 936.97it/s] 52%|██████████████████████████████████████████▉                                        | 5046/9741 [00:05<00:04, 979.49it/s] 53%|███████████████████████████████████████████▍                                      | 5154/9741 [00:05<00:04, 1006.39it/s] 54%|████████████████████████████████████████████▎                                     | 5264/9741 [00:06<00:04, 1031.02it/s] 55%|█████████████████████████████████████████████▏                                    | 5373/9741 [00:06<00:04, 1045.81it/s] 56%|██████████████████████████████████████████████▏                                   | 5482/9741 [00:06<00:04, 1056.43it/s] 57%|███████████████████████████████████████████████                                   | 5591/9741 [00:06<00:03, 1065.36it/s] 59%|███████████████████████████████████████████████▉                                  | 5699/9741 [00:06<00:03, 1069.29it/s] 60%|████████████████████████████████████████████████▉                                 | 5807/9741 [00:06<00:03, 1056.10it/s] 61%|█████████████████████████████████████████████████▊                                | 5914/9741 [00:06<00:03, 1059.91it/s] 62%|██████████████████████████████████████████████████▋                               | 6023/9741 [00:06<00:03, 1066.70it/s] 63%|███████████████████████████████████████████████████▌                              | 6130/9741 [00:06<00:03, 1066.88it/s] 64%|████████████████████████████████████████████████████▌                             | 6238/9741 [00:06<00:03, 1068.77it/s] 65%|█████████████████████████████████████████████████████▍                            | 6346/9741 [00:07<00:03, 1069.99it/s] 66%|██████████████████████████████████████████████████████▎                           | 6455/9741 [00:07<00:03, 1073.34it/s] 67%|███████████████████████████████████████████████████████▏                          | 6563/9741 [00:07<00:02, 1072.09it/s] 68%|████████████████████████████████████████████████████████▏                         | 6671/9741 [00:07<00:02, 1073.27it/s] 70%|█████████████████████████████████████████████████████████                         | 6779/9741 [00:07<00:02, 1073.31it/s] 71%|█████████████████████████████████████████████████████████▉                        | 6887/9741 [00:07<00:02, 1075.00it/s] 72%|██████████████████████████████████████████████████████████▉                       | 6995/9741 [00:07<00:02, 1073.50it/s] 73%|███████████████████████████████████████████████████████████▊                      | 7103/9741 [00:07<00:02, 1073.37it/s] 74%|████████████████████████████████████████████████████████████▋                     | 7211/9741 [00:07<00:02, 1070.47it/s] 75%|█████████████████████████████████████████████████████████████▌                    | 7319/9741 [00:08<00:02, 1070.64it/s] 76%|██████████████████████████████████████████████████████████████▌                   | 7427/9741 [00:08<00:02, 1041.03it/s] 77%|███████████████████████████████████████████████████████████████▍                  | 7535/9741 [00:08<00:02, 1050.64it/s] 78%|████████████████████████████████████████████████████████████████▎                 | 7641/9741 [00:08<00:01, 1051.62it/s] 80%|█████████████████████████████████████████████████████████████████▏                | 7749/9741 [00:08<00:01, 1057.61it/s] 81%|██████████████████████████████████████████████████████████████████▏               | 7856/9741 [00:08<00:01, 1059.36it/s] 82%|███████████████████████████████████████████████████████████████████               | 7962/9741 [00:08<00:01, 1058.45it/s] 83%|███████████████████████████████████████████████████████████████████▉              | 8069/9741 [00:08<00:01, 1061.65it/s] 84%|████████████████████████████████████████████████████████████████████▊             | 8176/9741 [00:08<00:01, 1062.00it/s] 85%|█████████████████████████████████████████████████████████████████████▋            | 8283/9741 [00:08<00:01, 1063.87it/s] 86%|██████████████████████████████████████████████████████████████████████▋           | 8390/9741 [00:09<00:01, 1063.05it/s] 87%|███████████████████████████████████████████████████████████████████████▌          | 8498/9741 [00:09<00:01, 1066.00it/s] 88%|████████████████████████████████████████████████████████████████████████▍         | 8605/9741 [00:09<00:01, 1063.25it/s] 89%|█████████████████████████████████████████████████████████████████████████▎        | 8712/9741 [00:09<00:00, 1063.67it/s] 91%|██████████████████████████████████████████████████████████████████████████▏       | 8819/9741 [00:09<00:00, 1061.64it/s] 92%|███████████████████████████████████████████████████████████████████████████▏      | 8926/9741 [00:09<00:00, 1062.00it/s] 93%|████████████████████████████████████████████████████████████████████████████      | 9033/9741 [00:09<00:00, 1058.97it/s] 94%|████████████████████████████████████████████████████████████████████████████▉     | 9140/9741 [00:09<00:00, 1059.38it/s] 95%|█████████████████████████████████████████████████████████████████████████████▊    | 9246/9741 [00:09<00:00, 1056.97it/s] 96%|██████████████████████████████████████████████████████████████████████████████▋   | 9352/9741 [00:09<00:00, 1056.33it/s] 97%|███████████████████████████████████████████████████████████████████████████████▌  | 9458/9741 [00:10<00:00, 1052.33it/s] 98%|████████████████████████████████████████████████████████████████████████████████▌ | 9564/9741 [00:10<00:00, 1053.59it/s] 99%|█████████████████████████████████████████████████████████████████████████████████▍| 9670/9741 [00:10<00:00, 1052.62it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:10<00:00, 945.61it/s]
Load End
Num instances: 1000
[2023-08-22 03:35:05,966] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 03:35:08,690] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 03:35:08,690] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f2852876a60>
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 03:35:08,691] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f2852876940>
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 03:35:08,692] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 03:35:08,692] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.45701169967651367 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o7-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.504040002822876 seconds
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:52<42:43, 52.32s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:43<41:14, 51.56s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:36<40:55, 52.24s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:26<39:31, 51.55s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [04:19<38:53, 51.85s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [05:11<38:02, 51.87s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [06:01<36:48, 51.35s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [06:52<35:58, 51.39s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [07:44<35:12, 51.53s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [08:36<34:25, 51.64s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [09:27<33:24, 51.39s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [10:19<32:38, 51.54s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [11:10<31:40, 51.37s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [12:00<30:38, 51.07s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [12:50<29:32, 50.64s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [13:41<28:45, 50.76s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [14:31<27:51, 50.64s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [15:22<27:04, 50.76s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [16:14<26:26, 51.17s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [17:05<25:30, 51.02s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [17:56<24:34, 50.84s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [18:46<23:38, 50.67s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [19:35<22:38, 50.31s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [20:26<21:54, 50.55s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [21:18<21:12, 50.89s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [22:10<20:27, 51.16s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [23:01<19:34, 51.07s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [23:51<18:38, 50.85s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [24:42<17:45, 50.75s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [25:33<17:00, 51.03s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [26:25<16:10, 51.10s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [27:16<15:20, 51.15s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [28:07<14:28, 51.07s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [28:57<13:32, 50.77s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [29:48<12:41, 50.78s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [30:39<11:52, 50.87s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [31:30<11:03, 51.05s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [32:23<10:17, 51.48s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [33:14<09:26, 51.54s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [34:07<08:39, 51.96s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [34:58<07:43, 51.55s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [35:47<06:47, 50.91s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [36:37<05:54, 50.59s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [37:28<05:03, 50.64s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [38:18<04:13, 50.65s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [39:10<03:23, 50.95s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [40:01<02:32, 50.83s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [40:51<01:41, 50.77s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [41:44<00:51, 51.30s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [42:34<00:00, 50.95s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [42:34<00:00, 51.09s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.2592} | avg. gen lenth: 387.98
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 8
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 04:17:53,694] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 8
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o8-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                    | 63/9741 [00:00<00:15, 629.71it/s]  1%|█                                                                                   | 130/9741 [00:00<00:14, 649.51it/s]  2%|█▋                                                                                  | 196/9741 [00:00<00:14, 653.88it/s]  3%|██▎                                                                                 | 263/9741 [00:00<00:14, 659.19it/s]  3%|██▊                                                                                 | 331/9741 [00:00<00:14, 663.75it/s]  4%|███▍                                                                                | 398/9741 [00:00<00:14, 665.05it/s]  5%|████                                                                                | 466/9741 [00:00<00:13, 668.19it/s]  5%|████▌                                                                               | 533/9741 [00:00<00:13, 668.69it/s]  6%|█████▏                                                                              | 600/9741 [00:00<00:13, 656.75it/s]  7%|█████▊                                                                              | 667/9741 [00:01<00:13, 659.53it/s]  8%|██████▎                                                                             | 735/9741 [00:01<00:13, 663.05it/s]  8%|██████▉                                                                             | 803/9741 [00:01<00:13, 665.85it/s]  9%|███████▌                                                                            | 870/9741 [00:01<00:13, 667.05it/s] 10%|████████                                                                            | 938/9741 [00:01<00:13, 669.55it/s] 10%|████████▌                                                                          | 1006/9741 [00:01<00:13, 671.32it/s] 11%|█████████▏                                                                         | 1074/9741 [00:01<00:12, 673.47it/s] 12%|█████████▋                                                                         | 1142/9741 [00:01<00:12, 672.65it/s] 13%|██████████▍                                                                        | 1228/9741 [00:01<00:11, 728.55it/s] 14%|███████████▎                                                                       | 1327/9741 [00:01<00:10, 806.08it/s] 15%|████████████▏                                                                      | 1428/9741 [00:02<00:09, 865.69it/s] 16%|█████████████                                                                      | 1529/9741 [00:02<00:09, 907.58it/s] 17%|█████████████▉                                                                     | 1630/9741 [00:02<00:08, 936.15it/s] 18%|██████████████▋                                                                    | 1731/9741 [00:02<00:08, 957.22it/s] 19%|███████████████▌                                                                   | 1827/9741 [00:02<00:08, 950.05it/s] 20%|████████████████▍                                                                  | 1927/9741 [00:02<00:08, 963.71it/s] 21%|█████████████████▎                                                                 | 2026/9741 [00:02<00:07, 970.48it/s] 22%|██████████████████                                                                 | 2126/9741 [00:02<00:07, 976.65it/s] 23%|██████████████████▉                                                                | 2226/9741 [00:02<00:07, 981.13it/s] 24%|███████████████████▊                                                               | 2326/9741 [00:02<00:07, 985.27it/s] 25%|████████████████████▋                                                              | 2426/9741 [00:03<00:07, 986.89it/s] 26%|█████████████████████▌                                                             | 2525/9741 [00:03<00:07, 970.86it/s] 27%|██████████████████████▎                                                            | 2624/9741 [00:03<00:07, 974.13it/s] 28%|███████████████████████▏                                                           | 2723/9741 [00:03<00:07, 975.90it/s] 29%|████████████████████████                                                           | 2822/9741 [00:03<00:07, 978.32it/s] 30%|████████████████████████▉                                                          | 2920/9741 [00:03<00:06, 978.09it/s] 31%|█████████████████████████▋                                                         | 3019/9741 [00:03<00:06, 981.20it/s] 32%|██████████████████████████▌                                                        | 3118/9741 [00:03<00:06, 982.71it/s] 33%|███████████████████████████▍                                                       | 3217/9741 [00:03<00:06, 983.35it/s] 34%|████████████████████████████▎                                                      | 3316/9741 [00:03<00:06, 983.06it/s] 35%|█████████████████████████████                                                      | 3415/9741 [00:04<00:06, 981.11it/s] 36%|█████████████████████████████▉                                                     | 3514/9741 [00:04<00:06, 980.14it/s] 37%|██████████████████████████████▊                                                    | 3613/9741 [00:04<00:06, 978.46it/s] 38%|███████████████████████████████▌                                                   | 3711/9741 [00:04<00:06, 973.66it/s] 39%|████████████████████████████████▍                                                  | 3809/9741 [00:04<00:06, 970.63it/s] 40%|█████████████████████████████████▎                                                 | 3907/9741 [00:04<00:05, 973.32it/s] 41%|██████████████████████████████████▏                                                | 4005/9741 [00:04<00:05, 974.26it/s] 42%|██████████████████████████████████▉                                                | 4103/9741 [00:04<00:05, 972.88it/s] 43%|███████████████████████████████████▊                                               | 4201/9741 [00:04<00:05, 962.55it/s] 44%|████████████████████████████████████▌                                              | 4298/9741 [00:04<00:05, 962.96it/s] 45%|█████████████████████████████████████▍                                             | 4395/9741 [00:05<00:05, 962.68it/s] 46%|██████████████████████████████████████▎                                            | 4492/9741 [00:05<00:05, 924.13it/s] 47%|███████████████████████████████████████                                            | 4590/9741 [00:05<00:05, 938.33it/s] 48%|███████████████████████████████████████▉                                           | 4688/9741 [00:05<00:05, 949.27it/s] 49%|████████████████████████████████████████▊                                          | 4784/9741 [00:05<00:06, 787.27it/s] 50%|█████████████████████████████████████████▌                                         | 4881/9741 [00:05<00:05, 833.90it/s] 51%|██████████████████████████████████████████▍                                        | 4978/9741 [00:05<00:05, 868.69it/s] 52%|███████████████████████████████████████████▎                                       | 5076/9741 [00:05<00:05, 897.05it/s] 53%|████████████████████████████████████████████                                       | 5173/9741 [00:05<00:04, 915.87it/s] 54%|████████████████████████████████████████████▉                                      | 5270/9741 [00:06<00:04, 930.76it/s] 55%|█████████████████████████████████████████████▋                                     | 5367/9741 [00:06<00:04, 940.25it/s] 56%|██████████████████████████████████████████████▌                                    | 5464/9741 [00:06<00:04, 947.22it/s] 57%|███████████████████████████████████████████████▍                                   | 5561/9741 [00:06<00:04, 952.58it/s] 58%|████████████████████████████████████████████████▏                                  | 5657/9741 [00:06<00:04, 952.98it/s] 59%|█████████████████████████████████████████████████                                  | 5753/9741 [00:06<00:04, 953.95it/s] 60%|█████████████████████████████████████████████████▊                                 | 5849/9741 [00:06<00:04, 954.17it/s] 61%|██████████████████████████████████████████████████▋                                | 5946/9741 [00:06<00:03, 957.53it/s] 62%|███████████████████████████████████████████████████▍                               | 6043/9741 [00:06<00:03, 960.30it/s] 63%|████████████████████████████████████████████████████▎                              | 6140/9741 [00:06<00:03, 959.94it/s] 64%|█████████████████████████████████████████████████████▏                             | 6237/9741 [00:07<00:03, 958.69it/s] 65%|█████████████████████████████████████████████████████▉                             | 6333/9741 [00:07<00:03, 956.10it/s] 66%|██████████████████████████████████████████████████████▊                            | 6429/9741 [00:07<00:03, 957.07it/s] 67%|███████████████████████████████████████████████████████▌                           | 6525/9741 [00:07<00:03, 956.06it/s] 68%|████████████████████████████████████████████████████████▍                          | 6621/9741 [00:07<00:03, 956.90it/s] 69%|█████████████████████████████████████████████████████████▏                         | 6717/9741 [00:07<00:03, 957.62it/s] 70%|██████████████████████████████████████████████████████████                         | 6813/9741 [00:07<00:03, 957.28it/s] 71%|██████████████████████████████████████████████████████████▉                        | 6910/9741 [00:07<00:02, 958.53it/s] 72%|███████████████████████████████████████████████████████████▋                       | 7006/9741 [00:07<00:02, 956.16it/s] 73%|████████████████████████████████████████████████████████████▌                      | 7102/9741 [00:07<00:02, 957.04it/s] 74%|█████████████████████████████████████████████████████████████▎                     | 7198/9741 [00:08<00:02, 956.67it/s] 75%|██████████████████████████████████████████████████████████████▏                    | 7295/9741 [00:08<00:02, 957.59it/s] 76%|██████████████████████████████████████████████████████████████▉                    | 7391/9741 [00:08<00:02, 958.22it/s] 77%|███████████████████████████████████████████████████████████████▊                   | 7487/9741 [00:08<00:02, 929.73it/s] 78%|████████████████████████████████████████████████████████████████▌                  | 7582/9741 [00:08<00:02, 935.15it/s] 79%|█████████████████████████████████████████████████████████████████▍                 | 7677/9741 [00:08<00:02, 938.28it/s] 80%|██████████████████████████████████████████████████████████████████▏                | 7773/9741 [00:08<00:02, 943.27it/s] 81%|███████████████████████████████████████████████████████████████████                | 7868/9741 [00:08<00:02, 927.25it/s] 82%|███████████████████████████████████████████████████████████████████▊               | 7964/9741 [00:08<00:01, 935.39it/s] 83%|████████████████████████████████████████████████████████████████████▋              | 8060/9741 [00:08<00:01, 940.61it/s] 84%|█████████████████████████████████████████████████████████████████████▍             | 8155/9741 [00:09<00:01, 942.50it/s] 85%|██████████████████████████████████████████████████████████████████████▎            | 8251/9741 [00:09<00:01, 946.04it/s] 86%|███████████████████████████████████████████████████████████████████████            | 8346/9741 [00:09<00:01, 945.97it/s] 87%|███████████████████████████████████████████████████████████████████████▉           | 8442/9741 [00:09<00:01, 947.27it/s] 88%|████████████████████████████████████████████████████████████████████████▋          | 8537/9741 [00:09<00:01, 946.68it/s] 89%|█████████████████████████████████████████████████████████████████████████▌         | 8632/9741 [00:09<00:01, 945.87it/s] 90%|██████████████████████████████████████████████████████████████████████████▎        | 8727/9741 [00:09<00:01, 946.18it/s] 91%|███████████████████████████████████████████████████████████████████████████▏       | 8822/9741 [00:09<00:00, 944.83it/s] 92%|███████████████████████████████████████████████████████████████████████████▉       | 8917/9741 [00:09<00:00, 946.02it/s] 93%|████████████████████████████████████████████████████████████████████████████▊      | 9012/9741 [00:09<00:00, 944.93it/s] 93%|█████████████████████████████████████████████████████████████████████████████▌     | 9107/9741 [00:10<00:00, 945.26it/s] 94%|██████████████████████████████████████████████████████████████████████████████▍    | 9202/9741 [00:10<00:00, 946.10it/s] 95%|███████████████████████████████████████████████████████████████████████████████▏   | 9297/9741 [00:10<00:00, 944.93it/s] 96%|████████████████████████████████████████████████████████████████████████████████   | 9392/9741 [00:10<00:00, 946.01it/s] 97%|████████████████████████████████████████████████████████████████████████████████▊  | 9487/9741 [00:10<00:00, 945.15it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▋ | 9582/9741 [00:10<00:00, 944.12it/s] 99%|██████████████████████████████████████████████████████████████████████████████████▍| 9677/9741 [00:10<00:00, 941.03it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:10<00:00, 905.89it/s]
Load End
Num instances: 1000
[2023-08-22 04:18:15,746] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 04:18:18,747] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 04:18:18,748] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f2405361a60>
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 04:18:18,748] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f2405361940>
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 04:18:18,749] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 04:18:18,749] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.47077393531799316 seconds
Loading extension module utils...
Time to load utils op: 0.5048332214355469 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o8-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:48<39:25, 48.27s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:37<38:58, 48.72s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:26<38:13, 48.81s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:14<37:07, 48.42s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [04:02<36:25, 48.57s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [04:50<35:20, 48.19s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [05:39<34:43, 48.45s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [06:27<33:48, 48.29s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [07:15<32:54, 48.16s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [08:05<32:35, 48.89s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [08:53<31:37, 48.66s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [09:40<30:27, 48.10s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [10:28<29:37, 48.04s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [11:16<28:46, 47.96s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [12:04<28:00, 48.02s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [12:51<27:04, 47.78s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [13:39<26:12, 47.66s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [14:26<25:26, 47.71s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [15:15<24:44, 47.88s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [16:02<23:49, 47.66s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [16:49<23:01, 47.63s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [17:37<22:13, 47.63s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [18:25<21:29, 47.77s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [19:13<20:46, 47.94s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [20:03<20:08, 48.33s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [20:53<19:34, 48.92s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [21:40<18:32, 48.35s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [22:28<17:38, 48.12s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [23:17<16:56, 48.41s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [24:05<16:10, 48.50s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [24:54<15:20, 48.43s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [25:42<14:30, 48.38s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [26:29<13:36, 48.04s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [27:18<12:52, 48.27s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [28:07<12:05, 48.37s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [28:56<11:19, 48.54s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [29:47<10:40, 49.30s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [30:35<09:48, 49.03s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [31:22<08:54, 48.55s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [32:12<08:08, 48.87s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [33:00<07:16, 48.46s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [33:47<06:25, 48.23s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [34:35<05:36, 48.04s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [35:24<04:50, 48.37s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [36:11<03:59, 47.96s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [37:00<03:12, 48.14s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [37:47<02:23, 47.96s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [38:36<01:36, 48.32s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [39:25<00:48, 48.37s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [40:13<00:00, 48.46s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [40:13<00:00, 48.28s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 0.5803} | avg. gen lenth: 402.914
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s1-rFalse --seed 1 --max-prompt-length 2048 --num-out-domain 9
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 04:58:42,598] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 9
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o9-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                    | 60/9741 [00:00<00:16, 592.97it/s]  1%|█                                                                                   | 123/9741 [00:00<00:15, 611.48it/s]  2%|█▌                                                                                  | 185/9741 [00:00<00:16, 572.34it/s]  3%|██▏                                                                                 | 249/9741 [00:00<00:15, 595.00it/s]  3%|██▋                                                                                 | 313/9741 [00:00<00:15, 609.54it/s]  4%|███▎                                                                                | 377/9741 [00:00<00:15, 619.12it/s]  5%|███▊                                                                                | 441/9741 [00:00<00:14, 623.39it/s]  5%|████▎                                                                               | 505/9741 [00:00<00:14, 627.95it/s]  6%|████▉                                                                               | 568/9741 [00:00<00:15, 599.81it/s]  6%|█████▍                                                                              | 631/9741 [00:01<00:15, 605.93it/s]  7%|█████▉                                                                              | 695/9741 [00:01<00:14, 613.19it/s]  8%|██████▌                                                                             | 758/9741 [00:01<00:14, 616.19it/s]  8%|███████                                                                             | 822/9741 [00:01<00:14, 621.48it/s]  9%|███████▋                                                                            | 885/9741 [00:01<00:14, 622.88it/s] 10%|████████▏                                                                           | 948/9741 [00:01<00:14, 624.77it/s] 10%|████████▌                                                                          | 1012/9741 [00:01<00:13, 627.08it/s] 11%|█████████▏                                                                         | 1076/9741 [00:01<00:13, 629.14it/s] 12%|█████████▋                                                                         | 1139/9741 [00:01<00:13, 626.54it/s] 12%|██████████▏                                                                        | 1202/9741 [00:01<00:13, 627.33it/s] 13%|██████████▊                                                                        | 1265/9741 [00:02<00:13, 626.46it/s] 14%|███████████▎                                                                       | 1328/9741 [00:02<00:13, 626.88it/s] 14%|███████████▊                                                                       | 1391/9741 [00:02<00:13, 626.65it/s] 15%|████████████▍                                                                      | 1455/9741 [00:02<00:13, 627.79it/s] 16%|████████████▉                                                                      | 1518/9741 [00:02<00:13, 628.26it/s] 16%|█████████████▍                                                                     | 1581/9741 [00:02<00:12, 627.75it/s] 17%|██████████████                                                                     | 1645/9741 [00:02<00:12, 629.41it/s] 18%|██████████████▌                                                                    | 1709/9741 [00:02<00:12, 630.04it/s] 18%|███████████████▎                                                                   | 1796/9741 [00:02<00:11, 699.40it/s] 19%|████████████████                                                                   | 1890/9741 [00:02<00:10, 770.30it/s] 20%|████████████████▉                                                                  | 1983/9741 [00:03<00:09, 816.23it/s] 21%|█████████████████▋                                                                 | 2072/9741 [00:03<00:09, 836.80it/s] 22%|██████████████████▍                                                                | 2165/9741 [00:03<00:08, 863.34it/s] 23%|███████████████████▏                                                               | 2258/9741 [00:03<00:08, 882.34it/s] 24%|████████████████████                                                               | 2352/9741 [00:03<00:08, 896.79it/s] 25%|████████████████████▊                                                              | 2445/9741 [00:03<00:08, 905.29it/s] 26%|█████████████████████▋                                                             | 2539/9741 [00:03<00:07, 913.65it/s] 27%|██████████████████████▍                                                            | 2633/9741 [00:03<00:07, 919.76it/s] 28%|███████████████████████▏                                                           | 2726/9741 [00:03<00:07, 920.87it/s] 29%|████████████████████████                                                           | 2819/9741 [00:03<00:07, 921.54it/s] 30%|████████████████████████▊                                                          | 2912/9741 [00:04<00:07, 922.19it/s] 31%|█████████████████████████▌                                                         | 3006/9741 [00:04<00:07, 925.69it/s] 32%|██████████████████████████▍                                                        | 3099/9741 [00:04<00:07, 925.54it/s] 33%|███████████████████████████▏                                                       | 3192/9741 [00:04<00:07, 924.76it/s] 34%|███████████████████████████▉                                                       | 3285/9741 [00:04<00:06, 922.45it/s] 35%|████████████████████████████▊                                                      | 3378/9741 [00:04<00:06, 921.20it/s] 36%|█████████████████████████████▌                                                     | 3471/9741 [00:04<00:06, 921.43it/s] 37%|██████████████████████████████▎                                                    | 3564/9741 [00:04<00:06, 921.08it/s] 38%|███████████████████████████████▏                                                   | 3657/9741 [00:04<00:06, 917.92it/s] 38%|███████████████████████████████▉                                                   | 3750/9741 [00:04<00:06, 918.58it/s] 39%|████████████████████████████████▋                                                  | 3842/9741 [00:05<00:06, 914.96it/s] 40%|█████████████████████████████████▌                                                 | 3934/9741 [00:05<00:06, 916.03it/s] 41%|██████████████████████████████████▎                                                | 4027/9741 [00:05<00:06, 917.38it/s] 42%|███████████████████████████████████                                                | 4119/9741 [00:05<00:06, 914.06it/s] 43%|███████████████████████████████████▉                                               | 4211/9741 [00:05<00:06, 913.93it/s] 44%|████████████████████████████████████▋                                              | 4303/9741 [00:05<00:05, 911.92it/s] 45%|█████████████████████████████████████▍                                             | 4395/9741 [00:05<00:05, 912.18it/s] 46%|██████████████████████████████████████▏                                            | 4487/9741 [00:05<00:05, 886.22it/s] 47%|███████████████████████████████████████                                            | 4578/9741 [00:05<00:05, 892.99it/s] 48%|███████████████████████████████████████▊                                           | 4670/9741 [00:05<00:05, 898.50it/s] 49%|████████████████████████████████████████▌                                          | 4760/9741 [00:06<00:06, 722.47it/s] 50%|█████████████████████████████████████████▎                                         | 4852/9741 [00:06<00:06, 770.60it/s] 51%|██████████████████████████████████████████                                         | 4943/9741 [00:06<00:05, 807.02it/s] 52%|██████████████████████████████████████████▉                                        | 5035/9741 [00:06<00:05, 836.29it/s] 53%|███████████████████████████████████████████▋                                       | 5122/9741 [00:06<00:05, 841.48it/s] 53%|████████████████████████████████████████████▍                                      | 5211/9741 [00:06<00:05, 855.32it/s] 54%|█████████████████████████████████████████████▏                                     | 5301/9741 [00:06<00:05, 868.05it/s] 55%|█████████████████████████████████████████████▉                                     | 5391/9741 [00:06<00:04, 876.81it/s] 56%|██████████████████████████████████████████████▋                                    | 5483/9741 [00:06<00:04, 886.77it/s] 57%|███████████████████████████████████████████████▌                                   | 5575/9741 [00:07<00:04, 893.92it/s] 58%|████████████████████████████████████████████████▎                                  | 5665/9741 [00:07<00:04, 895.04it/s] 59%|█████████████████████████████████████████████████                                  | 5756/9741 [00:07<00:04, 898.27it/s] 60%|█████████████████████████████████████████████████▊                                 | 5847/9741 [00:07<00:04, 897.02it/s] 61%|██████████████████████████████████████████████████▌                                | 5938/9741 [00:07<00:04, 898.27it/s] 62%|███████████████████████████████████████████████████▎                               | 6029/9741 [00:07<00:04, 900.86it/s] 63%|████████████████████████████████████████████████████▏                              | 6120/9741 [00:07<00:04, 900.84it/s] 64%|████████████████████████████████████████████████████▉                              | 6211/9741 [00:07<00:03, 899.87it/s] 65%|█████████████████████████████████████████████████████▋                             | 6302/9741 [00:07<00:03, 897.70it/s] 66%|██████████████████████████████████████████████████████▍                            | 6392/9741 [00:07<00:03, 898.34it/s] 67%|███████████████████████████████████████████████████████▏                           | 6482/9741 [00:08<00:03, 898.65it/s] 67%|███████████████████████████████████████████████████████▉                           | 6572/9741 [00:08<00:03, 895.55it/s] 68%|████████████████████████████████████████████████████████▊                          | 6662/9741 [00:08<00:03, 893.50it/s] 69%|█████████████████████████████████████████████████████████▌                         | 6752/9741 [00:08<00:03, 894.42it/s] 70%|██████████████████████████████████████████████████████████▎                        | 6842/9741 [00:08<00:03, 894.82it/s] 71%|███████████████████████████████████████████████████████████                        | 6932/9741 [00:08<00:03, 895.65it/s] 72%|███████████████████████████████████████████████████████████▊                       | 7022/9741 [00:08<00:03, 894.71it/s] 73%|████████████████████████████████████████████████████████████▌                      | 7112/9741 [00:08<00:02, 896.27it/s] 74%|█████████████████████████████████████████████████████████████▎                     | 7202/9741 [00:08<00:02, 894.35it/s] 75%|██████████████████████████████████████████████████████████████▏                    | 7292/9741 [00:08<00:02, 895.18it/s] 76%|██████████████████████████████████████████████████████████████▉                    | 7382/9741 [00:09<00:02, 895.53it/s] 77%|███████████████████████████████████████████████████████████████▋                   | 7472/9741 [00:09<00:02, 867.46it/s] 78%|████████████████████████████████████████████████████████████████▍                  | 7562/9741 [00:09<00:02, 875.13it/s] 79%|█████████████████████████████████████████████████████████████████▏                 | 7651/9741 [00:09<00:02, 878.45it/s] 79%|█████████████████████████████████████████████████████████████████▉                 | 7741/9741 [00:09<00:02, 884.26it/s] 80%|██████████████████████████████████████████████████████████████████▋                | 7831/9741 [00:09<00:02, 887.15it/s] 81%|███████████████████████████████████████████████████████████████████▍               | 7920/9741 [00:09<00:02, 885.45it/s] 82%|████████████████████████████████████████████████████████████████████▏              | 8009/9741 [00:09<00:01, 886.38it/s] 83%|█████████████████████████████████████████████████████████████████████              | 8098/9741 [00:09<00:01, 887.09it/s] 84%|█████████████████████████████████████████████████████████████████████▊             | 8187/9741 [00:10<00:01, 886.34it/s] 85%|██████████████████████████████████████████████████████████████████████▌            | 8277/9741 [00:10<00:01, 888.07it/s] 86%|███████████████████████████████████████████████████████████████████████▎           | 8366/9741 [00:10<00:01, 887.99it/s] 87%|████████████████████████████████████████████████████████████████████████           | 8455/9741 [00:10<00:01, 888.37it/s] 88%|████████████████████████████████████████████████████████████████████████▊          | 8544/9741 [00:10<00:01, 886.42it/s] 89%|█████████████████████████████████████████████████████████████████████████▌         | 8633/9741 [00:10<00:01, 886.50it/s] 90%|██████████████████████████████████████████████████████████████████████████▎        | 8722/9741 [00:10<00:01, 887.46it/s] 90%|███████████████████████████████████████████████████████████████████████████        | 8811/9741 [00:10<00:01, 885.64it/s] 91%|███████████████████████████████████████████████████████████████████████████▊       | 8900/9741 [00:10<00:00, 886.78it/s] 92%|████████████████████████████████████████████████████████████████████████████▌      | 8989/9741 [00:10<00:00, 887.67it/s] 93%|█████████████████████████████████████████████████████████████████████████████▎     | 9078/9741 [00:11<00:00, 885.52it/s] 94%|██████████████████████████████████████████████████████████████████████████████     | 9167/9741 [00:11<00:00, 885.63it/s] 95%|██████████████████████████████████████████████████████████████████████████████▊    | 9256/9741 [00:11<00:00, 883.67it/s] 96%|███████████████████████████████████████████████████████████████████████████████▋   | 9345/9741 [00:11<00:00, 884.42it/s] 97%|████████████████████████████████████████████████████████████████████████████████▍  | 9434/9741 [00:11<00:00, 883.57it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▏ | 9523/9741 [00:11<00:00, 880.16it/s] 99%|█████████████████████████████████████████████████████████████████████████████████▉ | 9612/9741 [00:11<00:00, 880.43it/s]100%|██████████████████████████████████████████████████████████████████████████████████▋| 9701/9741 [00:11<00:00, 878.82it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:11<00:00, 827.75it/s]
Load End
Num instances: 1000
[2023-08-22 04:59:05,668] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 04:59:08,458] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 04:59:08,458] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 04:59:08,458] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 04:59:08,458] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 04:59:08,458] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f3c9ad83a60>
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f3c9ad83940>
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 04:59:08,459] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 04:59:08,460] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 04:59:08,460] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4787135124206543 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Output: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Output: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Output: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Output: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Output: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Output: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Output: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Output: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Output: 12

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o9-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.40453624725341797 seconds
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:47<38:33, 47.21s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:33<37:22, 46.73s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:21<37:04, 47.33s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:07<35:55, 46.87s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [03:55<35:19, 47.09s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [04:41<34:15, 46.71s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [05:28<33:30, 46.75s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [06:15<32:50, 46.92s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [07:02<32:06, 46.98s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [07:51<31:41, 47.54s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [08:37<30:39, 47.16s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [09:23<29:42, 46.90s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [10:11<29:04, 47.14s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [10:58<28:16, 47.13s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [11:44<27:17, 46.77s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [12:30<26:22, 46.54s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [13:17<25:35, 46.54s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [14:03<24:46, 46.46s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [14:50<24:05, 46.62s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [15:36<23:17, 46.60s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [16:23<22:30, 46.57s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [17:10<21:49, 46.77s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [17:56<20:54, 46.45s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [18:43<20:11, 46.58s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [19:30<19:29, 46.79s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [20:17<18:41, 46.73s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [21:03<17:55, 46.75s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [21:50<17:04, 46.56s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [22:37<16:20, 46.71s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [23:25<15:44, 47.22s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [24:12<14:57, 47.25s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [24:59<14:09, 47.19s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [25:46<13:18, 47.00s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [26:33<12:32, 47.04s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [27:21<11:47, 47.20s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [28:07<10:58, 47.07s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [28:54<10:10, 46.97s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [29:41<09:23, 46.94s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [30:28<08:35, 46.87s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [31:18<07:59, 47.91s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [32:06<07:11, 47.96s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [32:54<06:22, 47.79s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [33:40<05:31, 47.33s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [34:28<04:46, 47.70s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [35:15<03:57, 47.48s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [36:03<03:09, 47.41s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [36:50<02:21, 47.30s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [37:37<01:34, 47.46s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [38:25<00:47, 47.46s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [39:13<00:00, 47.50s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [39:13<00:00, 47.06s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 0.6921} | avg. gen lenth: 407.616
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 05:39:06,589] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o1-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  3%|██▎                                                                                | 271/9741 [00:00<00:03, 2702.28it/s]  6%|█████                                                                              | 591/9741 [00:00<00:03, 2991.01it/s]  9%|███████▊                                                                           | 914/9741 [00:00<00:02, 3096.78it/s] 13%|██████████▍                                                                       | 1236/9741 [00:00<00:02, 3142.80it/s] 16%|█████████████▏                                                                    | 1561/9741 [00:00<00:02, 3179.01it/s] 19%|███████████████▊                                                                  | 1880/9741 [00:00<00:02, 3182.34it/s] 23%|██████████████████▌                                                               | 2205/9741 [00:00<00:02, 3201.91it/s] 26%|█████████████████████▎                                                            | 2526/9741 [00:00<00:02, 3201.33it/s] 29%|███████████████████████▉                                                          | 2847/9741 [00:00<00:02, 3108.89it/s] 32%|██████████████████████████▌                                                       | 3159/9741 [00:01<00:02, 3104.69it/s] 36%|█████████████████████████████▏                                                    | 3472/9741 [00:01<00:02, 3110.83it/s] 39%|███████████████████████████████▉                                                  | 3788/9741 [00:01<00:01, 3123.63it/s] 42%|██████████████████████████████████▌                                               | 4109/9741 [00:01<00:01, 3148.50it/s] 46%|█████████████████████████████████████▎                                            | 4439/9741 [00:01<00:01, 3192.21it/s] 49%|████████████████████████████████████████                                          | 4759/9741 [00:01<00:02, 2453.73it/s] 52%|██████████████████████████████████████████▊                                       | 5087/9741 [00:01<00:01, 2657.97it/s] 56%|█████████████████████████████████████████████▌                                    | 5413/9741 [00:01<00:01, 2815.06it/s] 59%|████████████████████████████████████████████████▎                                 | 5735/9741 [00:01<00:01, 2923.75it/s] 62%|███████████████████████████████████████████████████                               | 6064/9741 [00:02<00:01, 3024.33it/s] 66%|█████████████████████████████████████████████████████▊                            | 6394/9741 [00:02<00:01, 3100.70it/s] 69%|████████████████████████████████████████████████████████▌                         | 6723/9741 [00:02<00:00, 3153.58it/s] 72%|███████████████████████████████████████████████████████████▍                      | 7055/9741 [00:02<00:00, 3199.87it/s] 76%|██████████████████████████████████████████████████████████████▏                   | 7388/9741 [00:02<00:00, 3236.52it/s] 79%|████████████████████████████████████████████████████████████████▉                 | 7715/9741 [00:02<00:00, 3219.69it/s] 83%|███████████████████████████████████████████████████████████████████▋              | 8046/9741 [00:02<00:00, 3245.89it/s] 86%|██████████████████████████████████████████████████████████████████████▌           | 8377/9741 [00:02<00:00, 3264.45it/s] 89%|█████████████████████████████████████████████████████████████████████████▎        | 8708/9741 [00:02<00:00, 3276.34it/s] 93%|████████████████████████████████████████████████████████████████████████████      | 9037/9741 [00:02<00:00, 3263.28it/s] 96%|██████████████████████████████████████████████████████████████████████████████▉   | 9372/9741 [00:03<00:00, 3286.24it/s]100%|█████████████████████████████████████████████████████████████████████████████████▋| 9704/9741 [00:03<00:00, 3293.82it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:03<00:00, 3110.24it/s]
Load End
Num instances: 1000
[2023-08-22 05:39:21,059] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 05:39:24,027] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 05:39:24,027] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f3992b81a60>
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 05:39:24,028] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f3992b81940>
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 05:39:24,029] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 05:39:24,029] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.44471096992492676 seconds
Loading extension module utils...
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Time to load utils op: 0.30441737174987793 seconds
Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o1-tgsm8k-s10-rTrue
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [01:04<52:25, 64.20s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [02:06<50:18, 62.89s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [03:09<49:32, 63.25s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [04:12<48:18, 63.01s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [05:13<46:41, 62.26s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [06:16<45:57, 62.68s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [07:20<45:05, 62.92s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [08:23<44:04, 62.96s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [09:28<43:29, 63.64s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [10:30<42:05, 63.14s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [11:35<41:19, 63.58s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [12:35<39:36, 62.54s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [13:37<38:33, 62.53s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [14:40<37:34, 62.61s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [15:42<36:29, 62.55s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [16:45<35:24, 62.49s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [17:49<34:38, 63.00s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [18:52<33:31, 62.85s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [19:55<32:37, 63.14s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [20:56<31:10, 62.34s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [21:58<30:10, 62.42s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [23:04<29:33, 63.34s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [24:08<28:32, 63.43s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [25:11<27:31, 63.51s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [26:13<26:11, 62.86s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [27:15<25:08, 62.87s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [28:18<24:03, 62.76s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [29:22<23:12, 63.28s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [30:27<22:16, 63.62s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [31:30<21:08, 63.40s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [32:34<20:07, 63.58s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [33:37<19:04, 63.57s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [34:42<18:04, 63.82s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [35:45<16:58, 63.67s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [36:49<15:56, 63.74s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [37:54<14:58, 64.19s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [38:58<13:52, 64.04s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [40:01<12:45, 63.76s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [41:05<11:42, 63.83s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [42:08<10:37, 63.73s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [43:13<09:35, 63.94s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [44:17<08:32, 64.06s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [45:21<07:27, 63.91s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [46:25<06:23, 63.93s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [47:29<05:19, 63.99s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [48:33<04:16, 64.17s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [49:37<03:11, 63.95s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [50:43<02:09, 64.51s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [51:47<01:04, 64.50s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [52:55<00:00, 65.62s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [52:55<00:00, 63.52s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.2289} | avg. gen lenth: 348.78
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 06:32:51,235] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o2-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|█                                                                                  | 119/9741 [00:00<00:08, 1186.70it/s]  3%|██                                                                                 | 244/9741 [00:00<00:07, 1220.91it/s]  4%|███▏                                                                               | 371/9741 [00:00<00:07, 1241.83it/s]  5%|████▎                                                                              | 499/9741 [00:00<00:07, 1254.94it/s]  6%|█████▎                                                                             | 627/9741 [00:00<00:07, 1261.74it/s]  8%|██████▍                                                                            | 756/9741 [00:00<00:07, 1270.19it/s]  9%|███████▌                                                                           | 884/9741 [00:00<00:06, 1272.57it/s] 10%|████████▌                                                                         | 1013/9741 [00:00<00:06, 1277.16it/s] 12%|█████████▌                                                                        | 1141/9741 [00:00<00:06, 1252.06it/s] 13%|██████████▋                                                                       | 1268/9741 [00:01<00:06, 1254.77it/s] 14%|███████████▊                                                                      | 1396/9741 [00:01<00:06, 1259.82it/s] 16%|████████████▊                                                                     | 1524/9741 [00:01<00:06, 1263.77it/s] 17%|█████████████▉                                                                    | 1652/9741 [00:01<00:06, 1266.42it/s] 18%|██████████████▉                                                                   | 1779/9741 [00:01<00:06, 1247.35it/s] 20%|████████████████                                                                  | 1906/9741 [00:01<00:06, 1253.74it/s] 21%|█████████████████                                                                 | 2033/9741 [00:01<00:06, 1258.22it/s] 22%|██████████████████▏                                                               | 2161/9741 [00:01<00:06, 1262.49it/s] 23%|███████████████████▎                                                              | 2289/9741 [00:01<00:05, 1266.82it/s] 25%|████████████████████▎                                                             | 2416/9741 [00:01<00:05, 1266.90it/s] 26%|█████████████████████▍                                                            | 2543/9741 [00:02<00:05, 1266.17it/s] 27%|██████████████████████▍                                                           | 2671/9741 [00:02<00:05, 1268.62it/s] 29%|███████████████████████▌                                                          | 2799/9741 [00:02<00:05, 1269.64it/s] 30%|████████████████████████▋                                                         | 2929/9741 [00:02<00:05, 1278.65it/s] 32%|██████████████████████████▎                                                       | 3122/9741 [00:02<00:04, 1472.82it/s] 34%|███████████████████████████▉                                                      | 3317/9741 [00:02<00:03, 1615.52it/s] 36%|█████████████████████████████▌                                                    | 3509/9741 [00:02<00:03, 1706.01it/s] 38%|███████████████████████████████▏                                                  | 3701/9741 [00:02<00:03, 1768.92it/s] 40%|████████████████████████████████▊                                                 | 3894/9741 [00:02<00:03, 1815.38it/s] 42%|██████████████████████████████████▍                                               | 4084/9741 [00:02<00:03, 1839.82it/s] 44%|███████████████████████████████████▉                                              | 4276/9741 [00:03<00:02, 1861.90it/s] 46%|█████████████████████████████████████▌                                            | 4467/9741 [00:03<00:02, 1875.83it/s] 48%|███████████████████████████████████████▏                                          | 4655/9741 [00:03<00:02, 1829.85it/s] 50%|████████████████████████████████████████▋                                         | 4839/9741 [00:03<00:03, 1403.25it/s] 52%|██████████████████████████████████████████▎                                       | 5030/9741 [00:03<00:03, 1525.28it/s] 54%|███████████████████████████████████████████▉                                      | 5220/9741 [00:03<00:02, 1621.73it/s] 56%|█████████████████████████████████████████████▌                                    | 5410/9741 [00:03<00:02, 1695.07it/s] 58%|███████████████████████████████████████████████▏                                  | 5602/9741 [00:03<00:02, 1755.19it/s] 59%|████████████████████████████████████████████████▊                                 | 5795/9741 [00:03<00:02, 1803.50it/s] 61%|██████████████████████████████████████████████████▍                               | 5986/9741 [00:04<00:02, 1833.72it/s] 63%|███████████████████████████████████████████████████▉                              | 6177/9741 [00:04<00:01, 1855.67it/s] 65%|█████████████████████████████████████████████████████▌                            | 6368/9741 [00:04<00:01, 1869.94it/s] 67%|███████████████████████████████████████████████████████▏                          | 6558/9741 [00:04<00:01, 1878.68it/s] 69%|████████████████████████████████████████████████████████▊                         | 6748/9741 [00:04<00:01, 1876.40it/s] 71%|██████████████████████████████████████████████████████████▍                       | 6939/9741 [00:04<00:01, 1884.48it/s] 73%|████████████████████████████████████████████████████████████                      | 7129/9741 [00:04<00:01, 1882.24it/s] 75%|█████████████████████████████████████████████████████████████▌                    | 7318/9741 [00:04<00:01, 1884.16it/s] 77%|███████████████████████████████████████████████████████████████▏                  | 7507/9741 [00:04<00:01, 1857.17it/s] 79%|████████████████████████████████████████████████████████████████▊                 | 7694/9741 [00:04<00:01, 1825.71it/s] 81%|██████████████████████████████████████████████████████████████████▎               | 7884/9741 [00:05<00:01, 1844.99it/s] 83%|███████████████████████████████████████████████████████████████████▉              | 8075/9741 [00:05<00:00, 1863.99it/s] 85%|█████████████████████████████████████████████████████████████████████▌            | 8265/9741 [00:05<00:00, 1874.39it/s] 87%|███████████████████████████████████████████████████████████████████████▏          | 8454/9741 [00:05<00:00, 1877.10it/s] 89%|████████████████████████████████████████████████████████████████████████▊         | 8644/9741 [00:05<00:00, 1881.25it/s] 91%|██████████████████████████████████████████████████████████████████████████▎       | 8833/9741 [00:05<00:00, 1878.19it/s] 93%|███████████████████████████████████████████████████████████████████████████▉      | 9021/9741 [00:05<00:00, 1878.00it/s] 95%|█████████████████████████████████████████████████████████████████████████████▌    | 9211/9741 [00:05<00:00, 1882.03it/s] 97%|███████████████████████████████████████████████████████████████████████████████▏  | 9401/9741 [00:05<00:00, 1886.91it/s] 98%|████████████████████████████████████████████████████████████████████████████████▋ | 9590/9741 [00:05<00:00, 1883.61it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:06<00:00, 1614.18it/s]
Load End
Num instances: 1000
[2023-08-22 06:33:08,323] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 06:33:11,194] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 06:33:11,195] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7ff75f79ea60>
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 06:33:11,195] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7ff75f79e940>
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 06:33:11,196] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 06:33:11,196] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4344143867492676 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o2-tgsm8k-s10-rTrue
Loading extension module utils...
Time to load utils op: 0.5049986839294434 seconds
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [01:00<49:26, 60.54s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:57<46:44, 58.43s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:54<45:14, 57.75s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:52<44:30, 58.05s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [04:51<43:33, 58.07s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [05:48<42:18, 57.70s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [06:46<41:27, 57.85s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [07:43<40:25, 57.76s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [08:41<39:31, 57.84s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [09:40<38:40, 58.00s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [10:38<37:47, 58.14s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [11:34<36:28, 57.60s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [12:35<36:06, 58.54s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [13:33<34:57, 58.27s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [14:31<33:55, 58.15s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [15:27<32:37, 57.56s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [16:25<31:41, 57.63s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [17:24<30:56, 58.01s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [18:22<30:00, 58.08s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [19:20<29:00, 58.02s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [20:18<28:08, 58.24s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [21:17<27:12, 58.31s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [22:14<26:05, 57.98s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [23:11<24:56, 57.55s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [24:09<24:08, 57.93s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [25:10<23:26, 58.61s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [26:06<22:11, 57.91s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [27:04<21:18, 58.09s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [28:01<20:11, 57.68s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [28:58<19:09, 57.48s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [29:55<18:10, 57.38s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [30:54<17:21, 57.85s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [31:52<16:24, 57.93s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [32:53<15:38, 58.67s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [33:51<14:38, 58.54s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [34:52<13:48, 59.20s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [35:49<12:41, 58.61s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [36:46<11:37, 58.16s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [37:44<10:37, 57.96s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [38:43<09:43, 58.39s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [39:40<08:40, 57.88s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [40:38<07:43, 57.94s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [41:37<06:47, 58.23s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [42:34<05:47, 57.91s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [43:31<04:49, 57.82s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [44:29<03:51, 57.82s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [45:27<02:53, 57.80s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [46:27<01:56, 58.44s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [47:25<00:58, 58.41s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [48:23<00:00, 58.05s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [48:23<00:00, 58.06s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.8272} | avg. gen lenth: 383.838
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 07:21:45,677] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o3-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▊                                                                                    | 92/9741 [00:00<00:10, 918.62it/s]  2%|█▋                                                                                  | 189/9741 [00:00<00:10, 944.15it/s]  3%|██▍                                                                                 | 288/9741 [00:00<00:09, 963.39it/s]  4%|███▎                                                                                | 387/9741 [00:00<00:09, 973.63it/s]  5%|████▏                                                                               | 486/9741 [00:00<00:09, 979.43it/s]  6%|█████                                                                               | 586/9741 [00:00<00:09, 985.21it/s]  7%|█████▉                                                                              | 686/9741 [00:00<00:09, 988.73it/s]  8%|██████▊                                                                             | 787/9741 [00:00<00:09, 993.20it/s]  9%|███████▋                                                                            | 887/9741 [00:00<00:09, 972.65it/s] 10%|████████▌                                                                           | 986/9741 [00:01<00:08, 976.26it/s] 11%|█████████▏                                                                         | 1085/9741 [00:01<00:08, 980.35it/s] 12%|██████████                                                                         | 1185/9741 [00:01<00:08, 985.84it/s] 13%|██████████▉                                                                        | 1285/9741 [00:01<00:08, 988.70it/s] 14%|███████████▊                                                                       | 1384/9741 [00:01<00:08, 988.75it/s] 15%|████████████▋                                                                      | 1484/9741 [00:01<00:08, 990.12it/s] 16%|█████████████▍                                                                     | 1584/9741 [00:01<00:08, 990.64it/s] 17%|██████████████▎                                                                    | 1685/9741 [00:01<00:08, 993.81it/s] 18%|███████████████▏                                                                   | 1785/9741 [00:01<00:08, 974.44it/s] 20%|████████████████▏                                                                 | 1916/9741 [00:01<00:07, 1071.74it/s] 21%|█████████████████▍                                                                | 2066/9741 [00:02<00:06, 1197.05it/s] 23%|██████████████████▋                                                               | 2216/9741 [00:02<00:05, 1285.83it/s] 24%|███████████████████▉                                                              | 2368/9741 [00:02<00:05, 1353.58it/s] 26%|█████████████████████▏                                                            | 2519/9741 [00:02<00:05, 1398.94it/s] 27%|██████████████████████▍                                                           | 2670/9741 [00:02<00:04, 1431.04it/s] 29%|███████████████████████▋                                                          | 2820/9741 [00:02<00:04, 1451.01it/s] 30%|█████████████████████████                                                         | 2971/9741 [00:02<00:04, 1467.35it/s] 32%|██████████████████████████▎                                                       | 3122/9741 [00:02<00:04, 1477.44it/s] 34%|███████████████████████████▌                                                      | 3273/9741 [00:02<00:04, 1486.15it/s] 35%|████████████████████████████▊                                                     | 3423/9741 [00:02<00:04, 1490.00it/s] 37%|██████████████████████████████                                                    | 3573/9741 [00:03<00:04, 1489.84it/s] 38%|███████████████████████████████▎                                                  | 3723/9741 [00:03<00:04, 1487.56it/s] 40%|████████████████████████████████▌                                                 | 3872/9741 [00:03<00:03, 1471.23it/s] 41%|█████████████████████████████████▊                                                | 4021/9741 [00:03<00:03, 1474.35it/s] 43%|███████████████████████████████████                                               | 4170/9741 [00:03<00:03, 1476.63it/s] 44%|████████████████████████████████████▎                                             | 4320/9741 [00:03<00:03, 1481.82it/s] 46%|█████████████████████████████████████▋                                            | 4471/9741 [00:03<00:03, 1488.25it/s] 47%|██████████████████████████████████████▉                                           | 4620/9741 [00:03<00:03, 1441.76it/s] 49%|████████████████████████████████████████                                          | 4765/9741 [00:03<00:04, 1116.71it/s] 50%|█████████████████████████████████████████▎                                        | 4915/9741 [00:04<00:03, 1208.44it/s] 52%|██████████████████████████████████████████▋                                       | 5064/9741 [00:04<00:03, 1279.58it/s] 54%|███████████████████████████████████████████▉                                      | 5213/9741 [00:04<00:03, 1335.93it/s] 55%|█████████████████████████████████████████████▏                                    | 5362/9741 [00:04<00:03, 1378.58it/s] 57%|██████████████████████████████████████████████▍                                   | 5512/9741 [00:04<00:02, 1411.99it/s] 58%|███████████████████████████████████████████████▋                                  | 5661/9741 [00:04<00:02, 1432.24it/s] 60%|████████████████████████████████████████████████▉                                 | 5809/9741 [00:04<00:02, 1444.16it/s] 61%|██████████████████████████████████████████████████▏                               | 5958/9741 [00:04<00:02, 1454.90it/s] 63%|███████████████████████████████████████████████████▍                              | 6107/9741 [00:04<00:02, 1464.74it/s] 64%|████████████████████████████████████████████████████▋                             | 6255/9741 [00:04<00:02, 1450.79it/s] 66%|█████████████████████████████████████████████████████▉                            | 6402/9741 [00:05<00:02, 1456.21it/s] 67%|███████████████████████████████████████████████████████▏                          | 6549/9741 [00:05<00:02, 1459.79it/s] 69%|████████████████████████████████████████████████████████▍                         | 6698/9741 [00:05<00:02, 1467.61it/s] 70%|█████████████████████████████████████████████████████████▋                        | 6848/9741 [00:05<00:01, 1474.61it/s] 72%|██████████████████████████████████████████████████████████▉                       | 6996/9741 [00:05<00:01, 1474.75it/s] 73%|████████████████████████████████████████████████████████████▏                     | 7145/9741 [00:05<00:01, 1477.26it/s] 75%|█████████████████████████████████████████████████████████████▍                    | 7293/9741 [00:05<00:01, 1477.68it/s] 76%|██████████████████████████████████████████████████████████████▋                   | 7441/9741 [00:05<00:01, 1436.90it/s] 78%|███████████████████████████████████████████████████████████████▉                  | 7590/9741 [00:05<00:01, 1451.98it/s] 79%|█████████████████████████████████████████████████████████████████▏                | 7739/9741 [00:05<00:01, 1461.41it/s] 81%|██████████████████████████████████████████████████████████████████▍               | 7888/9741 [00:06<00:01, 1468.45it/s] 83%|███████████████████████████████████████████████████████████████████▋              | 8038/9741 [00:06<00:01, 1476.44it/s] 84%|████████████████████████████████████████████████████████████████████▉             | 8186/9741 [00:06<00:01, 1476.66it/s] 86%|██████████████████████████████████████████████████████████████████████▏           | 8334/9741 [00:06<00:00, 1477.50it/s] 87%|███████████████████████████████████████████████████████████████████████▍          | 8483/9741 [00:06<00:00, 1480.65it/s] 89%|████████████████████████████████████████████████████████████████████████▋         | 8632/9741 [00:06<00:00, 1480.86it/s] 90%|█████████████████████████████████████████████████████████████████████████▉        | 8782/9741 [00:06<00:00, 1484.06it/s] 92%|███████████████████████████████████████████████████████████████████████████▏      | 8933/9741 [00:06<00:00, 1489.19it/s] 93%|████████████████████████████████████████████████████████████████████████████▍     | 9083/9741 [00:06<00:00, 1490.73it/s] 95%|█████████████████████████████████████████████████████████████████████████████▋    | 9233/9741 [00:06<00:00, 1490.61it/s] 96%|██████████████████████████████████████████████████████████████████████████████▉   | 9383/9741 [00:07<00:00, 1491.01it/s] 98%|████████████████████████████████████████████████████████████████████████████████▏ | 9533/9741 [00:07<00:00, 1466.38it/s] 99%|█████████████████████████████████████████████████████████████████████████████████▍| 9680/9741 [00:07<00:00, 1465.31it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:07<00:00, 1331.45it/s]
Load End
Num instances: 1000
[2023-08-22 07:22:03,783] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 07:22:07,499] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 07:22:07,499] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f9ccea26a60>
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 07:22:07,500] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f9ccea26940>
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 07:22:07,501] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 07:22:07,501] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.4255695343017578 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|
Time to load utils op: 0.40457653999328613 seconds

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o3-tgsm8k-s10-rTrue
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:53<43:44, 53.56s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:46<42:27, 53.08s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:38<41:22, 52.82s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:30<40:09, 52.38s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [04:23<39:22, 52.51s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [05:16<38:43, 52.80s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [06:10<38:01, 53.06s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [07:03<37:05, 52.98s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [07:56<36:14, 53.04s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [08:49<35:28, 53.21s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [09:43<34:45, 53.47s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [10:36<33:42, 53.21s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [11:29<32:44, 53.10s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [12:21<31:38, 52.75s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [13:14<30:51, 52.91s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [14:07<29:58, 52.90s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [15:01<29:21, 53.39s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [15:56<28:35, 53.60s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [16:48<27:31, 53.26s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [17:40<26:29, 52.98s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [18:34<25:42, 53.18s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [19:27<24:47, 53.14s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [20:20<23:54, 53.13s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [21:13<23:00, 53.08s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [22:09<22:26, 53.87s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [23:02<21:31, 53.80s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [23:54<20:24, 53.23s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [24:47<19:25, 53.00s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [25:41<18:40, 53.36s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [26:34<17:47, 53.37s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [27:28<16:55, 53.46s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [28:22<16:04, 53.59s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [29:16<15:11, 53.61s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [30:10<14:19, 53.72s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [31:04<13:27, 53.87s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [31:59<12:39, 54.23s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [32:52<11:38, 53.75s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [33:45<10:45, 53.78s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [34:38<09:48, 53.49s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [35:32<08:55, 53.54s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [36:24<07:59, 53.25s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [37:17<07:05, 53.15s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [38:10<06:10, 52.91s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [39:04<05:19, 53.30s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [39:57<04:26, 53.21s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [40:49<03:32, 53.03s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [41:42<02:38, 52.83s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [42:35<01:45, 52.92s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [43:29<00:53, 53.26s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [44:23<00:00, 53.39s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [44:23<00:00, 53.26s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.4534} | avg. gen lenth: 407.328
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 08:06:44,837] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o4-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                    | 69/9741 [00:00<00:14, 684.90it/s]  1%|█▏                                                                                  | 141/9741 [00:00<00:13, 701.68it/s]  2%|█▊                                                                                  | 212/9741 [00:00<00:13, 699.73it/s]  3%|██▍                                                                                 | 283/9741 [00:00<00:13, 703.33it/s]  4%|███                                                                                 | 356/9741 [00:00<00:13, 709.74it/s]  4%|███▋                                                                                | 428/9741 [00:00<00:13, 713.09it/s]  5%|████▎                                                                               | 501/9741 [00:00<00:12, 718.05it/s]  6%|████▉                                                                               | 573/9741 [00:00<00:13, 702.53it/s]  7%|█████▌                                                                              | 644/9741 [00:00<00:12, 703.60it/s]  7%|██████▏                                                                             | 717/9741 [00:01<00:12, 711.39it/s]  8%|██████▊                                                                             | 790/9741 [00:01<00:12, 716.08it/s]  9%|███████▍                                                                            | 862/9741 [00:01<00:12, 717.23it/s] 10%|████████                                                                            | 935/9741 [00:01<00:12, 719.43it/s] 10%|████████▌                                                                          | 1008/9741 [00:01<00:12, 721.23it/s] 11%|█████████▏                                                                         | 1081/9741 [00:01<00:11, 722.96it/s] 12%|█████████▊                                                                         | 1155/9741 [00:01<00:11, 725.26it/s] 13%|██████████▍                                                                        | 1228/9741 [00:01<00:11, 724.61it/s] 13%|███████████                                                                        | 1301/9741 [00:01<00:11, 723.83it/s] 14%|███████████▋                                                                       | 1374/9741 [00:01<00:11, 722.62it/s] 15%|████████████▎                                                                      | 1447/9741 [00:02<00:11, 723.68it/s] 16%|████████████▉                                                                      | 1520/9741 [00:02<00:11, 723.79it/s] 16%|█████████████▌                                                                     | 1593/9741 [00:02<00:11, 723.04it/s] 17%|██████████████▍                                                                    | 1694/9741 [00:02<00:09, 806.51it/s] 18%|███████████████▎                                                                   | 1795/9741 [00:02<00:09, 867.08it/s] 20%|████████████████▏                                                                  | 1904/9741 [00:02<00:08, 932.64it/s] 21%|█████████████████▏                                                                 | 2012/9741 [00:02<00:07, 975.69it/s] 22%|█████████████████▊                                                                | 2121/9741 [00:02<00:07, 1007.80it/s] 23%|██████████████████▊                                                               | 2230/9741 [00:02<00:07, 1029.94it/s] 24%|███████████████████▋                                                              | 2340/9741 [00:02<00:07, 1048.50it/s] 25%|████████████████████▌                                                             | 2448/9741 [00:03<00:06, 1055.35it/s] 26%|█████████████████████▍                                                            | 2554/9741 [00:03<00:06, 1051.86it/s] 27%|██████████████████████▍                                                           | 2662/9741 [00:03<00:06, 1059.47it/s] 28%|███████████████████████▎                                                          | 2770/9741 [00:03<00:06, 1062.94it/s] 30%|████████████████████████▏                                                         | 2879/9741 [00:03<00:06, 1068.46it/s] 31%|█████████████████████████▏                                                        | 2988/9741 [00:03<00:06, 1071.91it/s] 32%|██████████████████████████                                                        | 3096/9741 [00:03<00:06, 1073.01it/s] 33%|██████████████████████████▉                                                       | 3204/9741 [00:03<00:06, 1075.06it/s] 34%|███████████████████████████▉                                                      | 3312/9741 [00:03<00:05, 1076.07it/s] 35%|████████████████████████████▊                                                     | 3420/9741 [00:03<00:05, 1070.53it/s] 36%|█████████████████████████████▋                                                    | 3528/9741 [00:04<00:05, 1073.00it/s] 37%|██████████████████████████████▌                                                   | 3636/9741 [00:04<00:05, 1070.45it/s] 38%|███████████████████████████████▌                                                  | 3744/9741 [00:04<00:05, 1072.82it/s] 40%|████████████████████████████████▍                                                 | 3852/9741 [00:04<00:05, 1074.17it/s] 41%|█████████████████████████████████▎                                                | 3960/9741 [00:04<00:05, 1075.84it/s] 42%|██████████████████████████████████▏                                               | 4068/9741 [00:04<00:05, 1075.54it/s] 43%|███████████████████████████████████▏                                              | 4177/9741 [00:04<00:05, 1077.70it/s] 44%|████████████████████████████████████                                              | 4285/9741 [00:04<00:05, 1077.40it/s] 45%|████████████████████████████████████▉                                             | 4393/9741 [00:04<00:05, 1062.20it/s] 46%|█████████████████████████████████████▉                                            | 4500/9741 [00:04<00:05, 1013.43it/s] 47%|██████████████████████████████████████▊                                           | 4608/9741 [00:05<00:04, 1029.89it/s] 48%|████████████████████████████████████████▏                                          | 4712/9741 [00:05<00:06, 788.48it/s] 49%|█████████████████████████████████████████                                          | 4820/9741 [00:05<00:05, 857.62it/s] 51%|█████████████████████████████████████████▉                                         | 4927/9741 [00:05<00:05, 911.24it/s] 52%|██████████████████████████████████████████▉                                        | 5035/9741 [00:05<00:04, 955.50it/s] 53%|███████████████████████████████████████████▊                                       | 5143/9741 [00:05<00:04, 987.72it/s] 54%|████████████████████████████████████████████▏                                     | 5251/9741 [00:05<00:04, 1011.95it/s] 55%|█████████████████████████████████████████████                                     | 5359/9741 [00:05<00:04, 1029.85it/s] 56%|██████████████████████████████████████████████                                    | 5465/9741 [00:05<00:04, 1036.75it/s] 57%|██████████████████████████████████████████████▉                                   | 5572/9741 [00:06<00:03, 1045.19it/s] 58%|███████████████████████████████████████████████▊                                  | 5678/9741 [00:06<00:03, 1048.60it/s] 59%|████████████████████████████████████████████████▋                                 | 5785/9741 [00:06<00:03, 1054.75it/s] 60%|█████████████████████████████████████████████████▌                                | 5892/9741 [00:06<00:03, 1057.29it/s] 62%|██████████████████████████████████████████████████▍                               | 5999/9741 [00:06<00:03, 1060.68it/s] 63%|███████████████████████████████████████████████████▍                              | 6106/9741 [00:06<00:03, 1062.35it/s] 64%|████████████████████████████████████████████████████▎                             | 6214/9741 [00:06<00:03, 1064.72it/s] 65%|█████████████████████████████████████████████████████▏                            | 6321/9741 [00:06<00:03, 1061.22it/s] 66%|██████████████████████████████████████████████████████                            | 6428/9741 [00:06<00:03, 1063.80it/s] 67%|███████████████████████████████████████████████████████                           | 6535/9741 [00:06<00:03, 1061.70it/s] 68%|███████████████████████████████████████████████████████▉                          | 6642/9741 [00:07<00:02, 1044.02it/s] 69%|████████████████████████████████████████████████████████▊                         | 6747/9741 [00:07<00:02, 1045.45it/s] 70%|█████████████████████████████████████████████████████████▋                        | 6854/9741 [00:07<00:02, 1051.12it/s] 71%|██████████████████████████████████████████████████████████▌                       | 6961/9741 [00:07<00:02, 1053.91it/s] 73%|███████████████████████████████████████████████████████████▌                      | 7069/9741 [00:07<00:02, 1059.85it/s] 74%|████████████████████████████████████████████████████████████▍                     | 7176/9741 [00:07<00:02, 1061.62it/s] 75%|█████████████████████████████████████████████████████████████▎                    | 7283/9741 [00:07<00:02, 1061.41it/s] 76%|██████████████████████████████████████████████████████████████▏                   | 7390/9741 [00:07<00:02, 1063.11it/s] 77%|███████████████████████████████████████████████████████████████                   | 7497/9741 [00:07<00:02, 1019.85it/s] 78%|████████████████████████████████████████████████████████████████                  | 7603/9741 [00:08<00:02, 1029.57it/s] 79%|████████████████████████████████████████████████████████████████▉                 | 7709/9741 [00:08<00:01, 1037.07it/s] 80%|█████████████████████████████████████████████████████████████████▊                | 7816/9741 [00:08<00:01, 1044.54it/s] 81%|██████████████████████████████████████████████████████████████████▋               | 7923/9741 [00:08<00:01, 1049.31it/s] 82%|███████████████████████████████████████████████████████████████████▌              | 8029/9741 [00:08<00:01, 1051.61it/s] 84%|████████████████████████████████████████████████████████████████████▍             | 8135/9741 [00:08<00:01, 1052.41it/s] 85%|█████████████████████████████████████████████████████████████████████▍            | 8242/9741 [00:08<00:01, 1055.94it/s] 86%|██████████████████████████████████████████████████████████████████████▎           | 8348/9741 [00:08<00:01, 1056.28it/s] 87%|███████████████████████████████████████████████████████████████████████▏          | 8455/9741 [00:08<00:01, 1058.68it/s] 88%|████████████████████████████████████████████████████████████████████████          | 8562/9741 [00:08<00:01, 1059.39it/s] 89%|████████████████████████████████████████████████████████████████████████▉         | 8668/9741 [00:09<00:01, 1059.32it/s] 90%|█████████████████████████████████████████████████████████████████████████▊        | 8774/9741 [00:09<00:00, 1057.35it/s] 91%|██████████████████████████████████████████████████████████████████████████▊       | 8881/9741 [00:09<00:00, 1059.93it/s] 92%|███████████████████████████████████████████████████████████████████████████▋      | 8987/9741 [00:09<00:00, 1059.06it/s] 93%|████████████████████████████████████████████████████████████████████████████▌     | 9093/9741 [00:09<00:00, 1056.74it/s] 94%|█████████████████████████████████████████████████████████████████████████████▍    | 9199/9741 [00:09<00:00, 1057.54it/s] 96%|██████████████████████████████████████████████████████████████████████████████▎   | 9305/9741 [00:09<00:00, 1054.75it/s] 97%|███████████████████████████████████████████████████████████████████████████████▏  | 9411/9741 [00:09<00:00, 1056.15it/s] 98%|████████████████████████████████████████████████████████████████████████████████  | 9517/9741 [00:09<00:00, 1053.52it/s] 99%|█████████████████████████████████████████████████████████████████████████████████ | 9623/9741 [00:09<00:00, 1053.88it/s]100%|█████████████████████████████████████████████████████████████████████████████████▉| 9729/9741 [00:10<00:00, 1045.46it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:10<00:00, 971.42it/s]
Load End
Num instances: 1000
[2023-08-22 08:07:05,900] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 08:07:08,516] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 08:07:08,517] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 08:07:08,517] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 08:07:08,517] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 08:07:08,517] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 08:07:08,517] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 08:07:08,517] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 08:07:08,517] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 08:07:08,517] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 08:07:08,517] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 08:07:08,517] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 08:07:08,517] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f14d71d5a60>
[2023-08-22 08:07:08,517] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f14d71d5940>
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 08:07:08,518] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 08:07:08,519] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.42838406562805176 seconds
Time to load utils op: 0.40462708473205566 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
So the final answer is 30

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o4-tgsm8k-s10-rTrue
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:51<41:49, 51.21s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:40<40:05, 50.11s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:28<38:36, 49.28s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:17<37:32, 48.96s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [04:05<36:27, 48.60s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [04:53<35:30, 48.41s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [05:41<34:38, 48.34s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [06:29<33:49, 48.33s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [07:18<33:09, 48.52s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [08:06<32:16, 48.42s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [08:56<31:46, 48.87s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [09:45<30:51, 48.72s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [10:38<30:53, 50.09s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [11:25<29:34, 49.30s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [12:15<28:43, 49.25s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [13:02<27:38, 48.77s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [13:52<26:55, 48.94s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [14:42<26:17, 49.29s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [15:30<25:23, 49.13s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [16:19<24:30, 49.01s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [17:07<23:31, 48.67s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [17:56<22:42, 48.67s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [18:44<21:53, 48.64s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [19:33<21:08, 48.78s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [20:22<20:16, 48.64s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [21:11<19:29, 48.74s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [21:59<18:35, 48.48s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [22:47<17:47, 48.53s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [23:37<17:05, 48.84s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [24:27<16:22, 49.13s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [25:15<15:28, 48.85s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [26:04<14:38, 48.82s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [26:54<14:00, 49.43s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [27:44<13:10, 49.44s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [28:33<12:19, 49.30s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [29:22<11:31, 49.40s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [30:11<10:40, 49.24s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [31:00<09:48, 49.07s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [31:49<08:58, 48.96s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [32:37<08:08, 48.83s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [33:25<07:16, 48.55s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [34:15<06:32, 49.09s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [35:04<05:42, 48.95s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [35:52<04:52, 48.75s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [36:42<04:05, 49.01s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [37:31<03:16, 49.01s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [38:20<02:27, 49.02s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [39:09<01:37, 48.91s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [39:58<00:49, 49.03s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [40:46<00:00, 48.66s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [40:46<00:00, 48.93s/it]
name: commonsenseqa | {'exact_match': 0.2, 'rougeL': 1.8939} | avg. gen lenth: 408.914
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 5
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

using world size: 2
[2023-08-22 08:48:03,803] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 5
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o5-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                    | 60/9741 [00:00<00:16, 596.38it/s]  1%|█                                                                                   | 123/9741 [00:00<00:15, 612.55it/s]  2%|█▌                                                                                  | 186/9741 [00:00<00:15, 617.25it/s]  3%|██▏                                                                                 | 249/9741 [00:00<00:15, 620.20it/s]  3%|██▋                                                                                 | 313/9741 [00:00<00:15, 625.29it/s]  4%|███▎                                                                                | 378/9741 [00:00<00:14, 630.43it/s]  5%|███▊                                                                                | 442/9741 [00:00<00:14, 630.37it/s]  5%|████▎                                                                               | 506/9741 [00:00<00:14, 632.10it/s]  6%|████▉                                                                               | 570/9741 [00:00<00:14, 622.16it/s]  6%|█████▍                                                                              | 633/9741 [00:01<00:14, 623.95it/s]  7%|██████                                                                              | 697/9741 [00:01<00:14, 627.94it/s]  8%|██████▌                                                                             | 761/9741 [00:01<00:14, 629.76it/s]  8%|███████                                                                             | 826/9741 [00:01<00:14, 633.47it/s]  9%|███████▋                                                                            | 890/9741 [00:01<00:13, 634.12it/s] 10%|████████▏                                                                           | 954/9741 [00:01<00:13, 635.82it/s] 10%|████████▋                                                                          | 1019/9741 [00:01<00:13, 637.36it/s] 11%|█████████▏                                                                         | 1083/9741 [00:01<00:13, 637.07it/s] 12%|█████████▊                                                                         | 1148/9741 [00:01<00:13, 639.14it/s] 12%|██████████▎                                                                        | 1212/9741 [00:01<00:13, 637.42it/s] 13%|██████████▉                                                                        | 1277/9741 [00:02<00:13, 638.46it/s] 14%|███████████▋                                                                       | 1371/9741 [00:02<00:11, 727.32it/s] 15%|████████████▌                                                                      | 1468/9741 [00:02<00:10, 797.26it/s] 16%|█████████████▎                                                                     | 1564/9741 [00:02<00:09, 845.09it/s] 17%|██████████████▏                                                                    | 1661/9741 [00:02<00:09, 879.73it/s] 18%|██████████████▉                                                                    | 1758/9741 [00:02<00:08, 906.32it/s] 19%|███████████████▊                                                                   | 1849/9741 [00:02<00:08, 899.97it/s] 20%|████████████████▌                                                                  | 1946/9741 [00:02<00:08, 918.17it/s] 21%|█████████████████▍                                                                 | 2041/9741 [00:02<00:08, 927.38it/s] 22%|██████████████████▏                                                                | 2137/9741 [00:02<00:08, 935.31it/s] 23%|███████████████████                                                                | 2233/9741 [00:03<00:07, 939.84it/s] 24%|███████████████████▊                                                               | 2329/9741 [00:03<00:07, 945.70it/s] 25%|████████████████████▋                                                              | 2424/9741 [00:03<00:07, 937.58it/s] 26%|█████████████████████▍                                                             | 2518/9741 [00:03<00:07, 937.38it/s] 27%|██████████████████████▎                                                            | 2614/9741 [00:03<00:07, 942.59it/s] 28%|███████████████████████                                                            | 2709/9741 [00:03<00:07, 942.91it/s] 29%|███████████████████████▉                                                           | 2805/9741 [00:03<00:07, 946.08it/s] 30%|████████████████████████▋                                                          | 2900/9741 [00:03<00:07, 946.92it/s] 31%|█████████████████████████▌                                                         | 2996/9741 [00:03<00:07, 948.91it/s] 32%|██████████████████████████▎                                                        | 3092/9741 [00:03<00:07, 949.29it/s] 33%|███████████████████████████▏                                                       | 3187/9741 [00:04<00:06, 947.77it/s] 34%|███████████████████████████▉                                                       | 3283/9741 [00:04<00:06, 949.11it/s] 35%|████████████████████████████▊                                                      | 3378/9741 [00:04<00:06, 946.83it/s] 36%|█████████████████████████████▌                                                     | 3474/9741 [00:04<00:06, 948.34it/s] 37%|██████████████████████████████▍                                                    | 3569/9741 [00:04<00:06, 948.75it/s] 38%|███████████████████████████████▏                                                   | 3664/9741 [00:04<00:06, 945.95it/s] 39%|████████████████████████████████                                                   | 3759/9741 [00:04<00:06, 946.72it/s] 40%|████████████████████████████████▊                                                  | 3854/9741 [00:04<00:06, 943.49it/s] 41%|█████████████████████████████████▋                                                 | 3949/9741 [00:04<00:06, 942.69it/s] 42%|██████████████████████████████████▍                                                | 4044/9741 [00:04<00:06, 927.55it/s] 42%|███████████████████████████████████▎                                               | 4139/9741 [00:05<00:06, 931.66it/s] 43%|████████████████████████████████████                                               | 4234/9741 [00:05<00:05, 934.50it/s] 44%|████████████████████████████████████▉                                              | 4328/9741 [00:05<00:05, 935.53it/s] 45%|█████████████████████████████████████▋                                             | 4423/9741 [00:05<00:05, 938.90it/s] 46%|██████████████████████████████████████▍                                            | 4517/9741 [00:05<00:05, 894.08it/s] 47%|███████████████████████████████████████▎                                           | 4611/9741 [00:05<00:05, 905.54it/s] 48%|████████████████████████████████████████                                           | 4704/9741 [00:05<00:05, 912.57it/s] 49%|████████████████████████████████████████▊                                          | 4796/9741 [00:05<00:06, 751.99it/s] 50%|█████████████████████████████████████████▋                                         | 4891/9741 [00:05<00:06, 800.96it/s] 51%|██████████████████████████████████████████▍                                        | 4985/9741 [00:06<00:05, 837.68it/s] 52%|███████████████████████████████████████████▎                                       | 5080/9741 [00:06<00:05, 867.72it/s] 53%|████████████████████████████████████████████                                       | 5173/9741 [00:06<00:05, 885.11it/s] 54%|████████████████████████████████████████████▉                                      | 5267/9741 [00:06<00:04, 898.92it/s] 55%|█████████████████████████████████████████████▋                                     | 5361/9741 [00:06<00:04, 908.44it/s] 56%|██████████████████████████████████████████████▍                                    | 5453/9741 [00:06<00:04, 911.31it/s] 57%|███████████████████████████████████████████████▎                                   | 5548/9741 [00:06<00:04, 920.90it/s] 58%|████████████████████████████████████████████████                                   | 5642/9741 [00:06<00:04, 924.25it/s] 59%|████████████████████████████████████████████████▉                                  | 5737/9741 [00:06<00:04, 930.05it/s] 60%|█████████████████████████████████████████████████▋                                 | 5831/9741 [00:06<00:04, 932.27it/s] 61%|██████████████████████████████████████████████████▍                                | 5926/9741 [00:07<00:04, 936.65it/s] 62%|███████████████████████████████████████████████████▎                               | 6020/9741 [00:07<00:04, 923.42it/s] 63%|████████████████████████████████████████████████████                               | 6113/9741 [00:07<00:03, 912.87it/s] 64%|████████████████████████████████████████████████████▊                              | 6205/9741 [00:07<00:03, 911.37it/s] 65%|█████████████████████████████████████████████████████▋                             | 6297/9741 [00:07<00:03, 907.97it/s] 66%|██████████████████████████████████████████████████████▍                            | 6389/9741 [00:07<00:03, 908.58it/s] 67%|███████████████████████████████████████████████████████▏                           | 6480/9741 [00:07<00:03, 908.93it/s] 67%|███████████████████████████████████████████████████████▉                           | 6571/9741 [00:07<00:03, 906.51it/s] 68%|████████████████████████████████████████████████████████▊                          | 6662/9741 [00:07<00:03, 907.42it/s] 69%|█████████████████████████████████████████████████████████▌                         | 6753/9741 [00:07<00:03, 904.89it/s] 70%|██████████████████████████████████████████████████████████▎                        | 6844/9741 [00:08<00:03, 904.25it/s] 71%|███████████████████████████████████████████████████████████                        | 6935/9741 [00:08<00:03, 903.53it/s] 72%|███████████████████████████████████████████████████████████▊                       | 7026/9741 [00:08<00:03, 899.84it/s] 73%|████████████████████████████████████████████████████████████▋                      | 7117/9741 [00:08<00:02, 901.00it/s] 74%|█████████████████████████████████████████████████████████████▍                     | 7208/9741 [00:08<00:02, 898.86it/s] 75%|██████████████████████████████████████████████████████████████▏                    | 7299/9741 [00:08<00:02, 899.76it/s] 76%|██████████████████████████████████████████████████████████████▉                    | 7390/9741 [00:08<00:02, 900.82it/s] 77%|███████████████████████████████████████████████████████████████▋                   | 7481/9741 [00:08<00:02, 862.27it/s] 78%|████████████████████████████████████████████████████████████████▌                  | 7571/9741 [00:08<00:02, 872.51it/s] 79%|█████████████████████████████████████████████████████████████████▎                 | 7660/9741 [00:08<00:02, 876.48it/s] 80%|██████████████████████████████████████████████████████████████████                 | 7750/9741 [00:09<00:02, 882.50it/s] 80%|██████████████████████████████████████████████████████████████████▊                | 7840/9741 [00:09<00:02, 886.15it/s] 81%|███████████████████████████████████████████████████████████████████▌               | 7929/9741 [00:09<00:02, 883.85it/s] 82%|████████████████████████████████████████████████████████████████████▎              | 8019/9741 [00:09<00:01, 887.20it/s] 83%|█████████████████████████████████████████████████████████████████████              | 8108/9741 [00:09<00:01, 886.18it/s] 84%|█████████████████████████████████████████████████████████████████████▊             | 8198/9741 [00:09<00:01, 887.53it/s] 85%|██████████████████████████████████████████████████████████████████████▌            | 8288/9741 [00:09<00:01, 888.37it/s] 86%|███████████████████████████████████████████████████████████████████████▍           | 8377/9741 [00:09<00:01, 887.09it/s] 87%|████████████████████████████████████████████████████████████████████████▏          | 8467/9741 [00:09<00:01, 888.31it/s] 88%|████████████████████████████████████████████████████████████████████████▉          | 8556/9741 [00:10<00:01, 885.56it/s] 89%|█████████████████████████████████████████████████████████████████████████▋         | 8646/9741 [00:10<00:01, 887.38it/s] 90%|██████████████████████████████████████████████████████████████████████████▍        | 8736/9741 [00:10<00:01, 888.70it/s] 91%|███████████████████████████████████████████████████████████████████████████▏       | 8825/9741 [00:10<00:01, 886.28it/s] 92%|███████████████████████████████████████████████████████████████████████████▉       | 8915/9741 [00:10<00:00, 888.47it/s] 92%|████████████████████████████████████████████████████████████████████████████▋      | 9004/9741 [00:10<00:00, 886.85it/s] 93%|█████████████████████████████████████████████████████████████████████████████▍     | 9093/9741 [00:10<00:00, 887.05it/s] 94%|██████████████████████████████████████████████████████████████████████████████▏    | 9182/9741 [00:10<00:00, 887.42it/s] 95%|██████████████████████████████████████████████████████████████████████████████▉    | 9271/9741 [00:10<00:00, 883.20it/s] 96%|███████████████████████████████████████████████████████████████████████████████▊   | 9360/9741 [00:10<00:00, 881.46it/s] 97%|████████████████████████████████████████████████████████████████████████████████▌  | 9449/9741 [00:11<00:00, 880.11it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▎ | 9538/9741 [00:11<00:00, 876.23it/s] 99%|██████████████████████████████████████████████████████████████████████████████████ | 9626/9741 [00:11<00:00, 875.19it/s]100%|██████████████████████████████████████████████████████████████████████████████████▊| 9714/9741 [00:11<00:00, 870.41it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:11<00:00, 858.26it/s]
Load End
Num instances: 1000
[2023-08-22 08:48:26,656] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 08:48:29,615] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 08:48:29,615] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f7b31671a60>
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 08:48:29,616] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f7b31671940>
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 08:48:29,617] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 08:48:29,617] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4632084369659424 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
So the final answer is 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
So the final answer is 868

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o5-tgsm8k-s10-rTrue
Loading extension module utils...
Time to load utils op: 0.5049643516540527 seconds
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:45<37:27, 45.86s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:31<36:30, 45.64s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:18<36:12, 46.22s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:03<35:08, 45.84s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [03:47<34:00, 45.34s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [04:32<33:05, 45.12s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [05:18<32:25, 45.25s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [06:03<31:46, 45.39s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [06:49<30:58, 45.32s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [07:33<30:03, 45.08s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [08:20<29:44, 45.76s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [09:06<29:02, 45.86s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [09:52<28:16, 45.84s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [10:37<27:21, 45.60s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [11:23<26:36, 45.61s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [12:07<25:39, 45.27s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [12:53<24:59, 45.43s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [13:39<24:17, 45.56s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [14:24<23:29, 45.48s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [15:09<22:36, 45.21s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [15:54<21:46, 45.06s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [16:38<20:58, 44.95s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [17:24<20:16, 45.04s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [18:10<19:43, 45.53s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [18:56<18:57, 45.49s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [19:41<18:12, 45.50s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [20:26<17:19, 45.21s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [21:11<16:36, 45.28s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [21:57<15:52, 45.35s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [22:42<15:08, 45.42s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [23:28<14:21, 45.37s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [24:12<13:34, 45.23s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [24:59<12:56, 45.65s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [25:45<12:10, 45.64s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [26:29<11:19, 45.30s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [27:15<10:38, 45.59s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [28:01<09:51, 45.46s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [28:46<09:03, 45.31s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [29:32<08:21, 45.62s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [30:18<07:36, 45.64s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [31:02<06:48, 45.40s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [31:48<06:02, 45.31s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [32:33<05:16, 45.23s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [33:18<04:32, 45.38s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [34:04<03:46, 45.38s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [34:50<03:02, 45.57s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [35:34<02:15, 45.22s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [36:19<01:30, 45.13s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [37:04<00:45, 45.12s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [37:48<00:00, 44.86s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [37:48<00:00, 45.38s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.55} | avg. gen lenth: 428.148
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 6
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 09:27:07,636] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 6
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o6-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                    | 41/9741 [00:00<00:24, 404.00it/s]  1%|▋                                                                                    | 83/9741 [00:00<00:23, 411.63it/s]  1%|█                                                                                   | 126/9741 [00:00<00:22, 418.52it/s]  2%|█▍                                                                                  | 169/9741 [00:00<00:22, 421.43it/s]  2%|█▊                                                                                  | 212/9741 [00:00<00:22, 421.07it/s]  3%|██▏                                                                                 | 255/9741 [00:00<00:22, 423.55it/s]  3%|██▌                                                                                 | 298/9741 [00:00<00:22, 424.65it/s]  4%|██▉                                                                                 | 341/9741 [00:00<00:22, 416.97it/s]  4%|███▎                                                                                | 384/9741 [00:00<00:22, 419.83it/s]  4%|███▋                                                                                | 427/9741 [00:01<00:22, 419.24it/s]  5%|████                                                                                | 470/9741 [00:01<00:21, 422.37it/s]  5%|████▍                                                                               | 514/9741 [00:01<00:21, 425.05it/s]  6%|████▊                                                                               | 558/9741 [00:01<00:21, 426.53it/s]  6%|█████▎                                                                              | 611/9741 [00:01<00:20, 456.17it/s]  7%|█████▊                                                                              | 676/9741 [00:01<00:17, 512.41it/s]  8%|██████▍                                                                             | 741/9741 [00:01<00:16, 552.88it/s]  8%|██████▉                                                                             | 806/9741 [00:01<00:15, 581.47it/s]  9%|███████▌                                                                            | 870/9741 [00:01<00:14, 598.36it/s] 10%|████████                                                                            | 935/9741 [00:01<00:14, 611.18it/s] 10%|████████▌                                                                          | 1000/9741 [00:02<00:14, 619.91it/s] 11%|█████████                                                                          | 1065/9741 [00:02<00:13, 627.83it/s] 12%|█████████▋                                                                         | 1130/9741 [00:02<00:13, 634.09it/s] 12%|██████████▏                                                                        | 1195/9741 [00:02<00:13, 638.34it/s] 13%|██████████▋                                                                        | 1260/9741 [00:02<00:13, 641.17it/s] 14%|███████████▎                                                                       | 1325/9741 [00:02<00:13, 639.60it/s] 14%|███████████▊                                                                       | 1389/9741 [00:02<00:13, 639.60it/s] 15%|████████████▍                                                                      | 1453/9741 [00:02<00:13, 635.67it/s] 16%|████████████▉                                                                      | 1517/9741 [00:02<00:12, 635.13it/s] 16%|█████████████▍                                                                     | 1581/9741 [00:02<00:12, 633.07it/s] 17%|██████████████                                                                     | 1645/9741 [00:03<00:12, 634.02it/s] 18%|██████████████▌                                                                    | 1709/9741 [00:03<00:12, 634.05it/s] 18%|███████████████                                                                    | 1773/9741 [00:03<00:12, 616.83it/s] 19%|███████████████▋                                                                   | 1838/9741 [00:03<00:12, 624.60it/s] 20%|████████████████▏                                                                  | 1902/9741 [00:03<00:12, 628.75it/s] 20%|████████████████▊                                                                  | 1966/9741 [00:03<00:12, 630.73it/s] 21%|█████████████████▎                                                                 | 2030/9741 [00:03<00:12, 631.58it/s] 21%|█████████████████▊                                                                 | 2094/9741 [00:03<00:12, 632.45it/s] 22%|██████████████████▍                                                                | 2158/9741 [00:03<00:11, 633.46it/s] 23%|██████████████████▉                                                                | 2222/9741 [00:03<00:11, 632.80it/s] 23%|███████████████████▍                                                               | 2286/9741 [00:04<00:11, 634.18it/s] 24%|████████████████████                                                               | 2350/9741 [00:04<00:11, 634.80it/s] 25%|████████████████████▌                                                              | 2414/9741 [00:04<00:11, 633.92it/s] 25%|█████████████████████                                                              | 2478/9741 [00:04<00:11, 631.59it/s] 26%|█████████████████████▋                                                             | 2542/9741 [00:04<00:11, 632.79it/s] 27%|██████████████████████▏                                                            | 2607/9741 [00:04<00:11, 635.75it/s] 27%|██████████████████████▊                                                            | 2671/9741 [00:04<00:11, 634.58it/s] 28%|███████████████████████▎                                                           | 2735/9741 [00:04<00:11, 634.18it/s] 29%|███████████████████████▊                                                           | 2799/9741 [00:04<00:10, 634.99it/s] 29%|████████████████████████▍                                                          | 2863/9741 [00:04<00:10, 636.16it/s] 30%|████████████████████████▉                                                          | 2927/9741 [00:05<00:10, 630.12it/s] 31%|█████████████████████████▍                                                         | 2991/9741 [00:05<00:10, 630.35it/s] 31%|██████████████████████████                                                         | 3055/9741 [00:05<00:10, 632.38it/s] 32%|██████████████████████████▌                                                        | 3119/9741 [00:05<00:10, 631.75it/s] 33%|███████████████████████████                                                        | 3183/9741 [00:05<00:10, 631.46it/s] 33%|███████████████████████████▋                                                       | 3247/9741 [00:05<00:10, 633.48it/s] 34%|████████████████████████████▏                                                      | 3311/9741 [00:05<00:10, 632.17it/s] 35%|████████████████████████████▊                                                      | 3375/9741 [00:05<00:10, 618.91it/s] 35%|█████████████████████████████▎                                                     | 3439/9741 [00:05<00:10, 622.90it/s] 36%|█████████████████████████████▊                                                     | 3502/9741 [00:05<00:10, 623.30it/s] 37%|██████████████████████████████▍                                                    | 3565/9741 [00:06<00:09, 624.84it/s] 37%|██████████████████████████████▉                                                    | 3628/9741 [00:06<00:09, 624.97it/s] 38%|███████████████████████████████▍                                                   | 3691/9741 [00:06<00:09, 626.45it/s] 39%|███████████████████████████████▉                                                   | 3755/9741 [00:06<00:09, 628.14it/s] 39%|████████████████████████████████▌                                                  | 3818/9741 [00:06<00:09, 625.32it/s] 40%|█████████████████████████████████                                                  | 3881/9741 [00:06<00:09, 623.93it/s] 40%|█████████████████████████████████▌                                                 | 3944/9741 [00:06<00:09, 625.06it/s] 41%|██████████████████████████████████▏                                                | 4008/9741 [00:06<00:09, 627.13it/s] 42%|██████████████████████████████████▋                                                | 4071/9741 [00:06<00:09, 625.55it/s] 42%|███████████████████████████████████▏                                               | 4134/9741 [00:06<00:08, 626.35it/s] 43%|███████████████████████████████████▊                                               | 4197/9741 [00:07<00:08, 627.15it/s] 44%|████████████████████████████████████▎                                              | 4260/9741 [00:07<00:08, 624.38it/s] 44%|████████████████████████████████████▊                                              | 4324/9741 [00:07<00:08, 627.02it/s] 45%|█████████████████████████████████████▍                                             | 4387/9741 [00:07<00:08, 626.11it/s] 46%|█████████████████████████████████████▉                                             | 4450/9741 [00:07<00:08, 624.65it/s] 46%|██████████████████████████████████████▍                                            | 4513/9741 [00:07<00:08, 585.96it/s] 47%|██████████████████████████████████████▉                                            | 4576/9741 [00:07<00:08, 597.46it/s] 48%|███████████████████████████████████████▌                                           | 4639/9741 [00:07<00:08, 605.82it/s] 48%|████████████████████████████████████████                                           | 4702/9741 [00:07<00:08, 612.08it/s] 49%|████████████████████████████████████████▌                                          | 4764/9741 [00:08<00:10, 475.64it/s] 50%|█████████████████████████████████████████▏                                         | 4827/9741 [00:08<00:09, 512.81it/s] 50%|█████████████████████████████████████████▋                                         | 4890/9741 [00:08<00:08, 541.96it/s] 51%|██████████████████████████████████████████▏                                        | 4953/9741 [00:08<00:08, 563.98it/s] 51%|██████████████████████████████████████████▋                                        | 5016/9741 [00:08<00:08, 581.34it/s] 52%|███████████████████████████████████████████▎                                       | 5079/9741 [00:08<00:07, 593.99it/s] 53%|███████████████████████████████████████████▊                                       | 5140/9741 [00:08<00:07, 591.02it/s] 53%|████████████████████████████████████████████▎                                      | 5203/9741 [00:08<00:07, 601.83it/s] 54%|████████████████████████████████████████████▊                                      | 5266/9741 [00:08<00:07, 607.71it/s] 55%|█████████████████████████████████████████████▍                                     | 5329/9741 [00:09<00:07, 612.02it/s] 55%|█████████████████████████████████████████████▉                                     | 5391/9741 [00:09<00:07, 612.79it/s] 56%|██████████████████████████████████████████████▍                                    | 5454/9741 [00:09<00:06, 616.58it/s] 57%|███████████████████████████████████████████████                                    | 5517/9741 [00:09<00:06, 619.67it/s] 57%|███████████████████████████████████████████████▌                                   | 5580/9741 [00:09<00:06, 620.89it/s] 58%|████████████████████████████████████████████████                                   | 5643/9741 [00:09<00:06, 618.52it/s] 59%|████████████████████████████████████████████████▌                                  | 5706/9741 [00:09<00:06, 619.85it/s] 59%|█████████████████████████████████████████████████▏                                 | 5769/9741 [00:09<00:06, 620.86it/s] 60%|█████████████████████████████████████████████████▋                                 | 5832/9741 [00:09<00:06, 620.18it/s] 61%|██████████████████████████████████████████████████▏                                | 5895/9741 [00:09<00:06, 621.20it/s] 61%|██████████████████████████████████████████████████▊                                | 5958/9741 [00:10<00:06, 622.65it/s] 62%|███████████████████████████████████████████████████▎                               | 6021/9741 [00:10<00:05, 623.40it/s] 62%|███████████████████████████████████████████████████▊                               | 6084/9741 [00:10<00:05, 622.21it/s] 63%|████████████████████████████████████████████████████▍                              | 6147/9741 [00:10<00:05, 622.13it/s] 64%|████████████████████████████████████████████████████▉                              | 6210/9741 [00:10<00:05, 623.40it/s] 64%|█████████████████████████████████████████████████████▍                             | 6273/9741 [00:10<00:05, 620.82it/s] 65%|█████████████████████████████████████████████████████▉                             | 6336/9741 [00:10<00:05, 621.37it/s] 66%|██████████████████████████████████████████████████████▌                            | 6399/9741 [00:10<00:05, 622.31it/s] 66%|███████████████████████████████████████████████████████                            | 6462/9741 [00:10<00:05, 621.46it/s] 67%|███████████████████████████████████████████████████████▌                           | 6525/9741 [00:10<00:05, 619.75it/s] 68%|████████████████████████████████████████████████████████▏                          | 6588/9741 [00:11<00:05, 621.02it/s] 68%|████████████████████████████████████████████████████████▋                          | 6651/9741 [00:11<00:04, 622.38it/s] 69%|█████████████████████████████████████████████████████████▏                         | 6714/9741 [00:11<00:04, 622.84it/s] 70%|█████████████████████████████████████████████████████████▋                         | 6777/9741 [00:11<00:04, 622.01it/s] 70%|██████████████████████████████████████████████████████████▎                        | 6840/9741 [00:11<00:04, 622.80it/s] 71%|██████████████████████████████████████████████████████████▊                        | 6903/9741 [00:11<00:04, 623.33it/s] 72%|███████████████████████████████████████████████████████████▎                       | 6966/9741 [00:11<00:04, 622.21it/s] 72%|███████████████████████████████████████████████████████████▉                       | 7029/9741 [00:11<00:04, 621.12it/s] 73%|████████████████████████████████████████████████████████████▍                      | 7092/9741 [00:11<00:04, 620.31it/s] 73%|████████████████████████████████████████████████████████████▉                      | 7155/9741 [00:11<00:04, 621.54it/s] 74%|█████████████████████████████████████████████████████████████▌                     | 7218/9741 [00:12<00:04, 616.54it/s] 75%|██████████████████████████████████████████████████████████████                     | 7280/9741 [00:12<00:03, 617.38it/s] 75%|██████████████████████████████████████████████████████████████▌                    | 7343/9741 [00:12<00:03, 619.35it/s] 76%|███████████████████████████████████████████████████████████████                    | 7406/9741 [00:12<00:03, 621.47it/s] 77%|███████████████████████████████████████████████████████████████▋                   | 7469/9741 [00:12<00:03, 592.85it/s] 77%|████████████████████████████████████████████████████████████████▏                  | 7531/9741 [00:12<00:03, 600.28it/s] 78%|████████████████████████████████████████████████████████████████▋                  | 7594/9741 [00:12<00:03, 606.35it/s] 79%|█████████████████████████████████████████████████████████████████▏                 | 7656/9741 [00:12<00:03, 608.99it/s] 79%|█████████████████████████████████████████████████████████████████▊                 | 7719/9741 [00:12<00:03, 612.69it/s] 80%|██████████████████████████████████████████████████████████████████▎                | 7782/9741 [00:13<00:03, 615.60it/s] 81%|██████████████████████████████████████████████████████████████████▊                | 7845/9741 [00:13<00:03, 617.40it/s] 81%|███████████████████████████████████████████████████████████████████▎               | 7907/9741 [00:13<00:02, 616.64it/s] 82%|███████████████████████████████████████████████████████████████████▉               | 7969/9741 [00:13<00:02, 617.00it/s] 82%|████████████████████████████████████████████████████████████████████▍              | 8031/9741 [00:13<00:02, 615.83it/s] 83%|████████████████████████████████████████████████████████████████████▉              | 8093/9741 [00:13<00:02, 614.23it/s] 84%|█████████████████████████████████████████████████████████████████████▍             | 8155/9741 [00:13<00:02, 615.45it/s] 84%|██████████████████████████████████████████████████████████████████████             | 8217/9741 [00:13<00:02, 615.35it/s] 85%|██████████████████████████████████████████████████████████████████████▌            | 8279/9741 [00:13<00:02, 615.33it/s] 86%|███████████████████████████████████████████████████████████████████████            | 8341/9741 [00:13<00:02, 613.56it/s] 86%|███████████████████████████████████████████████████████████████████████▌           | 8403/9741 [00:14<00:02, 613.89it/s] 87%|████████████████████████████████████████████████████████████████████████▏          | 8465/9741 [00:14<00:02, 614.69it/s] 88%|████████████████████████████████████████████████████████████████████████▋          | 8527/9741 [00:14<00:01, 614.97it/s] 88%|█████████████████████████████████████████████████████████████████████████▏         | 8589/9741 [00:14<00:01, 604.83it/s] 89%|█████████████████████████████████████████████████████████████████████████▋         | 8651/9741 [00:14<00:01, 607.33it/s] 89%|██████████████████████████████████████████████████████████████████████████▏        | 8713/9741 [00:14<00:01, 609.36it/s] 90%|██████████████████████████████████████████████████████████████████████████▊        | 8774/9741 [00:14<00:01, 608.18it/s] 91%|███████████████████████████████████████████████████████████████████████████▎       | 8836/9741 [00:14<00:01, 610.69it/s] 91%|███████████████████████████████████████████████████████████████████████████▊       | 8898/9741 [00:14<00:01, 613.08it/s] 92%|████████████████████████████████████████████████████████████████████████████▎      | 8960/9741 [00:14<00:01, 614.26it/s] 93%|████████████████████████████████████████████████████████████████████████████▊      | 9022/9741 [00:15<00:01, 612.54it/s] 93%|█████████████████████████████████████████████████████████████████████████████▍     | 9084/9741 [00:15<00:01, 612.58it/s] 94%|█████████████████████████████████████████████████████████████████████████████▉     | 9146/9741 [00:15<00:00, 613.02it/s] 95%|██████████████████████████████████████████████████████████████████████████████▍    | 9208/9741 [00:15<00:00, 613.09it/s] 95%|██████████████████████████████████████████████████████████████████████████████▉    | 9270/9741 [00:15<00:00, 611.75it/s] 96%|███████████████████████████████████████████████████████████████████████████████▌   | 9332/9741 [00:15<00:00, 613.52it/s] 96%|████████████████████████████████████████████████████████████████████████████████   | 9394/9741 [00:15<00:00, 613.62it/s] 97%|████████████████████████████████████████████████████████████████████████████████▌  | 9456/9741 [00:15<00:00, 611.68it/s] 98%|█████████████████████████████████████████████████████████████████████████████████  | 9518/9741 [00:15<00:00, 611.92it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▋ | 9580/9741 [00:15<00:00, 613.64it/s] 99%|██████████████████████████████████████████████████████████████████████████████████▏| 9642/9741 [00:16<00:00, 614.47it/s]100%|██████████████████████████████████████████████████████████████████████████████████▋| 9704/9741 [00:16<00:00, 610.56it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:16<00:00, 601.39it/s]
Load End
Num instances: 1000
[2023-08-22 09:27:35,240] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 09:27:38,155] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 09:27:38,156] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f9613f5ea60>
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 09:27:38,156] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f9613f5e940>
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 09:27:38,157] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 09:27:38,157] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4375762939453125 seconds
Loading extension module utils...
Time to load utils op: 0.5047953128814697 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
So the final answer is 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
So the final answer is 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: Stella and Twinkle filled up the truck at the rate of 250 blocks per hour per person, a total of 2*250 = <<250*2=500>>500 blocks per hour for both.
After working for four hours, Stella and Twinkle had filled 4*500 = <<4*500=2000>>2000 blocks into the truck.
The number of blocks they had to put into the truck for it to be full is 6000-2000 = <<6000-2000=4000>>4000
When 6 more people joined Stella and Twinkle, a total of 2+6 = <<2+6=8>>8 people were filling the truck now.
Working at the rate of 250 blocks per person, the eight people filled the truck with 250*8 = <<250*8=2000>>2000 blocks in one hour.
If there were 4000 blocks that still needed to be put into the truck, the 8 people took 4000/2000 = <<4000/2000=2>>2 hours to fill the truck with the blocks.
The total time it took to fill up the tank is 4+2 = <<4+2=6>>6 hours.
So the final answer is 6

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o6-tgsm8k-s10-rTrue
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:39<32:07, 39.34s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:18<31:18, 39.14s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [01:56<30:14, 38.60s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [02:35<29:38, 38.66s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [03:13<28:50, 38.45s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [03:51<28:13, 38.50s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [04:30<27:42, 38.66s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [05:09<27:02, 38.63s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [05:47<26:17, 38.48s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [06:25<25:38, 38.47s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [07:04<25:02, 38.52s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [07:42<24:18, 38.39s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [08:20<23:35, 38.26s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [08:58<22:53, 38.15s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [09:36<22:15, 38.15s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [10:15<21:42, 38.32s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [10:54<21:08, 38.44s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [11:31<20:24, 38.26s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [12:09<19:42, 38.13s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [12:48<19:07, 38.24s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [13:26<18:33, 38.39s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [14:05<17:56, 38.45s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [14:43<17:17, 38.41s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [15:22<16:37, 38.37s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [16:00<15:58, 38.33s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [16:38<15:21, 38.39s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [17:17<14:45, 38.49s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [17:56<14:06, 38.46s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [18:34<13:28, 38.52s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [19:14<12:56, 38.81s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [19:54<12:23, 39.14s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [20:32<11:41, 38.95s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [21:12<11:07, 39.27s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [21:51<10:27, 39.20s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [22:30<09:47, 39.19s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [23:10<09:09, 39.22s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [23:48<08:25, 38.92s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [24:26<07:45, 38.75s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [25:05<07:07, 38.85s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [25:45<06:30, 39.05s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [26:24<05:50, 38.96s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [27:02<05:10, 38.86s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [27:42<04:33, 39.02s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [28:20<03:52, 38.82s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [28:58<03:13, 38.64s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [29:38<02:35, 38.87s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [30:16<01:56, 38.88s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [30:55<01:17, 38.81s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [31:34<00:38, 38.72s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [32:13<00:00, 38.85s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [32:13<00:00, 38.66s/it]
name: commonsenseqa | {'exact_match': 0.2, 'rougeL': 1.3067} | avg. gen lenth: 447.412
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 7
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 10:00:16,005] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 7
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o7-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                    | 58/9741 [00:00<00:16, 570.88it/s]  1%|█                                                                                   | 117/9741 [00:00<00:16, 579.08it/s]  2%|█▌                                                                                  | 175/9741 [00:00<00:16, 579.40it/s]  2%|██                                                                                  | 234/9741 [00:00<00:16, 582.31it/s]  3%|██▌                                                                                 | 293/9741 [00:00<00:16, 583.26it/s]  4%|███                                                                                 | 352/9741 [00:00<00:16, 582.97it/s]  4%|███▌                                                                                | 411/9741 [00:00<00:16, 582.76it/s]  5%|████                                                                                | 470/9741 [00:00<00:15, 583.70it/s]  5%|████▌                                                                               | 529/9741 [00:00<00:16, 574.27it/s]  6%|█████                                                                               | 588/9741 [00:01<00:15, 577.65it/s]  7%|█████▌                                                                              | 646/9741 [00:01<00:15, 577.66it/s]  7%|██████                                                                              | 706/9741 [00:01<00:15, 581.48it/s]  8%|██████▌                                                                             | 766/9741 [00:01<00:15, 584.67it/s]  8%|███████                                                                             | 826/9741 [00:01<00:15, 588.32it/s]  9%|███████▋                                                                            | 885/9741 [00:01<00:15, 587.61it/s] 10%|████████▏                                                                           | 945/9741 [00:01<00:14, 588.78it/s] 10%|████████▌                                                                          | 1005/9741 [00:01<00:14, 589.85it/s] 11%|█████████                                                                          | 1065/9741 [00:01<00:14, 590.88it/s] 12%|█████████▌                                                                         | 1125/9741 [00:01<00:14, 585.59it/s] 12%|██████████                                                                         | 1185/9741 [00:02<00:14, 586.96it/s] 13%|██████████▌                                                                        | 1244/9741 [00:02<00:14, 585.26it/s] 13%|███████████                                                                        | 1303/9741 [00:02<00:14, 585.25it/s] 14%|███████████▌                                                                       | 1362/9741 [00:02<00:14, 583.77it/s] 15%|████████████                                                                       | 1421/9741 [00:02<00:14, 583.55it/s] 15%|████████████▌                                                                      | 1480/9741 [00:02<00:14, 584.83it/s] 16%|█████████████                                                                      | 1539/9741 [00:02<00:14, 584.85it/s] 16%|█████████████▌                                                                     | 1598/9741 [00:02<00:13, 585.72it/s] 17%|██████████████                                                                     | 1657/9741 [00:02<00:13, 584.40it/s] 18%|██████████████▌                                                                    | 1716/9741 [00:02<00:13, 585.46it/s] 18%|███████████████                                                                    | 1775/9741 [00:03<00:14, 563.58it/s] 19%|███████████████▌                                                                   | 1832/9741 [00:03<00:14, 561.83it/s] 19%|████████████████                                                                   | 1889/9741 [00:03<00:13, 563.39it/s] 20%|████████████████▌                                                                  | 1947/9741 [00:03<00:13, 565.67it/s] 21%|█████████████████                                                                  | 2004/9741 [00:03<00:13, 566.38it/s] 21%|█████████████████▌                                                                 | 2062/9741 [00:03<00:13, 570.32it/s] 22%|██████████████████                                                                 | 2121/9741 [00:03<00:13, 574.18it/s] 22%|██████████████████▌                                                                | 2180/9741 [00:03<00:13, 578.30it/s] 23%|███████████████████                                                                | 2239/9741 [00:03<00:12, 579.65it/s] 24%|███████████████████▌                                                               | 2298/9741 [00:03<00:12, 581.40it/s] 24%|████████████████████                                                               | 2357/9741 [00:04<00:12, 582.49it/s] 25%|████████████████████▌                                                              | 2416/9741 [00:04<00:12, 580.81it/s] 25%|█████████████████████                                                              | 2475/9741 [00:04<00:12, 577.92it/s] 26%|█████████████████████▌                                                             | 2534/9741 [00:04<00:12, 579.65it/s] 27%|██████████████████████                                                             | 2592/9741 [00:04<00:12, 579.72it/s] 27%|██████████████████████▌                                                            | 2651/9741 [00:04<00:12, 579.85it/s] 28%|███████████████████████                                                            | 2709/9741 [00:04<00:12, 578.57it/s] 28%|███████████████████████▌                                                           | 2767/9741 [00:04<00:12, 578.53it/s] 29%|████████████████████████                                                           | 2825/9741 [00:04<00:11, 578.34it/s] 30%|████████████████████████▌                                                          | 2883/9741 [00:04<00:11, 578.22it/s] 30%|█████████████████████████                                                          | 2941/9741 [00:05<00:11, 575.28it/s] 31%|█████████████████████████▌                                                         | 3000/9741 [00:05<00:11, 578.18it/s] 31%|██████████████████████████                                                         | 3058/9741 [00:05<00:11, 577.69it/s] 32%|██████████████████████████▌                                                        | 3116/9741 [00:05<00:11, 576.71it/s] 33%|███████████████████████████                                                        | 3174/9741 [00:05<00:11, 576.93it/s] 33%|███████████████████████████▌                                                       | 3232/9741 [00:05<00:11, 574.52it/s] 34%|████████████████████████████                                                       | 3290/9741 [00:05<00:11, 576.09it/s] 34%|████████████████████████████▌                                                      | 3348/9741 [00:05<00:11, 574.94it/s] 35%|█████████████████████████████                                                      | 3406/9741 [00:05<00:10, 576.33it/s] 36%|█████████████████████████████▌                                                     | 3464/9741 [00:05<00:10, 577.38it/s] 36%|██████████████████████████████                                                     | 3522/9741 [00:06<00:10, 578.00it/s] 37%|██████████████████████████████▌                                                    | 3580/9741 [00:06<00:10, 568.71it/s] 37%|██████████████████████████████▉                                                    | 3638/9741 [00:06<00:10, 570.05it/s] 38%|███████████████████████████████▍                                                   | 3696/9741 [00:06<00:10, 572.97it/s] 39%|███████████████████████████████▉                                                   | 3754/9741 [00:06<00:10, 572.73it/s] 39%|████████████████████████████████▍                                                  | 3812/9741 [00:06<00:10, 570.43it/s] 40%|████████████████████████████████▉                                                  | 3870/9741 [00:06<00:10, 566.83it/s] 40%|█████████████████████████████████▍                                                 | 3928/9741 [00:06<00:10, 568.17it/s] 41%|█████████████████████████████████▉                                                 | 3986/9741 [00:06<00:10, 570.12it/s] 42%|██████████████████████████████████▍                                                | 4044/9741 [00:06<00:10, 569.00it/s] 42%|██████████████████████████████████▉                                                | 4102/9741 [00:07<00:09, 570.34it/s] 43%|███████████████████████████████████▍                                               | 4160/9741 [00:07<00:09, 568.65it/s] 43%|███████████████████████████████████▉                                               | 4217/9741 [00:07<00:09, 566.85it/s] 44%|████████████████████████████████████▍                                              | 4274/9741 [00:07<00:09, 563.70it/s] 44%|████████████████████████████████████▉                                              | 4331/9741 [00:07<00:09, 561.64it/s] 45%|█████████████████████████████████████▍                                             | 4388/9741 [00:07<00:09, 562.74it/s] 46%|█████████████████████████████████████▊                                             | 4445/9741 [00:07<00:09, 563.53it/s] 46%|██████████████████████████████████████▎                                            | 4502/9741 [00:07<00:09, 527.71it/s] 47%|██████████████████████████████████████▊                                            | 4560/9741 [00:07<00:09, 539.91it/s] 47%|███████████████████████████████████████▎                                           | 4618/9741 [00:08<00:09, 550.55it/s] 48%|███████████████████████████████████████▊                                           | 4675/9741 [00:08<00:09, 555.96it/s] 49%|████████████████████████████████████████▎                                          | 4731/9741 [00:08<00:12, 405.33it/s] 49%|████████████████████████████████████████▊                                          | 4789/9741 [00:08<00:11, 445.89it/s] 50%|█████████████████████████████████████████▎                                         | 4847/9741 [00:08<00:10, 478.82it/s] 50%|█████████████████████████████████████████▊                                         | 4905/9741 [00:08<00:09, 504.79it/s] 51%|██████████████████████████████████████████▎                                        | 4963/9741 [00:08<00:09, 524.27it/s] 52%|██████████████████████████████████████████▊                                        | 5020/9741 [00:08<00:08, 535.13it/s] 52%|███████████████████████████████████████████▎                                       | 5077/9741 [00:08<00:08, 543.00it/s] 53%|███████████████████████████████████████████▊                                       | 5135/9741 [00:09<00:08, 551.92it/s] 53%|████████████████████████████████████████████▏                                      | 5192/9741 [00:09<00:08, 556.84it/s] 54%|████████████████████████████████████████████▋                                      | 5250/9741 [00:09<00:07, 563.07it/s] 54%|█████████████████████████████████████████████▏                                     | 5308/9741 [00:09<00:07, 567.53it/s] 55%|█████████████████████████████████████████████▋                                     | 5366/9741 [00:09<00:07, 569.72it/s] 56%|██████████████████████████████████████████████▏                                    | 5424/9741 [00:09<00:07, 569.99it/s] 56%|██████████████████████████████████████████████▋                                    | 5482/9741 [00:09<00:07, 571.56it/s] 57%|███████████████████████████████████████████████▏                                   | 5540/9741 [00:09<00:07, 570.11it/s] 57%|███████████████████████████████████████████████▋                                   | 5598/9741 [00:09<00:07, 565.08it/s] 58%|████████████████████████████████████████████████▏                                  | 5655/9741 [00:09<00:07, 560.75it/s] 59%|████████████████████████████████████████████████▋                                  | 5712/9741 [00:10<00:07, 563.27it/s] 59%|█████████████████████████████████████████████████▏                                 | 5770/9741 [00:10<00:07, 565.39it/s] 60%|█████████████████████████████████████████████████▋                                 | 5827/9741 [00:10<00:06, 563.18it/s] 60%|██████████████████████████████████████████████████▏                                | 5884/9741 [00:10<00:06, 562.98it/s] 61%|██████████████████████████████████████████████████▌                                | 5941/9741 [00:10<00:06, 562.71it/s] 62%|███████████████████████████████████████████████████                                | 5998/9741 [00:10<00:06, 562.71it/s] 62%|███████████████████████████████████████████████████▌                               | 6055/9741 [00:10<00:06, 561.20it/s] 63%|████████████████████████████████████████████████████                               | 6112/9741 [00:10<00:06, 561.84it/s] 63%|████████████████████████████████████████████████████▌                              | 6169/9741 [00:10<00:06, 560.11it/s] 64%|█████████████████████████████████████████████████████                              | 6226/9741 [00:11<00:06, 560.78it/s] 65%|█████████████████████████████████████████████████████▌                             | 6283/9741 [00:11<00:06, 555.52it/s] 65%|██████████████████████████████████████████████████████                             | 6339/9741 [00:11<00:06, 556.71it/s] 66%|██████████████████████████████████████████████████████▍                            | 6396/9741 [00:11<00:05, 558.71it/s] 66%|██████████████████████████████████████████████████████▉                            | 6453/9741 [00:11<00:05, 560.07it/s] 67%|███████████████████████████████████████████████████████▍                           | 6510/9741 [00:11<00:05, 561.58it/s] 67%|███████████████████████████████████████████████████████▉                           | 6568/9741 [00:11<00:05, 564.72it/s] 68%|████████████████████████████████████████████████████████▍                          | 6626/9741 [00:11<00:05, 567.24it/s] 69%|████████████████████████████████████████████████████████▉                          | 6684/9741 [00:11<00:05, 570.06it/s] 69%|█████████████████████████████████████████████████████████▍                         | 6742/9741 [00:11<00:05, 570.01it/s] 70%|█████████████████████████████████████████████████████████▉                         | 6800/9741 [00:12<00:05, 572.12it/s] 70%|██████████████████████████████████████████████████████████▍                        | 6858/9741 [00:12<00:05, 573.11it/s] 71%|██████████████████████████████████████████████████████████▉                        | 6916/9741 [00:12<00:04, 571.56it/s] 72%|███████████████████████████████████████████████████████████▍                       | 6974/9741 [00:12<00:04, 560.74it/s] 72%|███████████████████████████████████████████████████████████▉                       | 7032/9741 [00:12<00:04, 565.56it/s] 73%|████████████████████████████████████████████████████████████▍                      | 7090/9741 [00:12<00:04, 569.25it/s] 73%|████████████████████████████████████████████████████████████▉                      | 7148/9741 [00:12<00:04, 571.44it/s] 74%|█████████████████████████████████████████████████████████████▍                     | 7206/9741 [00:12<00:04, 569.73it/s] 75%|█████████████████████████████████████████████████████████████▉                     | 7264/9741 [00:12<00:04, 571.47it/s] 75%|██████████████████████████████████████████████████████████████▍                    | 7322/9741 [00:12<00:04, 570.49it/s] 76%|██████████████████████████████████████████████████████████████▉                    | 7380/9741 [00:13<00:04, 571.86it/s] 76%|███████████████████████████████████████████████████████████████▍                   | 7438/9741 [00:13<00:04, 535.08it/s] 77%|███████████████████████████████████████████████████████████████▊                   | 7495/9741 [00:13<00:04, 542.58it/s] 78%|████████████████████████████████████████████████████████████████▎                  | 7552/9741 [00:13<00:03, 548.56it/s] 78%|████████████████████████████████████████████████████████████████▊                  | 7610/9741 [00:13<00:03, 555.41it/s] 79%|█████████████████████████████████████████████████████████████████▎                 | 7667/9741 [00:13<00:03, 557.67it/s] 79%|█████████████████████████████████████████████████████████████████▊                 | 7725/9741 [00:13<00:03, 561.43it/s] 80%|██████████████████████████████████████████████████████████████████▎                | 7783/9741 [00:13<00:03, 564.01it/s] 80%|██████████████████████████████████████████████████████████████████▊                | 7841/9741 [00:13<00:03, 566.13it/s] 81%|███████████████████████████████████████████████████████████████████▎               | 7898/9741 [00:13<00:03, 565.43it/s] 82%|███████████████████████████████████████████████████████████████████▊               | 7956/9741 [00:14<00:03, 568.38it/s] 82%|████████████████████████████████████████████████████████████████████▎              | 8014/9741 [00:14<00:03, 570.76it/s] 83%|████████████████████████████████████████████████████████████████████▊              | 8072/9741 [00:14<00:02, 572.13it/s] 83%|█████████████████████████████████████████████████████████████████████▎             | 8130/9741 [00:14<00:02, 568.06it/s] 84%|█████████████████████████████████████████████████████████████████████▊             | 8187/9741 [00:14<00:02, 563.63it/s] 85%|██████████████████████████████████████████████████████████████████████▎            | 8245/9741 [00:14<00:02, 566.30it/s] 85%|██████████████████████████████████████████████████████████████████████▋            | 8303/9741 [00:14<00:02, 568.13it/s] 86%|███████████████████████████████████████████████████████████████████████▏           | 8360/9741 [00:14<00:02, 566.57it/s] 86%|███████████████████████████████████████████████████████████████████████▋           | 8418/9741 [00:14<00:02, 567.94it/s] 87%|████████████████████████████████████████████████████████████████████████▏          | 8475/9741 [00:14<00:02, 553.30it/s] 88%|████████████████████████████████████████████████████████████████████████▋          | 8533/9741 [00:15<00:02, 560.61it/s] 88%|█████████████████████████████████████████████████████████████████████████▏         | 8591/9741 [00:15<00:02, 563.53it/s] 89%|█████████████████████████████████████████████████████████████████████████▋         | 8649/9741 [00:15<00:01, 566.99it/s] 89%|██████████████████████████████████████████████████████████████████████████▏        | 8707/9741 [00:15<00:01, 569.38it/s] 90%|██████████████████████████████████████████████████████████████████████████▋        | 8765/9741 [00:15<00:01, 571.15it/s] 91%|███████████████████████████████████████████████████████████████████████████▏       | 8823/9741 [00:15<00:01, 570.49it/s] 91%|███████████████████████████████████████████████████████████████████████████▋       | 8881/9741 [00:15<00:01, 572.47it/s] 92%|████████████████████████████████████████████████████████████████████████████▏      | 8939/9741 [00:15<00:01, 573.71it/s] 92%|████████████████████████████████████████████████████████████████████████████▋      | 8997/9741 [00:15<00:01, 572.17it/s] 93%|█████████████████████████████████████████████████████████████████████████████▏     | 9055/9741 [00:16<00:01, 573.21it/s] 94%|█████████████████████████████████████████████████████████████████████████████▋     | 9113/9741 [00:16<00:01, 574.49it/s] 94%|██████████████████████████████████████████████████████████████████████████████▏    | 9171/9741 [00:16<00:00, 574.46it/s] 95%|██████████████████████████████████████████████████████████████████████████████▋    | 9229/9741 [00:16<00:00, 571.62it/s] 95%|███████████████████████████████████████████████████████████████████████████████▏   | 9287/9741 [00:16<00:00, 571.74it/s] 96%|███████████████████████████████████████████████████████████████████████████████▋   | 9345/9741 [00:16<00:00, 569.89it/s] 97%|████████████████████████████████████████████████████████████████████████████████   | 9403/9741 [00:16<00:00, 569.91it/s] 97%|████████████████████████████████████████████████████████████████████████████████▌  | 9460/9741 [00:16<00:00, 567.66it/s] 98%|█████████████████████████████████████████████████████████████████████████████████  | 9517/9741 [00:16<00:00, 567.82it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▌ | 9574/9741 [00:16<00:00, 568.35it/s] 99%|██████████████████████████████████████████████████████████████████████████████████ | 9631/9741 [00:17<00:00, 567.22it/s] 99%|██████████████████████████████████████████████████████████████████████████████████▌| 9688/9741 [00:17<00:00, 566.10it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:17<00:00, 566.03it/s]
Load End
Num instances: 1000
[2023-08-22 10:00:44,826] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 10:00:47,617] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 10:00:47,618] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 10:00:47,618] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 10:00:47,618] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 10:00:47,618] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 10:00:47,618] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 10:00:47,618] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 10:00:47,618] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 10:00:47,618] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 10:00:47,618] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 10:00:47,618] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f222a63ca60>
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f222a63c940>
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 10:00:47,619] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 10:00:47,620] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 10:00:47,620] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 10:00:47,620] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 10:00:47,620] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.43664121627807617 seconds
Loading extension module utils...
Time to load utils op: 0.5048480033874512 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
So the final answer is 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
So the final answer is 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: Stella and Twinkle filled up the truck at the rate of 250 blocks per hour per person, a total of 2*250 = <<250*2=500>>500 blocks per hour for both.
After working for four hours, Stella and Twinkle had filled 4*500 = <<4*500=2000>>2000 blocks into the truck.
The number of blocks they had to put into the truck for it to be full is 6000-2000 = <<6000-2000=4000>>4000
When 6 more people joined Stella and Twinkle, a total of 2+6 = <<2+6=8>>8 people were filling the truck now.
Working at the rate of 250 blocks per person, the eight people filled the truck with 250*8 = <<250*8=2000>>2000 blocks in one hour.
If there were 4000 blocks that still needed to be put into the truck, the 8 people took 4000/2000 = <<4000/2000=2>>2 hours to fill the truck with the blocks.
The total time it took to fill up the tank is 4+2 = <<4+2=6>>6 hours.
So the final answer is 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: Total drunk: 8.5 + 9.5 = <<8.5+9.5=18>>18 pints
18 pints * 2 = <<18*2=36>>36 cups
The two boys drank a total of 36 cups of liquid yesterday.
So the final answer is 36

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o7-tgsm8k-s10-rTrue
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:37<31:00, 37.97s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:14<29:50, 37.31s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [01:51<28:55, 36.93s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [02:28<28:15, 36.86s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [03:06<27:56, 37.26s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [03:42<27:06, 36.95s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [04:18<26:24, 36.84s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [04:55<25:46, 36.83s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [05:33<25:16, 36.99s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [06:09<24:35, 36.88s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [06:46<24:01, 36.97s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [07:23<23:21, 36.88s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [08:00<22:46, 36.92s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [08:38<22:17, 37.14s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [09:15<21:38, 37.11s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [09:51<20:55, 36.93s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [10:32<20:52, 37.97s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [11:09<20:10, 37.82s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [11:46<19:20, 37.43s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [12:23<18:40, 37.36s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [13:00<18:01, 37.29s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [13:37<17:24, 37.30s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [14:14<16:45, 37.26s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [14:52<16:10, 37.31s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [15:30<15:40, 37.62s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [16:09<15:08, 37.87s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [16:46<14:27, 37.71s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [17:23<13:46, 37.56s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [18:01<13:09, 37.60s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [18:39<12:31, 37.58s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [19:16<11:55, 37.66s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [19:56<11:27, 38.18s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [20:33<10:44, 37.93s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [21:10<10:01, 37.59s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [21:47<09:21, 37.46s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [22:25<08:45, 37.51s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [23:02<08:07, 37.49s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [23:39<07:29, 37.42s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [24:22<07:09, 39.01s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [25:05<06:40, 40.06s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [25:57<06:33, 43.71s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [26:38<05:44, 43.10s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [27:17<04:51, 41.63s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [27:56<04:05, 40.89s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [28:33<03:19, 39.88s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [29:11<02:36, 39.16s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [29:48<01:55, 38.64s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [30:26<01:16, 38.38s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [31:04<00:38, 38.24s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [31:42<00:00, 38.11s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [31:42<00:00, 38.05s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.4126} | avg. gen lenth: 451.674
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 8
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 10:32:39,319] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 8
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o8-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                    | 33/9741 [00:00<00:30, 323.21it/s]  1%|▌                                                                                    | 66/9741 [00:00<00:29, 325.93it/s]  1%|▊                                                                                   | 100/9741 [00:00<00:29, 328.16it/s]  1%|█▏                                                                                  | 134/9741 [00:00<00:29, 329.52it/s]  2%|█▍                                                                                  | 168/9741 [00:00<00:28, 330.36it/s]  2%|█▋                                                                                  | 202/9741 [00:00<00:28, 329.16it/s]  2%|██                                                                                  | 236/9741 [00:00<00:28, 329.88it/s]  3%|██▎                                                                                 | 269/9741 [00:00<00:29, 323.44it/s]  3%|██▌                                                                                 | 303/9741 [00:00<00:28, 326.09it/s]  3%|██▉                                                                                 | 336/9741 [00:01<00:30, 309.94it/s]  4%|███▏                                                                                | 370/9741 [00:01<00:29, 316.53it/s]  4%|███▍                                                                                | 403/9741 [00:01<00:29, 317.72it/s]  4%|███▊                                                                                | 437/9741 [00:01<00:28, 322.24it/s]  5%|████                                                                                | 471/9741 [00:01<00:28, 325.41it/s]  5%|████▎                                                                               | 505/9741 [00:01<00:28, 327.98it/s]  6%|████▋                                                                               | 539/9741 [00:01<00:27, 329.89it/s]  6%|████▉                                                                               | 573/9741 [00:01<00:29, 312.60it/s]  6%|█████▏                                                                              | 605/9741 [00:01<00:31, 289.05it/s]  7%|█████▍                                                                              | 635/9741 [00:02<00:31, 285.33it/s]  7%|█████▊                                                                              | 668/9741 [00:02<00:30, 297.55it/s]  7%|██████                                                                              | 702/9741 [00:02<00:29, 308.51it/s]  8%|██████▎                                                                             | 734/9741 [00:02<00:31, 288.04it/s]  8%|██████▌                                                                             | 764/9741 [00:02<00:31, 287.20it/s]  8%|██████▉                                                                             | 798/9741 [00:02<00:29, 299.70it/s]  9%|███████▏                                                                            | 832/9741 [00:02<00:28, 309.62it/s]  9%|███████▍                                                                            | 864/9741 [00:02<00:31, 285.30it/s]  9%|███████▋                                                                            | 894/9741 [00:02<00:31, 284.42it/s]  9%|███████▉                                                                            | 923/9741 [00:03<00:31, 282.31it/s] 10%|████████▎                                                                           | 957/9741 [00:03<00:29, 296.65it/s] 10%|████████▌                                                                           | 991/9741 [00:03<00:28, 307.87it/s] 11%|████████▋                                                                          | 1025/9741 [00:03<00:27, 316.35it/s] 11%|█████████                                                                          | 1059/9741 [00:03<00:26, 322.34it/s] 11%|█████████▎                                                                         | 1093/9741 [00:03<00:26, 324.90it/s] 12%|█████████▌                                                                         | 1127/9741 [00:03<00:26, 328.75it/s] 12%|█████████▉                                                                         | 1161/9741 [00:03<00:25, 331.55it/s] 12%|██████████▏                                                                        | 1195/9741 [00:03<00:25, 332.96it/s] 13%|██████████▍                                                                        | 1229/9741 [00:03<00:25, 333.46it/s] 13%|██████████▊                                                                        | 1263/9741 [00:04<00:25, 334.62it/s] 13%|███████████                                                                        | 1297/9741 [00:04<00:25, 334.83it/s] 14%|███████████▎                                                                       | 1331/9741 [00:04<00:25, 333.45it/s] 14%|███████████▋                                                                       | 1365/9741 [00:04<00:25, 334.08it/s] 14%|███████████▉                                                                       | 1399/9741 [00:04<00:24, 334.38it/s] 15%|████████████▏                                                                      | 1433/9741 [00:04<00:24, 334.34it/s] 15%|████████████▍                                                                      | 1467/9741 [00:04<00:24, 334.59it/s] 15%|████████████▊                                                                      | 1501/9741 [00:04<00:24, 334.56it/s] 16%|█████████████▏                                                                     | 1549/9741 [00:04<00:21, 377.20it/s] 16%|█████████████▌                                                                     | 1597/9741 [00:04<00:20, 406.30it/s] 17%|█████████████▉                                                                     | 1638/9741 [00:05<00:19, 405.49it/s] 17%|██████████████▎                                                                    | 1686/9741 [00:05<00:18, 425.27it/s] 18%|██████████████▊                                                                    | 1734/9741 [00:05<00:18, 439.49it/s] 18%|███████████████▏                                                                   | 1778/9741 [00:05<00:19, 404.04it/s] 19%|███████████████▌                                                                   | 1825/9741 [00:05<00:18, 422.10it/s] 19%|███████████████▉                                                                   | 1872/9741 [00:05<00:18, 434.62it/s] 20%|████████████████▎                                                                  | 1919/9741 [00:05<00:17, 444.79it/s] 20%|████████████████▊                                                                  | 1967/9741 [00:05<00:17, 452.77it/s] 21%|█████████████████▏                                                                 | 2014/9741 [00:05<00:16, 456.14it/s] 21%|█████████████████▌                                                                 | 2062/9741 [00:05<00:16, 460.66it/s] 22%|█████████████████▉                                                                 | 2110/9741 [00:06<00:16, 463.54it/s] 22%|██████████████████▍                                                                | 2157/9741 [00:06<00:16, 465.19it/s] 23%|██████████████████▊                                                                | 2204/9741 [00:06<00:16, 465.16it/s] 23%|███████████████████▏                                                               | 2251/9741 [00:06<00:16, 463.26it/s] 24%|███████████████████▌                                                               | 2299/9741 [00:06<00:15, 465.75it/s] 24%|███████████████████▉                                                               | 2346/9741 [00:06<00:15, 465.94it/s] 25%|████████████████████▍                                                              | 2393/9741 [00:06<00:15, 466.99it/s] 25%|████████████████████▊                                                              | 2440/9741 [00:06<00:15, 463.50it/s] 26%|█████████████████████▏                                                             | 2487/9741 [00:06<00:15, 460.59it/s] 26%|█████████████████████▌                                                             | 2534/9741 [00:06<00:15, 453.58it/s] 26%|█████████████████████▉                                                             | 2581/9741 [00:07<00:15, 457.30it/s] 27%|██████████████████████▍                                                            | 2628/9741 [00:07<00:15, 460.23it/s] 27%|██████████████████████▊                                                            | 2675/9741 [00:07<00:15, 459.89it/s] 28%|███████████████████████▏                                                           | 2722/9741 [00:07<00:15, 462.53it/s] 28%|███████████████████████▌                                                           | 2769/9741 [00:07<00:15, 464.10it/s] 29%|███████████████████████▉                                                           | 2816/9741 [00:07<00:14, 463.32it/s] 29%|████████████████████████▍                                                          | 2863/9741 [00:07<00:14, 462.15it/s] 30%|████████████████████████▊                                                          | 2910/9741 [00:07<00:14, 457.54it/s] 30%|█████████████████████████▏                                                         | 2956/9741 [00:07<00:14, 457.42it/s] 31%|█████████████████████████▌                                                         | 3002/9741 [00:08<00:14, 457.01it/s] 31%|█████████████████████████▉                                                         | 3048/9741 [00:08<00:14, 453.76it/s] 32%|██████████████████████████▎                                                        | 3094/9741 [00:08<00:14, 451.25it/s] 32%|██████████████████████████▊                                                        | 3140/9741 [00:08<00:14, 449.39it/s] 33%|███████████████████████████▏                                                       | 3186/9741 [00:08<00:14, 449.91it/s] 33%|███████████████████████████▌                                                       | 3232/9741 [00:08<00:14, 450.99it/s] 34%|███████████████████████████▉                                                       | 3278/9741 [00:08<00:14, 451.71it/s] 34%|████████████████████████████▎                                                      | 3324/9741 [00:08<00:14, 453.56it/s] 35%|████████████████████████████▋                                                      | 3370/9741 [00:08<00:14, 449.68it/s] 35%|█████████████████████████████                                                      | 3416/9741 [00:08<00:14, 451.07it/s] 36%|█████████████████████████████▍                                                     | 3462/9741 [00:09<00:13, 452.26it/s] 36%|█████████████████████████████▉                                                     | 3508/9741 [00:09<00:13, 451.86it/s] 36%|██████████████████████████████▎                                                    | 3554/9741 [00:09<00:13, 452.95it/s] 37%|██████████████████████████████▋                                                    | 3600/9741 [00:09<00:13, 452.90it/s] 37%|███████████████████████████████                                                    | 3647/9741 [00:09<00:13, 455.40it/s] 38%|███████████████████████████████▍                                                   | 3693/9741 [00:09<00:13, 451.02it/s] 38%|███████████████████████████████▊                                                   | 3740/9741 [00:09<00:13, 455.26it/s] 39%|████████████████████████████████▎                                                  | 3787/9741 [00:09<00:13, 457.27it/s] 39%|████████████████████████████████▋                                                  | 3833/9741 [00:09<00:12, 454.84it/s] 40%|█████████████████████████████████                                                  | 3880/9741 [00:09<00:12, 456.53it/s] 40%|█████████████████████████████████▍                                                 | 3926/9741 [00:10<00:12, 455.85it/s] 41%|█████████████████████████████████▊                                                 | 3973/9741 [00:10<00:12, 457.95it/s] 41%|██████████████████████████████████▏                                                | 4019/9741 [00:10<00:12, 457.19it/s] 42%|██████████████████████████████████▋                                                | 4065/9741 [00:10<00:12, 456.54it/s] 42%|███████████████████████████████████                                                | 4112/9741 [00:10<00:12, 458.83it/s] 43%|███████████████████████████████████▍                                               | 4158/9741 [00:10<00:12, 458.11it/s] 43%|███████████████████████████████████▊                                               | 4205/9741 [00:10<00:12, 460.67it/s] 44%|████████████████████████████████████▏                                              | 4252/9741 [00:10<00:11, 461.30it/s] 44%|████████████████████████████████████▋                                              | 4299/9741 [00:10<00:11, 459.65it/s] 45%|█████████████████████████████████████                                              | 4345/9741 [00:10<00:11, 458.59it/s] 45%|█████████████████████████████████████▍                                             | 4391/9741 [00:11<00:11, 458.27it/s] 46%|█████████████████████████████████████▊                                             | 4437/9741 [00:11<00:11, 458.68it/s] 46%|██████████████████████████████████████▏                                            | 4483/9741 [00:11<00:12, 418.94it/s] 46%|██████████████████████████████████████▌                                            | 4529/9741 [00:11<00:12, 429.60it/s] 47%|██████████████████████████████████████▉                                            | 4576/9741 [00:11<00:11, 439.16it/s] 47%|███████████████████████████████████████▍                                           | 4622/9741 [00:11<00:11, 444.12it/s] 48%|███████████████████████████████████████▊                                           | 4669/9741 [00:11<00:11, 449.33it/s] 48%|████████████████████████████████████████▏                                          | 4715/9741 [00:11<00:15, 317.78it/s] 49%|████████████████████████████████████████▌                                          | 4761/9741 [00:12<00:14, 349.54it/s] 49%|████████████████████████████████████████▉                                          | 4807/9741 [00:12<00:13, 375.79it/s] 50%|█████████████████████████████████████████▎                                         | 4853/9741 [00:12<00:12, 396.50it/s] 50%|█████████████████████████████████████████▋                                         | 4898/9741 [00:12<00:11, 410.42it/s] 51%|██████████████████████████████████████████▏                                        | 4944/9741 [00:12<00:11, 422.03it/s] 51%|██████████████████████████████████████████▌                                        | 4990/9741 [00:12<00:10, 432.38it/s] 52%|██████████████████████████████████████████▉                                        | 5036/9741 [00:12<00:10, 440.05it/s] 52%|███████████████████████████████████████████▎                                       | 5082/9741 [00:12<00:10, 445.83it/s] 53%|███████████████████████████████████████████▋                                       | 5128/9741 [00:12<00:10, 449.97it/s] 53%|████████████████████████████████████████████                                       | 5174/9741 [00:12<00:10, 449.92it/s] 54%|████████████████████████████████████████████▍                                      | 5221/9741 [00:13<00:09, 453.04it/s] 54%|████████████████████████████████████████████▉                                      | 5268/9741 [00:13<00:09, 455.39it/s] 55%|█████████████████████████████████████████████▎                                     | 5314/9741 [00:13<00:09, 455.85it/s] 55%|█████████████████████████████████████████████▋                                     | 5361/9741 [00:13<00:09, 457.43it/s] 56%|██████████████████████████████████████████████                                     | 5407/9741 [00:13<00:09, 456.78it/s] 56%|██████████████████████████████████████████████▍                                    | 5453/9741 [00:13<00:09, 457.22it/s] 56%|██████████████████████████████████████████████▊                                    | 5500/9741 [00:13<00:09, 458.13it/s] 57%|███████████████████████████████████████████████▎                                   | 5546/9741 [00:13<00:09, 457.64it/s] 57%|███████████████████████████████████████████████▋                                   | 5592/9741 [00:13<00:09, 458.04it/s] 58%|████████████████████████████████████████████████                                   | 5638/9741 [00:13<00:08, 456.22it/s] 58%|████████████████████████████████████████████████▍                                  | 5684/9741 [00:14<00:08, 457.27it/s] 59%|████████████████████████████████████████████████▊                                  | 5731/9741 [00:14<00:08, 458.78it/s] 59%|█████████████████████████████████████████████████▏                                 | 5777/9741 [00:14<00:08, 451.55it/s] 60%|█████████████████████████████████████████████████▌                                 | 5823/9741 [00:14<00:08, 450.16it/s] 60%|██████████████████████████████████████████████████                                 | 5870/9741 [00:14<00:08, 453.52it/s] 61%|██████████████████████████████████████████████████▍                                | 5916/9741 [00:14<00:08, 455.02it/s] 61%|██████████████████████████████████████████████████▊                                | 5962/9741 [00:14<00:08, 456.31it/s] 62%|███████████████████████████████████████████████████▏                               | 6008/9741 [00:14<00:08, 456.16it/s] 62%|███████████████████████████████████████████████████▌                               | 6054/9741 [00:14<00:08, 454.89it/s] 63%|███████████████████████████████████████████████████▉                               | 6100/9741 [00:14<00:08, 454.70it/s] 63%|████████████████████████████████████████████████████▎                              | 6146/9741 [00:15<00:07, 455.73it/s] 64%|████████████████████████████████████████████████████▊                              | 6192/9741 [00:15<00:07, 456.53it/s] 64%|█████████████████████████████████████████████████████▏                             | 6238/9741 [00:15<00:07, 456.58it/s] 65%|█████████████████████████████████████████████████████▌                             | 6284/9741 [00:15<00:07, 455.39it/s] 65%|█████████████████████████████████████████████████████▉                             | 6330/9741 [00:15<00:07, 455.52it/s] 65%|██████████████████████████████████████████████████████▎                            | 6376/9741 [00:15<00:07, 455.64it/s] 66%|██████████████████████████████████████████████████████▋                            | 6423/9741 [00:15<00:07, 457.52it/s] 66%|███████████████████████████████████████████████████████                            | 6469/9741 [00:15<00:07, 457.18it/s] 67%|███████████████████████████████████████████████████████▌                           | 6515/9741 [00:15<00:07, 454.61it/s] 67%|███████████████████████████████████████████████████████▉                           | 6561/9741 [00:15<00:06, 454.32it/s] 68%|████████████████████████████████████████████████████████▎                          | 6607/9741 [00:16<00:06, 451.38it/s] 68%|████████████████████████████████████████████████████████▋                          | 6653/9741 [00:16<00:06, 452.31it/s] 69%|█████████████████████████████████████████████████████████                          | 6700/9741 [00:16<00:06, 454.80it/s] 69%|█████████████████████████████████████████████████████████▍                         | 6746/9741 [00:16<00:06, 454.13it/s] 70%|█████████████████████████████████████████████████████████▊                         | 6792/9741 [00:16<00:06, 453.53it/s] 70%|██████████████████████████████████████████████████████████▎                        | 6838/9741 [00:16<00:06, 454.11it/s] 71%|██████████████████████████████████████████████████████████▋                        | 6884/9741 [00:16<00:06, 455.27it/s] 71%|███████████████████████████████████████████████████████████                        | 6930/9741 [00:16<00:06, 455.80it/s] 72%|███████████████████████████████████████████████████████████▍                       | 6976/9741 [00:16<00:06, 452.58it/s] 72%|███████████████████████████████████████████████████████████▊                       | 7022/9741 [00:17<00:06, 452.11it/s] 73%|████████████████████████████████████████████████████████████▏                      | 7068/9741 [00:17<00:05, 454.31it/s] 73%|████████████████████████████████████████████████████████████▌                      | 7115/9741 [00:17<00:05, 456.47it/s] 74%|█████████████████████████████████████████████████████████████                      | 7162/9741 [00:17<00:05, 457.78it/s] 74%|█████████████████████████████████████████████████████████████▍                     | 7208/9741 [00:17<00:05, 456.45it/s] 74%|█████████████████████████████████████████████████████████████▊                     | 7255/9741 [00:17<00:05, 457.99it/s] 75%|██████████████████████████████████████████████████████████████▏                    | 7302/9741 [00:17<00:05, 458.98it/s] 75%|██████████████████████████████████████████████████████████████▌                    | 7349/9741 [00:17<00:05, 460.91it/s] 76%|███████████████████████████████████████████████████████████████                    | 7396/9741 [00:17<00:05, 461.13it/s] 76%|███████████████████████████████████████████████████████████████▍                   | 7443/9741 [00:17<00:05, 427.55it/s] 77%|███████████████████████████████████████████████████████████████▊                   | 7489/9741 [00:18<00:05, 434.98it/s] 77%|████████████████████████████████████████████████████████████████▏                  | 7535/9741 [00:18<00:05, 441.07it/s] 78%|████████████████████████████████████████████████████████████████▌                  | 7581/9741 [00:18<00:04, 446.30it/s] 78%|████████████████████████████████████████████████████████████████▉                  | 7627/9741 [00:18<00:04, 449.53it/s] 79%|█████████████████████████████████████████████████████████████████▍                 | 7673/9741 [00:18<00:04, 450.62it/s] 79%|█████████████████████████████████████████████████████████████████▊                 | 7719/9741 [00:18<00:04, 446.91it/s] 80%|██████████████████████████████████████████████████████████████████▏                | 7765/9741 [00:18<00:04, 450.68it/s] 80%|██████████████████████████████████████████████████████████████████▌                | 7812/9741 [00:18<00:04, 453.81it/s] 81%|██████████████████████████████████████████████████████████████████▉                | 7858/9741 [00:18<00:04, 455.24it/s] 81%|███████████████████████████████████████████████████████████████████▎               | 7904/9741 [00:18<00:04, 452.95it/s] 82%|███████████████████████████████████████████████████████████████████▋               | 7950/9741 [00:19<00:03, 453.06it/s] 82%|████████████████████████████████████████████████████████████████████▏              | 7996/9741 [00:19<00:03, 452.47it/s] 83%|████████████████████████████████████████████████████████████████████▌              | 8042/9741 [00:19<00:03, 453.17it/s] 83%|████████████████████████████████████████████████████████████████████▉              | 8088/9741 [00:19<00:03, 454.01it/s] 84%|█████████████████████████████████████████████████████████████████████▎             | 8134/9741 [00:19<00:03, 453.66it/s] 84%|█████████████████████████████████████████████████████████████████████▋             | 8180/9741 [00:19<00:03, 455.35it/s] 84%|██████████████████████████████████████████████████████████████████████             | 8227/9741 [00:19<00:03, 456.95it/s] 85%|██████████████████████████████████████████████████████████████████████▍            | 8273/9741 [00:19<00:03, 457.18it/s] 85%|██████████████████████████████████████████████████████████████████████▉            | 8319/9741 [00:19<00:03, 455.67it/s] 86%|███████████████████████████████████████████████████████████████████████▎           | 8366/9741 [00:19<00:03, 457.11it/s] 86%|███████████████████████████████████████████████████████████████████████▋           | 8412/9741 [00:20<00:02, 457.03it/s] 87%|████████████████████████████████████████████████████████████████████████           | 8458/9741 [00:20<00:02, 454.48it/s] 87%|████████████████████████████████████████████████████████████████████████▍          | 8504/9741 [00:20<00:02, 451.88it/s] 88%|████████████████████████████████████████████████████████████████████████▊          | 8550/9741 [00:20<00:02, 451.12it/s] 88%|█████████████████████████████████████████████████████████████████████████▏         | 8596/9741 [00:20<00:02, 451.89it/s] 89%|█████████████████████████████████████████████████████████████████████████▋         | 8642/9741 [00:20<00:02, 451.79it/s] 89%|██████████████████████████████████████████████████████████████████████████         | 8688/9741 [00:20<00:02, 453.39it/s] 90%|██████████████████████████████████████████████████████████████████████████▍        | 8734/9741 [00:20<00:02, 454.69it/s] 90%|██████████████████████████████████████████████████████████████████████████▊        | 8780/9741 [00:20<00:02, 453.54it/s] 91%|███████████████████████████████████████████████████████████████████████████▏       | 8826/9741 [00:20<00:02, 449.74it/s] 91%|███████████████████████████████████████████████████████████████████████████▌       | 8872/9741 [00:21<00:01, 451.91it/s] 92%|███████████████████████████████████████████████████████████████████████████▉       | 8918/9741 [00:21<00:01, 453.63it/s] 92%|████████████████████████████████████████████████████████████████████████████▍      | 8964/9741 [00:21<00:01, 454.01it/s] 92%|████████████████████████████████████████████████████████████████████████████▊      | 9010/9741 [00:21<00:01, 452.97it/s] 93%|█████████████████████████████████████████████████████████████████████████████▏     | 9056/9741 [00:21<00:01, 453.71it/s] 93%|█████████████████████████████████████████████████████████████████████████████▌     | 9102/9741 [00:21<00:01, 454.77it/s] 94%|█████████████████████████████████████████████████████████████████████████████▉     | 9148/9741 [00:21<00:01, 455.02it/s] 94%|██████████████████████████████████████████████████████████████████████████████▎    | 9194/9741 [00:21<00:01, 455.58it/s] 95%|██████████████████████████████████████████████████████████████████████████████▋    | 9240/9741 [00:21<00:01, 454.21it/s] 95%|███████████████████████████████████████████████████████████████████████████████    | 9286/9741 [00:22<00:00, 455.61it/s] 96%|███████████████████████████████████████████████████████████████████████████████▌   | 9332/9741 [00:22<00:00, 455.84it/s] 96%|███████████████████████████████████████████████████████████████████████████████▉   | 9378/9741 [00:22<00:00, 456.30it/s] 97%|████████████████████████████████████████████████████████████████████████████████▎  | 9424/9741 [00:22<00:00, 454.79it/s] 97%|████████████████████████████████████████████████████████████████████████████████▋  | 9470/9741 [00:22<00:00, 450.44it/s] 98%|█████████████████████████████████████████████████████████████████████████████████  | 9516/9741 [00:22<00:00, 452.15it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▍ | 9562/9741 [00:22<00:00, 453.58it/s] 99%|█████████████████████████████████████████████████████████████████████████████████▊ | 9608/9741 [00:22<00:00, 455.26it/s] 99%|██████████████████████████████████████████████████████████████████████████████████▎| 9654/9741 [00:22<00:00, 455.94it/s]100%|██████████████████████████████████████████████████████████████████████████████████▋| 9700/9741 [00:22<00:00, 455.02it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:23<00:00, 423.34it/s]
Load End
Num instances: 1000
[2023-08-22 10:33:13,872] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 10:33:16,697] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 10:33:16,698] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 10:33:16,698] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 10:33:16,698] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 10:33:16,698] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 10:33:16,698] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fa68cf29a60>
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fa68cf29940>
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 10:33:16,699] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 10:33:16,700] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 10:33:16,700] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4308474063873291 seconds
Loading extension module utils...
Time to load utils op: 0.4048655033111572 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
So the final answer is 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
So the final answer is 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: Stella and Twinkle filled up the truck at the rate of 250 blocks per hour per person, a total of 2*250 = <<250*2=500>>500 blocks per hour for both.
After working for four hours, Stella and Twinkle had filled 4*500 = <<4*500=2000>>2000 blocks into the truck.
The number of blocks they had to put into the truck for it to be full is 6000-2000 = <<6000-2000=4000>>4000
When 6 more people joined Stella and Twinkle, a total of 2+6 = <<2+6=8>>8 people were filling the truck now.
Working at the rate of 250 blocks per person, the eight people filled the truck with 250*8 = <<250*8=2000>>2000 blocks in one hour.
If there were 4000 blocks that still needed to be put into the truck, the 8 people took 4000/2000 = <<4000/2000=2>>2 hours to fill the truck with the blocks.
The total time it took to fill up the tank is 4+2 = <<4+2=6>>6 hours.
So the final answer is 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: Total drunk: 8.5 + 9.5 = <<8.5+9.5=18>>18 pints
18 pints * 2 = <<18*2=36>>36 cups
The two boys drank a total of 36 cups of liquid yesterday.
So the final answer is 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: Each carton has an area of 4*4*5 = <<4*4*5=80>>80 square inches.
Each shipping box has an area of 20*20*20 = <<20*20*20=8000>>8000 square inches
The total number of cartons that will fit into each box is 8000/80 = <<8000/80=100>>100
Since there are 3 widgets in each carton, the total number of cartons in each box will be 3*100 = <<3*100=300>>300
So the final answer is 300

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o8-tgsm8k-s10-rTrue
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:35<28:43, 35.18s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:09<27:36, 34.52s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [01:43<26:54, 34.36s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [02:17<26:17, 34.30s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [02:51<25:41, 34.26s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [03:25<25:02, 34.15s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [04:00<24:39, 34.41s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [04:35<24:10, 34.54s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [05:11<23:55, 35.02s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [05:46<23:18, 34.97s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [06:24<23:22, 35.97s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [06:59<22:32, 35.59s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [07:33<21:44, 35.26s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [08:08<20:58, 34.97s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [08:43<20:22, 34.93s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [09:17<19:44, 34.83s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [09:51<19:03, 34.64s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [10:26<18:29, 34.67s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [11:00<17:50, 34.53s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [11:35<17:17, 34.57s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [12:10<16:44, 34.63s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [12:44<16:06, 34.51s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [13:19<15:33, 34.59s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [13:54<15:03, 34.77s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [14:30<14:42, 35.30s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [15:05<14:03, 35.15s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [15:40<13:24, 34.98s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [16:14<12:45, 34.81s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [16:49<12:12, 34.87s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [17:24<11:34, 34.75s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [17:58<10:58, 34.66s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [18:33<10:24, 34.67s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [19:07<09:49, 34.66s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [19:42<09:13, 34.61s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [20:17<08:41, 34.74s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [20:52<08:06, 34.77s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [21:27<07:34, 34.97s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [22:02<06:57, 34.76s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [22:36<06:21, 34.69s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [23:11<05:48, 34.83s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [23:46<05:14, 34.90s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [24:21<04:37, 34.74s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [24:56<04:03, 34.76s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [25:31<03:29, 34.83s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [26:05<02:53, 34.63s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [26:41<02:20, 35.18s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [27:17<01:46, 35.40s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [27:51<01:10, 35.09s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [28:26<00:34, 34.85s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [29:00<00:00, 34.76s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [29:00<00:00, 34.82s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.6484} | avg. gen lenth: 449.058
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s10-rTrue --seed 10 --max-prompt-length 2048 --rationales --num-out-domain 9
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 11:02:26,987] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 9
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o9-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                    | 30/9741 [00:00<00:33, 293.92it/s]  1%|▌                                                                                    | 61/9741 [00:00<00:32, 298.65it/s]  1%|▊                                                                                    | 91/9741 [00:00<00:33, 291.78it/s]  1%|█                                                                                   | 122/9741 [00:00<00:32, 295.30it/s]  2%|█▎                                                                                  | 153/9741 [00:00<00:32, 297.61it/s]  2%|█▌                                                                                  | 183/9741 [00:00<00:32, 296.26it/s]  2%|█▊                                                                                  | 214/9741 [00:00<00:31, 297.83it/s]  3%|██                                                                                  | 245/9741 [00:00<00:31, 298.95it/s]  3%|██▍                                                                                 | 276/9741 [00:00<00:31, 300.03it/s]  3%|██▋                                                                                 | 307/9741 [00:01<00:31, 300.96it/s]  3%|██▉                                                                                 | 338/9741 [00:01<00:31, 301.01it/s]  4%|███▏                                                                                | 369/9741 [00:01<00:31, 300.62it/s]  4%|███▍                                                                                | 400/9741 [00:01<00:31, 299.35it/s]  4%|███▋                                                                                | 431/9741 [00:01<00:30, 300.51it/s]  5%|███▉                                                                                | 462/9741 [00:01<00:30, 300.55it/s]  5%|████▎                                                                               | 493/9741 [00:01<00:30, 301.00it/s]  5%|████▌                                                                               | 524/9741 [00:01<00:30, 300.69it/s]  6%|████▊                                                                               | 555/9741 [00:01<00:30, 300.88it/s]  6%|█████                                                                               | 586/9741 [00:01<00:30, 300.76it/s]  6%|█████▎                                                                              | 617/9741 [00:02<00:30, 300.61it/s]  7%|█████▌                                                                              | 648/9741 [00:02<00:30, 298.56it/s]  7%|█████▊                                                                              | 678/9741 [00:02<00:30, 298.68it/s]  7%|██████                                                                              | 708/9741 [00:02<00:30, 298.94it/s]  8%|██████▎                                                                             | 738/9741 [00:02<00:30, 299.00it/s]  8%|██████▌                                                                             | 768/9741 [00:02<00:30, 294.29it/s]  8%|██████▉                                                                             | 798/9741 [00:02<00:30, 295.69it/s]  9%|███████▏                                                                            | 834/9741 [00:02<00:28, 314.45it/s]  9%|███████▌                                                                            | 877/9741 [00:02<00:25, 348.68it/s]  9%|███████▉                                                                            | 921/9741 [00:02<00:23, 375.76it/s] 10%|████████▎                                                                           | 966/9741 [00:03<00:22, 395.95it/s] 10%|████████▌                                                                          | 1010/9741 [00:03<00:21, 408.31it/s] 11%|████████▉                                                                          | 1055/9741 [00:03<00:20, 418.48it/s] 11%|█████████▎                                                                         | 1099/9741 [00:03<00:20, 424.10it/s] 12%|█████████▋                                                                         | 1144/9741 [00:03<00:20, 429.17it/s] 12%|██████████▏                                                                        | 1189/9741 [00:03<00:19, 433.41it/s] 13%|██████████▌                                                                        | 1234/9741 [00:03<00:19, 436.12it/s] 13%|██████████▉                                                                        | 1278/9741 [00:03<00:19, 436.68it/s] 14%|███████████▎                                                                       | 1322/9741 [00:03<00:19, 435.32it/s] 14%|███████████▋                                                                       | 1366/9741 [00:03<00:19, 436.43it/s] 14%|████████████                                                                       | 1410/9741 [00:04<00:19, 437.34it/s] 15%|████████████▍                                                                      | 1455/9741 [00:04<00:18, 438.74it/s] 15%|████████████▊                                                                      | 1499/9741 [00:04<00:18, 437.92it/s] 16%|█████████████▏                                                                     | 1543/9741 [00:04<00:18, 436.65it/s] 16%|█████████████▌                                                                     | 1587/9741 [00:04<00:18, 436.68it/s] 17%|█████████████▉                                                                     | 1631/9741 [00:04<00:18, 437.60it/s] 17%|██████████████▎                                                                    | 1675/9741 [00:04<00:18, 438.09it/s] 18%|██████████████▋                                                                    | 1720/9741 [00:04<00:18, 439.20it/s] 18%|███████████████                                                                    | 1764/9741 [00:04<00:19, 418.32it/s] 19%|███████████████▍                                                                   | 1808/9741 [00:05<00:18, 423.84it/s] 19%|███████████████▊                                                                   | 1852/9741 [00:05<00:18, 426.86it/s] 19%|████████████████▏                                                                  | 1896/9741 [00:05<00:18, 428.50it/s] 20%|████████████████▌                                                                  | 1940/9741 [00:05<00:18, 429.65it/s] 20%|████████████████▉                                                                  | 1984/9741 [00:05<00:17, 431.26it/s] 21%|█████████████████▎                                                                 | 2028/9741 [00:05<00:17, 431.61it/s] 21%|█████████████████▋                                                                 | 2072/9741 [00:05<00:17, 427.41it/s] 22%|██████████████████                                                                 | 2116/9741 [00:05<00:17, 428.70it/s] 22%|██████████████████▍                                                                | 2160/9741 [00:05<00:17, 429.93it/s] 23%|██████████████████▊                                                                | 2204/9741 [00:05<00:17, 430.08it/s] 23%|███████████████████▏                                                               | 2248/9741 [00:06<00:17, 427.57it/s] 24%|███████████████████▌                                                               | 2292/9741 [00:06<00:17, 429.60it/s] 24%|███████████████████▉                                                               | 2336/9741 [00:06<00:17, 431.59it/s] 24%|████████████████████▎                                                              | 2380/9741 [00:06<00:16, 433.28it/s] 25%|████████████████████▋                                                              | 2424/9741 [00:06<00:16, 434.30it/s] 25%|█████████████████████                                                              | 2468/9741 [00:06<00:16, 432.00it/s] 26%|█████████████████████▍                                                             | 2512/9741 [00:06<00:16, 433.06it/s] 26%|█████████████████████▊                                                             | 2556/9741 [00:06<00:16, 433.36it/s] 27%|██████████████████████▏                                                            | 2600/9741 [00:06<00:16, 434.47it/s] 27%|██████████████████████▌                                                            | 2644/9741 [00:06<00:16, 434.74it/s] 28%|██████████████████████▉                                                            | 2688/9741 [00:07<00:16, 432.89it/s] 28%|███████████████████████▎                                                           | 2732/9741 [00:07<00:16, 433.28it/s] 28%|███████████████████████▋                                                           | 2776/9741 [00:07<00:16, 432.41it/s] 29%|████████████████████████                                                           | 2820/9741 [00:07<00:16, 431.09it/s] 29%|████████████████████████▍                                                          | 2864/9741 [00:07<00:15, 431.11it/s] 30%|████████████████████████▊                                                          | 2908/9741 [00:07<00:15, 429.72it/s] 30%|█████████████████████████▏                                                         | 2952/9741 [00:07<00:15, 429.96it/s] 31%|█████████████████████████▌                                                         | 2995/9741 [00:07<00:15, 429.89it/s] 31%|█████████████████████████▉                                                         | 3039/9741 [00:07<00:15, 430.42it/s] 32%|██████████████████████████▎                                                        | 3083/9741 [00:07<00:15, 430.46it/s] 32%|██████████████████████████▋                                                        | 3127/9741 [00:08<00:15, 428.50it/s] 33%|███████████████████████████                                                        | 3171/9741 [00:08<00:15, 428.98it/s] 33%|███████████████████████████▍                                                       | 3215/9741 [00:08<00:15, 430.20it/s] 33%|███████████████████████████▊                                                       | 3259/9741 [00:08<00:15, 429.31it/s] 34%|████████████████████████████▏                                                      | 3302/9741 [00:08<00:15, 427.31it/s] 34%|████████████████████████████▌                                                      | 3345/9741 [00:08<00:14, 427.46it/s] 35%|████████████████████████████▊                                                      | 3388/9741 [00:08<00:14, 426.15it/s] 35%|█████████████████████████████▏                                                     | 3431/9741 [00:08<00:14, 426.91it/s] 36%|█████████████████████████████▌                                                     | 3474/9741 [00:08<00:14, 426.73it/s] 36%|█████████████████████████████▉                                                     | 3517/9741 [00:08<00:14, 426.91it/s] 37%|██████████████████████████████▎                                                    | 3560/9741 [00:09<00:14, 424.96it/s] 37%|██████████████████████████████▋                                                    | 3603/9741 [00:09<00:14, 422.57it/s] 37%|███████████████████████████████                                                    | 3646/9741 [00:09<00:14, 424.54it/s] 38%|███████████████████████████████▍                                                   | 3689/9741 [00:09<00:14, 425.22it/s] 38%|███████████████████████████████▊                                                   | 3733/9741 [00:09<00:14, 427.16it/s] 39%|████████████████████████████████▏                                                  | 3776/9741 [00:09<00:13, 427.16it/s] 39%|████████████████████████████████▌                                                  | 3819/9741 [00:09<00:13, 423.77it/s] 40%|████████████████████████████████▉                                                  | 3862/9741 [00:09<00:13, 423.16it/s] 40%|█████████████████████████████████▎                                                 | 3905/9741 [00:09<00:13, 424.51it/s] 41%|█████████████████████████████████▋                                                 | 3948/9741 [00:09<00:13, 426.01it/s] 41%|██████████████████████████████████                                                 | 3991/9741 [00:10<00:13, 426.57it/s] 41%|██████████████████████████████████▎                                                | 4034/9741 [00:10<00:13, 425.41it/s] 42%|██████████████████████████████████▋                                                | 4077/9741 [00:10<00:13, 425.34it/s] 42%|███████████████████████████████████                                                | 4120/9741 [00:10<00:13, 424.83it/s] 43%|███████████████████████████████████▍                                               | 4163/9741 [00:10<00:13, 424.77it/s] 43%|███████████████████████████████████▊                                               | 4206/9741 [00:10<00:13, 424.56it/s] 44%|████████████████████████████████████▏                                              | 4249/9741 [00:10<00:12, 424.39it/s] 44%|████████████████████████████████████▌                                              | 4292/9741 [00:10<00:12, 421.64it/s] 45%|████████████████████████████████████▉                                              | 4335/9741 [00:10<00:12, 420.08it/s] 45%|█████████████████████████████████████▎                                             | 4378/9741 [00:11<00:12, 419.93it/s] 45%|█████████████████████████████████████▋                                             | 4421/9741 [00:11<00:12, 420.79it/s] 46%|██████████████████████████████████████                                             | 4464/9741 [00:11<00:12, 418.29it/s] 46%|██████████████████████████████████████▍                                            | 4506/9741 [00:11<00:13, 394.15it/s] 47%|██████████████████████████████████████▊                                            | 4548/9741 [00:11<00:12, 400.84it/s] 47%|███████████████████████████████████████                                            | 4590/9741 [00:11<00:12, 404.74it/s] 48%|███████████████████████████████████████▍                                           | 4633/9741 [00:11<00:12, 410.17it/s] 48%|███████████████████████████████████████▊                                           | 4676/9741 [00:11<00:12, 413.96it/s] 48%|████████████████████████████████████████▏                                          | 4718/9741 [00:11<00:15, 323.97it/s] 49%|████████████████████████████████████████▌                                          | 4761/9741 [00:12<00:14, 348.64it/s] 49%|████████████████████████████████████████▉                                          | 4802/9741 [00:12<00:13, 364.37it/s] 50%|█████████████████████████████████████████▎                                         | 4844/9741 [00:12<00:12, 377.76it/s] 50%|█████████████████████████████████████████▋                                         | 4886/9741 [00:12<00:12, 389.20it/s] 51%|█████████████████████████████████████████▉                                         | 4928/9741 [00:12<00:12, 395.61it/s] 51%|██████████████████████████████████████████▎                                        | 4970/9741 [00:12<00:11, 402.51it/s] 51%|██████████████████████████████████████████▋                                        | 5013/9741 [00:12<00:11, 409.07it/s] 52%|███████████████████████████████████████████                                        | 5055/9741 [00:12<00:11, 412.26it/s] 52%|███████████████████████████████████████████▍                                       | 5098/9741 [00:12<00:11, 415.83it/s] 53%|███████████████████████████████████████████▊                                       | 5140/9741 [00:12<00:11, 416.40it/s] 53%|████████████████████████████████████████████▏                                      | 5183/9741 [00:13<00:10, 418.39it/s] 54%|████████████████████████████████████████████▌                                      | 5226/9741 [00:13<00:10, 420.08it/s] 54%|████████████████████████████████████████████▉                                      | 5269/9741 [00:13<00:10, 418.03it/s] 55%|█████████████████████████████████████████████▎                                     | 5311/9741 [00:13<00:10, 414.13it/s] 55%|█████████████████████████████████████████████▌                                     | 5353/9741 [00:13<00:10, 414.08it/s] 55%|█████████████████████████████████████████████▉                                     | 5395/9741 [00:13<00:10, 414.12it/s] 56%|██████████████████████████████████████████████▎                                    | 5438/9741 [00:13<00:10, 416.63it/s] 56%|██████████████████████████████████████████████▋                                    | 5481/9741 [00:13<00:10, 418.13it/s] 57%|███████████████████████████████████████████████                                    | 5523/9741 [00:13<00:10, 412.99it/s] 57%|███████████████████████████████████████████████▍                                   | 5566/9741 [00:13<00:10, 415.32it/s] 58%|███████████████████████████████████████████████▊                                   | 5608/9741 [00:14<00:09, 413.84it/s] 58%|████████████████████████████████████████████████▏                                  | 5651/9741 [00:14<00:09, 415.90it/s] 58%|████████████████████████████████████████████████▌                                  | 5694/9741 [00:14<00:09, 417.68it/s] 59%|████████████████████████████████████████████████▉                                  | 5737/9741 [00:14<00:09, 418.76it/s] 59%|█████████████████████████████████████████████████▏                                 | 5779/9741 [00:14<00:09, 419.05it/s] 60%|█████████████████████████████████████████████████▌                                 | 5821/9741 [00:14<00:09, 417.31it/s] 60%|█████████████████████████████████████████████████▉                                 | 5863/9741 [00:14<00:09, 417.71it/s] 61%|██████████████████████████████████████████████████▎                                | 5906/9741 [00:14<00:09, 418.46it/s] 61%|██████████████████████████████████████████████████▋                                | 5949/9741 [00:14<00:09, 419.95it/s] 62%|███████████████████████████████████████████████████                                | 5992/9741 [00:14<00:08, 420.68it/s] 62%|███████████████████████████████████████████████████▍                               | 6035/9741 [00:15<00:08, 421.54it/s] 62%|███████████████████████████████████████████████████▊                               | 6078/9741 [00:15<00:08, 420.26it/s] 63%|████████████████████████████████████████████████████▏                              | 6121/9741 [00:15<00:08, 420.84it/s] 63%|████████████████████████████████████████████████████▌                              | 6164/9741 [00:15<00:08, 421.40it/s] 64%|████████████████████████████████████████████████████▉                              | 6207/9741 [00:15<00:08, 421.99it/s] 64%|█████████████████████████████████████████████████████▎                             | 6250/9741 [00:15<00:08, 420.90it/s] 65%|█████████████████████████████████████████████████████▌                             | 6293/9741 [00:15<00:08, 418.51it/s] 65%|█████████████████████████████████████████████████████▉                             | 6336/9741 [00:15<00:08, 419.74it/s] 65%|██████████████████████████████████████████████████████▎                            | 6379/9741 [00:15<00:07, 420.53it/s] 66%|██████████████████████████████████████████████████████▋                            | 6422/9741 [00:16<00:07, 421.46it/s] 66%|███████████████████████████████████████████████████████                            | 6465/9741 [00:16<00:07, 418.20it/s] 67%|███████████████████████████████████████████████████████▍                           | 6507/9741 [00:16<00:07, 417.16it/s] 67%|███████████████████████████████████████████████████████▊                           | 6550/9741 [00:16<00:07, 418.87it/s] 68%|████████████████████████████████████████████████████████▏                          | 6593/9741 [00:16<00:07, 419.79it/s] 68%|████████████████████████████████████████████████████████▌                          | 6636/9741 [00:16<00:07, 420.21it/s] 69%|████████████████████████████████████████████████████████▉                          | 6679/9741 [00:16<00:07, 416.92it/s] 69%|█████████████████████████████████████████████████████████▎                         | 6721/9741 [00:16<00:07, 414.43it/s] 69%|█████████████████████████████████████████████████████████▋                         | 6763/9741 [00:16<00:07, 412.28it/s] 70%|█████████████████████████████████████████████████████████▉                         | 6805/9741 [00:16<00:07, 412.35it/s] 70%|██████████████████████████████████████████████████████████▎                        | 6847/9741 [00:17<00:07, 411.67it/s] 71%|██████████████████████████████████████████████████████████▋                        | 6889/9741 [00:17<00:06, 411.80it/s] 71%|███████████████████████████████████████████████████████████                        | 6931/9741 [00:17<00:06, 411.66it/s] 72%|███████████████████████████████████████████████████████████▍                       | 6973/9741 [00:17<00:06, 409.97it/s] 72%|███████████████████████████████████████████████████████████▊                       | 7015/9741 [00:17<00:06, 410.27it/s] 72%|████████████████████████████████████████████████████████████▏                      | 7057/9741 [00:17<00:06, 410.72it/s] 73%|████████████████████████████████████████████████████████████▍                      | 7099/9741 [00:17<00:06, 411.02it/s] 73%|████████████████████████████████████████████████████████████▊                      | 7141/9741 [00:17<00:06, 410.64it/s] 74%|█████████████████████████████████████████████████████████████▏                     | 7183/9741 [00:17<00:06, 408.63it/s] 74%|█████████████████████████████████████████████████████████████▌                     | 7225/9741 [00:17<00:06, 409.65it/s] 75%|█████████████████████████████████████████████████████████████▉                     | 7267/9741 [00:18<00:06, 410.13it/s] 75%|██████████████████████████████████████████████████████████████▎                    | 7309/9741 [00:18<00:05, 410.58it/s] 75%|██████████████████████████████████████████████████████████████▋                    | 7351/9741 [00:18<00:05, 410.78it/s] 76%|██████████████████████████████████████████████████████████████▉                    | 7393/9741 [00:18<00:05, 411.11it/s] 76%|███████████████████████████████████████████████████████████████▎                   | 7435/9741 [00:18<00:06, 382.88it/s] 77%|███████████████████████████████████████████████████████████████▋                   | 7476/9741 [00:18<00:05, 390.47it/s] 77%|████████████████████████████████████████████████████████████████                   | 7518/9741 [00:18<00:05, 396.36it/s] 78%|████████████████████████████████████████████████████████████████▍                  | 7559/9741 [00:18<00:05, 399.91it/s] 78%|████████████████████████████████████████████████████████████████▊                  | 7600/9741 [00:18<00:05, 402.85it/s] 78%|█████████████████████████████████████████████████████████████████                  | 7641/9741 [00:19<00:05, 397.50it/s] 79%|█████████████████████████████████████████████████████████████████▍                 | 7683/9741 [00:19<00:05, 401.45it/s] 79%|█████████████████████████████████████████████████████████████████▊                 | 7725/9741 [00:19<00:04, 404.73it/s] 80%|██████████████████████████████████████████████████████████████████▏                | 7767/9741 [00:19<00:04, 406.88it/s] 80%|██████████████████████████████████████████████████████████████████▌                | 7809/9741 [00:19<00:04, 408.35it/s] 81%|██████████████████████████████████████████████████████████████████▉                | 7851/9741 [00:19<00:04, 409.05it/s] 81%|███████████████████████████████████████████████████████████████████▏               | 7892/9741 [00:19<00:04, 407.78it/s] 81%|███████████████████████████████████████████████████████████████████▌               | 7934/9741 [00:19<00:04, 409.57it/s] 82%|███████████████████████████████████████████████████████████████████▉               | 7976/9741 [00:19<00:04, 411.16it/s] 82%|████████████████████████████████████████████████████████████████████▎              | 8018/9741 [00:19<00:04, 412.21it/s] 83%|████████████████████████████████████████████████████████████████████▋              | 8060/9741 [00:20<00:04, 413.07it/s] 83%|█████████████████████████████████████████████████████████████████████              | 8102/9741 [00:20<00:03, 412.50it/s] 84%|█████████████████████████████████████████████████████████████████████▍             | 8144/9741 [00:20<00:03, 414.26it/s] 84%|█████████████████████████████████████████████████████████████████████▊             | 8186/9741 [00:20<00:03, 415.88it/s] 84%|██████████████████████████████████████████████████████████████████████             | 8228/9741 [00:20<00:03, 416.83it/s] 85%|██████████████████████████████████████████████████████████████████████▍            | 8270/9741 [00:20<00:03, 417.27it/s] 85%|██████████████████████████████████████████████████████████████████████▊            | 8313/9741 [00:20<00:03, 418.40it/s] 86%|███████████████████████████████████████████████████████████████████████▏           | 8355/9741 [00:20<00:03, 417.39it/s] 86%|███████████████████████████████████████████████████████████████████████▌           | 8398/9741 [00:20<00:03, 418.65it/s] 87%|███████████████████████████████████████████████████████████████████████▉           | 8440/9741 [00:20<00:03, 417.37it/s] 87%|████████████████████████████████████████████████████████████████████████▎          | 8482/9741 [00:21<00:03, 417.22it/s] 88%|████████████████████████████████████████████████████████████████████████▋          | 8524/9741 [00:21<00:02, 417.20it/s] 88%|████████████████████████████████████████████████████████████████████████▉          | 8566/9741 [00:21<00:02, 416.57it/s] 88%|█████████████████████████████████████████████████████████████████████████▎         | 8609/9741 [00:21<00:02, 418.42it/s] 89%|█████████████████████████████████████████████████████████████████████████▋         | 8652/9741 [00:21<00:02, 419.73it/s] 89%|██████████████████████████████████████████████████████████████████████████         | 8695/9741 [00:21<00:02, 420.81it/s] 90%|██████████████████████████████████████████████████████████████████████████▍        | 8738/9741 [00:21<00:02, 421.53it/s] 90%|██████████████████████████████████████████████████████████████████████████▊        | 8781/9741 [00:21<00:02, 420.09it/s] 91%|███████████████████████████████████████████████████████████████████████████▏       | 8824/9741 [00:21<00:02, 418.70it/s] 91%|███████████████████████████████████████████████████████████████████████████▌       | 8866/9741 [00:21<00:02, 418.26it/s] 91%|███████████████████████████████████████████████████████████████████████████▉       | 8908/9741 [00:22<00:01, 416.60it/s] 92%|████████████████████████████████████████████████████████████████████████████▎      | 8950/9741 [00:22<00:01, 416.20it/s] 92%|████████████████████████████████████████████████████████████████████████████▋      | 8993/9741 [00:22<00:01, 417.72it/s] 93%|████████████████████████████████████████████████████████████████████████████▉      | 9035/9741 [00:22<00:01, 416.45it/s] 93%|█████████████████████████████████████████████████████████████████████████████▎     | 9078/9741 [00:22<00:01, 417.60it/s] 94%|█████████████████████████████████████████████████████████████████████████████▋     | 9121/9741 [00:22<00:01, 418.43it/s] 94%|██████████████████████████████████████████████████████████████████████████████     | 9164/9741 [00:22<00:01, 418.92it/s] 95%|██████████████████████████████████████████████████████████████████████████████▍    | 9207/9741 [00:22<00:01, 419.73it/s] 95%|██████████████████████████████████████████████████████████████████████████████▊    | 9249/9741 [00:22<00:01, 417.82it/s] 95%|███████████████████████████████████████████████████████████████████████████████▏   | 9292/9741 [00:22<00:01, 418.79it/s] 96%|███████████████████████████████████████████████████████████████████████████████▌   | 9334/9741 [00:23<00:00, 418.92it/s] 96%|███████████████████████████████████████████████████████████████████████████████▉   | 9377/9741 [00:23<00:00, 419.31it/s] 97%|████████████████████████████████████████████████████████████████████████████████▎  | 9420/9741 [00:23<00:00, 419.78it/s] 97%|████████████████████████████████████████████████████████████████████████████████▌  | 9462/9741 [00:23<00:00, 417.78it/s] 98%|████████████████████████████████████████████████████████████████████████████████▉  | 9505/9741 [00:23<00:00, 418.64it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▎ | 9548/9741 [00:23<00:00, 419.30it/s] 98%|█████████████████████████████████████████████████████████████████████████████████▋ | 9590/9741 [00:23<00:00, 419.40it/s] 99%|██████████████████████████████████████████████████████████████████████████████████ | 9632/9741 [00:23<00:00, 419.50it/s] 99%|██████████████████████████████████████████████████████████████████████████████████▍| 9675/9741 [00:23<00:00, 419.69it/s]100%|██████████████████████████████████████████████████████████████████████████████████▊| 9717/9741 [00:23<00:00, 417.80it/s]100%|███████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:24<00:00, 405.15it/s]
Load End
Num instances: 1000
[2023-08-22 11:03:02,759] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 11:03:05,595] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 11:03:05,595] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f7df074ea60>
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 11:03:05,596] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f7df074e940>
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 11:03:05,597] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 11:03:05,597] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4015357494354248 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
So the final answer is 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
So the final answer is 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
So the final answer is 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
So the final answer is 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Output: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
So the final answer is 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Output: Stella and Twinkle filled up the truck at the rate of 250 blocks per hour per person, a total of 2*250 = <<250*2=500>>500 blocks per hour for both.
After working for four hours, Stella and Twinkle had filled 4*500 = <<4*500=2000>>2000 blocks into the truck.
The number of blocks they had to put into the truck for it to be full is 6000-2000 = <<6000-2000=4000>>4000
When 6 more people joined Stella and Twinkle, a total of 2+6 = <<2+6=8>>8 people were filling the truck now.
Working at the rate of 250 blocks per person, the eight people filled the truck with 250*8 = <<250*8=2000>>2000 blocks in one hour.
If there were 4000 blocks that still needed to be put into the truck, the 8 people took 4000/2000 = <<4000/2000=2>>2 hours to fill the truck with the blocks.
The total time it took to fill up the tank is 4+2 = <<4+2=6>>6 hours.
So the final answer is 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Output: Total drunk: 8.5 + 9.5 = <<8.5+9.5=18>>18 pints
18 pints * 2 = <<18*2=36>>36 cups
The two boys drank a total of 36 cups of liquid yesterday.
So the final answer is 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Output: Each carton has an area of 4*4*5 = <<4*4*5=80>>80 square inches.
Each shipping box has an area of 20*20*20 = <<20*20*20=8000>>8000 square inches
The total number of cartons that will fit into each box is 8000/80 = <<8000/80=100>>100
Since there are 3 widgets in each carton, the total number of cartons in each box will be 3*100 = <<3*100=300>>300
So the final answer is 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Output: Queenie will earn $150 x 5 = $<<150*5=750>>750 for working 5 days.
She will receive an additional $5 x 4 = $<<5*4=20>>20 for overtime pay.
Hence, Queenie will receive a total of $750 + $20 = $<<750+20=770>>770.
So the final answer is 770

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o9-tgsm8k-s10-rTrue
Loading extension module utils...
Time to load utils op: 0.40478086471557617 seconds
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [00:34<28:12, 34.54s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [01:08<27:09, 33.95s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [01:42<26:43, 34.11s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [02:15<25:58, 33.88s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [02:49<25:17, 33.72s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [03:23<24:46, 33.79s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [03:56<24:07, 33.65s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [04:30<23:30, 33.58s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [05:04<23:05, 33.80s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [05:38<22:32, 33.81s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [06:11<21:56, 33.76s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [06:47<21:43, 34.30s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [07:21<21:02, 34.12s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [07:54<20:25, 34.04s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [08:28<19:45, 33.86s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [09:01<19:06, 33.73s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [09:35<18:31, 33.70s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [10:09<17:58, 33.69s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [10:42<17:23, 33.65s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [11:15<16:45, 33.53s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [11:49<16:13, 33.56s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [12:23<15:39, 33.54s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [12:56<15:07, 33.60s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [13:30<14:33, 33.59s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [14:03<13:58, 33.52s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [14:37<13:24, 33.52s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [15:10<12:50, 33.52s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [15:44<12:17, 33.54s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [16:17<11:43, 33.52s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [16:51<11:12, 33.64s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [17:25<10:39, 33.64s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [17:59<10:05, 33.64s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [18:32<09:31, 33.62s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [19:06<08:59, 33.70s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [19:40<08:25, 33.68s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [20:13<07:50, 33.64s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [20:46<07:16, 33.54s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [21:20<06:42, 33.56s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [21:54<06:09, 33.57s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [22:28<05:37, 33.75s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [23:01<05:02, 33.58s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [23:34<04:27, 33.45s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [24:07<03:53, 33.41s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [24:41<03:20, 33.47s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [25:14<02:47, 33.45s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [25:48<02:13, 33.34s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [26:21<01:40, 33.35s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [26:54<01:06, 33.29s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [27:28<00:33, 33.48s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [28:01<00:00, 33.31s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [28:01<00:00, 33.63s/it]
name: commonsenseqa | {'exact_match': 0.2, 'rougeL': 1.7828} | avg. gen lenth: 439.742
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 11:31:15,579] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o1-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  3%|██▍                                                                                | 283/9741 [00:00<00:03, 2828.30it/s]  6%|████▉                                                                              | 582/9741 [00:00<00:03, 2916.98it/s]  9%|███████▌                                                                           | 890/9741 [00:00<00:02, 2988.71it/s] 12%|██████████                                                                        | 1202/9741 [00:00<00:02, 3038.51it/s] 16%|████████████▋                                                                     | 1511/9741 [00:00<00:02, 3054.88it/s] 19%|███████████████▎                                                                  | 1821/9741 [00:00<00:02, 3068.81it/s] 22%|█████████████████▉                                                                | 2128/9741 [00:00<00:02, 3068.15it/s] 25%|████████████████████▌                                                             | 2439/9741 [00:00<00:02, 3081.37it/s] 28%|███████████████████████▏                                                          | 2749/9741 [00:00<00:02, 3084.46it/s] 31%|█████████████████████████▋                                                        | 3058/9741 [00:01<00:02, 3020.80it/s] 35%|████████████████████████████▍                                                     | 3372/9741 [00:01<00:02, 3054.25it/s] 38%|███████████████████████████████                                                   | 3684/9741 [00:01<00:01, 3072.84it/s] 42%|██████████████████████████████████▋                                               | 4126/9741 [00:01<00:01, 3476.67it/s] 47%|██████████████████████████████████████▌                                           | 4586/9741 [00:01<00:01, 3811.77it/s] 51%|█████████████████████████████████████████▊                                        | 4968/9741 [00:01<00:01, 3205.59it/s] 56%|█████████████████████████████████████████████▊                                    | 5448/9741 [00:01<00:01, 3627.35it/s] 61%|█████████████████████████████████████████████████▉                                | 5935/9741 [00:01<00:00, 3966.55it/s] 66%|██████████████████████████████████████████████████████                            | 6418/9741 [00:01<00:00, 4207.68it/s] 71%|██████████████████████████████████████████████████████████                        | 6891/9741 [00:01<00:00, 4356.60it/s] 76%|██████████████████████████████████████████████████████████████                    | 7368/9741 [00:02<00:00, 4474.18it/s] 81%|██████████████████████████████████████████████████████████████████                | 7843/9741 [00:02<00:00, 4554.69it/s] 85%|██████████████████████████████████████████████████████████████████████            | 8328/9741 [00:02<00:00, 4641.13it/s] 90%|██████████████████████████████████████████████████████████████████████████▏       | 8813/9741 [00:02<00:00, 4702.74it/s] 95%|██████████████████████████████████████████████████████████████████████████████▎   | 9301/9741 [00:02<00:00, 4753.42it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:02<00:00, 3799.05it/s]
Load End
Num instances: 1000
[2023-08-22 11:31:29,023] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 11:31:33,496] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 11:31:33,497] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 11:31:33,497] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 11:31:33,497] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 11:31:33,497] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 11:31:33,497] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fd9f1130a60>
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fd9f1130940>
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 11:31:33,498] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 11:31:33,499] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 11:31:33,499] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 11:31:33,499] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 11:31:33,499] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 11:31:33,499] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 11:31:33,499] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 11:31:33,499] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 11:31:33,499] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 11:31:33,499] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 11:31:33,499] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 11:31:33,499] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 11:31:33,499] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 11:31:33,499] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3773977756500244 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o1-tgsm8k-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.40543508529663086 seconds
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [01:07<55:21, 67.79s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [02:15<54:18, 67.90s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [03:24<53:39, 68.50s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [04:30<51:39, 67.38s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [05:36<50:14, 66.98s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [06:43<49:05, 66.93s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [07:50<48:01, 67.02s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [08:59<47:16, 67.54s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [10:07<46:11, 67.60s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [11:14<44:53, 67.35s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [12:21<43:52, 67.51s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [13:27<42:22, 66.90s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [14:35<41:31, 67.33s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [15:42<40:16, 67.12s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [16:49<39:03, 66.95s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [17:55<37:54, 66.90s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [19:03<36:53, 67.07s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [20:09<35:40, 66.89s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [21:17<34:40, 67.12s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [22:24<33:31, 67.05s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [23:30<32:19, 66.87s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [24:38<31:22, 67.22s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [25:45<30:14, 67.19s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [26:53<29:11, 67.35s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [28:01<28:11, 67.65s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [29:08<26:53, 67.24s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [30:16<25:56, 67.68s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [31:22<24:35, 67.05s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [32:30<23:36, 67.47s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [33:35<22:12, 66.62s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [34:42<21:04, 66.56s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [35:50<20:09, 67.17s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [36:59<19:12, 67.80s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [38:06<18:01, 67.58s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [39:12<16:46, 67.10s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [40:19<15:36, 66.87s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [41:26<14:31, 67.04s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [42:32<13:19, 66.66s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [43:41<12:20, 67.32s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [44:52<11:25, 68.53s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [46:00<10:14, 68.26s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [47:08<09:05, 68.24s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [48:16<07:57, 68.22s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [49:24<06:47, 67.99s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [50:30<05:36, 67.38s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [51:38<04:31, 67.76s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [52:46<03:23, 67.84s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [53:53<02:14, 67.39s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [54:58<01:06, 66.71s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [56:03<00:00, 66.37s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [56:03<00:00, 67.28s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 0.8626} | avg. gen lenth: 323.242
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

using world size: 2
[2023-08-22 12:27:45,403] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o2-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  2%|█▋                                                                                 | 199/9741 [00:00<00:04, 1988.82it/s]  4%|███▌                                                                               | 411/9741 [00:00<00:04, 2064.42it/s]  6%|█████▎                                                                             | 625/9741 [00:00<00:04, 2094.77it/s]  9%|███████▏                                                                           | 842/9741 [00:00<00:04, 2121.65it/s] 11%|████████▉                                                                         | 1059/9741 [00:00<00:04, 2138.53it/s] 13%|██████████▋                                                                       | 1275/9741 [00:00<00:03, 2145.65it/s] 15%|████████████▌                                                                     | 1490/9741 [00:00<00:03, 2146.76it/s] 18%|██████████████▎                                                                   | 1707/9741 [00:00<00:03, 2153.06it/s] 20%|████████████████▏                                                                 | 1923/9741 [00:00<00:03, 2141.35it/s] 22%|█████████████████▉                                                                | 2138/9741 [00:01<00:03, 2092.45it/s] 24%|███████████████████▊                                                              | 2354/9741 [00:01<00:03, 2112.15it/s] 26%|█████████████████████▋                                                            | 2572/9741 [00:01<00:03, 2129.98it/s] 29%|███████████████████████▍                                                          | 2787/9741 [00:01<00:03, 2135.30it/s] 31%|█████████████████████████▎                                                        | 3006/9741 [00:01<00:03, 2150.77it/s] 34%|███████████████████████████▋                                                      | 3290/9741 [00:01<00:02, 2355.15it/s] 37%|██████████████████████████████▍                                                   | 3623/9741 [00:01<00:02, 2646.15it/s] 41%|█████████████████████████████████▎                                                | 3956/9741 [00:01<00:02, 2849.19it/s] 44%|████████████████████████████████████▏                                             | 4294/9741 [00:01<00:01, 3007.51it/s] 47%|██████████████████████████████████████▊                                           | 4617/9741 [00:01<00:01, 3072.26it/s] 51%|█████████████████████████████████████████▍                                        | 4925/9741 [00:02<00:01, 2411.84it/s] 54%|████████████████████████████████████████████▎                                     | 5261/9741 [00:02<00:01, 2650.11it/s] 57%|███████████████████████████████████████████████                                   | 5594/9741 [00:02<00:01, 2826.45it/s] 61%|█████████████████████████████████████████████████▉                                | 5929/9741 [00:02<00:01, 2968.18it/s] 64%|████████████████████████████████████████████████████▋                             | 6262/9741 [00:02<00:01, 3069.73it/s] 68%|███████████████████████████████████████████████████████▌                          | 6598/9741 [00:02<00:00, 3152.16it/s] 71%|██████████████████████████████████████████████████████████▍                       | 6935/9741 [00:02<00:00, 3215.20it/s] 75%|█████████████████████████████████████████████████████████████▏                    | 7274/9741 [00:02<00:00, 3266.40it/s] 78%|████████████████████████████████████████████████████████████████                  | 7605/9741 [00:02<00:00, 3265.39it/s] 82%|██████████████████████████████████████████████████████████████████▊               | 7939/9741 [00:03<00:00, 3286.76it/s] 85%|█████████████████████████████████████████████████████████████████████▋            | 8274/9741 [00:03<00:00, 3302.74it/s] 88%|████████████████████████████████████████████████████████████████████████▍         | 8609/9741 [00:03<00:00, 3315.20it/s] 92%|███████████████████████████████████████████████████████████████████████████▎      | 8942/9741 [00:03<00:00, 3277.81it/s] 95%|██████████████████████████████████████████████████████████████████████████████    | 9279/9741 [00:03<00:00, 3303.47it/s] 99%|████████████████████████████████████████████████████████████████████████████████▉ | 9611/9741 [00:03<00:00, 3306.23it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:03<00:00, 2741.35it/s]
Load End
Num instances: 1000
[2023-08-22 12:27:59,958] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 12:28:02,748] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 12:28:02,749] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 12:28:02,749] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 12:28:02,749] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 12:28:02,749] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 12:28:02,749] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fdc7ef0fa60>
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fdc7ef0f940>
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 12:28:02,750] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 12:28:02,751] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 12:28:02,751] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.40239739418029785 seconds
Loading extension module utils...
Time to load utils op: 0.40424060821533203 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o2-tgsm8k-s10-rFalse
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [01:06<54:01, 66.15s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [02:11<52:33, 65.71s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [03:17<51:29, 65.74s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [04:21<49:54, 65.10s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [05:28<49:22, 65.84s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [06:35<48:30, 66.15s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [07:40<47:11, 65.86s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [08:44<45:36, 65.16s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [09:49<44:34, 65.22s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [10:56<43:45, 65.63s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [12:01<42:38, 65.61s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [13:07<41:33, 65.62s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [14:15<40:51, 66.25s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [15:20<39:39, 66.09s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [16:25<38:23, 65.82s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [17:30<37:09, 65.57s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [18:35<35:54, 65.29s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [19:38<34:29, 64.66s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [20:43<33:22, 64.59s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [21:47<32:12, 64.42s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [22:52<31:13, 64.61s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [23:57<30:10, 64.67s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [25:01<29:04, 64.61s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [26:05<27:51, 64.29s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [27:09<26:45, 64.23s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [28:13<25:42, 64.27s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [29:18<24:40, 64.38s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [30:24<23:46, 64.83s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [31:30<22:51, 65.30s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [32:36<21:47, 65.38s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [33:42<20:48, 65.70s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [34:48<19:42, 65.71s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [35:53<18:34, 65.57s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [36:56<17:14, 64.67s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [38:01<16:11, 64.78s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [39:05<15:06, 64.75s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [40:11<14:06, 65.10s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [41:17<13:02, 65.18s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [42:20<11:51, 64.71s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [43:28<10:57, 65.71s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [44:35<09:54, 66.04s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [45:40<08:45, 65.64s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [46:45<07:39, 65.63s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [47:51<06:33, 65.62s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [48:57<05:28, 65.72s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [50:00<04:20, 65.02s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [51:07<03:16, 65.58s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [52:12<02:10, 65.39s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [53:16<01:04, 64.88s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [54:21<00:00, 64.94s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [54:21<00:00, 65.23s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.4464} | avg. gen lenth: 301.416
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 13:22:35,156] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o3-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  2%|█▍                                                                                 | 163/9741 [00:00<00:05, 1622.61it/s]  3%|██▊                                                                                | 333/9741 [00:00<00:05, 1662.28it/s]  5%|████▎                                                                              | 505/9741 [00:00<00:05, 1687.72it/s]  7%|█████▊                                                                             | 678/9741 [00:00<00:05, 1700.47it/s]  9%|███████▎                                                                           | 853/9741 [00:00<00:05, 1714.47it/s] 11%|████████▋                                                                         | 1029/9741 [00:00<00:05, 1727.31it/s] 12%|██████████▏                                                                       | 1204/9741 [00:00<00:04, 1733.76it/s] 14%|███████████▌                                                                      | 1378/9741 [00:00<00:04, 1734.63it/s] 16%|█████████████                                                                     | 1552/9741 [00:00<00:04, 1695.86it/s] 18%|██████████████▌                                                                   | 1725/9741 [00:01<00:04, 1703.18it/s] 19%|███████████████▉                                                                  | 1896/9741 [00:01<00:04, 1692.95it/s] 21%|█████████████████▍                                                                | 2070/9741 [00:01<00:04, 1705.08it/s] 23%|███████████████████                                                               | 2267/9741 [00:01<00:04, 1784.31it/s] 26%|█████████████████████▎                                                            | 2531/9741 [00:01<00:03, 2040.41it/s] 29%|███████████████████████▍                                                          | 2783/9741 [00:01<00:03, 2182.17it/s] 31%|█████████████████████████▌                                                        | 3043/9741 [00:01<00:02, 2305.77it/s] 34%|███████████████████████████▌                                                      | 3278/9741 [00:01<00:02, 2316.15it/s] 36%|█████████████████████████████▌                                                    | 3510/9741 [00:01<00:02, 2308.95it/s] 38%|███████████████████████████████▌                                                  | 3742/9741 [00:02<00:03, 1836.82it/s] 40%|█████████████████████████████████▏                                                | 3941/9741 [00:02<00:03, 1807.27it/s] 42%|██████████████████████████████████▊                                               | 4133/9741 [00:02<00:03, 1788.85it/s] 44%|████████████████████████████████████▎                                             | 4320/9741 [00:02<00:03, 1776.30it/s] 46%|█████████████████████████████████████▉                                            | 4503/9741 [00:02<00:03, 1745.95it/s] 48%|███████████████████████████████████████▍                                          | 4681/9741 [00:02<00:02, 1739.64it/s] 50%|████████████████████████████████████████▉                                         | 4858/9741 [00:02<00:03, 1310.06it/s] 52%|██████████████████████████████████████████▎                                       | 5032/9741 [00:02<00:03, 1408.47it/s] 53%|███████████████████████████████████████████▊                                      | 5207/9741 [00:02<00:03, 1491.82it/s] 55%|█████████████████████████████████████████████▎                                    | 5381/9741 [00:03<00:02, 1555.65it/s] 57%|██████████████████████████████████████████████▊                                   | 5557/9741 [00:03<00:02, 1610.05it/s] 59%|████████████████████████████████████████████████▎                                 | 5733/9741 [00:03<00:02, 1649.42it/s] 61%|█████████████████████████████████████████████████▋                                | 5909/9741 [00:03<00:02, 1678.66it/s] 62%|███████████████████████████████████████████████████▏                              | 6081/9741 [00:03<00:02, 1669.14it/s] 64%|████████████████████████████████████████████████████▋                             | 6256/9741 [00:03<00:02, 1689.94it/s] 66%|██████████████████████████████████████████████████████▏                           | 6432/9741 [00:03<00:01, 1708.37it/s] 68%|███████████████████████████████████████████████████████▌                          | 6606/9741 [00:03<00:01, 1717.35it/s] 70%|█████████████████████████████████████████████████████████                         | 6784/9741 [00:03<00:01, 1734.67it/s] 72%|███████████████████████████████████████████████████████████▍                      | 7055/9741 [00:03<00:01, 2023.43it/s] 75%|█████████████████████████████████████████████████████████████▋                    | 7324/9741 [00:04<00:01, 2219.60it/s] 78%|███████████████████████████████████████████████████████████████▊                  | 7579/9741 [00:04<00:00, 2317.09it/s] 80%|█████████████████████████████████████████████████████████████████▊                | 7812/9741 [00:04<00:00, 2318.51it/s] 83%|████████████████████████████████████████████████████████████████████              | 8084/9741 [00:04<00:00, 2435.97it/s] 86%|██████████████████████████████████████████████████████████████████████▎           | 8356/9741 [00:04<00:00, 2520.82it/s] 88%|████████████████████████████████████████████████████████████████████████▌         | 8615/9741 [00:04<00:00, 2540.94it/s] 91%|██████████████████████████████████████████████████████████████████████████▊       | 8882/9741 [00:04<00:00, 2577.07it/s] 94%|████████████████████████████████████████████████████████████████████████████▉     | 9144/9741 [00:04<00:00, 2588.84it/s] 97%|███████████████████████████████████████████████████████████████████████████████▏  | 9403/9741 [00:04<00:00, 2547.38it/s] 99%|█████████████████████████████████████████████████████████████████████████████████▎| 9658/9741 [00:04<00:00, 2465.99it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:05<00:00, 1938.23it/s]
Load End
Num instances: 1000
[2023-08-22 13:22:51,300] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 13:22:54,006] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 13:22:54,006] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f3442d56a60>
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 13:22:54,007] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f3442d56940>
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 13:22:54,008] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 13:22:54,008] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.39937400817871094 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o3-tgsm8k-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.3043084144592285 seconds
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [01:01<50:32, 61.90s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [02:05<50:15, 62.81s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [03:06<48:44, 62.22s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [04:07<47:14, 61.62s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [05:11<46:46, 62.38s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [06:13<45:38, 62.24s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [07:14<44:26, 62.01s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [08:14<42:59, 61.41s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [09:17<42:13, 61.80s/it]Evaluating commonsenseqa :  20%|████████████▏                                                | 10/50 [10:18<41:02, 61.55s/it]Evaluating commonsenseqa :  22%|█████████████▍                                               | 11/50 [11:23<40:36, 62.47s/it]Evaluating commonsenseqa :  24%|██████████████▋                                              | 12/50 [12:24<39:19, 62.09s/it]Evaluating commonsenseqa :  26%|███████████████▊                                             | 13/50 [13:28<38:40, 62.71s/it]Evaluating commonsenseqa :  28%|█████████████████                                            | 14/50 [14:31<37:42, 62.86s/it]Evaluating commonsenseqa :  30%|██████████████████▎                                          | 15/50 [15:33<36:24, 62.42s/it]Evaluating commonsenseqa :  32%|███████████████████▌                                         | 16/50 [16:33<35:06, 61.96s/it]Evaluating commonsenseqa :  34%|████████████████████▋                                        | 17/50 [17:38<34:29, 62.71s/it]Evaluating commonsenseqa :  36%|█████████████████████▉                                       | 18/50 [18:39<33:13, 62.31s/it]Evaluating commonsenseqa :  38%|███████████████████████▏                                     | 19/50 [19:41<32:07, 62.18s/it]Evaluating commonsenseqa :  40%|████████████████████████▍                                    | 20/50 [20:44<31:12, 62.43s/it]Evaluating commonsenseqa :  42%|█████████████████████████▌                                   | 21/50 [21:44<29:50, 61.74s/it]Evaluating commonsenseqa :  44%|██████████████████████████▊                                  | 22/50 [22:47<28:53, 61.91s/it]Evaluating commonsenseqa :  46%|████████████████████████████                                 | 23/50 [23:48<27:48, 61.81s/it]Evaluating commonsenseqa :  48%|█████████████████████████████▎                               | 24/50 [24:49<26:39, 61.50s/it]Evaluating commonsenseqa :  50%|██████████████████████████████▌                              | 25/50 [25:51<25:44, 61.79s/it]Evaluating commonsenseqa :  52%|███████████████████████████████▋                             | 26/50 [26:55<24:58, 62.46s/it]Evaluating commonsenseqa :  54%|████████████████████████████████▉                            | 27/50 [27:59<24:03, 62.78s/it]Evaluating commonsenseqa :  56%|██████████████████████████████████▏                          | 28/50 [29:00<22:49, 62.24s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████▍                         | 29/50 [30:03<21:53, 62.52s/it]Evaluating commonsenseqa :  60%|████████████████████████████████████▌                        | 30/50 [31:05<20:44, 62.23s/it]Evaluating commonsenseqa :  62%|█████████████████████████████████████▊                       | 31/50 [32:07<19:40, 62.14s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████                      | 32/50 [33:10<18:46, 62.61s/it]Evaluating commonsenseqa :  66%|████████████████████████████████████████▎                    | 33/50 [34:14<17:47, 62.81s/it]Evaluating commonsenseqa :  68%|█████████████████████████████████████████▍                   | 34/50 [35:14<16:35, 62.19s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████▋                  | 35/50 [36:19<15:42, 62.82s/it]Evaluating commonsenseqa :  72%|███████████████████████████████████████████▉                 | 36/50 [37:22<14:40, 62.86s/it]Evaluating commonsenseqa :  74%|█████████████████████████████████████████████▏               | 37/50 [38:26<13:42, 63.23s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████▎              | 38/50 [39:27<12:33, 62.75s/it]Evaluating commonsenseqa :  78%|███████████████████████████████████████████████▌             | 39/50 [40:28<11:24, 62.24s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████▊            | 40/50 [41:34<10:31, 63.12s/it]Evaluating commonsenseqa :  82%|██████████████████████████████████████████████████           | 41/50 [42:35<09:24, 62.74s/it]Evaluating commonsenseqa :  84%|███████████████████████████████████████████████████▏         | 42/50 [43:38<08:20, 62.59s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████▍        | 43/50 [44:39<07:15, 62.18s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████▋       | 44/50 [45:40<06:11, 61.98s/it]Evaluating commonsenseqa :  90%|██████████████████████████████████████████████████████▉      | 45/50 [46:43<05:10, 62.05s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████     | 46/50 [47:44<04:07, 61.94s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████▎   | 47/50 [48:47<03:06, 62.21s/it]Evaluating commonsenseqa :  96%|██████████████████████████████████████████████████████████▌  | 48/50 [49:51<02:05, 62.67s/it]Evaluating commonsenseqa :  98%|███████████████████████████████████████████████████████████▊ | 49/50 [50:55<01:02, 62.98s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [51:57<00:00, 62.83s/it]Evaluating commonsenseqa : 100%|█████████████████████████████████████████████████████████████| 50/50 [51:57<00:00, 62.35s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.3134} | avg. gen lenth: 331.384
torchrun --nproc_per_node 2 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29500 /home/ylu130/workspace/in-context-generalization/inference.py --model-name opt-1.3b --model-type opt --model-path /scratch/ylu130/model/opt-1.3b --n-gpu 2 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 10 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s10-rFalse --seed 10 --max-prompt-length 2048 --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 2
[2023-08-22 14:15:04,725] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... opt-1.3b
  model_type ................... opt
  model_path ................... /scratch/ylu130/model/opt-1.3b
  n_gpu ........................ 2
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o4-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 10
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 2
Loading Data
  0%|                                                                                               | 0/9741 [00:00<?, ?it/s]  1%|█                                                                                  | 122/9741 [00:00<00:07, 1219.16it/s]  3%|██▏                                                                                | 250/9741 [00:00<00:07, 1249.87it/s]  4%|███▏                                                                               | 380/9741 [00:00<00:07, 1269.64it/s]  5%|████▎                                                                              | 510/9741 [00:00<00:07, 1278.38it/s]  7%|█████▍                                                                             | 641/9741 [00:00<00:07, 1286.97it/s]  8%|██████▌                                                                            | 773/9741 [00:00<00:06, 1296.20it/s]  9%|███████▋                                                                           | 904/9741 [00:00<00:06, 1300.29it/s] 11%|████████▋                                                                         | 1037/9741 [00:00<00:06, 1307.62it/s] 12%|█████████▊                                                                        | 1168/9741 [00:00<00:06, 1287.35it/s] 13%|██████████▉                                                                       | 1299/9741 [00:01<00:06, 1293.25it/s] 15%|████████████                                                                      | 1429/9741 [00:01<00:06, 1293.30it/s] 16%|█████████████▏                                                                    | 1560/9741 [00:01<00:06, 1297.58it/s] 17%|██████████████▏                                                                   | 1692/9741 [00:01<00:06, 1301.47it/s] 19%|███████████████▎                                                                  | 1823/9741 [00:01<00:06, 1283.02it/s] 20%|████████████████▍                                                                 | 1953/9741 [00:01<00:06, 1287.56it/s] 21%|█████████████████▌                                                                | 2084/9741 [00:01<00:05, 1291.88it/s] 23%|██████████████████▋                                                               | 2216/9741 [00:01<00:05, 1297.31it/s] 24%|███████████████████▊                                                              | 2348/9741 [00:01<00:05, 1302.63it/s] 26%|█████████████████████▍                                                            | 2547/9741 [00:01<00:04, 1506.11it/s] 28%|███████████████████████                                                           | 2746/9741 [00:02<00:04, 1649.19it/s] 30%|████████████████████████▊                                                         | 2946/9741 [00:02<00:03, 1752.81it/s] 32%|██████████████████████████▍                                                       | 3146/9741 [00:02<00:03, 1824.47it/s] 34%|████████████████████████████▏                                                     | 3347/9741 [00:02<00:03, 1878.93it/s] 36%|█████████████████████████████▊                                                    | 3546/9741 [00:02<00:03, 1911.36it/s] 38%|███████████████████████████████▌                                                  | 3746/9741 [00:02<00:03, 1935.85it/s] 41%|█████████████████████████████████▏                                                | 3946/9741 [00:02<00:02, 1952.36it/s] 43%|██████████████████████████████████▉                                               | 4145/9741 [00:02<00:02, 1962.87it/s] 45%|████████████████████████████████████▌                                             | 4345/9741 [00:02<00:02, 1971.97it/s] 47%|██████████████████████████████████████▏                                           | 4543/9741 [00:02<00:02, 1949.02it/s] 49%|███████████████████████████████████████▉                                          | 4738/9741 [00:03<00:02, 1681.23it/s] 51%|█████████████████████████████████████████▌                                        | 4932/9741 [00:03<00:02, 1742.68it/s] 53%|███████████████████████████████████████████▏                                      | 5129/9741 [00:03<00:02, 1802.67it/s] 55%|████████████████████████████████████████████▊                                     | 5329/9741 [00:03<00:02, 1856.70it/s] 57%|██████████████████████████████████████████████▌                                   | 5529/9741 [00:03<00:02, 1896.27it/s] 59%|████████████████████████████████████████████████▏                                 | 5728/9741 [00:03<00:02, 1921.36it/s] 61%|█████████████████████████████████████████████████▉                                | 5927/9741 [00:03<00:01, 1940.93it/s] 63%|███████████████████████████████████████████████████▌                              | 6126/9741 [00:03<00:01, 1954.88it/s] 65%|█████████████████████████████████████████████████████▏                            | 6324/9741 [00:03<00:01, 1961.32it/s] 67%|██████████████████████████████████████████████████████▉                           | 6524/9741 [00:03<00:01, 1970.02it/s] 69%|████████████████████████████████████████████████████████▌                         | 6724/9741 [00:04<00:01, 1976.74it/s] 71%|██████████████████████████████████████████████████████████▎                       | 6924/9741 [00:04<00:01, 1982.59it/s] 73%|███████████████████████████████████████████████████████████▉                      | 7124/9741 [00:04<00:01, 1986.61it/s] 75%|█████████████████████████████████████████████████████████████▋                    | 7323/9741 [00:04<00:01, 1985.10it/s] 77%|███████████████████████████████████████████████████████████████▎                  | 7522/9741 [00:04<00:01, 1952.87it/s] 79%|████████████████████████████████████████████████████████████████▉                 | 7718/9741 [00:04<00:01, 1945.99it/s] 81%|██████████████████████████████████████████████████████████████████▋               | 7918/9741 [00:04<00:00, 1961.22it/s] 83%|████████████████████████████████████████████████████████████████████▎             | 8116/9741 [00:04<00:00, 1965.06it/s] 85%|█████████████████████████████████████████████████████████████████████▉            | 8313/9741 [00:04<00:00, 1946.76it/s] 87%|███████████████████████████████████████████████████████████████████████▌          | 8508/9741 [00:04<00:00, 1946.72it/s] 89%|█████████████████████████████████████████████████████████████████████████▎        | 8704/9741 [00:05<00:00, 1948.88it/s] 91%|██████████████████████████████████████████████████████████████████████████▉       | 8900/9741 [00:05<00:00, 1950.79it/s] 93%|████████████████████████████████████████████████████████████████████████████▌     | 9097/9741 [00:05<00:00, 1955.63it/s] 95%|██████████████████████████████████████████████████████████████████████████████▏   | 9295/9741 [00:05<00:00, 1960.49it/s] 97%|███████████████████████████████████████████████████████████████████████████████▉  | 9492/9741 [00:05<00:00, 1962.82it/s] 99%|█████████████████████████████████████████████████████████████████████████████████▌| 9689/9741 [00:05<00:00, 1959.94it/s]100%|██████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:05<00:00, 1731.95it/s]
Load End
Num instances: 1000
[2023-08-22 14:15:21,310] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-22 14:15:24,123] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-22 14:15:24,124] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-22 14:15:24,124] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-22 14:15:24,124] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-22 14:15:24,124] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-22 14:15:24,124] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-22 14:15:24,124] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-22 14:15:24,124] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-22 14:15:24,124] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fdf37ec0a60>
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fdf37ec0940>
[2023-08-22 14:15:24,125] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  10
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   world_size ................... 2
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-22 14:15:24,126] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-22 14:15:24,126] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 10, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.39810657501220703 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |    2509 MB |    2509 MB |    2509 MB |       0 B  |
|       from large pool |    2508 MB |    2508 MB |    2508 MB |       0 B  |
|       from small pool |       1 MB |       1 MB |       1 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    2716 MB |    2716 MB |    2716 MB |       0 B  |
|       from large pool |    2714 MB |    2714 MB |    2714 MB |       0 B  |
|       from small pool |       2 MB |       2 MB |       2 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  211344 KB |  211384 KB |  605812 KB |  394468 KB |
|       from large pool |  210552 KB |  210552 KB |  603768 KB |  393216 KB |
|       from small pool |     792 KB |    2044 KB |    2044 KB |    1252 KB |
|---------------------------------------------------------------------------|
| Allocations           |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     388    |     388    |     388    |       0    |
|       from large pool |     146    |     146    |     146    |       0    |
|       from small pool |     242    |     242    |     242    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      99    |      99    |      99    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |      51    |      51    |       0    |
|       from large pool |      50    |      50    |      50    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                      | 0/50 [00:00<?, ?it/s]############### Example ###############
### Instruction:Answer the following multiple choice question.

Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Output: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Output: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Output: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Output: 30

Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid
Output:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/opt-1.3b/commonsenseqa/out-domain/o4-tgsm8k-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.4047830104827881 seconds
Evaluating commonsenseqa :   2%|█▏                                                            | 1/50 [01:00<49:13, 60.27s/it]Evaluating commonsenseqa :   4%|██▍                                                           | 2/50 [02:00<47:59, 59.99s/it]Evaluating commonsenseqa :   6%|███▋                                                          | 3/50 [02:58<46:23, 59.22s/it]Evaluating commonsenseqa :   8%|████▉                                                         | 4/50 [03:56<44:56, 58.62s/it]Evaluating commonsenseqa :  10%|██████▏                                                       | 5/50 [04:54<43:50, 58.45s/it]Evaluating commonsenseqa :  12%|███████▍                                                      | 6/50 [05:52<42:45, 58.31s/it]Evaluating commonsenseqa :  14%|████████▋                                                     | 7/50 [06:52<42:08, 58.80s/it]Evaluating commonsenseqa :  16%|█████████▉                                                    | 8/50 [07:50<41:06, 58.72s/it]Evaluating commonsenseqa :  18%|███████████▏                                                  | 9/50 [08:50<40:21, 59.06s/it]