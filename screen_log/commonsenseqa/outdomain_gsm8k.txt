PYTHONPATH=/home/ylu130/workspace/in-context-generalization
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s1-rTrue --seed 1 --rationales --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 17:31:02,445] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  2%|██▏                                                                                                                                               | 150/9741 [00:00<00:06, 1491.95it/s]  3%|████▌                                                                                                                                             | 301/9741 [00:00<00:06, 1498.37it/s]  5%|██████▊                                                                                                                                           | 452/9741 [00:00<00:06, 1502.15it/s]  6%|█████████                                                                                                                                         | 604/9741 [00:00<00:06, 1508.89it/s]  8%|███████████▎                                                                                                                                      | 756/9741 [00:00<00:05, 1509.62it/s]  9%|█████████████▌                                                                                                                                    | 907/9741 [00:00<00:05, 1500.28it/s] 11%|███████████████▊                                                                                                                                 | 1059/9741 [00:00<00:05, 1505.45it/s] 12%|██████████████████                                                                                                                               | 1210/9741 [00:00<00:05, 1500.59it/s] 14%|████████████████████▎                                                                                                                            | 1361/9741 [00:00<00:05, 1501.18it/s] 16%|██████████████████████▌                                                                                                                          | 1514/9741 [00:01<00:05, 1508.91it/s] 17%|████████████████████████▊                                                                                                                        | 1665/9741 [00:01<00:05, 1496.82it/s] 19%|███████████████████████████                                                                                                                      | 1815/9741 [00:01<00:05, 1479.24it/s] 20%|█████████████████████████████▎                                                                                                                   | 1967/9741 [00:01<00:05, 1490.15it/s] 22%|███████████████████████████████▌                                                                                                                 | 2118/9741 [00:01<00:05, 1492.97it/s] 23%|█████████████████████████████████▊                                                                                                               | 2270/9741 [00:01<00:04, 1499.36it/s] 25%|████████████████████████████████████                                                                                                             | 2425/9741 [00:01<00:04, 1513.55it/s] 26%|██████████████████████████████████████▎                                                                                                          | 2578/9741 [00:01<00:04, 1517.95it/s] 28%|████████████████████████████████████████▋                                                                                                        | 2730/9741 [00:01<00:04, 1515.62it/s] 30%|██████████████████████████████████████████▉                                                                                                      | 2883/9741 [00:01<00:04, 1519.73it/s] 31%|█████████████████████████████████████████████▏                                                                                                   | 3036/9741 [00:02<00:04, 1520.33it/s] 33%|███████████████████████████████████████████████▍                                                                                                 | 3190/9741 [00:02<00:04, 1523.71it/s] 34%|█████████████████████████████████████████████████▊                                                                                               | 3343/9741 [00:02<00:04, 1525.20it/s] 36%|████████████████████████████████████████████████████                                                                                             | 3496/9741 [00:02<00:04, 1521.17it/s] 37%|██████████████████████████████████████████████████████▎                                                                                          | 3649/9741 [00:02<00:04, 1512.80it/s] 39%|████████████████████████████████████████████████████████▌                                                                                        | 3802/9741 [00:02<00:03, 1516.05it/s] 41%|██████████████████████████████████████████████████████████▊                                                                                      | 3954/9741 [00:02<00:03, 1503.58it/s] 42%|█████████████████████████████████████████████████████████████▏                                                                                   | 4110/9741 [00:02<00:03, 1518.97it/s] 44%|███████████████████████████████████████████████████████████████▌                                                                                 | 4268/9741 [00:02<00:03, 1534.90it/s] 45%|█████████████████████████████████████████████████████████████████▊                                                                               | 4425/9741 [00:02<00:03, 1544.37it/s] 47%|████████████████████████████████████████████████████████████████████▏                                                                            | 4580/9741 [00:03<00:03, 1522.53it/s] 49%|██████████████████████████████████████████████████████████████████████▌                                                                          | 4740/9741 [00:03<00:04, 1166.74it/s] 50%|████████████████████████████████████████████████████████████████████████▉                                                                        | 4896/9741 [00:03<00:03, 1260.26it/s] 52%|███████████████████████████████████████████████████████████████████████████▏                                                                     | 5053/9741 [00:03<00:03, 1337.92it/s] 53%|█████████████████████████████████████████████████████████████████████████████▌                                                                   | 5210/9741 [00:03<00:03, 1398.23it/s] 55%|███████████████████████████████████████████████████████████████████████████████▉                                                                 | 5368/9741 [00:03<00:03, 1446.47it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▏                                                              | 5519/9741 [00:03<00:02, 1464.42it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▌                                                            | 5680/9741 [00:03<00:02, 1504.43it/s] 60%|██████████████████████████████████████████████████████████████████████████████████████▉                                                          | 5843/9741 [00:03<00:02, 1538.39it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▍                                                       | 6005/9741 [00:04<00:02, 1561.79it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▊                                                     | 6167/9741 [00:04<00:02, 1577.47it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▏                                                  | 6326/9741 [00:04<00:02, 1564.24it/s] 67%|████████████████████████████████████████████████████████████████████████████████████████████████▌                                                | 6489/9741 [00:04<00:02, 1582.31it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▎                                             | 6670/9741 [00:04<00:01, 1648.09it/s] 71%|██████████████████████████████████████████████████████████████████████████████████████████████████████▉                                          | 6919/9741 [00:04<00:01, 1898.28it/s] 74%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                      | 7170/9741 [00:04<00:01, 2080.09it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                  | 7419/9741 [00:04<00:01, 2201.33it/s] 79%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                               | 7648/9741 [00:04<00:00, 2227.05it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                           | 7897/9741 [00:04<00:00, 2304.46it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                       | 8148/9741 [00:05<00:00, 2364.68it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                    | 8385/9741 [00:05<00:00, 2319.57it/s] 89%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                | 8638/9741 [00:05<00:00, 2378.81it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎            | 8890/9741 [00:05<00:00, 2420.45it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████         | 9138/9741 [00:05<00:00, 2436.25it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊     | 9389/9741 [00:05<00:00, 2457.75it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍ | 9640/9741 [00:05<00:00, 2470.60it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:05<00:00, 1709.91it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.21s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.91s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.27s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.16s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.58s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.37s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.56s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.60s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.76s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.52s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.85s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.08s/it]
[2023-08-10 17:32:01,429] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-10 17:32:08,732] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 17:32:08,733] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 17:32:08,734] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 17:32:08,734] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 17:32:08,734] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 17:32:08,734] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f3df02a4e80>
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 17:32:08,735] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f3df0373910>
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 17:32:08,736] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 17:32:08,737] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 17:32:08,737] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.402423620223999 seconds
Loading extension module utils...
Time to load utils op: 0.3041837215423584 seconds
Loading extension module utils...
Time to load utils op: 0.4048001766204834 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Rationales: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
#### 44
Answer: 44

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.4045424461364746 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:55<44:55, 55.02s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:50<44:10, 55.23s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:45<43:21, 55.35s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:40<42:17, 55.16s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:35<41:08, 54.86s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [05:03<33:42, 45.96s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:56<34:26, 48.06s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:50<34:58, 49.97s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:22<30:26, 44.55s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:18<31:59, 48.00s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:35<24:55, 38.36s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:29<27:28, 43.38s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [10:24<28:54, 46.87s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [11:18<29:24, 49.02s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [12:14<29:47, 51.07s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [13:11<29:54, 52.78s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [14:07<29:35, 53.80s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [15:02<28:53, 54.18s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [15:54<27:38, 53.50s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [16:50<27:02, 54.08s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [17:44<26:13, 54.25s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [18:39<25:27, 54.55s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [19:35<24:42, 54.92s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [20:28<23:35, 54.43s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [21:24<22:48, 54.74s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [22:13<21:13, 53.06s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [22:44<17:47, 46.41s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [23:15<15:17, 41.71s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [24:10<16:03, 45.86s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [24:35<13:10, 39.52s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [25:30<13:58, 44.13s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [26:24<14:10, 47.27s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [27:20<14:08, 49.90s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [28:16<13:45, 51.62s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [29:08<12:55, 51.71s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [30:04<12:20, 52.92s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [30:59<11:37, 53.62s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [31:53<10:44, 53.75s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [32:48<09:55, 54.15s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [33:43<09:02, 54.27s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [34:36<08:06, 54.07s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [34:47<05:28, 41.03s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [35:28<04:46, 40.90s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [36:21<04:28, 44.78s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [37:17<03:59, 48.00s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [38:12<03:20, 50.09s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [38:59<02:27, 49.27s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [39:54<01:41, 50.94s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [40:49<00:52, 52.20s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [41:45<00:00, 53.40s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [41:45<00:00, 50.12s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.5638} | lm_loss 7.7107 | avg. gen lenth: 256.696
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s1-rTrue --seed 1 --rationales --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 18:15:26,232] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|█▏                                                                                                                                                  | 80/9741 [00:00<00:12, 797.61it/s]  2%|██▍                                                                                                                                                | 161/9741 [00:00<00:11, 804.48it/s]  2%|███▋                                                                                                                                               | 242/9741 [00:00<00:11, 799.26it/s]  3%|████▊                                                                                                                                              | 323/9741 [00:00<00:11, 802.16it/s]  4%|██████                                                                                                                                             | 404/9741 [00:00<00:11, 802.89it/s]  5%|███████▎                                                                                                                                           | 485/9741 [00:00<00:11, 801.00it/s]  6%|████████▌                                                                                                                                          | 566/9741 [00:00<00:11, 801.13it/s]  7%|█████████▊                                                                                                                                         | 647/9741 [00:00<00:11, 785.61it/s]  7%|██████████▉                                                                                                                                        | 726/9741 [00:00<00:11, 784.56it/s]  8%|████████████▏                                                                                                                                      | 807/9741 [00:01<00:11, 789.73it/s]  9%|█████████████▍                                                                                                                                     | 887/9741 [00:01<00:11, 791.90it/s] 10%|██████████████▌                                                                                                                                    | 967/9741 [00:01<00:11, 793.05it/s] 11%|███████████████▋                                                                                                                                  | 1048/9741 [00:01<00:10, 796.12it/s] 12%|█████████████████▎                                                                                                                                | 1157/9741 [00:01<00:09, 883.75it/s] 13%|███████████████████▏                                                                                                                              | 1279/9741 [00:01<00:08, 982.58it/s] 14%|████████████████████▊                                                                                                                            | 1400/9741 [00:01<00:07, 1048.85it/s] 16%|██████████████████████▋                                                                                                                          | 1522/9741 [00:01<00:07, 1098.27it/s] 17%|████████████████████████▍                                                                                                                        | 1641/9741 [00:01<00:07, 1123.44it/s] 18%|██████████████████████████▏                                                                                                                      | 1763/9741 [00:01<00:06, 1151.09it/s] 19%|███████████████████████████▉                                                                                                                     | 1879/9741 [00:02<00:06, 1136.30it/s] 21%|█████████████████████████████▊                                                                                                                   | 2000/9741 [00:02<00:06, 1157.79it/s] 22%|███████████████████████████████▌                                                                                                                 | 2120/9741 [00:02<00:06, 1168.31it/s] 23%|█████████████████████████████████▍                                                                                                               | 2243/9741 [00:02<00:06, 1180.73it/s] 24%|███████████████████████████████████▏                                                                                                             | 2365/9741 [00:02<00:06, 1190.97it/s] 26%|█████████████████████████████████████                                                                                                            | 2486/9741 [00:02<00:06, 1196.32it/s] 27%|██████████████████████████████████████▊                                                                                                          | 2608/9741 [00:02<00:05, 1201.47it/s] 28%|████████████████████████████████████████▌                                                                                                        | 2729/9741 [00:02<00:05, 1200.16it/s] 29%|██████████████████████████████████████████▍                                                                                                      | 2850/9741 [00:02<00:05, 1198.02it/s] 31%|████████████████████████████████████████████▏                                                                                                    | 2972/9741 [00:02<00:05, 1201.83it/s] 32%|██████████████████████████████████████████████                                                                                                   | 3094/9741 [00:03<00:05, 1204.73it/s] 33%|███████████████████████████████████████████████▊                                                                                                 | 3215/9741 [00:03<00:05, 1204.72it/s] 34%|█████████████████████████████████████████████████▋                                                                                               | 3337/9741 [00:03<00:05, 1207.89it/s] 35%|███████████████████████████████████████████████████▍                                                                                             | 3458/9741 [00:03<00:05, 1207.17it/s] 37%|█████████████████████████████████████████████████████▎                                                                                           | 3579/9741 [00:03<00:05, 1207.38it/s] 38%|███████████████████████████████████████████████████████                                                                                          | 3700/9741 [00:03<00:05, 1205.74it/s] 39%|████████████████████████████████████████████████████████▉                                                                                        | 3822/9741 [00:03<00:04, 1208.65it/s] 40%|██████████████████████████████████████████████████████████▋                                                                                      | 3943/9741 [00:03<00:04, 1207.07it/s] 42%|████████████████████████████████████████████████████████████▍                                                                                    | 4064/9741 [00:03<00:04, 1205.10it/s] 43%|██████████████████████████████████████████████████████████████▎                                                                                  | 4185/9741 [00:03<00:04, 1206.33it/s] 44%|████████████████████████████████████████████████████████████████                                                                                 | 4306/9741 [00:04<00:04, 1206.04it/s] 45%|█████████████████████████████████████████████████████████████████▉                                                                               | 4427/9741 [00:04<00:04, 1206.23it/s] 47%|███████████████████████████████████████████████████████████████████▋                                                                             | 4548/9741 [00:04<00:04, 1165.59it/s] 48%|█████████████████████████████████████████████████████████████████████▌                                                                           | 4670/9741 [00:04<00:04, 1179.94it/s] 49%|███████████████████████████████████████████████████████████████████████▊                                                                          | 4789/9741 [00:04<00:05, 886.98it/s] 50%|█████████████████████████████████████████████████████████████████████████▌                                                                        | 4911/9741 [00:04<00:05, 965.11it/s] 52%|██████████████████████████████████████████████████████████████████████████▉                                                                      | 5032/9741 [00:04<00:04, 1026.15it/s] 53%|████████████████████████████████████████████████████████████████████████████▋                                                                    | 5153/9741 [00:04<00:04, 1074.99it/s] 54%|██████████████████████████████████████████████████████████████████████████████▍                                                                  | 5273/9741 [00:04<00:04, 1108.67it/s] 55%|████████████████████████████████████████████████████████████████████████████████▎                                                                | 5394/9741 [00:05<00:03, 1134.65it/s] 57%|██████████████████████████████████████████████████████████████████████████████████                                                               | 5516/9741 [00:05<00:03, 1157.59it/s] 58%|███████████████████████████████████████████████████████████████████████████████████▉                                                             | 5642/9741 [00:05<00:03, 1185.68it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▉                                                           | 5770/9741 [00:05<00:03, 1210.89it/s] 61%|███████████████████████████████████████████████████████████████████████████████████████▊                                                         | 5895/9741 [00:05<00:03, 1221.60it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▋                                                       | 6023/9741 [00:05<00:03, 1236.16it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▌                                                     | 6149/9741 [00:05<00:02, 1241.01it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▍                                                   | 6274/9741 [00:05<00:02, 1232.10it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▎                                                 | 6399/9741 [00:05<00:02, 1236.85it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▏                                               | 6526/9741 [00:05<00:02, 1245.10it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████                                              | 6652/9741 [00:06<00:02, 1247.76it/s] 70%|████████████████████████████████████████████████████████████████████████████████████████████████████▉                                            | 6779/9741 [00:06<00:02, 1251.67it/s] 71%|██████████████████████████████████████████████████████████████████████████████████████████████████████▊                                          | 6907/9741 [00:06<00:02, 1257.74it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                        | 7034/9741 [00:06<00:02, 1259.14it/s] 74%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                      | 7162/9741 [00:06<00:02, 1263.10it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                    | 7289/9741 [00:06<00:01, 1260.64it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                  | 7416/9741 [00:06<00:01, 1262.20it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                | 7543/9741 [00:06<00:01, 1218.96it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                              | 7669/9741 [00:06<00:01, 1230.36it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                             | 7797/9741 [00:06<00:01, 1242.11it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                           | 7922/9741 [00:07<00:01, 1227.26it/s] 83%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                         | 8049/9741 [00:07<00:01, 1237.08it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                       | 8175/9741 [00:07<00:01, 1242.95it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                     | 8301/9741 [00:07<00:01, 1247.75it/s] 87%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                   | 8427/9741 [00:07<00:01, 1250.57it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                 | 8553/9741 [00:07<00:00, 1252.83it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏               | 8679/9741 [00:07<00:00, 1250.99it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████              | 8805/9741 [00:07<00:00, 1250.54it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉            | 8931/9741 [00:07<00:00, 1253.27it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊          | 9057/9741 [00:07<00:00, 1252.21it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋        | 9183/9741 [00:08<00:00, 1251.03it/s] 96%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌      | 9309/9741 [00:08<00:00, 1251.35it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍    | 9436/9741 [00:08<00:00, 1254.58it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎  | 9562/9741 [00:08<00:00, 1252.08it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏| 9688/9741 [00:08<00:00, 1254.25it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:08<00:00, 1139.81it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.56s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.55s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.75s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.71s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.47s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.63s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.57s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.81s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  5.00s/it]
[2023-08-10 18:16:27,148] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.92s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.10s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.91s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.11s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.03s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.23s/it]
[2023-08-10 18:16:38,091] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 18:16:38,094] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 18:16:38,095] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 18:16:38,095] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 18:16:38,095] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 18:16:38,095] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 18:16:38,095] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 18:16:38,095] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 18:16:38,095] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 18:16:38,095] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 18:16:38,095] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 18:16:38,095] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f030d496e80>
[2023-08-10 18:16:38,095] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f030d3eb910>
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 18:16:38,096] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 18:16:38,097] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 18:16:38,097] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.40364980697631836 seconds
Loading extension module utils...
Time to load utils op: 0.30399227142333984 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.304337739944458 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Time to load utils op: 0.4043233394622803 seconds
Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Rationales: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
#### 44
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Rationales: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
#### 6
Answer: 6

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s1-rTrue
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:51<41:45, 51.12s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:18<29:38, 37.04s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:09<33:58, 43.38s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:59<35:17, 46.04s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:49<35:40, 47.57s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:39<35:34, 48.51s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:30<35:16, 49.23s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:20<34:39, 49.52s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:11<34:01, 49.79s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:00<33:10, 49.77s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:51<32:27, 49.94s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:41<31:40, 50.01s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [10:31<30:52, 50.05s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [11:21<30:00, 50.00s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [12:12<29:21, 50.34s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [13:01<28:15, 49.87s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [13:51<27:30, 50.01s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [14:42<26:43, 50.10s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [15:31<25:47, 49.92s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [16:22<25:04, 50.14s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [17:13<24:20, 50.37s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [18:02<23:19, 49.99s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [18:52<22:30, 50.03s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [19:42<21:39, 49.99s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [20:32<20:48, 49.96s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [21:21<19:56, 49.87s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [22:12<19:10, 50.04s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [23:02<18:19, 49.97s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [23:51<17:29, 49.97s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [24:41<16:39, 49.98s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [25:20<14:45, 46.59s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [26:09<14:13, 47.40s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [27:00<13:43, 48.47s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [27:50<13:02, 48.92s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [28:41<12:19, 49.30s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [29:30<11:28, 49.21s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [30:20<10:44, 49.57s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [31:06<09:40, 48.39s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [31:55<08:56, 48.78s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [32:45<08:09, 48.92s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [33:35<07:23, 49.28s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [34:24<06:34, 49.37s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [35:13<05:44, 49.21s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [36:04<04:58, 49.77s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [36:55<04:10, 50.08s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [37:44<03:19, 49.79s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [38:34<02:29, 49.83s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [39:25<01:40, 50.05s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [40:13<00:49, 49.58s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [41:04<00:00, 50.04s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [41:04<00:00, 49.29s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.3297} | lm_loss 7.725 | avg. gen lenth: 274.672
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s1-rTrue --seed 1 --rationales --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 18:57:50,209] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|▉                                                                                                                                                   | 64/9741 [00:00<00:15, 631.28it/s]  1%|█▉                                                                                                                                                 | 128/9741 [00:00<00:15, 636.21it/s]  2%|██▉                                                                                                                                                | 192/9741 [00:00<00:15, 635.72it/s]  3%|███▊                                                                                                                                               | 256/9741 [00:00<00:14, 633.94it/s]  3%|████▊                                                                                                                                              | 320/9741 [00:00<00:14, 635.48it/s]  4%|█████▊                                                                                                                                             | 384/9741 [00:00<00:14, 636.55it/s]  5%|██████▊                                                                                                                                            | 448/9741 [00:00<00:14, 635.00it/s]  5%|███████▋                                                                                                                                           | 512/9741 [00:00<00:14, 623.82it/s]  6%|████████▋                                                                                                                                          | 576/9741 [00:00<00:14, 626.05it/s]  7%|█████████▋                                                                                                                                         | 640/9741 [00:01<00:14, 629.35it/s]  7%|██████████▌                                                                                                                                        | 703/9741 [00:01<00:14, 628.96it/s]  8%|███████████▌                                                                                                                                       | 767/9741 [00:01<00:14, 631.37it/s]  9%|████████████▌                                                                                                                                      | 831/9741 [00:01<00:14, 633.62it/s]  9%|█████████████▌                                                                                                                                     | 895/9741 [00:01<00:13, 632.72it/s] 10%|██████████████▍                                                                                                                                    | 959/9741 [00:01<00:13, 634.23it/s] 11%|███████████████▎                                                                                                                                  | 1023/9741 [00:01<00:13, 635.95it/s] 11%|████████████████▎                                                                                                                                 | 1088/9741 [00:01<00:13, 637.25it/s] 12%|█████████████████▎                                                                                                                                | 1152/9741 [00:01<00:13, 631.09it/s] 12%|██████████████████▏                                                                                                                               | 1216/9741 [00:01<00:13, 631.89it/s] 13%|███████████████████▏                                                                                                                              | 1280/9741 [00:02<00:13, 633.23it/s] 14%|████████████████████▌                                                                                                                             | 1374/9741 [00:02<00:11, 724.49it/s] 15%|██████████████████████                                                                                                                            | 1471/9741 [00:02<00:10, 796.93it/s] 16%|███████████████████████▍                                                                                                                          | 1567/9741 [00:02<00:09, 845.22it/s] 17%|████████████████████████▉                                                                                                                         | 1664/9741 [00:02<00:09, 882.17it/s] 18%|██████████████████████████▍                                                                                                                       | 1761/9741 [00:02<00:08, 907.44it/s] 19%|███████████████████████████▊                                                                                                                      | 1852/9741 [00:02<00:08, 892.11it/s] 20%|█████████████████████████████▏                                                                                                                    | 1949/9741 [00:02<00:08, 914.01it/s] 21%|██████████████████████████████▋                                                                                                                   | 2045/9741 [00:02<00:08, 926.62it/s] 22%|████████████████████████████████                                                                                                                  | 2142/9741 [00:02<00:08, 938.16it/s] 23%|█████████████████████████████████▌                                                                                                                | 2239/9741 [00:03<00:07, 947.00it/s] 24%|██████████████████████████████████▉                                                                                                               | 2335/9741 [00:03<00:07, 950.02it/s] 25%|████████████████████████████████████▍                                                                                                             | 2433/9741 [00:03<00:07, 956.22it/s] 26%|█████████████████████████████████████▉                                                                                                            | 2529/9741 [00:03<00:07, 956.13it/s] 27%|███████████████████████████████████████▎                                                                                                          | 2627/9741 [00:03<00:07, 960.34it/s] 28%|████████████████████████████████████████▊                                                                                                         | 2724/9741 [00:03<00:07, 958.61it/s] 29%|██████████████████████████████████████████▎                                                                                                       | 2820/9741 [00:03<00:07, 959.02it/s] 30%|███████████████████████████████████████████▋                                                                                                      | 2917/9741 [00:03<00:07, 961.51it/s] 31%|█████████████████████████████████████████████▏                                                                                                    | 3014/9741 [00:03<00:07, 959.37it/s] 32%|██████████████████████████████████████████████▋                                                                                                   | 3111/9741 [00:03<00:06, 960.55it/s] 33%|████████████████████████████████████████████████                                                                                                  | 3208/9741 [00:04<00:06, 958.25it/s] 34%|█████████████████████████████████████████████████▌                                                                                                | 3305/9741 [00:04<00:06, 959.64it/s] 35%|██████████████████████████████████████████████████▉                                                                                               | 3401/9741 [00:04<00:06, 957.49it/s] 36%|████████████████████████████████████████████████████▍                                                                                             | 3498/9741 [00:04<00:06, 959.77it/s] 37%|█████████████████████████████████████████████████████▊                                                                                            | 3594/9741 [00:04<00:06, 953.96it/s] 38%|███████████████████████████████████████████████████████▎                                                                                          | 3690/9741 [00:04<00:06, 953.43it/s] 39%|████████████████████████████████████████████████████████▊                                                                                         | 3787/9741 [00:04<00:06, 956.66it/s] 40%|██████████████████████████████████████████████████████████▏                                                                                       | 3883/9741 [00:04<00:06, 955.63it/s] 41%|███████████████████████████████████████████████████████████▋                                                                                      | 3980/9741 [00:04<00:06, 957.61it/s] 42%|█████████████████████████████████████████████████████████████                                                                                     | 4076/9741 [00:04<00:05, 956.02it/s] 43%|██████████████████████████████████████████████████████████████▌                                                                                   | 4173/9741 [00:05<00:05, 957.36it/s] 44%|███████████████████████████████████████████████████████████████▉                                                                                  | 4270/9741 [00:05<00:05, 958.26it/s] 45%|█████████████████████████████████████████████████████████████████▍                                                                                | 4366/9741 [00:05<00:05, 957.56it/s] 46%|██████████████████████████████████████████████████████████████████▉                                                                               | 4463/9741 [00:05<00:05, 958.96it/s] 47%|████████████████████████████████████████████████████████████████████▎                                                                             | 4559/9741 [00:05<00:05, 919.80it/s] 48%|█████████████████████████████████████████████████████████████████████▊                                                                            | 4656/9741 [00:05<00:05, 933.14it/s] 49%|███████████████████████████████████████████████████████████████████████▏                                                                          | 4750/9741 [00:05<00:07, 677.16it/s] 50%|████████████████████████████████████████████████████████████████████████▋                                                                         | 4846/9741 [00:05<00:06, 742.21it/s] 51%|██████████████████████████████████████████████████████████████████████████                                                                        | 4941/9741 [00:05<00:06, 793.77it/s] 52%|███████████████████████████████████████████████████████████████████████████▍                                                                      | 5037/9741 [00:06<00:05, 836.25it/s] 53%|████████████████████████████████████████████████████████████████████████████▉                                                                     | 5134/9741 [00:06<00:05, 870.97it/s] 54%|██████████████████████████████████████████████████████████████████████████████▍                                                                   | 5230/9741 [00:06<00:05, 894.13it/s] 55%|███████████████████████████████████████████████████████████████████████████████▊                                                                  | 5327/9741 [00:06<00:04, 914.27it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▎                                                                | 5423/9741 [00:06<00:04, 925.20it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▊                                                               | 5522/9741 [00:06<00:04, 943.54it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▎                                                             | 5623/9741 [00:06<00:04, 961.95it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▊                                                            | 5723/9741 [00:06<00:04, 972.54it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▎                                                          | 5824/9741 [00:06<00:03, 983.02it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▊                                                         | 5924/9741 [00:07<00:03, 985.37it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▎                                                       | 6023/9741 [00:07<00:03, 980.45it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▊                                                      | 6122/9741 [00:07<00:03, 982.66it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▎                                                    | 6223/9741 [00:07<00:03, 988.42it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▊                                                   | 6322/9741 [00:07<00:03, 988.33it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▎                                                 | 6423/9741 [00:07<00:03, 993.01it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▊                                                | 6523/9741 [00:07<00:03, 994.79it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▎                                              | 6623/9741 [00:07<00:03, 993.52it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▊                                             | 6724/9741 [00:07<00:03, 996.56it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▎                                           | 6824/9741 [00:07<00:02, 995.74it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▊                                          | 6924/9741 [00:08<00:02, 996.64it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                        | 7024/9741 [00:08<00:02, 987.72it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                       | 7124/9741 [00:08<00:02, 989.64it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                     | 7223/9741 [00:08<00:02, 988.44it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                    | 7322/9741 [00:08<00:02, 983.93it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                  | 7422/9741 [00:08<00:02, 988.21it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 7521/9741 [00:08<00:02, 930.66it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                               | 7621/9741 [00:08<00:02, 950.35it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                              | 7721/9741 [00:08<00:02, 962.66it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                            | 7822/9741 [00:08<00:01, 974.55it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 7922/9741 [00:09<00:01, 980.69it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                         | 8022/9741 [00:09<00:01, 984.11it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                        | 8122/9741 [00:09<00:01, 983.85it/s] 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                      | 8223/9741 [00:09<00:01, 989.04it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                     | 8323/9741 [00:09<00:01, 992.13it/s] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 8423/9741 [00:09<00:01, 992.09it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 8524/9741 [00:09<00:01, 995.14it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                | 8624/9741 [00:09<00:01, 992.83it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊               | 8724/9741 [00:09<00:01, 994.69it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎             | 8824/9741 [00:09<00:00, 992.64it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊            | 8924/9741 [00:10<00:00, 993.38it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎          | 9024/9741 [00:10<00:00, 994.44it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 9124/9741 [00:10<00:00, 993.12it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎       | 9225/9741 [00:10<00:00, 995.24it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊      | 9325/9741 [00:10<00:00, 993.78it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎    | 9426/9741 [00:10<00:00, 996.52it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊   | 9526/9741 [00:10<00:00, 994.43it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎ | 9626/9741 [00:10<00:00, 967.32it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊| 9725/9741 [00:10<00:00, 973.75it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:10<00:00, 895.51it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.11s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.34s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.99s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.30s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.13s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.18s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:12<00:06,  6.38s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.51s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.91s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]
[2023-08-10 18:58:52,920] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.86s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.96s/it]
[2023-08-10 18:59:14,090] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 18:59:14,091] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 18:59:14,091] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7ff2b4ae6e80>
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 18:59:14,092] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7ff2b48f0af0>
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 18:59:14,093] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 18:59:14,094] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 18:59:14,094] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 18:59:14,094] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 18:59:14,094] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 18:59:14,094] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 18:59:14,094] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 18:59:14,094] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 18:59:14,094] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 18:59:14,094] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 18:59:14,094] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 18:59:14,094] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 18:59:14,094] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4338219165802002 seconds
Loading extension module utils...
Time to load utils op: 0.3042271137237549 seconds
Loading extension module utils...
Time to load utils op: 0.40294957160949707 seconds
Loading extension module utils...
Time to load utils op: 0.4058053493499756 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Rationales: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
#### 44
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Rationales: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
#### 6
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Rationales: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
#### 322
Answer: 322

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s1-rTrue
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:48<39:36, 48.50s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:35<38:14, 47.80s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:22<37:06, 47.38s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:09<36:16, 47.32s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:57<35:28, 47.30s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:44<34:42, 47.33s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:31<33:51, 47.23s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:18<33:04, 47.26s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:05<32:09, 47.05s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:35<27:47, 41.68s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:59<23:40, 36.43s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:47<25:19, 39.98s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:35<26:06, 42.33s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:22<26:19, 43.89s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:11<26:24, 45.26s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:58<25:54, 45.72s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:33<23:23, 42.52s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:20<23:27, 44.00s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:06<23:03, 44.64s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:54<22:49, 45.63s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:41<22:13, 45.99s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:29<21:40, 46.43s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:16<20:58, 46.61s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:03<20:14, 46.72s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:49<19:27, 46.72s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:36<18:40, 46.70s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:19<17:28, 45.59s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:07<16:57, 46.24s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [21:53<16:14, 46.40s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:41<15:32, 46.64s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [23:28<14:48, 46.79s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [24:15<14:06, 47.03s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [25:03<13:23, 47.29s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:51<12:38, 47.40s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:38<11:47, 47.17s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [27:25<10:59, 47.10s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [28:06<09:48, 45.28s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [28:53<09:09, 45.80s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:28<07:49, 42.72s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [30:15<07:18, 43.84s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [31:01<06:42, 44.73s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:47<06:00, 45.12s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [32:35<05:20, 45.76s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [33:07<04:10, 41.71s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:25<02:52, 34.55s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:12<02:33, 38.28s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [34:59<02:02, 40.84s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [35:46<01:25, 42.97s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [36:34<00:44, 44.27s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:20<00:00, 44.96s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:20<00:00, 44.82s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.2197} | lm_loss 7.7622 | avg. gen lenth: 280.82
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s1-rTrue --seed 1 --rationales --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[2023-08-10 19:36:54,006] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|▊                                                                                                                                                   | 52/9741 [00:00<00:18, 518.11it/s]  1%|█▌                                                                                                                                                 | 105/9741 [00:00<00:18, 520.24it/s]  2%|██▍                                                                                                                                                | 158/9741 [00:00<00:18, 522.29it/s]  2%|███▏                                                                                                                                               | 211/9741 [00:00<00:18, 518.99it/s]  3%|███▉                                                                                                                                               | 264/9741 [00:00<00:18, 519.92it/s]  3%|████▊                                                                                                                                              | 316/9741 [00:00<00:18, 519.64it/s]  4%|█████▌                                                                                                                                             | 369/9741 [00:00<00:18, 520.36it/s]  4%|██████▎                                                                                                                                            | 422/9741 [00:00<00:18, 513.82it/s]  5%|███████▏                                                                                                                                           | 474/9741 [00:00<00:18, 510.99it/s]  5%|███████▉                                                                                                                                           | 526/9741 [00:01<00:17, 513.68it/s]  6%|████████▋                                                                                                                                          | 578/9741 [00:01<00:17, 515.01it/s]  6%|█████████▌                                                                                                                                         | 630/9741 [00:01<00:17, 516.32it/s]  7%|██████████▎                                                                                                                                        | 682/9741 [00:01<00:17, 515.14it/s]  8%|███████████                                                                                                                                        | 735/9741 [00:01<00:17, 516.70it/s]  8%|███████████▉                                                                                                                                       | 788/9741 [00:01<00:17, 517.94it/s]  9%|████████████▋                                                                                                                                      | 841/9741 [00:01<00:17, 518.98it/s]  9%|█████████████▍                                                                                                                                     | 893/9741 [00:01<00:17, 517.53it/s] 10%|██████████████▎                                                                                                                                    | 945/9741 [00:01<00:17, 512.34it/s] 10%|███████████████                                                                                                                                    | 997/9741 [00:01<00:17, 513.59it/s] 11%|███████████████▋                                                                                                                                  | 1050/9741 [00:02<00:16, 515.92it/s] 11%|████████████████▌                                                                                                                                 | 1103/9741 [00:02<00:16, 517.91it/s] 12%|█████████████████▎                                                                                                                                | 1155/9741 [00:02<00:16, 516.62it/s] 12%|██████████████████                                                                                                                                | 1207/9741 [00:02<00:16, 517.48it/s] 13%|██████████████████▉                                                                                                                               | 1260/9741 [00:02<00:16, 518.43it/s] 14%|███████████████████▊                                                                                                                              | 1326/9741 [00:02<00:15, 560.43it/s] 14%|█████████████████████                                                                                                                             | 1404/9741 [00:02<00:13, 623.61it/s] 15%|██████████████████████▏                                                                                                                           | 1484/9741 [00:02<00:12, 673.98it/s] 16%|███████████████████████▍                                                                                                                          | 1562/9741 [00:02<00:11, 704.02it/s] 17%|████████████████████████▌                                                                                                                         | 1641/9741 [00:02<00:11, 729.38it/s] 18%|█████████████████████████▊                                                                                                                        | 1721/9741 [00:03<00:10, 748.05it/s] 18%|██████████████████████████▉                                                                                                                       | 1796/9741 [00:03<00:10, 729.53it/s] 19%|████████████████████████████                                                                                                                      | 1875/9741 [00:03<00:10, 747.03it/s] 20%|█████████████████████████████▎                                                                                                                    | 1955/9741 [00:03<00:10, 759.90it/s] 21%|██████████████████████████████▍                                                                                                                   | 2033/9741 [00:03<00:10, 765.77it/s] 22%|███████████████████████████████▋                                                                                                                  | 2112/9741 [00:03<00:09, 772.80it/s] 23%|████████████████████████████████▊                                                                                                                 | 2192/9741 [00:03<00:09, 778.86it/s] 23%|██████████████████████████████████                                                                                                                | 2270/9741 [00:03<00:09, 778.81it/s] 24%|███████████████████████████████████▏                                                                                                              | 2350/9741 [00:03<00:09, 782.68it/s] 25%|████████████████████████████████████▍                                                                                                             | 2429/9741 [00:03<00:09, 784.55it/s] 26%|█████████████████████████████████████▌                                                                                                            | 2508/9741 [00:04<00:09, 782.91it/s] 27%|██████████████████████████████████████▊                                                                                                           | 2587/9741 [00:04<00:09, 784.24it/s] 27%|███████████████████████████████████████▉                                                                                                          | 2667/9741 [00:04<00:08, 786.66it/s] 28%|█████████████████████████████████████████▏                                                                                                        | 2746/9741 [00:04<00:08, 783.62it/s] 29%|██████████████████████████████████████████▎                                                                                                       | 2825/9741 [00:04<00:08, 784.77it/s] 30%|███████████████████████████████████████████▌                                                                                                      | 2905/9741 [00:04<00:08, 787.05it/s] 31%|████████████████████████████████████████████▋                                                                                                     | 2984/9741 [00:04<00:08, 784.82it/s] 31%|█████████████████████████████████████████████▉                                                                                                    | 3063/9741 [00:04<00:08, 786.05it/s] 32%|███████████████████████████████████████████████                                                                                                   | 3142/9741 [00:04<00:08, 783.02it/s] 33%|████████████████████████████████████████████████▎                                                                                                 | 3221/9741 [00:04<00:08, 776.96it/s] 34%|█████████████████████████████████████████████████▍                                                                                                | 3301/9741 [00:05<00:08, 781.38it/s] 35%|██████████████████████████████████████████████████▋                                                                                               | 3380/9741 [00:05<00:08, 779.99it/s] 36%|███████████████████████████████████████████████████▊                                                                                              | 3459/9741 [00:05<00:08, 782.89it/s] 36%|█████████████████████████████████████████████████████                                                                                             | 3538/9741 [00:05<00:07, 783.96it/s] 37%|██████████████████████████████████████████████████████▏                                                                                           | 3617/9741 [00:05<00:07, 780.97it/s] 38%|███████████████████████████████████████████████████████▍                                                                                          | 3696/9741 [00:05<00:07, 782.59it/s] 39%|████████████████████████████████████████████████████████▌                                                                                         | 3775/9741 [00:05<00:07, 784.10it/s] 40%|█████████████████████████████████████████████████████████▊                                                                                        | 3854/9741 [00:05<00:07, 773.88it/s] 40%|██████████████████████████████████████████████████████████▉                                                                                       | 3933/9741 [00:05<00:07, 775.80it/s] 41%|████████████████████████████████████████████████████████████                                                                                      | 4011/9741 [00:05<00:07, 775.81it/s] 42%|█████████████████████████████████████████████████████████████▎                                                                                    | 4089/9741 [00:06<00:07, 772.55it/s] 43%|██████████████████████████████████████████████████████████████▍                                                                                   | 4168/9741 [00:06<00:07, 775.44it/s] 44%|███████████████████████████████████████████████████████████████▋                                                                                  | 4247/9741 [00:06<00:07, 778.45it/s] 44%|████████████████████████████████████████████████████████████████▊                                                                                 | 4325/9741 [00:06<00:06, 777.94it/s] 45%|██████████████████████████████████████████████████████████████████                                                                                | 4404/9741 [00:06<00:06, 780.52it/s] 46%|███████████████████████████████████████████████████████████████████▏                                                                              | 4483/9741 [00:06<00:06, 781.35it/s] 47%|████████████████████████████████████████████████████████████████████▍                                                                             | 4562/9741 [00:06<00:06, 741.80it/s] 48%|█████████████████████████████████████████████████████████████████████▌                                                                            | 4641/9741 [00:06<00:06, 754.22it/s] 48%|██████████████████████████████████████████████████████████████████████▋                                                                           | 4720/9741 [00:06<00:06, 762.81it/s] 49%|███████████████████████████████████████████████████████████████████████▉                                                                          | 4797/9741 [00:07<00:09, 543.08it/s] 50%|█████████████████████████████████████████████████████████████████████████                                                                         | 4876/9741 [00:07<00:08, 598.24it/s] 51%|██████████████████████████████████████████████████████████████████████████▎                                                                       | 4954/9741 [00:07<00:07, 642.18it/s] 52%|███████████████████████████████████████████████████████████████████████████▍                                                                      | 5033/9741 [00:07<00:06, 679.20it/s] 52%|████████████████████████████████████████████████████████████████████████████▌                                                                     | 5112/9741 [00:07<00:06, 707.94it/s] 53%|█████████████████████████████████████████████████████████████████████████████▊                                                                    | 5190/9741 [00:07<00:06, 727.35it/s] 54%|██████████████████████████████████████████████████████████████████████████████▉                                                                   | 5269/9741 [00:07<00:06, 743.82it/s] 55%|████████████████████████████████████████████████████████████████████████████████▏                                                                 | 5348/9741 [00:07<00:05, 756.21it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▎                                                                | 5426/9741 [00:07<00:05, 761.98it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▌                                                               | 5507/9741 [00:08<00:05, 773.51it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▊                                                              | 5588/9741 [00:08<00:05, 783.49it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▉                                                             | 5669/9741 [00:08<00:05, 788.51it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▏                                                           | 5749/9741 [00:08<00:05, 791.31it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▍                                                          | 5831/9741 [00:08<00:04, 799.56it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▌                                                         | 5912/9741 [00:08<00:04, 802.45it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▊                                                        | 5994/9741 [00:08<00:04, 807.37it/s] 62%|███████████████████████████████████████████████████████████████████████████████████████████                                                       | 6076/9741 [00:08<00:04, 811.04it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▎                                                     | 6158/9741 [00:08<00:04, 808.56it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▌                                                    | 6240/9741 [00:08<00:04, 810.78it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▊                                                   | 6322/9741 [00:09<00:04, 809.51it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▉                                                  | 6404/9741 [00:09<00:04, 812.44it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▏                                                | 6486/9741 [00:09<00:04, 812.31it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▍                                               | 6568/9741 [00:09<00:03, 809.54it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▋                                              | 6650/9741 [00:09<00:03, 811.81it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▉                                             | 6732/9741 [00:09<00:03, 813.12it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▏                                           | 6814/9741 [00:09<00:03, 804.11it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▎                                          | 6895/9741 [00:09<00:03, 803.25it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                         | 6977/9741 [00:09<00:03, 807.09it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                        | 7058/9741 [00:09<00:03, 806.36it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████                                       | 7140/9741 [00:10<00:03, 809.68it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                     | 7221/9741 [00:10<00:03, 808.88it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                    | 7303/9741 [00:10<00:03, 811.62it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                   | 7385/9741 [00:10<00:02, 809.88it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                  | 7466/9741 [00:10<00:03, 745.53it/s] 77%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                | 7548/9741 [00:10<00:02, 764.57it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                               | 7630/9741 [00:10<00:02, 779.47it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                              | 7711/9741 [00:10<00:02, 786.51it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                             | 7793/9741 [00:10<00:02, 794.36it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                            | 7875/9741 [00:11<00:02, 801.11it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                          | 7956/9741 [00:11<00:02, 802.94it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                         | 8038/9741 [00:11<00:02, 806.74it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                        | 8120/9741 [00:11<00:02, 807.05it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                       | 8202/9741 [00:11<00:01, 808.63it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                     | 8284/9741 [00:11<00:01, 809.84it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                    | 8366/9741 [00:11<00:01, 808.67it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                   | 8448/9741 [00:11<00:01, 810.97it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 8530/9741 [00:11<00:01, 812.29it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                 | 8612/9741 [00:11<00:01, 809.84it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎               | 8694/9741 [00:12<00:01, 811.59it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌              | 8776/9741 [00:12<00:01, 812.77it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 8858/9741 [00:12<00:01, 810.09it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉            | 8940/9741 [00:12<00:00, 809.61it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏          | 9022/9741 [00:12<00:00, 810.82it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍         | 9104/9741 [00:12<00:00, 805.39it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋        | 9185/9741 [00:12<00:00, 805.91it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉       | 9266/9741 [00:12<00:00, 805.57it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████      | 9348/9741 [00:12<00:00, 808.14it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎    | 9429/9741 [00:12<00:00, 808.37it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌   | 9510/9741 [00:13<00:00, 807.75it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊  | 9592/9741 [00:13<00:00, 809.36it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉ | 9674/9741 [00:13<00:00, 809.88it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:13<00:00, 731.86it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.00s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.70s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.61s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.62s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.86s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.60s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.46s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.54s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.35s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.83s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.05s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.82s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.01s/it]
[2023-08-10 19:37:59,864] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.04s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.18s/it]
[2023-08-10 19:38:10,590] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 19:38:10,591] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 19:38:10,592] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 19:38:10,592] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 19:38:10,592] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 19:38:10,592] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 19:38:10,592] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 19:38:10,592] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 19:38:10,592] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 19:38:10,592] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 19:38:10,592] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 19:38:10,592] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f8ad4e33e80>
[2023-08-10 19:38:10,592] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 19:38:10,592] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f8ad4cf0910>
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 19:38:10,593] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 19:38:10,594] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 19:38:10,594] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4487612247467041 seconds
Loading extension module utils...
Time to load utils op: 0.4043910503387451 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5048439502716064 seconds
Time to load utils op: 0.4045219421386719 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Rationales: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
#### 44
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Rationales: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
#### 6
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Rationales: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
#### 322
Answer: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Rationales: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
#### 3
Answer: 3

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s1-rTrue
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:46<37:35, 46.03s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:31<36:44, 45.92s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:16<35:37, 45.47s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:01<34:40, 45.23s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:47<34:00, 45.34s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:32<33:14, 45.32s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:17<32:18, 45.09s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:01<31:26, 44.92s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:45<30:33, 44.71s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:31<30:04, 45.12s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:17<29:24, 45.24s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:02<28:37, 45.21s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:47<27:50, 45.16s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:32<26:58, 44.97s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:16<26:10, 44.88s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [12:02<25:35, 45.18s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:48<25:00, 45.48s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:34<24:17, 45.54s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:19<23:28, 45.45s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:05<22:49, 45.65s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:50<21:51, 45.23s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:35<21:04, 45.15s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:21<20:25, 45.41s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:04<19:23, 44.76s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:50<18:47, 45.10s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:34<17:58, 44.93s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:20<17:20, 45.23s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:05<16:33, 45.15s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [21:52<15:57, 45.59s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:37<15:07, 45.37s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [23:21<14:18, 45.18s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [24:07<13:34, 45.25s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [24:52<12:49, 45.25s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:37<12:03, 45.20s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:15<10:46, 43.11s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [27:02<10:17, 44.13s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [27:47<09:38, 44.49s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [28:33<08:57, 44.82s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:18<08:14, 44.98s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [30:03<07:30, 45.02s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [30:45<06:36, 44.08s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:30<05:54, 44.34s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [32:13<05:08, 44.04s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [32:58<04:25, 44.32s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:44<03:43, 44.64s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:29<02:58, 44.74s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [35:14<02:15, 45.01s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [36:00<01:30, 45.07s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [36:46<00:45, 45.46s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:31<00:00, 45.41s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:31<00:00, 45.04s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.3141} | lm_loss 7.8004 | avg. gen lenth: 299.176
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s1-rTrue --seed 1 --rationales --num-out-domain 5
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 20:15:52,834] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 5
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  0%|▌                                                                                                                                                   | 38/9741 [00:00<00:25, 377.40it/s]  1%|█▏                                                                                                                                                  | 76/9741 [00:00<00:25, 378.38it/s]  1%|█▋                                                                                                                                                 | 114/9741 [00:00<00:25, 378.88it/s]  2%|██▎                                                                                                                                                | 152/9741 [00:00<00:25, 379.31it/s]  2%|██▊                                                                                                                                                | 190/9741 [00:00<00:25, 378.44it/s]  2%|███▍                                                                                                                                               | 228/9741 [00:00<00:25, 376.08it/s]  3%|████                                                                                                                                               | 266/9741 [00:00<00:25, 377.00it/s]  3%|████▌                                                                                                                                              | 304/9741 [00:00<00:25, 373.55it/s]  4%|█████▏                                                                                                                                             | 342/9741 [00:00<00:25, 374.59it/s]  4%|█████▋                                                                                                                                             | 380/9741 [00:01<00:24, 375.73it/s]  4%|██████▎                                                                                                                                            | 418/9741 [00:01<00:24, 376.36it/s]  5%|██████▉                                                                                                                                            | 456/9741 [00:01<00:24, 374.75it/s]  5%|███████▍                                                                                                                                           | 494/9741 [00:01<00:24, 375.27it/s]  5%|████████                                                                                                                                           | 532/9741 [00:01<00:24, 376.47it/s]  6%|████████▌                                                                                                                                          | 570/9741 [00:01<00:24, 376.66it/s]  6%|█████████▏                                                                                                                                         | 608/9741 [00:01<00:24, 377.07it/s]  7%|█████████▋                                                                                                                                         | 646/9741 [00:01<00:24, 377.35it/s]  7%|██████████▎                                                                                                                                        | 684/9741 [00:01<00:24, 372.12it/s]  7%|██████████▉                                                                                                                                        | 722/9741 [00:01<00:24, 373.52it/s]  8%|███████████▍                                                                                                                                       | 760/9741 [00:02<00:23, 374.82it/s]  8%|████████████                                                                                                                                       | 798/9741 [00:02<00:23, 375.98it/s]  9%|████████████▌                                                                                                                                      | 836/9741 [00:02<00:23, 376.83it/s]  9%|█████████████▏                                                                                                                                     | 874/9741 [00:02<00:23, 377.62it/s]  9%|█████████████▊                                                                                                                                     | 912/9741 [00:02<00:23, 375.49it/s] 10%|██████████████▎                                                                                                                                    | 950/9741 [00:02<00:23, 376.06it/s] 10%|██████████████▉                                                                                                                                    | 988/9741 [00:02<00:23, 376.48it/s] 11%|███████████████▍                                                                                                                                  | 1026/9741 [00:02<00:23, 376.53it/s] 11%|████████████████▏                                                                                                                                 | 1076/9741 [00:02<00:20, 412.97it/s] 12%|████████████████▉                                                                                                                                 | 1132/9741 [00:02<00:18, 456.64it/s] 12%|█████████████████▊                                                                                                                                | 1189/9741 [00:03<00:17, 490.04it/s] 13%|██████████████████▋                                                                                                                               | 1245/9741 [00:03<00:16, 510.12it/s] 13%|███████████████████▌                                                                                                                              | 1302/9741 [00:03<00:15, 527.48it/s] 14%|████████████████████▎                                                                                                                             | 1358/9741 [00:03<00:15, 536.38it/s] 15%|█████████████████████▏                                                                                                                            | 1415/9741 [00:03<00:15, 545.48it/s] 15%|██████████████████████                                                                                                                            | 1472/9741 [00:03<00:14, 552.23it/s] 16%|██████████████████████▉                                                                                                                           | 1529/9741 [00:03<00:14, 556.70it/s] 16%|███████████████████████▊                                                                                                                          | 1585/9741 [00:03<00:14, 557.45it/s] 17%|████████████████████████▌                                                                                                                         | 1642/9741 [00:03<00:14, 560.72it/s] 17%|█████████████████████████▍                                                                                                                        | 1699/9741 [00:03<00:14, 562.94it/s] 18%|██████████████████████████▎                                                                                                                       | 1756/9741 [00:04<00:14, 564.67it/s] 19%|███████████████████████████▏                                                                                                                      | 1813/9741 [00:04<00:14, 531.65it/s] 19%|████████████████████████████                                                                                                                      | 1870/9741 [00:04<00:14, 541.40it/s] 20%|████████████████████████████▉                                                                                                                     | 1927/9741 [00:04<00:14, 548.07it/s] 20%|█████████████████████████████▋                                                                                                                    | 1983/9741 [00:04<00:14, 548.09it/s] 21%|██████████████████████████████▌                                                                                                                   | 2038/9741 [00:04<00:14, 547.89it/s] 22%|███████████████████████████████▍                                                                                                                  | 2095/9741 [00:04<00:13, 552.21it/s] 22%|████████████████████████████████▎                                                                                                                 | 2152/9741 [00:04<00:13, 556.63it/s] 23%|█████████████████████████████████                                                                                                                 | 2209/9741 [00:04<00:13, 559.46it/s] 23%|█████████████████████████████████▉                                                                                                                | 2265/9741 [00:04<00:13, 558.58it/s] 24%|██████████████████████████████████▊                                                                                                               | 2322/9741 [00:05<00:13, 560.50it/s] 24%|███████████████████████████████████▋                                                                                                              | 2379/9741 [00:05<00:13, 562.53it/s] 25%|████████████████████████████████████▌                                                                                                             | 2436/9741 [00:05<00:12, 564.19it/s] 26%|█████████████████████████████████████▎                                                                                                            | 2493/9741 [00:05<00:12, 561.31it/s] 26%|██████████████████████████████████████▏                                                                                                           | 2550/9741 [00:05<00:12, 561.82it/s] 27%|███████████████████████████████████████                                                                                                           | 2607/9741 [00:05<00:12, 564.19it/s] 27%|███████████████████████████████████████▉                                                                                                          | 2664/9741 [00:05<00:12, 559.38it/s] 28%|████████████████████████████████████████▊                                                                                                         | 2720/9741 [00:05<00:12, 557.10it/s] 29%|█████████████████████████████████████████▌                                                                                                        | 2777/9741 [00:05<00:12, 558.88it/s] 29%|██████████████████████████████████████████▍                                                                                                       | 2834/9741 [00:05<00:12, 559.87it/s] 30%|███████████████████████████████████████████▎                                                                                                      | 2891/9741 [00:06<00:12, 562.04it/s] 30%|████████████████████████████████████████████▏                                                                                                     | 2948/9741 [00:06<00:12, 560.07it/s] 31%|█████████████████████████████████████████████                                                                                                     | 3005/9741 [00:06<00:11, 561.73it/s] 31%|█████████████████████████████████████████████▉                                                                                                    | 3062/9741 [00:06<00:11, 562.55it/s] 32%|██████████████████████████████████████████████▋                                                                                                   | 3119/9741 [00:06<00:11, 563.23it/s] 33%|███████████████████████████████████████████████▌                                                                                                  | 3176/9741 [00:06<00:11, 560.91it/s] 33%|████████████████████████████████████████████████▍                                                                                                 | 3233/9741 [00:06<00:11, 562.36it/s] 34%|█████████████████████████████████████████████████▎                                                                                                | 3290/9741 [00:06<00:11, 562.78it/s] 34%|██████████████████████████████████████████████████▏                                                                                               | 3347/9741 [00:06<00:11, 563.26it/s] 35%|███████████████████████████████████████████████████                                                                                               | 3404/9741 [00:06<00:11, 561.04it/s] 36%|███████████████████████████████████████████████████▊                                                                                              | 3461/9741 [00:07<00:11, 561.92it/s] 36%|████████████████████████████████████████████████████▋                                                                                             | 3518/9741 [00:07<00:11, 561.87it/s] 37%|█████████████████████████████████████████████████████▌                                                                                            | 3575/9741 [00:07<00:10, 562.58it/s] 37%|██████████████████████████████████████████████████████▍                                                                                           | 3632/9741 [00:07<00:10, 558.70it/s] 38%|███████████████████████████████████████████████████████▎                                                                                          | 3689/9741 [00:07<00:10, 560.11it/s] 38%|████████████████████████████████████████████████████████▏                                                                                         | 3746/9741 [00:07<00:10, 562.27it/s] 39%|█████████████████████████████████████████████████████████                                                                                         | 3803/9741 [00:07<00:10, 563.14it/s] 40%|█████████████████████████████████████████████████████████▊                                                                                        | 3860/9741 [00:07<00:10, 561.20it/s] 40%|██████████████████████████████████████████████████████████▋                                                                                       | 3917/9741 [00:07<00:10, 562.52it/s] 41%|███████████████████████████████████████████████████████████▌                                                                                      | 3974/9741 [00:08<00:10, 562.82it/s] 41%|████████████████████████████████████████████████████████████▍                                                                                     | 4031/9741 [00:08<00:10, 564.05it/s] 42%|█████████████████████████████████████████████████████████████▎                                                                                    | 4088/9741 [00:08<00:10, 561.78it/s] 43%|██████████████████████████████████████████████████████████████▏                                                                                   | 4145/9741 [00:08<00:09, 562.97it/s] 43%|██████████████████████████████████████████████████████████████▉                                                                                   | 4202/9741 [00:08<00:09, 563.59it/s] 44%|███████████████████████████████████████████████████████████████▊                                                                                  | 4259/9741 [00:08<00:09, 564.44it/s] 44%|████████████████████████████████████████████████████████████████▋                                                                                 | 4316/9741 [00:08<00:09, 561.89it/s] 45%|█████████████████████████████████████████████████████████████████▌                                                                                | 4373/9741 [00:08<00:09, 562.49it/s] 45%|██████████████████████████████████████████████████████████████████▍                                                                               | 4430/9741 [00:08<00:09, 562.78it/s] 46%|███████████████████████████████████████████████████████████████████▎                                                                              | 4487/9741 [00:08<00:09, 563.06it/s] 47%|████████████████████████████████████████████████████████████████████                                                                              | 4544/9741 [00:09<00:09, 525.90it/s] 47%|████████████████████████████████████████████████████████████████████▉                                                                             | 4601/9741 [00:09<00:09, 536.03it/s] 48%|█████████████████████████████████████████████████████████████████████▊                                                                            | 4658/9741 [00:09<00:09, 544.38it/s] 48%|██████████████████████████████████████████████████████████████████████▋                                                                           | 4715/9741 [00:09<00:09, 549.73it/s] 49%|███████████████████████████████████████████████████████████████████████▌                                                                          | 4771/9741 [00:09<00:11, 417.51it/s] 50%|████████████████████████████████████████████████████████████████████████▎                                                                         | 4828/9741 [00:09<00:10, 452.73it/s] 50%|█████████████████████████████████████████████████████████████████████████▏                                                                        | 4885/9741 [00:09<00:10, 480.94it/s] 51%|██████████████████████████████████████████████████████████████████████████                                                                        | 4942/9741 [00:09<00:09, 503.91it/s] 51%|██████████████████████████████████████████████████████████████████████████▉                                                                       | 4998/9741 [00:09<00:09, 518.43it/s] 52%|███████████████████████████████████████████████████████████████████████████▊                                                                      | 5055/9741 [00:10<00:08, 531.96it/s] 52%|████████████████████████████████████████████████████████████████████████████▌                                                                     | 5112/9741 [00:10<00:08, 540.88it/s] 53%|█████████████████████████████████████████████████████████████████████████████▍                                                                    | 5169/9741 [00:10<00:08, 544.71it/s] 54%|██████████████████████████████████████████████████████████████████████████████▎                                                                   | 5226/9741 [00:10<00:08, 549.89it/s] 54%|███████████████████████████████████████████████████████████████████████████████▏                                                                  | 5283/9741 [00:10<00:08, 553.28it/s] 55%|████████████████████████████████████████████████████████████████████████████████                                                                  | 5340/9741 [00:10<00:07, 556.16it/s] 55%|████████████████████████████████████████████████████████████████████████████████▉                                                                 | 5396/9741 [00:10<00:07, 555.40it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▋                                                                | 5453/9741 [00:10<00:07, 558.11it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▌                                                               | 5511/9741 [00:10<00:07, 563.87it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▍                                                              | 5570/9741 [00:10<00:07, 570.95it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▎                                                             | 5628/9741 [00:11<00:07, 572.00it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▏                                                            | 5687/9741 [00:11<00:07, 576.37it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████                                                            | 5746/9741 [00:11<00:06, 579.52it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████                                                           | 5805/9741 [00:11<00:06, 581.35it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▉                                                          | 5864/9741 [00:11<00:06, 579.71it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▊                                                         | 5923/9741 [00:11<00:06, 582.13it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▋                                                        | 5982/9741 [00:11<00:06, 584.14it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▌                                                       | 6041/9741 [00:11<00:06, 584.70it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▍                                                      | 6100/9741 [00:11<00:06, 582.29it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▎                                                     | 6159/9741 [00:11<00:06, 582.36it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▏                                                    | 6218/9741 [00:12<00:06, 584.31it/s] 64%|██████████████████████████████████████████████████████████████████████████████████████████████                                                    | 6277/9741 [00:12<00:05, 583.31it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▉                                                   | 6336/9741 [00:12<00:05, 581.50it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▊                                                  | 6395/9741 [00:12<00:05, 582.87it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▋                                                 | 6454/9741 [00:12<00:05, 578.41it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▌                                                | 6513/9741 [00:12<00:05, 579.29it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▍                                               | 6571/9741 [00:12<00:05, 577.67it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▎                                              | 6630/9741 [00:12<00:05, 580.09it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▎                                             | 6689/9741 [00:12<00:05, 581.64it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████▏                                            | 6748/9741 [00:12<00:05, 582.16it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████                                            | 6807/9741 [00:13<00:05, 580.43it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▉                                           | 6866/9741 [00:13<00:04, 581.71it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▊                                          | 6925/9741 [00:13<00:04, 582.86it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                         | 6984/9741 [00:13<00:04, 583.53it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                        | 7043/9741 [00:13<00:04, 581.15it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                       | 7102/9741 [00:13<00:04, 582.72it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                      | 7161/9741 [00:13<00:04, 583.10it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                     | 7220/9741 [00:13<00:04, 579.53it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████                                     | 7279/9741 [00:13<00:04, 579.73it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                    | 7338/9741 [00:14<00:04, 581.43it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                   | 7397/9741 [00:14<00:04, 582.91it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                  | 7456/9741 [00:14<00:04, 539.40it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 7515/9741 [00:14<00:04, 551.34it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                | 7574/9741 [00:14<00:03, 560.52it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                               | 7633/9741 [00:14<00:03, 567.11it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                              | 7691/9741 [00:14<00:03, 568.63it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                             | 7750/9741 [00:14<00:03, 573.90it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                             | 7809/9741 [00:14<00:03, 577.02it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                            | 7868/9741 [00:14<00:03, 579.03it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                           | 7926/9741 [00:15<00:03, 577.63it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                          | 7984/9741 [00:15<00:03, 578.31it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                         | 8043/9741 [00:15<00:02, 579.21it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                        | 8102/9741 [00:15<00:02, 580.58it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                       | 8161/9741 [00:15<00:02, 578.98it/s] 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                      | 8220/9741 [00:15<00:02, 580.71it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                      | 8279/9741 [00:15<00:02, 581.22it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                     | 8338/9741 [00:15<00:02, 580.97it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                    | 8397/9741 [00:15<00:02, 572.72it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 8456/9741 [00:15<00:02, 575.31it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 8515/9741 [00:16<00:02, 577.86it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                 | 8573/9741 [00:16<00:02, 575.21it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                | 8631/9741 [00:16<00:01, 573.52it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏               | 8690/9741 [00:16<00:01, 575.75it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏              | 8749/9741 [00:16<00:01, 577.47it/s] 90%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████              | 8807/9741 [00:16<00:01, 576.07it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉             | 8866/9741 [00:16<00:01, 578.17it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊            | 8925/9741 [00:16<00:01, 580.70it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋           | 8984/9741 [00:16<00:01, 581.54it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌          | 9043/9741 [00:16<00:01, 579.12it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍         | 9102/9741 [00:17<00:01, 580.58it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎        | 9161/9741 [00:17<00:00, 581.59it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏       | 9220/9741 [00:17<00:00, 582.41it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████       | 9279/9741 [00:17<00:00, 580.13it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉      | 9338/9741 [00:17<00:00, 581.16it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊     | 9397/9741 [00:17<00:00, 575.70it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋    | 9456/9741 [00:17<00:00, 577.27it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌   | 9514/9741 [00:17<00:00, 576.33it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍  | 9573/9741 [00:17<00:00, 578.85it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎ | 9632/9741 [00:17<00:00, 579.87it/s] 99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏| 9690/9741 [00:18<00:00, 579.81it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:18<00:00, 535.70it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.06s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.13s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.35s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.41s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.04s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.17s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.34s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.64s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.40s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.58s/it]
[2023-08-10 20:17:02,416] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.87s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
[2023-08-10 20:17:11,466] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 20:17:11,467] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 20:17:11,467] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 20:17:11,467] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 20:17:11,467] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 20:17:11,467] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fac673b7e80>
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 20:17:11,468] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fac6712a910>
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 20:17:11,469] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 20:17:11,469] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4667997360229492 seconds
Loading extension module utils...
Time to load utils op: 0.5047461986541748 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]Time to load utils op: 0.4043745994567871 seconds
############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Rationales: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
#### 44
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Rationales: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
#### 6
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Rationales: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
#### 322
Answer: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Rationales: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
#### 3
Answer: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Rationales: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
#### 27
Answer: 27

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.5046038627624512 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:42<35:04, 42.95s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:25<34:13, 42.78s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:07<33:18, 42.52s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:49<32:28, 42.35s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:32<31:51, 42.47s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:13<30:45, 41.95s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:56<30:16, 42.24s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:39<29:41, 42.41s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:21<29:00, 42.45s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [06:51<25:38, 38.46s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:17<22:30, 34.62s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [07:59<23:28, 37.06s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [08:42<23:57, 38.84s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:08<20:59, 34.98s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [09:51<21:45, 37.31s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [10:33<21:58, 38.79s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:15<21:52, 39.77s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [11:58<21:43, 40.73s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [12:41<21:19, 41.27s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [13:23<20:51, 41.71s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [14:06<20:15, 41.92s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [14:48<19:37, 42.05s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [15:31<18:58, 42.16s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [16:14<18:24, 42.48s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [16:57<17:43, 42.56s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [17:39<16:57, 42.38s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:21<16:16, 42.46s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:03<15:32, 42.38s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [19:46<14:50, 42.42s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [20:29<14:12, 42.61s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [21:12<13:31, 42.71s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [21:26<10:15, 34.20s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [22:09<10:25, 36.81s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [22:52<10:16, 38.53s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [23:34<09:55, 39.70s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [24:17<09:28, 40.62s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [24:59<08:54, 41.15s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [25:42<08:20, 41.70s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [26:25<07:40, 41.88s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [27:07<07:00, 42.04s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [27:50<06:21, 42.34s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [28:33<05:39, 42.38s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [29:15<04:55, 42.27s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [29:57<04:13, 42.23s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [30:39<03:31, 42.24s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [31:21<02:48, 42.22s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [32:04<02:07, 42.55s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [32:47<01:25, 42.59s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [33:26<00:41, 41.49s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:08<00:00, 41.77s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:08<00:00, 40.98s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.5658} | lm_loss 7.7499 | avg. gen lenth: 295.6
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s1-rTrue --seed 1 --rationales --num-out-domain 6
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 20:51:26,350] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 6
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o6-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  0%|▍                                                                                                                                                   | 32/9741 [00:00<00:31, 310.14it/s]  1%|▉                                                                                                                                                   | 64/9741 [00:00<00:31, 311.30it/s]  1%|█▍                                                                                                                                                  | 96/9741 [00:00<00:30, 311.96it/s]  1%|█▉                                                                                                                                                 | 128/9741 [00:00<00:30, 311.86it/s]  2%|██▍                                                                                                                                                | 160/9741 [00:00<00:30, 312.22it/s]  2%|██▉                                                                                                                                                | 192/9741 [00:00<00:30, 312.17it/s]  2%|███▍                                                                                                                                               | 224/9741 [00:00<00:31, 305.50it/s]  3%|███▊                                                                                                                                               | 256/9741 [00:00<00:30, 307.16it/s]  3%|████▎                                                                                                                                              | 288/9741 [00:00<00:30, 308.62it/s]  3%|████▊                                                                                                                                              | 320/9741 [00:01<00:30, 309.45it/s]  4%|█████▎                                                                                                                                             | 352/9741 [00:01<00:30, 310.08it/s]  4%|█████▊                                                                                                                                             | 384/9741 [00:01<00:30, 310.84it/s]  4%|██████▎                                                                                                                                            | 416/9741 [00:01<00:29, 311.22it/s]  5%|██████▉                                                                                                                                            | 458/9741 [00:01<00:27, 342.53it/s]  5%|███████▌                                                                                                                                           | 505/9741 [00:01<00:24, 379.94it/s]  6%|████████▎                                                                                                                                          | 552/9741 [00:01<00:22, 406.53it/s]  6%|█████████                                                                                                                                          | 598/9741 [00:01<00:21, 421.11it/s]  7%|█████████▋                                                                                                                                         | 645/9741 [00:01<00:20, 434.91it/s]  7%|██████████▍                                                                                                                                        | 691/9741 [00:01<00:20, 441.81it/s]  8%|███████████▏                                                                                                                                       | 738/9741 [00:02<00:20, 448.19it/s]  8%|███████████▊                                                                                                                                       | 786/9741 [00:02<00:19, 455.74it/s]  9%|████████████▌                                                                                                                                      | 834/9741 [00:02<00:19, 460.64it/s]  9%|█████████████▎                                                                                                                                     | 881/9741 [00:02<00:19, 461.42it/s] 10%|██████████████                                                                                                                                     | 929/9741 [00:02<00:18, 464.75it/s] 10%|██████████████▋                                                                                                                                    | 976/9741 [00:02<00:18, 466.15it/s] 11%|███████████████▎                                                                                                                                  | 1023/9741 [00:02<00:18, 464.92it/s] 11%|████████████████                                                                                                                                  | 1070/9741 [00:02<00:18, 464.95it/s] 11%|████████████████▋                                                                                                                                 | 1117/9741 [00:02<00:18, 463.84it/s] 12%|█████████████████▍                                                                                                                                | 1165/9741 [00:02<00:18, 465.94it/s] 12%|██████████████████▏                                                                                                                               | 1212/9741 [00:03<00:18, 465.40it/s] 13%|██████████████████▊                                                                                                                               | 1259/9741 [00:03<00:18, 466.68it/s] 13%|███████████████████▌                                                                                                                              | 1306/9741 [00:03<00:18, 467.65it/s] 14%|████████████████████▎                                                                                                                             | 1353/9741 [00:03<00:18, 464.89it/s] 14%|████████████████████▉                                                                                                                             | 1400/9741 [00:03<00:17, 465.88it/s] 15%|█████████████████████▋                                                                                                                            | 1447/9741 [00:03<00:17, 466.64it/s] 15%|██████████████████████▍                                                                                                                           | 1494/9741 [00:03<00:17, 466.40it/s] 16%|███████████████████████                                                                                                                           | 1541/9741 [00:03<00:17, 466.10it/s] 16%|███████████████████████▊                                                                                                                          | 1588/9741 [00:03<00:17, 464.51it/s] 17%|████████████████████████▌                                                                                                                         | 1635/9741 [00:03<00:17, 465.29it/s] 17%|█████████████████████████▏                                                                                                                        | 1683/9741 [00:04<00:17, 466.90it/s] 18%|█████████████████████████▉                                                                                                                        | 1730/9741 [00:04<00:17, 467.28it/s] 18%|██████████████████████████▋                                                                                                                       | 1778/9741 [00:04<00:17, 468.17it/s] 19%|███████████████████████████▎                                                                                                                      | 1825/9741 [00:04<00:18, 437.08it/s] 19%|████████████████████████████                                                                                                                      | 1872/9741 [00:04<00:17, 445.99it/s] 20%|████████████████████████████▊                                                                                                                     | 1919/9741 [00:04<00:17, 452.63it/s] 20%|█████████████████████████████▍                                                                                                                    | 1966/9741 [00:04<00:17, 456.97it/s] 21%|██████████████████████████████▏                                                                                                                   | 2013/9741 [00:04<00:16, 460.40it/s] 21%|██████████████████████████████▉                                                                                                                   | 2060/9741 [00:04<00:16, 459.54it/s] 22%|███████████████████████████████▌                                                                                                                  | 2107/9741 [00:05<00:16, 461.55it/s] 22%|████████████████████████████████▎                                                                                                                 | 2154/9741 [00:05<00:16, 463.55it/s] 23%|████████████████████████████████▉                                                                                                                 | 2201/9741 [00:05<00:16, 465.28it/s] 23%|█████████████████████████████████▋                                                                                                                | 2248/9741 [00:05<00:16, 463.01it/s] 24%|██████████████████████████████████▍                                                                                                               | 2295/9741 [00:05<00:16, 464.97it/s] 24%|███████████████████████████████████                                                                                                               | 2342/9741 [00:05<00:15, 465.83it/s] 25%|███████████████████████████████████▊                                                                                                              | 2390/9741 [00:05<00:15, 467.51it/s] 25%|████████████████████████████████████▌                                                                                                             | 2437/9741 [00:05<00:15, 463.17it/s] 26%|█████████████████████████████████████▏                                                                                                            | 2484/9741 [00:05<00:15, 459.97it/s] 26%|█████████████████████████████████████▉                                                                                                            | 2531/9741 [00:05<00:15, 459.86it/s] 26%|██████████████████████████████████████▋                                                                                                           | 2578/9741 [00:06<00:15, 462.21it/s] 27%|███████████████████████████████████████▎                                                                                                          | 2625/9741 [00:06<00:15, 463.87it/s] 27%|████████████████████████████████████████                                                                                                          | 2672/9741 [00:06<00:15, 464.80it/s] 28%|████████████████████████████████████████▊                                                                                                         | 2719/9741 [00:06<00:15, 462.28it/s] 28%|█████████████████████████████████████████▍                                                                                                        | 2766/9741 [00:06<00:15, 463.47it/s] 29%|██████████████████████████████████████████▏                                                                                                       | 2813/9741 [00:06<00:14, 464.34it/s] 29%|██████████████████████████████████████████▉                                                                                                       | 2861/9741 [00:06<00:14, 466.42it/s] 30%|███████████████████████████████████████████▌                                                                                                      | 2908/9741 [00:06<00:14, 467.21it/s] 30%|████████████████████████████████████████████▎                                                                                                     | 2955/9741 [00:06<00:14, 464.32it/s] 31%|████████████████████████████████████████████▉                                                                                                     | 3002/9741 [00:06<00:14, 465.90it/s] 31%|█████████████████████████████████████████████▋                                                                                                    | 3049/9741 [00:07<00:14, 465.19it/s] 32%|██████████████████████████████████████████████▍                                                                                                   | 3096/9741 [00:07<00:14, 464.91it/s] 32%|███████████████████████████████████████████████                                                                                                   | 3143/9741 [00:07<00:14, 465.63it/s] 33%|███████████████████████████████████████████████▊                                                                                                  | 3190/9741 [00:07<00:14, 462.92it/s] 33%|████████████████████████████████████████████████▌                                                                                                 | 3237/9741 [00:07<00:14, 463.94it/s] 34%|█████████████████████████████████████████████████▏                                                                                                | 3284/9741 [00:07<00:13, 464.45it/s] 34%|█████████████████████████████████████████████████▉                                                                                                | 3331/9741 [00:07<00:13, 464.52it/s] 35%|██████████████████████████████████████████████████▋                                                                                               | 3378/9741 [00:07<00:13, 462.47it/s] 35%|███████████████████████████████████████████████████▎                                                                                              | 3425/9741 [00:07<00:13, 463.94it/s] 36%|████████████████████████████████████████████████████                                                                                              | 3472/9741 [00:07<00:13, 463.61it/s] 36%|████████████████████████████████████████████████████▋                                                                                             | 3519/9741 [00:08<00:13, 463.90it/s] 37%|█████████████████████████████████████████████████████▍                                                                                            | 3566/9741 [00:08<00:13, 463.79it/s] 37%|██████████████████████████████████████████████████████▏                                                                                           | 3613/9741 [00:08<00:13, 461.33it/s] 38%|██████████████████████████████████████████████████████▊                                                                                           | 3660/9741 [00:08<00:13, 462.55it/s] 38%|███████████████████████████████████████████████████████▌                                                                                          | 3707/9741 [00:08<00:13, 463.79it/s] 39%|████████████████████████████████████████████████████████▎                                                                                         | 3754/9741 [00:08<00:12, 464.73it/s] 39%|████████████████████████████████████████████████████████▉                                                                                         | 3801/9741 [00:08<00:12, 463.66it/s] 40%|█████████████████████████████████████████████████████████▋                                                                                        | 3848/9741 [00:08<00:12, 461.46it/s] 40%|██████████████████████████████████████████████████████████▍                                                                                       | 3895/9741 [00:08<00:12, 463.33it/s] 40%|███████████████████████████████████████████████████████████                                                                                       | 3942/9741 [00:08<00:12, 464.37it/s] 41%|███████████████████████████████████████████████████████████▊                                                                                      | 3989/9741 [00:09<00:12, 464.77it/s] 41%|████████████████████████████████████████████████████████████▍                                                                                     | 4036/9741 [00:09<00:12, 463.63it/s] 42%|█████████████████████████████████████████████████████████████▏                                                                                    | 4083/9741 [00:09<00:12, 461.65it/s] 42%|█████████████████████████████████████████████████████████████▉                                                                                    | 4130/9741 [00:09<00:12, 463.00it/s] 43%|██████████████████████████████████████████████████████████████▌                                                                                   | 4177/9741 [00:09<00:11, 463.84it/s] 43%|███████████████████████████████████████████████████████████████▎                                                                                  | 4224/9741 [00:09<00:11, 464.54it/s] 44%|████████████████████████████████████████████████████████████████                                                                                  | 4271/9741 [00:09<00:11, 465.15it/s] 44%|████████████████████████████████████████████████████████████████▋                                                                                 | 4318/9741 [00:09<00:11, 462.60it/s] 45%|█████████████████████████████████████████████████████████████████▍                                                                                | 4365/9741 [00:09<00:11, 463.94it/s] 45%|██████████████████████████████████████████████████████████████████▏                                                                               | 4412/9741 [00:09<00:11, 463.91it/s] 46%|██████████████████████████████████████████████████████████████████▊                                                                               | 4459/9741 [00:10<00:11, 463.47it/s] 46%|███████████████████████████████████████████████████████████████████▌                                                                              | 4506/9741 [00:10<00:11, 463.93it/s] 47%|████████████████████████████████████████████████████████████████████▏                                                                             | 4553/9741 [00:10<00:12, 423.98it/s] 47%|████████████████████████████████████████████████████████████████████▉                                                                             | 4600/9741 [00:10<00:11, 435.81it/s] 48%|█████████████████████████████████████████████████████████████████████▋                                                                            | 4647/9741 [00:10<00:11, 444.95it/s] 48%|██████████████████████████████████████████████████████████████████████▎                                                                           | 4694/9741 [00:10<00:11, 451.12it/s] 49%|███████████████████████████████████████████████████████████████████████                                                                           | 4740/9741 [00:10<00:16, 311.51it/s] 49%|███████████████████████████████████████████████████████████████████████▋                                                                          | 4787/9741 [00:10<00:14, 346.03it/s] 50%|████████████████████████████████████████████████████████████████████████▍                                                                         | 4834/9741 [00:11<00:13, 375.39it/s] 50%|█████████████████████████████████████████████████████████████████████████▏                                                                        | 4881/9741 [00:11<00:12, 397.99it/s] 51%|█████████████████████████████████████████████████████████████████████████▊                                                                        | 4928/9741 [00:11<00:11, 415.36it/s] 51%|██████████████████████████████████████████████████████████████████████████▌                                                                       | 4974/9741 [00:11<00:11, 425.72it/s] 52%|███████████████████████████████████████████████████████████████████████████▎                                                                      | 5021/9741 [00:11<00:10, 437.01it/s] 52%|███████████████████████████████████████████████████████████████████████████▉                                                                      | 5068/9741 [00:11<00:10, 446.04it/s] 53%|████████████████████████████████████████████████████████████████████████████▋                                                                     | 5115/9741 [00:11<00:10, 452.18it/s] 53%|█████████████████████████████████████████████████████████████████████████████▎                                                                    | 5162/9741 [00:11<00:10, 456.59it/s] 53%|██████████████████████████████████████████████████████████████████████████████                                                                    | 5209/9741 [00:11<00:09, 456.71it/s] 54%|██████████████████████████████████████████████████████████████████████████████▊                                                                   | 5256/9741 [00:11<00:09, 458.81it/s] 54%|███████████████████████████████████████████████████████████████████████████████▍                                                                  | 5303/9741 [00:12<00:09, 460.37it/s] 55%|████████████████████████████████████████████████████████████████████████████████▏                                                                 | 5350/9741 [00:12<00:09, 461.68it/s] 55%|████████████████████████████████████████████████████████████████████████████████▉                                                                 | 5397/9741 [00:12<00:09, 458.64it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▌                                                                | 5443/9741 [00:12<00:09, 458.95it/s] 56%|██████████████████████████████████████████████████████████████████████████████████▎                                                               | 5490/9741 [00:12<00:09, 460.33it/s] 57%|███████████████████████████████████████████████████████████████████████████████████                                                               | 5538/9741 [00:12<00:09, 465.07it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▋                                                              | 5587/9741 [00:12<00:08, 469.85it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▍                                                             | 5635/9741 [00:12<00:08, 470.21it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▏                                                            | 5684/9741 [00:12<00:08, 474.03it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▉                                                            | 5733/9741 [00:12<00:08, 476.83it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▋                                                           | 5782/9741 [00:13<00:08, 478.12it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▍                                                          | 5831/9741 [00:13<00:08, 479.06it/s] 60%|████████████████████████████████████████████████████████████████████████████████████████                                                          | 5879/9741 [00:13<00:08, 476.66it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▊                                                         | 5928/9741 [00:13<00:07, 478.43it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▌                                                        | 5977/9741 [00:13<00:07, 479.88it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▎                                                       | 6026/9741 [00:13<00:07, 480.33it/s] 62%|███████████████████████████████████████████████████████████████████████████████████████████                                                       | 6075/9741 [00:13<00:07, 480.61it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▊                                                      | 6124/9741 [00:13<00:07, 475.99it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▌                                                     | 6173/9741 [00:13<00:07, 477.95it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▏                                                    | 6221/9741 [00:14<00:07, 477.57it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▉                                                    | 6269/9741 [00:14<00:07, 477.72it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▋                                                   | 6317/9741 [00:14<00:07, 476.15it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▍                                                  | 6366/9741 [00:14<00:07, 477.37it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▏                                                 | 6415/9741 [00:14<00:06, 478.65it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▊                                                 | 6463/9741 [00:14<00:06, 478.96it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▌                                                | 6512/9741 [00:14<00:06, 479.58it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▎                                               | 6560/9741 [00:14<00:06, 476.90it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████                                               | 6609/9741 [00:14<00:06, 478.19it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▊                                              | 6658/9741 [00:14<00:06, 479.22it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▌                                             | 6707/9741 [00:15<00:06, 479.62it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████▎                                            | 6756/9741 [00:15<00:06, 480.72it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▉                                            | 6805/9741 [00:15<00:06, 478.17it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▋                                           | 6854/9741 [00:15<00:06, 479.46it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▍                                          | 6902/9741 [00:15<00:05, 475.32it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                         | 6950/9741 [00:15<00:05, 475.85it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                         | 6998/9741 [00:15<00:05, 474.70it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                        | 7046/9741 [00:15<00:05, 476.03it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                       | 7095/9741 [00:15<00:05, 477.41it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████                                       | 7144/9741 [00:15<00:05, 478.70it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                      | 7192/9741 [00:16<00:05, 477.65it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                     | 7240/9741 [00:16<00:05, 475.66it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                    | 7289/9741 [00:16<00:05, 477.30it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                    | 7338/9741 [00:16<00:05, 478.59it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                   | 7387/9741 [00:16<00:04, 480.08it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                  | 7436/9741 [00:16<00:04, 480.40it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 7485/9741 [00:16<00:05, 445.31it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                 | 7533/9741 [00:16<00:04, 453.95it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                | 7582/9741 [00:16<00:04, 461.76it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                               | 7631/9741 [00:16<00:04, 467.26it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████                               | 7678/9741 [00:17<00:04, 467.62it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                              | 7725/9741 [00:17<00:04, 467.00it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                             | 7774/9741 [00:17<00:04, 471.19it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                            | 7823/9741 [00:17<00:04, 474.05it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                            | 7871/9741 [00:17<00:03, 475.29it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 7919/9741 [00:17<00:03, 473.09it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                          | 7968/9741 [00:17<00:03, 475.71it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                         | 8017/9741 [00:17<00:03, 477.20it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                         | 8066/9741 [00:17<00:03, 478.39it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                        | 8114/9741 [00:18<00:03, 478.33it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                       | 8162/9741 [00:18<00:03, 476.21it/s] 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                       | 8211/9741 [00:18<00:03, 477.81it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                      | 8260/9741 [00:18<00:03, 478.97it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                     | 8308/9741 [00:18<00:02, 479.14it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                    | 8356/9741 [00:18<00:02, 476.82it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                    | 8405/9741 [00:18<00:02, 477.93it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 8454/9741 [00:18<00:02, 478.85it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                  | 8503/9741 [00:18<00:02, 479.33it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                 | 8551/9741 [00:18<00:02, 474.25it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                 | 8599/9741 [00:19<00:02, 472.07it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                | 8647/9741 [00:19<00:02, 473.77it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎               | 8696/9741 [00:19<00:02, 475.84it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 8745/9741 [00:19<00:02, 477.62it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊              | 8793/9741 [00:19<00:01, 478.32it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌             | 8841/9741 [00:19<00:01, 475.65it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏            | 8889/9741 [00:19<00:01, 476.89it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉            | 8938/9741 [00:19<00:01, 477.93it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋           | 8986/9741 [00:19<00:01, 478.45it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍          | 9034/9741 [00:19<00:01, 475.78it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 9082/9741 [00:20<00:01, 476.09it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 9130/9741 [00:20<00:01, 476.52it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌        | 9179/9741 [00:20<00:01, 477.73it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎       | 9227/9741 [00:20<00:01, 478.30it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████       | 9275/9741 [00:20<00:00, 476.46it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋      | 9323/9741 [00:20<00:00, 472.95it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍     | 9371/9741 [00:20<00:00, 474.64it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏    | 9420/9741 [00:20<00:00, 476.79it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉    | 9468/9741 [00:20<00:00, 477.27it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋   | 9516/9741 [00:20<00:00, 475.45it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎  | 9565/9741 [00:21<00:00, 476.95it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████  | 9613/9741 [00:21<00:00, 477.24it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊ | 9661/9741 [00:21<00:00, 477.63it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌| 9709/9741 [00:21<00:00, 475.59it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:21<00:00, 454.88it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.97s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.28s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.32s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.46s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.85s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.40s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.25s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.42s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
[2023-08-10 20:52:40,984] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-10 20:52:50,486] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 20:52:50,487] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f2913befe80>
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 20:52:50,488] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f29130f1910>
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 20:52:50,489] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 20:52:50,489] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4683992862701416 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]Time to load utils op: 0.4045746326446533 seconds
############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Rationales: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
#### 44
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Rationales: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
#### 6
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Rationales: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
#### 322
Answer: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Rationales: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
#### 3
Answer: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Rationales: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
#### 27
Answer: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Rationales: Max finished history in 20 * 2 = <<20*2=40>>40 minutes.
Finishing geography took the most time, which is 40 * 3 = <<40*3=120>>120 minutes.
In total, for all three subjects, Max needed 20 + 40 + 120 = <<20+40+120=180>>180 minutes.
#### 180
Answer: 180

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o6-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.40445470809936523 seconds
Loading extension module utils...
Time to load utils op: 0.5048122406005859 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:42<34:37, 42.41s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:24<33:42, 42.13s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:05<32:44, 41.80s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:47<31:59, 41.72s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:29<31:19, 41.76s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:10<30:34, 41.68s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:52<29:55, 41.76s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:34<29:11, 41.70s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:15<28:28, 41.67s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [06:57<27:46, 41.66s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:39<27:07, 41.72s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:20<26:22, 41.65s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:02<25:41, 41.67s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:42<24:41, 41.16s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:23<24:01, 41.19s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:05<23:26, 41.36s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:47<22:50, 41.53s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [12:25<21:30, 40.34s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [13:06<21:01, 40.68s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [13:47<20:27, 40.92s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [14:29<19:53, 41.14s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [15:11<19:20, 41.45s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [15:53<18:37, 41.40s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [16:34<18:00, 41.56s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [17:16<17:22, 41.69s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [17:56<16:27, 41.14s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:38<15:50, 41.32s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:20<15:15, 41.63s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:02<14:35, 41.70s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [20:44<13:54, 41.74s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [21:26<13:15, 41.88s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:09<12:37, 42.07s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [22:51<11:53, 41.95s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [23:32<11:10, 41.89s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:14<10:27, 41.82s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [24:42<08:48, 37.76s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [25:24<08:26, 38.98s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:06<07:58, 39.85s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [26:48<07:24, 40.41s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [27:29<06:46, 40.65s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [28:11<06:09, 41.08s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [28:53<05:30, 41.34s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [29:35<04:50, 41.44s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [30:16<04:09, 41.54s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [30:58<03:28, 41.64s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [31:41<02:47, 41.86s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [32:23<02:05, 41.93s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [33:05<01:24, 42.15s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [33:47<00:41, 42.00s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:29<00:00, 41.90s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:29<00:00, 41.38s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.3346} | lm_loss 7.7025 | avg. gen lenth: 335.664
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s1-rTrue --seed 1 --rationales --num-out-domain 7
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 21:27:30,070] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 7
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o7-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  0%|▍                                                                                                                                                   | 27/9741 [00:00<00:36, 268.59it/s]  1%|▊                                                                                                                                                   | 54/9741 [00:00<00:36, 268.87it/s]  1%|█▏                                                                                                                                                  | 81/9741 [00:00<00:35, 269.13it/s]  1%|█▋                                                                                                                                                 | 109/9741 [00:00<00:35, 270.02it/s]  1%|██                                                                                                                                                 | 137/9741 [00:00<00:35, 270.24it/s]  2%|██▍                                                                                                                                                | 165/9741 [00:00<00:35, 270.48it/s]  2%|██▉                                                                                                                                                | 193/9741 [00:00<00:35, 266.19it/s]  2%|███▎                                                                                                                                               | 220/9741 [00:00<00:36, 264.34it/s]  3%|███▋                                                                                                                                               | 247/9741 [00:00<00:35, 265.63it/s]  3%|████▏                                                                                                                                              | 274/9741 [00:01<00:35, 266.84it/s]  3%|████▌                                                                                                                                              | 301/9741 [00:01<00:35, 267.16it/s]  3%|████▉                                                                                                                                              | 328/9741 [00:01<00:35, 267.44it/s]  4%|█████▎                                                                                                                                             | 355/9741 [00:01<00:35, 267.70it/s]  4%|█████▊                                                                                                                                             | 383/9741 [00:01<00:34, 268.40it/s]  4%|██████▏                                                                                                                                            | 410/9741 [00:01<00:34, 268.68it/s]  4%|██████▌                                                                                                                                            | 437/9741 [00:01<00:34, 266.78it/s]  5%|███████                                                                                                                                            | 464/9741 [00:01<00:35, 264.86it/s]  5%|███████▍                                                                                                                                           | 491/9741 [00:01<00:34, 265.54it/s]  5%|███████▊                                                                                                                                           | 518/9741 [00:01<00:34, 266.75it/s]  6%|████████▏                                                                                                                                          | 545/9741 [00:02<00:34, 267.34it/s]  6%|████████▋                                                                                                                                          | 572/9741 [00:02<00:34, 267.66it/s]  6%|█████████                                                                                                                                          | 599/9741 [00:02<00:34, 268.01it/s]  6%|█████████▍                                                                                                                                         | 626/9741 [00:02<00:34, 267.80it/s]  7%|█████████▊                                                                                                                                         | 654/9741 [00:02<00:33, 267.30it/s]  7%|██████████▍                                                                                                                                        | 695/9741 [00:02<00:29, 309.24it/s]  8%|███████████                                                                                                                                        | 736/9741 [00:02<00:26, 338.28it/s]  8%|███████████▋                                                                                                                                       | 777/9741 [00:02<00:24, 359.21it/s]  8%|████████████▎                                                                                                                                      | 818/9741 [00:02<00:23, 373.88it/s]  9%|████████████▉                                                                                                                                      | 859/9741 [00:02<00:23, 383.77it/s]  9%|█████████████▌                                                                                                                                     | 899/9741 [00:03<00:22, 388.13it/s] 10%|██████████████▏                                                                                                                                    | 940/9741 [00:03<00:22, 393.82it/s] 10%|██████████████▊                                                                                                                                    | 981/9741 [00:03<00:22, 397.69it/s] 10%|███████████████▎                                                                                                                                  | 1022/9741 [00:03<00:21, 400.77it/s] 11%|███████████████▉                                                                                                                                  | 1063/9741 [00:03<00:21, 402.94it/s] 11%|████████████████▌                                                                                                                                 | 1104/9741 [00:03<00:21, 404.59it/s] 12%|█████████████████▏                                                                                                                                | 1145/9741 [00:03<00:21, 402.48it/s] 12%|█████████████████▊                                                                                                                                | 1186/9741 [00:03<00:21, 404.20it/s] 13%|██████████████████▍                                                                                                                               | 1227/9741 [00:03<00:21, 404.79it/s] 13%|███████████████████                                                                                                                               | 1268/9741 [00:03<00:20, 405.10it/s] 13%|███████████████████▌                                                                                                                              | 1309/9741 [00:04<00:20, 405.51it/s] 14%|████████████████████▏                                                                                                                             | 1350/9741 [00:04<00:20, 402.87it/s] 14%|████████████████████▊                                                                                                                             | 1391/9741 [00:04<00:20, 403.46it/s] 15%|█████████████████████▍                                                                                                                            | 1432/9741 [00:04<00:20, 404.06it/s] 15%|██████████████████████                                                                                                                            | 1473/9741 [00:04<00:20, 405.00it/s] 16%|██████████████████████▋                                                                                                                           | 1514/9741 [00:04<00:20, 405.35it/s] 16%|███████████████████████▎                                                                                                                          | 1555/9741 [00:04<00:20, 405.63it/s] 16%|███████████████████████▉                                                                                                                          | 1596/9741 [00:04<00:20, 402.76it/s] 17%|████████████████████████▌                                                                                                                         | 1637/9741 [00:04<00:20, 403.46it/s] 17%|█████████████████████████▏                                                                                                                        | 1678/9741 [00:04<00:19, 403.82it/s] 18%|█████████████████████████▊                                                                                                                        | 1719/9741 [00:05<00:19, 403.67it/s] 18%|██████████████████████████▍                                                                                                                       | 1760/9741 [00:05<00:19, 404.32it/s] 18%|██████████████████████████▉                                                                                                                       | 1801/9741 [00:05<00:20, 379.12it/s] 19%|███████████████████████████▌                                                                                                                      | 1842/9741 [00:05<00:20, 386.23it/s] 19%|████████████████████████████▏                                                                                                                     | 1883/9741 [00:05<00:20, 391.43it/s] 20%|████████████████████████████▊                                                                                                                     | 1924/9741 [00:05<00:19, 395.24it/s] 20%|█████████████████████████████▍                                                                                                                    | 1964/9741 [00:05<00:19, 396.46it/s] 21%|██████████████████████████████                                                                                                                    | 2005/9741 [00:05<00:19, 399.02it/s] 21%|██████████████████████████████▋                                                                                                                   | 2045/9741 [00:05<00:19, 398.05it/s] 21%|███████████████████████████████▎                                                                                                                  | 2086/9741 [00:06<00:19, 399.46it/s] 22%|███████████████████████████████▉                                                                                                                  | 2127/9741 [00:06<00:18, 400.81it/s] 22%|████████████████████████████████▍                                                                                                                 | 2168/9741 [00:06<00:18, 402.12it/s] 23%|█████████████████████████████████                                                                                                                 | 2209/9741 [00:06<00:18, 402.77it/s] 23%|█████████████████████████████████▋                                                                                                                | 2250/9741 [00:06<00:18, 400.81it/s] 24%|██████████████████████████████████▎                                                                                                               | 2291/9741 [00:06<00:18, 402.27it/s] 24%|██████████████████████████████████▉                                                                                                               | 2332/9741 [00:06<00:18, 402.86it/s] 24%|███████████████████████████████████▌                                                                                                              | 2373/9741 [00:06<00:18, 403.42it/s] 25%|████████████████████████████████████▏                                                                                                             | 2414/9741 [00:06<00:18, 404.15it/s] 25%|████████████████████████████████████▊                                                                                                             | 2455/9741 [00:06<00:18, 404.51it/s] 26%|█████████████████████████████████████▍                                                                                                            | 2496/9741 [00:07<00:18, 398.53it/s] 26%|██████████████████████████████████████                                                                                                            | 2537/9741 [00:07<00:18, 400.19it/s] 26%|██████████████████████████████████████▋                                                                                                           | 2578/9741 [00:07<00:17, 401.57it/s] 27%|███████████████████████████████████████▎                                                                                                          | 2619/9741 [00:07<00:17, 402.40it/s] 27%|███████████████████████████████████████▊                                                                                                          | 2660/9741 [00:07<00:17, 402.84it/s] 28%|████████████████████████████████████████▍                                                                                                         | 2701/9741 [00:07<00:17, 400.58it/s] 28%|█████████████████████████████████████████                                                                                                         | 2742/9741 [00:07<00:17, 401.28it/s] 29%|█████████████████████████████████████████▋                                                                                                        | 2783/9741 [00:07<00:17, 401.75it/s] 29%|██████████████████████████████████████████▎                                                                                                       | 2824/9741 [00:07<00:17, 402.23it/s] 29%|██████████████████████████████████████████▉                                                                                                       | 2865/9741 [00:07<00:17, 403.29it/s] 30%|███████████████████████████████████████████▌                                                                                                      | 2906/9741 [00:08<00:16, 403.76it/s] 30%|████████████████████████████████████████████▏                                                                                                     | 2947/9741 [00:08<00:16, 401.24it/s] 31%|████████████████████████████████████████████▊                                                                                                     | 2988/9741 [00:08<00:16, 399.12it/s] 31%|█████████████████████████████████████████████▍                                                                                                    | 3029/9741 [00:08<00:16, 400.51it/s] 32%|██████████████████████████████████████████████                                                                                                    | 3070/9741 [00:08<00:16, 401.43it/s] 32%|██████████████████████████████████████████████▋                                                                                                   | 3111/9741 [00:08<00:16, 402.64it/s] 32%|███████████████████████████████████████████████▏                                                                                                  | 3152/9741 [00:08<00:16, 400.38it/s] 33%|███████████████████████████████████████████████▊                                                                                                  | 3193/9741 [00:08<00:16, 401.81it/s] 33%|████████████████████████████████████████████████▍                                                                                                 | 3234/9741 [00:08<00:16, 402.42it/s] 34%|█████████████████████████████████████████████████                                                                                                 | 3275/9741 [00:08<00:16, 402.97it/s] 34%|█████████████████████████████████████████████████▋                                                                                                | 3316/9741 [00:09<00:15, 403.26it/s] 34%|██████████████████████████████████████████████████▎                                                                                               | 3357/9741 [00:09<00:15, 403.04it/s] 35%|██████████████████████████████████████████████████▉                                                                                               | 3398/9741 [00:09<00:15, 400.87it/s] 35%|███████████████████████████████████████████████████▌                                                                                              | 3439/9741 [00:09<00:15, 401.56it/s] 36%|████████████████████████████████████████████████████▏                                                                                             | 3480/9741 [00:09<00:15, 402.04it/s] 36%|████████████████████████████████████████████████████▊                                                                                             | 3521/9741 [00:09<00:15, 399.20it/s] 37%|█████████████████████████████████████████████████████▍                                                                                            | 3562/9741 [00:09<00:15, 400.46it/s] 37%|██████████████████████████████████████████████████████                                                                                            | 3603/9741 [00:09<00:15, 401.22it/s] 37%|██████████████████████████████████████████████████████▌                                                                                           | 3644/9741 [00:09<00:15, 397.92it/s] 38%|███████████████████████████████████████████████████████▏                                                                                          | 3685/9741 [00:09<00:15, 399.45it/s] 38%|███████████████████████████████████████████████████████▊                                                                                          | 3726/9741 [00:10<00:15, 400.82it/s] 39%|████████████████████████████████████████████████████████▍                                                                                         | 3767/9741 [00:10<00:14, 401.39it/s] 39%|█████████████████████████████████████████████████████████                                                                                         | 3808/9741 [00:10<00:14, 401.66it/s] 40%|█████████████████████████████████████████████████████████▋                                                                                        | 3849/9741 [00:10<00:14, 399.58it/s] 40%|██████████████████████████████████████████████████████████▎                                                                                       | 3890/9741 [00:10<00:14, 401.20it/s] 40%|██████████████████████████████████████████████████████████▉                                                                                       | 3931/9741 [00:10<00:14, 402.08it/s] 41%|███████████████████████████████████████████████████████████▌                                                                                      | 3972/9741 [00:10<00:14, 402.87it/s] 41%|████████████████████████████████████████████████████████████▏                                                                                     | 4013/9741 [00:10<00:14, 402.93it/s] 42%|████████████████████████████████████████████████████████████▊                                                                                     | 4054/9741 [00:10<00:14, 402.77it/s] 42%|█████████████████████████████████████████████████████████████▍                                                                                    | 4095/9741 [00:11<00:14, 399.95it/s] 42%|█████████████████████████████████████████████████████████████▉                                                                                    | 4136/9741 [00:11<00:13, 400.86it/s] 43%|██████████████████████████████████████████████████████████████▌                                                                                   | 4177/9741 [00:11<00:13, 401.48it/s] 43%|███████████████████████████████████████████████████████████████▏                                                                                  | 4218/9741 [00:11<00:13, 401.96it/s] 44%|███████████████████████████████████████████████████████████████▊                                                                                  | 4259/9741 [00:11<00:13, 402.72it/s] 44%|████████████████████████████████████████████████████████████████▍                                                                                 | 4300/9741 [00:11<00:13, 399.99it/s] 45%|█████████████████████████████████████████████████████████████████                                                                                 | 4341/9741 [00:11<00:13, 400.86it/s] 45%|█████████████████████████████████████████████████████████████████▋                                                                                | 4382/9741 [00:11<00:13, 401.54it/s] 45%|██████████████████████████████████████████████████████████████████▎                                                                               | 4423/9741 [00:11<00:13, 401.88it/s] 46%|██████████████████████████████████████████████████████████████████▉                                                                               | 4464/9741 [00:11<00:13, 402.09it/s] 46%|███████████████████████████████████████████████████████████████████▌                                                                              | 4505/9741 [00:12<00:13, 402.20it/s] 47%|████████████████████████████████████████████████████████████████████▏                                                                             | 4546/9741 [00:12<00:14, 355.48it/s] 47%|████████████████████████████████████████████████████████████████████▊                                                                             | 4587/9741 [00:12<00:14, 367.99it/s] 48%|█████████████████████████████████████████████████████████████████████▎                                                                            | 4628/9741 [00:12<00:13, 377.57it/s] 48%|█████████████████████████████████████████████████████████████████████▉                                                                            | 4669/9741 [00:12<00:13, 385.06it/s] 48%|██████████████████████████████████████████████████████████████████████▌                                                                           | 4710/9741 [00:12<00:12, 390.61it/s] 49%|███████████████████████████████████████████████████████████████████████▏                                                                          | 4750/9741 [00:12<00:18, 264.24it/s] 49%|███████████████████████████████████████████████████████████████████████▊                                                                          | 4791/9741 [00:12<00:16, 294.78it/s] 50%|████████████████████████████████████████████████████████████████████████▍                                                                         | 4832/9741 [00:13<00:15, 320.58it/s] 50%|█████████████████████████████████████████████████████████████████████████                                                                         | 4873/9741 [00:13<00:14, 341.33it/s] 50%|█████████████████████████████████████████████████████████████████████████▋                                                                        | 4914/9741 [00:13<00:13, 357.84it/s] 51%|██████████████████████████████████████████████████████████████████████████▎                                                                       | 4954/9741 [00:13<00:13, 368.16it/s] 51%|██████████████████████████████████████████████████████████████████████████▊                                                                       | 4995/9741 [00:13<00:12, 377.81it/s] 52%|███████████████████████████████████████████████████████████████████████████▍                                                                      | 5036/9741 [00:13<00:12, 384.70it/s] 52%|████████████████████████████████████████████████████████████████████████████                                                                      | 5077/9741 [00:13<00:11, 389.88it/s] 53%|████████████████████████████████████████████████████████████████████████████▋                                                                     | 5118/9741 [00:13<00:11, 394.20it/s] 53%|█████████████████████████████████████████████████████████████████████████████▎                                                                    | 5158/9741 [00:13<00:11, 395.20it/s] 53%|█████████████████████████████████████████████████████████████████████████████▉                                                                    | 5198/9741 [00:13<00:11, 394.94it/s] 54%|██████████████████████████████████████████████████████████████████████████████▌                                                                   | 5239/9741 [00:14<00:11, 396.65it/s] 54%|███████████████████████████████████████████████████████████████████████████████▏                                                                  | 5280/9741 [00:14<00:11, 398.05it/s] 55%|███████████████████████████████████████████████████████████████████████████████▊                                                                  | 5321/9741 [00:14<00:11, 399.59it/s] 55%|████████████████████████████████████████████████████████████████████████████████▎                                                                 | 5362/9741 [00:14<00:10, 400.08it/s] 55%|████████████████████████████████████████████████████████████████████████████████▉                                                                 | 5403/9741 [00:14<00:10, 398.20it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▌                                                                | 5444/9741 [00:14<00:10, 400.04it/s] 56%|██████████████████████████████████████████████████████████████████████████████████▏                                                               | 5485/9741 [00:14<00:10, 401.93it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▊                                                               | 5527/9741 [00:14<00:10, 405.75it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▍                                                              | 5569/9741 [00:14<00:10, 408.99it/s] 58%|████████████████████████████████████████████████████████████████████████████████████                                                              | 5611/9741 [00:14<00:10, 410.68it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▋                                                             | 5653/9741 [00:15<00:09, 409.60it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▎                                                            | 5695/9741 [00:15<00:09, 411.66it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▉                                                            | 5737/9741 [00:15<00:09, 412.91it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▌                                                           | 5779/9741 [00:15<00:09, 413.34it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▏                                                          | 5821/9741 [00:15<00:09, 413.42it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▉                                                          | 5863/9741 [00:15<00:09, 410.31it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▌                                                         | 5905/9741 [00:15<00:09, 411.85it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▏                                                        | 5947/9741 [00:15<00:09, 412.99it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▊                                                        | 5989/9741 [00:15<00:09, 413.76it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▍                                                       | 6031/9741 [00:16<00:08, 413.79it/s] 62%|███████████████████████████████████████████████████████████████████████████████████████████                                                       | 6073/9741 [00:16<00:08, 414.14it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▋                                                      | 6115/9741 [00:16<00:08, 411.39it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▎                                                     | 6157/9741 [00:16<00:08, 411.95it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▉                                                     | 6199/9741 [00:16<00:08, 412.83it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▌                                                    | 6241/9741 [00:16<00:08, 412.99it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▏                                                   | 6283/9741 [00:16<00:08, 413.60it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▊                                                   | 6325/9741 [00:16<00:08, 410.56it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▍                                                  | 6367/9741 [00:16<00:08, 411.79it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████                                                  | 6409/9741 [00:16<00:08, 412.98it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▋                                                 | 6451/9741 [00:17<00:07, 413.70it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▎                                                | 6493/9741 [00:17<00:07, 413.95it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▉                                                | 6535/9741 [00:17<00:07, 411.70it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▌                                               | 6577/9741 [00:17<00:07, 411.76it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                                              | 6619/9741 [00:17<00:07, 411.80it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▊                                              | 6661/9741 [00:17<00:07, 412.38it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▍                                             | 6703/9741 [00:17<00:07, 412.14it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████                                             | 6745/9741 [00:17<00:07, 412.97it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                                            | 6787/9741 [00:17<00:07, 411.19it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▎                                           | 6829/9741 [00:17<00:07, 412.25it/s] 71%|██████████████████████████████████████████████████████████████████████████████████████████████████████▉                                           | 6871/9741 [00:18<00:06, 412.79it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▌                                          | 6913/9741 [00:18<00:06, 412.67it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                         | 6955/9741 [00:18<00:06, 413.27it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                         | 6997/9741 [00:18<00:06, 410.58it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                        | 7039/9741 [00:18<00:06, 411.79it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                       | 7081/9741 [00:18<00:06, 412.55it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                       | 7123/9741 [00:18<00:06, 413.31it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                      | 7165/9741 [00:18<00:06, 413.34it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████                                      | 7207/9741 [00:18<00:06, 413.30it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                     | 7249/9741 [00:18<00:06, 409.19it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                    | 7291/9741 [00:19<00:05, 410.75it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                    | 7333/9741 [00:19<00:05, 411.50it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                   | 7375/9741 [00:19<00:05, 412.52it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                  | 7417/9741 [00:19<00:05, 412.92it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                  | 7459/9741 [00:19<00:05, 380.71it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                 | 7501/9741 [00:19<00:05, 390.08it/s] 77%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                 | 7543/9741 [00:19<00:05, 396.98it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                | 7585/9741 [00:19<00:05, 402.20it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                               | 7627/9741 [00:19<00:05, 406.01it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                               | 7668/9741 [00:20<00:05, 405.27it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                              | 7710/9741 [00:20<00:04, 407.31it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                             | 7752/9741 [00:20<00:04, 409.00it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                             | 7794/9741 [00:20<00:04, 410.15it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                            | 7836/9741 [00:20<00:04, 411.44it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                            | 7878/9741 [00:20<00:04, 411.89it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 7920/9741 [00:20<00:04, 409.80it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                          | 7961/9741 [00:20<00:04, 407.89it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                          | 8003/9741 [00:20<00:04, 409.49it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                         | 8045/9741 [00:20<00:04, 410.80it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 8087/9741 [00:21<00:04, 411.42it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                        | 8129/9741 [00:21<00:03, 409.87it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                       | 8171/9741 [00:21<00:03, 410.96it/s] 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                       | 8213/9741 [00:21<00:03, 411.39it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 8255/9741 [00:21<00:03, 411.92it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                     | 8297/9741 [00:21<00:03, 412.17it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                     | 8339/9741 [00:21<00:03, 412.39it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                    | 8381/9741 [00:21<00:03, 410.26it/s] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 8423/9741 [00:21<00:03, 411.35it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                   | 8465/9741 [00:21<00:03, 411.97it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 8507/9741 [00:22<00:02, 412.37it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                 | 8549/9741 [00:22<00:02, 411.56it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                 | 8591/9741 [00:22<00:02, 409.05it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                | 8632/9741 [00:22<00:02, 406.54it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                | 8674/9741 [00:22<00:02, 408.44it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋               | 8716/9741 [00:22<00:02, 409.81it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎              | 8758/9741 [00:22<00:02, 410.43it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉              | 8800/9741 [00:22<00:02, 410.75it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌             | 8842/9741 [00:22<00:02, 407.62it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏            | 8884/9741 [00:22<00:02, 409.30it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊            | 8926/9741 [00:23<00:01, 410.67it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍           | 8968/9741 [00:23<00:01, 410.78it/s] 92%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████           | 9010/9741 [00:23<00:01, 411.28it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋          | 9052/9741 [00:23<00:01, 409.33it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎         | 9094/9741 [00:23<00:01, 410.64it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉         | 9136/9741 [00:23<00:01, 411.36it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌        | 9178/9741 [00:23<00:01, 412.05it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏       | 9220/9741 [00:23<00:01, 412.11it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊       | 9262/9741 [00:23<00:01, 409.78it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍      | 9304/9741 [00:23<00:01, 410.97it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████      | 9346/9741 [00:24<00:00, 409.25it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋     | 9388/9741 [00:24<00:00, 410.32it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎    | 9430/9741 [00:24<00:00, 411.27it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉    | 9472/9741 [00:24<00:00, 411.51it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌   | 9514/9741 [00:24<00:00, 409.07it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏  | 9556/9741 [00:24<00:00, 410.16it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊  | 9598/9741 [00:24<00:00, 411.07it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍ | 9640/9741 [00:24<00:00, 411.77it/s] 99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████ | 9682/9741 [00:24<00:00, 411.68it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋| 9724/9741 [00:25<00:00, 408.88it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:25<00:00, 388.82it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.83s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.34s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.27s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.30s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.92s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.24s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.39s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.30s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.46s/it]
[2023-08-10 21:28:46,163] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.85s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.64s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
[2023-08-10 21:28:55,886] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 21:28:55,887] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 21:28:55,887] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 21:28:55,887] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 21:28:55,887] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 21:28:55,887] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 21:28:55,887] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 21:28:55,887] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 21:28:55,887] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 21:28:55,887] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 21:28:55,887] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 21:28:55,887] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fb07e09ae80>
[2023-08-10 21:28:55,887] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fb07da64910>
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 21:28:55,888] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 21:28:55,889] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4580206871032715 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]Loading extension module utils...
############### Example ###############
Time to load utils op: 0.3044755458831787 seconds
Loading extension module utils...
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Rationales: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
#### 44
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Rationales: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
#### 6
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Rationales: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
#### 322
Answer: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Rationales: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
#### 3
Answer: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Rationales: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
#### 27
Answer: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Rationales: Max finished history in 20 * 2 = <<20*2=40>>40 minutes.
Finishing geography took the most time, which is 40 * 3 = <<40*3=120>>120 minutes.
In total, for all three subjects, Max needed 20 + 40 + 120 = <<20+40+120=180>>180 minutes.
#### 180
Answer: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Rationales: If Sophia ate 1/6 of the pie, then 6/6 - 1/6 = 5/6 is left in the fridge.
Let x be the pie's original weight.
The current weight of the pie can be described by 5x/6=1200 grams
So, 5x=7200.
And, the original weight is x = <<1440=1440>>1440 grams.
So, Sophia ate 1440 grams original - 1200 grams after= <<1440-1200=240>>240 grams of pie.
#### 240
Answer: 240

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o7-tgsm8k-s1-rTrue
Time to load utils op: 0.20408105850219727 seconds
Loading extension module utils...
Time to load utils op: 0.3044776916503906 seconds
Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:05<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 2630117) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-10_21:29:07
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 2630118)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-10_21:29:07
  host      : ia1.wse.jhu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 2630119)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2023-08-10_21:29:07
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 2630120)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-10_21:29:07
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 2630117)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s1-rTrue --seed 1 --rationales --num-out-domain 8
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 21:29:11,634] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 8
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o8-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  0%|▌                                                                                                                                                   | 37/9741 [00:00<00:26, 369.27it/s]  1%|█▏                                                                                                                                                  | 75/9741 [00:00<00:26, 370.49it/s]  1%|█▋                                                                                                                                                 | 113/9741 [00:00<00:26, 368.19it/s]  2%|██▎                                                                                                                                                | 151/9741 [00:00<00:25, 369.56it/s]  2%|██▊                                                                                                                                                | 189/9741 [00:00<00:25, 370.11it/s]  2%|███▍                                                                                                                                               | 227/9741 [00:00<00:25, 367.38it/s]  3%|███▉                                                                                                                                               | 264/9741 [00:00<00:26, 363.26it/s]  3%|████▌                                                                                                                                              | 301/9741 [00:00<00:25, 365.16it/s]  3%|█████                                                                                                                                              | 338/9741 [00:00<00:25, 366.63it/s]  4%|█████▋                                                                                                                                             | 376/9741 [00:01<00:25, 367.77it/s]  4%|██████▏                                                                                                                                            | 413/9741 [00:01<00:25, 368.32it/s]  5%|██████▊                                                                                                                                            | 450/9741 [00:01<00:25, 365.02it/s]  5%|███████▎                                                                                                                                           | 487/9741 [00:01<00:25, 365.38it/s]  5%|███████▉                                                                                                                                           | 524/9741 [00:01<00:25, 366.23it/s]  6%|████████▍                                                                                                                                          | 561/9741 [00:01<00:25, 367.06it/s]  6%|█████████                                                                                                                                          | 598/9741 [00:01<00:24, 367.57it/s]  7%|█████████▌                                                                                                                                         | 635/9741 [00:01<00:24, 364.28it/s]  7%|██████████▏                                                                                                                                        | 672/9741 [00:01<00:25, 360.42it/s]  7%|██████████▋                                                                                                                                        | 709/9741 [00:01<00:24, 362.75it/s]  8%|███████████▎                                                                                                                                       | 746/9741 [00:02<00:24, 364.12it/s]  8%|███████████▊                                                                                                                                       | 783/9741 [00:02<00:24, 365.34it/s]  8%|████████████▎                                                                                                                                      | 820/9741 [00:02<00:24, 366.39it/s]  9%|████████████▉                                                                                                                                      | 857/9741 [00:02<00:24, 366.23it/s]  9%|█████████████▍                                                                                                                                     | 894/9741 [00:02<00:24, 364.09it/s] 10%|██████████████                                                                                                                                     | 931/9741 [00:02<00:24, 365.25it/s] 10%|██████████████▌                                                                                                                                    | 968/9741 [00:02<00:24, 365.40it/s] 10%|███████████████                                                                                                                                   | 1005/9741 [00:02<00:23, 364.84it/s] 11%|███████████████▌                                                                                                                                  | 1042/9741 [00:02<00:23, 365.47it/s] 11%|████████████████▏                                                                                                                                 | 1079/9741 [00:02<00:23, 366.17it/s] 11%|████████████████▋                                                                                                                                 | 1116/9741 [00:03<00:23, 363.82it/s] 12%|█████████████████▎                                                                                                                                | 1153/9741 [00:03<00:23, 364.71it/s] 12%|█████████████████▊                                                                                                                                | 1190/9741 [00:03<00:23, 365.37it/s] 13%|██████████████████▍                                                                                                                               | 1227/9741 [00:03<00:23, 365.66it/s] 13%|██████████████████▉                                                                                                                               | 1264/9741 [00:03<00:23, 365.72it/s] 13%|███████████████████▍                                                                                                                              | 1301/9741 [00:03<00:23, 365.80it/s] 14%|████████████████████                                                                                                                              | 1338/9741 [00:03<00:23, 363.55it/s] 14%|████████████████████▌                                                                                                                             | 1375/9741 [00:03<00:22, 364.36it/s] 14%|█████████████████████▏                                                                                                                            | 1412/9741 [00:03<00:22, 364.69it/s] 15%|█████████████████████▋                                                                                                                            | 1449/9741 [00:03<00:22, 365.20it/s] 15%|██████████████████████▎                                                                                                                           | 1486/9741 [00:04<00:22, 365.40it/s] 16%|██████████████████████▊                                                                                                                           | 1523/9741 [00:04<00:22, 365.27it/s] 16%|███████████████████████▍                                                                                                                          | 1560/9741 [00:04<00:22, 365.46it/s] 16%|███████████████████████▉                                                                                                                          | 1597/9741 [00:04<00:22, 362.82it/s] 17%|████████████████████████▍                                                                                                                         | 1634/9741 [00:04<00:22, 363.98it/s] 17%|█████████████████████████                                                                                                                         | 1671/9741 [00:04<00:22, 364.22it/s] 18%|█████████████████████████▌                                                                                                                        | 1708/9741 [00:04<00:22, 363.96it/s] 18%|██████████████████████████▏                                                                                                                       | 1745/9741 [00:04<00:21, 364.77it/s] 18%|██████████████████████████▋                                                                                                                       | 1782/9741 [00:04<00:21, 364.97it/s] 19%|███████████████████████████▎                                                                                                                      | 1819/9741 [00:05<00:23, 339.34it/s] 19%|███████████████████████████▊                                                                                                                      | 1856/9741 [00:05<00:22, 346.62it/s] 19%|████████████████████████████▎                                                                                                                     | 1893/9741 [00:05<00:22, 351.79it/s] 20%|████████████████████████████▉                                                                                                                     | 1930/9741 [00:05<00:22, 353.97it/s] 20%|█████████████████████████████▍                                                                                                                    | 1967/9741 [00:05<00:21, 357.01it/s] 21%|██████████████████████████████                                                                                                                    | 2004/9741 [00:05<00:21, 359.76it/s] 21%|██████████████████████████████▌                                                                                                                   | 2041/9741 [00:05<00:21, 357.95it/s] 21%|███████████████████████████████▏                                                                                                                  | 2078/9741 [00:05<00:21, 359.51it/s] 22%|███████████████████████████████▋                                                                                                                  | 2115/9741 [00:05<00:21, 360.89it/s] 22%|████████████████████████████████▎                                                                                                                 | 2152/9741 [00:05<00:20, 362.03it/s] 22%|████████████████████████████████▊                                                                                                                 | 2189/9741 [00:06<00:20, 362.83it/s] 23%|█████████████████████████████████▎                                                                                                                | 2226/9741 [00:06<00:20, 363.69it/s] 23%|█████████████████████████████████▉                                                                                                                | 2263/9741 [00:06<00:20, 361.28it/s] 24%|██████████████████████████████████▍                                                                                                               | 2300/9741 [00:06<00:20, 362.35it/s] 24%|███████████████████████████████████                                                                                                               | 2337/9741 [00:06<00:20, 363.18it/s] 24%|███████████████████████████████████▌                                                                                                              | 2374/9741 [00:06<00:20, 364.07it/s] 25%|████████████████████████████████████▏                                                                                                             | 2411/9741 [00:06<00:20, 361.85it/s] 25%|████████████████████████████████████▋                                                                                                             | 2448/9741 [00:06<00:20, 362.95it/s] 26%|█████████████████████████████████████▏                                                                                                            | 2485/9741 [00:06<00:20, 361.19it/s] 26%|█████████████████████████████████████▊                                                                                                            | 2522/9741 [00:06<00:19, 362.26it/s] 26%|██████████████████████████████████████▎                                                                                                           | 2559/9741 [00:07<00:19, 363.11it/s] 27%|██████████████████████████████████████▉                                                                                                           | 2596/9741 [00:07<00:19, 364.07it/s] 27%|███████████████████████████████████████▍                                                                                                          | 2633/9741 [00:07<00:19, 364.36it/s] 27%|████████████████████████████████████████                                                                                                          | 2670/9741 [00:07<00:19, 364.61it/s] 28%|████████████████████████████████████████▌                                                                                                         | 2707/9741 [00:07<00:19, 361.88it/s] 28%|█████████████████████████████████████████▏                                                                                                        | 2744/9741 [00:07<00:19, 362.99it/s] 29%|█████████████████████████████████████████▋                                                                                                        | 2781/9741 [00:07<00:19, 363.04it/s] 29%|██████████████████████████████████████████▏                                                                                                       | 2818/9741 [00:07<00:19, 361.32it/s] 29%|██████████████████████████████████████████▊                                                                                                       | 2855/9741 [00:07<00:18, 362.61it/s] 30%|███████████████████████████████████████████▎                                                                                                      | 2892/9741 [00:07<00:18, 360.87it/s] 30%|███████████████████████████████████████████▉                                                                                                      | 2929/9741 [00:08<00:18, 360.24it/s] 30%|████████████████████████████████████████████▍                                                                                                     | 2966/9741 [00:08<00:18, 361.65it/s] 31%|█████████████████████████████████████████████                                                                                                     | 3003/9741 [00:08<00:18, 362.68it/s] 31%|█████████████████████████████████████████████▌                                                                                                    | 3040/9741 [00:08<00:18, 362.79it/s] 32%|██████████████████████████████████████████████                                                                                                    | 3077/9741 [00:08<00:18, 363.17it/s] 32%|██████████████████████████████████████████████▋                                                                                                   | 3114/9741 [00:08<00:18, 364.03it/s] 32%|███████████████████████████████████████████████▏                                                                                                  | 3151/9741 [00:08<00:18, 361.44it/s] 33%|███████████████████████████████████████████████▊                                                                                                  | 3188/9741 [00:08<00:18, 360.70it/s] 33%|████████████████████████████████████████████████▎                                                                                                 | 3225/9741 [00:08<00:18, 361.34it/s] 33%|████████████████████████████████████████████████▉                                                                                                 | 3262/9741 [00:08<00:17, 362.66it/s] 34%|█████████████████████████████████████████████████▍                                                                                                | 3299/9741 [00:09<00:17, 363.26it/s] 34%|██████████████████████████████████████████████████                                                                                                | 3336/9741 [00:09<00:17, 363.66it/s] 35%|██████████████████████████████████████████████████▌                                                                                               | 3373/9741 [00:09<00:17, 361.65it/s] 35%|███████████████████████████████████████████████████                                                                                               | 3410/9741 [00:09<00:17, 358.00it/s] 35%|███████████████████████████████████████████████████▋                                                                                              | 3447/9741 [00:09<00:17, 359.97it/s] 36%|████████████████████████████████████████████████████▏                                                                                             | 3484/9741 [00:09<00:17, 361.07it/s] 36%|████████████████████████████████████████████████████▊                                                                                             | 3521/9741 [00:09<00:17, 361.39it/s] 37%|█████████████████████████████████████████████████████▎                                                                                            | 3558/9741 [00:09<00:17, 361.98it/s] 37%|█████████████████████████████████████████████████████▉                                                                                            | 3595/9741 [00:09<00:17, 360.97it/s] 37%|██████████████████████████████████████████████████████▍                                                                                           | 3632/9741 [00:10<00:17, 357.96it/s] 38%|██████████████████████████████████████████████████████▉                                                                                           | 3669/9741 [00:10<00:16, 359.95it/s] 38%|███████████████████████████████████████████████████████▌                                                                                          | 3706/9741 [00:10<00:16, 361.91it/s] 38%|████████████████████████████████████████████████████████                                                                                          | 3743/9741 [00:10<00:16, 362.55it/s] 39%|████████████████████████████████████████████████████████▋                                                                                         | 3780/9741 [00:10<00:16, 363.16it/s] 39%|█████████████████████████████████████████████████████████▏                                                                                        | 3817/9741 [00:10<00:16, 363.98it/s] 40%|█████████████████████████████████████████████████████████▊                                                                                        | 3854/9741 [00:10<00:16, 362.08it/s] 40%|██████████████████████████████████████████████████████████▎                                                                                       | 3891/9741 [00:10<00:16, 362.36it/s] 40%|██████████████████████████████████████████████████████████▊                                                                                       | 3928/9741 [00:10<00:16, 363.27it/s] 41%|███████████████████████████████████████████████████████████▍                                                                                      | 3965/9741 [00:10<00:15, 362.09it/s] 41%|███████████████████████████████████████████████████████████▉                                                                                      | 4002/9741 [00:11<00:15, 362.22it/s] 41%|████████████████████████████████████████████████████████████▌                                                                                     | 4039/9741 [00:11<00:15, 363.03it/s] 42%|█████████████████████████████████████████████████████████████                                                                                     | 4076/9741 [00:11<00:15, 361.27it/s] 42%|█████████████████████████████████████████████████████████████▋                                                                                    | 4113/9741 [00:11<00:15, 362.53it/s] 43%|██████████████████████████████████████████████████████████████▏                                                                                   | 4150/9741 [00:11<00:15, 363.40it/s] 43%|██████████████████████████████████████████████████████████████▊                                                                                   | 4187/9741 [00:11<00:15, 363.92it/s] 43%|███████████████████████████████████████████████████████████████▎                                                                                  | 4224/9741 [00:11<00:15, 364.42it/s] 44%|███████████████████████████████████████████████████████████████▊                                                                                  | 4261/9741 [00:11<00:15, 364.94it/s] 44%|████████████████████████████████████████████████████████████████▍                                                                                 | 4298/9741 [00:11<00:15, 362.24it/s] 45%|████████████████████████████████████████████████████████████████▉                                                                                 | 4335/9741 [00:11<00:14, 362.68it/s] 45%|█████████████████████████████████████████████████████████████████▌                                                                                | 4372/9741 [00:12<00:14, 362.48it/s] 45%|██████████████████████████████████████████████████████████████████                                                                                | 4409/9741 [00:12<00:14, 363.17it/s] 46%|██████████████████████████████████████████████████████████████████▋                                                                               | 4446/9741 [00:12<00:14, 363.79it/s] 46%|███████████████████████████████████████████████████████████████████▏                                                                              | 4483/9741 [00:12<00:14, 364.24it/s] 46%|███████████████████████████████████████████████████████████████████▋                                                                              | 4520/9741 [00:12<00:15, 327.83it/s] 47%|████████████████████████████████████████████████████████████████████▎                                                                             | 4557/9741 [00:12<00:15, 338.18it/s] 47%|████████████████████████████████████████████████████████████████████▊                                                                             | 4594/9741 [00:12<00:14, 345.54it/s] 48%|█████████████████████████████████████████████████████████████████████▍                                                                            | 4631/9741 [00:12<00:14, 351.44it/s] 48%|█████████████████████████████████████████████████████████████████████▉                                                                            | 4668/9741 [00:12<00:14, 355.76it/s] 48%|██████████████████████████████████████████████████████████████████████▌                                                                           | 4705/9741 [00:12<00:14, 358.60it/s] 49%|███████████████████████████████████████████████████████████████████████                                                                           | 4742/9741 [00:13<00:21, 233.13it/s] 49%|███████████████████████████████████████████████████████████████████████▋                                                                          | 4779/9741 [00:13<00:18, 261.29it/s] 49%|████████████████████████████████████████████████████████████████████████▏                                                                         | 4816/9741 [00:13<00:17, 285.45it/s] 50%|████████████████████████████████████████████████████████████████████████▋                                                                         | 4853/9741 [00:13<00:16, 305.32it/s] 50%|█████████████████████████████████████████████████████████████████████████▎                                                                        | 4890/9741 [00:13<00:15, 321.00it/s] 51%|█████████████████████████████████████████████████████████████████████████▊                                                                        | 4927/9741 [00:13<00:14, 332.85it/s] 51%|██████████████████████████████████████████████████████████████████████████▍                                                                       | 4963/9741 [00:13<00:14, 339.96it/s] 51%|██████████████████████████████████████████████████████████████████████████▉                                                                       | 5000/9741 [00:13<00:13, 346.98it/s] 52%|███████████████████████████████████████████████████████████████████████████▍                                                                      | 5037/9741 [00:14<00:13, 351.87it/s] 52%|████████████████████████████████████████████████████████████████████████████                                                                      | 5073/9741 [00:14<00:13, 353.08it/s] 52%|████████████████████████████████████████████████████████████████████████████▌                                                                     | 5110/9741 [00:14<00:13, 355.67it/s] 53%|█████████████████████████████████████████████████████████████████████████████▏                                                                    | 5147/9741 [00:14<00:12, 357.49it/s] 53%|█████████████████████████████████████████████████████████████████████████████▋                                                                    | 5184/9741 [00:14<00:12, 357.38it/s] 54%|██████████████████████████████████████████████████████████████████████████████▎                                                                   | 5221/9741 [00:14<00:12, 359.69it/s] 54%|██████████████████████████████████████████████████████████████████████████████▊                                                                   | 5258/9741 [00:14<00:12, 361.08it/s] 54%|███████████████████████████████████████████████████████████████████████████████▎                                                                  | 5295/9741 [00:14<00:12, 362.11it/s] 55%|███████████████████████████████████████████████████████████████████████████████▉                                                                  | 5332/9741 [00:14<00:12, 362.81it/s] 55%|████████████████████████████████████████████████████████████████████████████████▍                                                                 | 5369/9741 [00:15<00:12, 363.14it/s] 55%|█████████████████████████████████████████████████████████████████████████████████                                                                 | 5406/9741 [00:15<00:12, 361.09it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▌                                                                | 5443/9741 [00:15<00:11, 362.71it/s] 56%|██████████████████████████████████████████████████████████████████████████████████▏                                                               | 5480/9741 [00:15<00:11, 363.98it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▋                                                               | 5518/9741 [00:15<00:11, 367.62it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▎                                                              | 5556/9741 [00:15<00:11, 369.29it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▊                                                              | 5594/9741 [00:15<00:11, 370.50it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▍                                                             | 5632/9741 [00:15<00:11, 369.17it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▉                                                             | 5670/9741 [00:15<00:10, 370.88it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▌                                                            | 5708/9741 [00:15<00:10, 372.64it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████                                                            | 5746/9741 [00:16<00:10, 373.92it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▋                                                           | 5784/9741 [00:16<00:10, 374.55it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▎                                                          | 5822/9741 [00:16<00:10, 374.59it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▊                                                          | 5860/9741 [00:16<00:10, 372.02it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▍                                                         | 5898/9741 [00:16<00:10, 372.71it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▉                                                         | 5936/9741 [00:16<00:10, 373.70it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▌                                                        | 5974/9741 [00:16<00:10, 374.45it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████                                                        | 6012/9741 [00:16<00:10, 371.88it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▋                                                       | 6050/9741 [00:16<00:09, 372.56it/s] 62%|███████████████████████████████████████████████████████████████████████████████████████████▏                                                      | 6088/9741 [00:16<00:09, 370.56it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▊                                                      | 6126/9741 [00:17<00:09, 372.00it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▍                                                     | 6164/9741 [00:17<00:09, 372.61it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▉                                                     | 6202/9741 [00:17<00:09, 373.34it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▌                                                    | 6240/9741 [00:17<00:09, 373.25it/s] 64%|██████████████████████████████████████████████████████████████████████████████████████████████                                                    | 6278/9741 [00:17<00:09, 374.06it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▋                                                   | 6316/9741 [00:17<00:09, 371.66it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▏                                                  | 6354/9741 [00:17<00:09, 372.51it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▊                                                  | 6392/9741 [00:17<00:08, 373.40it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▎                                                 | 6430/9741 [00:17<00:08, 371.11it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▉                                                 | 6468/9741 [00:17<00:08, 371.22it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▌                                                | 6506/9741 [00:18<00:08, 372.43it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████                                                | 6544/9741 [00:18<00:08, 370.38it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▋                                               | 6582/9741 [00:18<00:08, 371.45it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                                              | 6620/9741 [00:18<00:08, 372.36it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▊                                              | 6658/9741 [00:18<00:08, 373.22it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▎                                             | 6696/9741 [00:18<00:08, 373.74it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▉                                             | 6734/9741 [00:18<00:08, 374.40it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▌                                            | 6772/9741 [00:18<00:07, 371.91it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████                                            | 6810/9741 [00:18<00:07, 373.07it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▋                                           | 6848/9741 [00:18<00:07, 373.76it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▏                                          | 6886/9741 [00:19<00:07, 373.27it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▊                                          | 6924/9741 [00:19<00:07, 372.78it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                         | 6962/9741 [00:19<00:07, 373.04it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                         | 7000/9741 [00:19<00:07, 370.52it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                        | 7038/9741 [00:19<00:07, 372.01it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████                                        | 7076/9741 [00:19<00:07, 373.28it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                       | 7114/9741 [00:19<00:07, 373.88it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                      | 7152/9741 [00:19<00:06, 374.17it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                      | 7190/9741 [00:19<00:06, 374.70it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                     | 7228/9741 [00:20<00:06, 371.81it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                     | 7266/9741 [00:20<00:06, 373.41it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                    | 7304/9741 [00:20<00:06, 374.07it/s] 75%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████                                    | 7342/9741 [00:20<00:06, 373.51it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                   | 7380/9741 [00:20<00:06, 373.89it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                  | 7418/9741 [00:20<00:06, 374.43it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                  | 7456/9741 [00:20<00:06, 344.48it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 7494/9741 [00:20<00:06, 352.26it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                 | 7532/9741 [00:20<00:06, 358.83it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                | 7570/9741 [00:20<00:05, 363.66it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                | 7608/9741 [00:21<00:05, 366.61it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                               | 7646/9741 [00:21<00:05, 369.16it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                              | 7684/9741 [00:21<00:05, 368.50it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                              | 7722/9741 [00:21<00:05, 371.15it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                             | 7760/9741 [00:21<00:05, 372.52it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                             | 7798/9741 [00:21<00:05, 373.26it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                            | 7836/9741 [00:21<00:05, 374.02it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                            | 7874/9741 [00:21<00:04, 374.46it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                           | 7912/9741 [00:21<00:04, 372.32it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                          | 7950/9741 [00:21<00:04, 373.05it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                          | 7988/9741 [00:22<00:04, 373.98it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                         | 8026/9741 [00:22<00:04, 374.82it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                         | 8064/9741 [00:22<00:04, 374.69it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                        | 8102/9741 [00:22<00:04, 375.18it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                        | 8140/9741 [00:22<00:04, 373.16it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                       | 8178/9741 [00:22<00:04, 372.78it/s] 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                      | 8216/9741 [00:22<00:04, 373.53it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 8254/9741 [00:22<00:03, 373.79it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                     | 8292/9741 [00:22<00:03, 374.12it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                     | 8330/9741 [00:22<00:03, 374.53it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                    | 8368/9741 [00:23<00:03, 372.37it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                    | 8406/9741 [00:23<00:03, 373.38it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                   | 8444/9741 [00:23<00:03, 373.87it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                  | 8482/9741 [00:23<00:03, 374.19it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                  | 8520/9741 [00:23<00:03, 374.42it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                 | 8558/9741 [00:23<00:03, 372.69it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                 | 8596/9741 [00:23<00:03, 369.93it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                | 8634/9741 [00:23<00:02, 371.41it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                | 8672/9741 [00:23<00:02, 372.55it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌               | 8710/9741 [00:24<00:02, 373.25it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 8748/9741 [00:24<00:02, 371.63it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋              | 8786/9741 [00:24<00:02, 372.52it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎             | 8824/9741 [00:24<00:02, 370.90it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 8862/9741 [00:24<00:02, 371.95it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍            | 8900/9741 [00:24<00:02, 373.19it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉            | 8938/9741 [00:24<00:02, 373.61it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌           | 8976/9741 [00:24<00:02, 372.95it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████           | 9014/9741 [00:24<00:01, 372.64it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋          | 9052/9741 [00:24<00:01, 370.91it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏         | 9090/9741 [00:25<00:01, 372.31it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 9128/9741 [00:25<00:01, 373.38it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍        | 9166/9741 [00:25<00:01, 374.12it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉        | 9204/9741 [00:25<00:01, 374.35it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 9242/9741 [00:25<00:01, 374.53it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████       | 9280/9741 [00:25<00:01, 372.16it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋      | 9318/9741 [00:25<00:01, 373.24it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏     | 9356/9741 [00:25<00:01, 370.37it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊     | 9394/9741 [00:25<00:00, 368.55it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎    | 9432/9741 [00:25<00:00, 370.44it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉    | 9470/9741 [00:26<00:00, 371.82it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌   | 9508/9741 [00:26<00:00, 369.71it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████   | 9546/9741 [00:26<00:00, 371.51it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋  | 9584/9741 [00:26<00:00, 372.81it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏ | 9622/9741 [00:26<00:00, 373.57it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊ | 9660/9741 [00:26<00:00, 373.97it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎| 9698/9741 [00:26<00:00, 374.64it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉| 9736/9741 [00:26<00:00, 372.29it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:26<00:00, 363.83it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.95s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.97s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.97s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.39s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.02s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.88s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.27s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.40s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.56s/it]
[2023-08-10 21:30:29,560] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.39s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.55s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.28s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.45s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
[2023-08-10 21:30:38,172] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 21:30:38,173] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 21:30:38,173] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 21:30:38,173] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 21:30:38,173] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 21:30:38,173] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fd3d4c83e80>
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 21:30:38,174] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fd3d1e86910>
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 21:30:38,175] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 21:30:38,176] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 21:30:38,176] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 21:30:38,176] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.47899866104125977 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Rationales: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
#### 44
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Rationales: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
#### 6
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Rationales: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
#### 322
Answer: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Rationales: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
#### 3
Answer: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Rationales: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
#### 27
Answer: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Rationales: Max finished history in 20 * 2 = <<20*2=40>>40 minutes.
Finishing geography took the most time, which is 40 * 3 = <<40*3=120>>120 minutes.
In total, for all three subjects, Max needed 20 + 40 + 120 = <<20+40+120=180>>180 minutes.
#### 180
Answer: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Rationales: If Sophia ate 1/6 of the pie, then 6/6 - 1/6 = 5/6 is left in the fridge.
Let x be the pie's original weight.
The current weight of the pie can be described by 5x/6=1200 grams
So, 5x=7200.
And, the original weight is x = <<1440=1440>>1440 grams.
So, Sophia ate 1440 grams original - 1200 grams after= <<1440-1200=240>>240 grams of pie.
#### 240
Answer: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Rationales: After using the coupon, the final price comes to 67 - 4 = <<67-4=63>>63 dollars.
With three people, they each need to pay 63 / 3 = <<63/3=21>>21 dollars each.
#### 21
Answer: 21

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o8-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.5047054290771484 seconds
Loading extension module utils...
Time to load utils op: 0.5046143531799316 seconds
Loading extension module utils...
Time to load utils op: 0.5046865940093994 seconds
Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:05<?, ?it/s]
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 2631240 closing signal SIGTERM
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 2631238) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2023-08-10_21:30:49
  host      : ia1.wse.jhu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 2631239)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2023-08-10_21:30:49
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 2631241)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-10_21:30:49
  host      : ia1.wse.jhu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 2631238)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s1-rTrue --seed 1 --rationales --num-out-domain 9
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 21:30:53,596] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s1-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 9
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o9-tgsm8k-s1-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                                                                                   | 22/9741 [00:00<00:44, 218.35it/s]  0%|▋                                                                                                                                                   | 44/9741 [00:00<00:44, 219.29it/s]  1%|█                                                                                                                                                   | 66/9741 [00:00<00:44, 219.58it/s]  1%|█▎                                                                                                                                                  | 89/9741 [00:00<00:43, 220.22it/s]  1%|█▋                                                                                                                                                 | 112/9741 [00:00<00:43, 220.61it/s]  1%|██                                                                                                                                                 | 135/9741 [00:00<00:43, 220.86it/s]  2%|██▍                                                                                                                                                | 158/9741 [00:00<00:44, 217.34it/s]  2%|██▋                                                                                                                                                | 180/9741 [00:00<00:43, 218.01it/s]  2%|███                                                                                                                                                | 202/9741 [00:00<00:44, 216.54it/s]  2%|███▍                                                                                                                                               | 225/9741 [00:01<00:43, 217.86it/s]  3%|███▋                                                                                                                                               | 248/9741 [00:01<00:43, 218.77it/s]  3%|████                                                                                                                                               | 271/9741 [00:01<00:43, 219.36it/s]  3%|████▍                                                                                                                                              | 294/9741 [00:01<00:43, 219.65it/s]  3%|████▊                                                                                                                                              | 317/9741 [00:01<00:42, 219.95it/s]  3%|█████▏                                                                                                                                             | 340/9741 [00:01<00:42, 220.07it/s]  4%|█████▍                                                                                                                                             | 363/9741 [00:01<00:42, 220.11it/s]  4%|█████▊                                                                                                                                             | 386/9741 [00:01<00:42, 217.76it/s]  4%|██████▏                                                                                                                                            | 408/9741 [00:01<00:42, 218.40it/s]  4%|██████▍                                                                                                                                            | 430/9741 [00:01<00:43, 215.13it/s]  5%|██████▊                                                                                                                                            | 453/9741 [00:02<00:42, 216.84it/s]  5%|███████▏                                                                                                                                           | 476/9741 [00:02<00:42, 217.81it/s]  5%|███████▌                                                                                                                                           | 499/9741 [00:02<00:42, 218.65it/s]  5%|███████▉                                                                                                                                           | 530/9741 [00:02<00:37, 243.80it/s]  6%|████████▌                                                                                                                                          | 564/9741 [00:02<00:33, 270.93it/s]  6%|█████████                                                                                                                                          | 598/9741 [00:02<00:31, 289.95it/s]  6%|█████████▌                                                                                                                                         | 632/9741 [00:02<00:30, 302.95it/s]  7%|██████████                                                                                                                                         | 665/9741 [00:02<00:29, 309.79it/s]  7%|██████████▌                                                                                                                                        | 699/9741 [00:02<00:28, 317.14it/s]  8%|███████████                                                                                                                                        | 733/9741 [00:02<00:27, 322.61it/s]  8%|███████████▌                                                                                                                                       | 767/9741 [00:03<00:27, 326.66it/s]  8%|████████████                                                                                                                                       | 801/9741 [00:03<00:27, 329.44it/s]  9%|████████████▌                                                                                                                                      | 835/9741 [00:03<00:26, 331.29it/s]  9%|█████████████                                                                                                                                      | 869/9741 [00:03<00:26, 331.30it/s]  9%|█████████████▋                                                                                                                                     | 903/9741 [00:03<00:26, 329.88it/s] 10%|██████████████▏                                                                                                                                    | 937/9741 [00:03<00:26, 331.43it/s] 10%|██████████████▋                                                                                                                                    | 971/9741 [00:03<00:26, 332.75it/s] 10%|███████████████                                                                                                                                   | 1005/9741 [00:03<00:26, 333.42it/s] 11%|███████████████▌                                                                                                                                  | 1039/9741 [00:03<00:26, 334.20it/s] 11%|████████████████                                                                                                                                  | 1073/9741 [00:04<00:25, 333.91it/s] 11%|████████████████▌                                                                                                                                 | 1107/9741 [00:04<00:25, 334.29it/s] 12%|█████████████████                                                                                                                                 | 1141/9741 [00:04<00:25, 331.87it/s] 12%|█████████████████▌                                                                                                                                | 1175/9741 [00:04<00:25, 332.81it/s] 12%|██████████████████                                                                                                                                | 1209/9741 [00:04<00:25, 331.84it/s] 13%|██████████████████▋                                                                                                                               | 1243/9741 [00:04<00:25, 331.91it/s] 13%|███████████████████▏                                                                                                                              | 1277/9741 [00:04<00:25, 332.80it/s] 13%|███████████████████▋                                                                                                                              | 1311/9741 [00:04<00:25, 333.38it/s] 14%|████████████████████▏                                                                                                                             | 1345/9741 [00:04<00:25, 331.27it/s] 14%|████████████████████▋                                                                                                                             | 1379/9741 [00:04<00:25, 332.28it/s] 15%|█████████████████████▏                                                                                                                            | 1413/9741 [00:05<00:25, 332.77it/s] 15%|█████████████████████▋                                                                                                                            | 1447/9741 [00:05<00:24, 333.02it/s] 15%|██████████████████████▏                                                                                                                           | 1481/9741 [00:05<00:24, 333.79it/s] 16%|██████████████████████▋                                                                                                                           | 1515/9741 [00:05<00:24, 331.33it/s] 16%|███████████████████████▏                                                                                                                          | 1549/9741 [00:05<00:24, 332.21it/s] 16%|███████████████████████▋                                                                                                                          | 1583/9741 [00:05<00:24, 327.32it/s] 17%|████████████████████████▏                                                                                                                         | 1617/9741 [00:05<00:24, 329.35it/s] 17%|████████████████████████▋                                                                                                                         | 1651/9741 [00:05<00:24, 330.93it/s] 17%|█████████████████████████▎                                                                                                                        | 1685/9741 [00:05<00:24, 332.16it/s] 18%|█████████████████████████▊                                                                                                                        | 1719/9741 [00:05<00:24, 333.01it/s] 18%|██████████████████████████▎                                                                                                                       | 1753/9741 [00:06<00:23, 333.74it/s] 18%|██████████████████████████▊                                                                                                                       | 1787/9741 [00:06<00:23, 333.95it/s] 19%|███████████████████████████▎                                                                                                                      | 1821/9741 [00:06<00:25, 307.53it/s] 19%|███████████████████████████▊                                                                                                                      | 1855/9741 [00:06<00:25, 314.83it/s] 19%|████████████████████████████▎                                                                                                                     | 1889/9741 [00:06<00:24, 320.11it/s] 20%|████████████████████████████▊                                                                                                                     | 1923/9741 [00:06<00:24, 320.58it/s] 20%|█████████████████████████████▎                                                                                                                    | 1956/9741 [00:06<00:24, 321.61it/s] 20%|█████████████████████████████▊                                                                                                                    | 1989/9741 [00:06<00:23, 323.25it/s] 21%|██████████████████████████████▎                                                                                                                   | 2022/9741 [00:06<00:24, 321.39it/s] 21%|██████████████████████████████▊                                                                                                                   | 2056/9741 [00:07<00:23, 324.34it/s] 21%|███████████████████████████████▎                                                                                                                  | 2090/9741 [00:07<00:23, 326.12it/s] 22%|███████████████████████████████▊                                                                                                                  | 2124/9741 [00:07<00:23, 327.87it/s] 22%|████████████████████████████████▎                                                                                                                 | 2158/9741 [00:07<00:23, 328.80it/s] 23%|████████████████████████████████▊                                                                                                                 | 2192/9741 [00:07<00:22, 329.25it/s] 23%|█████████████████████████████████▎                                                                                                                | 2226/9741 [00:07<00:22, 330.01it/s] 23%|█████████████████████████████████▊                                                                                                                | 2260/9741 [00:07<00:22, 327.87it/s] 24%|██████████████████████████████████▍                                                                                                               | 2294/9741 [00:07<00:22, 328.80it/s] 24%|██████████████████████████████████▉                                                                                                               | 2328/9741 [00:07<00:22, 329.57it/s] 24%|███████████████████████████████████▍                                                                                                              | 2361/9741 [00:07<00:22, 328.06it/s] 25%|███████████████████████████████████▉                                                                                                              | 2395/9741 [00:08<00:22, 329.17it/s] 25%|████████████████████████████████████▍                                                                                                             | 2429/9741 [00:08<00:22, 330.14it/s] 25%|████████████████████████████████████▉                                                                                                             | 2463/9741 [00:08<00:22, 330.44it/s] 26%|█████████████████████████████████████▍                                                                                                            | 2497/9741 [00:08<00:22, 327.92it/s] 26%|█████████████████████████████████████▉                                                                                                            | 2531/9741 [00:08<00:21, 328.91it/s] 26%|██████████████████████████████████████▍                                                                                                           | 2565/9741 [00:08<00:21, 329.58it/s] 27%|██████████████████████████████████████▉                                                                                                           | 2598/9741 [00:08<00:21, 329.58it/s] 27%|███████████████████████████████████████▍                                                                                                          | 2631/9741 [00:08<00:21, 328.78it/s] 27%|███████████████████████████████████████▉                                                                                                          | 2664/9741 [00:08<00:21, 327.05it/s] 28%|████████████████████████████████████████▍                                                                                                         | 2697/9741 [00:08<00:21, 324.72it/s] 28%|████████████████████████████████████████▉                                                                                                         | 2731/9741 [00:09<00:21, 326.52it/s] 28%|█████████████████████████████████████████▍                                                                                                        | 2765/9741 [00:09<00:21, 327.79it/s] 29%|█████████████████████████████████████████▉                                                                                                        | 2798/9741 [00:09<00:21, 328.37it/s] 29%|██████████████████████████████████████████▍                                                                                                       | 2832/9741 [00:09<00:20, 329.10it/s] 29%|██████████████████████████████████████████▉                                                                                                       | 2865/9741 [00:09<00:20, 329.02it/s] 30%|███████████████████████████████████████████▍                                                                                                      | 2899/9741 [00:09<00:20, 329.70it/s] 30%|███████████████████████████████████████████▉                                                                                                      | 2932/9741 [00:09<00:20, 326.91it/s] 30%|████████████████████████████████████████████▍                                                                                                     | 2966/9741 [00:09<00:20, 327.95it/s] 31%|████████████████████████████████████████████▉                                                                                                     | 3000/9741 [00:09<00:20, 329.21it/s] 31%|█████████████████████████████████████████████▍                                                                                                    | 3033/9741 [00:09<00:20, 328.86it/s] 31%|█████████████████████████████████████████████▉                                                                                                    | 3066/9741 [00:10<00:20, 327.96it/s] 32%|██████████████████████████████████████████████▍                                                                                                   | 3100/9741 [00:10<00:20, 328.93it/s] 32%|██████████████████████████████████████████████▉                                                                                                   | 3134/9741 [00:10<00:20, 329.76it/s] 33%|███████████████████████████████████████████████▍                                                                                                  | 3167/9741 [00:10<00:20, 326.96it/s] 33%|███████████████████████████████████████████████▉                                                                                                  | 3201/9741 [00:10<00:19, 328.60it/s] 33%|████████████████████████████████████████████████▍                                                                                                 | 3234/9741 [00:10<00:19, 328.93it/s] 34%|████████████████████████████████████████████████▉                                                                                                 | 3268/9741 [00:10<00:19, 329.66it/s] 34%|█████████████████████████████████████████████████▍                                                                                                | 3302/9741 [00:10<00:19, 329.80it/s] 34%|█████████████████████████████████████████████████▉                                                                                                | 3335/9741 [00:10<00:19, 329.75it/s] 35%|██████████████████████████████████████████████████▍                                                                                               | 3369/9741 [00:11<00:19, 329.98it/s] 35%|██████████████████████████████████████████████████▉                                                                                               | 3402/9741 [00:11<00:19, 327.32it/s] 35%|███████████████████████████████████████████████████▍                                                                                              | 3435/9741 [00:11<00:19, 327.98it/s] 36%|███████████████████████████████████████████████████▉                                                                                              | 3469/9741 [00:11<00:19, 328.60it/s] 36%|████████████████████████████████████████████████████▍                                                                                             | 3502/9741 [00:11<00:18, 328.85it/s] 36%|████████████████████████████████████████████████████▉                                                                                             | 3535/9741 [00:11<00:18, 328.81it/s] 37%|█████████████████████████████████████████████████████▍                                                                                            | 3569/9741 [00:11<00:18, 329.20it/s] 37%|█████████████████████████████████████████████████████▉                                                                                            | 3602/9741 [00:11<00:18, 329.39it/s] 37%|██████████████████████████████████████████████████████▍                                                                                           | 3635/9741 [00:11<00:18, 327.11it/s] 38%|██████████████████████████████████████████████████████▉                                                                                           | 3668/9741 [00:11<00:18, 327.87it/s] 38%|███████████████████████████████████████████████████████▍                                                                                          | 3702/9741 [00:12<00:18, 328.58it/s] 38%|███████████████████████████████████████████████████████▉                                                                                          | 3735/9741 [00:12<00:18, 328.52it/s] 39%|████████████████████████████████████████████████████████▍                                                                                         | 3768/9741 [00:12<00:18, 328.41it/s] 39%|████████████████████████████████████████████████████████▉                                                                                         | 3801/9741 [00:12<00:18, 328.66it/s] 39%|█████████████████████████████████████████████████████████▍                                                                                        | 3834/9741 [00:12<00:18, 326.49it/s] 40%|█████████████████████████████████████████████████████████▉                                                                                        | 3867/9741 [00:12<00:17, 327.14it/s] 40%|██████████████████████████████████████████████████████████▍                                                                                       | 3900/9741 [00:12<00:17, 327.81it/s] 40%|██████████████████████████████████████████████████████████▉                                                                                       | 3934/9741 [00:12<00:17, 328.77it/s] 41%|███████████████████████████████████████████████████████████▍                                                                                      | 3968/9741 [00:12<00:17, 329.28it/s] 41%|███████████████████████████████████████████████████████████▉                                                                                      | 4002/9741 [00:12<00:17, 329.72it/s] 41%|████████████████████████████████████████████████████████████▍                                                                                     | 4035/9741 [00:13<00:17, 328.85it/s] 42%|████████████████████████████████████████████████████████████▉                                                                                     | 4068/9741 [00:13<00:17, 326.63it/s] 42%|█████████████████████████████████████████████████████████████▍                                                                                    | 4102/9741 [00:13<00:17, 327.96it/s] 42%|█████████████████████████████████████████████████████████████▉                                                                                    | 4135/9741 [00:13<00:17, 328.54it/s] 43%|██████████████████████████████████████████████████████████████▍                                                                                   | 4168/9741 [00:13<00:16, 328.85it/s] 43%|██████████████████████████████████████████████████████████████▉                                                                                   | 4201/9741 [00:13<00:16, 328.44it/s] 43%|███████████████████████████████████████████████████████████████▍                                                                                  | 4234/9741 [00:13<00:16, 328.76it/s] 44%|███████████████████████████████████████████████████████████████▉                                                                                  | 4267/9741 [00:13<00:16, 329.05it/s] 44%|████████████████████████████████████████████████████████████████▍                                                                                 | 4300/9741 [00:13<00:16, 325.89it/s] 44%|████████████████████████████████████████████████████████████████▉                                                                                 | 4333/9741 [00:13<00:16, 327.08it/s] 45%|█████████████████████████████████████████████████████████████████▍                                                                                | 4367/9741 [00:14<00:16, 327.98it/s] 45%|█████████████████████████████████████████████████████████████████▉                                                                                | 4401/9741 [00:14<00:16, 328.70it/s] 46%|██████████████████████████████████████████████████████████████████▍                                                                               | 4434/9741 [00:14<00:16, 328.08it/s] 46%|██████████████████████████████████████████████████████████████████▉                                                                               | 4467/9741 [00:14<00:16, 328.44it/s] 46%|███████████████████████████████████████████████████████████████████▍                                                                              | 4501/9741 [00:14<00:15, 329.03it/s] 47%|███████████████████████████████████████████████████████████████████▉                                                                              | 4534/9741 [00:14<00:17, 297.11it/s] 47%|████████████████████████████████████████████████████████████████████▍                                                                             | 4567/9741 [00:14<00:16, 306.11it/s] 47%|████████████████████████████████████████████████████████████████████▉                                                                             | 4600/9741 [00:14<00:16, 312.35it/s] 48%|█████████████████████████████████████████████████████████████████████▍                                                                            | 4633/9741 [00:14<00:16, 317.32it/s] 48%|█████████████████████████████████████████████████████████████████████▉                                                                            | 4666/9741 [00:14<00:15, 320.89it/s] 48%|██████████████████████████████████████████████████████████████████████▍                                                                           | 4700/9741 [00:15<00:15, 323.91it/s] 49%|██████████████████████████████████████████████████████████████████████▉                                                                           | 4734/9741 [00:15<00:15, 326.07it/s] 49%|███████████████████████████████████████████████████████████████████████▍                                                                          | 4767/9741 [00:15<00:23, 212.43it/s] 49%|███████████████████████████████████████████████████████████████████████▉                                                                          | 4801/9741 [00:15<00:20, 238.72it/s] 50%|████████████████████████████████████████████████████████████████████████▍                                                                         | 4835/9741 [00:15<00:18, 261.00it/s] 50%|████████████████████████████████████████████████████████████████████████▉                                                                         | 4869/9741 [00:15<00:17, 278.73it/s] 50%|█████████████████████████████████████████████████████████████████████████▍                                                                        | 4903/9741 [00:15<00:16, 293.05it/s] 51%|█████████████████████████████████████████████████████████████████████████▉                                                                        | 4937/9741 [00:15<00:15, 303.72it/s] 51%|██████████████████████████████████████████████████████████████████████████▍                                                                       | 4970/9741 [00:16<00:15, 309.48it/s] 51%|███████████████████████████████████████████████████████████████████████████                                                                       | 5004/9741 [00:16<00:14, 316.12it/s] 52%|███████████████████████████████████████████████████████████████████████████▌                                                                      | 5038/9741 [00:16<00:14, 320.99it/s] 52%|████████████████████████████████████████████████████████████████████████████                                                                      | 5071/9741 [00:16<00:14, 321.69it/s] 52%|████████████████████████████████████████████████████████████████████████████▌                                                                     | 5105/9741 [00:16<00:14, 324.98it/s] 53%|█████████████████████████████████████████████████████████████████████████████                                                                     | 5139/9741 [00:16<00:14, 327.05it/s] 53%|█████████████████████████████████████████████████████████████████████████████▌                                                                    | 5172/9741 [00:16<00:14, 326.19it/s] 53%|██████████████████████████████████████████████████████████████████████████████                                                                    | 5206/9741 [00:16<00:13, 327.92it/s] 54%|██████████████████████████████████████████████████████████████████████████████▌                                                                   | 5240/9741 [00:16<00:13, 329.34it/s] 54%|███████████████████████████████████████████████████████████████████████████████                                                                   | 5274/9741 [00:17<00:13, 330.36it/s] 54%|███████████████████████████████████████████████████████████████████████████████▌                                                                  | 5308/9741 [00:17<00:13, 330.55it/s] 55%|████████████████████████████████████████████████████████████████████████████████                                                                  | 5342/9741 [00:17<00:13, 329.86it/s] 55%|████████████████████████████████████████████████████████████████████████████████▌                                                                 | 5376/9741 [00:17<00:13, 329.82it/s] 56%|█████████████████████████████████████████████████████████████████████████████████                                                                 | 5410/9741 [00:17<00:13, 327.16it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▌                                                                | 5443/9741 [00:17<00:13, 327.65it/s] 56%|██████████████████████████████████████████████████████████████████████████████████                                                                | 5477/9741 [00:17<00:12, 328.52it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▌                                                               | 5511/9741 [00:17<00:12, 331.57it/s] 57%|███████████████████████████████████████████████████████████████████████████████████                                                               | 5545/9741 [00:17<00:12, 333.72it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▌                                                              | 5579/9741 [00:17<00:12, 335.06it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▏                                                             | 5613/9741 [00:18<00:12, 336.04it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▋                                                             | 5647/9741 [00:18<00:12, 331.38it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▏                                                            | 5681/9741 [00:18<00:12, 333.86it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▋                                                            | 5715/9741 [00:18<00:12, 335.39it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▏                                                           | 5749/9741 [00:18<00:11, 336.61it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▋                                                           | 5783/9741 [00:18<00:11, 337.40it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▏                                                          | 5817/9741 [00:18<00:11, 338.11it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▋                                                          | 5851/9741 [00:18<00:11, 335.48it/s] 60%|████████████████████████████████████████████████████████████████████████████████████████▏                                                         | 5885/9741 [00:18<00:11, 336.63it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▋                                                         | 5919/9741 [00:18<00:11, 337.35it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▏                                                        | 5953/9741 [00:19<00:11, 337.63it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▋                                                        | 5987/9741 [00:19<00:11, 338.18it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▏                                                       | 6021/9741 [00:19<00:11, 337.94it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▊                                                       | 6055/9741 [00:19<00:10, 338.32it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▎                                                      | 6089/9741 [00:19<00:10, 335.87it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▊                                                      | 6123/9741 [00:19<00:10, 336.39it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▎                                                     | 6157/9741 [00:19<00:10, 336.75it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▊                                                     | 6191/9741 [00:19<00:10, 337.47it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▎                                                    | 6225/9741 [00:19<00:10, 334.92it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▊                                                    | 6259/9741 [00:19<00:10, 335.60it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▎                                                   | 6293/9741 [00:20<00:10, 336.83it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▊                                                   | 6327/9741 [00:20<00:10, 334.33it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▎                                                  | 6361/9741 [00:20<00:10, 335.24it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▊                                                  | 6395/9741 [00:20<00:09, 335.91it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▎                                                 | 6429/9741 [00:20<00:09, 336.38it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▊                                                 | 6463/9741 [00:20<00:09, 336.41it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▍                                                | 6497/9741 [00:20<00:09, 337.22it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▉                                                | 6531/9741 [00:20<00:09, 335.30it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▍                                               | 6565/9741 [00:20<00:09, 336.61it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                                               | 6599/9741 [00:20<00:09, 337.24it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▍                                              | 6634/9741 [00:21<00:09, 338.62it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▉                                              | 6668/9741 [00:21<00:09, 325.02it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▍                                             | 6702/9741 [00:21<00:09, 328.60it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▉                                             | 6735/9741 [00:21<00:09, 322.04it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████▍                                            | 6768/9741 [00:21<00:09, 322.99it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▉                                            | 6802/9741 [00:21<00:08, 327.08it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▍                                           | 6837/9741 [00:21<00:08, 331.24it/s] 71%|██████████████████████████████████████████████████████████████████████████████████████████████████████▉                                           | 6872/9741 [00:21<00:08, 334.11it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▌                                          | 6907/9741 [00:21<00:08, 336.30it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████                                          | 6942/9741 [00:22<00:08, 337.60it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                         | 6977/9741 [00:22<00:08, 338.50it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████                                         | 7011/9741 [00:22<00:08, 336.07it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                        | 7046/9741 [00:22<00:07, 337.67it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                       | 7081/9741 [00:22<00:07, 338.74it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                       | 7116/9741 [00:22<00:07, 339.62it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                      | 7151/9741 [00:22<00:07, 340.19it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                      | 7186/9741 [00:22<00:07, 340.46it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                     | 7221/9741 [00:22<00:07, 337.92it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                     | 7256/9741 [00:22<00:07, 338.85it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                    | 7291/9741 [00:23<00:07, 339.71it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                    | 7326/9741 [00:23<00:07, 340.21it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                   | 7361/9741 [00:23<00:07, 338.07it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                   | 7396/9741 [00:23<00:06, 338.87it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                  | 7431/9741 [00:23<00:06, 339.23it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                  | 7465/9741 [00:23<00:07, 288.28it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                 | 7500/9741 [00:23<00:07, 302.39it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                 | 7534/9741 [00:23<00:07, 312.35it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                | 7569/9741 [00:23<00:06, 320.57it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                | 7604/9741 [00:24<00:06, 326.42it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                               | 7639/9741 [00:24<00:06, 330.63it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████                               | 7673/9741 [00:24<00:06, 330.93it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                              | 7708/9741 [00:24<00:06, 333.93it/s] 79%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                              | 7743/9741 [00:24<00:05, 336.20it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                             | 7778/9741 [00:24<00:05, 337.74it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                             | 7813/9741 [00:24<00:05, 338.85it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                            | 7848/9741 [00:24<00:05, 339.43it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                           | 7883/9741 [00:24<00:05, 339.73it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 7918/9741 [00:24<00:05, 335.49it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                          | 7952/9741 [00:25<00:05, 336.75it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                          | 7986/9741 [00:25<00:05, 337.39it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                         | 8020/9741 [00:25<00:05, 337.58it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                         | 8054/9741 [00:25<00:04, 338.11it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 8088/9741 [00:25<00:05, 328.31it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                        | 8121/9741 [00:25<00:04, 328.26it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                       | 8155/9741 [00:25<00:04, 331.08it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                       | 8189/9741 [00:25<00:04, 333.33it/s] 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                      | 8223/9741 [00:25<00:04, 335.05it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                      | 8257/9741 [00:25<00:04, 336.12it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                     | 8291/9741 [00:26<00:04, 336.86it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                     | 8325/9741 [00:26<00:04, 336.96it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                    | 8359/9741 [00:26<00:04, 334.82it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                    | 8393/9741 [00:26<00:04, 335.64it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                   | 8427/9741 [00:26<00:03, 334.84it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                   | 8461/9741 [00:26<00:03, 327.17it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                  | 8496/9741 [00:26<00:03, 331.37it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 8531/9741 [00:26<00:03, 334.02it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                 | 8566/9741 [00:26<00:03, 336.18it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                 | 8600/9741 [00:26<00:03, 334.94it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                | 8635/9741 [00:27<00:03, 336.53it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                | 8669/9741 [00:27<00:03, 335.25it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍               | 8704/9741 [00:27<00:03, 337.02it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉               | 8739/9741 [00:27<00:02, 338.02it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌              | 8774/9741 [00:27<00:02, 338.76it/s] 90%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████              | 8808/9741 [00:27<00:02, 335.04it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌             | 8842/9741 [00:27<00:02, 335.85it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████             | 8877/9741 [00:27<00:02, 337.14it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 8912/9741 [00:27<00:02, 338.05it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████            | 8947/9741 [00:28<00:02, 338.98it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌           | 8982/9741 [00:28<00:02, 339.58it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏          | 9017/9741 [00:28<00:02, 339.90it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋          | 9051/9741 [00:28<00:02, 337.22it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏         | 9086/9741 [00:28<00:01, 338.32it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋         | 9121/9741 [00:28<00:01, 338.98it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏        | 9155/9741 [00:28<00:01, 339.17it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋        | 9189/9741 [00:28<00:01, 338.70it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏       | 9223/9741 [00:28<00:01, 337.64it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋       | 9257/9741 [00:28<00:01, 335.50it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎      | 9292/9741 [00:29<00:01, 337.03it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊      | 9327/9741 [00:29<00:01, 337.97it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎     | 9361/9741 [00:29<00:01, 338.46it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊     | 9395/9741 [00:29<00:01, 337.83it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎    | 9429/9741 [00:29<00:00, 338.39it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊    | 9463/9741 [00:29<00:00, 338.77it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎   | 9497/9741 [00:29<00:00, 336.38it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊   | 9531/9741 [00:29<00:00, 337.39it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎  | 9565/9741 [00:29<00:00, 337.45it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊  | 9599/9741 [00:29<00:00, 336.90it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍ | 9633/9741 [00:30<00:00, 337.55it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉ | 9667/9741 [00:30<00:00, 338.10it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍| 9701/9741 [00:30<00:00, 338.31it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉| 9735/9741 [00:30<00:00, 335.63it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:30<00:00, 320.85it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.07s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.06s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.17s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.49s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.88s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.08s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.35s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.40s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.28s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.46s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.99s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.97s/it]
[2023-08-10 21:32:17,331] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-10 21:32:25,946] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 21:32:25,947] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f68a4a88e80>
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 21:32:25,948] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f68a47f0910>
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 21:32:25,949] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 21:32:25,949] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.567448616027832 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Rationales: Mary added a total of 7 stickers/page * 6 pages= <<7*6=42>>42 stickers to the 6 other pages.
In total, Mary added 3 large stickers + 42 stickers = <<3+42=45>>45 stickers to her journal.
Since she started with 89 stickers, she now has 89 - 45 = <<89-45=44>>44 stickers left.
#### 44
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Rationales: If he babysits for 2 hours at $7 per hour, he will earn 2*7 = $<<2*7=14>>14
This week he will earn $5 allowance, $10 mowing the lawn and $14 from babysitting for a total of 5+10+14 = $<<5+10+14=29>>29
If we add the $29 he will earn to his $65 savings, he will have a total of 29 + 65 = $<<29+65=94>>94
The bike costs $100 and he will have $94 leaving $100-$94 = $<<100-94=6>>6 more that he will need to earn
#### 6
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Rationales: His kangaroos have a total of 23*2=<<23*2=46>>46 legs
He has 23*3=<<23*3=69>>69 goats
The goats have 69*4=<<69*4=276>>276 legs
So in total his animals have 276+46=<<276+46=322>>322 legs
#### 322
Answer: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Rationales: After buying a hat, Josh has $20 - $10 = $<<20-10=10>>10
After buying a pencil, Josh has $10 - $2 = $<<10-2=8>>8
The total cost of cookies is 4 * $1.25 = $<<4*1.25=5>>5
After buying the cookies, Josh has $8 - $5 = $<<8-5=3>>3
#### 3
Answer: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Rationales: The old team per round record is 1,148 because 287 x 4 = <<1148=1148>>1,148
The team season record is 11,480 because 10 x 1,248 = 11,480
They need 1,040 points in the final round to tie the record because 11,480 - 10,440 = <<11480-10440=1040>>1,040
They need to average 260 points each because 1,040 / 4 = <<1040/4=260>>260
This is 27 points less than the current record average because 287 - 260 = <<27=27>>27
#### 27
Answer: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Rationales: Max finished history in 20 * 2 = <<20*2=40>>40 minutes.
Finishing geography took the most time, which is 40 * 3 = <<40*3=120>>120 minutes.
In total, for all three subjects, Max needed 20 + 40 + 120 = <<20+40+120=180>>180 minutes.
#### 180
Answer: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Rationales: If Sophia ate 1/6 of the pie, then 6/6 - 1/6 = 5/6 is left in the fridge.
Let x be the pie's original weight.
The current weight of the pie can be described by 5x/6=1200 grams
So, 5x=7200.
And, the original weight is x = <<1440=1440>>1440 grams.
So, Sophia ate 1440 grams original - 1200 grams after= <<1440-1200=240>>240 grams of pie.
#### 240
Answer: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Rationales: After using the coupon, the final price comes to 67 - 4 = <<67-4=63>>63 dollars.
With three people, they each need to pay 63 / 3 = <<63/3=21>>21 dollars each.
#### 21
Answer: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Rationales: If in six years Tom's brother will be 30 years old, he is currently 30-6 = <<30-6=24>>24 years old.
Since Tom's brother is 4 times as old as Tom's dog, Tom's dog is 24/4 = <<24/4=6>>6 years old currently.
Tom's dog will be 6+6 = <<6+6=12>>12 years old in six years.
#### 12
Answer: 12

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid


############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o9-tgsm8k-s1-rTrue
Loading extension module utils...
Time to load utils op: 0.5048487186431885 seconds
Loading extension module utils...
Time to load utils op: 0.5046327114105225 seconds
Loading extension module utils...
Time to load utils op: 0.6050076484680176 seconds
Traceback (most recent call last):
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 125, in <module>
    main()
  File "/home/ylu130/workspace/in-context-generalization/inference.py", line 122, in main
    evaluate_main(args, tokenizer, model, dataset["test"], device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 139, in evaluate_main
    lm_loss, query_ids, response_ids, rest_ids = run_model(args, tokenizer, model, dataset, device)
  File "/home/ylu130/workspace/in-context-generalization/inference_main.py", line 116, in run_model
    gen_out = model.generate(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 1454, in generate
    return self.sample(
  File "/home/ylu130/workspace/in-context-generalization/transformers/src/transformers/generation/utils.py", line 2568, in sample
    next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1)
RuntimeError: probability tensor contains either `inf`, `nan` or element < 0
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 2632351 closing signal SIGTERM
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 2632352 closing signal SIGTERM
WARNING:torch.distributed.elastic.multiprocessing.api:Sending process 2632353 closing signal SIGTERM
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 3 (pid: 2632354) of binary: /home/ylu130/.conda/envs/distllm/bin/python
Traceback (most recent call last):
  File "/home/ylu130/.conda/envs/distllm/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 761, in main
    run(args)
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/run.py", line 752, in run
    elastic_launch(
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/ylu130/.conda/envs/distllm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 245, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
/home/ylu130/workspace/in-context-generalization/inference.py FAILED
------------------------------------------------------------
Failures:
  <NO_OTHER_FAILURES>
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2023-08-10_21:32:36
  host      : ia1.wse.jhu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 2632354)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s1-rFalse --seed 1 --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 21:32:40,649] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  2%|███▎                                                                                                                                              | 225/9741 [00:00<00:04, 2244.01it/s]  5%|██████▊                                                                                                                                           | 451/9741 [00:00<00:04, 2252.24it/s]  7%|██████████▏                                                                                                                                       | 678/9741 [00:00<00:04, 2259.89it/s]  9%|█████████████▌                                                                                                                                    | 907/9741 [00:00<00:03, 2271.66it/s] 12%|████████████████▉                                                                                                                                | 1138/9741 [00:00<00:03, 2283.15it/s] 14%|████████████████████▎                                                                                                                            | 1367/9741 [00:00<00:03, 2274.68it/s] 16%|███████████████████████▋                                                                                                                         | 1595/9741 [00:00<00:03, 2275.87it/s] 19%|███████████████████████████▏                                                                                                                     | 1823/9741 [00:00<00:03, 2263.69it/s] 21%|██████████████████████████████▌                                                                                                                  | 2050/9741 [00:00<00:03, 2222.01it/s] 23%|█████████████████████████████████▊                                                                                                               | 2275/9741 [00:01<00:03, 2230.01it/s] 26%|█████████████████████████████████████▎                                                                                                           | 2503/9741 [00:01<00:03, 2244.94it/s] 28%|████████████████████████████████████████▌                                                                                                        | 2729/9741 [00:01<00:03, 2246.99it/s] 30%|████████████████████████████████████████████                                                                                                     | 2956/9741 [00:01<00:03, 2251.07it/s] 33%|███████████████████████████████████████████████▍                                                                                                 | 3184/9741 [00:01<00:02, 2259.65it/s] 35%|██████████████████████████████████████████████████▊                                                                                              | 3413/9741 [00:01<00:02, 2267.88it/s] 37%|██████████████████████████████████████████████████████▏                                                                                          | 3640/9741 [00:01<00:02, 2264.65it/s] 40%|█████████████████████████████████████████████████████████▌                                                                                       | 3867/9741 [00:01<00:02, 2265.51it/s] 42%|████████████████████████████████████████████████████████████▉                                                                                    | 4095/9741 [00:01<00:02, 2268.65it/s] 44%|████████████████████████████████████████████████████████████████▎                                                                                | 4322/9741 [00:01<00:02, 2264.43it/s] 47%|███████████████████████████████████████████████████████████████████▋                                                                             | 4549/9741 [00:02<00:02, 2237.79it/s] 49%|███████████████████████████████████████████████████████████████████████                                                                          | 4773/9741 [00:02<00:02, 1869.98it/s] 51%|██████████████████████████████████████████████████████████████████████████▍                                                                      | 4998/9741 [00:02<00:02, 1968.18it/s] 54%|█████████████████████████████████████████████████████████████████████████████▋                                                                   | 5223/9741 [00:02<00:02, 2043.05it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▏                                                               | 5450/9741 [00:02<00:02, 2105.35it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▌                                                            | 5685/9741 [00:02<00:01, 2172.78it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▋                                                        | 5959/9741 [00:02<00:01, 2336.51it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████                                                   | 6321/9741 [00:02<00:01, 2710.75it/s] 69%|███████████████████████████████████████████████████████████████████████████████████████████████████▍                                             | 6683/9741 [00:02<00:01, 2978.33it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                        | 7042/9741 [00:02<00:00, 3157.17it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                  | 7407/9741 [00:03<00:00, 3300.84it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                             | 7742/9741 [00:03<00:00, 3315.05it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                        | 8107/9741 [00:03<00:00, 3413.77it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                   | 8472/9741 [00:03<00:00, 3481.47it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍             | 8833/9741 [00:03<00:00, 3519.27it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉        | 9196/9741 [00:03<00:00, 3549.38it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏  | 9556/9741 [00:03<00:00, 3563.81it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:03<00:00, 2605.94it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  5.00s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.21s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.05s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.28s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.14s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.31s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.17s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.36s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.51s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.67s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.59s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]
[2023-08-10 21:33:35,823] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.86s/it]
[2023-08-10 21:33:45,885] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 21:33:45,886] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 21:33:45,886] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 21:33:45,886] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 21:33:45,886] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 21:33:45,886] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 21:33:45,886] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 21:33:45,886] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 21:33:45,886] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 21:33:45,886] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 21:33:45,886] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fa1b8ee8e80>
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fa1b3786910>
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 21:33:45,887] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 21:33:45,888] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 21:33:45,888] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 21:33:45,888] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 21:33:45,888] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.36385488510131836 seconds
Loading extension module utils...
Time to load utils op: 0.304401159286499 seconds
Loading extension module utils...
Time to load utils op: 0.40437841415405273 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Answer: 44

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.30427980422973633 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:58<47:25, 58.08s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:56<46:38, 58.30s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:54<45:25, 57.99s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:30<37:49, 49.35s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:17<36:31, 48.71s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [05:15<37:57, 51.76s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [06:06<36:49, 51.39s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [07:03<37:20, 53.35s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [08:01<37:25, 54.78s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:37<32:34, 48.87s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [09:35<33:37, 51.74s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [10:32<33:51, 53.47s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [11:29<33:32, 54.39s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [12:26<33:03, 55.11s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [13:14<30:59, 53.14s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [14:13<30:59, 54.68s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [15:11<30:41, 55.80s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [15:59<28:29, 53.41s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [16:58<28:25, 55.03s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [17:28<23:48, 47.62s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [18:25<24:22, 50.42s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [19:24<24:41, 52.93s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [20:22<24:34, 54.60s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [21:20<24:03, 55.53s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [22:12<22:41, 54.48s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [22:38<18:20, 45.86s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [23:36<18:58, 49.50s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [24:29<18:32, 50.55s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [25:26<18:24, 52.60s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [26:22<17:55, 53.76s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [26:50<14:32, 45.93s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [27:49<14:55, 49.73s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [28:47<14:47, 52.18s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [29:39<13:54, 52.15s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [30:11<11:34, 46.29s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [30:33<09:04, 38.88s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [30:48<06:52, 31.70s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [31:20<06:22, 31.86s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [32:18<07:15, 39.55s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [32:39<05:40, 34.09s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [33:20<05:25, 36.15s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [34:18<05:40, 42.60s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [35:00<04:57, 42.49s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [35:58<04:43, 47.21s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [36:56<04:11, 50.32s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [37:37<03:10, 47.58s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [38:35<02:32, 50.73s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [39:21<01:38, 49.24s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [39:42<00:40, 40.83s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [40:40<00:00, 46.04s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [40:40<00:00, 48.81s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.9856} | lm_loss 7.7637 | avg. gen lenth: 189.752
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s1-rFalse --seed 1 --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-10 22:14:34,717] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|█▉                                                                                                                                                | 131/9741 [00:00<00:07, 1301.38it/s]  3%|███▉                                                                                                                                              | 262/9741 [00:00<00:07, 1304.90it/s]  4%|█████▉                                                                                                                                            | 394/9741 [00:00<00:07, 1311.49it/s]  5%|███████▉                                                                                                                                          | 526/9741 [00:00<00:07, 1314.36it/s]  7%|█████████▊                                                                                                                                        | 658/9741 [00:00<00:06, 1314.65it/s]  8%|███████████▊                                                                                                                                      | 792/9741 [00:00<00:06, 1319.97it/s]  9%|█████████████▊                                                                                                                                    | 925/9741 [00:00<00:06, 1320.58it/s] 11%|███████████████▊                                                                                                                                 | 1059/9741 [00:00<00:06, 1323.74it/s] 12%|█████████████████▋                                                                                                                               | 1192/9741 [00:00<00:06, 1295.62it/s] 14%|███████████████████▋                                                                                                                             | 1323/9741 [00:01<00:06, 1299.08it/s] 15%|█████████████████████▋                                                                                                                           | 1454/9741 [00:01<00:06, 1302.18it/s] 16%|███████████████████████▌                                                                                                                         | 1586/9741 [00:01<00:06, 1305.24it/s] 18%|█████████████████████████▌                                                                                                                       | 1719/9741 [00:01<00:06, 1310.41it/s] 19%|███████████████████████████▌                                                                                                                     | 1851/9741 [00:01<00:06, 1282.97it/s] 20%|█████████████████████████████▌                                                                                                                   | 1983/9741 [00:01<00:05, 1293.16it/s] 22%|███████████████████████████████▍                                                                                                                 | 2114/9741 [00:01<00:05, 1297.78it/s] 23%|█████████████████████████████████▍                                                                                                               | 2246/9741 [00:01<00:05, 1302.93it/s] 24%|███████████████████████████████████▍                                                                                                             | 2378/9741 [00:01<00:05, 1307.78it/s] 26%|█████████████████████████████████████▎                                                                                                           | 2509/9741 [00:01<00:05, 1303.93it/s] 27%|███████████████████████████████████████▎                                                                                                         | 2641/9741 [00:02<00:05, 1305.82it/s] 28%|█████████████████████████████████████████▎                                                                                                       | 2772/9741 [00:02<00:05, 1305.78it/s] 30%|███████████████████████████████████████████▍                                                                                                     | 2917/9741 [00:02<00:05, 1348.14it/s] 32%|██████████████████████████████████████████████▍                                                                                                  | 3117/9741 [00:02<00:04, 1542.01it/s] 34%|█████████████████████████████████████████████████▍                                                                                               | 3319/9741 [00:02<00:03, 1683.49it/s] 36%|████████████████████████████████████████████████████▍                                                                                            | 3519/9741 [00:02<00:03, 1776.68it/s] 38%|███████████████████████████████████████████████████████▎                                                                                         | 3720/9741 [00:02<00:03, 1845.52it/s] 40%|██████████████████████████████████████████████████████████▍                                                                                      | 3922/9741 [00:02<00:03, 1896.23it/s] 42%|█████████████████████████████████████████████████████████████▍                                                                                   | 4124/9741 [00:02<00:02, 1932.39it/s] 44%|████████████████████████████████████████████████████████████████▍                                                                                | 4325/9741 [00:02<00:02, 1955.42it/s] 46%|███████████████████████████████████████████████████████████████████▎                                                                             | 4521/9741 [00:03<00:02, 1936.39it/s] 48%|██████████████████████████████████████████████████████████████████████▎                                                                          | 4723/9741 [00:03<00:02, 1959.78it/s] 51%|█████████████████████████████████████████████████████████████████████████▏                                                                       | 4920/9741 [00:03<00:03, 1516.76it/s] 53%|████████████████████████████████████████████████████████████████████████████▏                                                                    | 5120/9741 [00:03<00:02, 1635.14it/s] 55%|███████████████████████████████████████████████████████████████████████████████▏                                                                 | 5321/9741 [00:03<00:02, 1731.73it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▏                                                              | 5524/9741 [00:03<00:02, 1812.22it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▎                                                           | 5732/9741 [00:03<00:02, 1886.31it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▍                                                        | 5942/9741 [00:03<00:01, 1945.39it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▌                                                     | 6152/9741 [00:03<00:01, 1987.75it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▋                                                  | 6360/9741 [00:04<00:01, 2014.50it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▊                                               | 6568/9741 [00:04<00:01, 2032.29it/s] 70%|████████████████████████████████████████████████████████████████████████████████████████████████████▉                                            | 6779/9741 [00:04<00:01, 2052.81it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████                                         | 6990/9741 [00:04<00:01, 2067.93it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                     | 7202/9741 [00:04<00:01, 2081.21it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                  | 7412/9741 [00:04<00:01, 2084.74it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                               | 7621/9741 [00:04<00:01, 2051.54it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                            | 7830/9741 [00:04<00:00, 2061.51it/s] 83%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                         | 8039/9741 [00:04<00:00, 2067.98it/s] 85%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                      | 8249/9741 [00:04<00:00, 2075.55it/s] 87%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                   | 8459/9741 [00:05<00:00, 2080.33it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                | 8668/9741 [00:05<00:00, 2082.94it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏            | 8878/9741 [00:05<00:00, 2085.92it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎         | 9087/9741 [00:05<00:00, 2082.69it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍      | 9297/9741 [00:05<00:00, 2086.07it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌   | 9507/9741 [00:05<00:00, 2088.33it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋| 9716/9741 [00:05<00:00, 2087.38it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:05<00:00, 1723.55it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.46s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.52s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:06<00:12,  6.15s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:06<00:12,  6.31s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.28s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.65s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
[2023-08-10 22:15:31,912] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:15<00:07,  7.96s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:15<00:08,  8.02s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.03s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.19s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:20<00:00,  6.69s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:20<00:00,  6.85s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:20<00:00,  6.70s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:20<00:00,  6.88s/it]
[2023-08-10 22:15:50,811] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 22:15:50,813] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 22:15:50,813] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 22:15:50,813] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 22:15:50,813] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 22:15:50,813] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fe697b31e80>
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 22:15:50,814] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fe6ba55c910>
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 22:15:50,815] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 22:15:50,816] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 22:15:50,817] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 22:15:50,817] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 22:15:50,817] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 22:15:50,817] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.37826108932495117 seconds
Loading extension module utils...
Time to load utils op: 0.30442094802856445 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Time to load utils op: 0.4031376838684082 seconds
Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Answer: 6

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.3042421340942383 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:55<45:42, 55.97s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:52<44:53, 56.11s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:48<44:03, 56.24s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:16<34:38, 45.19s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:49<30:23, 40.51s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:45<33:37, 45.86s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:41<35:14, 49.17s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:03<28:28, 40.67s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:59<31:04, 45.48s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:54<32:17, 48.44s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:50<32:52, 50.57s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:30<30:07, 47.57s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:55<25:02, 40.61s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:51<27:08, 45.23s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:47<28:13, 48.38s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [12:42<28:33, 50.39s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [13:26<26:42, 48.57s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [14:09<24:58, 46.82s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [15:03<25:22, 49.12s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:59<25:29, 50.97s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:54<25:16, 52.30s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [17:49<24:48, 53.15s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [18:44<24:11, 53.76s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [19:21<21:06, 48.71s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [20:16<21:03, 50.53s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [21:10<20:37, 51.58s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [21:31<16:12, 42.29s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [22:25<16:52, 46.04s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [23:19<16:51, 48.19s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [24:09<16:14, 48.72s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [24:26<12:29, 39.45s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [25:23<13:20, 44.46s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [26:18<13:33, 47.88s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [26:28<09:44, 36.52s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:59<08:43, 34.88s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [27:54<09:32, 40.90s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [28:06<06:58, 32.23s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [29:02<07:52, 39.36s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:59<08:08, 44.40s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [30:54<07:55, 47.56s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [31:49<07:28, 49.86s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [32:46<06:55, 51.97s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [33:40<06:08, 52.61s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [34:20<04:52, 48.78s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [35:15<04:14, 50.89s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [36:11<03:28, 52.25s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [37:07<02:39, 53.28s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [37:37<01:33, 46.58s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [38:11<00:42, 42.72s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:06<00:00, 46.36s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:06<00:00, 46.93s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.5431} | lm_loss 7.6792 | avg. gen lenth: 200.756
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s1-rFalse --seed 1 --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[2023-08-10 22:55:03,665] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|█▋                                                                                                                                                | 110/9741 [00:00<00:08, 1093.27it/s]  2%|███▎                                                                                                                                              | 220/9741 [00:00<00:08, 1095.24it/s]  3%|████▉                                                                                                                                             | 331/9741 [00:00<00:08, 1101.95it/s]  5%|██████▌                                                                                                                                           | 442/9741 [00:00<00:08, 1101.59it/s]  6%|████████▎                                                                                                                                         | 553/9741 [00:00<00:08, 1104.45it/s]  7%|█████████▉                                                                                                                                        | 664/9741 [00:00<00:08, 1104.08it/s]  8%|███████████▋                                                                                                                                      | 776/9741 [00:00<00:08, 1107.86it/s]  9%|█████████████▎                                                                                                                                    | 888/9741 [00:00<00:07, 1108.77it/s] 10%|██████████████▉                                                                                                                                   | 999/9741 [00:00<00:08, 1087.99it/s] 11%|████████████████▌                                                                                                                                | 1109/9741 [00:01<00:07, 1091.11it/s] 13%|██████████████████▏                                                                                                                              | 1220/9741 [00:01<00:07, 1096.13it/s] 14%|███████████████████▊                                                                                                                             | 1331/9741 [00:01<00:07, 1099.80it/s] 15%|█████████████████████▍                                                                                                                           | 1442/9741 [00:01<00:07, 1099.66it/s] 16%|███████████████████████                                                                                                                          | 1553/9741 [00:01<00:07, 1102.70it/s] 17%|████████████████████████▊                                                                                                                        | 1664/9741 [00:01<00:07, 1103.20it/s] 18%|██████████████████████████▍                                                                                                                      | 1776/9741 [00:01<00:07, 1105.86it/s] 19%|████████████████████████████                                                                                                                     | 1887/9741 [00:01<00:07, 1077.66it/s] 21%|█████████████████████████████▋                                                                                                                   | 1998/9741 [00:01<00:07, 1085.93it/s] 22%|███████████████████████████████▎                                                                                                                 | 2107/9741 [00:01<00:07, 1084.02it/s] 23%|█████████████████████████████████                                                                                                                | 2218/9741 [00:02<00:06, 1091.01it/s] 24%|██████████████████████████████████▋                                                                                                              | 2329/9741 [00:02<00:06, 1094.87it/s] 25%|████████████████████████████████████▎                                                                                                            | 2442/9741 [00:02<00:06, 1102.71it/s] 26%|██████████████████████████████████████                                                                                                           | 2553/9741 [00:02<00:06, 1102.08it/s] 27%|███████████████████████████████████████▋                                                                                                         | 2665/9741 [00:02<00:06, 1105.81it/s] 28%|█████████████████████████████████████████▎                                                                                                       | 2776/9741 [00:02<00:06, 1103.54it/s] 30%|███████████████████████████████████████████                                                                                                      | 2893/9741 [00:02<00:06, 1121.49it/s] 31%|█████████████████████████████████████████████▌                                                                                                   | 3062/9741 [00:02<00:05, 1290.36it/s] 33%|████████████████████████████████████████████████                                                                                                 | 3232/9741 [00:02<00:04, 1410.47it/s] 35%|██████████████████████████████████████████████████▌                                                                                              | 3400/9741 [00:02<00:04, 1490.83it/s] 37%|█████████████████████████████████████████████████████▏                                                                                           | 3570/9741 [00:03<00:03, 1551.31it/s] 38%|███████████████████████████████████████████████████████▋                                                                                         | 3739/9741 [00:03<00:03, 1592.32it/s] 40%|██████████████████████████████████████████████████████████▏                                                                                      | 3909/9741 [00:03<00:03, 1622.75it/s] 42%|████████████████████████████████████████████████████████████▋                                                                                    | 4079/9741 [00:03<00:03, 1643.09it/s] 44%|███████████████████████████████████████████████████████████████▏                                                                                 | 4249/9741 [00:03<00:03, 1658.39it/s] 45%|█████████████████████████████████████████████████████████████████▋                                                                               | 4415/9741 [00:03<00:03, 1650.47it/s] 47%|████████████████████████████████████████████████████████████████████▏                                                                            | 4581/9741 [00:03<00:03, 1610.39it/s] 49%|██████████████████████████████████████████████████████████████████████▌                                                                          | 4743/9741 [00:03<00:04, 1238.47it/s] 50%|█████████████████████████████████████████████████████████████████████████                                                                        | 4912/9741 [00:03<00:03, 1346.53it/s] 52%|███████████████████████████████████████████████████████████████████████████▋                                                                     | 5082/9741 [00:04<00:03, 1435.62it/s] 54%|██████████████████████████████████████████████████████████████████████████████▏                                                                  | 5250/9741 [00:04<00:02, 1501.15it/s] 56%|████████████████████████████████████████████████████████████████████████████████▋                                                                | 5419/9741 [00:04<00:02, 1553.16it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▎                                                             | 5593/9741 [00:04<00:02, 1604.54it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▉                                                           | 5770/9741 [00:04<00:02, 1650.89it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▍                                                        | 5945/9741 [00:04<00:02, 1678.69it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████                                                      | 6120/9741 [00:04<00:02, 1697.21it/s] 65%|█████████████████████████████████████████████████████████████████████████████████████████████▋                                                   | 6295/9741 [00:04<00:02, 1711.60it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▎                                                | 6471/9741 [00:04<00:01, 1723.23it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                                              | 6647/9741 [00:04<00:01, 1731.76it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▌                                           | 6824/9741 [00:05<00:01, 1742.15it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                        | 7000/9741 [00:05<00:01, 1747.18it/s] 74%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                      | 7178/9741 [00:05<00:01, 1755.48it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                   | 7354/9741 [00:05<00:01, 1754.69it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                 | 7530/9741 [00:05<00:01, 1718.00it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                              | 7704/9741 [00:05<00:01, 1724.17it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                           | 7877/9741 [00:05<00:01, 1713.14it/s] 83%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                         | 8050/9741 [00:05<00:00, 1716.44it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                      | 8222/9741 [00:05<00:00, 1714.35it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                    | 8397/9741 [00:05<00:00, 1723.38it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 8574/9741 [00:06<00:00, 1735.32it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏              | 8749/9741 [00:06<00:00, 1738.55it/s] 92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊            | 8925/9741 [00:06<00:00, 1743.89it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍         | 9101/9741 [00:06<00:00, 1746.12it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████       | 9278/9741 [00:06<00:00, 1750.60it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋    | 9455/9741 [00:06<00:00, 1754.13it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎ | 9631/9741 [00:06<00:00, 1754.26it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:06<00:00, 1448.13it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.41s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.46s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.81s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.30s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.51s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.48s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:14<00:07,  7.39s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.86s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.98s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.12s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.97s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.10s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:21<00:00,  7.51s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:21<00:00,  7.32s/it]
[2023-08-10 22:56:09,662] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-10 22:56:19,271] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 22:56:19,272] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 22:56:19,272] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 22:56:19,272] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 22:56:19,272] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 22:56:19,272] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f92830e5e80>
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 22:56:19,273] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f925ec99910>
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 22:56:19,274] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 22:56:19,274] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3895542621612549 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]Loading extension module utils...
Time to load utils op: 0.3041572570800781 seconds
############### Example ###############
Time to load utils op: 0.30420994758605957 seconds
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Answer: 322

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.40474367141723633 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:54<44:33, 54.56s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:25<32:29, 40.62s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:19<36:29, 46.59s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:14<38:13, 49.86s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:36<29:59, 39.99s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:30<32:45, 44.67s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:03<29:19, 40.92s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:57<31:38, 45.19s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:51<32:41, 47.84s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:44<33:03, 49.59s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:39<33:15, 51.16s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:33<32:50, 51.86s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:54<26:16, 42.62s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:49<27:46, 46.29s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:11<22:50, 39.16s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:51<22:13, 39.22s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:44<23:56, 43.53s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:39<24:58, 46.83s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:33<25:19, 49.01s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:18<23:57, 47.92s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:10<23:38, 48.91s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [17:03<23:29, 50.33s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:48<21:55, 48.73s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:42<21:48, 50.32s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [19:24<19:53, 47.76s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [20:18<19:49, 49.56s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [21:12<19:29, 50.83s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [22:06<19:00, 51.84s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [23:00<18:21, 52.47s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [23:55<17:43, 53.18s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [24:45<16:35, 52.37s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [25:25<14:33, 48.54s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [26:19<14:15, 50.31s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [27:14<13:48, 51.77s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [28:03<12:44, 50.95s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [28:36<10:35, 45.38s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [29:16<09:29, 43.78s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [30:08<09:15, 46.29s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [31:03<08:57, 48.84s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [31:56<08:23, 50.35s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [32:51<07:44, 51.60s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [33:20<05:59, 44.89s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [34:12<05:28, 46.99s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [35:06<04:53, 49.00s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [36:00<04:12, 50.52s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [36:54<03:26, 51.53s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [37:47<02:35, 51.96s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [38:41<01:45, 52.80s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [39:27<00:50, 50.47s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:42<00:00, 39.89s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:42<00:00, 47.64s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.7774} | lm_loss 7.6356 | avg. gen lenth: 206.804
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s1-rFalse --seed 1 --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[2023-08-10 23:36:42,608] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|█▍                                                                                                                                                  | 95/9741 [00:00<00:10, 946.78it/s]  2%|██▉                                                                                                                                                | 191/9741 [00:00<00:10, 951.74it/s]  3%|████▎                                                                                                                                              | 287/9741 [00:00<00:09, 950.14it/s]  4%|█████▊                                                                                                                                             | 383/9741 [00:00<00:09, 953.18it/s]  5%|███████▏                                                                                                                                           | 479/9741 [00:00<00:09, 952.10it/s]  6%|████████▋                                                                                                                                          | 575/9741 [00:00<00:09, 953.79it/s]  7%|██████████▏                                                                                                                                        | 671/9741 [00:00<00:09, 953.14it/s]  8%|███████████▌                                                                                                                                       | 767/9741 [00:00<00:09, 955.29it/s]  9%|█████████████                                                                                                                                      | 863/9741 [00:00<00:09, 939.99it/s] 10%|██████████████▍                                                                                                                                    | 958/9741 [00:01<00:09, 939.27it/s] 11%|███████████████▊                                                                                                                                  | 1054/9741 [00:01<00:09, 944.30it/s] 12%|█████████████████▏                                                                                                                                | 1149/9741 [00:01<00:09, 945.16it/s] 13%|██████████████████▋                                                                                                                               | 1244/9741 [00:01<00:08, 946.58it/s] 14%|████████████████████                                                                                                                              | 1339/9741 [00:01<00:08, 946.34it/s] 15%|█████████████████████▌                                                                                                                            | 1435/9741 [00:01<00:08, 947.64it/s] 16%|██████████████████████▉                                                                                                                           | 1531/9741 [00:01<00:08, 949.09it/s] 17%|████████████████████████▎                                                                                                                         | 1626/9741 [00:01<00:08, 949.06it/s] 18%|█████████████████████████▊                                                                                                                        | 1722/9741 [00:01<00:08, 950.91it/s] 19%|███████████████████████████▏                                                                                                                      | 1818/9741 [00:01<00:08, 917.56it/s] 20%|████████████████████████████▋                                                                                                                     | 1913/9741 [00:02<00:08, 925.60it/s] 21%|██████████████████████████████                                                                                                                    | 2009/9741 [00:02<00:08, 933.23it/s] 22%|███████████████████████████████▌                                                                                                                  | 2103/9741 [00:02<00:08, 933.32it/s] 23%|████████████████████████████████▉                                                                                                                 | 2199/9741 [00:02<00:08, 938.70it/s] 24%|██████████████████████████████████▍                                                                                                               | 2294/9741 [00:02<00:07, 939.88it/s] 25%|███████████████████████████████████▊                                                                                                              | 2390/9741 [00:02<00:07, 943.70it/s] 26%|█████████████████████████████████████▏                                                                                                            | 2485/9741 [00:02<00:07, 944.53it/s] 27%|██████████████████████████████████████▉                                                                                                          | 2615/9741 [00:02<00:06, 1049.66it/s] 28%|█████████████████████████████████████████                                                                                                        | 2759/9741 [00:02<00:05, 1163.98it/s] 30%|███████████████████████████████████████████▏                                                                                                     | 2904/9741 [00:02<00:05, 1247.99it/s] 31%|█████████████████████████████████████████████▍                                                                                                   | 3049/9741 [00:03<00:05, 1306.72it/s] 33%|███████████████████████████████████████████████▌                                                                                                 | 3194/9741 [00:03<00:04, 1346.82it/s] 34%|█████████████████████████████████████████████████▋                                                                                               | 3336/9741 [00:03<00:04, 1366.17it/s] 36%|███████████████████████████████████████████████████▊                                                                                             | 3480/9741 [00:03<00:04, 1387.89it/s] 37%|█████████████████████████████████████████████████████▉                                                                                           | 3623/9741 [00:03<00:04, 1399.11it/s] 39%|████████████████████████████████████████████████████████                                                                                         | 3767/9741 [00:03<00:04, 1409.64it/s] 40%|██████████████████████████████████████████████████████████▏                                                                                      | 3910/9741 [00:03<00:04, 1413.02it/s] 42%|████████████████████████████████████████████████████████████▎                                                                                    | 4054/9741 [00:03<00:04, 1419.71it/s] 43%|██████████████████████████████████████████████████████████████▍                                                                                  | 4198/9741 [00:03<00:03, 1422.99it/s] 45%|████████████████████████████████████████████████████████████████▋                                                                                | 4342/9741 [00:03<00:03, 1425.64it/s] 46%|██████████████████████████████████████████████████████████████████▊                                                                              | 4486/9741 [00:04<00:03, 1427.43it/s] 48%|████████████████████████████████████████████████████████████████████▉                                                                            | 4629/9741 [00:04<00:03, 1394.82it/s] 49%|██████████████████████████████████████████████████████████████████████▉                                                                          | 4769/9741 [00:04<00:04, 1069.28it/s] 50%|█████████████████████████████████████████████████████████████████████████▏                                                                       | 4913/9741 [00:04<00:04, 1158.26it/s] 52%|███████████████████████████████████████████████████████████████████████████▏                                                                     | 5051/9741 [00:04<00:03, 1213.82it/s] 53%|█████████████████████████████████████████████████████████████████████████████▎                                                                   | 5194/9741 [00:04<00:03, 1270.66it/s] 55%|███████████████████████████████████████████████████████████████████████████████▍                                                                 | 5338/9741 [00:04<00:03, 1316.68it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▋                                                               | 5484/9741 [00:04<00:03, 1354.86it/s] 58%|███████████████████████████████████████████████████████████████████████████████████▊                                                             | 5634/9741 [00:04<00:02, 1395.95it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████                                                           | 5785/9741 [00:05<00:02, 1427.05it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▎                                                        | 5935/9741 [00:05<00:02, 1447.84it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▌                                                      | 6086/9741 [00:05<00:02, 1464.40it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▊                                                    | 6237/9741 [00:05<00:02, 1476.54it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████                                                  | 6387/9741 [00:05<00:02, 1482.46it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▎                                               | 6537/9741 [00:05<00:02, 1486.59it/s] 69%|███████████████████████████████████████████████████████████████████████████████████████████████████▌                                             | 6688/9741 [00:05<00:02, 1491.77it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▊                                           | 6838/9741 [00:05<00:01, 1492.98it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████                                         | 6988/9741 [00:05<00:01, 1480.55it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                      | 7139/9741 [00:05<00:01, 1486.98it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                    | 7290/9741 [00:06<00:01, 1492.02it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                  | 7441/9741 [00:06<00:01, 1459.78it/s] 78%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                | 7591/9741 [00:06<00:01, 1469.26it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                             | 7741/9741 [00:06<00:01, 1477.76it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                           | 7892/9741 [00:06<00:01, 1484.85it/s] 83%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                         | 8043/9741 [00:06<00:01, 1490.05it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                       | 8194/9741 [00:06<00:01, 1493.45it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                    | 8345/9741 [00:06<00:00, 1497.23it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                  | 8495/9741 [00:06<00:00, 1495.61it/s] 89%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                | 8645/9741 [00:06<00:00, 1486.09it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉              | 8795/9741 [00:07<00:00, 1488.67it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏           | 8946/9741 [00:07<00:00, 1492.38it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍         | 9096/9741 [00:07<00:00, 1492.93it/s] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋       | 9247/9741 [00:07<00:00, 1495.60it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉     | 9397/9741 [00:07<00:00, 1491.49it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████   | 9547/9741 [00:07<00:00, 1481.07it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎| 9696/9741 [00:07<00:00, 1483.18it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:07<00:00, 1263.00it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.67s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.90s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.56s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.59s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.48s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.43s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.50s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:12<00:06,  6.07s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.84s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.03s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.83s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.01s/it]
[2023-08-10 23:37:42,874] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.86s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.04s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.26s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.46s/it]
[2023-08-10 23:37:54,634] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-10 23:37:54,636] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-10 23:37:54,637] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-10 23:37:54,638] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-10 23:37:54,638] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-10 23:37:54,638] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-10 23:37:54,638] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fc327adce80>
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-10 23:37:54,639] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fc3343fd910>
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-10 23:37:54,640] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-10 23:37:54,641] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-10 23:37:54,641] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-10 23:37:54,641] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-10 23:37:54,641] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.43430233001708984 seconds
Loading extension module utils...
Time to load utils op: 0.40455055236816406 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.4043114185333252 seconds
Time to load utils op: 0.30428338050842285 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Answer: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Answer: 3

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:52<43:01, 52.69s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:45<41:58, 52.47s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:38<41:32, 53.03s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:57<30:08, 39.32s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:49<33:09, 44.22s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:43<34:49, 47.49s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:36<35:12, 49.13s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:28<35:04, 50.11s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:58<30:01, 43.93s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:51<31:05, 46.64s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:12<25:17, 38.90s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:07<27:40, 43.70s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:40<25:01, 40.57s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:33<26:33, 44.27s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:00<22:46, 39.03s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:16<18:12, 32.13s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:08<20:51, 37.92s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [12:49<20:48, 39.01s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [13:34<21:03, 40.74s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:18<20:52, 41.76s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:12<21:55, 45.35s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:05<22:17, 47.76s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [16:58<22:13, 49.40s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [17:21<17:54, 41.35s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:15<18:52, 45.28s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:09<19:04, 47.70s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:03<19:04, 49.75s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [20:57<18:38, 50.84s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [21:50<18:00, 51.44s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:42<17:15, 51.76s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [23:36<16:34, 52.33s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [24:02<13:22, 44.60s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [24:55<13:21, 47.17s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:42<12:33, 47.07s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:35<12:10, 48.67s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [27:00<09:44, 41.77s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [27:53<09:44, 44.94s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [28:39<09:05, 45.49s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:32<08:44, 47.72s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [30:19<07:54, 47.43s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [31:11<07:18, 48.67s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:40<05:42, 42.82s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [32:01<04:14, 36.35s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [32:53<04:06, 41.03s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:42<03:37, 43.49s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:35<03:05, 46.27s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [35:29<02:25, 48.49s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [35:48<01:19, 39.59s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [36:40<00:43, 43.37s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:28<00:00, 44.90s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:28<00:00, 44.97s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 4.5624} | lm_loss 7.6949 | avg. gen lenth: 201.632
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s1-rFalse --seed 1 --num-out-domain 5
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 00:18:46,635] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 5
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|█                                                                                                                                                   | 69/9741 [00:00<00:14, 688.87it/s]  1%|██                                                                                                                                                 | 139/9741 [00:00<00:13, 691.72it/s]  2%|███▏                                                                                                                                               | 209/9741 [00:00<00:13, 690.02it/s]  3%|████▏                                                                                                                                              | 279/9741 [00:00<00:13, 691.48it/s]  4%|█████▎                                                                                                                                             | 349/9741 [00:00<00:13, 692.47it/s]  4%|██████▎                                                                                                                                            | 419/9741 [00:00<00:13, 693.91it/s]  5%|███████▍                                                                                                                                           | 489/9741 [00:00<00:13, 692.60it/s]  6%|████████▍                                                                                                                                          | 559/9741 [00:00<00:13, 684.26it/s]  6%|█████████▍                                                                                                                                         | 628/9741 [00:00<00:13, 685.07it/s]  7%|██████████▌                                                                                                                                        | 697/9741 [00:01<00:13, 684.61it/s]  8%|███████████▌                                                                                                                                       | 767/9741 [00:01<00:13, 687.86it/s]  9%|████████████▋                                                                                                                                      | 837/9741 [00:01<00:12, 690.23it/s]  9%|█████████████▋                                                                                                                                     | 907/9741 [00:01<00:12, 690.71it/s] 10%|██████████████▋                                                                                                                                    | 977/9741 [00:01<00:12, 692.25it/s] 11%|███████████████▋                                                                                                                                  | 1047/9741 [00:01<00:12, 693.64it/s] 11%|████████████████▋                                                                                                                                 | 1117/9741 [00:01<00:12, 693.20it/s] 12%|█████████████████▊                                                                                                                                | 1187/9741 [00:01<00:12, 694.90it/s] 13%|██████████████████▊                                                                                                                               | 1257/9741 [00:01<00:12, 691.15it/s] 14%|███████████████████▉                                                                                                                              | 1327/9741 [00:01<00:12, 692.15it/s] 14%|████████████████████▉                                                                                                                             | 1397/9741 [00:02<00:12, 690.61it/s] 15%|█████████████████████▉                                                                                                                            | 1467/9741 [00:02<00:11, 691.75it/s] 16%|███████████████████████                                                                                                                           | 1537/9741 [00:02<00:11, 692.34it/s] 16%|████████████████████████                                                                                                                          | 1607/9741 [00:02<00:11, 690.95it/s] 17%|█████████████████████████▏                                                                                                                        | 1677/9741 [00:02<00:11, 692.91it/s] 18%|██████████████████████████▏                                                                                                                       | 1747/9741 [00:02<00:11, 693.70it/s] 19%|███████████████████████████▏                                                                                                                      | 1817/9741 [00:02<00:11, 684.90it/s] 20%|████████████████████████████▊                                                                                                                     | 1923/9741 [00:02<00:09, 794.48it/s] 21%|██████████████████████████████▍                                                                                                                   | 2028/9741 [00:02<00:08, 869.29it/s] 22%|███████████████████████████████▉                                                                                                                  | 2134/9741 [00:02<00:08, 924.34it/s] 23%|█████████████████████████████████▌                                                                                                                | 2240/9741 [00:03<00:07, 964.63it/s] 24%|███████████████████████████████████                                                                                                               | 2343/9741 [00:03<00:07, 982.89it/s] 25%|████████████████████████████████████▍                                                                                                            | 2449/9741 [00:03<00:07, 1005.61it/s] 26%|██████████████████████████████████████                                                                                                           | 2554/9741 [00:03<00:07, 1016.96it/s] 27%|███████████████████████████████████████▌                                                                                                         | 2659/9741 [00:03<00:06, 1024.18it/s] 28%|█████████████████████████████████████████▏                                                                                                       | 2764/9741 [00:03<00:06, 1029.85it/s] 29%|██████████████████████████████████████████▋                                                                                                      | 2870/9741 [00:03<00:06, 1037.20it/s] 31%|████████████████████████████████████████████▎                                                                                                    | 2975/9741 [00:03<00:06, 1039.38it/s] 32%|█████████████████████████████████████████████▊                                                                                                   | 3081/9741 [00:03<00:06, 1043.76it/s] 33%|███████████████████████████████████████████████▍                                                                                                 | 3186/9741 [00:03<00:06, 1045.59it/s] 34%|█████████████████████████████████████████████████                                                                                                | 3292/9741 [00:04<00:06, 1049.78it/s] 35%|██████████████████████████████████████████████████▌                                                                                              | 3397/9741 [00:04<00:06, 1049.80it/s] 36%|████████████████████████████████████████████████████▏                                                                                            | 3503/9741 [00:04<00:05, 1051.79it/s] 37%|█████████████████████████████████████████████████████▋                                                                                           | 3609/9741 [00:04<00:05, 1050.38it/s] 38%|███████████████████████████████████████████████████████▎                                                                                         | 3715/9741 [00:04<00:05, 1043.43it/s] 39%|████████████████████████████████████████████████████████▉                                                                                        | 3821/9741 [00:04<00:05, 1046.74it/s] 40%|██████████████████████████████████████████████████████████▍                                                                                      | 3926/9741 [00:04<00:05, 1045.30it/s] 41%|████████████████████████████████████████████████████████████                                                                                     | 4032/9741 [00:04<00:05, 1047.77it/s] 42%|█████████████████████████████████████████████████████████████▌                                                                                   | 4137/9741 [00:04<00:05, 1046.83it/s] 44%|███████████████████████████████████████████████████████████████▏                                                                                 | 4243/9741 [00:04<00:05, 1048.95it/s] 45%|████████████████████████████████████████████████████████████████▋                                                                                | 4348/9741 [00:05<00:05, 1048.28it/s] 46%|██████████████████████████████████████████████████████████████████▎                                                                              | 4454/9741 [00:05<00:05, 1049.91it/s] 47%|████████████████████████████████████████████████████████████████████▎                                                                             | 4559/9741 [00:05<00:05, 995.91it/s] 48%|█████████████████████████████████████████████████████████████████████▍                                                                           | 4665/9741 [00:05<00:05, 1013.79it/s] 49%|███████████████████████████████████████████████████████████████████████▍                                                                          | 4767/9741 [00:05<00:05, 842.43it/s] 50%|█████████████████████████████████████████████████████████████████████████                                                                         | 4873/9741 [00:05<00:05, 896.65it/s] 51%|██████████████████████████████████████████████████████████████████████████▌                                                                       | 4978/9741 [00:05<00:05, 936.92it/s] 52%|████████████████████████████████████████████████████████████████████████████▏                                                                     | 5082/9741 [00:05<00:04, 963.76it/s] 53%|█████████████████████████████████████████████████████████████████████████████▋                                                                    | 5187/9741 [00:05<00:04, 987.34it/s] 54%|██████████████████████████████████████████████████████████████████████████████▊                                                                  | 5293/9741 [00:06<00:04, 1007.22it/s] 55%|████████████████████████████████████████████████████████████████████████████████▎                                                                | 5398/9741 [00:06<00:04, 1018.92it/s] 57%|█████████████████████████████████████████████████████████████████████████████████▉                                                               | 5505/9741 [00:06<00:04, 1033.67it/s] 58%|███████████████████████████████████████████████████████████████████████████████████▌                                                             | 5615/9741 [00:06<00:03, 1052.54it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▏                                                           | 5724/9741 [00:06<00:03, 1063.36it/s] 60%|██████████████████████████████████████████████████████████████████████████████████████▊                                                          | 5834/9741 [00:06<00:03, 1073.01it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▍                                                        | 5944/9741 [00:06<00:03, 1078.17it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▏                                                      | 6055/9741 [00:06<00:03, 1085.57it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▊                                                     | 6164/9741 [00:06<00:03, 1086.10it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▍                                                   | 6274/9741 [00:06<00:03, 1088.96it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████                                                  | 6384/9741 [00:07<00:03, 1089.49it/s] 67%|████████████████████████████████████████████████████████████████████████████████████████████████▋                                                | 6494/9741 [00:07<00:02, 1092.26it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▎                                              | 6604/9741 [00:07<00:02, 1090.15it/s] 69%|███████████████████████████████████████████████████████████████████████████████████████████████████▉                                             | 6714/9741 [00:07<00:02, 1092.46it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▌                                           | 6824/9741 [00:07<00:02, 1088.00it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▏                                         | 6934/9741 [00:07<00:02, 1090.68it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                        | 7044/9741 [00:07<00:02, 1090.44it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                      | 7155/9741 [00:07<00:02, 1093.52it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                    | 7265/9741 [00:07<00:02, 1092.02it/s] 76%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                   | 7375/9741 [00:07<00:02, 1093.99it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                 | 7485/9741 [00:08<00:02, 1059.76it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                | 7595/9741 [00:08<00:02, 1069.36it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                              | 7704/9741 [00:08<00:01, 1074.31it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                            | 7814/9741 [00:08<00:01, 1081.23it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                           | 7923/9741 [00:08<00:01, 1082.29it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                         | 8033/9741 [00:08<00:01, 1086.13it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                       | 8143/9741 [00:08<00:01, 1087.77it/s] 85%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                      | 8253/9741 [00:08<00:01, 1090.23it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                    | 8363/9741 [00:08<00:01, 1088.66it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                  | 8473/9741 [00:08<00:01, 1091.35it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                 | 8583/9741 [00:09<00:01, 1089.97it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍               | 8693/9741 [00:09<00:00, 1086.69it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████              | 8803/9741 [00:09<00:00, 1086.49it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋            | 8913/9741 [00:09<00:00, 1088.95it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎          | 9023/9741 [00:09<00:00, 1091.20it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉         | 9133/9741 [00:09<00:00, 1089.12it/s] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 9243/9741 [00:09<00:00, 1090.95it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏     | 9353/9741 [00:09<00:00, 1089.38it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊    | 9463/9741 [00:09<00:00, 1091.61it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍  | 9573/9741 [00:09<00:00, 1090.52it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏| 9683/9741 [00:10<00:00, 1090.60it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:10<00:00, 961.49it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.46s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.18s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.07s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.14s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.28s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.13s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.20s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.46s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.63s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.65s/it]
[2023-08-11 00:19:48,112] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.55s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]
[2023-08-11 00:19:56,431] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 00:19:56,432] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 00:19:56,433] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 00:19:56,433] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 00:19:56,433] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 00:19:56,433] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f65d057ee80>
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 00:19:56,434] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f65aa558910>
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 00:19:56,435] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 00:19:56,436] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 00:19:56,436] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 00:19:56,436] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 00:19:56,436] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 00:19:56,436] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 00:19:56,436] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 00:19:56,436] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 00:19:56,436] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 00:19:56,436] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 00:19:56,436] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.36823248863220215 seconds
Loading extension module utils...
Time to load utils op: 0.4050166606903076 seconds
Loading extension module utils...
Time to load utils op: 0.30431437492370605 seconds
Loading extension module utils...
Time to load utils op: 0.30498743057250977 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Answer: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Answer: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Answer: 27

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:51<41:55, 51.34s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:41<40:41, 50.86s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:31<39:32, 50.48s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:08<34:25, 44.91s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:59<35:19, 47.11s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:34<31:35, 43.08s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:11<29:21, 40.97s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:01<30:40, 43.82s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:52<31:28, 46.05s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:42<31:33, 47.34s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:28<30:29, 46.90s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:18<30:23, 47.98s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:40<24:46, 40.19s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:32<26:09, 43.60s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:22<26:40, 45.72s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [12:13<26:48, 47.31s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [13:04<26:30, 48.20s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:54<26:00, 48.77s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:43<25:17, 48.94s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:34<24:44, 49.48s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:15<22:38, 46.83s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [17:05<22:23, 48.00s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:16<16:32, 36.78s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:07<17:47, 41.08s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:58<18:21, 44.08s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:23<15:23, 38.48s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:09<15:36, 40.72s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [20:59<15:53, 43.33s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [21:35<14:24, 41.19s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:27<14:45, 44.28s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [23:18<14:41, 46.39s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [24:09<14:20, 47.78s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [24:23<10:40, 37.66s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [24:53<09:27, 35.46s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [25:37<09:29, 37.98s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [26:28<09:43, 41.71s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [27:18<09:37, 44.43s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [28:09<09:15, 46.30s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:00<08:43, 47.60s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [29:51<08:07, 48.78s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [30:30<06:53, 45.95s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:13<05:59, 44.96s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [31:44<04:45, 40.75s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [32:34<04:20, 43.44s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:24<03:47, 45.55s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:14<03:07, 46.84s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [35:05<02:24, 48.03s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [35:56<01:38, 49.04s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [36:46<00:49, 49.19s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:37<00:00, 49.72s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:37<00:00, 45.15s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 4.068} | lm_loss 7.7249 | avg. gen lenth: 233.048
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s1-rFalse --seed 1 --num-out-domain 6
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 00:58:04,966] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 6
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o6-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|▉                                                                                                                                                   | 60/9741 [00:00<00:16, 596.33it/s]  1%|█▊                                                                                                                                                 | 121/9741 [00:00<00:15, 601.26it/s]  2%|██▋                                                                                                                                                | 182/9741 [00:00<00:15, 602.52it/s]  2%|███▋                                                                                                                                               | 243/9741 [00:00<00:15, 600.37it/s]  3%|████▌                                                                                                                                              | 304/9741 [00:00<00:15, 601.94it/s]  4%|█████▌                                                                                                                                             | 365/9741 [00:00<00:15, 602.87it/s]  4%|██████▍                                                                                                                                            | 426/9741 [00:00<00:15, 604.36it/s]  5%|███████▎                                                                                                                                           | 487/9741 [00:00<00:15, 602.16it/s]  6%|████████▎                                                                                                                                          | 548/9741 [00:00<00:15, 603.35it/s]  6%|█████████▏                                                                                                                                         | 609/9741 [00:01<00:15, 604.02it/s]  7%|██████████                                                                                                                                         | 670/9741 [00:01<00:15, 602.59it/s]  8%|███████████                                                                                                                                        | 731/9741 [00:01<00:15, 594.09it/s]  8%|███████████▉                                                                                                                                       | 792/9741 [00:01<00:14, 596.95it/s]  9%|████████████▊                                                                                                                                      | 853/9741 [00:01<00:14, 599.72it/s]  9%|█████████████▊                                                                                                                                     | 913/9741 [00:01<00:15, 586.45it/s] 10%|██████████████▋                                                                                                                                    | 974/9741 [00:01<00:14, 590.87it/s] 11%|███████████████▌                                                                                                                                  | 1035/9741 [00:01<00:14, 594.99it/s] 11%|████████████████▍                                                                                                                                 | 1096/9741 [00:01<00:14, 599.09it/s] 12%|█████████████████▎                                                                                                                                | 1156/9741 [00:01<00:14, 598.92it/s] 12%|██████████████████▏                                                                                                                               | 1216/9741 [00:02<00:14, 599.16it/s] 13%|███████████████████▏                                                                                                                              | 1277/9741 [00:02<00:14, 599.97it/s] 14%|████████████████████                                                                                                                              | 1338/9741 [00:02<00:14, 592.25it/s] 14%|████████████████████▉                                                                                                                             | 1398/9741 [00:02<00:14, 593.82it/s] 15%|█████████████████████▊                                                                                                                            | 1459/9741 [00:02<00:13, 596.23it/s] 16%|██████████████████████▊                                                                                                                           | 1520/9741 [00:02<00:13, 597.61it/s] 16%|███████████████████████▋                                                                                                                          | 1580/9741 [00:02<00:13, 597.20it/s] 17%|████████████████████████▌                                                                                                                         | 1641/9741 [00:02<00:13, 599.39it/s] 17%|█████████████████████████▌                                                                                                                        | 1702/9741 [00:02<00:13, 601.16it/s] 18%|██████████████████████████▍                                                                                                                       | 1763/9741 [00:02<00:13, 601.81it/s] 19%|███████████████████████████▎                                                                                                                      | 1824/9741 [00:03<00:13, 578.86it/s] 20%|████████████████████████████▋                                                                                                                     | 1913/9741 [00:03<00:11, 667.41it/s] 21%|██████████████████████████████                                                                                                                    | 2006/9741 [00:03<00:10, 742.05it/s] 22%|███████████████████████████████▍                                                                                                                  | 2097/9741 [00:03<00:09, 791.38it/s] 22%|████████████████████████████████▊                                                                                                                 | 2190/9741 [00:03<00:09, 830.26it/s] 23%|██████████████████████████████████▏                                                                                                               | 2280/9741 [00:03<00:08, 849.70it/s] 24%|███████████████████████████████████▌                                                                                                              | 2370/9741 [00:03<00:08, 863.99it/s] 25%|████████████████████████████████████▉                                                                                                             | 2463/9741 [00:03<00:08, 881.17it/s] 26%|██████████████████████████████████████▎                                                                                                           | 2554/9741 [00:03<00:08, 889.68it/s] 27%|███████████████████████████████████████▋                                                                                                          | 2647/9741 [00:03<00:07, 900.00it/s] 28%|█████████████████████████████████████████                                                                                                         | 2739/9741 [00:04<00:07, 903.77it/s] 29%|██████████████████████████████████████████▍                                                                                                       | 2831/9741 [00:04<00:07, 908.56it/s] 30%|███████████████████████████████████████████▊                                                                                                      | 2924/9741 [00:04<00:07, 910.22it/s] 31%|█████████████████████████████████████████████▏                                                                                                    | 3017/9741 [00:04<00:07, 913.70it/s] 32%|██████████████████████████████████████████████▌                                                                                                   | 3109/9741 [00:04<00:07, 914.17it/s] 33%|███████████████████████████████████████████████▉                                                                                                  | 3201/9741 [00:04<00:07, 913.24it/s] 34%|█████████████████████████████████████████████████▎                                                                                                | 3294/9741 [00:04<00:07, 916.48it/s] 35%|██████████████████████████████████████████████████▊                                                                                               | 3386/9741 [00:04<00:06, 914.28it/s] 36%|████████████████████████████████████████████████████▏                                                                                             | 3478/9741 [00:04<00:06, 907.31it/s] 37%|█████████████████████████████████████████████████████▌                                                                                            | 3570/9741 [00:04<00:06, 909.73it/s] 38%|██████████████████████████████████████████████████████▊                                                                                           | 3661/9741 [00:05<00:06, 909.33it/s] 39%|████████████████████████████████████████████████████████▎                                                                                         | 3754/9741 [00:05<00:06, 913.83it/s] 39%|█████████████████████████████████████████████████████████▋                                                                                        | 3846/9741 [00:05<00:06, 913.52it/s] 40%|███████████████████████████████████████████████████████████                                                                                       | 3939/9741 [00:05<00:06, 916.00it/s] 41%|████████████████████████████████████████████████████████████▍                                                                                     | 4032/9741 [00:05<00:06, 917.79it/s] 42%|█████████████████████████████████████████████████████████████▊                                                                                    | 4124/9741 [00:05<00:06, 916.52it/s] 43%|███████████████████████████████████████████████████████████████▏                                                                                  | 4216/9741 [00:05<00:06, 915.59it/s] 44%|████████████████████████████████████████████████████████████████▌                                                                                 | 4308/9741 [00:05<00:05, 915.35it/s] 45%|█████████████████████████████████████████████████████████████████▉                                                                                | 4400/9741 [00:05<00:05, 914.96it/s] 46%|███████████████████████████████████████████████████████████████████▎                                                                              | 4492/9741 [00:05<00:05, 914.48it/s] 47%|████████████████████████████████████████████████████████████████████▋                                                                             | 4584/9741 [00:06<00:05, 868.92it/s] 48%|██████████████████████████████████████████████████████████████████████                                                                            | 4675/9741 [00:06<00:05, 878.44it/s] 49%|███████████████████████████████████████████████████████████████████████▍                                                                          | 4764/9741 [00:06<00:07, 655.61it/s] 50%|████████████████████████████████████████████████████████████████████████▊                                                                         | 4856/9741 [00:06<00:06, 717.52it/s] 51%|██████████████████████████████████████████████████████████████████████████▏                                                                       | 4948/9741 [00:06<00:06, 767.00it/s] 52%|███████████████████████████████████████████████████████████████████████████▌                                                                      | 5041/9741 [00:06<00:05, 808.08it/s] 53%|████████████████████████████████████████████████████████████████████████████▉                                                                     | 5134/9741 [00:06<00:05, 839.02it/s] 54%|██████████████████████████████████████████████████████████████████████████████▎                                                                   | 5226/9741 [00:06<00:05, 859.70it/s] 55%|███████████████████████████████████████████████████████████████████████████████▋                                                                  | 5318/9741 [00:07<00:05, 876.42it/s] 56%|█████████████████████████████████████████████████████████████████████████████████                                                                 | 5410/9741 [00:07<00:04, 886.66it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▍                                                               | 5504/9741 [00:07<00:04, 900.14it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▉                                                              | 5601/9741 [00:07<00:04, 918.35it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▍                                                            | 5697/9741 [00:07<00:04, 928.63it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▊                                                           | 5794/9741 [00:07<00:04, 939.14it/s] 60%|████████████████████████████████████████████████████████████████████████████████████████▎                                                         | 5890/9741 [00:07<00:04, 943.13it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▋                                                        | 5987/9741 [00:07<00:03, 949.36it/s] 62%|███████████████████████████████████████████████████████████████████████████████████████████▏                                                      | 6083/9741 [00:07<00:03, 950.44it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▌                                                     | 6179/9741 [00:07<00:03, 948.31it/s] 64%|██████████████████████████████████████████████████████████████████████████████████████████████                                                    | 6275/9741 [00:08<00:03, 950.98it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▍                                                  | 6371/9741 [00:08<00:03, 950.55it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▉                                                 | 6467/9741 [00:08<00:03, 952.96it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▎                                               | 6563/9741 [00:08<00:03, 951.73it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▊                                              | 6659/9741 [00:08<00:03, 949.62it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████▎                                            | 6756/9741 [00:08<00:03, 952.96it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▋                                           | 6852/9741 [00:08<00:03, 952.88it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                         | 6948/9741 [00:08<00:02, 953.96it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                        | 7044/9741 [00:08<00:02, 951.31it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████                                       | 7140/9741 [00:08<00:02, 953.33it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                     | 7236/9741 [00:09<00:02, 951.11it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                    | 7332/9741 [00:09<00:02, 952.08it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                  | 7428/9741 [00:09<00:02, 951.71it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                 | 7524/9741 [00:09<00:02, 919.33it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                               | 7620/9741 [00:09<00:02, 930.25it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                              | 7715/9741 [00:09<00:02, 935.47it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                             | 7811/9741 [00:09<00:02, 941.74it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                           | 7906/9741 [00:09<00:01, 943.25it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                          | 8002/9741 [00:09<00:01, 947.18it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                        | 8098/9741 [00:09<00:01, 949.71it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                       | 8194/9741 [00:10<00:01, 947.00it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                     | 8290/9741 [00:10<00:01, 949.65it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                    | 8385/9741 [00:10<00:01, 949.41it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                   | 8481/9741 [00:10<00:01, 952.38it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                 | 8577/9741 [00:10<00:01, 946.58it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                | 8673/9741 [00:10<00:01, 949.13it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍              | 8769/9741 [00:10<00:01, 951.10it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 8865/9741 [00:10<00:00, 949.88it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎           | 8961/9741 [00:10<00:00, 952.50it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋          | 9057/9741 [00:10<00:00, 951.43it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏        | 9153/9741 [00:11<00:00, 953.75it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋       | 9249/9741 [00:11<00:00, 954.03it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████      | 9345/9741 [00:11<00:00, 952.22it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌    | 9441/9741 [00:11<00:00, 952.05it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉   | 9537/9741 [00:11<00:00, 950.07it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍ | 9633/9741 [00:11<00:00, 951.31it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊| 9729/9741 [00:11<00:00, 949.35it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:11<00:00, 833.59it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.09s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.38s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.50s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.94s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.54s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.44s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.32s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.51s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.37s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.54s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.85s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.89s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.04s/it]
[2023-08-11 00:59:09,979] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-11 00:59:17,619] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 00:59:17,620] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 00:59:17,620] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 00:59:17,620] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 00:59:17,620] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 00:59:17,620] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fa4a6f25e80>
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fa4a6c3d910>
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 00:59:17,621] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 00:59:17,622] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 00:59:17,622] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.46411776542663574 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Answer: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Answer: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Answer: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Answer: 180

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o6-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.40512919425964355 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.40415263175964355 seconds
Time to load utils op: 0.4045283794403076 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:50<41:25, 50.72s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:39<39:39, 49.56s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:29<39:00, 49.79s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:18<37:53, 49.42s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:00<35:06, 46.82s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:50<35:00, 47.75s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:39<34:31, 48.17s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:29<34:10, 48.82s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:06<30:55, 45.26s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:35<26:45, 40.14s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:14<25:51, 39.78s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:04<27:05, 42.78s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:53<27:37, 44.80s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:15<22:47, 38.00s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:04<23:59, 41.13s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:54<24:52, 43.89s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:44<25:05, 45.61s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:33<25:00, 46.89s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:22<24:29, 47.41s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:49<20:39, 41.31s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:39<21:09, 43.77s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:28<21:13, 45.49s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:01<18:43, 41.63s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [17:50<19:03, 44.00s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:16<16:03, 38.53s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:07<16:50, 42.12s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [19:43<15:29, 40.39s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [20:04<12:41, 34.63s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:55<13:46, 39.35s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:10<10:41, 32.07s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [21:59<11:50, 37.38s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:49<12:21, 41.19s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:36<12:05, 42.69s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [24:09<10:37, 39.83s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:58<10:38, 42.58s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [25:49<10:30, 45.03s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [26:39<10:07, 46.74s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [27:29<09:32, 47.73s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [28:04<08:01, 43.79s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [28:54<07:36, 45.67s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [29:31<06:27, 43.04s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [30:01<05:13, 39.14s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [30:44<04:41, 40.20s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [31:34<04:18, 43.13s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [32:24<03:46, 45.20s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [33:14<03:06, 46.62s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [34:04<02:23, 47.75s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [34:26<01:20, 40.09s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [35:16<00:43, 43.12s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:53<00:00, 41.12s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:53<00:00, 43.07s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.28} | lm_loss 7.7594 | avg. gen lenth: 214.304
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s1-rFalse --seed 1 --num-out-domain 7
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 01:38:24,392] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 7
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o7-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|▊                                                                                                                                                   | 57/9741 [00:00<00:17, 562.31it/s]  1%|█▋                                                                                                                                                 | 114/9741 [00:00<00:17, 566.16it/s]  2%|██▌                                                                                                                                                | 171/9741 [00:00<00:16, 567.61it/s]  2%|███▍                                                                                                                                               | 228/9741 [00:00<00:16, 564.92it/s]  3%|████▎                                                                                                                                              | 285/9741 [00:00<00:16, 564.83it/s]  4%|█████▏                                                                                                                                             | 342/9741 [00:00<00:16, 565.36it/s]  4%|██████                                                                                                                                             | 399/9741 [00:00<00:16, 565.93it/s]  5%|██████▉                                                                                                                                            | 456/9741 [00:00<00:16, 556.73it/s]  5%|███████▋                                                                                                                                           | 512/9741 [00:00<00:16, 557.23it/s]  6%|████████▌                                                                                                                                          | 569/9741 [00:01<00:16, 559.06it/s]  6%|█████████▍                                                                                                                                         | 626/9741 [00:01<00:16, 560.49it/s]  7%|██████████▎                                                                                                                                        | 683/9741 [00:01<00:16, 559.36it/s]  8%|███████████▏                                                                                                                                       | 740/9741 [00:01<00:16, 560.29it/s]  8%|████████████                                                                                                                                       | 797/9741 [00:01<00:15, 562.68it/s]  9%|████████████▉                                                                                                                                      | 854/9741 [00:01<00:15, 563.98it/s]  9%|█████████████▋                                                                                                                                     | 911/9741 [00:01<00:15, 562.41it/s] 10%|██████████████▌                                                                                                                                    | 968/9741 [00:01<00:15, 558.36it/s] 11%|███████████████▎                                                                                                                                  | 1024/9741 [00:01<00:15, 556.46it/s] 11%|████████████████▏                                                                                                                                 | 1081/9741 [00:01<00:15, 559.53it/s] 12%|█████████████████                                                                                                                                 | 1137/9741 [00:02<00:15, 559.41it/s] 12%|█████████████████▉                                                                                                                                | 1194/9741 [00:02<00:15, 561.89it/s] 13%|██████████████████▊                                                                                                                               | 1251/9741 [00:02<00:15, 562.74it/s] 13%|███████████████████▌                                                                                                                              | 1308/9741 [00:02<00:14, 563.65it/s] 14%|████████████████████▍                                                                                                                             | 1365/9741 [00:02<00:14, 562.28it/s] 15%|█████████████████████▎                                                                                                                            | 1422/9741 [00:02<00:14, 563.19it/s] 15%|██████████████████████▏                                                                                                                           | 1479/9741 [00:02<00:14, 563.90it/s] 16%|███████████████████████                                                                                                                           | 1536/9741 [00:02<00:14, 563.50it/s] 16%|███████████████████████▉                                                                                                                          | 1593/9741 [00:02<00:14, 562.55it/s] 17%|████████████████████████▋                                                                                                                         | 1650/9741 [00:02<00:14, 563.17it/s] 18%|█████████████████████████▌                                                                                                                        | 1707/9741 [00:03<00:14, 564.21it/s] 18%|██████████████████████████▍                                                                                                                       | 1764/9741 [00:03<00:14, 564.77it/s] 19%|███████████████████████████▎                                                                                                                      | 1821/9741 [00:03<00:14, 544.85it/s] 19%|████████████████████████████▏                                                                                                                     | 1878/9741 [00:03<00:14, 550.84it/s] 20%|█████████████████████████████                                                                                                                     | 1935/9741 [00:03<00:14, 554.99it/s] 21%|██████████████████████████████▏                                                                                                                   | 2012/9741 [00:03<00:12, 618.10it/s] 22%|███████████████████████████████▍                                                                                                                  | 2098/9741 [00:03<00:11, 687.83it/s] 22%|████████████████████████████████▋                                                                                                                 | 2185/9741 [00:03<00:10, 740.41it/s] 23%|██████████████████████████████████                                                                                                                | 2271/9741 [00:03<00:09, 774.01it/s] 24%|███████████████████████████████████▎                                                                                                              | 2358/9741 [00:03<00:09, 800.70it/s] 25%|████████████████████████████████████▋                                                                                                             | 2445/9741 [00:04<00:08, 820.39it/s] 26%|█████████████████████████████████████▉                                                                                                            | 2531/9741 [00:04<00:08, 830.24it/s] 27%|███████████████████████████████████████▏                                                                                                          | 2618/9741 [00:04<00:08, 840.25it/s] 28%|████████████████████████████████████████▌                                                                                                         | 2704/9741 [00:04<00:08, 844.26it/s] 29%|█████████████████████████████████████████▊                                                                                                        | 2790/9741 [00:04<00:08, 848.78it/s] 30%|███████████████████████████████████████████                                                                                                       | 2877/9741 [00:04<00:08, 852.35it/s] 30%|████████████████████████████████████████████▍                                                                                                     | 2963/9741 [00:04<00:07, 850.45it/s] 31%|█████████████████████████████████████████████▋                                                                                                    | 3050/9741 [00:04<00:07, 853.41it/s] 32%|███████████████████████████████████████████████                                                                                                   | 3137/9741 [00:04<00:07, 856.12it/s] 33%|████████████████████████████████████████████████▎                                                                                                 | 3223/9741 [00:04<00:07, 855.41it/s] 34%|█████████████████████████████████████████████████▌                                                                                                | 3310/9741 [00:05<00:07, 857.55it/s] 35%|██████████████████████████████████████████████████▉                                                                                               | 3396/9741 [00:05<00:07, 855.03it/s] 36%|████████████████████████████████████████████████████▏                                                                                             | 3482/9741 [00:05<00:07, 855.91it/s] 37%|█████████████████████████████████████████████████████▍                                                                                            | 3568/9741 [00:05<00:07, 856.25it/s] 38%|██████████████████████████████████████████████████████▊                                                                                           | 3654/9741 [00:05<00:07, 854.55it/s] 38%|████████████████████████████████████████████████████████                                                                                          | 3741/9741 [00:05<00:06, 857.38it/s] 39%|█████████████████████████████████████████████████████████▎                                                                                        | 3828/9741 [00:05<00:06, 858.62it/s] 40%|██████████████████████████████████████████████████████████▋                                                                                       | 3914/9741 [00:05<00:06, 853.04it/s] 41%|███████████████████████████████████████████████████████████▉                                                                                      | 4001/9741 [00:05<00:06, 855.82it/s] 42%|█████████████████████████████████████████████████████████████▎                                                                                    | 4087/9741 [00:05<00:06, 855.78it/s] 43%|██████████████████████████████████████████████████████████████▌                                                                                   | 4173/9741 [00:06<00:06, 855.87it/s] 44%|███████████████████████████████████████████████████████████████▊                                                                                  | 4259/9741 [00:06<00:06, 856.53it/s] 45%|█████████████████████████████████████████████████████████████████                                                                                 | 4345/9741 [00:06<00:06, 854.30it/s] 45%|██████████████████████████████████████████████████████████████████▍                                                                               | 4431/9741 [00:06<00:06, 855.11it/s] 46%|███████████████████████████████████████████████████████████████████▋                                                                              | 4517/9741 [00:06<00:06, 824.55it/s] 47%|████████████████████████████████████████████████████████████████████▉                                                                             | 4603/9741 [00:06<00:06, 832.34it/s] 48%|██████████████████████████████████████████████████████████████████████▎                                                                           | 4690/9741 [00:06<00:06, 840.73it/s] 49%|███████████████████████████████████████████████████████████████████████▌                                                                          | 4775/9741 [00:06<00:07, 633.79it/s] 50%|████████████████████████████████████████████████████████████████████████▊                                                                         | 4861/9741 [00:07<00:07, 687.78it/s] 51%|██████████████████████████████████████████████████████████████████████████                                                                        | 4944/9741 [00:07<00:06, 723.84it/s] 52%|███████████████████████████████████████████████████████████████████████████▍                                                                      | 5030/9741 [00:07<00:06, 760.12it/s] 53%|████████████████████████████████████████████████████████████████████████████▋                                                                     | 5116/9741 [00:07<00:05, 786.71it/s] 53%|█████████████████████████████████████████████████████████████████████████████▉                                                                    | 5201/9741 [00:07<00:05, 804.53it/s] 54%|███████████████████████████████████████████████████████████████████████████████▏                                                                  | 5287/9741 [00:07<00:05, 820.31it/s] 55%|████████████████████████████████████████████████████████████████████████████████▌                                                                 | 5374/9741 [00:07<00:05, 832.07it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▊                                                                | 5459/9741 [00:07<00:05, 834.69it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▏                                                              | 5549/9741 [00:07<00:04, 851.43it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▌                                                             | 5638/9741 [00:07<00:04, 860.70it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▊                                                            | 5728/9741 [00:08<00:04, 872.16it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▏                                                          | 5818/9741 [00:08<00:04, 880.12it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▌                                                         | 5907/9741 [00:08<00:04, 882.27it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▉                                                        | 5997/9741 [00:08<00:04, 887.54it/s] 62%|███████████████████████████████████████████████████████████████████████████████████████████▏                                                      | 6086/9741 [00:08<00:04, 877.79it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▌                                                     | 6176/9741 [00:08<00:04, 883.02it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▉                                                    | 6265/9741 [00:08<00:03, 881.39it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▏                                                  | 6354/9741 [00:08<00:03, 881.72it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▌                                                 | 6444/9741 [00:08<00:03, 886.49it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▉                                                | 6533/9741 [00:08<00:03, 886.78it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▎                                              | 6623/9741 [00:09<00:03, 888.97it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▌                                             | 6713/9741 [00:09<00:03, 891.04it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▉                                            | 6803/9741 [00:09<00:03, 890.81it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▎                                          | 6893/9741 [00:09<00:03, 892.32it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                         | 6983/9741 [00:09<00:03, 893.43it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████                                        | 7073/9741 [00:09<00:02, 891.57it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                      | 7163/9741 [00:09<00:02, 891.59it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                     | 7253/9741 [00:09<00:02, 881.53it/s] 75%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████                                    | 7343/9741 [00:09<00:02, 885.11it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                  | 7433/9741 [00:09<00:02, 889.20it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 7522/9741 [00:10<00:02, 847.08it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                | 7612/9741 [00:10<00:02, 860.95it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                              | 7701/9741 [00:10<00:02, 868.81it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                             | 7792/9741 [00:10<00:02, 878.33it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                           | 7882/9741 [00:10<00:02, 884.09it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                          | 7971/9741 [00:10<00:01, 885.25it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                         | 8060/9741 [00:10<00:01, 883.64it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                       | 8149/9741 [00:10<00:01, 884.90it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                      | 8239/9741 [00:10<00:01, 887.54it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                     | 8329/9741 [00:10<00:01, 889.33it/s] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 8418/9741 [00:11<00:01, 889.20it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 8508/9741 [00:11<00:01, 891.70it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                 | 8598/9741 [00:11<00:01, 889.39it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏               | 8688/9741 [00:11<00:01, 891.17it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌              | 8778/9741 [00:11<00:01, 892.28it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉             | 8868/9741 [00:11<00:00, 890.48it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎           | 8958/9741 [00:11<00:00, 892.53it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌          | 9048/9741 [00:11<00:00, 890.80it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉         | 9138/9741 [00:11<00:00, 889.68it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎       | 9227/9741 [00:11<00:00, 888.34it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋      | 9316/9741 [00:12<00:00, 886.83it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉     | 9406/9741 [00:12<00:00, 887.90it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎   | 9495/9741 [00:12<00:00, 886.22it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋  | 9585/9741 [00:12<00:00, 888.34it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉ | 9674/9741 [00:12<00:00, 888.26it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:12<00:00, 776.93it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.14s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.08s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.31s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.44s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.04s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.97s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.46s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.34s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.52s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.41s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.59s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
[2023-08-11 01:39:29,341] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-11 01:39:39,138] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 01:39:39,139] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 01:39:39,139] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 01:39:39,139] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 01:39:39,139] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 01:39:39,139] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 01:39:39,139] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 01:39:39,139] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 01:39:39,139] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 01:39:39,139] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 01:39:39,139] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f199aa75e80>
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f197796f910>
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 01:39:39,140] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 01:39:39,141] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 01:39:39,141] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 01:39:39,141] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 01:39:39,141] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4116227626800537 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Time to load utils op: 0.40442442893981934 seconds
Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Answer: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Answer: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Answer: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Answer: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Answer: 240

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o7-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.4047396183013916 seconds
Loading extension module utils...
Time to load utils op: 0.40455079078674316 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:41<34:12, 41.89s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:30<36:42, 45.89s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:18<36:44, 46.90s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:39<28:08, 36.70s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:28<30:40, 40.91s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:09<30:10, 41.15s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:58<31:22, 43.79s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:48<31:55, 45.61s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:19<28:09, 41.20s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:09<29:13, 43.84s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:58<29:27, 45.31s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:46<29:19, 46.31s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:36<29:13, 47.40s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:26<28:47, 47.99s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:16<28:22, 48.64s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [12:05<27:39, 48.82s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:53<26:46, 48.68s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:43<26:02, 48.83s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:32<25:15, 48.89s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:22<24:39, 49.30s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:10<23:38, 48.90s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:58<22:42, 48.67s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:25<18:58, 42.16s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:02<17:38, 40.73s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:51<17:54, 42.98s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:41<18:02, 45.11s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:29<17:42, 46.19s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:19<17:20, 47.29s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [21:36<13:22, 38.23s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:26<13:51, 41.59s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [23:15<13:55, 43.97s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [24:05<13:44, 45.82s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [24:55<13:16, 46.85s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:29<11:30, 43.18s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:18<11:11, 44.74s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [27:06<10:43, 45.94s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [27:56<10:09, 46.91s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [28:44<09:27, 47.27s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:32<08:42, 47.49s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [29:50<06:28, 38.83s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [30:26<05:41, 37.93s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:16<05:31, 41.44s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [32:05<05:06, 43.76s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [32:54<04:32, 45.41s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:44<03:52, 46.57s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:32<03:08, 47.23s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [35:21<02:23, 47.71s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [36:10<01:36, 48.20s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [37:01<00:48, 48.85s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:50<00:00, 49.05s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:50<00:00, 45.42s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.7912} | lm_loss 7.7719 | avg. gen lenth: 231.488
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s1-rFalse --seed 1 --num-out-domain 8
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 02:17:38,171] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 8
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o8-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|▊                                                                                                                                                   | 51/9741 [00:00<00:19, 508.49it/s]  1%|█▌                                                                                                                                                 | 103/9741 [00:00<00:18, 511.67it/s]  2%|██▎                                                                                                                                                | 155/9741 [00:00<00:18, 512.92it/s]  2%|███                                                                                                                                                | 207/9741 [00:00<00:18, 510.54it/s]  3%|███▉                                                                                                                                               | 259/9741 [00:00<00:18, 511.41it/s]  3%|████▋                                                                                                                                              | 311/9741 [00:00<00:18, 512.45it/s]  4%|█████▍                                                                                                                                             | 363/9741 [00:00<00:18, 511.47it/s]  4%|██████▎                                                                                                                                            | 415/9741 [00:00<00:18, 503.96it/s]  5%|███████                                                                                                                                            | 466/9741 [00:00<00:18, 503.33it/s]  5%|███████▊                                                                                                                                           | 518/9741 [00:01<00:18, 506.00it/s]  6%|████████▌                                                                                                                                          | 570/9741 [00:01<00:18, 507.37it/s]  6%|█████████▍                                                                                                                                         | 622/9741 [00:01<00:17, 508.52it/s]  7%|██████████▏                                                                                                                                        | 673/9741 [00:01<00:17, 507.65it/s]  7%|██████████▉                                                                                                                                        | 725/9741 [00:01<00:17, 508.73it/s]  8%|███████████▋                                                                                                                                       | 777/9741 [00:01<00:17, 509.44it/s]  9%|████████████▌                                                                                                                                      | 829/9741 [00:01<00:17, 510.15it/s]  9%|█████████████▎                                                                                                                                     | 881/9741 [00:01<00:17, 502.64it/s] 10%|██████████████                                                                                                                                     | 932/9741 [00:01<00:17, 504.15it/s] 10%|██████████████▊                                                                                                                                    | 984/9741 [00:01<00:17, 506.60it/s] 11%|███████████████▉                                                                                                                                  | 1061/9741 [00:02<00:14, 584.07it/s] 12%|█████████████████                                                                                                                                 | 1138/9741 [00:02<00:13, 638.42it/s] 12%|██████████████████▏                                                                                                                               | 1216/9741 [00:02<00:12, 679.09it/s] 13%|███████████████████▍                                                                                                                              | 1294/9741 [00:02<00:11, 708.20it/s] 14%|████████████████████▌                                                                                                                             | 1371/9741 [00:02<00:11, 726.27it/s] 15%|█████████████████████▋                                                                                                                            | 1449/9741 [00:02<00:11, 741.22it/s] 16%|██████████████████████▉                                                                                                                           | 1527/9741 [00:02<00:10, 751.41it/s] 16%|████████████████████████                                                                                                                          | 1604/9741 [00:02<00:10, 754.03it/s] 17%|█████████████████████████▏                                                                                                                        | 1680/9741 [00:02<00:10, 755.62it/s] 18%|██████████████████████████▎                                                                                                                       | 1757/9741 [00:02<00:10, 759.55it/s] 19%|███████████████████████████▍                                                                                                                      | 1833/9741 [00:03<00:10, 735.59it/s] 20%|████████████████████████████▋                                                                                                                     | 1911/9741 [00:03<00:10, 746.85it/s] 20%|█████████████████████████████▊                                                                                                                    | 1989/9741 [00:03<00:10, 755.34it/s] 21%|██████████████████████████████▉                                                                                                                   | 2066/9741 [00:03<00:10, 758.08it/s] 22%|████████████████████████████████                                                                                                                  | 2143/9741 [00:03<00:09, 759.98it/s] 23%|█████████████████████████████████▎                                                                                                                | 2221/9741 [00:03<00:09, 764.47it/s] 24%|██████████████████████████████████▍                                                                                                               | 2298/9741 [00:03<00:09, 764.37it/s] 24%|███████████████████████████████████▌                                                                                                              | 2376/9741 [00:03<00:09, 767.11it/s] 25%|████████████████████████████████████▊                                                                                                             | 2453/9741 [00:03<00:09, 767.23it/s] 26%|█████████████████████████████████████▉                                                                                                            | 2530/9741 [00:03<00:09, 758.52it/s] 27%|███████████████████████████████████████                                                                                                           | 2608/9741 [00:04<00:09, 763.75it/s] 28%|████████████████████████████████████████▏                                                                                                         | 2685/9741 [00:04<00:09, 765.45it/s] 28%|█████████████████████████████████████████▍                                                                                                        | 2762/9741 [00:04<00:09, 765.00it/s] 29%|██████████████████████████████████████████▌                                                                                                       | 2839/9741 [00:04<00:09, 760.13it/s] 30%|███████████████████████████████████████████▋                                                                                                      | 2917/9741 [00:04<00:08, 764.02it/s] 31%|████████████████████████████████████████████▊                                                                                                     | 2994/9741 [00:04<00:08, 762.84it/s] 32%|██████████████████████████████████████████████                                                                                                    | 3071/9741 [00:04<00:08, 764.02it/s] 32%|███████████████████████████████████████████████▏                                                                                                  | 3149/9741 [00:04<00:08, 766.37it/s] 33%|████████████████████████████████████████████████▎                                                                                                 | 3226/9741 [00:04<00:08, 766.09it/s] 34%|█████████████████████████████████████████████████▌                                                                                                | 3303/9741 [00:04<00:08, 764.05it/s] 35%|██████████████████████████████████████████████████▋                                                                                               | 3380/9741 [00:05<00:08, 761.54it/s] 35%|███████████████████████████████████████████████████▊                                                                                              | 3457/9741 [00:05<00:08, 763.63it/s] 36%|████████████████████████████████████████████████████▉                                                                                             | 3534/9741 [00:05<00:08, 765.33it/s] 37%|██████████████████████████████████████████████████████                                                                                            | 3611/9741 [00:05<00:08, 764.49it/s] 38%|███████████████████████████████████████████████████████▎                                                                                          | 3688/9741 [00:05<00:07, 764.92it/s] 39%|████████████████████████████████████████████████████████▍                                                                                         | 3766/9741 [00:05<00:07, 767.79it/s] 39%|█████████████████████████████████████████████████████████▌                                                                                        | 3843/9741 [00:05<00:07, 761.62it/s] 40%|██████████████████████████████████████████████████████████▊                                                                                       | 3921/9741 [00:05<00:07, 764.69it/s] 41%|███████████████████████████████████████████████████████████▉                                                                                      | 3999/9741 [00:05<00:07, 767.41it/s] 42%|█████████████████████████████████████████████████████████████                                                                                     | 4076/9741 [00:05<00:07, 766.07it/s] 43%|██████████████████████████████████████████████████████████████▏                                                                                   | 4153/9741 [00:06<00:07, 761.14it/s] 43%|███████████████████████████████████████████████████████████████▍                                                                                  | 4230/9741 [00:06<00:07, 762.15it/s] 44%|████████████████████████████████████████████████████████████████▌                                                                                 | 4307/9741 [00:06<00:07, 763.27it/s] 45%|█████████████████████████████████████████████████████████████████▋                                                                                | 4385/9741 [00:06<00:06, 766.15it/s] 46%|██████████████████████████████████████████████████████████████████▉                                                                               | 4463/9741 [00:06<00:06, 767.85it/s] 47%|████████████████████████████████████████████████████████████████████                                                                              | 4540/9741 [00:06<00:07, 727.33it/s] 47%|█████████████████████████████████████████████████████████████████████▏                                                                            | 4618/9741 [00:06<00:06, 740.56it/s] 48%|██████████████████████████████████████████████████████████████████████▍                                                                           | 4696/9741 [00:06<00:06, 750.23it/s] 49%|███████████████████████████████████████████████████████████████████████▌                                                                          | 4772/9741 [00:07<00:09, 548.27it/s] 50%|████████████████████████████████████████████████████████████████████████▋                                                                         | 4848/9741 [00:07<00:08, 596.54it/s] 51%|█████████████████████████████████████████████████████████████████████████▊                                                                        | 4923/9741 [00:07<00:07, 633.66it/s] 51%|██████████████████████████████████████████████████████████████████████████▉                                                                       | 5000/9741 [00:07<00:07, 668.14it/s] 52%|████████████████████████████████████████████████████████████████████████████                                                                      | 5076/9741 [00:07<00:06, 692.94it/s] 53%|█████████████████████████████████████████████████████████████████████████████▏                                                                    | 5153/9741 [00:07<00:06, 713.19it/s] 54%|██████████████████████████████████████████████████████████████████████████████▎                                                                   | 5229/9741 [00:07<00:06, 726.14it/s] 54%|███████████████████████████████████████████████████████████████████████████████▌                                                                  | 5307/9741 [00:07<00:05, 739.36it/s] 55%|████████████████████████████████████████████████████████████████████████████████▋                                                                 | 5384/9741 [00:07<00:05, 748.09it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▊                                                                | 5461/9741 [00:07<00:05, 752.00it/s] 57%|███████████████████████████████████████████████████████████████████████████████████                                                               | 5541/9741 [00:08<00:05, 765.55it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▎                                                             | 5622/9741 [00:08<00:05, 775.88it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▍                                                            | 5701/9741 [00:08<00:05, 777.40it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▋                                                           | 5780/9741 [00:08<00:05, 780.57it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▊                                                          | 5860/9741 [00:08<00:04, 783.99it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████                                                         | 5941/9741 [00:08<00:04, 789.62it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▎                                                       | 6022/9741 [00:08<00:04, 793.32it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▍                                                      | 6102/9741 [00:08<00:04, 793.85it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▋                                                     | 6183/9741 [00:08<00:04, 797.25it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▉                                                    | 6264/9741 [00:08<00:04, 798.19it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████                                                   | 6344/9741 [00:09<00:04, 792.46it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▎                                                 | 6424/9741 [00:09<00:04, 794.65it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▍                                                | 6504/9741 [00:09<00:04, 795.98it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▋                                               | 6584/9741 [00:09<00:04, 788.58it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▊                                              | 6663/9741 [00:09<00:03, 788.58it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████                                             | 6743/9741 [00:09<00:03, 790.14it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▎                                           | 6823/9741 [00:09<00:03, 791.19it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▍                                          | 6904/9741 [00:09<00:03, 793.93it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                         | 6985/9741 [00:09<00:03, 796.83it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                        | 7065/9741 [00:09<00:03, 796.44it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████                                       | 7146/9741 [00:10<00:03, 798.00it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                     | 7226/9741 [00:10<00:03, 795.89it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                    | 7307/9741 [00:10<00:03, 797.49it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                   | 7388/9741 [00:10<00:02, 798.86it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                  | 7468/9741 [00:10<00:02, 762.43it/s] 77%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                | 7548/9741 [00:10<00:02, 771.92it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                               | 7628/9741 [00:10<00:02, 779.06it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                              | 7708/9741 [00:10<00:02, 783.35it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                             | 7789/9741 [00:10<00:02, 789.57it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                            | 7870/9741 [00:10<00:02, 794.05it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                          | 7950/9741 [00:11<00:02, 794.36it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                         | 8031/9741 [00:11<00:02, 796.04it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                        | 8112/9741 [00:11<00:02, 797.78it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                       | 8192/9741 [00:11<00:01, 795.95it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                      | 8272/9741 [00:11<00:01, 794.01it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                    | 8352/9741 [00:11<00:01, 785.14it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                   | 8431/9741 [00:11<00:01, 786.12it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 8511/9741 [00:11<00:01, 789.94it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                 | 8591/9741 [00:11<00:01, 790.42it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                | 8671/9741 [00:11<00:01, 793.11it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏              | 8751/9741 [00:12<00:01, 794.18it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎             | 8831/9741 [00:12<00:01, 792.25it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 8911/9741 [00:12<00:01, 794.01it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊           | 8992/9741 [00:12<00:00, 796.14it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉          | 9072/9741 [00:12<00:00, 789.21it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏        | 9151/9741 [00:12<00:00, 789.06it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎       | 9230/9741 [00:12<00:00, 788.00it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌      | 9309/9741 [00:12<00:00, 787.48it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋     | 9390/9741 [00:12<00:00, 791.77it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉    | 9471/9741 [00:13<00:00, 794.41it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏  | 9551/9741 [00:13<00:00, 793.45it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎ | 9631/9741 [00:13<00:00, 794.02it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌| 9711/9741 [00:13<00:00, 792.80it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:13<00:00, 729.76it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.90s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.57s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:06<00:12,  6.11s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.60s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.88s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.45s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.45s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.30s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.46s/it]
Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:14<00:07,  7.23s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.93s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.08s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.91s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.07s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:19<00:00,  6.49s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:19<00:00,  6.58s/it]
[2023-08-11 02:18:48,921] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-11 02:19:00,773] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 02:19:00,774] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 02:19:00,775] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 02:19:00,775] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 02:19:00,775] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 02:19:00,775] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 02:19:00,775] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 02:19:00,775] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fe805929e80>
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 02:19:00,776] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fe80563f910>
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 02:19:00,777] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 02:19:00,777] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4550917148590088 seconds
Loading extension module utils...
Time to load utils op: 0.3048720359802246 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Answer: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Answer: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Answer: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Answer: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Answer: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Answer: 21

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o8-tgsm8k-s1-rFalse
Loading extension module utils...
Time to load utils op: 0.4044013023376465 seconds
Loading extension module utils...
Time to load utils op: 0.40462827682495117 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:47<39:09, 47.94s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:24<33:01, 41.28s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [01:52<27:38, 35.28s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:40<30:53, 40.30s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:29<32:25, 43.24s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:16<32:43, 44.63s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:43<27:44, 38.71s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:31<29:14, 41.78s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:19<29:49, 43.66s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:07<29:59, 44.99s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:54<29:44, 45.77s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:42<29:18, 46.29s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:30<28:57, 46.96s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:18<28:18, 47.18s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:39<22:56, 39.33s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:28<23:51, 42.12s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:15<24:01, 43.67s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:02<23:55, 44.86s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [13:50<23:38, 45.75s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:38<23:06, 46.21s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:25<22:35, 46.73s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:13<21:57, 47.06s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:01<21:18, 47.36s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [17:50<20:38, 47.65s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:39<20:00, 48.04s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:27<19:13, 48.05s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:15<18:24, 48.02s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:03<17:35, 47.96s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [21:50<16:46, 47.93s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:38<15:54, 47.72s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [23:25<15:07, 47.77s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [24:13<14:17, 47.66s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [24:47<12:23, 43.73s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:35<11:58, 44.91s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:23<11:27, 45.85s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [27:11<10:48, 46.33s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [27:58<10:06, 46.62s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [28:46<09:23, 46.92s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:33<08:39, 47.18s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [30:21<07:52, 47.20s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [30:43<05:57, 39.69s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:31<05:36, 42.12s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [32:16<05:02, 43.18s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [32:47<03:57, 39.60s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:35<03:30, 42.03s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:23<02:55, 43.85s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [35:10<02:14, 44.76s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [35:58<01:31, 45.65s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [36:46<00:46, 46.38s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:34<00:00, 46.76s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:34<00:00, 45.08s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.9819} | lm_loss 7.8379 | avg. gen lenth: 260.852
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s1-rFalse --seed 1 --num-out-domain 9
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 02:56:41,871] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s1-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 9
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o9-tgsm8k-s1-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 1
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|▋                                                                                                                                                   | 49/9741 [00:00<00:20, 480.47it/s]  1%|█▍                                                                                                                                                  | 98/9741 [00:00<00:19, 483.39it/s]  2%|██▏                                                                                                                                                | 147/9741 [00:00<00:19, 484.21it/s]  2%|██▉                                                                                                                                                | 196/9741 [00:00<00:19, 484.20it/s]  3%|███▋                                                                                                                                               | 245/9741 [00:00<00:19, 482.01it/s]  3%|████▍                                                                                                                                              | 294/9741 [00:00<00:19, 482.35it/s]  4%|█████▏                                                                                                                                             | 343/9741 [00:00<00:19, 482.88it/s]  4%|█████▉                                                                                                                                             | 392/9741 [00:00<00:19, 476.53it/s]  5%|██████▋                                                                                                                                            | 440/9741 [00:00<00:19, 475.34it/s]  5%|███████▍                                                                                                                                           | 489/9741 [00:01<00:19, 477.68it/s]  6%|████████                                                                                                                                           | 538/9741 [00:01<00:19, 479.06it/s]  6%|████████▊                                                                                                                                          | 587/9741 [00:01<00:19, 479.86it/s]  7%|█████████▌                                                                                                                                         | 636/9741 [00:01<00:18, 480.25it/s]  7%|██████████▎                                                                                                                                        | 685/9741 [00:01<00:18, 479.61it/s]  8%|███████████                                                                                                                                        | 734/9741 [00:01<00:18, 479.99it/s]  8%|███████████▊                                                                                                                                       | 783/9741 [00:01<00:18, 481.27it/s]  9%|████████████▌                                                                                                                                      | 832/9741 [00:01<00:18, 482.03it/s]  9%|█████████████▎                                                                                                                                     | 881/9741 [00:01<00:18, 475.30it/s] 10%|██████████████                                                                                                                                     | 929/9741 [00:01<00:18, 476.42it/s] 10%|██████████████▊                                                                                                                                    | 978/9741 [00:02<00:18, 478.29it/s] 11%|███████████████▍                                                                                                                                  | 1027/9741 [00:02<00:18, 480.07it/s] 11%|████████████████▏                                                                                                                                 | 1076/9741 [00:02<00:18, 481.10it/s] 12%|████████████████▊                                                                                                                                 | 1125/9741 [00:02<00:17, 480.02it/s] 12%|█████████████████▌                                                                                                                                | 1174/9741 [00:02<00:17, 480.93it/s] 13%|██████████████████▌                                                                                                                               | 1237/9741 [00:02<00:16, 523.93it/s] 13%|███████████████████▋                                                                                                                              | 1311/9741 [00:02<00:14, 587.04it/s] 14%|████████████████████▋                                                                                                                             | 1384/9741 [00:02<00:13, 627.82it/s] 15%|█████████████████████▊                                                                                                                            | 1458/9741 [00:02<00:12, 659.33it/s] 16%|██████████████████████▉                                                                                                                           | 1532/9741 [00:02<00:12, 680.66it/s] 16%|████████████████████████                                                                                                                          | 1605/9741 [00:03<00:11, 693.54it/s] 17%|█████████████████████████▏                                                                                                                        | 1678/9741 [00:03<00:11, 704.30it/s] 18%|██████████████████████████▎                                                                                                                       | 1752/9741 [00:03<00:11, 712.45it/s] 19%|███████████████████████████▎                                                                                                                      | 1824/9741 [00:03<00:11, 692.00it/s] 19%|████████████████████████████▍                                                                                                                     | 1897/9741 [00:03<00:11, 702.57it/s] 20%|█████████████████████████████▌                                                                                                                    | 1970/9741 [00:03<00:10, 710.36it/s] 21%|██████████████████████████████▌                                                                                                                   | 2043/9741 [00:03<00:10, 713.55it/s] 22%|███████████████████████████████▋                                                                                                                  | 2116/9741 [00:03<00:10, 717.22it/s] 22%|████████████████████████████████▊                                                                                                                 | 2189/9741 [00:03<00:10, 719.91it/s] 23%|█████████████████████████████████▉                                                                                                                | 2262/9741 [00:03<00:10, 720.10it/s] 24%|███████████████████████████████████                                                                                                               | 2336/9741 [00:04<00:10, 723.16it/s] 25%|████████████████████████████████████                                                                                                              | 2410/9741 [00:04<00:10, 725.39it/s] 25%|█████████████████████████████████████▏                                                                                                            | 2483/9741 [00:04<00:10, 722.93it/s] 26%|██████████████████████████████████████▎                                                                                                           | 2556/9741 [00:04<00:09, 722.13it/s] 27%|███████████████████████████████████████▍                                                                                                          | 2630/9741 [00:04<00:09, 724.59it/s] 28%|████████████████████████████████████████▌                                                                                                         | 2703/9741 [00:04<00:09, 723.56it/s] 28%|█████████████████████████████████████████▌                                                                                                        | 2776/9741 [00:04<00:09, 724.71it/s] 29%|██████████████████████████████████████████▋                                                                                                       | 2849/9741 [00:04<00:09, 725.81it/s] 30%|███████████████████████████████████████████▊                                                                                                      | 2923/9741 [00:04<00:09, 727.50it/s] 31%|████████████████████████████████████████████▉                                                                                                     | 2996/9741 [00:04<00:09, 725.26it/s] 32%|█████████████████████████████████████████████▉                                                                                                    | 3069/9741 [00:05<00:09, 725.75it/s] 32%|███████████████████████████████████████████████                                                                                                   | 3142/9741 [00:05<00:09, 726.53it/s] 33%|████████████████████████████████████████████████▏                                                                                                 | 3215/9741 [00:05<00:09, 724.64it/s] 34%|█████████████████████████████████████████████████▎                                                                                                | 3289/9741 [00:05<00:08, 726.49it/s] 35%|██████████████████████████████████████████████████▍                                                                                               | 3362/9741 [00:05<00:08, 726.96it/s] 35%|███████████████████████████████████████████████████▍                                                                                              | 3435/9741 [00:05<00:08, 725.05it/s] 36%|████████████████████████████████████████████████████▌                                                                                             | 3508/9741 [00:05<00:08, 725.26it/s] 37%|█████████████████████████████████████████████████████▋                                                                                            | 3581/9741 [00:05<00:08, 722.11it/s] 38%|██████████████████████████████████████████████████████▊                                                                                           | 3654/9741 [00:05<00:08, 721.10it/s] 38%|███████████████████████████████████████████████████████▊                                                                                          | 3727/9741 [00:05<00:08, 722.83it/s] 39%|████████████████████████████████████████████████████████▉                                                                                         | 3800/9741 [00:06<00:08, 723.75it/s] 40%|██████████████████████████████████████████████████████████                                                                                        | 3873/9741 [00:06<00:08, 722.84it/s] 41%|███████████████████████████████████████████████████████████▏                                                                                      | 3946/9741 [00:06<00:07, 724.50it/s] 41%|████████████████████████████████████████████████████████████▏                                                                                     | 4019/9741 [00:06<00:07, 724.01it/s] 42%|█████████████████████████████████████████████████████████████▎                                                                                    | 4092/9741 [00:06<00:07, 723.06it/s] 43%|██████████████████████████████████████████████████████████████▍                                                                                   | 4165/9741 [00:06<00:07, 723.41it/s] 44%|███████████████████████████████████████████████████████████████▌                                                                                  | 4238/9741 [00:06<00:07, 724.14it/s] 44%|████████████████████████████████████████████████████████████████▌                                                                                 | 4311/9741 [00:06<00:07, 722.85it/s] 45%|█████████████████████████████████████████████████████████████████▋                                                                                | 4384/9741 [00:06<00:07, 724.22it/s] 46%|██████████████████████████████████████████████████████████████████▊                                                                               | 4457/9741 [00:06<00:07, 724.55it/s] 47%|███████████████████████████████████████████████████████████████████▉                                                                              | 4530/9741 [00:07<00:07, 684.28it/s] 47%|████████████████████████████████████████████████████████████████████▉                                                                             | 4603/9741 [00:07<00:07, 696.71it/s] 48%|██████████████████████████████████████████████████████████████████████                                                                            | 4676/9741 [00:07<00:07, 705.66it/s] 49%|███████████████████████████████████████████████████████████████████████▏                                                                          | 4747/9741 [00:07<00:09, 518.17it/s] 49%|████████████████████████████████████████████████████████████████████████▏                                                                         | 4820/9741 [00:07<00:08, 567.45it/s] 50%|█████████████████████████████████████████████████████████████████████████▎                                                                        | 4893/9741 [00:07<00:07, 607.44it/s] 51%|██████████████████████████████████████████████████████████████████████████▍                                                                       | 4965/9741 [00:07<00:07, 637.08it/s] 52%|███████████████████████████████████████████████████████████████████████████▍                                                                      | 5037/9741 [00:07<00:07, 659.32it/s] 52%|████████████████████████████████████████████████████████████████████████████▌                                                                     | 5109/9741 [00:08<00:06, 675.88it/s] 53%|█████████████████████████████████████████████████████████████████████████████▋                                                                    | 5182/9741 [00:08<00:06, 688.83it/s] 54%|██████████████████████████████████████████████████████████████████████████████▊                                                                   | 5255/9741 [00:08<00:06, 700.26it/s] 55%|███████████████████████████████████████████████████████████████████████████████▊                                                                  | 5327/9741 [00:08<00:06, 702.69it/s] 55%|████████████████████████████████████████████████████████████████████████████████▉                                                                 | 5399/9741 [00:08<00:06, 705.41it/s] 56%|██████████████████████████████████████████████████████████████████████████████████                                                                | 5472/9741 [00:08<00:05, 712.64it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▏                                                              | 5548/9741 [00:08<00:05, 726.10it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▎                                                             | 5624/9741 [00:08<00:05, 734.71it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▍                                                            | 5699/9741 [00:08<00:05, 739.00it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▌                                                           | 5775/9741 [00:08<00:05, 745.22it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▋                                                          | 5851/9741 [00:09<00:05, 748.45it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▊                                                         | 5927/9741 [00:09<00:05, 749.33it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▉                                                        | 6003/9741 [00:09<00:04, 752.38it/s] 62%|███████████████████████████████████████████████████████████████████████████████████████████                                                       | 6079/9741 [00:09<00:04, 751.69it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▎                                                     | 6155/9741 [00:09<00:04, 753.09it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▍                                                    | 6231/9741 [00:09<00:04, 752.87it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▌                                                   | 6307/9741 [00:09<00:04, 741.67it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▋                                                  | 6383/9741 [00:09<00:04, 745.96it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▊                                                 | 6459/9741 [00:09<00:04, 748.67it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▉                                                | 6534/9741 [00:09<00:04, 748.40it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████                                               | 6610/9741 [00:10<00:04, 750.63it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▏                                             | 6686/9741 [00:10<00:04, 752.72it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████▎                                            | 6762/9741 [00:10<00:03, 751.83it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▍                                           | 6838/9741 [00:10<00:03, 752.60it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▋                                          | 6914/9741 [00:10<00:03, 751.11it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                         | 6990/9741 [00:10<00:03, 750.60it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                        | 7066/9741 [00:10<00:03, 752.08it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████                                       | 7142/9741 [00:10<00:03, 753.72it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                     | 7218/9741 [00:10<00:03, 752.08it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                    | 7294/9741 [00:10<00:03, 753.49it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                   | 7370/9741 [00:11<00:03, 753.92it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                  | 7446/9741 [00:11<00:03, 707.42it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 7522/9741 [00:11<00:03, 720.87it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                | 7598/9741 [00:11<00:02, 730.86it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████                               | 7673/9741 [00:11<00:02, 735.68it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                             | 7749/9741 [00:11<00:02, 742.66it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                            | 7825/9741 [00:11<00:02, 746.56it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                           | 7900/9741 [00:11<00:02, 747.03it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                          | 7976/9741 [00:11<00:02, 749.92it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                         | 8052/9741 [00:11<00:02, 751.24it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                        | 8128/9741 [00:12<00:02, 750.29it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                       | 8204/9741 [00:12<00:02, 752.13it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                      | 8280/9741 [00:12<00:01, 750.25it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                    | 8356/9741 [00:12<00:01, 748.20it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                   | 8432/9741 [00:12<00:01, 750.94it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 8508/9741 [00:12<00:01, 753.11it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 8584/9741 [00:12<00:01, 750.97it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 8660/9741 [00:12<00:01, 752.01it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉               | 8736/9741 [00:12<00:01, 751.70it/s] 90%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████              | 8812/9741 [00:13<00:01, 750.11it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏            | 8888/9741 [00:13<00:01, 750.96it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎           | 8964/9741 [00:13<00:01, 752.68it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍          | 9040/9741 [00:13<00:00, 751.17it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋         | 9116/9741 [00:13<00:00, 752.23it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊        | 9192/9741 [00:13<00:00, 754.11it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉       | 9268/9741 [00:13<00:00, 751.92it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████      | 9344/9741 [00:13<00:00, 752.41it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏    | 9420/9741 [00:13<00:00, 752.74it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎   | 9496/9741 [00:13<00:00, 751.07it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍  | 9572/9741 [00:14<00:00, 752.51it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌ | 9648/9741 [00:14<00:00, 751.86it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋| 9724/9741 [00:14<00:00, 747.53it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:14<00:00, 683.70it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  5.00s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.39s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.55s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.55s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.90s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.49s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.49s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.45s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.30s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.84s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.01s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.87s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.04s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.82s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.00s/it]
[2023-08-11 02:57:48,565] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-11 02:57:59,858] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 02:57:59,859] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 02:57:59,859] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 02:57:59,859] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 02:57:59,859] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 02:57:59,859] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f613dad3e80>
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 02:57:59,860] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f613ce9a910>
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 02:57:59,861] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 02:57:59,862] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 02:57:59,862] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 02:57:59,862] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 02:57:59,862] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4374568462371826 seconds
Loading extension module utils...
Time to load utils op: 0.5079472064971924 seconds
Loading extension module utils...
Time to load utils op: 0.4044339656829834 seconds
Loading extension module utils...
Time to load utils op: 0.4047079086303711 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Mary had 89 stickers.  She used 3 large stickers on the front page of her journal and 7 stickers each to 6 other pages of her journal. How many stickers does Mary have remaining?
Answer: 44

Input: Zach is saving his money to buy a brand new bike that costs $100.  His weekly allowance is $5.  His parent will pay him an extra $10 to mow the lawn.  His neighbor will pay him $7 per hour to babysit their son.  He has already saved up $65.  He'll receive his allowance on Friday and he's planning on babysitting for 2 hours this Saturday after he mows the lawn.  How much more money does Zach need to earn before he can buy the bike?
Answer: 6

Input: Mark has kangaroos and goats.  Kangaroos have two legs and goats have four legs.  If he has 23 kangaroos and three times as many goats as kangaroos what is the total number of legs of all his animals?
Answer: 322

Input: Josh’s mom gives him $20 to go shopping at the mall. He buys a hat for $10 and a pencil for $2. Then he buys four cookies. If each cookie costs $1.25, how much money does Josh have left?
Answer: 3

Input: George's bowling team is one round away from breaking the league record for most points scored in a season. The old record is an average score per player of 287 per round. Each team has 4 players and there are 10 rounds in the season. Through the first 9 rounds, his team has scored a total of 10,440. How many points less than the current league record per game average is the minimum average they need to score, per player, in the final round to tie the league record?
Answer: 27

Input: Max was doing homework in three different subjects. It took him 20 minutes to finish tasks from biology and two times more time to finish history. Geography took him the most time, three times more than history. How much time did Max spend on doing his homework?
Answer: 180

Input: Sophia ate 1/6 of her pie and she put the rest on the fridge. If the pie left in the fridge weighs 1200 grams, how many grams did Sophia eat?
Answer: 240

Input: Sarah, Mary, and Tuan decided to go to the restaurant for a meal. They decided to split the cost of the meal evenly. If the total price of the meal comes to $67 and they have a coupon for $4, how much does each person need to contribute to the bill?
Answer: 21

Input: Tom's brother is 4 times as old as Tom's dog. If in 6 years, Tom's brother will be 30 years, how old is Tom's dog going to be in six years?
Answer: 12

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o9-tgsm8k-s1-rFalse
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:47<38:39, 47.33s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:34<37:38, 47.06s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:21<36:58, 47.21s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:08<36:09, 47.16s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:56<35:31, 47.37s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:44<34:52, 47.55s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:31<33:58, 47.42s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:14<32:19, 46.17s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:01<31:35, 46.24s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:48<31:01, 46.55s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:05<24:26, 37.61s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:53<25:44, 40.65s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:40<26:20, 42.71s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:28<26:29, 44.14s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:15<26:17, 45.06s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [12:02<25:53, 45.70s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:47<24:56, 45.35s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:34<24:27, 45.87s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:21<23:50, 46.14s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:02<22:17, 44.58s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:50<22:01, 45.57s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:37<21:31, 46.14s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [16:59<17:30, 38.90s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [17:47<18:01, 41.60s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:34<18:04, 43.39s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:22<17:48, 44.51s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:10<17:27, 45.56s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [20:27<13:34, 37.02s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [21:14<14:01, 40.07s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:02<14:07, 42.37s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [22:50<13:56, 44.05s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [23:14<11:26, 38.16s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:41<09:50, 34.75s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [24:29<10:19, 38.70s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:59<09:04, 36.27s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [25:47<09:14, 39.59s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [26:34<09:05, 41.93s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [27:21<08:40, 43.42s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [28:07<08:07, 44.30s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [28:55<07:32, 45.22s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [29:42<06:53, 45.94s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [30:29<06:08, 46.07s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [31:16<05:25, 46.47s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [32:03<04:39, 46.51s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [32:49<03:53, 46.61s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [33:36<03:06, 46.71s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [34:25<02:21, 47.23s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [34:37<01:13, 36.57s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [35:23<00:39, 39.68s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [36:11<00:00, 42.13s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [36:11<00:00, 43.44s/it]
name: commonsenseqa | {'exact_match': 0.8, 'rougeL': 4.4555} | lm_loss 7.8261 | avg. gen lenth: 242.804
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s10-rTrue --seed 10 --rationales --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 03:35:45,679] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  2%|██▌                                                                                                                                               | 175/9741 [00:00<00:05, 1738.94it/s]  4%|█████▏                                                                                                                                            | 350/9741 [00:00<00:05, 1740.93it/s]  5%|███████▉                                                                                                                                          | 527/9741 [00:00<00:05, 1750.52it/s]  7%|██████████▌                                                                                                                                       | 704/9741 [00:00<00:05, 1755.69it/s]  9%|█████████████▏                                                                                                                                    | 882/9741 [00:00<00:05, 1761.76it/s] 11%|███████████████▊                                                                                                                                 | 1061/9741 [00:00<00:04, 1767.94it/s] 13%|██████████████████▍                                                                                                                              | 1239/9741 [00:00<00:04, 1768.82it/s] 15%|█████████████████████                                                                                                                            | 1416/9741 [00:00<00:04, 1768.57it/s] 16%|███████████████████████▋                                                                                                                         | 1593/9741 [00:00<00:04, 1732.07it/s] 18%|██████████████████████████▎                                                                                                                      | 1770/9741 [00:01<00:04, 1741.63it/s] 20%|████████████████████████████▉                                                                                                                    | 1945/9741 [00:01<00:04, 1701.73it/s] 22%|███████████████████████████████▌                                                                                                                 | 2120/9741 [00:01<00:04, 1713.46it/s] 24%|██████████████████████████████████▏                                                                                                              | 2296/9741 [00:01<00:04, 1726.55it/s] 25%|████████████████████████████████████▊                                                                                                            | 2472/9741 [00:01<00:04, 1734.57it/s] 27%|███████████████████████████████████████▍                                                                                                         | 2648/9741 [00:01<00:04, 1742.07it/s] 29%|██████████████████████████████████████████                                                                                                       | 2823/9741 [00:01<00:03, 1740.07it/s] 31%|████████████████████████████████████████████▋                                                                                                    | 2999/9741 [00:01<00:03, 1744.79it/s] 33%|███████████████████████████████████████████████▏                                                                                                 | 3174/9741 [00:01<00:03, 1745.24it/s] 34%|█████████████████████████████████████████████████▊                                                                                               | 3349/9741 [00:01<00:03, 1744.84it/s] 36%|████████████████████████████████████████████████████▍                                                                                            | 3524/9741 [00:02<00:03, 1741.69it/s] 38%|███████████████████████████████████████████████████████                                                                                          | 3699/9741 [00:02<00:03, 1743.59it/s] 40%|█████████████████████████████████████████████████████████▋                                                                                       | 3876/9741 [00:02<00:03, 1749.04it/s] 42%|████████████████████████████████████████████████████████████▎                                                                                    | 4053/9741 [00:02<00:03, 1754.84it/s] 43%|██████████████████████████████████████████████████████████████▉                                                                                  | 4229/9741 [00:02<00:03, 1751.26it/s] 45%|█████████████████████████████████████████████████████████████████▌                                                                               | 4405/9741 [00:02<00:03, 1738.98it/s] 47%|████████████████████████████████████████████████████████████████████▏                                                                            | 4579/9741 [00:02<00:03, 1707.29it/s] 49%|██████████████████████████████████████████████████████████████████████▋                                                                          | 4750/9741 [00:02<00:03, 1258.88it/s] 51%|█████████████████████████████████████████████████████████████████████████▎                                                                       | 4925/9741 [00:02<00:03, 1374.35it/s] 52%|███████████████████████████████████████████████████████████████████████████▉                                                                     | 5101/9741 [00:03<00:03, 1471.41it/s] 54%|██████████████████████████████████████████████████████████████████████████████▌                                                                  | 5276/9741 [00:03<00:02, 1544.74it/s] 56%|█████████████████████████████████████████████████████████████████████████████████                                                                | 5443/9741 [00:03<00:02, 1578.49it/s] 58%|███████████████████████████████████████████████████████████████████████████████████▋                                                             | 5624/9741 [00:03<00:02, 1641.47it/s] 60%|██████████████████████████████████████████████████████████████████████████████████████▍                                                          | 5806/9741 [00:03<00:02, 1691.61it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▏                                                       | 5988/9741 [00:03<00:02, 1726.36it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▊                                                     | 6169/9741 [00:03<00:02, 1749.21it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▍                                                  | 6348/9741 [00:03<00:01, 1760.36it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▏                                               | 6529/9741 [00:03<00:01, 1772.64it/s] 69%|███████████████████████████████████████████████████████████████████████████████████████████████████▊                                             | 6709/9741 [00:03<00:01, 1779.34it/s] 71%|██████████████████████████████████████████████████████████████████████████████████████████████████████▌                                          | 6891/9741 [00:04<00:01, 1789.58it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                       | 7073/9741 [00:04<00:01, 1796.94it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                     | 7254/9741 [00:04<00:01, 1800.28it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                  | 7437/9741 [00:04<00:01, 1807.99it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                               | 7618/9741 [00:04<00:01, 1774.24it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                             | 7796/9741 [00:04<00:01, 1758.67it/s] 82%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                          | 7977/9741 [00:04<00:00, 1771.10it/s] 85%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 8246/9741 [00:04<00:00, 2041.77it/s] 88%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                  | 8524/9741 [00:04<00:00, 2259.02it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉              | 8800/9741 [00:04<00:00, 2407.10it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 9076/9741 [00:05<00:00, 2511.61it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏     | 9353/9741 [00:05<00:00, 2586.38it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎ | 9628/9741 [00:05<00:00, 2633.63it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:05<00:00, 1833.81it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.39s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.52s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.34s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.92s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.34s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.44s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.44s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.29s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.98s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.97s/it]
[2023-08-11 03:36:43,517] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-11 03:36:52,108] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 03:36:52,109] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 03:36:52,109] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fbd53237e80>
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 03:36:52,110] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fbd2faad910>
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 03:36:52,111] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 03:36:52,112] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 03:36:52,112] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3577840328216553 seconds
Loading extension module utils...
Time to load utils op: 0.30429744720458984 seconds
Loading extension module utils...
Time to load utils op: 0.3041391372680664 seconds
Loading extension module utils...
Time to load utils op: 0.30415940284729004 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Rationales: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
#### 56
Answer: 56

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s10-rTrue
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:34<27:54, 34.17s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:30<37:44, 47.18s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:26<40:10, 51.30s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:22<40:49, 53.25s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:17<40:13, 53.64s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [05:13<39:53, 54.41s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:52<35:26, 49.44s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:49<36:17, 51.84s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:44<36:09, 52.91s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:40<35:48, 53.70s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [09:35<35:11, 54.15s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [10:15<31:33, 49.82s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [11:10<31:49, 51.61s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [12:08<31:59, 53.33s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [13:03<31:31, 54.03s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [13:52<29:40, 52.36s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [14:32<26:49, 48.79s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [15:28<27:10, 50.94s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [16:23<26:52, 52.03s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [17:10<25:17, 50.58s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [18:06<25:13, 52.17s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [19:02<24:55, 53.41s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [19:58<24:21, 54.13s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [20:54<23:40, 54.64s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [21:26<19:57, 47.90s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [22:00<17:25, 43.58s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [22:55<18:05, 47.20s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [23:51<18:18, 49.91s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [24:46<18:00, 51.46s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [25:42<17:33, 52.66s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [26:08<14:07, 44.61s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [26:38<12:02, 40.16s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [27:33<12:41, 44.81s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [28:28<12:44, 47.76s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [29:24<12:32, 50.14s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [30:11<11:31, 49.41s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [31:08<11:09, 51.53s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [31:48<09:39, 48.28s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [32:44<09:16, 50.57s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [33:40<08:41, 52.14s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [34:18<07:11, 47.95s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [35:13<06:39, 49.93s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [36:08<06:01, 51.58s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [36:31<04:17, 42.84s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [37:26<03:52, 46.47s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [38:13<03:06, 46.74s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [38:35<01:57, 39.32s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [39:32<01:29, 44.62s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [40:27<00:47, 47.81s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [41:00<00:00, 43.25s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [41:00<00:00, 49.21s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.1477} | lm_loss 7.7256 | avg. gen lenth: 221.916
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s10-rTrue --seed 10 --rationales --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 04:21:04,982] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|█▌                                                                                                                                                | 104/9741 [00:00<00:09, 1035.07it/s]  2%|███▏                                                                                                                                              | 210/9741 [00:00<00:09, 1047.64it/s]  3%|████▊                                                                                                                                             | 319/9741 [00:00<00:08, 1063.05it/s]  4%|██████▍                                                                                                                                           | 427/9741 [00:00<00:08, 1067.46it/s]  6%|████████                                                                                                                                          | 536/9741 [00:00<00:08, 1073.28it/s]  7%|█████████▋                                                                                                                                        | 644/9741 [00:00<00:08, 1074.10it/s]  8%|███████████▎                                                                                                                                      | 752/9741 [00:00<00:08, 1074.36it/s]  9%|████████████▉                                                                                                                                     | 860/9741 [00:00<00:08, 1057.57it/s] 10%|██████████████▍                                                                                                                                   | 966/9741 [00:00<00:08, 1055.85it/s] 11%|███████████████▉                                                                                                                                 | 1073/9741 [00:01<00:08, 1059.17it/s] 12%|█████████████████▌                                                                                                                               | 1180/9741 [00:01<00:08, 1062.18it/s] 13%|███████████████████▏                                                                                                                             | 1287/9741 [00:01<00:07, 1064.45it/s] 14%|████████████████████▊                                                                                                                            | 1394/9741 [00:01<00:07, 1064.26it/s] 15%|██████████████████████▎                                                                                                                          | 1502/9741 [00:01<00:07, 1067.71it/s] 17%|███████████████████████▉                                                                                                                         | 1610/9741 [00:01<00:07, 1068.48it/s] 18%|█████████████████████████▌                                                                                                                       | 1719/9741 [00:01<00:07, 1073.33it/s] 19%|███████████████████████████▏                                                                                                                     | 1827/9741 [00:01<00:07, 1043.45it/s] 20%|████████████████████████████▊                                                                                                                    | 1933/9741 [00:01<00:07, 1046.99it/s] 21%|██████████████████████████████▎                                                                                                                  | 2039/9741 [00:01<00:07, 1049.73it/s] 22%|███████████████████████████████▉                                                                                                                 | 2147/9741 [00:02<00:07, 1056.24it/s] 23%|█████████████████████████████████▌                                                                                                               | 2255/9741 [00:02<00:07, 1061.28it/s] 24%|███████████████████████████████████▏                                                                                                             | 2363/9741 [00:02<00:06, 1066.62it/s] 25%|████████████████████████████████████▊                                                                                                            | 2471/9741 [00:02<00:06, 1069.69it/s] 27%|██████████████████████████████████████▌                                                                                                          | 2590/9741 [00:02<00:06, 1104.03it/s] 28%|████████████████████████████████████████▉                                                                                                        | 2753/9741 [00:02<00:05, 1259.45it/s] 30%|███████████████████████████████████████████▏                                                                                                     | 2902/9741 [00:02<00:05, 1327.61it/s] 31%|█████████████████████████████████████████████▋                                                                                                   | 3067/9741 [00:02<00:04, 1421.92it/s] 33%|████████████████████████████████████████████████                                                                                                 | 3231/9741 [00:02<00:04, 1485.33it/s] 35%|██████████████████████████████████████████████████▌                                                                                              | 3396/9741 [00:02<00:04, 1532.92it/s] 37%|████████████████████████████████████████████████████▉                                                                                            | 3560/9741 [00:03<00:03, 1564.28it/s] 38%|███████████████████████████████████████████████████████▍                                                                                         | 3724/9741 [00:03<00:03, 1585.18it/s] 40%|█████████████████████████████████████████████████████████▉                                                                                       | 3889/9741 [00:03<00:03, 1603.18it/s] 42%|████████████████████████████████████████████████████████████▎                                                                                    | 4055/9741 [00:03<00:03, 1618.00it/s] 43%|██████████████████████████████████████████████████████████████▊                                                                                  | 4219/9741 [00:03<00:03, 1622.04it/s] 45%|█████████████████████████████████████████████████████████████████▏                                                                               | 4383/9741 [00:03<00:03, 1626.42it/s] 47%|███████████████████████████████████████████████████████████████████▋                                                                             | 4546/9741 [00:03<00:03, 1586.32it/s] 48%|██████████████████████████████████████████████████████████████████████▏                                                                          | 4712/9741 [00:03<00:03, 1605.33it/s] 50%|████████████████████████████████████████████████████████████████████████▌                                                                        | 4873/9741 [00:03<00:03, 1222.43it/s] 52%|██████████████████████████████████████████████████████████████████████████▉                                                                      | 5037/9741 [00:04<00:03, 1322.20it/s] 53%|█████████████████████████████████████████████████████████████████████████████▍                                                                   | 5201/9741 [00:04<00:03, 1403.99it/s] 55%|███████████████████████████████████████████████████████████████████████████████▉                                                                 | 5367/9741 [00:04<00:02, 1471.62it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▍                                                              | 5534/9741 [00:04<00:02, 1526.59it/s] 59%|████████████████████████████████████████████████████████████████████████████████████▊                                                            | 5701/9741 [00:04<00:02, 1565.93it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▍                                                         | 5872/9741 [00:04<00:02, 1607.04it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▉                                                       | 6042/9741 [00:04<00:02, 1632.04it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▌                                                    | 6215/9741 [00:04<00:02, 1658.96it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████                                                  | 6387/9741 [00:04<00:02, 1674.99it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▌                                               | 6558/9741 [00:04<00:01, 1685.25it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▏                                            | 6731/9741 [00:05<00:01, 1695.66it/s] 71%|██████████████████████████████████████████████████████████████████████████████████████████████████████▊                                          | 6903/9741 [00:05<00:01, 1702.76it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                       | 7076/9741 [00:05<00:01, 1708.31it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                     | 7248/9741 [00:05<00:01, 1710.63it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                  | 7421/9741 [00:05<00:01, 1715.37it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                | 7593/9741 [00:05<00:01, 1666.69it/s] 80%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                             | 7765/9741 [00:05<00:01, 1679.58it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                           | 7934/9741 [00:05<00:01, 1664.98it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                        | 8106/9741 [00:05<00:00, 1680.44it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                     | 8276/9741 [00:05<00:00, 1685.09it/s] 87%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 8445/9741 [00:06<00:00, 1642.12it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                | 8615/9741 [00:06<00:00, 1657.32it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊              | 8786/9741 [00:06<00:00, 1672.63it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎           | 8956/9741 [00:06<00:00, 1680.57it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 9126/9741 [00:06<00:00, 1684.34it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎      | 9295/9741 [00:06<00:00, 1645.51it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉    | 9464/9741 [00:06<00:00, 1657.53it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍ | 9632/9741 [00:06<00:00, 1663.83it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:06<00:00, 1422.51it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.99s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.70s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.72s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.22s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.36s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.59s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:12<00:06,  6.36s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.07s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.64s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.93s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.12s/it]
[2023-08-11 04:22:04,873] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.51s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:18<00:00,  6.03s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:18<00:00,  6.06s/it]
[2023-08-11 04:22:23,022] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 04:22:23,023] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 04:22:23,023] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f68cc314e80>
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 04:22:23,024] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f68a7220910>
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 04:22:23,025] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 04:22:23,026] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 04:22:23,026] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 04:22:23,026] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 04:22:23,026] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 04:22:23,026] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 04:22:23,026] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 04:22:23,026] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 04:22:23,026] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 04:22:23,026] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 04:22:23,026] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 04:22:23,026] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 04:22:23,026] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 04:22:23,026] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.37806057929992676 seconds
Loading extension module utils...
Time to load utils op: 0.40439724922180176 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.404573917388916 seconds
Time to load utils op: 0.40442562103271484 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Rationales: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
#### 56
Answer: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Rationales: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
#### 4
Answer: 4

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s10-rTrue
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:53<43:30, 53.27s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:22<31:22, 39.22s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:14<35:08, 44.86s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:05<36:28, 47.58s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:53<35:48, 47.73s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:38<34:07, 46.53s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:30<34:35, 48.27s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:04<30:44, 43.91s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:57<31:50, 46.59s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:48<31:59, 47.99s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:37<31:23, 48.28s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:57<25:10, 39.75s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:49<26:54, 43.64s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:16<23:00, 38.35s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:00<23:29, 40.27s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:53<24:50, 43.85s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:27<22:36, 41.10s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:19<23:41, 44.43s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:12<24:12, 46.86s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:05<24:20, 48.69s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:58<24:07, 49.93s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:46<23:00, 49.30s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:37<22:32, 50.08s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:30<21:58, 50.70s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [19:21<21:13, 50.93s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [20:01<19:03, 47.63s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:53<18:45, 48.95s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:46<18:21, 50.05s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [22:38<17:47, 50.84s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [23:31<17:08, 51.41s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [23:45<12:46, 40.32s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [24:38<13:09, 43.87s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [25:30<13:10, 46.50s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:49<10:13, 38.32s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:41<10:34, 42.29s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [27:18<09:30, 40.78s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [28:02<09:02, 41.70s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [28:54<08:58, 44.88s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:27<07:31, 41.06s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [30:18<07:22, 44.25s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [31:00<06:31, 43.51s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:36<05:30, 41.28s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [32:29<05:12, 44.66s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [32:44<03:35, 35.88s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:36<03:23, 40.73s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:04<02:27, 36.81s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [34:32<01:42, 34.09s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [35:02<01:05, 32.88s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [35:54<00:38, 38.67s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [36:45<00:00, 42.50s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [36:45<00:00, 44.11s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 4.1104} | lm_loss 7.8035 | avg. gen lenth: 222.416
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s10-rTrue --seed 10 --rationales --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 05:01:33,878] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|█▎                                                                                                                                                  | 85/9741 [00:00<00:11, 846.33it/s]  2%|██▌                                                                                                                                                | 171/9741 [00:00<00:11, 854.33it/s]  3%|███▉                                                                                                                                               | 257/9741 [00:00<00:11, 850.73it/s]  4%|█████▏                                                                                                                                             | 344/9741 [00:00<00:10, 855.18it/s]  4%|██████▍                                                                                                                                            | 430/9741 [00:00<00:10, 853.55it/s]  5%|███████▊                                                                                                                                           | 516/9741 [00:00<00:10, 855.47it/s]  6%|█████████                                                                                                                                          | 603/9741 [00:00<00:10, 857.88it/s]  7%|██████████▍                                                                                                                                        | 689/9741 [00:00<00:10, 856.33it/s]  8%|███████████▋                                                                                                                                       | 775/9741 [00:00<00:10, 842.35it/s]  9%|████████████▉                                                                                                                                      | 861/9741 [00:01<00:10, 847.33it/s] 10%|██████████████▎                                                                                                                                    | 946/9741 [00:01<00:10, 847.91it/s] 11%|███████████████▍                                                                                                                                  | 1033/9741 [00:01<00:10, 851.75it/s] 11%|████████████████▊                                                                                                                                 | 1119/9741 [00:01<00:10, 853.05it/s] 12%|██████████████████                                                                                                                                | 1205/9741 [00:01<00:09, 854.07it/s] 13%|███████████████████▎                                                                                                                              | 1291/9741 [00:01<00:09, 854.62it/s] 14%|████████████████████▋                                                                                                                             | 1377/9741 [00:01<00:09, 854.56it/s] 15%|█████████████████████▉                                                                                                                            | 1463/9741 [00:01<00:09, 854.83it/s] 16%|███████████████████████▏                                                                                                                          | 1549/9741 [00:01<00:09, 854.51it/s] 17%|████████████████████████▌                                                                                                                         | 1635/9741 [00:01<00:09, 847.35it/s] 18%|█████████████████████████▊                                                                                                                        | 1721/9741 [00:02<00:09, 849.21it/s] 19%|███████████████████████████                                                                                                                       | 1806/9741 [00:02<00:09, 819.87it/s] 19%|████████████████████████████▎                                                                                                                     | 1892/9741 [00:02<00:09, 829.93it/s] 20%|█████████████████████████████▋                                                                                                                    | 1978/9741 [00:02<00:09, 837.52it/s] 21%|██████████████████████████████▉                                                                                                                   | 2063/9741 [00:02<00:09, 840.35it/s] 22%|████████████████████████████████▏                                                                                                                 | 2148/9741 [00:02<00:09, 840.91it/s] 23%|█████████████████████████████████▍                                                                                                                | 2235/9741 [00:02<00:08, 847.98it/s] 24%|██████████████████████████████████▊                                                                                                               | 2321/9741 [00:02<00:08, 848.65it/s] 25%|████████████████████████████████████                                                                                                              | 2408/9741 [00:02<00:08, 853.86it/s] 26%|█████████████████████████████████████▍                                                                                                            | 2494/9741 [00:02<00:08, 854.34it/s] 26%|██████████████████████████████████████▋                                                                                                           | 2581/9741 [00:03<00:08, 856.51it/s] 27%|███████████████████████████████████████▉                                                                                                          | 2667/9741 [00:03<00:08, 857.46it/s] 28%|█████████████████████████████████████████▎                                                                                                        | 2753/9741 [00:03<00:08, 846.54it/s] 29%|██████████████████████████████████████████▌                                                                                                       | 2839/9741 [00:03<00:08, 848.77it/s] 30%|███████████████████████████████████████████▊                                                                                                      | 2925/9741 [00:03<00:08, 850.17it/s] 31%|█████████████████████████████████████████████▏                                                                                                    | 3011/9741 [00:03<00:07, 852.86it/s] 32%|██████████████████████████████████████████████▍                                                                                                   | 3097/9741 [00:03<00:07, 853.33it/s] 33%|███████████████████████████████████████████████▋                                                                                                  | 3183/9741 [00:03<00:07, 852.82it/s] 34%|█████████████████████████████████████████████████                                                                                                 | 3270/9741 [00:03<00:07, 855.28it/s] 34%|██████████████████████████████████████████████████▎                                                                                               | 3356/9741 [00:03<00:07, 856.08it/s] 35%|███████████████████████████████████████████████████▌                                                                                              | 3442/9741 [00:04<00:07, 854.03it/s] 36%|█████████████████████████████████████████████████████▏                                                                                            | 3549/9741 [00:04<00:06, 917.90it/s] 38%|██████████████████████████████████████████████████████▊                                                                                          | 3679/9741 [00:04<00:05, 1030.19it/s] 39%|████████████████████████████████████████████████████████▋                                                                                        | 3810/9741 [00:04<00:05, 1113.70it/s] 40%|██████████████████████████████████████████████████████████▋                                                                                      | 3941/9741 [00:04<00:04, 1170.76it/s] 42%|████████████████████████████████████████████████████████████▌                                                                                    | 4066/9741 [00:04<00:04, 1193.40it/s] 43%|██████████████████████████████████████████████████████████████▍                                                                                  | 4197/9741 [00:04<00:04, 1227.25it/s] 44%|████████████████████████████████████████████████████████████████▍                                                                                | 4328/9741 [00:04<00:04, 1250.16it/s] 46%|██████████████████████████████████████████████████████████████████▎                                                                              | 4459/9741 [00:04<00:04, 1266.85it/s] 47%|████████████████████████████████████████████████████████████████████▎                                                                            | 4586/9741 [00:04<00:04, 1203.83it/s] 48%|██████████████████████████████████████████████████████████████████████▏                                                                          | 4718/9741 [00:05<00:04, 1236.02it/s] 50%|████████████████████████████████████████████████████████████████████████▌                                                                         | 4843/9741 [00:05<00:05, 937.60it/s] 51%|██████████████████████████████████████████████████████████████████████████                                                                       | 4973/9741 [00:05<00:04, 1024.00it/s] 52%|███████████████████████████████████████████████████████████████████████████▉                                                                     | 5105/9741 [00:05<00:04, 1097.94it/s] 54%|█████████████████████████████████████████████████████████████████████████████▉                                                                   | 5236/9741 [00:05<00:03, 1152.68it/s] 55%|███████████████████████████████████████████████████████████████████████████████▉                                                                 | 5367/9741 [00:05<00:03, 1195.85it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▊                                                               | 5498/9741 [00:05<00:03, 1227.85it/s] 58%|███████████████████████████████████████████████████████████████████████████████████▊                                                             | 5631/9741 [00:05<00:03, 1255.37it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▊                                                           | 5768/9741 [00:05<00:03, 1286.18it/s] 61%|███████████████████████████████████████████████████████████████████████████████████████▊                                                         | 5903/9741 [00:06<00:02, 1304.68it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▉                                                       | 6041/9741 [00:06<00:02, 1324.25it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▉                                                     | 6177/9741 [00:06<00:02, 1333.34it/s] 65%|█████████████████████████████████████████████████████████████████████████████████████████████▉                                                   | 6313/9741 [00:06<00:02, 1338.81it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████                                                 | 6450/9741 [00:06<00:02, 1347.17it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████                                               | 6586/9741 [00:06<00:02, 1346.13it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████                                             | 6723/9741 [00:06<00:02, 1351.93it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████                                           | 6859/9741 [00:06<00:02, 1353.95it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████                                         | 6995/9741 [00:06<00:02, 1351.33it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                      | 7131/9741 [00:06<00:01, 1353.21it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                    | 7267/9741 [00:07<00:01, 1351.95it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                  | 7404/9741 [00:07<00:01, 1355.06it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                | 7540/9741 [00:07<00:01, 1311.43it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                              | 7675/9741 [00:07<00:01, 1321.79it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                            | 7810/9741 [00:07<00:01, 1329.78it/s] 82%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                          | 7945/9741 [00:07<00:01, 1333.28it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                        | 8080/9741 [00:07<00:01, 1337.48it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                      | 8214/9741 [00:07<00:01, 1337.27it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                    | 8349/9741 [00:07<00:01, 1338.92it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                  | 8486/9741 [00:08<00:00, 1346.10it/s] 89%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                | 8621/9741 [00:08<00:00, 1344.56it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎              | 8758/9741 [00:08<00:00, 1349.73it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍            | 8893/9741 [00:08<00:00, 1349.79it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍          | 9029/9741 [00:08<00:00, 1350.54it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍        | 9165/9741 [00:08<00:00, 1348.30it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍      | 9300/9741 [00:08<00:00, 1347.76it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍    | 9436/9741 [00:08<00:00, 1349.60it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍  | 9571/9741 [00:08<00:00, 1348.25it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍| 9707/9741 [00:08<00:00, 1350.41it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:08<00:00, 1090.32it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.32s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.14s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.35s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.37s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.22s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.12s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.25s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.46s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.86s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.65s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.73s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.98s/it]
[2023-08-11 05:02:35,344] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-11 05:02:47,710] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 05:02:47,711] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 05:02:47,713] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 05:02:47,713] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 05:02:47,713] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 05:02:47,713] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f6cb93bfe80>
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 05:02:47,714] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f6cbf8e9910>
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 05:02:47,715] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 05:02:47,716] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 05:02:47,716] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 05:02:47,716] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 05:02:47,716] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4081687927246094 seconds
Loading extension module utils...
Time to load utils op: 0.30413389205932617 seconds
Loading extension module utils...
Time to load utils op: 0.2048661708831787 seconds
Loading extension module utils...
Time to load utils op: 0.30425572395324707 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Rationales: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
#### 56
Answer: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Rationales: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
#### 4
Answer: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Rationales: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
#### 480
Answer: 480

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s10-rTrue
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:50<41:36, 50.96s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:39<39:28, 49.34s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:28<38:43, 49.44s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:17<37:33, 48.98s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:49<32:19, 43.10s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:39<33:14, 45.33s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:28<33:24, 46.62s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:18<33:24, 47.72s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:09<33:15, 48.67s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:36<28:05, 42.14s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:16<26:49, 41.27s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:41<22:57, 36.24s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:30<24:47, 40.20s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:19<25:47, 42.98s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:08<26:07, 44.78s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:57<26:07, 46.09s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:47<25:53, 47.06s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:35<25:20, 47.52s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:24<24:44, 47.89s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [15:13<24:08, 48.29s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [16:02<23:27, 48.55s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:52<22:46, 48.80s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:42<22:10, 49.28s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:06<18:05, 41.75s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:56<18:26, 44.27s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:45<18:14, 45.62s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:34<17:49, 46.49s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:11<16:00, 43.68s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [22:00<15:52, 45.34s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:41<14:41, 44.09s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [23:31<14:27, 45.65s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [24:19<13:57, 46.50s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [25:08<13:25, 47.37s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:57<12:45, 47.82s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:46<12:02, 48.16s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [27:27<10:40, 45.79s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [28:08<09:40, 44.63s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [28:58<09:13, 46.11s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:48<08:40, 47.29s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [30:18<06:59, 41.94s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [31:07<06:36, 44.09s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:57<06:07, 45.98s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [32:47<05:30, 47.15s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [33:35<04:44, 47.48s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [34:24<03:59, 47.91s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:40<02:32, 38.21s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [35:30<02:05, 41.77s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [36:04<01:18, 39.39s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [36:44<00:39, 39.61s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:29<00:00, 41.24s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:29<00:00, 44.98s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.3083} | lm_loss 7.8441 | avg. gen lenth: 272.596
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s10-rTrue --seed 10 --rationales --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 05:42:37,747] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|▉                                                                                                                                                   | 62/9741 [00:00<00:15, 614.04it/s]  1%|█▊                                                                                                                                                 | 124/9741 [00:00<00:15, 616.29it/s]  2%|██▊                                                                                                                                                | 186/9741 [00:00<00:15, 616.53it/s]  3%|███▋                                                                                                                                               | 248/9741 [00:00<00:15, 614.36it/s]  3%|████▋                                                                                                                                              | 310/9741 [00:00<00:15, 615.36it/s]  4%|█████▌                                                                                                                                             | 372/9741 [00:00<00:15, 615.41it/s]  4%|██████▌                                                                                                                                            | 434/9741 [00:00<00:15, 614.29it/s]  5%|███████▍                                                                                                                                           | 496/9741 [00:00<00:15, 603.86it/s]  6%|████████▍                                                                                                                                          | 558/9741 [00:00<00:15, 606.77it/s]  6%|█████████▎                                                                                                                                         | 620/9741 [00:01<00:14, 608.57it/s]  7%|██████████▎                                                                                                                                        | 681/9741 [00:01<00:14, 608.88it/s]  8%|███████████▏                                                                                                                                       | 743/9741 [00:01<00:14, 610.07it/s]  8%|████████████▏                                                                                                                                      | 805/9741 [00:01<00:14, 610.99it/s]  9%|█████████████                                                                                                                                      | 867/9741 [00:01<00:14, 611.69it/s] 10%|██████████████                                                                                                                                     | 929/9741 [00:01<00:14, 610.06it/s] 10%|██████████████▉                                                                                                                                    | 991/9741 [00:01<00:14, 611.02it/s] 11%|███████████████▊                                                                                                                                  | 1053/9741 [00:01<00:14, 611.59it/s] 11%|████████████████▋                                                                                                                                 | 1115/9741 [00:01<00:14, 606.97it/s] 12%|█████████████████▋                                                                                                                                | 1176/9741 [00:01<00:14, 607.48it/s] 13%|██████████████████▌                                                                                                                               | 1237/9741 [00:02<00:14, 607.35it/s] 13%|███████████████████▍                                                                                                                              | 1299/9741 [00:02<00:13, 608.33it/s] 14%|████████████████████▍                                                                                                                             | 1365/9741 [00:02<00:13, 623.38it/s] 15%|█████████████████████▊                                                                                                                            | 1458/9741 [00:02<00:11, 713.85it/s] 16%|███████████████████████▏                                                                                                                          | 1551/9741 [00:02<00:10, 777.71it/s] 17%|████████████████████████▋                                                                                                                         | 1643/9741 [00:02<00:09, 819.91it/s] 18%|██████████████████████████                                                                                                                        | 1736/9741 [00:02<00:09, 852.34it/s] 19%|███████████████████████████▎                                                                                                                      | 1822/9741 [00:02<00:09, 841.95it/s] 20%|████████████████████████████▋                                                                                                                     | 1915/9741 [00:02<00:09, 867.11it/s] 21%|██████████████████████████████                                                                                                                    | 2008/9741 [00:02<00:08, 884.83it/s] 22%|███████████████████████████████▍                                                                                                                  | 2100/9741 [00:03<00:08, 892.78it/s] 22%|████████████████████████████████▊                                                                                                                 | 2191/9741 [00:03<00:08, 896.16it/s] 23%|██████████████████████████████████▏                                                                                                               | 2283/9741 [00:03<00:08, 901.90it/s] 24%|███████████████████████████████████▌                                                                                                              | 2376/9741 [00:03<00:08, 909.00it/s] 25%|█████████████████████████████████████                                                                                                             | 2469/9741 [00:03<00:07, 914.17it/s] 26%|██████████████████████████████████████▍                                                                                                           | 2561/9741 [00:03<00:07, 913.68it/s] 27%|███████████████████████████████████████▊                                                                                                          | 2654/9741 [00:03<00:07, 917.27it/s] 28%|█████████████████████████████████████████▏                                                                                                        | 2746/9741 [00:03<00:07, 915.80it/s] 29%|██████████████████████████████████████████▌                                                                                                       | 2839/9741 [00:03<00:07, 917.59it/s] 30%|███████████████████████████████████████████▉                                                                                                      | 2931/9741 [00:03<00:07, 917.20it/s] 31%|█████████████████████████████████████████████▎                                                                                                    | 3024/9741 [00:04<00:07, 918.32it/s] 32%|██████████████████████████████████████████████▋                                                                                                   | 3116/9741 [00:04<00:07, 918.67it/s] 33%|████████████████████████████████████████████████                                                                                                  | 3208/9741 [00:04<00:07, 918.13it/s] 34%|█████████████████████████████████████████████████▍                                                                                                | 3301/9741 [00:04<00:06, 920.28it/s] 35%|██████████████████████████████████████████████████▊                                                                                               | 3394/9741 [00:04<00:06, 907.49it/s] 36%|████████████████████████████████████████████████████▎                                                                                             | 3488/9741 [00:04<00:06, 914.67it/s] 37%|█████████████████████████████████████████████████████▋                                                                                            | 3581/9741 [00:04<00:06, 918.61it/s] 38%|███████████████████████████████████████████████████████                                                                                           | 3674/9741 [00:04<00:06, 920.60it/s] 39%|████████████████████████████████████████████████████████▍                                                                                         | 3768/9741 [00:04<00:06, 925.10it/s] 40%|█████████████████████████████████████████████████████████▊                                                                                        | 3861/9741 [00:04<00:06, 925.44it/s] 41%|███████████████████████████████████████████████████████████▎                                                                                      | 3955/9741 [00:05<00:06, 928.17it/s] 42%|████████████████████████████████████████████████████████████▋                                                                                     | 4049/9741 [00:05<00:06, 929.79it/s] 43%|██████████████████████████████████████████████████████████████                                                                                    | 4142/9741 [00:05<00:06, 927.13it/s] 43%|███████████████████████████████████████████████████████████████▍                                                                                  | 4235/9741 [00:05<00:05, 927.39it/s] 44%|████████████████████████████████████████████████████████████████▊                                                                                 | 4328/9741 [00:05<00:05, 924.26it/s] 45%|██████████████████████████████████████████████████████████████████▎                                                                               | 4421/9741 [00:05<00:05, 924.39it/s] 46%|███████████████████████████████████████████████████████████████████▋                                                                              | 4514/9741 [00:05<00:06, 862.29it/s] 47%|█████████████████████████████████████████████████████████████████████                                                                             | 4606/9741 [00:05<00:05, 876.45it/s] 48%|██████████████████████████████████████████████████████████████████████▍                                                                           | 4699/9741 [00:05<00:05, 890.46it/s] 49%|███████████████████████████████████████████████████████████████████████▊                                                                          | 4789/9741 [00:06<00:07, 658.46it/s] 50%|█████████████████████████████████████████████████████████████████████████▏                                                                        | 4881/9741 [00:06<00:06, 719.76it/s] 51%|██████████████████████████████████████████████████████████████████████████▌                                                                       | 4973/9741 [00:06<00:06, 769.20it/s] 52%|███████████████████████████████████████████████████████████████████████████▉                                                                      | 5066/9741 [00:06<00:05, 810.71it/s] 53%|█████████████████████████████████████████████████████████████████████████████▎                                                                    | 5159/9741 [00:06<00:05, 842.75it/s] 54%|██████████████████████████████████████████████████████████████████████████████▋                                                                   | 5251/9741 [00:06<00:05, 863.04it/s] 55%|████████████████████████████████████████████████████████████████████████████████                                                                  | 5344/9741 [00:06<00:04, 879.99it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▍                                                                | 5436/9741 [00:06<00:04, 890.52it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▉                                                               | 5532/9741 [00:06<00:04, 908.81it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▎                                                             | 5629/9741 [00:07<00:04, 925.29it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▊                                                            | 5727/9741 [00:07<00:04, 940.65it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▎                                                          | 5825/9741 [00:07<00:04, 951.63it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▊                                                         | 5922/9741 [00:07<00:03, 955.84it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▏                                                       | 6018/9741 [00:07<00:03, 956.97it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▋                                                      | 6115/9741 [00:07<00:03, 959.83it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████                                                     | 6213/9741 [00:07<00:03, 964.32it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▌                                                   | 6310/9741 [00:07<00:03, 963.40it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████                                                  | 6407/9741 [00:07<00:03, 964.86it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▍                                                | 6505/9741 [00:07<00:03, 967.57it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                                               | 6602/9741 [00:08<00:03, 965.57it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▍                                             | 6700/9741 [00:08<00:03, 968.00it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▊                                            | 6797/9741 [00:08<00:03, 967.48it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▎                                          | 6895/9741 [00:08<00:02, 969.89it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                         | 6992/9741 [00:08<00:02, 968.21it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                       | 7090/9741 [00:08<00:02, 970.08it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                      | 7188/9741 [00:08<00:02, 971.82it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                    | 7286/9741 [00:08<00:02, 968.66it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                   | 7384/9741 [00:08<00:02, 970.55it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 7482/9741 [00:08<00:02, 927.86it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                | 7579/9741 [00:09<00:02, 939.13it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████                               | 7674/9741 [00:09<00:02, 939.91it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                             | 7772/9741 [00:09<00:02, 949.60it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                            | 7869/9741 [00:09<00:01, 954.21it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                          | 7965/9741 [00:09<00:01, 955.57it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                         | 8062/9741 [00:09<00:01, 957.95it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                       | 8158/9741 [00:09<00:01, 958.41it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 8255/9741 [00:09<00:01, 960.35it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                    | 8352/9741 [00:09<00:01, 958.03it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 8449/9741 [00:09<00:01, 960.43it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                  | 8546/9741 [00:10<00:01, 961.00it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                | 8643/9741 [00:10<00:01, 958.05it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉               | 8740/9741 [00:10<00:01, 959.09it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍             | 8836/9741 [00:10<00:00, 956.19it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉            | 8933/9741 [00:10<00:00, 958.07it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎          | 9029/9741 [00:10<00:00, 955.81it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 9126/9741 [00:10<00:00, 957.52it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏       | 9223/9741 [00:10<00:00, 958.54it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋      | 9319/9741 [00:10<00:00, 957.08it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏    | 9416/9741 [00:10<00:00, 958.65it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌   | 9512/9741 [00:11<00:00, 955.98it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████  | 9609/9741 [00:11<00:00, 957.89it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍| 9705/9741 [00:11<00:00, 958.02it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:11<00:00, 862.57it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.01s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.06s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.47s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.53s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.92s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.94s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.38s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.36s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.30s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.48s/it]
[2023-08-11 05:43:39,728] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.42s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.58s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.92s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.91s/it]
[2023-08-11 05:43:49,331] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 05:43:49,332] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 05:43:49,332] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 05:43:49,332] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 05:43:49,332] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 05:43:49,332] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fd228cece80>
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fd2289fbaf0>
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 05:43:49,333] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 05:43:49,334] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 05:43:49,334] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3875868320465088 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Rationales: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
#### 56
Answer: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Rationales: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
#### 4
Answer: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Rationales: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
#### 480
Answer: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Rationales: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
#### 30
Answer: 30

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s10-rTrue
Loading extension module utils...
Time to load utils op: 0.30437541007995605 seconds
Loading extension module utils...
Time to load utils op: 0.3042025566101074 seconds
Loading extension module utils...
Time to load utils op: 0.30432915687561035 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:46<38:17, 46.89s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:33<37:09, 46.45s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:20<36:42, 46.85s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:49<30:24, 39.66s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:36<31:43, 42.31s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:23<32:18, 44.05s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:09<32:08, 44.84s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:47<29:40, 42.38s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:34<30:05, 44.05s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:21<29:51, 44.79s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:07<29:28, 45.35s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:55<29:07, 46.00s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:35<27:13, 44.14s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:20<26:46, 44.64s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:07<26:20, 45.15s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:45<24:24, 43.08s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:32<24:19, 44.22s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:19<24:01, 45.04s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:06<23:36, 45.71s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:52<22:55, 45.85s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:39<22:19, 46.19s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:26<21:40, 46.45s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:14<21:00, 46.69s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:00<20:11, 46.60s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:47<19:25, 46.64s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:34<18:43, 46.80s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:21<17:58, 46.87s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [20:55<15:49, 43.14s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [21:42<15:26, 44.13s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:25<14:35, 43.75s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [23:08<13:50, 43.71s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [23:56<13:26, 44.82s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [24:42<12:51, 45.37s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [25:30<12:15, 45.97s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [26:17<11:35, 46.39s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [27:04<10:50, 46.49s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [27:51<10:05, 46.57s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [28:19<08:12, 41.03s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:06<07:50, 42.80s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [29:52<07:17, 43.78s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [30:39<06:42, 44.70s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:24<06:00, 45.01s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [32:10<05:17, 45.30s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [32:57<04:35, 45.87s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:20<03:14, 39.00s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:07<02:45, 41.38s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [34:54<02:08, 42.88s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [35:20<01:15, 37.89s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [36:07<00:40, 40.68s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [36:46<00:00, 40.25s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [36:46<00:00, 44.14s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.0218} | lm_loss 7.9099 | avg. gen lenth: 284.116
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s10-rTrue --seed 10 --rationales --num-out-domain 5
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date![nltk_data]   Package punkt is already up-to-date!

[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 06:22:21,630] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 5
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  0%|▋                                                                                                                                                   | 43/9741 [00:00<00:22, 429.09it/s]  1%|█▍                                                                                                                                                  | 97/9741 [00:00<00:19, 489.94it/s]  2%|██▎                                                                                                                                                | 151/9741 [00:00<00:18, 510.13it/s]  2%|███                                                                                                                                                | 204/9741 [00:00<00:18, 515.45it/s]  3%|███▉                                                                                                                                               | 258/9741 [00:00<00:18, 521.15it/s]  3%|████▋                                                                                                                                              | 312/9741 [00:00<00:18, 514.76it/s]  4%|█████▌                                                                                                                                             | 365/9741 [00:00<00:18, 516.63it/s]  4%|██████▎                                                                                                                                            | 419/9741 [00:00<00:17, 521.15it/s]  5%|███████                                                                                                                                            | 472/9741 [00:00<00:17, 520.60it/s]  5%|███████▉                                                                                                                                           | 526/9741 [00:01<00:17, 523.82it/s]  6%|████████▊                                                                                                                                          | 580/9741 [00:01<00:17, 526.74it/s]  7%|█████████▌                                                                                                                                         | 634/9741 [00:01<00:17, 528.09it/s]  7%|██████████▎                                                                                                                                        | 687/9741 [00:01<00:17, 527.66it/s]  8%|███████████▏                                                                                                                                       | 740/9741 [00:01<00:17, 528.22it/s]  8%|███████████▉                                                                                                                                       | 794/9741 [00:01<00:16, 529.35it/s]  9%|████████████▊                                                                                                                                      | 847/9741 [00:01<00:16, 527.01it/s]  9%|█████████████▌                                                                                                                                     | 900/9741 [00:01<00:16, 524.24it/s] 10%|██████████████▍                                                                                                                                    | 953/9741 [00:01<00:16, 525.56it/s] 10%|███████████████                                                                                                                                   | 1006/9741 [00:01<00:16, 525.88it/s] 11%|███████████████▊                                                                                                                                  | 1059/9741 [00:02<00:16, 526.55it/s] 11%|████████████████▋                                                                                                                                 | 1112/9741 [00:02<00:16, 524.69it/s] 12%|█████████████████▍                                                                                                                                | 1165/9741 [00:02<00:16, 525.36it/s] 13%|██████████████████▎                                                                                                                               | 1218/9741 [00:02<00:16, 526.11it/s] 13%|███████████████████▎                                                                                                                              | 1290/9741 [00:02<00:14, 582.53it/s] 14%|████████████████████▌                                                                                                                             | 1370/9741 [00:02<00:12, 646.93it/s] 15%|█████████████████████▋                                                                                                                            | 1451/9741 [00:02<00:11, 694.77it/s] 16%|██████████████████████▉                                                                                                                           | 1532/9741 [00:02<00:11, 728.06it/s] 17%|████████████████████████▏                                                                                                                         | 1611/9741 [00:02<00:10, 744.98it/s] 17%|█████████████████████████▎                                                                                                                        | 1691/9741 [00:02<00:10, 759.29it/s] 18%|██████████████████████████▌                                                                                                                       | 1772/9741 [00:03<00:10, 772.69it/s] 19%|███████████████████████████▋                                                                                                                      | 1850/9741 [00:03<00:10, 748.30it/s] 20%|████████████████████████████▉                                                                                                                     | 1931/9741 [00:03<00:10, 765.13it/s] 21%|██████████████████████████████▏                                                                                                                   | 2012/9741 [00:03<00:09, 777.90it/s] 21%|███████████████████████████████▎                                                                                                                  | 2092/9741 [00:03<00:09, 782.31it/s] 22%|████████████████████████████████▌                                                                                                                 | 2173/9741 [00:03<00:09, 789.36it/s] 23%|█████████████████████████████████▊                                                                                                                | 2254/9741 [00:03<00:09, 792.74it/s] 24%|██████████████████████████████████▉                                                                                                               | 2335/9741 [00:03<00:09, 796.38it/s] 25%|████████████████████████████████████▏                                                                                                             | 2417/9741 [00:03<00:09, 800.64it/s] 26%|█████████████████████████████████████▍                                                                                                            | 2498/9741 [00:03<00:09, 799.12it/s] 26%|██████████████████████████████████████▋                                                                                                           | 2579/9741 [00:04<00:08, 801.90it/s] 27%|███████████████████████████████████████▉                                                                                                          | 2661/9741 [00:04<00:08, 804.30it/s] 28%|█████████████████████████████████████████                                                                                                         | 2742/9741 [00:04<00:08, 795.00it/s] 29%|██████████████████████████████████████████▎                                                                                                       | 2823/9741 [00:04<00:08, 797.92it/s] 30%|███████████████████████████████████████████▌                                                                                                      | 2904/9741 [00:04<00:08, 800.43it/s] 31%|████████████████████████████████████████████▋                                                                                                     | 2985/9741 [00:04<00:08, 799.41it/s] 31%|█████████████████████████████████████████████▉                                                                                                    | 3066/9741 [00:04<00:08, 802.23it/s] 32%|███████████████████████████████████████████████▏                                                                                                  | 3147/9741 [00:04<00:08, 804.32it/s] 33%|████████████████████████████████████████████████▍                                                                                                 | 3228/9741 [00:04<00:08, 802.69it/s] 34%|█████████████████████████████████████████████████▌                                                                                                | 3310/9741 [00:04<00:07, 805.03it/s] 35%|██████████████████████████████████████████████████▊                                                                                               | 3391/9741 [00:05<00:07, 802.80it/s] 36%|████████████████████████████████████████████████████                                                                                              | 3472/9741 [00:05<00:07, 804.63it/s] 36%|█████████████████████████████████████████████████████▎                                                                                            | 3553/9741 [00:05<00:07, 804.82it/s] 37%|██████████████████████████████████████████████████████▍                                                                                           | 3634/9741 [00:05<00:07, 802.14it/s] 38%|███████████████████████████████████████████████████████▋                                                                                          | 3715/9741 [00:05<00:07, 803.89it/s] 39%|████████████████████████████████████████████████████████▉                                                                                         | 3796/9741 [00:05<00:07, 801.63it/s] 40%|██████████████████████████████████████████████████████████                                                                                        | 3877/9741 [00:05<00:07, 800.37it/s] 41%|███████████████████████████████████████████████████████████▎                                                                                      | 3958/9741 [00:05<00:07, 801.70it/s] 41%|████████████████████████████████████████████████████████████▌                                                                                     | 4039/9741 [00:05<00:07, 801.71it/s] 42%|█████████████████████████████████████████████████████████████▊                                                                                    | 4120/9741 [00:05<00:07, 800.71it/s] 43%|██████████████████████████████████████████████████████████████▉                                                                                   | 4201/9741 [00:06<00:06, 802.26it/s] 44%|████████████████████████████████████████████████████████████████▏                                                                                 | 4283/9741 [00:06<00:06, 804.94it/s] 45%|█████████████████████████████████████████████████████████████████▍                                                                                | 4364/9741 [00:06<00:06, 803.69it/s] 46%|██████████████████████████████████████████████████████████████████▌                                                                               | 4445/9741 [00:06<00:06, 805.08it/s] 46%|███████████████████████████████████████████████████████████████████▊                                                                              | 4526/9741 [00:06<00:06, 751.75it/s] 47%|█████████████████████████████████████████████████████████████████████                                                                             | 4608/9741 [00:06<00:06, 768.72it/s] 48%|██████████████████████████████████████████████████████████████████████▎                                                                           | 4689/9741 [00:06<00:06, 780.31it/s] 49%|███████████████████████████████████████████████████████████████████████▍                                                                          | 4768/9741 [00:06<00:08, 564.73it/s] 50%|████████████████████████████████████████████████████████████████████████▋                                                                         | 4849/9741 [00:07<00:07, 621.19it/s] 51%|█████████████████████████████████████████████████████████████████████████▉                                                                        | 4930/9741 [00:07<00:07, 666.97it/s] 51%|███████████████████████████████████████████████████████████████████████████                                                                       | 5009/9741 [00:07<00:06, 697.77it/s] 52%|████████████████████████████████████████████████████████████████████████████▎                                                                     | 5090/9741 [00:07<00:06, 727.32it/s] 53%|█████████████████████████████████████████████████████████████████████████████▌                                                                    | 5171/9741 [00:07<00:06, 747.63it/s] 54%|██████████████████████████████████████████████████████████████████████████████▋                                                                   | 5252/9741 [00:07<00:05, 764.94it/s] 55%|███████████████████████████████████████████████████████████████████████████████▉                                                                  | 5333/9741 [00:07<00:05, 777.19it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▏                                                                | 5413/9741 [00:07<00:05, 783.42it/s] 56%|██████████████████████████████████████████████████████████████████████████████████▎                                                               | 5495/9741 [00:07<00:05, 794.00it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▌                                                              | 5579/9741 [00:07<00:05, 807.51it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▊                                                             | 5662/9741 [00:08<00:05, 813.07it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▏                                                           | 5747/9741 [00:08<00:04, 822.47it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▍                                                          | 5832/9741 [00:08<00:04, 828.90it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▋                                                         | 5916/9741 [00:08<00:04, 830.41it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▉                                                        | 6001/9741 [00:08<00:04, 833.40it/s] 62%|███████████████████████████████████████████████████████████████████████████████████████████▏                                                      | 6085/9741 [00:08<00:04, 834.10it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▍                                                     | 6170/9741 [00:08<00:04, 837.25it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▊                                                    | 6255/9741 [00:08<00:04, 838.44it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████                                                   | 6339/9741 [00:08<00:04, 836.90it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▎                                                 | 6423/9741 [00:08<00:03, 835.70it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▌                                                | 6507/9741 [00:09<00:03, 836.75it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▊                                               | 6591/9741 [00:09<00:03, 831.09it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████                                              | 6676/9741 [00:09<00:03, 834.92it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████▎                                            | 6760/9741 [00:09<00:03, 834.88it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▌                                           | 6845/9741 [00:09<00:03, 837.08it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▊                                          | 6930/9741 [00:09<00:03, 838.68it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                        | 7014/9741 [00:09<00:03, 835.58it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                       | 7099/9741 [00:09<00:03, 837.50it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                      | 7184/9741 [00:09<00:03, 838.73it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                     | 7268/9741 [00:09<00:02, 836.29it/s] 75%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                   | 7352/9741 [00:10<00:02, 837.16it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                  | 7436/9741 [00:10<00:02, 837.49it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 7520/9741 [00:10<00:02, 796.32it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                | 7604/9741 [00:10<00:02, 808.50it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                              | 7687/9741 [00:10<00:02, 813.06it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                             | 7772/9741 [00:10<00:02, 821.42it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                            | 7856/9741 [00:10<00:02, 826.82it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                           | 7940/9741 [00:10<00:02, 827.95it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                         | 8025/9741 [00:10<00:02, 831.55it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                        | 8110/9741 [00:10<00:01, 834.14it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                       | 8194/9741 [00:11<00:01, 833.01it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                      | 8278/9741 [00:11<00:01, 834.80it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                    | 8362/9741 [00:11<00:01, 832.56it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                   | 8446/9741 [00:11<00:01, 834.39it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 8530/9741 [00:11<00:01, 834.54it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                 | 8614/9741 [00:11<00:01, 831.33it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎               | 8698/9741 [00:11<00:01, 832.91it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋              | 8782/9741 [00:11<00:01, 834.54it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉             | 8866/9741 [00:11<00:01, 832.24it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏           | 8950/9741 [00:11<00:00, 834.15it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍          | 9034/9741 [00:12<00:00, 831.96it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋         | 9118/9741 [00:12<00:00, 833.13it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉        | 9202/9741 [00:12<00:00, 834.92it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏      | 9286/9741 [00:12<00:00, 824.88it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍     | 9370/9741 [00:12<00:00, 827.70it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋    | 9454/9741 [00:12<00:00, 829.95it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉   | 9538/9741 [00:12<00:00, 827.06it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏ | 9621/9741 [00:12<00:00, 826.91it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍| 9704/9741 [00:12<00:00, 826.16it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:12<00:00, 752.11it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.34s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.28s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.26s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.21s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.30s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
[2023-08-11 06:23:26,671] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.66s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.83s/it]
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.97s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.04s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.35s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.53s/it]
[2023-08-11 06:23:49,279] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 06:23:49,280] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 06:23:49,281] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 06:23:49,281] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 06:23:49,281] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 06:23:49,281] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 06:23:49,281] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 06:23:49,281] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 06:23:49,281] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 06:23:49,281] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 06:23:49,281] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 06:23:49,281] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f9881174e80>
[2023-08-11 06:23:49,281] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f988adb8910>
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 06:23:49,282] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 06:23:49,283] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 06:23:49,283] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.42106032371520996 seconds
Loading extension module utils...
Time to load utils op: 0.3043076992034912 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Time to load utils op: 0.4046661853790283 seconds
Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Rationales: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
#### 56
Answer: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Rationales: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
#### 4
Answer: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Rationales: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
#### 480
Answer: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Rationales: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
#### 30
Answer: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Rationales: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
#### 868
Answer: 868

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s10-rTrue
Time to load utils op: 0.30448317527770996 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:46<37:46, 46.25s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:30<36:09, 45.19s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:16<35:31, 45.36s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:01<34:42, 45.28s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:46<33:58, 45.30s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:24<31:19, 42.72s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:03<29:44, 41.50s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:48<29:47, 42.57s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:34<29:50, 43.68s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:20<29:36, 44.42s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:06<29:06, 44.79s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:50<28:22, 44.80s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:36<27:51, 45.17s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:19<26:37, 44.39s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:04<25:57, 44.49s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:48<25:12, 44.50s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [12:33<24:31, 44.60s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:19<23:59, 45.00s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:04<23:13, 44.95s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:49<22:31, 45.06s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:07<17:45, 36.75s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [15:51<18:15, 39.13s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [16:36<18:19, 40.72s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [17:21<18:12, 42.03s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [18:06<17:56, 43.08s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [18:36<15:37, 39.06s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [19:21<15:36, 40.71s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [20:06<15:26, 42.13s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:51<15:03, 43.01s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:37<14:37, 43.85s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [22:23<14:03, 44.41s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [23:08<13:24, 44.70s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:36<11:12, 39.57s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [24:06<09:49, 36.87s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:51<09:49, 39.30s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [25:37<09:38, 41.34s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [26:13<08:36, 39.72s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:53<07:55, 39.63s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [27:38<07:36, 41.47s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [28:24<07:08, 42.83s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [29:09<06:31, 43.51s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [29:55<05:53, 44.18s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [30:41<05:11, 44.54s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [31:26<04:28, 44.76s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [32:11<03:45, 45.03s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [32:57<03:00, 45.12s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [33:42<02:15, 45.06s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [34:18<01:25, 42.50s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [34:54<00:40, 40.36s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:40<00:00, 42.03s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:40<00:00, 42.80s/it]
name: commonsenseqa | {'exact_match': 0.8, 'rougeL': 4.4471} | lm_loss 7.839 | avg. gen lenth: 262.392
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s10-rTrue --seed 10 --rationales --num-out-domain 6
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 07:00:40,346] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o6-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 6
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o6-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  0%|▌                                                                                                                                                   | 35/9741 [00:00<00:28, 342.97it/s]  1%|█                                                                                                                                                   | 70/9741 [00:00<00:27, 345.41it/s]  1%|█▌                                                                                                                                                 | 105/9741 [00:00<00:27, 346.42it/s]  1%|██                                                                                                                                                 | 140/9741 [00:00<00:27, 347.46it/s]  2%|██▋                                                                                                                                                | 175/9741 [00:00<00:27, 346.96it/s]  2%|███▏                                                                                                                                               | 210/9741 [00:00<00:27, 344.23it/s]  3%|███▋                                                                                                                                               | 245/9741 [00:00<00:27, 344.93it/s]  3%|████▏                                                                                                                                              | 280/9741 [00:00<00:27, 339.47it/s]  3%|████▊                                                                                                                                              | 315/9741 [00:00<00:27, 341.38it/s]  4%|█████▎                                                                                                                                             | 350/9741 [00:01<00:27, 342.51it/s]  4%|█████▊                                                                                                                                             | 385/9741 [00:01<00:27, 343.92it/s]  4%|██████▎                                                                                                                                            | 420/9741 [00:01<00:27, 344.67it/s]  5%|██████▊                                                                                                                                            | 455/9741 [00:01<00:27, 342.62it/s]  5%|███████▍                                                                                                                                           | 490/9741 [00:01<00:26, 343.80it/s]  5%|███████▉                                                                                                                                           | 525/9741 [00:01<00:26, 344.59it/s]  6%|████████▍                                                                                                                                          | 560/9741 [00:01<00:26, 345.21it/s]  6%|█████████                                                                                                                                          | 600/9741 [00:01<00:25, 361.14it/s]  7%|█████████▊                                                                                                                                         | 653/9741 [00:01<00:22, 409.66it/s]  7%|██████████▋                                                                                                                                        | 705/9741 [00:01<00:20, 441.27it/s]  8%|███████████▍                                                                                                                                       | 758/9741 [00:02<00:19, 465.35it/s]  8%|████████████▏                                                                                                                                      | 811/9741 [00:02<00:18, 483.17it/s]  9%|█████████████                                                                                                                                      | 864/9741 [00:02<00:17, 495.85it/s]  9%|█████████████▊                                                                                                                                     | 916/9741 [00:02<00:17, 501.08it/s] 10%|██████████████▌                                                                                                                                    | 969/9741 [00:02<00:17, 507.37it/s] 10%|███████████████▎                                                                                                                                  | 1022/9741 [00:02<00:17, 512.23it/s] 11%|████████████████                                                                                                                                  | 1075/9741 [00:02<00:16, 515.96it/s] 12%|████████████████▉                                                                                                                                 | 1127/9741 [00:02<00:16, 515.31it/s] 12%|█████████████████▋                                                                                                                                | 1180/9741 [00:02<00:16, 517.41it/s] 13%|██████████████████▍                                                                                                                               | 1233/9741 [00:02<00:16, 518.72it/s] 13%|███████████████████▎                                                                                                                              | 1285/9741 [00:03<00:16, 516.86it/s] 14%|████████████████████                                                                                                                              | 1337/9741 [00:03<00:16, 515.23it/s] 14%|████████████████████▊                                                                                                                             | 1390/9741 [00:03<00:16, 517.53it/s] 15%|█████████████████████▋                                                                                                                            | 1443/9741 [00:03<00:16, 518.55it/s] 15%|██████████████████████▍                                                                                                                           | 1496/9741 [00:03<00:15, 519.52it/s] 16%|███████████████████████▏                                                                                                                          | 1549/9741 [00:03<00:15, 520.40it/s] 16%|████████████████████████                                                                                                                          | 1602/9741 [00:03<00:15, 517.75it/s] 17%|████████████████████████▊                                                                                                                         | 1655/9741 [00:03<00:15, 520.11it/s] 18%|█████████████████████████▌                                                                                                                        | 1708/9741 [00:03<00:15, 520.51it/s] 18%|██████████████████████████▍                                                                                                                       | 1761/9741 [00:03<00:15, 521.31it/s] 19%|███████████████████████████▏                                                                                                                      | 1814/9741 [00:04<00:16, 492.87it/s] 19%|███████████████████████████▉                                                                                                                      | 1867/9741 [00:04<00:15, 501.00it/s] 20%|████████████████████████████▊                                                                                                                     | 1920/9741 [00:04<00:15, 506.95it/s] 20%|█████████████████████████████▌                                                                                                                    | 1971/9741 [00:04<00:15, 505.96it/s] 21%|██████████████████████████████▎                                                                                                                   | 2022/9741 [00:04<00:15, 505.66it/s] 21%|███████████████████████████████                                                                                                                   | 2075/9741 [00:04<00:15, 510.39it/s] 22%|███████████████████████████████▉                                                                                                                  | 2127/9741 [00:04<00:14, 513.10it/s] 22%|████████████████████████████████▋                                                                                                                 | 2180/9741 [00:04<00:14, 515.45it/s] 23%|█████████████████████████████████▍                                                                                                                | 2232/9741 [00:04<00:14, 516.00it/s] 23%|██████████████████████████████████▏                                                                                                               | 2284/9741 [00:04<00:14, 514.80it/s] 24%|███████████████████████████████████                                                                                                               | 2337/9741 [00:05<00:14, 516.96it/s] 25%|███████████████████████████████████▊                                                                                                              | 2390/9741 [00:05<00:14, 519.01it/s] 25%|████████████████████████████████████▌                                                                                                             | 2443/9741 [00:05<00:14, 520.15it/s] 26%|█████████████████████████████████████▍                                                                                                            | 2496/9741 [00:05<00:14, 517.19it/s] 26%|██████████████████████████████████████▏                                                                                                           | 2548/9741 [00:05<00:13, 517.76it/s] 27%|██████████████████████████████████████▉                                                                                                           | 2601/9741 [00:05<00:13, 519.34it/s] 27%|███████████████████████████████████████▊                                                                                                          | 2653/9741 [00:05<00:13, 516.79it/s] 28%|████████████████████████████████████████▌                                                                                                         | 2705/9741 [00:05<00:13, 514.67it/s] 28%|█████████████████████████████████████████▎                                                                                                        | 2757/9741 [00:05<00:13, 516.14it/s] 29%|██████████████████████████████████████████                                                                                                        | 2809/9741 [00:06<00:13, 517.04it/s] 29%|██████████████████████████████████████████▉                                                                                                       | 2862/9741 [00:06<00:13, 518.00it/s] 30%|███████████████████████████████████████████▋                                                                                                      | 2915/9741 [00:06<00:13, 519.04it/s] 30%|████████████████████████████████████████████▍                                                                                                     | 2967/9741 [00:06<00:13, 516.88it/s] 31%|█████████████████████████████████████████████▎                                                                                                    | 3020/9741 [00:06<00:12, 518.29it/s] 32%|██████████████████████████████████████████████                                                                                                    | 3072/9741 [00:06<00:12, 518.40it/s] 32%|██████████████████████████████████████████████▊                                                                                                   | 3125/9741 [00:06<00:12, 519.44it/s] 33%|███████████████████████████████████████████████▌                                                                                                  | 3177/9741 [00:06<00:12, 516.78it/s] 33%|████████████████████████████████████████████████▍                                                                                                 | 3230/9741 [00:06<00:12, 518.32it/s] 34%|█████████████████████████████████████████████████▏                                                                                                | 3283/9741 [00:06<00:12, 519.97it/s] 34%|█████████████████████████████████████████████████▉                                                                                                | 3335/9741 [00:07<00:12, 519.63it/s] 35%|██████████████████████████████████████████████████▊                                                                                               | 3387/9741 [00:07<00:12, 516.64it/s] 35%|███████████████████████████████████████████████████▌                                                                                              | 3439/9741 [00:07<00:12, 517.56it/s] 36%|████████████████████████████████████████████████████▎                                                                                             | 3491/9741 [00:07<00:12, 517.68it/s] 36%|█████████████████████████████████████████████████████                                                                                             | 3543/9741 [00:07<00:12, 516.17it/s] 37%|█████████████████████████████████████████████████████▉                                                                                            | 3595/9741 [00:07<00:11, 517.09it/s] 37%|██████████████████████████████████████████████████████▋                                                                                           | 3647/9741 [00:07<00:11, 516.05it/s] 38%|███████████████████████████████████████████████████████▍                                                                                          | 3700/9741 [00:07<00:11, 517.48it/s] 39%|████████████████████████████████████████████████████████▎                                                                                         | 3753/9741 [00:07<00:11, 518.84it/s] 39%|█████████████████████████████████████████████████████████                                                                                         | 3806/9741 [00:07<00:11, 519.37it/s] 40%|█████████████████████████████████████████████████████████▊                                                                                        | 3858/9741 [00:08<00:11, 516.59it/s] 40%|██████████████████████████████████████████████████████████▌                                                                                       | 3910/9741 [00:08<00:11, 517.05it/s] 41%|███████████████████████████████████████████████████████████▍                                                                                      | 3963/9741 [00:08<00:11, 518.05it/s] 41%|████████████████████████████████████████████████████████████▏                                                                                     | 4016/9741 [00:08<00:11, 519.20it/s] 42%|████████████████████████████████████████████████████████████▉                                                                                     | 4068/9741 [00:08<00:10, 517.13it/s] 42%|█████████████████████████████████████████████████████████████▊                                                                                    | 4121/9741 [00:08<00:10, 518.39it/s] 43%|██████████████████████████████████████████████████████████████▌                                                                                   | 4173/9741 [00:08<00:10, 518.20it/s] 43%|███████████████████████████████████████████████████████████████▎                                                                                  | 4225/9741 [00:08<00:10, 517.80it/s] 44%|████████████████████████████████████████████████████████████████                                                                                  | 4278/9741 [00:08<00:10, 519.07it/s] 44%|████████████████████████████████████████████████████████████████▉                                                                                 | 4330/9741 [00:08<00:10, 516.57it/s] 45%|█████████████████████████████████████████████████████████████████▋                                                                                | 4382/9741 [00:09<00:10, 516.34it/s] 46%|██████████████████████████████████████████████████████████████████▍                                                                               | 4435/9741 [00:09<00:10, 517.72it/s] 46%|███████████████████████████████████████████████████████████████████▎                                                                              | 4487/9741 [00:09<00:10, 517.90it/s] 47%|████████████████████████████████████████████████████████████████████                                                                              | 4539/9741 [00:09<00:10, 480.90it/s] 47%|████████████████████████████████████████████████████████████████████▊                                                                             | 4592/9741 [00:09<00:10, 492.18it/s] 48%|█████████████████████████████████████████████████████████████████████▌                                                                            | 4645/9741 [00:09<00:10, 500.64it/s] 48%|██████████████████████████████████████████████████████████████████████▍                                                                           | 4697/9741 [00:09<00:09, 505.90it/s] 49%|███████████████████████████████████████████████████████████████████████▏                                                                          | 4748/9741 [00:09<00:14, 350.60it/s] 49%|███████████████████████████████████████████████████████████████████████▉                                                                          | 4800/9741 [00:10<00:12, 388.31it/s] 50%|████████████████████████████████████████████████████████████████████████▋                                                                         | 4852/9741 [00:10<00:11, 419.68it/s] 50%|█████████████████████████████████████████████████████████████████████████▌                                                                        | 4904/9741 [00:10<00:10, 445.25it/s] 51%|██████████████████████████████████████████████████████████████████████████▎                                                                       | 4956/9741 [00:10<00:10, 463.40it/s] 51%|███████████████████████████████████████████████████████████████████████████                                                                       | 5009/9741 [00:10<00:09, 479.58it/s] 52%|███████████████████████████████████████████████████████████████████████████▊                                                                      | 5062/9741 [00:10<00:09, 492.00it/s] 52%|████████████████████████████████████████████████████████████████████████████▋                                                                     | 5114/9741 [00:10<00:09, 499.92it/s] 53%|█████████████████████████████████████████████████████████████████████████████▍                                                                    | 5167/9741 [00:10<00:09, 506.04it/s] 54%|██████████████████████████████████████████████████████████████████████████████▏                                                                   | 5219/9741 [00:10<00:08, 507.15it/s] 54%|███████████████████████████████████████████████████████████████████████████████                                                                   | 5271/9741 [00:10<00:08, 510.78it/s] 55%|███████████████████████████████████████████████████████████████████████████████▊                                                                  | 5324/9741 [00:11<00:08, 513.96it/s] 55%|████████████████████████████████████████████████████████████████████████████████▌                                                                 | 5376/9741 [00:11<00:08, 515.73it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▎                                                                | 5428/9741 [00:11<00:08, 514.13it/s] 56%|██████████████████████████████████████████████████████████████████████████████████▏                                                               | 5481/9741 [00:11<00:08, 516.38it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▉                                                               | 5535/9741 [00:11<00:08, 522.32it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▊                                                              | 5589/9741 [00:11<00:07, 526.54it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▌                                                             | 5642/9741 [00:11<00:07, 526.78it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▎                                                            | 5696/9741 [00:11<00:07, 530.08it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▏                                                           | 5750/9741 [00:11<00:07, 532.16it/s] 60%|██████████████████████████████████████████████████████████████████████████████████████▉                                                           | 5804/9741 [00:11<00:07, 533.43it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▊                                                          | 5858/9741 [00:12<00:07, 531.27it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▌                                                         | 5912/9741 [00:12<00:07, 532.41it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▍                                                        | 5966/9741 [00:12<00:07, 533.92it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▏                                                       | 6020/9741 [00:12<00:06, 534.90it/s] 62%|███████████████████████████████████████████████████████████████████████████████████████████                                                       | 6074/9741 [00:12<00:06, 530.76it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▊                                                      | 6128/9741 [00:12<00:06, 530.10it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▋                                                     | 6182/9741 [00:12<00:06, 532.12it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▍                                                    | 6236/9741 [00:12<00:06, 533.20it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▎                                                   | 6290/9741 [00:12<00:06, 534.25it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████                                                   | 6344/9741 [00:12<00:06, 531.77it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▉                                                  | 6398/9741 [00:13<00:06, 533.30it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▋                                                 | 6452/9741 [00:13<00:06, 534.55it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▌                                                | 6506/9741 [00:13<00:06, 535.52it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▎                                               | 6560/9741 [00:13<00:05, 532.76it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                                              | 6614/9741 [00:13<00:05, 533.23it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▉                                              | 6668/9741 [00:13<00:05, 534.34it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▊                                             | 6722/9741 [00:13<00:05, 534.96it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▌                                            | 6776/9741 [00:13<00:05, 532.39it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▎                                           | 6830/9741 [00:13<00:05, 533.54it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▏                                          | 6884/9741 [00:13<00:05, 534.59it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▉                                          | 6938/9741 [00:14<00:05, 535.33it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                         | 6992/9741 [00:14<00:05, 527.41it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                        | 7046/9741 [00:14<00:05, 530.13it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                       | 7100/9741 [00:14<00:04, 532.14it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                      | 7154/9741 [00:14<00:04, 533.67it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████                                      | 7208/9741 [00:14<00:04, 534.95it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                     | 7262/9741 [00:14<00:04, 532.92it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                    | 7316/9741 [00:14<00:04, 533.76it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                   | 7370/9741 [00:14<00:04, 535.05it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                  | 7424/9741 [00:14<00:04, 535.74it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                  | 7478/9741 [00:15<00:04, 482.06it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                 | 7532/9741 [00:15<00:04, 495.61it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                | 7586/9741 [00:15<00:04, 506.42it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                               | 7640/9741 [00:15<00:04, 514.50it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                              | 7693/9741 [00:15<00:03, 516.94it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                              | 7747/9741 [00:15<00:03, 522.80it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                             | 7801/9741 [00:15<00:03, 526.45it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                            | 7854/9741 [00:15<00:03, 523.91it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                           | 7907/9741 [00:15<00:03, 522.21it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                          | 7961/9741 [00:16<00:03, 525.81it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                         | 8015/9741 [00:16<00:03, 527.48it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                         | 8069/9741 [00:16<00:03, 528.96it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                        | 8122/9741 [00:16<00:03, 528.99it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                       | 8176/9741 [00:16<00:02, 530.99it/s] 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                      | 8230/9741 [00:16<00:02, 531.89it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                     | 8284/9741 [00:16<00:02, 532.50it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                     | 8338/9741 [00:16<00:02, 516.97it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                    | 8391/9741 [00:16<00:02, 519.71it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                   | 8445/9741 [00:16<00:02, 524.62it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                  | 8499/9741 [00:17<00:02, 527.65it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                 | 8553/9741 [00:17<00:02, 529.70it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                 | 8607/9741 [00:17<00:02, 528.14it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 8661/9741 [00:17<00:02, 529.94it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌               | 8715/9741 [00:17<00:01, 531.42it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍              | 8769/9741 [00:17<00:01, 526.50it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏             | 8822/9741 [00:17<00:01, 525.14it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████             | 8876/9741 [00:17<00:01, 528.04it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊            | 8930/9741 [00:17<00:01, 530.16it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋           | 8984/9741 [00:17<00:01, 531.47it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍          | 9038/9741 [00:18<00:01, 529.29it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎         | 9091/9741 [00:18<00:01, 529.21it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████         | 9145/9741 [00:18<00:01, 530.52it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉        | 9199/9741 [00:18<00:01, 530.51it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋       | 9253/9741 [00:18<00:00, 530.62it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍      | 9307/9741 [00:18<00:00, 527.83it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎     | 9361/9741 [00:18<00:00, 529.66it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 9415/9741 [00:18<00:00, 530.37it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉    | 9469/9741 [00:18<00:00, 531.35it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋   | 9523/9741 [00:18<00:00, 529.20it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 9577/9741 [00:19<00:00, 530.88it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎ | 9631/9741 [00:19<00:00, 530.94it/s] 99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏| 9685/9741 [00:19<00:00, 531.70it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉| 9739/9741 [00:19<00:00, 528.77it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:19<00:00, 502.14it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:04<00:09,  4.80s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.36s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.32s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.50s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.85s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.39s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.37s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.24s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.40s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.92s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.88s/it]
[2023-08-11 07:01:52,112] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.73s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.90s/it]
[2023-08-11 07:01:59,706] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 07:01:59,706] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f0486beae80>
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 07:01:59,707] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f0486a23910>
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 07:01:59,708] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 07:01:59,708] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4479091167449951 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Rationales: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
#### 56
Answer: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Rationales: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
#### 4
Answer: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Rationales: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
#### 480
Answer: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Rationales: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
#### 30
Answer: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Rationales: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
#### 868
Answer: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Rationales: Stella and Twinkle filled up the truck at the rate of 250 blocks per hour per person, a total of 2*250 = <<250*2=500>>500 blocks per hour for both.
After working for four hours, Stella and Twinkle had filled 4*500 = <<4*500=2000>>2000 blocks into the truck.
The number of blocks they had to put into the truck for it to be full is 6000-2000 = <<6000-2000=4000>>4000
When 6 more people joined Stella and Twinkle, a total of 2+6 = <<2+6=8>>8 people were filling the truck now.
Working at the rate of 250 blocks per person, the eight people filled the truck with 250*8 = <<250*8=2000>>2000 blocks in one hour.
If there were 4000 blocks that still needed to be put into the truck, the 8 people took 4000/2000 = <<4000/2000=2>>2 hours to fill the truck with the blocks.
The total time it took to fill up the tank is 4+2 = <<4+2=6>>6 hours.
#### 6
Answer: 6

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o6-tgsm8k-s10-rTrue
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.40451765060424805 seconds
Time to load utils op: 0.4045424461364746 seconds
Loading extension module utils...
Time to load utils op: 0.40450406074523926 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:42<34:20, 42.06s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:24<33:36, 42.01s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:06<33:06, 42.26s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:48<32:11, 41.99s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:30<31:35, 42.11s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:12<30:56, 42.19s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:55<30:19, 42.30s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:37<29:31, 42.19s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:19<28:51, 42.22s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:01<28:06, 42.16s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:43<27:25, 42.19s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:25<26:39, 42.09s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [09:04<25:16, 40.99s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:46<24:47, 41.33s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:28<24:20, 41.72s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [11:11<23:46, 41.95s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:54<23:11, 42.17s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [12:36<22:28, 42.13s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [13:18<21:46, 42.14s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:00<21:02, 42.08s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [14:42<20:21, 42.12s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [15:24<19:37, 42.04s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [16:06<18:54, 42.03s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [16:48<18:15, 42.14s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [17:30<17:31, 42.04s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [18:12<16:47, 41.99s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:54<16:07, 42.07s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:36<15:26, 42.13s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:19<14:48, 42.33s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:01<14:04, 42.24s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [21:44<13:23, 42.26s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:26<12:40, 42.27s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:08<11:57, 42.19s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [23:50<11:15, 42.23s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:33<10:34, 42.30s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [25:15<09:51, 42.24s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [25:57<09:08, 42.22s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:39<08:27, 42.30s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [27:22<07:44, 42.24s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [28:04<07:01, 42.18s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [28:45<06:18, 42.02s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [29:27<05:34, 41.82s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [30:09<04:53, 41.86s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [30:51<04:12, 42.04s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [31:33<03:30, 42.17s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [31:56<02:25, 36.39s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [32:39<01:54, 38.16s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [33:21<01:18, 39.31s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [34:03<00:40, 40.19s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:45<00:00, 40.68s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [34:45<00:00, 41.70s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.2735} | lm_loss 7.8393 | avg. gen lenth: 288.676
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s10-rTrue --seed 10 --rationales --num-out-domain 7
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 07:36:53,966] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o7-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 7
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o7-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  0%|▍                                                                                                                                                   | 32/9741 [00:00<00:30, 315.11it/s]  1%|▉                                                                                                                                                   | 64/9741 [00:00<00:30, 316.39it/s]  1%|█▍                                                                                                                                                  | 96/9741 [00:00<00:30, 317.27it/s]  1%|█▉                                                                                                                                                 | 128/9741 [00:00<00:30, 317.64it/s]  2%|██▍                                                                                                                                                | 160/9741 [00:00<00:30, 318.23it/s]  2%|██▉                                                                                                                                                | 192/9741 [00:00<00:30, 317.55it/s]  2%|███▍                                                                                                                                               | 224/9741 [00:00<00:30, 309.96it/s]  3%|███▊                                                                                                                                               | 256/9741 [00:00<00:30, 311.08it/s]  3%|████▎                                                                                                                                              | 288/9741 [00:00<00:30, 312.45it/s]  3%|████▊                                                                                                                                              | 320/9741 [00:01<00:30, 311.91it/s]  4%|█████▎                                                                                                                                             | 352/9741 [00:01<00:30, 312.62it/s]  4%|█████▊                                                                                                                                             | 384/9741 [00:01<00:29, 313.49it/s]  4%|██████▎                                                                                                                                            | 416/9741 [00:01<00:29, 313.75it/s]  5%|██████▊                                                                                                                                            | 448/9741 [00:01<00:29, 311.37it/s]  5%|███████▏                                                                                                                                           | 480/9741 [00:01<00:29, 312.21it/s]  5%|███████▋                                                                                                                                           | 512/9741 [00:01<00:29, 312.69it/s]  6%|████████▏                                                                                                                                          | 544/9741 [00:01<00:29, 310.84it/s]  6%|████████▋                                                                                                                                          | 576/9741 [00:01<00:29, 310.86it/s]  6%|█████████▏                                                                                                                                         | 608/9741 [00:01<00:29, 311.60it/s]  7%|█████████▋                                                                                                                                         | 640/9741 [00:02<00:29, 312.16it/s]  7%|██████████▏                                                                                                                                        | 672/9741 [00:02<00:29, 310.73it/s]  7%|██████████▌                                                                                                                                        | 704/9741 [00:02<00:28, 311.77it/s]  8%|███████████                                                                                                                                        | 736/9741 [00:02<00:28, 312.40it/s]  8%|███████████▌                                                                                                                                       | 768/9741 [00:02<00:28, 312.91it/s]  8%|████████████                                                                                                                                       | 800/9741 [00:02<00:28, 311.00it/s]  9%|████████████▌                                                                                                                                      | 832/9741 [00:02<00:28, 312.23it/s]  9%|█████████████                                                                                                                                      | 864/9741 [00:02<00:28, 313.14it/s]  9%|█████████████▌                                                                                                                                     | 896/9741 [00:02<00:28, 311.13it/s] 10%|██████████████                                                                                                                                     | 928/9741 [00:02<00:28, 311.75it/s] 10%|██████████████▍                                                                                                                                    | 960/9741 [00:03<00:28, 311.38it/s] 10%|██████████████▉                                                                                                                                    | 992/9741 [00:03<00:27, 313.02it/s] 11%|███████████████▎                                                                                                                                  | 1024/9741 [00:03<00:27, 314.29it/s] 11%|███████████████▊                                                                                                                                  | 1056/9741 [00:03<00:27, 315.20it/s] 11%|████████████████▎                                                                                                                                 | 1088/9741 [00:03<00:27, 316.00it/s] 11%|████████████████▊                                                                                                                                 | 1120/9741 [00:03<00:27, 313.99it/s] 12%|█████████████████▎                                                                                                                                | 1152/9741 [00:03<00:27, 314.95it/s] 12%|█████████████████▋                                                                                                                                | 1184/9741 [00:03<00:27, 315.44it/s] 12%|██████████████████▏                                                                                                                               | 1216/9741 [00:03<00:27, 315.41it/s] 13%|██████████████████▋                                                                                                                               | 1248/9741 [00:03<00:26, 315.60it/s] 13%|███████████████████▏                                                                                                                              | 1280/9741 [00:04<00:26, 315.85it/s] 13%|███████████████████▋                                                                                                                              | 1315/9741 [00:04<00:25, 325.56it/s] 14%|████████████████████▍                                                                                                                             | 1362/9741 [00:04<00:22, 368.16it/s] 14%|█████████████████████                                                                                                                             | 1409/9741 [00:04<00:21, 396.27it/s] 15%|█████████████████████▊                                                                                                                            | 1457/9741 [00:04<00:19, 420.73it/s] 15%|██████████████████████▌                                                                                                                           | 1505/9741 [00:04<00:18, 437.28it/s] 16%|███████████████████████▎                                                                                                                          | 1553/9741 [00:04<00:18, 449.77it/s] 16%|███████████████████████▉                                                                                                                          | 1600/9741 [00:04<00:17, 454.05it/s] 17%|████████████████████████▋                                                                                                                         | 1648/9741 [00:04<00:17, 460.56it/s] 17%|█████████████████████████▍                                                                                                                        | 1696/9741 [00:04<00:17, 464.74it/s] 18%|██████████████████████████▏                                                                                                                       | 1744/9741 [00:05<00:17, 468.83it/s] 18%|██████████████████████████▊                                                                                                                       | 1791/9741 [00:05<00:18, 430.33it/s] 19%|███████████████████████████▌                                                                                                                      | 1839/9741 [00:05<00:17, 443.09it/s] 19%|████████████████████████████▎                                                                                                                     | 1887/9741 [00:05<00:17, 453.27it/s] 20%|█████████████████████████████                                                                                                                     | 1935/9741 [00:05<00:16, 460.20it/s] 20%|█████████████████████████████▋                                                                                                                    | 1983/9741 [00:05<00:16, 464.72it/s] 21%|██████████████████████████████▍                                                                                                                   | 2030/9741 [00:05<00:16, 464.99it/s] 21%|███████████████████████████████▏                                                                                                                  | 2078/9741 [00:05<00:16, 468.56it/s] 22%|███████████████████████████████▊                                                                                                                  | 2126/9741 [00:05<00:16, 470.57it/s] 22%|████████████████████████████████▌                                                                                                                 | 2174/9741 [00:06<00:16, 472.38it/s] 23%|█████████████████████████████████▎                                                                                                                | 2222/9741 [00:06<00:15, 473.29it/s] 23%|██████████████████████████████████                                                                                                                | 2270/9741 [00:06<00:15, 471.26it/s] 24%|██████████████████████████████████▋                                                                                                               | 2318/9741 [00:06<00:15, 472.93it/s] 24%|███████████████████████████████████▍                                                                                                              | 2366/9741 [00:06<00:15, 474.60it/s] 25%|████████████████████████████████████▏                                                                                                             | 2414/9741 [00:06<00:15, 476.09it/s] 25%|████████████████████████████████████▉                                                                                                             | 2462/9741 [00:06<00:15, 476.86it/s] 26%|█████████████████████████████████████▌                                                                                                            | 2510/9741 [00:06<00:15, 473.85it/s] 26%|██████████████████████████████████████▎                                                                                                           | 2558/9741 [00:06<00:15, 474.35it/s] 27%|███████████████████████████████████████                                                                                                           | 2606/9741 [00:06<00:15, 475.54it/s] 27%|███████████████████████████████████████▊                                                                                                          | 2654/9741 [00:07<00:14, 475.54it/s] 28%|████████████████████████████████████████▍                                                                                                         | 2702/9741 [00:07<00:14, 472.20it/s] 28%|█████████████████████████████████████████▏                                                                                                        | 2750/9741 [00:07<00:14, 472.56it/s] 29%|█████████████████████████████████████████▉                                                                                                        | 2798/9741 [00:07<00:14, 471.56it/s] 29%|██████████████████████████████████████████▋                                                                                                       | 2846/9741 [00:07<00:14, 472.87it/s] 30%|███████████████████████████████████████████▍                                                                                                      | 2894/9741 [00:07<00:14, 474.00it/s] 30%|████████████████████████████████████████████                                                                                                      | 2942/9741 [00:07<00:14, 471.87it/s] 31%|████████████████████████████████████████████▊                                                                                                     | 2990/9741 [00:07<00:14, 472.70it/s] 31%|█████████████████████████████████████████████▌                                                                                                    | 3038/9741 [00:07<00:14, 473.63it/s] 32%|██████████████████████████████████████████████▎                                                                                                   | 3086/9741 [00:07<00:14, 473.71it/s] 32%|██████████████████████████████████████████████▉                                                                                                   | 3134/9741 [00:08<00:13, 474.42it/s] 33%|███████████████████████████████████████████████▋                                                                                                  | 3182/9741 [00:08<00:13, 471.62it/s] 33%|████████████████████████████████████████████████▍                                                                                                 | 3230/9741 [00:08<00:13, 472.72it/s] 34%|█████████████████████████████████████████████████▏                                                                                                | 3278/9741 [00:08<00:13, 473.04it/s] 34%|█████████████████████████████████████████████████▊                                                                                                | 3326/9741 [00:08<00:13, 472.58it/s] 35%|██████████████████████████████████████████████████▌                                                                                               | 3374/9741 [00:08<00:13, 473.26it/s] 35%|███████████████████████████████████████████████████▎                                                                                              | 3422/9741 [00:08<00:13, 470.86it/s] 36%|████████████████████████████████████████████████████                                                                                              | 3470/9741 [00:08<00:13, 472.07it/s] 36%|████████████████████████████████████████████████████▋                                                                                             | 3518/9741 [00:08<00:13, 472.58it/s] 37%|█████████████████████████████████████████████████████▍                                                                                            | 3566/9741 [00:08<00:13, 473.17it/s] 37%|██████████████████████████████████████████████████████▏                                                                                           | 3614/9741 [00:09<00:13, 449.79it/s] 38%|██████████████████████████████████████████████████████▉                                                                                           | 3662/9741 [00:09<00:13, 456.47it/s] 38%|███████████████████████████████████████████████████████▌                                                                                          | 3710/9741 [00:09<00:13, 461.76it/s] 39%|████████████████████████████████████████████████████████▎                                                                                         | 3758/9741 [00:09<00:12, 465.00it/s] 39%|█████████████████████████████████████████████████████████                                                                                         | 3805/9741 [00:09<00:12, 465.51it/s] 40%|█████████████████████████████████████████████████████████▋                                                                                        | 3852/9741 [00:09<00:12, 464.33it/s] 40%|██████████████████████████████████████████████████████████▍                                                                                       | 3900/9741 [00:09<00:12, 466.46it/s] 41%|███████████████████████████████████████████████████████████▏                                                                                      | 3948/9741 [00:09<00:12, 468.13it/s] 41%|███████████████████████████████████████████████████████████▉                                                                                      | 3996/9741 [00:09<00:12, 469.21it/s] 42%|████████████████████████████████████████████████████████████▌                                                                                     | 4044/9741 [00:10<00:12, 470.10it/s] 42%|█████████████████████████████████████████████████████████████▎                                                                                    | 4092/9741 [00:10<00:12, 467.53it/s] 43%|██████████████████████████████████████████████████████████████                                                                                    | 4140/9741 [00:10<00:11, 468.89it/s] 43%|██████████████████████████████████████████████████████████████▊                                                                                   | 4188/9741 [00:10<00:11, 469.56it/s] 43%|███████████████████████████████████████████████████████████████▍                                                                                  | 4236/9741 [00:10<00:11, 470.05it/s] 44%|████████████████████████████████████████████████████████████████▏                                                                                 | 4284/9741 [00:10<00:11, 470.56it/s] 44%|████████████████████████████████████████████████████████████████▉                                                                                 | 4332/9741 [00:10<00:11, 467.94it/s] 45%|█████████████████████████████████████████████████████████████████▋                                                                                | 4380/9741 [00:10<00:11, 469.32it/s] 45%|██████████████████████████████████████████████████████████████████▎                                                                               | 4428/9741 [00:10<00:11, 469.96it/s] 46%|███████████████████████████████████████████████████████████████████                                                                               | 4476/9741 [00:10<00:11, 470.27it/s] 46%|███████████████████████████████████████████████████████████████████▊                                                                              | 4524/9741 [00:11<00:12, 434.04it/s] 47%|████████████████████████████████████████████████████████████████████▌                                                                             | 4572/9741 [00:11<00:11, 444.77it/s] 47%|█████████████████████████████████████████████████████████████████████▏                                                                            | 4620/9741 [00:11<00:11, 453.68it/s] 48%|█████████████████████████████████████████████████████████████████████▉                                                                            | 4668/9741 [00:11<00:11, 460.23it/s] 48%|██████████████████████████████████████████████████████████████████████▋                                                                           | 4716/9741 [00:11<00:10, 464.49it/s] 49%|███████████████████████████████████████████████████████████████████████▍                                                                          | 4763/9741 [00:11<00:14, 331.89it/s] 49%|████████████████████████████████████████████████████████████████████████                                                                          | 4811/9741 [00:11<00:13, 364.42it/s] 50%|████████████████████████████████████████████████████████████████████████▊                                                                         | 4859/9741 [00:11<00:12, 391.00it/s] 50%|█████████████████████████████████████████████████████████████████████████▌                                                                        | 4907/9741 [00:12<00:11, 412.23it/s] 51%|██████████████████████████████████████████████████████████████████████████▎                                                                       | 4954/9741 [00:12<00:11, 426.18it/s] 51%|██████████████████████████████████████████████████████████████████████████▉                                                                       | 5002/9741 [00:12<00:10, 439.42it/s] 52%|███████████████████████████████████████████████████████████████████████████▋                                                                      | 5049/9741 [00:12<00:10, 447.32it/s] 52%|████████████████████████████████████████████████████████████████████████████▍                                                                     | 5097/9741 [00:12<00:10, 454.58it/s] 53%|█████████████████████████████████████████████████████████████████████████████                                                                     | 5144/9741 [00:12<00:10, 455.56it/s] 53%|█████████████████████████████████████████████████████████████████████████████▊                                                                    | 5191/9741 [00:12<00:09, 457.60it/s] 54%|██████████████████████████████████████████████████████████████████████████████▌                                                                   | 5239/9741 [00:12<00:09, 461.92it/s] 54%|███████████████████████████████████████████████████████████████████████████████▏                                                                  | 5287/9741 [00:12<00:09, 466.12it/s] 55%|███████████████████████████████████████████████████████████████████████████████▉                                                                  | 5335/9741 [00:12<00:09, 468.13it/s] 55%|████████████████████████████████████████████████████████████████████████████████▋                                                                 | 5383/9741 [00:13<00:09, 470.11it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▍                                                                | 5431/9741 [00:13<00:09, 468.71it/s] 56%|██████████████████████████████████████████████████████████████████████████████████                                                                | 5479/9741 [00:13<00:09, 470.64it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▊                                                               | 5528/9741 [00:13<00:08, 476.01it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▌                                                              | 5577/9741 [00:13<00:08, 479.57it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▎                                                             | 5625/9741 [00:13<00:08, 478.70it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████                                                             | 5674/9741 [00:13<00:08, 481.89it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▊                                                            | 5723/9741 [00:13<00:08, 483.55it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▌                                                           | 5772/9741 [00:13<00:08, 485.08it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▏                                                          | 5821/9741 [00:13<00:08, 486.01it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▉                                                          | 5870/9741 [00:14<00:08, 483.81it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▋                                                         | 5919/9741 [00:14<00:07, 485.06it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▍                                                        | 5968/9741 [00:14<00:07, 482.57it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▏                                                       | 6017/9741 [00:14<00:07, 484.00it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▉                                                       | 6066/9741 [00:14<00:07, 485.63it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▋                                                      | 6115/9741 [00:14<00:07, 483.63it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▍                                                     | 6164/9741 [00:14<00:07, 484.99it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████                                                     | 6213/9741 [00:14<00:07, 486.38it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▊                                                    | 6262/9741 [00:14<00:07, 486.39it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▌                                                   | 6311/9741 [00:14<00:07, 480.95it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▎                                                  | 6360/9741 [00:15<00:07, 482.54it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████                                                  | 6409/9741 [00:15<00:06, 484.53it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▊                                                 | 6458/9741 [00:15<00:06, 485.07it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▌                                                | 6507/9741 [00:15<00:06, 483.43it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▎                                               | 6556/9741 [00:15<00:06, 470.53it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                                               | 6605/9741 [00:15<00:06, 475.81it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▋                                              | 6655/9741 [00:15<00:06, 480.32it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▍                                             | 6704/9741 [00:15<00:06, 482.53it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████▏                                            | 6754/9741 [00:15<00:06, 485.29it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▉                                            | 6803/9741 [00:15<00:06, 480.43it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▋                                           | 6853/9741 [00:16<00:05, 483.34it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▍                                          | 6903/9741 [00:16<00:05, 485.49it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                         | 6952/9741 [00:16<00:05, 486.58it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                         | 7001/9741 [00:16<00:05, 484.48it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                        | 7051/9741 [00:16<00:05, 486.22it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                       | 7100/9741 [00:16<00:05, 487.20it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                      | 7149/9741 [00:16<00:05, 487.70it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                      | 7198/9741 [00:16<00:05, 487.62it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                     | 7247/9741 [00:16<00:05, 484.43it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                    | 7296/9741 [00:16<00:05, 485.83it/s] 75%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████                                    | 7345/9741 [00:17<00:05, 461.99it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                   | 7394/9741 [00:17<00:04, 469.85it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                  | 7442/9741 [00:17<00:05, 422.46it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 7491/9741 [00:17<00:05, 440.17it/s] 77%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                 | 7540/9741 [00:17<00:04, 453.27it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                | 7588/9741 [00:17<00:04, 458.77it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                               | 7637/9741 [00:17<00:04, 467.03it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                              | 7685/9741 [00:17<00:04, 469.97it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                              | 7734/9741 [00:17<00:04, 475.51it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                             | 7783/9741 [00:18<00:04, 479.10it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                            | 7832/9741 [00:18<00:03, 481.88it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                            | 7881/9741 [00:18<00:03, 483.32it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                           | 7930/9741 [00:18<00:03, 482.28it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                          | 7979/9741 [00:18<00:03, 484.01it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                         | 8028/9741 [00:18<00:03, 484.93it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                         | 8077/9741 [00:18<00:03, 484.85it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                        | 8126/9741 [00:18<00:03, 482.98it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                       | 8175/9741 [00:18<00:03, 483.97it/s] 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                      | 8224/9741 [00:18<00:03, 485.16it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                      | 8273/9741 [00:19<00:03, 485.69it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                     | 8322/9741 [00:19<00:02, 485.84it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                    | 8371/9741 [00:19<00:02, 483.70it/s] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 8420/9741 [00:19<00:02, 483.63it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                   | 8469/9741 [00:19<00:02, 484.68it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                  | 8518/9741 [00:19<00:02, 484.95it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                 | 8567/9741 [00:19<00:02, 485.26it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                | 8616/9741 [00:19<00:02, 482.88it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 8665/9741 [00:19<00:02, 483.29it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌               | 8714/9741 [00:19<00:02, 484.45it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎              | 8763/9741 [00:20<00:02, 483.99it/s] 90%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████              | 8812/9741 [00:20<00:01, 481.92it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 8861/9741 [00:20<00:01, 482.69it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 8910/9741 [00:20<00:01, 483.59it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎           | 8959/9741 [00:20<00:01, 484.70it/s] 92%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████           | 9008/9741 [00:20<00:01, 485.45it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋          | 9057/9741 [00:20<00:01, 483.01it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍         | 9106/9741 [00:20<00:01, 484.11it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏        | 9155/9741 [00:20<00:01, 484.87it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉        | 9204/9741 [00:20<00:01, 484.96it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋       | 9253/9741 [00:21<00:01, 485.42it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍      | 9302/9741 [00:21<00:00, 483.08it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏     | 9351/9741 [00:21<00:00, 484.16it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉     | 9400/9741 [00:21<00:00, 484.79it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌    | 9449/9741 [00:21<00:00, 484.28it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎   | 9498/9741 [00:21<00:00, 478.45it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████   | 9547/9741 [00:21<00:00, 479.94it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊  | 9596/9741 [00:21<00:00, 480.67it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌ | 9645/9741 [00:21<00:00, 481.78it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎| 9694/9741 [00:21<00:00, 482.51it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:22<00:00, 441.09it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.38s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.03s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.51s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.58s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.90s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.24s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.40s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.29s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.62s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.70s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.89s/it]
[2023-08-11 07:38:08,413] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.75s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.94s/it]
[2023-08-11 07:38:18,260] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 07:38:18,262] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 07:38:18,264] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 07:38:18,264] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 07:38:18,264] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 07:38:18,264] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f22417c6e80>
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 07:38:18,265] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f2241628910>
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 07:38:18,266] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 07:38:18,267] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 07:38:18,267] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 07:38:18,267] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 07:38:18,267] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.47769951820373535 seconds
Loading extension module utils...
Time to load utils op: 0.2039792537689209 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Rationales: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
#### 56
Answer: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Rationales: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
#### 4
Answer: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Rationales: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
#### 480
Answer: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Rationales: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
#### 30
Answer: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Rationales: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
#### 868
Answer: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Rationales: Stella and Twinkle filled up the truck at the rate of 250 blocks per hour per person, a total of 2*250 = <<250*2=500>>500 blocks per hour for both.
After working for four hours, Stella and Twinkle had filled 4*500 = <<4*500=2000>>2000 blocks into the truck.
The number of blocks they had to put into the truck for it to be full is 6000-2000 = <<6000-2000=4000>>4000
When 6 more people joined Stella and Twinkle, a total of 2+6 = <<2+6=8>>8 people were filling the truck now.
Working at the rate of 250 blocks per person, the eight people filled the truck with 250*8 = <<250*8=2000>>2000 blocks in one hour.
If there were 4000 blocks that still needed to be put into the truck, the 8 people took 4000/2000 = <<4000/2000=2>>2 hours to fill the truck with the blocks.
The total time it took to fill up the tank is 4+2 = <<4+2=6>>6 hours.
#### 6
Answer: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Rationales: Total drunk: 8.5 + 9.5 = <<8.5+9.5=18>>18 pints
18 pints * 2 = <<18*2=36>>36 cups
The two boys drank a total of 36 cups of liquid yesterday.
#### 36
Answer: 36

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o7-tgsm8k-s10-rTrue
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5037288665771484 seconds
Time to load utils op: 0.4042069911956787 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:42<34:46, 42.59s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:23<33:26, 41.80s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:05<32:40, 41.72s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:46<31:52, 41.57s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:28<31:10, 41.57s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:10<30:32, 41.64s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:51<29:49, 41.61s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:33<29:06, 41.58s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:09<27:13, 39.85s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [06:50<26:49, 40.23s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:31<26:20, 40.53s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:12<25:47, 40.74s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [08:54<25:14, 40.93s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:35<24:37, 41.05s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:16<23:58, 41.11s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [10:58<23:23, 41.27s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:39<22:40, 41.23s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [12:20<22:01, 41.30s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [13:01<21:16, 41.18s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [13:43<20:37, 41.25s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [14:24<19:58, 41.33s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [15:05<19:14, 41.24s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [15:46<18:32, 41.21s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [16:28<17:52, 41.23s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [17:09<17:11, 41.25s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [17:50<16:29, 41.24s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:32<15:51, 41.36s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:13<15:11, 41.42s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [19:55<14:29, 41.42s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [20:36<13:46, 41.33s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [21:18<13:06, 41.40s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [21:59<12:24, 41.38s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [22:40<11:43, 41.36s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [23:21<11:00, 41.31s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:03<10:19, 41.29s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [24:44<09:39, 41.37s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [25:26<08:57, 41.36s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:07<08:16, 41.36s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [26:26<06:20, 34.57s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [27:07<06:05, 36.54s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [27:48<05:40, 37.87s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [28:29<05:10, 38.86s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [28:50<03:55, 33.68s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [29:32<03:36, 36.03s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [30:13<03:08, 37.62s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [30:55<02:34, 38.72s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [31:15<01:39, 33.17s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [31:56<01:11, 35.65s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [32:37<00:37, 37.27s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [33:19<00:00, 38.51s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [33:19<00:00, 39.98s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.0999} | lm_loss 7.8162 | avg. gen lenth: 322.208
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s10-rTrue --seed 10 --rationales --num-out-domain 8
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 08:12:17,571] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o8-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 8
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o8-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  0%|▍                                                                                                                                                   | 26/9741 [00:00<00:37, 256.89it/s]  1%|▊                                                                                                                                                   | 52/9741 [00:00<00:37, 257.71it/s]  1%|█▏                                                                                                                                                  | 78/9741 [00:00<00:37, 258.16it/s]  1%|█▌                                                                                                                                                 | 104/9741 [00:00<00:37, 258.68it/s]  1%|█▉                                                                                                                                                 | 130/9741 [00:00<00:37, 258.67it/s]  2%|██▎                                                                                                                                                | 156/9741 [00:00<00:37, 258.46it/s]  2%|██▋                                                                                                                                                | 182/9741 [00:00<00:36, 258.42it/s]  2%|███▏                                                                                                                                               | 208/9741 [00:00<00:37, 252.62it/s]  2%|███▌                                                                                                                                               | 234/9741 [00:00<00:37, 253.97it/s]  3%|███▉                                                                                                                                               | 260/9741 [00:01<00:37, 255.04it/s]  3%|████▎                                                                                                                                              | 286/9741 [00:01<00:36, 255.69it/s]  3%|████▋                                                                                                                                              | 312/9741 [00:01<00:36, 256.47it/s]  3%|█████                                                                                                                                              | 338/9741 [00:01<00:36, 256.77it/s]  4%|█████▍                                                                                                                                             | 364/9741 [00:01<00:36, 257.03it/s]  4%|█████▉                                                                                                                                             | 390/9741 [00:01<00:36, 257.63it/s]  4%|██████▎                                                                                                                                            | 416/9741 [00:01<00:36, 257.57it/s]  5%|██████▋                                                                                                                                            | 442/9741 [00:01<00:36, 255.31it/s]  5%|███████                                                                                                                                            | 468/9741 [00:01<00:36, 253.32it/s]  5%|███████▍                                                                                                                                           | 494/9741 [00:01<00:36, 253.95it/s]  5%|███████▉                                                                                                                                           | 522/9741 [00:02<00:35, 261.60it/s]  6%|████████▍                                                                                                                                          | 562/9741 [00:02<00:30, 300.43it/s]  6%|█████████                                                                                                                                          | 601/9741 [00:02<00:27, 326.94it/s]  7%|█████████▋                                                                                                                                         | 641/9741 [00:02<00:26, 346.10it/s]  7%|██████████▎                                                                                                                                        | 680/9741 [00:02<00:25, 356.46it/s]  7%|██████████▊                                                                                                                                        | 719/9741 [00:02<00:24, 365.76it/s]  8%|███████████▍                                                                                                                                       | 758/9741 [00:02<00:24, 372.63it/s]  8%|████████████                                                                                                                                       | 797/9741 [00:02<00:23, 377.46it/s]  9%|████████████▌                                                                                                                                      | 836/9741 [00:02<00:23, 380.42it/s]  9%|█████████████▏                                                                                                                                     | 875/9741 [00:02<00:23, 382.27it/s]  9%|█████████████▊                                                                                                                                     | 914/9741 [00:03<00:23, 380.56it/s] 10%|██████████████▍                                                                                                                                    | 953/9741 [00:03<00:23, 382.03it/s] 10%|██████████████▉                                                                                                                                    | 992/9741 [00:03<00:23, 379.87it/s] 11%|███████████████▍                                                                                                                                  | 1031/9741 [00:03<00:22, 381.55it/s] 11%|████████████████                                                                                                                                  | 1070/9741 [00:03<00:22, 383.09it/s] 11%|████████████████▌                                                                                                                                 | 1109/9741 [00:03<00:22, 381.46it/s] 12%|█████████████████▏                                                                                                                                | 1148/9741 [00:03<00:22, 382.81it/s] 12%|█████████████████▊                                                                                                                                | 1187/9741 [00:03<00:22, 383.31it/s] 13%|██████████████████▍                                                                                                                               | 1226/9741 [00:03<00:22, 383.24it/s] 13%|██████████████████▉                                                                                                                               | 1265/9741 [00:03<00:22, 383.72it/s] 13%|███████████████████▌                                                                                                                              | 1304/9741 [00:04<00:21, 383.51it/s] 14%|████████████████████▏                                                                                                                             | 1343/9741 [00:04<00:22, 381.00it/s] 14%|████████████████████▋                                                                                                                             | 1382/9741 [00:04<00:21, 381.72it/s] 15%|█████████████████████▎                                                                                                                            | 1421/9741 [00:04<00:21, 382.25it/s] 15%|█████████████████████▉                                                                                                                            | 1460/9741 [00:04<00:21, 382.30it/s] 15%|██████████████████████▍                                                                                                                           | 1499/9741 [00:04<00:21, 382.24it/s] 16%|███████████████████████                                                                                                                           | 1538/9741 [00:04<00:21, 382.37it/s] 16%|███████████████████████▋                                                                                                                          | 1577/9741 [00:04<00:21, 379.65it/s] 17%|████████████████████████▏                                                                                                                         | 1616/9741 [00:04<00:21, 379.78it/s] 17%|████████████████████████▊                                                                                                                         | 1655/9741 [00:04<00:21, 380.57it/s] 17%|█████████████████████████▍                                                                                                                        | 1694/9741 [00:05<00:21, 380.41it/s] 18%|█████████████████████████▉                                                                                                                        | 1733/9741 [00:05<00:21, 380.43it/s] 18%|██████████████████████████▌                                                                                                                       | 1772/9741 [00:05<00:20, 380.50it/s] 19%|███████████████████████████▏                                                                                                                      | 1811/9741 [00:05<00:22, 357.65it/s] 19%|███████████████████████████▋                                                                                                                      | 1849/9741 [00:05<00:21, 363.83it/s] 19%|████████████████████████████▎                                                                                                                     | 1887/9741 [00:05<00:21, 368.00it/s] 20%|████████████████████████████▊                                                                                                                     | 1925/9741 [00:05<00:21, 369.76it/s] 20%|█████████████████████████████▍                                                                                                                    | 1963/9741 [00:05<00:20, 372.38it/s] 21%|█████████████████████████████▉                                                                                                                    | 2001/9741 [00:05<00:20, 374.00it/s] 21%|██████████████████████████████▌                                                                                                                   | 2039/9741 [00:06<00:20, 372.44it/s] 21%|███████████████████████████████▏                                                                                                                  | 2077/9741 [00:06<00:20, 374.12it/s] 22%|███████████████████████████████▋                                                                                                                  | 2115/9741 [00:06<00:20, 374.79it/s] 22%|████████████████████████████████▎                                                                                                                 | 2153/9741 [00:06<00:20, 375.67it/s] 22%|████████████████████████████████▊                                                                                                                 | 2191/9741 [00:06<00:20, 376.42it/s] 23%|█████████████████████████████████▍                                                                                                                | 2229/9741 [00:06<00:19, 376.54it/s] 23%|█████████████████████████████████▉                                                                                                                | 2267/9741 [00:06<00:19, 374.10it/s] 24%|██████████████████████████████████▌                                                                                                               | 2305/9741 [00:06<00:19, 375.17it/s] 24%|███████████████████████████████████                                                                                                               | 2343/9741 [00:06<00:19, 375.67it/s] 24%|███████████████████████████████████▋                                                                                                              | 2381/9741 [00:06<00:19, 376.28it/s] 25%|████████████████████████████████████▎                                                                                                             | 2419/9741 [00:07<00:19, 374.03it/s] 25%|████████████████████████████████████▊                                                                                                             | 2457/9741 [00:07<00:19, 375.27it/s] 26%|█████████████████████████████████████▍                                                                                                            | 2495/9741 [00:07<00:19, 372.29it/s] 26%|█████████████████████████████████████▉                                                                                                            | 2533/9741 [00:07<00:19, 373.53it/s] 26%|██████████████████████████████████████▌                                                                                                           | 2571/9741 [00:07<00:19, 374.13it/s] 27%|███████████████████████████████████████                                                                                                           | 2609/9741 [00:07<00:19, 375.01it/s] 27%|███████████████████████████████████████▋                                                                                                          | 2647/9741 [00:07<00:18, 375.50it/s] 28%|████████████████████████████████████████▏                                                                                                         | 2685/9741 [00:07<00:18, 375.99it/s] 28%|████████████████████████████████████████▊                                                                                                         | 2723/9741 [00:07<00:18, 373.18it/s] 28%|█████████████████████████████████████████▍                                                                                                        | 2761/9741 [00:07<00:18, 373.61it/s] 29%|█████████████████████████████████████████▉                                                                                                        | 2799/9741 [00:08<00:18, 374.14it/s] 29%|██████████████████████████████████████████▌                                                                                                       | 2837/9741 [00:08<00:18, 374.53it/s] 30%|███████████████████████████████████████████                                                                                                       | 2875/9741 [00:08<00:18, 375.38it/s] 30%|███████████████████████████████████████████▋                                                                                                      | 2913/9741 [00:08<00:18, 371.27it/s] 30%|████████████████████████████████████████████▏                                                                                                     | 2951/9741 [00:08<00:18, 369.94it/s] 31%|████████████████████████████████████████████▊                                                                                                     | 2989/9741 [00:08<00:18, 371.85it/s] 31%|█████████████████████████████████████████████▎                                                                                                    | 3027/9741 [00:08<00:18, 372.87it/s] 31%|█████████████████████████████████████████████▉                                                                                                    | 3065/9741 [00:08<00:17, 373.51it/s] 32%|██████████████████████████████████████████████▌                                                                                                   | 3103/9741 [00:08<00:17, 374.33it/s] 32%|███████████████████████████████████████████████                                                                                                   | 3141/9741 [00:08<00:17, 374.53it/s] 33%|███████████████████████████████████████████████▋                                                                                                  | 3179/9741 [00:09<00:17, 372.24it/s] 33%|████████████████████████████████████████████████▏                                                                                                 | 3217/9741 [00:09<00:17, 373.18it/s] 33%|████████████████████████████████████████████████▊                                                                                                 | 3255/9741 [00:09<00:17, 373.77it/s] 34%|█████████████████████████████████████████████████▎                                                                                                | 3293/9741 [00:09<00:17, 374.12it/s] 34%|█████████████████████████████████████████████████▉                                                                                                | 3331/9741 [00:09<00:17, 373.81it/s] 35%|██████████████████████████████████████████████████▍                                                                                               | 3369/9741 [00:09<00:17, 371.64it/s] 35%|███████████████████████████████████████████████████                                                                                               | 3407/9741 [00:09<00:17, 367.55it/s] 35%|███████████████████████████████████████████████████▋                                                                                              | 3445/9741 [00:09<00:17, 369.06it/s] 36%|████████████████████████████████████████████████████▏                                                                                             | 3483/9741 [00:09<00:16, 370.30it/s] 36%|████████████████████████████████████████████████████▊                                                                                             | 3521/9741 [00:09<00:16, 370.76it/s] 37%|█████████████████████████████████████████████████████▎                                                                                            | 3559/9741 [00:10<00:16, 371.89it/s] 37%|█████████████████████████████████████████████████████▉                                                                                            | 3597/9741 [00:10<00:16, 371.93it/s] 37%|██████████████████████████████████████████████████████▍                                                                                           | 3635/9741 [00:10<00:16, 370.09it/s] 38%|███████████████████████████████████████████████████████                                                                                           | 3673/9741 [00:10<00:16, 370.76it/s] 38%|███████████████████████████████████████████████████████▌                                                                                          | 3711/9741 [00:10<00:16, 371.78it/s] 38%|████████████████████████████████████████████████████████▏                                                                                         | 3749/9741 [00:10<00:16, 372.43it/s] 39%|████████████████████████████████████████████████████████▊                                                                                         | 3787/9741 [00:10<00:15, 372.74it/s] 39%|█████████████████████████████████████████████████████████▎                                                                                        | 3825/9741 [00:10<00:15, 373.01it/s] 40%|█████████████████████████████████████████████████████████▉                                                                                        | 3863/9741 [00:10<00:15, 370.14it/s] 40%|██████████████████████████████████████████████████████████▍                                                                                       | 3901/9741 [00:11<00:15, 371.05it/s] 40%|███████████████████████████████████████████████████████████                                                                                       | 3939/9741 [00:11<00:15, 371.52it/s] 41%|███████████████████████████████████████████████████████████▌                                                                                      | 3977/9741 [00:11<00:15, 371.76it/s] 41%|████████████████████████████████████████████████████████████▏                                                                                     | 4015/9741 [00:11<00:15, 371.96it/s] 42%|████████████████████████████████████████████████████████████▊                                                                                     | 4054/9741 [00:11<00:15, 375.47it/s] 42%|█████████████████████████████████████████████████████████████▎                                                                                    | 4092/9741 [00:11<00:15, 375.36it/s] 42%|█████████████████████████████████████████████████████████████▉                                                                                    | 4131/9741 [00:11<00:14, 377.25it/s] 43%|██████████████████████████████████████████████████████████████▌                                                                                   | 4170/9741 [00:11<00:14, 379.35it/s] 43%|███████████████████████████████████████████████████████████████                                                                                   | 4209/9741 [00:11<00:14, 381.37it/s] 44%|███████████████████████████████████████████████████████████████▋                                                                                  | 4248/9741 [00:11<00:14, 382.71it/s] 44%|████████████████████████████████████████████████████████████████▎                                                                                 | 4287/9741 [00:12<00:14, 380.62it/s] 44%|████████████████████████████████████████████████████████████████▊                                                                                 | 4326/9741 [00:12<00:14, 382.06it/s] 45%|█████████████████████████████████████████████████████████████████▍                                                                                | 4365/9741 [00:12<00:14, 380.53it/s] 45%|██████████████████████████████████████████████████████████████████                                                                                | 4404/9741 [00:12<00:13, 381.38it/s] 46%|██████████████████████████████████████████████████████████████████▌                                                                               | 4443/9741 [00:12<00:13, 382.26it/s] 46%|███████████████████████████████████████████████████████████████████▏                                                                              | 4482/9741 [00:12<00:13, 383.21it/s] 46%|███████████████████████████████████████████████████████████████████▊                                                                              | 4521/9741 [00:12<00:15, 338.40it/s] 47%|████████████████████████████████████████████████████████████████████▎                                                                             | 4560/9741 [00:12<00:14, 350.63it/s] 47%|████████████████████████████████████████████████████████████████████▉                                                                             | 4599/9741 [00:12<00:14, 360.29it/s] 48%|█████████████████████████████████████████████████████████████████████▌                                                                            | 4638/9741 [00:12<00:13, 367.25it/s] 48%|██████████████████████████████████████████████████████████████████████                                                                            | 4677/9741 [00:13<00:13, 372.27it/s] 48%|██████████████████████████████████████████████████████████████████████▋                                                                           | 4716/9741 [00:13<00:13, 376.06it/s] 49%|███████████████████████████████████████████████████████████████████████▎                                                                          | 4754/9741 [00:13<00:19, 257.05it/s] 49%|███████████████████████████████████████████████████████████████████████▊                                                                          | 4793/9741 [00:13<00:17, 285.50it/s] 50%|████████████████████████████████████████████████████████████████████████▍                                                                         | 4832/9741 [00:13<00:15, 309.43it/s] 50%|█████████████████████████████████████████████████████████████████████████                                                                         | 4871/9741 [00:13<00:14, 328.29it/s] 50%|█████████████████████████████████████████████████████████████████████████▌                                                                        | 4910/9741 [00:13<00:14, 343.32it/s] 51%|██████████████████████████████████████████████████████████████████████████▏                                                                       | 4947/9741 [00:13<00:13, 350.46it/s] 51%|██████████████████████████████████████████████████████████████████████████▋                                                                       | 4986/9741 [00:14<00:13, 359.81it/s] 52%|███████████████████████████████████████████████████████████████████████████▎                                                                      | 5025/9741 [00:14<00:12, 366.91it/s] 52%|███████████████████████████████████████████████████████████████████████████▉                                                                      | 5064/9741 [00:14<00:12, 371.61it/s] 52%|████████████████████████████████████████████████████████████████████████████▍                                                                     | 5103/9741 [00:14<00:12, 375.12it/s] 53%|█████████████████████████████████████████████████████████████████████████████                                                                     | 5142/9741 [00:14<00:12, 377.52it/s] 53%|█████████████████████████████████████████████████████████████████████████████▋                                                                    | 5181/9741 [00:14<00:12, 376.82it/s] 54%|██████████████████████████████████████████████████████████████████████████████▏                                                                   | 5220/9741 [00:14<00:11, 378.45it/s] 54%|██████████████████████████████████████████████████████████████████████████████▊                                                                   | 5259/9741 [00:14<00:11, 380.12it/s] 54%|███████████████████████████████████████████████████████████████████████████████▍                                                                  | 5298/9741 [00:14<00:11, 381.08it/s] 55%|███████████████████████████████████████████████████████████████████████████████▉                                                                  | 5337/9741 [00:14<00:11, 381.41it/s] 55%|████████████████████████████████████████████████████████████████████████████████▌                                                                 | 5376/9741 [00:15<00:11, 381.98it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▏                                                                | 5415/9741 [00:15<00:11, 379.39it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▋                                                                | 5454/9741 [00:15<00:11, 380.64it/s] 56%|██████████████████████████████████████████████████████████████████████████████████▎                                                               | 5493/9741 [00:15<00:11, 383.02it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▉                                                               | 5533/9741 [00:15<00:10, 386.77it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▌                                                              | 5573/9741 [00:15<00:10, 388.84it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▏                                                             | 5613/9741 [00:15<00:10, 390.60it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▋                                                             | 5653/9741 [00:15<00:10, 389.39it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████▎                                                            | 5693/9741 [00:15<00:10, 390.53it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▉                                                            | 5733/9741 [00:15<00:10, 392.38it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▌                                                           | 5773/9741 [00:16<00:10, 393.68it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▏                                                          | 5813/9741 [00:16<00:09, 394.65it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▋                                                          | 5853/9741 [00:16<00:09, 392.42it/s] 60%|████████████████████████████████████████████████████████████████████████████████████████▎                                                         | 5893/9741 [00:16<00:09, 393.81it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▉                                                         | 5933/9741 [00:16<00:09, 394.53it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▌                                                        | 5973/9741 [00:16<00:09, 395.23it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████                                                        | 6013/9741 [00:16<00:09, 395.07it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▋                                                       | 6053/9741 [00:16<00:09, 395.90it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▎                                                      | 6093/9741 [00:16<00:09, 393.34it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▉                                                      | 6133/9741 [00:17<00:09, 394.13it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▌                                                     | 6173/9741 [00:17<00:09, 394.70it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████                                                     | 6213/9741 [00:17<00:08, 395.02it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▋                                                    | 6253/9741 [00:17<00:08, 393.52it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▎                                                   | 6293/9741 [00:17<00:08, 393.89it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▉                                                   | 6333/9741 [00:17<00:08, 391.57it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▌                                                  | 6373/9741 [00:17<00:08, 393.15it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████                                                  | 6413/9741 [00:17<00:08, 393.84it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▋                                                 | 6453/9741 [00:17<00:08, 394.52it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▎                                                | 6493/9741 [00:17<00:08, 394.86it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▉                                                | 6533/9741 [00:18<00:08, 391.75it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▌                                               | 6573/9741 [00:18<00:08, 392.40it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████                                               | 6613/9741 [00:18<00:07, 393.29it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▋                                              | 6653/9741 [00:18<00:07, 394.27it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▎                                             | 6693/9741 [00:18<00:07, 394.93it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▉                                             | 6733/9741 [00:18<00:07, 394.94it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▌                                            | 6773/9741 [00:18<00:07, 392.57it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████                                            | 6813/9741 [00:18<00:07, 393.30it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▋                                           | 6853/9741 [00:18<00:07, 393.90it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▎                                          | 6893/9741 [00:18<00:07, 394.65it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▉                                          | 6933/9741 [00:19<00:07, 392.93it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                         | 6973/9741 [00:19<00:07, 393.74it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████                                         | 7013/9741 [00:19<00:06, 391.12it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                        | 7053/9741 [00:19<00:06, 392.51it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                       | 7093/9741 [00:19<00:06, 393.18it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                       | 7133/9741 [00:19<00:06, 393.83it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                      | 7173/9741 [00:19<00:06, 394.36it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████                                      | 7213/9741 [00:19<00:06, 391.85it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                     | 7253/9741 [00:19<00:06, 392.68it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                    | 7293/9741 [00:19<00:06, 393.52it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                    | 7333/9741 [00:20<00:06, 393.81it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                   | 7373/9741 [00:20<00:06, 394.34it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████                                   | 7413/9741 [00:20<00:05, 394.51it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                  | 7453/9741 [00:20<00:06, 362.71it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 7493/9741 [00:20<00:06, 372.03it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                 | 7533/9741 [00:20<00:05, 378.05it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                | 7573/9741 [00:20<00:05, 383.38it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                | 7613/9741 [00:20<00:05, 387.14it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                               | 7652/9741 [00:20<00:05, 374.13it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                              | 7691/9741 [00:21<00:05, 377.25it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                              | 7731/9741 [00:21<00:05, 383.07it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                             | 7771/9741 [00:21<00:05, 386.56it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                             | 7811/9741 [00:21<00:04, 389.00it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                            | 7851/9741 [00:21<00:04, 390.98it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                           | 7891/9741 [00:21<00:04, 392.41it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                           | 7931/9741 [00:21<00:04, 390.87it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                          | 7971/9741 [00:21<00:04, 392.38it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                          | 8011/9741 [00:21<00:04, 392.86it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                         | 8051/9741 [00:21<00:04, 393.50it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                        | 8091/9741 [00:22<00:04, 394.10it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                        | 8131/9741 [00:22<00:04, 392.21it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                       | 8171/9741 [00:22<00:03, 393.28it/s] 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                       | 8211/9741 [00:22<00:03, 394.22it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 8251/9741 [00:22<00:03, 394.48it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                     | 8291/9741 [00:22<00:03, 394.17it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                     | 8331/9741 [00:22<00:03, 394.51it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                    | 8371/9741 [00:22<00:03, 391.83it/s] 86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                    | 8411/9741 [00:22<00:03, 392.73it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 8451/9741 [00:22<00:03, 393.61it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                  | 8491/9741 [00:23<00:03, 394.26it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 8531/9741 [00:23<00:03, 394.47it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                 | 8571/9741 [00:23<00:02, 394.07it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                 | 8611/9741 [00:23<00:02, 391.38it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                | 8651/9741 [00:23<00:02, 392.48it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎               | 8691/9741 [00:23<00:02, 393.25it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊               | 8731/9741 [00:23<00:02, 394.00it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍              | 8771/9741 [00:23<00:02, 394.62it/s] 90%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████              | 8811/9741 [00:23<00:02, 391.62it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋             | 8851/9741 [00:23<00:02, 392.12it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎            | 8891/9741 [00:24<00:02, 390.39it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊            | 8931/9741 [00:24<00:02, 391.92it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍           | 8971/9741 [00:24<00:01, 392.95it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████           | 9011/9741 [00:24<00:01, 393.20it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋          | 9051/9741 [00:24<00:01, 390.80it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎         | 9091/9741 [00:24<00:01, 391.75it/s] 94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊         | 9131/9741 [00:24<00:01, 392.61it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍        | 9171/9741 [00:24<00:01, 393.12it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████        | 9211/9741 [00:24<00:01, 393.61it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋       | 9251/9741 [00:24<00:01, 393.93it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎      | 9291/9741 [00:25<00:01, 391.30it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊      | 9331/9741 [00:25<00:01, 392.08it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍     | 9371/9741 [00:25<00:00, 392.92it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 9411/9741 [00:25<00:00, 393.49it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋    | 9451/9741 [00:25<00:00, 393.47it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎   | 9491/9741 [00:25<00:00, 391.04it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊   | 9531/9741 [00:25<00:00, 391.79it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍  | 9571/9741 [00:25<00:00, 388.27it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████  | 9611/9741 [00:25<00:00, 389.75it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋ | 9651/9741 [00:26<00:00, 390.79it/s] 99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎| 9691/9741 [00:26<00:00, 392.09it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊| 9731/9741 [00:26<00:00, 388.44it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:26<00:00, 371.29it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.15s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.24s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.29s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.21s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.14s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.14s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.22s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.50s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.49s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]
[2023-08-11 08:13:35,493] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]
[2023-08-11 08:13:44,695] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 08:13:44,697] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 08:13:44,699] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 08:13:44,699] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 08:13:44,699] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 08:13:44,699] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 08:13:44,699] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fb89e8c8e80>
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 08:13:44,700] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fb89c9e7910>
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 08:13:44,701] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 08:13:44,702] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 08:13:44,702] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 08:13:44,702] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 08:13:44,702] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4871242046356201 seconds
Loading extension module utils...
Time to load utils op: 0.40439629554748535 seconds
Loading extension module utils...
Time to load utils op: 0.4047505855560303 seconds
Loading extension module utils...
Time to load utils op: 0.3043975830078125 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Rationales: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
#### 56
Answer: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Rationales: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
#### 4
Answer: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Rationales: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
#### 480
Answer: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Rationales: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
#### 30
Answer: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Rationales: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
#### 868
Answer: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Rationales: Stella and Twinkle filled up the truck at the rate of 250 blocks per hour per person, a total of 2*250 = <<250*2=500>>500 blocks per hour for both.
After working for four hours, Stella and Twinkle had filled 4*500 = <<4*500=2000>>2000 blocks into the truck.
The number of blocks they had to put into the truck for it to be full is 6000-2000 = <<6000-2000=4000>>4000
When 6 more people joined Stella and Twinkle, a total of 2+6 = <<2+6=8>>8 people were filling the truck now.
Working at the rate of 250 blocks per person, the eight people filled the truck with 250*8 = <<250*8=2000>>2000 blocks in one hour.
If there were 4000 blocks that still needed to be put into the truck, the 8 people took 4000/2000 = <<4000/2000=2>>2 hours to fill the truck with the blocks.
The total time it took to fill up the tank is 4+2 = <<4+2=6>>6 hours.
#### 6
Answer: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Rationales: Total drunk: 8.5 + 9.5 = <<8.5+9.5=18>>18 pints
18 pints * 2 = <<18*2=36>>36 cups
The two boys drank a total of 36 cups of liquid yesterday.
#### 36
Answer: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Rationales: Each carton has an area of 4*4*5 = <<4*4*5=80>>80 square inches.
Each shipping box has an area of 20*20*20 = <<20*20*20=8000>>8000 square inches
The total number of cartons that will fit into each box is 8000/80 = <<8000/80=100>>100
Since there are 3 widgets in each carton, the total number of cartons in each box will be 3*100 = <<3*100=300>>300
#### 300
Answer: 300

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o8-tgsm8k-s10-rTrue
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:40<32:40, 40.02s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:19<31:36, 39.51s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:00<31:30, 40.23s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:39<30:28, 39.75s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:20<30:13, 40.30s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:01<29:45, 40.57s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:42<29:11, 40.73s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:23<28:36, 40.87s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:04<27:54, 40.85s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [06:45<27:15, 40.90s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:26<26:39, 41.01s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:07<25:58, 41.01s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [08:49<25:17, 41.02s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:29<24:35, 40.99s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:07<23:14, 39.85s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [10:48<22:48, 40.26s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:29<22:13, 40.41s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [12:10<21:38, 40.59s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [12:50<21:00, 40.65s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [13:31<20:22, 40.75s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [14:13<19:49, 41.00s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [14:54<19:07, 40.98s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [15:35<18:26, 40.98s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [16:16<17:45, 40.98s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [16:57<17:05, 41.02s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [17:38<16:24, 41.02s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:19<15:44, 41.05s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:00<15:03, 41.07s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [19:41<14:21, 41.01s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [20:22<13:40, 41.02s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [21:03<13:00, 41.08s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [21:44<12:18, 41.06s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [22:26<11:38, 41.08s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [23:07<10:57, 41.08s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [23:46<10:10, 40.70s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [24:18<08:52, 38.06s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [24:59<08:26, 38.94s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [25:40<07:54, 39.51s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [26:21<07:19, 39.98s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [26:43<05:44, 34.40s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [27:23<05:27, 36.33s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [28:05<05:02, 37.75s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [28:45<04:30, 38.67s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [29:26<03:56, 39.37s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [30:07<03:19, 39.81s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [30:48<02:40, 40.17s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [31:29<02:01, 40.44s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [32:06<01:18, 39.48s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [32:47<00:39, 39.89s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [33:28<00:00, 40.23s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [33:28<00:00, 40.18s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.7424} | lm_loss nan | avg. gen lenth: 316.968
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s10-rTrue --seed 10 --rationales --num-out-domain 9
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 08:47:46,146] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o9-tgsm8k-s10-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 9
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o9-tgsm8k-s10-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                                                                                   | 23/9741 [00:00<00:42, 227.45it/s]  0%|▋                                                                                                                                                   | 46/9741 [00:00<00:42, 227.74it/s]  1%|█                                                                                                                                                   | 69/9741 [00:00<00:42, 228.06it/s]  1%|█▍                                                                                                                                                  | 92/9741 [00:00<00:42, 228.38it/s]  1%|█▋                                                                                                                                                 | 115/9741 [00:00<00:42, 228.63it/s]  1%|██                                                                                                                                                 | 138/9741 [00:00<00:41, 228.86it/s]  2%|██▍                                                                                                                                                | 161/9741 [00:00<00:42, 225.23it/s]  2%|██▊                                                                                                                                                | 184/9741 [00:00<00:42, 225.53it/s]  2%|███                                                                                                                                                | 207/9741 [00:00<00:42, 224.02it/s]  2%|███▍                                                                                                                                               | 230/9741 [00:01<00:42, 225.42it/s]  3%|███▊                                                                                                                                               | 253/9741 [00:01<00:41, 226.08it/s]  3%|████▏                                                                                                                                              | 276/9741 [00:01<00:41, 226.83it/s]  3%|████▌                                                                                                                                              | 299/9741 [00:01<00:41, 227.74it/s]  3%|████▊                                                                                                                                              | 322/9741 [00:01<00:41, 228.19it/s]  4%|█████▏                                                                                                                                             | 345/9741 [00:01<00:41, 228.26it/s]  4%|█████▌                                                                                                                                             | 368/9741 [00:01<00:41, 228.31it/s]  4%|█████▉                                                                                                                                             | 391/9741 [00:01<00:41, 226.93it/s]  4%|██████▏                                                                                                                                            | 414/9741 [00:01<00:41, 227.38it/s]  4%|██████▌                                                                                                                                            | 437/9741 [00:01<00:41, 225.43it/s]  5%|██████▉                                                                                                                                            | 460/9741 [00:02<00:40, 226.45it/s]  5%|███████▎                                                                                                                                           | 483/9741 [00:02<00:40, 227.00it/s]  5%|███████▋                                                                                                                                           | 510/9741 [00:02<00:38, 237.93it/s]  6%|████████▏                                                                                                                                          | 545/9741 [00:02<00:34, 270.16it/s]  6%|████████▊                                                                                                                                          | 580/9741 [00:02<00:31, 292.46it/s]  6%|█████████▎                                                                                                                                         | 615/9741 [00:02<00:29, 308.40it/s]  7%|█████████▊                                                                                                                                         | 650/9741 [00:02<00:28, 320.06it/s]  7%|██████████▎                                                                                                                                        | 684/9741 [00:02<00:27, 324.77it/s]  7%|██████████▊                                                                                                                                        | 719/9741 [00:02<00:27, 330.99it/s]  8%|███████████▍                                                                                                                                       | 754/9741 [00:02<00:26, 335.54it/s]  8%|███████████▉                                                                                                                                       | 789/9741 [00:03<00:26, 338.64it/s]  8%|████████████▍                                                                                                                                      | 824/9741 [00:03<00:26, 341.14it/s]  9%|████████████▉                                                                                                                                      | 859/9741 [00:03<00:25, 342.75it/s]  9%|█████████████▍                                                                                                                                     | 894/9741 [00:03<00:25, 341.14it/s] 10%|██████████████                                                                                                                                     | 929/9741 [00:03<00:25, 342.53it/s] 10%|██████████████▌                                                                                                                                    | 964/9741 [00:03<00:25, 343.30it/s] 10%|███████████████                                                                                                                                    | 999/9741 [00:03<00:25, 344.40it/s] 11%|███████████████▍                                                                                                                                  | 1034/9741 [00:03<00:25, 344.60it/s] 11%|████████████████                                                                                                                                  | 1069/9741 [00:03<00:25, 345.26it/s] 11%|████████████████▌                                                                                                                                 | 1104/9741 [00:03<00:24, 345.67it/s] 12%|█████████████████                                                                                                                                 | 1139/9741 [00:04<00:25, 343.10it/s] 12%|█████████████████▌                                                                                                                                | 1174/9741 [00:04<00:24, 344.22it/s] 12%|██████████████████                                                                                                                                | 1209/9741 [00:04<00:24, 344.64it/s] 13%|██████████████████▋                                                                                                                               | 1244/9741 [00:04<00:24, 342.28it/s] 13%|███████████████████▏                                                                                                                              | 1279/9741 [00:04<00:24, 343.00it/s] 13%|███████████████████▋                                                                                                                              | 1314/9741 [00:04<00:24, 343.39it/s] 14%|████████████████████▏                                                                                                                             | 1349/9741 [00:04<00:24, 340.90it/s] 14%|████████████████████▋                                                                                                                             | 1384/9741 [00:04<00:24, 341.80it/s] 15%|█████████████████████▎                                                                                                                            | 1419/9741 [00:04<00:24, 342.62it/s] 15%|█████████████████████▊                                                                                                                            | 1454/9741 [00:04<00:24, 343.02it/s] 15%|██████████████████████▎                                                                                                                           | 1489/9741 [00:05<00:24, 343.46it/s] 16%|██████████████████████▊                                                                                                                           | 1524/9741 [00:05<00:23, 343.63it/s] 16%|███████████████████████▎                                                                                                                          | 1559/9741 [00:05<00:23, 343.86it/s] 16%|███████████████████████▉                                                                                                                          | 1594/9741 [00:05<00:23, 341.21it/s] 17%|████████████████████████▍                                                                                                                         | 1629/9741 [00:05<00:23, 342.22it/s] 17%|████████████████████████▉                                                                                                                         | 1664/9741 [00:05<00:23, 339.95it/s] 17%|█████████████████████████▍                                                                                                                        | 1699/9741 [00:05<00:23, 341.20it/s] 18%|█████████████████████████▉                                                                                                                        | 1734/9741 [00:05<00:23, 342.58it/s] 18%|██████████████████████████▌                                                                                                                       | 1769/9741 [00:05<00:23, 343.20it/s] 19%|███████████████████████████                                                                                                                       | 1804/9741 [00:06<00:25, 315.57it/s] 19%|███████████████████████████▌                                                                                                                      | 1839/9741 [00:06<00:24, 323.18it/s] 19%|████████████████████████████                                                                                                                      | 1874/9741 [00:06<00:23, 329.04it/s] 20%|████████████████████████████▌                                                                                                                     | 1909/9741 [00:06<00:23, 333.75it/s] 20%|█████████████████████████████▏                                                                                                                    | 1944/9741 [00:06<00:23, 336.55it/s] 20%|█████████████████████████████▋                                                                                                                    | 1979/9741 [00:06<00:22, 338.85it/s] 21%|██████████████████████████████▏                                                                                                                   | 2014/9741 [00:06<00:22, 340.39it/s] 21%|██████████████████████████████▋                                                                                                                   | 2049/9741 [00:06<00:22, 339.13it/s] 21%|███████████████████████████████▏                                                                                                                  | 2084/9741 [00:06<00:22, 341.10it/s] 22%|███████████████████████████████▊                                                                                                                  | 2119/9741 [00:06<00:22, 339.54it/s] 22%|████████████████████████████████▎                                                                                                                 | 2154/9741 [00:07<00:22, 341.89it/s] 22%|████████████████████████████████▊                                                                                                                 | 2189/9741 [00:07<00:21, 343.44it/s] 23%|█████████████████████████████████▎                                                                                                                | 2224/9741 [00:07<00:21, 344.68it/s] 23%|█████████████████████████████████▊                                                                                                                | 2259/9741 [00:07<00:21, 341.32it/s] 24%|██████████████████████████████████▍                                                                                                               | 2294/9741 [00:07<00:21, 342.79it/s] 24%|██████████████████████████████████▉                                                                                                               | 2329/9741 [00:07<00:21, 343.76it/s] 24%|███████████████████████████████████▍                                                                                                              | 2364/9741 [00:07<00:21, 344.91it/s] 25%|███████████████████████████████████▉                                                                                                              | 2399/9741 [00:07<00:21, 345.73it/s] 25%|████████████████████████████████████▍                                                                                                             | 2434/9741 [00:07<00:21, 346.55it/s] 25%|█████████████████████████████████████                                                                                                             | 2469/9741 [00:07<00:20, 347.04it/s] 26%|█████████████████████████████████████▌                                                                                                            | 2504/9741 [00:08<00:21, 344.00it/s] 26%|██████████████████████████████████████                                                                                                            | 2539/9741 [00:08<00:20, 344.86it/s] 26%|██████████████████████████████████████▌                                                                                                           | 2574/9741 [00:08<00:20, 344.20it/s] 27%|███████████████████████████████████████                                                                                                           | 2609/9741 [00:08<00:20, 344.78it/s] 27%|███████████████████████████████████████▋                                                                                                          | 2644/9741 [00:08<00:20, 345.03it/s] 28%|████████████████████████████████████████▏                                                                                                         | 2679/9741 [00:08<00:20, 345.40it/s] 28%|████████████████████████████████████████▋                                                                                                         | 2714/9741 [00:08<00:20, 342.72it/s] 28%|█████████████████████████████████████████▏                                                                                                        | 2749/9741 [00:08<00:20, 343.78it/s] 29%|█████████████████████████████████████████▋                                                                                                        | 2784/9741 [00:08<00:20, 344.39it/s] 29%|██████████████████████████████████████████▎                                                                                                       | 2819/9741 [00:08<00:20, 344.81it/s] 29%|██████████████████████████████████████████▊                                                                                                       | 2854/9741 [00:09<00:19, 345.51it/s] 30%|███████████████████████████████████████████▎                                                                                                      | 2889/9741 [00:09<00:19, 345.88it/s] 30%|███████████████████████████████████████████▊                                                                                                      | 2924/9741 [00:09<00:19, 343.28it/s] 30%|████████████████████████████████████████████▎                                                                                                     | 2959/9741 [00:09<00:19, 343.87it/s] 31%|████████████████████████████████████████████▊                                                                                                     | 2994/9741 [00:09<00:19, 344.92it/s] 31%|█████████████████████████████████████████████▍                                                                                                    | 3029/9741 [00:09<00:19, 345.36it/s] 31%|█████████████████████████████████████████████▉                                                                                                    | 3064/9741 [00:09<00:19, 344.70it/s] 32%|██████████████████████████████████████████████▍                                                                                                   | 3099/9741 [00:09<00:19, 345.18it/s] 32%|██████████████████████████████████████████████▉                                                                                                   | 3134/9741 [00:09<00:19, 345.67it/s] 33%|███████████████████████████████████████████████▍                                                                                                  | 3169/9741 [00:09<00:19, 343.01it/s] 33%|████████████████████████████████████████████████                                                                                                  | 3204/9741 [00:10<00:18, 344.11it/s] 33%|████████████████████████████████████████████████▌                                                                                                 | 3239/9741 [00:10<00:18, 344.57it/s] 34%|█████████████████████████████████████████████████                                                                                                 | 3274/9741 [00:10<00:18, 345.14it/s] 34%|█████████████████████████████████████████████████▌                                                                                                | 3309/9741 [00:10<00:18, 345.42it/s] 34%|██████████████████████████████████████████████████                                                                                                | 3344/9741 [00:10<00:18, 345.33it/s] 35%|██████████████████████████████████████████████████▋                                                                                               | 3379/9741 [00:10<00:18, 342.62it/s] 35%|███████████████████████████████████████████████████▏                                                                                              | 3414/9741 [00:10<00:18, 343.73it/s] 35%|███████████████████████████████████████████████████▋                                                                                              | 3449/9741 [00:10<00:18, 344.31it/s] 36%|████████████████████████████████████████████████████▏                                                                                             | 3484/9741 [00:10<00:18, 344.85it/s] 36%|████████████████████████████████████████████████████▋                                                                                             | 3519/9741 [00:11<00:18, 344.96it/s] 36%|█████████████████████████████████████████████████████▎                                                                                            | 3554/9741 [00:11<00:17, 345.21it/s] 37%|█████████████████████████████████████████████████████▊                                                                                            | 3589/9741 [00:11<00:17, 345.22it/s] 37%|██████████████████████████████████████████████████████▎                                                                                           | 3624/9741 [00:11<00:17, 342.46it/s] 38%|██████████████████████████████████████████████████████▊                                                                                           | 3659/9741 [00:11<00:17, 343.32it/s] 38%|███████████████████████████████████████████████████████▎                                                                                          | 3694/9741 [00:11<00:17, 344.14it/s] 38%|███████████████████████████████████████████████████████▉                                                                                          | 3729/9741 [00:11<00:17, 344.80it/s] 39%|████████████████████████████████████████████████████████▍                                                                                         | 3764/9741 [00:11<00:17, 345.09it/s] 39%|████████████████████████████████████████████████████████▉                                                                                         | 3799/9741 [00:11<00:17, 345.20it/s] 39%|█████████████████████████████████████████████████████████▍                                                                                        | 3834/9741 [00:11<00:17, 342.75it/s] 40%|█████████████████████████████████████████████████████████▉                                                                                        | 3869/9741 [00:12<00:17, 343.66it/s] 40%|██████████████████████████████████████████████████████████▌                                                                                       | 3904/9741 [00:12<00:16, 344.31it/s] 40%|███████████████████████████████████████████████████████████                                                                                       | 3939/9741 [00:12<00:16, 344.48it/s] 41%|███████████████████████████████████████████████████████████▌                                                                                      | 3974/9741 [00:12<00:16, 344.36it/s] 41%|████████████████████████████████████████████████████████████                                                                                      | 4009/9741 [00:12<00:16, 344.20it/s] 42%|████████████████████████████████████████████████████████████▌                                                                                     | 4044/9741 [00:12<00:16, 343.82it/s] 42%|█████████████████████████████████████████████████████████████▏                                                                                    | 4079/9741 [00:12<00:16, 341.07it/s] 42%|█████████████████████████████████████████████████████████████▋                                                                                    | 4114/9741 [00:12<00:16, 341.61it/s] 43%|██████████████████████████████████████████████████████████████▏                                                                                   | 4149/9741 [00:12<00:16, 341.98it/s] 43%|██████████████████████████████████████████████████████████████▋                                                                                   | 4184/9741 [00:12<00:16, 342.13it/s] 43%|███████████████████████████████████████████████████████████████▏                                                                                  | 4219/9741 [00:13<00:16, 342.17it/s] 44%|███████████████████████████████████████████████████████████████▊                                                                                  | 4254/9741 [00:13<00:15, 343.02it/s] 44%|████████████████████████████████████████████████████████████████▎                                                                                 | 4289/9741 [00:13<00:15, 340.86it/s] 44%|████████████████████████████████████████████████████████████████▊                                                                                 | 4324/9741 [00:13<00:15, 340.25it/s] 45%|█████████████████████████████████████████████████████████████████▎                                                                                | 4359/9741 [00:13<00:15, 341.32it/s] 45%|█████████████████████████████████████████████████████████████████▊                                                                                | 4394/9741 [00:13<00:15, 342.34it/s] 45%|██████████████████████████████████████████████████████████████████▍                                                                               | 4429/9741 [00:13<00:15, 342.87it/s] 46%|██████████████████████████████████████████████████████████████████▉                                                                               | 4464/9741 [00:13<00:15, 343.27it/s] 46%|███████████████████████████████████████████████████████████████████▍                                                                              | 4499/9741 [00:13<00:15, 343.32it/s] 47%|███████████████████████████████████████████████████████████████████▉                                                                              | 4534/9741 [00:14<00:16, 308.24it/s] 47%|████████████████████████████████████████████████████████████████████▍                                                                             | 4569/9741 [00:14<00:16, 317.94it/s] 47%|█████████████████████████████████████████████████████████████████████                                                                             | 4604/9741 [00:14<00:15, 325.24it/s] 48%|█████████████████████████████████████████████████████████████████████▌                                                                            | 4639/9741 [00:14<00:15, 330.58it/s] 48%|██████████████████████████████████████████████████████████████████████                                                                            | 4674/9741 [00:14<00:15, 334.49it/s] 48%|██████████████████████████████████████████████████████████████████████▌                                                                           | 4709/9741 [00:14<00:14, 337.23it/s] 49%|███████████████████████████████████████████████████████████████████████                                                                           | 4743/9741 [00:14<00:20, 242.06it/s] 49%|███████████████████████████████████████████████████████████████████████▌                                                                          | 4778/9741 [00:14<00:18, 265.17it/s] 49%|████████████████████████████████████████████████████████████████████████▏                                                                         | 4813/9741 [00:14<00:17, 284.50it/s] 50%|████████████████████████████████████████████████████████████████████████▋                                                                         | 4847/9741 [00:15<00:16, 298.61it/s] 50%|█████████████████████████████████████████████████████████████████████████▏                                                                        | 4881/9741 [00:15<00:15, 309.70it/s] 50%|█████████████████████████████████████████████████████████████████████████▋                                                                        | 4915/9741 [00:15<00:15, 318.12it/s] 51%|██████████████████████████████████████████████████████████████████████████▏                                                                       | 4949/9741 [00:15<00:14, 322.06it/s] 51%|██████████████████████████████████████████████████████████████████████████▋                                                                       | 4983/9741 [00:15<00:14, 327.09it/s] 52%|███████████████████████████████████████████████████████████████████████████▏                                                                      | 5017/9741 [00:15<00:14, 330.57it/s] 52%|███████████████████████████████████████████████████████████████████████████▋                                                                      | 5051/9741 [00:15<00:14, 333.18it/s] 52%|████████████████████████████████████████████████████████████████████████████▏                                                                     | 5085/9741 [00:15<00:13, 335.09it/s] 53%|████████████████████████████████████████████████████████████████████████████▋                                                                     | 5120/9741 [00:15<00:13, 336.99it/s] 53%|█████████████████████████████████████████████████████████████████████████████▎                                                                    | 5155/9741 [00:15<00:13, 338.31it/s] 53%|█████████████████████████████████████████████████████████████████████████████▊                                                                    | 5189/9741 [00:16<00:13, 335.88it/s] 54%|██████████████████████████████████████████████████████████████████████████████▎                                                                   | 5223/9741 [00:16<00:13, 336.87it/s] 54%|██████████████████████████████████████████████████████████████████████████████▊                                                                   | 5258/9741 [00:16<00:13, 338.24it/s] 54%|███████████████████████████████████████████████████████████████████████████████▎                                                                  | 5293/9741 [00:16<00:13, 338.83it/s] 55%|███████████████████████████████████████████████████████████████████████████████▊                                                                  | 5328/9741 [00:16<00:12, 339.49it/s] 55%|████████████████████████████████████████████████████████████████████████████████▎                                                                 | 5362/9741 [00:16<00:12, 339.52it/s] 55%|████████████████████████████████████████████████████████████████████████████████▉                                                                 | 5396/9741 [00:16<00:12, 338.03it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▍                                                                | 5430/9741 [00:16<00:12, 335.34it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▉                                                                | 5465/9741 [00:16<00:12, 336.87it/s] 56%|██████████████████████████████████████████████████████████████████████████████████▍                                                               | 5500/9741 [00:16<00:12, 340.12it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▉                                                               | 5535/9741 [00:17<00:12, 342.94it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▍                                                              | 5571/9741 [00:17<00:12, 345.24it/s] 58%|████████████████████████████████████████████████████████████████████████████████████                                                              | 5606/9741 [00:17<00:11, 346.08it/s] 58%|████████████████████████████████████████████████████████████████████████████████████▌                                                             | 5641/9741 [00:17<00:11, 344.37it/s] 58%|█████████████████████████████████████████████████████████████████████████████████████                                                             | 5676/9741 [00:17<00:11, 345.89it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▌                                                            | 5711/9741 [00:17<00:11, 346.77it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▏                                                           | 5747/9741 [00:17<00:11, 347.92it/s] 59%|██████████████████████████████████████████████████████████████████████████████████████▋                                                           | 5783/9741 [00:17<00:11, 349.18it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▏                                                          | 5819/9741 [00:17<00:11, 349.89it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▋                                                          | 5854/9741 [00:18<00:11, 347.30it/s] 60%|████████████████████████████████████████████████████████████████████████████████████████▎                                                         | 5890/9741 [00:18<00:11, 348.43it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████▊                                                         | 5926/9741 [00:18<00:10, 349.22it/s] 61%|█████████████████████████████████████████████████████████████████████████████████████████▎                                                        | 5962/9741 [00:18<00:10, 350.11it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▉                                                        | 5998/9741 [00:18<00:10, 347.25it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▍                                                       | 6034/9741 [00:18<00:10, 348.43it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▉                                                       | 6070/9741 [00:18<00:10, 349.43it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▌                                                      | 6105/9741 [00:18<00:10, 347.42it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████                                                      | 6140/9741 [00:18<00:10, 348.10it/s] 63%|████████████████████████████████████████████████████████████████████████████████████████████▌                                                     | 6176/9741 [00:18<00:10, 349.10it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████                                                     | 6212/9741 [00:19<00:10, 349.75it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████▋                                                    | 6247/9741 [00:19<00:09, 349.63it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▏                                                   | 6283/9741 [00:19<00:09, 349.93it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▋                                                   | 6318/9741 [00:19<00:09, 347.59it/s] 65%|███████████████████████████████████████████████████████████████████████████████████████████████▏                                                  | 6354/9741 [00:19<00:09, 348.35it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▊                                                  | 6390/9741 [00:19<00:09, 348.92it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▎                                                 | 6426/9741 [00:19<00:09, 349.39it/s] 66%|████████████████████████████████████████████████████████████████████████████████████████████████▊                                                 | 6461/9741 [00:19<00:09, 349.17it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▍                                                | 6497/9741 [00:19<00:09, 349.65it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▉                                                | 6532/9741 [00:19<00:09, 346.92it/s] 67%|██████████████████████████████████████████████████████████████████████████████████████████████████▍                                               | 6567/9741 [00:20<00:09, 347.74it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                                               | 6602/9741 [00:20<00:09, 345.47it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▍                                              | 6638/9741 [00:20<00:08, 347.30it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████                                              | 6674/9741 [00:20<00:08, 348.53it/s] 69%|████████████████████████████████████████████████████████████████████████████████████████████████████▌                                             | 6710/9741 [00:20<00:08, 349.06it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████                                             | 6746/9741 [00:20<00:08, 349.90it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                                            | 6781/9741 [00:20<00:08, 347.55it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▏                                           | 6816/9741 [00:20<00:08, 348.25it/s] 70%|██████████████████████████████████████████████████████████████████████████████████████████████████████▋                                           | 6852/9741 [00:20<00:08, 348.97it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▏                                          | 6888/9741 [00:20<00:08, 349.61it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▊                                          | 6924/9741 [00:21<00:08, 350.17it/s] 71%|████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                         | 6960/9741 [00:21<00:07, 349.97it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                         | 6995/9741 [00:21<00:07, 347.53it/s] 72%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                        | 7031/9741 [00:21<00:07, 348.35it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                        | 7067/9741 [00:21<00:07, 349.19it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                       | 7103/9741 [00:21<00:07, 349.46it/s] 73%|███████████████████████████████████████████████████████████████████████████████████████████████████████████                                       | 7139/9741 [00:21<00:07, 349.75it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                      | 7174/9741 [00:21<00:07, 346.44it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████                                      | 7209/9741 [00:21<00:07, 347.11it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                     | 7244/9741 [00:21<00:07, 343.14it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████                                     | 7279/9741 [00:22<00:07, 345.13it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                    | 7314/9741 [00:22<00:07, 346.40it/s] 75%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                   | 7350/9741 [00:22<00:06, 347.61it/s] 76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                   | 7386/9741 [00:22<00:06, 348.35it/s] 76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                  | 7421/9741 [00:22<00:06, 348.50it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                  | 7456/9741 [00:22<00:07, 305.15it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 7491/9741 [00:22<00:07, 317.02it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                 | 7526/9741 [00:22<00:06, 325.80it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                | 7561/9741 [00:22<00:06, 332.12it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                | 7596/9741 [00:23<00:06, 336.91it/s] 78%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                               | 7631/9741 [00:23<00:06, 340.54it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                               | 7666/9741 [00:23<00:06, 338.31it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                              | 7701/9741 [00:23<00:05, 341.52it/s] 79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                              | 7737/9741 [00:23<00:05, 344.49it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                             | 7772/9741 [00:23<00:05, 343.58it/s] 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                             | 7808/9741 [00:23<00:05, 345.60it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                            | 7844/9741 [00:23<00:05, 347.14it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                            | 7879/9741 [00:23<00:05, 347.81it/s] 81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                           | 7914/9741 [00:23<00:05, 345.55it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                          | 7949/9741 [00:24<00:05, 346.61it/s] 82%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                          | 7984/9741 [00:24<00:05, 347.27it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                         | 8019/9741 [00:24<00:04, 347.91it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                         | 8054/9741 [00:24<00:04, 347.91it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 8089/9741 [00:24<00:04, 348.33it/s] 83%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                        | 8124/9741 [00:24<00:04, 346.16it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                       | 8159/9741 [00:24<00:04, 346.82it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                       | 8194/9741 [00:24<00:04, 347.63it/s] 84%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                      | 8229/9741 [00:24<00:04, 348.07it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                      | 8265/9741 [00:24<00:04, 348.70it/s] 85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                     | 8300/9741 [00:25<00:04, 348.68it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                     | 8335/9741 [00:25<00:04, 345.60it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                    | 8370/9741 [00:25<00:03, 343.61it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                    | 8405/9741 [00:25<00:03, 345.15it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                   | 8441/9741 [00:25<00:03, 346.94it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                   | 8476/9741 [00:25<00:03, 347.71it/s] 87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                  | 8512/9741 [00:25<00:03, 348.51it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                  | 8547/9741 [00:25<00:03, 348.63it/s] 88%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 8582/9741 [00:25<00:03, 345.77it/s] 88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                | 8617/9741 [00:25<00:03, 346.36it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                | 8652/9741 [00:26<00:03, 347.16it/s] 89%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏               | 8687/9741 [00:26<00:03, 347.44it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋               | 8722/9741 [00:26<00:02, 347.84it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎              | 8757/9741 [00:26<00:02, 348.00it/s] 90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊              | 8792/9741 [00:26<00:02, 348.09it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎             | 8827/9741 [00:26<00:02, 345.34it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 8862/9741 [00:26<00:02, 346.19it/s] 91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎            | 8897/9741 [00:26<00:02, 347.16it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊            | 8932/9741 [00:26<00:02, 347.98it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍           | 8967/9741 [00:26<00:02, 348.33it/s] 92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉           | 9002/9741 [00:27<00:02, 348.49it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍          | 9037/9741 [00:27<00:02, 345.58it/s] 93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉          | 9072/9741 [00:27<00:01, 346.39it/s] 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍         | 9107/9741 [00:27<00:01, 344.91it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████         | 9142/9741 [00:27<00:01, 345.50it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌        | 9177/9741 [00:27<00:01, 346.44it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████        | 9212/9741 [00:27<00:01, 346.74it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 9247/9741 [00:27<00:01, 347.35it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████       | 9282/9741 [00:27<00:01, 344.78it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋      | 9317/9741 [00:28<00:01, 345.98it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏     | 9352/9741 [00:28<00:01, 346.94it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋     | 9387/9741 [00:28<00:01, 347.64it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏    | 9422/9741 [00:28<00:00, 348.16it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋    | 9457/9741 [00:28<00:00, 348.02it/s] 97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎   | 9492/9741 [00:28<00:00, 345.50it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊   | 9527/9741 [00:28<00:00, 346.19it/s] 98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎  | 9562/9741 [00:28<00:00, 346.99it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊  | 9597/9741 [00:28<00:00, 347.40it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎ | 9632/9741 [00:28<00:00, 347.29it/s] 99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉ | 9667/9741 [00:29<00:00, 347.29it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍| 9702/9741 [00:29<00:00, 346.80it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉| 9737/9741 [00:29<00:00, 343.59it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:29<00:00, 333.19it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.37s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.04s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.01s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:06<00:13,  6.85s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.24s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.42s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.60s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.38s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.56s/it]
[2023-08-11 08:49:06,701] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.61s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:13<00:06,  7.00s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:18<00:00,  6.02s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:18<00:00,  6.27s/it]
[2023-08-11 08:49:27,231] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 08:49:27,232] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 08:49:27,232] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 08:49:27,232] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 08:49:27,232] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 08:49:27,232] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f5956c5de80>
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 08:49:27,233] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f5955634910>
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 08:49:27,234] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 08:49:27,235] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 08:49:27,235] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 08:49:27,235] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 08:49:27,235] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5041670799255371 seconds
Time to load utils op: 0.5045528411865234 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]Loading extension module utils...
############### Example ###############
Time to load utils op: 0.504643440246582 seconds
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Rationales: For the nuts Adam paid 3 * $12 = $<<3*12=36>>36.
And for dried fruits Adam paid 2.5 * $8 = $<<2.5*8=20>>20.
So in total for his purchases Adam paid $36 + $20 = $<<36+20=56>>56.
#### 56
Answer: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Rationales: He spends 60/3=<<60/3=20>>20 minutes warming up
So he spends 60+20=<<60+20=80>>80 minutes at the gym per day
That means he spends 80*3=<<80*3=240>>240 minutes at the gym
So he spends 240/60=<<240/60=4>>4 hours at the gym a week
#### 4
Answer: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Rationales: The cost to fill a tank went up 200*.2=$<<200*.2=40>>40
So it cost 200+40=$<<200+40=240>>240 to fill the tank
That means he now pays 240*2=$<<240*2=480>>480
#### 480
Answer: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Rationales: If the total number of goals scored in the league that season against Barca is 300, the two players scored 20/100*300=<<300*20/100=60>>60 goals.
If the players scored an equal number of goals, each scored 60/2=<<60/2=30>>30 goals.
#### 30
Answer: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Rationales: He drinks 12 * 5 = <<12*5=60>>60 ounces of soda a day
So he drinks 60 + 64 = <<60+64=124>>124 ounces of liquid a day
So in total he drinks 124 * 7 = <<124*7=868>>868 ounces of liquid a week
#### 868
Answer: 868

Input: Stella and Twinkle are filling up a truck with a capacity of 6000 stone blocks at the rate of 250 blocks per hour per person. They work for four hours and are then joined by 6 other people who also work at the same rate. How many hours did filling the truck take?
Rationales: Stella and Twinkle filled up the truck at the rate of 250 blocks per hour per person, a total of 2*250 = <<250*2=500>>500 blocks per hour for both.
After working for four hours, Stella and Twinkle had filled 4*500 = <<4*500=2000>>2000 blocks into the truck.
The number of blocks they had to put into the truck for it to be full is 6000-2000 = <<6000-2000=4000>>4000
When 6 more people joined Stella and Twinkle, a total of 2+6 = <<2+6=8>>8 people were filling the truck now.
Working at the rate of 250 blocks per person, the eight people filled the truck with 250*8 = <<250*8=2000>>2000 blocks in one hour.
If there were 4000 blocks that still needed to be put into the truck, the 8 people took 4000/2000 = <<4000/2000=2>>2 hours to fill the truck with the blocks.
The total time it took to fill up the tank is 4+2 = <<4+2=6>>6 hours.
#### 6
Answer: 6

Input: Elijah drank 8.5 pints of coffee yesterday. Emilio drank 9.5 pints of water yesterday. How many cups of liquid did the two boys drink yesterday?
Rationales: Total drunk: 8.5 + 9.5 = <<8.5+9.5=18>>18 pints
18 pints * 2 = <<18*2=36>>36 cups
The two boys drank a total of 36 cups of liquid yesterday.
#### 36
Answer: 36

Input: Doris works at the Widget Factory in the packing department. She puts 3 widgets in each carton, which are 4 inches wide, 4 inches long, and 5 inches tall. She then packs those cartons into a shipping box before sending it to the loading bay. The shipping boxes are 20 inches wide, 20 inches long, and 20 inches high. How many widgets get shipped in each shipping box?
Rationales: Each carton has an area of 4*4*5 = <<4*4*5=80>>80 square inches.
Each shipping box has an area of 20*20*20 = <<20*20*20=8000>>8000 square inches
The total number of cartons that will fit into each box is 8000/80 = <<8000/80=100>>100
Since there are 3 widgets in each carton, the total number of cartons in each box will be 3*100 = <<3*100=300>>300
#### 300
Answer: 300

Input: Queenie earns $150 a day as a part-time clerk. She earns an additional $5 per hour as overtime pay. How much will Queenie receive for working 5 days with 4 hours overtime?
Rationales: Queenie will earn $150 x 5 = $<<150*5=750>>750 for working 5 days.
She will receive an additional $5 x 4 = $<<5*4=20>>20 for overtime pay.
Hence, Queenie will receive a total of $750 + $20 = $<<750+20=770>>770.
#### 770
Answer: 770

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o9-tgsm8k-s10-rTrue
Loading extension module utils...
Time to load utils op: 0.5052928924560547 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:41<34:05, 41.75s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:22<32:57, 41.19s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:03<32:11, 41.10s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [02:44<31:23, 40.94s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [03:25<30:40, 40.89s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:05<29:58, 40.88s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [04:46<29:17, 40.87s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:27<28:34, 40.81s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:08<27:52, 40.80s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [06:48<27:10, 40.77s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:29<26:30, 40.78s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:10<25:50, 40.81s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [08:51<25:10, 40.82s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:32<24:29, 40.81s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [10:12<23:47, 40.80s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [10:53<23:07, 40.81s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [11:34<22:25, 40.77s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [12:15<21:43, 40.75s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [12:55<21:01, 40.68s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [13:36<20:22, 40.74s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [14:17<19:41, 40.73s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [14:46<17:23, 37.27s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [15:27<17:14, 38.31s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [15:52<14:52, 34.33s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [16:33<15:07, 36.28s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [17:14<15:03, 37.66s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [17:55<14:49, 38.68s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [18:36<14:26, 39.39s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [19:17<14:01, 40.05s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [19:43<11:56, 35.83s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [20:24<11:50, 37.39s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [21:05<11:32, 38.47s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [21:46<11:06, 39.21s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [22:27<10:36, 39.76s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [23:08<10:01, 40.10s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [23:49<09:25, 40.41s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [24:30<08:48, 40.64s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [25:11<08:08, 40.74s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [25:52<07:29, 40.84s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [26:33<06:48, 40.86s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [27:14<06:07, 40.86s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [27:55<05:27, 40.95s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [28:36<04:46, 40.90s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [29:17<04:05, 40.93s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [29:58<03:24, 40.93s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [30:39<02:43, 40.95s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [31:20<02:02, 40.98s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [32:01<01:22, 41.04s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [32:42<00:41, 41.02s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [33:23<00:00, 41.02s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [33:23<00:00, 40.08s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 2.9451} | lm_loss 7.8203 | avg. gen lenth: 330.24
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s10-rFalse --seed 10 --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 09:22:59,619] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  2%|███▎                                                                                                                                              | 223/9741 [00:00<00:04, 2224.75it/s]  5%|██████▋                                                                                                                                           | 449/9741 [00:00<00:04, 2240.54it/s]  7%|██████████                                                                                                                                        | 675/9741 [00:00<00:04, 2248.00it/s]  9%|█████████████▌                                                                                                                                    | 903/9741 [00:00<00:03, 2260.41it/s] 12%|████████████████▊                                                                                                                                | 1132/9741 [00:00<00:03, 2270.06it/s] 14%|████████████████████▏                                                                                                                            | 1360/9741 [00:00<00:03, 2269.54it/s] 16%|███████████████████████▋                                                                                                                         | 1588/9741 [00:00<00:03, 2269.95it/s] 19%|███████████████████████████                                                                                                                      | 1815/9741 [00:00<00:03, 2255.45it/s] 21%|██████████████████████████████▍                                                                                                                  | 2041/9741 [00:00<00:03, 2256.42it/s] 23%|█████████████████████████████████▋                                                                                                               | 2267/9741 [00:01<00:03, 2207.38it/s] 26%|█████████████████████████████████████                                                                                                            | 2493/9741 [00:01<00:03, 2220.86it/s] 28%|████████████████████████████████████████▍                                                                                                        | 2718/9741 [00:01<00:03, 2229.56it/s] 30%|███████████████████████████████████████████▊                                                                                                     | 2944/9741 [00:01<00:03, 2237.73it/s] 33%|███████████████████████████████████████████████▏                                                                                                 | 3171/9741 [00:01<00:02, 2245.06it/s] 35%|██████████████████████████████████████████████████▌                                                                                              | 3398/9741 [00:01<00:02, 2252.40it/s] 37%|█████████████████████████████████████████████████████▉                                                                                           | 3624/9741 [00:01<00:02, 2251.01it/s] 40%|█████████████████████████████████████████████████████████▎                                                                                       | 3851/9741 [00:01<00:02, 2256.16it/s] 42%|████████████████████████████████████████████████████████████▋                                                                                    | 4078/9741 [00:01<00:02, 2257.84it/s] 44%|████████████████████████████████████████████████████████████████                                                                                 | 4304/9741 [00:01<00:02, 2256.90it/s] 47%|███████████████████████████████████████████████████████████████████▍                                                                             | 4530/9741 [00:02<00:02, 2217.38it/s] 49%|██████████████████████████████████████████████████████████████████████▋                                                                          | 4752/9741 [00:02<00:03, 1637.65it/s] 51%|██████████████████████████████████████████████████████████████████████████                                                                       | 4977/9741 [00:02<00:02, 1782.85it/s] 53%|█████████████████████████████████████████████████████████████████████████████▍                                                                   | 5203/9741 [00:02<00:02, 1903.03it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▏                                                               | 5455/9741 [00:02<00:02, 2066.88it/s] 60%|██████████████████████████████████████████████████████████████████████████████████████▌                                                          | 5815/9741 [00:02<00:01, 2487.81it/s] 63%|███████████████████████████████████████████████████████████████████████████████████████████▉                                                     | 6176/9741 [00:02<00:01, 2803.50it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▎                                               | 6535/9741 [00:02<00:01, 3027.07it/s] 71%|██████████████████████████████████████████████████████████████████████████████████████████████████████▋                                          | 6899/9741 [00:02<00:00, 3203.21it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████                                     | 7262/9741 [00:03<00:00, 3326.77it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                               | 7612/9741 [00:03<00:00, 3376.13it/s] 82%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                          | 7974/9741 [00:03<00:00, 3448.01it/s] 86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                     | 8338/9741 [00:03<00:00, 3505.09it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌               | 8700/9741 [00:03<00:00, 3538.25it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉          | 9062/9741 [00:03<00:00, 3559.74it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎    | 9424/9741 [00:03<00:00, 3577.33it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:03<00:00, 2611.78it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.29s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.36s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.48s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:06<00:12,  6.01s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.41s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.50s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.67s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.86s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.90s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.99s/it]
[2023-08-11 09:23:55,622] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.90s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.14s/it]
[2023-08-11 09:24:08,106] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 09:24:08,107] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fd7fc51ce80>
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 09:24:08,108] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fd7ff03a910>
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 09:24:08,109] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 09:24:08,109] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3492872714996338 seconds
Loading extension module utils...
Time to load utils op: 0.4045908451080322 seconds
Loading extension module utils...
Time to load utils op: 0.40447020530700684 seconds
Loading extension module utils...
Time to load utils op: 0.40445613861083984 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Answer: 56

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s10-rFalse
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:57<46:58, 57.52s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:55<46:19, 57.91s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:53<45:15, 57.79s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:51<44:16, 57.76s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:25<37:01, 49.36s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [05:13<35:49, 48.85s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:59<34:28, 48.11s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [06:12<25:47, 36.84s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:11<29:51, 43.70s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:50<28:04, 42.12s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [08:48<30:33, 47.02s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [09:23<27:35, 43.58s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [10:08<27:08, 44.02s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [10:52<26:25, 44.03s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [11:50<28:00, 48.01s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [12:49<29:03, 51.29s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [13:12<23:30, 42.75s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [13:49<21:58, 41.21s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [14:00<16:33, 32.06s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [14:58<19:55, 39.85s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [15:46<20:30, 42.44s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [16:28<19:37, 42.06s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [17:09<18:50, 41.86s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [18:07<20:16, 46.81s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [19:05<20:54, 50.16s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [19:56<20:04, 50.19s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [20:54<20:08, 52.53s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:14<15:45, 42.98s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [22:00<15:21, 43.88s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [22:26<12:46, 38.31s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [22:46<10:27, 33.02s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [23:19<09:54, 33.05s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:58<09:48, 34.61s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [24:35<09:25, 35.35s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [25:10<08:50, 35.37s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [26:08<09:50, 42.16s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [26:33<08:02, 37.10s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [27:31<08:38, 43.24s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [28:14<07:56, 43.32s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [29:12<07:57, 47.75s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [29:37<06:06, 40.74s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [30:34<06:05, 45.74s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [31:27<05:35, 47.92s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [32:25<05:04, 50.74s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:03<03:54, 46.91s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:00<03:20, 50.09s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [34:35<02:16, 45.66s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [35:05<01:21, 40.86s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [36:04<00:46, 46.26s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:02<00:00, 49.76s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [37:02<00:00, 44.45s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 3.5623} | lm_loss 7.6933 | avg. gen lenth: 163.052
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s10-rFalse --seed 10 --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 10:03:03,644] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  2%|██▍                                                                                                                                               | 165/9741 [00:00<00:05, 1648.25it/s]  3%|████▉                                                                                                                                             | 331/9741 [00:00<00:05, 1650.26it/s]  5%|███████▍                                                                                                                                          | 498/9741 [00:00<00:05, 1657.90it/s]  7%|█████████▉                                                                                                                                        | 665/9741 [00:00<00:05, 1660.15it/s]  9%|████████████▍                                                                                                                                     | 833/9741 [00:00<00:05, 1666.38it/s] 10%|██████████████▉                                                                                                                                  | 1001/9741 [00:00<00:05, 1669.27it/s] 12%|█████████████████▍                                                                                                                               | 1169/9741 [00:00<00:05, 1672.48it/s] 14%|███████████████████▉                                                                                                                             | 1337/9741 [00:00<00:05, 1670.07it/s] 15%|██████████████████████▍                                                                                                                          | 1505/9741 [00:00<00:05, 1640.60it/s] 17%|████████████████████████▉                                                                                                                        | 1672/9741 [00:01<00:04, 1646.73it/s] 19%|███████████████████████████▎                                                                                                                     | 1837/9741 [00:01<00:04, 1618.64it/s] 21%|█████████████████████████████▊                                                                                                                   | 2004/9741 [00:01<00:04, 1632.47it/s] 22%|████████████████████████████████▎                                                                                                                | 2169/9741 [00:01<00:04, 1636.85it/s] 24%|██████████████████████████████████▊                                                                                                              | 2336/9741 [00:01<00:04, 1644.24it/s] 26%|█████████████████████████████████████▎                                                                                                           | 2504/9741 [00:01<00:04, 1652.48it/s] 27%|███████████████████████████████████████▊                                                                                                         | 2671/9741 [00:01<00:04, 1655.97it/s] 29%|██████████████████████████████████████████▏                                                                                                      | 2837/9741 [00:01<00:04, 1650.67it/s] 31%|████████████████████████████████████████████▋                                                                                                    | 3004/9741 [00:01<00:04, 1654.67it/s] 33%|███████████████████████████████████████████████▏                                                                                                 | 3170/9741 [00:01<00:03, 1649.91it/s] 34%|█████████████████████████████████████████████████▋                                                                                               | 3337/9741 [00:02<00:03, 1653.97it/s] 36%|████████████████████████████████████████████████████▏                                                                                            | 3503/9741 [00:02<00:03, 1655.29it/s] 38%|██████████████████████████████████████████████████████▌                                                                                          | 3669/9741 [00:02<00:03, 1653.39it/s] 39%|█████████████████████████████████████████████████████████                                                                                        | 3836/9741 [00:02<00:03, 1657.20it/s] 41%|███████████████████████████████████████████████████████████▌                                                                                     | 4004/9741 [00:02<00:03, 1661.48it/s] 43%|██████████████████████████████████████████████████████████████                                                                                   | 4171/9741 [00:02<00:03, 1658.50it/s] 45%|████████████████████████████████████████████████████████████████▌                                                                                | 4337/9741 [00:02<00:03, 1657.82it/s] 47%|███████████████████████████████████████████████████████████████████▌                                                                             | 4535/9741 [00:02<00:02, 1752.23it/s] 49%|██████████████████████████████████████████████████████████████████████▌                                                                          | 4740/9741 [00:02<00:03, 1662.68it/s] 51%|██████████████████████████████████████████████████████████████████████████▎                                                                      | 4991/9741 [00:02<00:02, 1896.63it/s] 54%|██████████████████████████████████████████████████████████████████████████████                                                                   | 5245/9741 [00:03<00:02, 2078.21it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▊                                                               | 5500/9741 [00:03<00:01, 2212.38it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▋                                                           | 5756/9741 [00:03<00:01, 2311.89it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▋                                                       | 6021/9741 [00:03<00:01, 2410.31it/s] 65%|█████████████████████████████████████████████████████████████████████████████████████████████▌                                                   | 6287/9741 [00:03<00:01, 2481.54it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████▌                                               | 6551/9741 [00:03<00:01, 2525.69it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▍                                           | 6817/9741 [00:03<00:01, 2565.46it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                       | 7084/9741 [00:03<00:01, 2595.31it/s] 75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                   | 7351/9741 [00:03<00:00, 2615.53it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                               | 7613/9741 [00:03<00:00, 2592.33it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                           | 7879/9741 [00:04<00:00, 2610.19it/s] 84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                       | 8145/9741 [00:04<00:00, 2624.03it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 8412/9741 [00:04<00:00, 2635.52it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏               | 8677/9741 [00:04<00:00, 2639.52it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████            | 8942/9741 [00:04<00:00, 2641.51it/s] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████        | 9207/9741 [00:04<00:00, 2609.43it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉    | 9472/9741 [00:04<00:00, 2619.59it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉| 9737/9741 [00:04<00:00, 2626.63it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:04<00:00, 2040.76it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.09s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.03s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.32s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.38s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.15s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.33s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.30s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.48s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.47s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.64s/it]
[2023-08-11 10:03:59,495] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.60s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.93s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.84s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.00s/it]
[2023-08-11 10:04:09,375] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 10:04:09,376] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 10:04:09,376] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 10:04:09,376] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fd7bbd64e80>
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 10:04:09,377] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fd7b89ad910>
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 10:04:09,378] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 10:04:09,379] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 10:04:09,379] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 10:04:09,379] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 10:04:09,379] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 10:04:09,379] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 10:04:09,379] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 10:04:09,379] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.39635467529296875 seconds
Loading extension module utils...
Time to load utils op: 0.3042311668395996 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Answer: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Answer: 4

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.4046285152435303 seconds
Loading extension module utils...
Time to load utils op: 0.3043198585510254 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:56<45:56, 56.26s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:26<32:51, 41.08s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:24<38:08, 48.69s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:21<39:59, 52.17s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:17<39:56, 53.25s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [04:30<29:12, 39.82s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [05:10<28:28, 39.74s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [05:53<28:29, 40.71s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [06:46<30:36, 44.78s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [07:11<25:39, 38.50s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [07:37<22:32, 34.69s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [08:29<25:14, 39.85s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [08:53<21:45, 35.27s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [09:28<21:06, 35.17s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [09:48<17:44, 30.41s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [10:07<15:24, 27.20s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [10:37<15:19, 27.86s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [11:33<19:26, 36.45s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [12:21<20:32, 39.76s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [13:01<19:59, 39.98s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [13:58<21:43, 44.95s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [14:53<22:23, 48.00s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [15:39<21:18, 47.35s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [16:35<21:40, 50.02s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [17:32<21:45, 52.22s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [18:22<20:37, 51.57s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [18:49<16:51, 43.99s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [19:23<15:05, 41.17s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [20:21<16:06, 46.04s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [21:08<15:26, 46.32s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [22:04<15:39, 49.45s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [22:30<12:43, 42.39s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [23:25<13:03, 46.08s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [23:49<10:33, 39.57s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [24:46<11:10, 44.73s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [25:10<09:00, 38.59s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [25:41<07:51, 36.28s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [26:37<08:24, 42.05s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [27:34<08:31, 46.46s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [27:58<06:39, 39.97s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [28:33<05:43, 38.22s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [29:26<05:42, 42.87s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [30:22<05:26, 46.61s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [30:42<03:53, 38.87s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [31:29<03:25, 41.16s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [31:55<02:26, 36.60s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [32:51<02:07, 42.55s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [33:48<01:33, 46.67s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [34:25<00:43, 43.86s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:20<00:00, 47.10s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [35:20<00:00, 42.40s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 4.6994} | lm_loss 7.6761 | avg. gen lenth: 166.744
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s10-rFalse --seed 10 --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 10:43:12,445] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|█▉                                                                                                                                                | 131/9741 [00:00<00:07, 1300.45it/s]  3%|███▉                                                                                                                                              | 262/9741 [00:00<00:07, 1303.55it/s]  4%|█████▉                                                                                                                                            | 394/9741 [00:00<00:07, 1310.32it/s]  5%|███████▉                                                                                                                                          | 526/9741 [00:00<00:07, 1311.62it/s]  7%|█████████▊                                                                                                                                        | 658/9741 [00:00<00:06, 1310.25it/s]  8%|███████████▊                                                                                                                                      | 791/9741 [00:00<00:06, 1314.35it/s]  9%|█████████████▊                                                                                                                                    | 923/9741 [00:00<00:06, 1315.93it/s] 11%|███████████████▋                                                                                                                                 | 1056/9741 [00:00<00:06, 1319.89it/s] 12%|█████████████████▋                                                                                                                               | 1188/9741 [00:00<00:06, 1288.36it/s] 14%|███████████████████▋                                                                                                                             | 1320/9741 [00:01<00:06, 1295.00it/s] 15%|█████████████████████▌                                                                                                                           | 1451/9741 [00:01<00:06, 1297.86it/s] 16%|███████████████████████▌                                                                                                                         | 1582/9741 [00:01<00:06, 1299.93it/s] 18%|█████████████████████████▌                                                                                                                       | 1715/9741 [00:01<00:06, 1306.29it/s] 19%|███████████████████████████▍                                                                                                                     | 1846/9741 [00:01<00:06, 1279.18it/s] 20%|█████████████████████████████▍                                                                                                                   | 1977/9741 [00:01<00:06, 1287.47it/s] 22%|███████████████████████████████▍                                                                                                                 | 2108/9741 [00:01<00:05, 1291.34it/s] 23%|█████████████████████████████████▎                                                                                                               | 2240/9741 [00:01<00:05, 1299.32it/s] 24%|███████████████████████████████████▎                                                                                                             | 2371/9741 [00:01<00:05, 1301.94it/s] 26%|█████████████████████████████████████▏                                                                                                           | 2502/9741 [00:01<00:05, 1298.12it/s] 27%|███████████████████████████████████████▏                                                                                                         | 2633/9741 [00:02<00:05, 1300.32it/s] 29%|█████████████████████████████████████████▉                                                                                                       | 2815/9741 [00:02<00:04, 1454.45it/s] 31%|████████████████████████████████████████████▊                                                                                                    | 3014/9741 [00:02<00:04, 1612.67it/s] 33%|███████████████████████████████████████████████▊                                                                                                 | 3212/9741 [00:02<00:03, 1722.11it/s] 35%|██████████████████████████████████████████████████▊                                                                                              | 3412/9741 [00:02<00:03, 1802.92it/s] 37%|█████████████████████████████████████████████████████▋                                                                                           | 3610/9741 [00:02<00:03, 1853.15it/s] 39%|████████████████████████████████████████████████████████▋                                                                                        | 3809/9741 [00:02<00:03, 1893.72it/s] 41%|███████████████████████████████████████████████████████████▋                                                                                     | 4008/9741 [00:02<00:02, 1921.13it/s] 43%|██████████████████████████████████████████████████████████████▌                                                                                  | 4206/9741 [00:02<00:02, 1937.80it/s] 45%|█████████████████████████████████████████████████████████████████▌                                                                               | 4404/9741 [00:02<00:02, 1949.42it/s] 47%|████████████████████████████████████████████████████████████████████▍                                                                            | 4599/9741 [00:03<00:02, 1920.23it/s] 49%|███████████████████████████████████████████████████████████████████████▎                                                                         | 4792/9741 [00:03<00:03, 1460.63it/s] 51%|██████████████████████████████████████████████████████████████████████████▎                                                                      | 4989/9741 [00:03<00:03, 1583.93it/s] 53%|█████████████████████████████████████████████████████████████████████████████▏                                                                   | 5186/9741 [00:03<00:02, 1682.14it/s] 55%|████████████████████████████████████████████████████████████████████████████████▏                                                                | 5385/9741 [00:03<00:02, 1764.37it/s] 57%|███████████████████████████████████████████████████████████████████████████████████▏                                                             | 5589/9741 [00:03<00:02, 1839.38it/s] 60%|██████████████████████████████████████████████████████████████████████████████████████▎                                                          | 5797/9741 [00:03<00:02, 1906.24it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▍                                                       | 6005/9741 [00:03<00:01, 1955.02it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▍                                                    | 6213/9741 [00:03<00:01, 1989.63it/s] 66%|███████████████████████████████████████████████████████████████████████████████████████████████▌                                                 | 6418/9741 [00:04<00:01, 2005.73it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▌                                              | 6625/9741 [00:04<00:01, 2023.60it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                                           | 6832/9741 [00:04<00:01, 2037.00it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                        | 7041/9741 [00:04<00:01, 2050.29it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                     | 7247/9741 [00:04<00:01, 2035.20it/s] 77%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                  | 7452/9741 [00:04<00:01, 1979.45it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████                               | 7660/9741 [00:04<00:01, 2007.06it/s] 81%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                            | 7868/9741 [00:04<00:00, 2027.44it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 8075/9741 [00:04<00:00, 2039.36it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                     | 8284/9741 [00:04<00:00, 2051.87it/s] 87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                  | 8492/9741 [00:05<00:00, 2059.37it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍               | 8699/9741 [00:05<00:00, 2060.42it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 8906/9741 [00:05<00:00, 2060.50it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋         | 9113/9741 [00:05<00:00, 2060.87it/s] 96%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋      | 9321/9741 [00:05<00:00, 2064.65it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊   | 9529/9741 [00:05<00:00, 2067.51it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉| 9736/9741 [00:05<00:00, 2065.70it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:05<00:00, 1720.98it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.50s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.48s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.68s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.99s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.62s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.96s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.98s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.64s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.84s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.95s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.12s/it]
[2023-08-11 10:44:10,689] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.13s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.33s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.51s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.64s/it]
[2023-08-11 10:44:30,476] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 10:44:30,477] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 10:44:30,478] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 10:44:30,478] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 10:44:30,478] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 10:44:30,478] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 10:44:30,478] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 10:44:30,478] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 10:44:30,478] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 10:44:30,478] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 10:44:30,478] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 10:44:30,478] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fd956d7ee80>
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fd95de35910>
[2023-08-11 10:44:30,479] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 10:44:30,480] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 10:44:30,480] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4066436290740967 seconds
Loading extension module utils...
Time to load utils op: 0.4047226905822754 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.40468430519104004 seconds
Time to load utils op: 0.40438342094421387 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Answer: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Answer: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Answer: 480

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s10-rFalse
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:55<45:32, 55.76s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:33<35:59, 44.98s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:28<38:57, 49.74s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:24<40:00, 52.18s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:16<39:05, 52.12s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [05:11<38:56, 53.11s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [06:07<38:45, 54.09s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [07:01<37:53, 54.12s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:24<30:17, 44.33s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:18<31:33, 47.35s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [09:13<32:20, 49.75s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [10:08<32:28, 51.29s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [11:03<32:20, 52.46s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [11:47<29:48, 49.69s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [12:31<28:05, 48.16s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [13:13<26:09, 46.16s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [14:07<26:40, 48.51s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [14:53<25:28, 47.78s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [15:47<25:36, 49.58s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [16:42<25:39, 51.31s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [17:08<21:08, 43.74s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [17:40<18:41, 40.07s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [18:25<18:43, 41.62s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [19:20<19:48, 45.70s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [19:57<17:54, 42.98s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [20:21<14:59, 37.50s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [21:01<14:38, 38.20s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [21:42<14:18, 39.04s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [22:38<15:22, 43.92s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [23:18<14:15, 42.76s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [24:12<14:39, 46.27s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [24:32<11:31, 38.42s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [25:23<11:57, 42.18s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [26:18<12:14, 45.91s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [27:12<12:08, 48.54s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [28:05<11:37, 49.83s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [28:58<11:01, 50.86s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [29:14<08:04, 40.36s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [29:35<06:19, 34.52s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [29:56<05:03, 30.32s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [30:51<05:39, 37.67s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [31:43<05:37, 42.21s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [32:24<04:51, 41.64s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [33:19<04:34, 45.76s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [33:49<03:25, 41.01s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [34:22<02:34, 38.71s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [35:19<02:12, 44.14s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [36:14<01:34, 47.49s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [37:08<00:49, 49.33s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [38:02<00:00, 50.77s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [38:02<00:00, 45.65s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 3.0367} | lm_loss 7.6654 | avg. gen lenth: 199.144
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s10-rFalse --seed 10 --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-11 11:24:41,394] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|█▌                                                                                                                                                 | 100/9741 [00:00<00:09, 992.66it/s]  2%|███                                                                                                                                                | 200/9741 [00:00<00:09, 991.86it/s]  3%|████▌                                                                                                                                              | 300/9741 [00:00<00:09, 995.47it/s]  4%|██████                                                                                                                                             | 401/9741 [00:00<00:09, 997.13it/s]  5%|███████▌                                                                                                                                           | 501/9741 [00:00<00:09, 996.18it/s]  6%|█████████                                                                                                                                          | 602/9741 [00:00<00:09, 997.95it/s]  7%|██████████▌                                                                                                                                        | 703/9741 [00:00<00:09, 998.86it/s]  8%|████████████                                                                                                                                       | 803/9741 [00:00<00:08, 995.53it/s]  9%|█████████████▋                                                                                                                                     | 903/9741 [00:00<00:09, 976.45it/s] 10%|███████████████                                                                                                                                   | 1003/9741 [00:01<00:08, 981.71it/s] 11%|████████████████▌                                                                                                                                 | 1104/9741 [00:01<00:08, 989.19it/s] 12%|██████████████████                                                                                                                                | 1204/9741 [00:01<00:08, 990.74it/s] 13%|███████████████████▌                                                                                                                              | 1305/9741 [00:01<00:08, 995.03it/s] 14%|█████████████████████                                                                                                                             | 1405/9741 [00:01<00:08, 995.49it/s] 15%|██████████████████████▌                                                                                                                           | 1506/9741 [00:01<00:08, 997.96it/s] 16%|████████████████████████                                                                                                                          | 1607/9741 [00:01<00:08, 998.64it/s] 18%|█████████████████████████▍                                                                                                                       | 1708/9741 [00:01<00:08, 1001.95it/s] 19%|███████████████████████████                                                                                                                       | 1809/9741 [00:01<00:08, 978.40it/s] 20%|████████████████████████████▌                                                                                                                     | 1908/9741 [00:01<00:07, 980.06it/s] 21%|██████████████████████████████                                                                                                                    | 2008/9741 [00:02<00:07, 985.15it/s] 22%|███████████████████████████████▌                                                                                                                  | 2107/9741 [00:02<00:07, 985.71it/s] 23%|█████████████████████████████████                                                                                                                 | 2208/9741 [00:02<00:07, 990.26it/s] 24%|██████████████████████████████████▌                                                                                                               | 2308/9741 [00:02<00:07, 992.80it/s] 25%|████████████████████████████████████                                                                                                              | 2409/9741 [00:02<00:07, 996.09it/s] 26%|█████████████████████████████████████▌                                                                                                            | 2509/9741 [00:02<00:07, 996.57it/s] 27%|███████████████████████████████████████                                                                                                           | 2610/9741 [00:02<00:07, 998.84it/s] 28%|████████████████████████████████████████▌                                                                                                         | 2710/9741 [00:02<00:07, 997.24it/s] 29%|█████████████████████████████████████████▉                                                                                                       | 2814/9741 [00:02<00:06, 1009.84it/s] 30%|████████████████████████████████████████████▏                                                                                                    | 2967/9741 [00:02<00:05, 1163.94it/s] 32%|██████████████████████████████████████████████▍                                                                                                  | 3120/9741 [00:03<00:05, 1272.22it/s] 34%|████████████████████████████████████████████████▋                                                                                                | 3273/9741 [00:03<00:04, 1347.62it/s] 35%|██████████████████████████████████████████████████▉                                                                                              | 3422/9741 [00:03<00:04, 1387.71it/s] 37%|█████████████████████████████████████████████████████▏                                                                                           | 3574/9741 [00:03<00:04, 1425.36it/s] 38%|███████████████████████████████████████████████████████▍                                                                                         | 3726/9741 [00:03<00:04, 1452.93it/s] 40%|█████████████████████████████████████████████████████████▋                                                                                       | 3879/9741 [00:03<00:03, 1473.69it/s] 41%|████████████████████████████████████████████████████████████                                                                                     | 4033/9741 [00:03<00:03, 1491.94it/s] 43%|██████████████████████████████████████████████████████████████▎                                                                                  | 4186/9741 [00:03<00:03, 1501.31it/s] 45%|████████████████████████████████████████████████████████████████▌                                                                                | 4339/9741 [00:03<00:03, 1509.24it/s] 46%|██████████████████████████████████████████████████████████████████▉                                                                              | 4493/9741 [00:03<00:03, 1516.50it/s] 48%|█████████████████████████████████████████████████████████████████████▏                                                                           | 4645/9741 [00:04<00:03, 1482.02it/s] 49%|███████████████████████████████████████████████████████████████████████▎                                                                         | 4794/9741 [00:04<00:04, 1129.48it/s] 51%|█████████████████████████████████████████████████████████████████████████▌                                                                       | 4946/9741 [00:04<00:03, 1224.08it/s] 52%|███████████████████████████████████████████████████████████████████████████▉                                                                     | 5099/9741 [00:04<00:03, 1302.65it/s] 54%|██████████████████████████████████████████████████████████████████████████████                                                                   | 5245/9741 [00:04<00:03, 1343.19it/s] 55%|████████████████████████████████████████████████████████████████████████████████▎                                                                | 5398/9741 [00:04<00:03, 1391.03it/s] 57%|██████████████████████████████████████████████████████████████████████████████████▋                                                              | 5555/9741 [00:04<00:02, 1441.62it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████                                                            | 5713/9741 [00:04<00:02, 1480.38it/s] 60%|███████████████████████████████████████████████████████████████████████████████████████▍                                                         | 5872/9741 [00:04<00:02, 1511.37it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████▊                                                       | 6033/9741 [00:05<00:02, 1538.39it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▏                                                    | 6191/9741 [00:05<00:02, 1550.10it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▌                                                  | 6350/9741 [00:05<00:02, 1561.12it/s] 67%|████████████████████████████████████████████████████████████████████████████████████████████████▉                                                | 6510/9741 [00:05<00:02, 1572.20it/s] 68%|███████████████████████████████████████████████████████████████████████████████████████████████████▎                                             | 6669/9741 [00:05<00:01, 1575.91it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                                           | 6828/9741 [00:05<00:01, 1579.52it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████                                         | 6988/9741 [00:05<00:01, 1584.26it/s] 73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                      | 7149/9741 [00:05<00:01, 1590.70it/s] 75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                    | 7309/9741 [00:05<00:01, 1585.23it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 7468/9741 [00:05<00:01, 1546.77it/s] 78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                               | 7627/9741 [00:06<00:01, 1559.32it/s] 80%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                             | 7786/9741 [00:06<00:01, 1566.68it/s] 82%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                          | 7945/9741 [00:06<00:01, 1572.25it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                        | 8105/9741 [00:06<00:01, 1579.28it/s] 85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                      | 8264/9741 [00:06<00:00, 1580.52it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                   | 8423/9741 [00:06<00:00, 1576.22it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 8582/9741 [00:06<00:00, 1577.97it/s] 90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏              | 8742/9741 [00:06<00:00, 1581.89it/s] 91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍            | 8901/9741 [00:06<00:00, 1579.91it/s] 93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉          | 9061/9741 [00:06<00:00, 1583.59it/s] 95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎       | 9221/9741 [00:07<00:00, 1587.20it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋     | 9380/9741 [00:07<00:00, 1585.83it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉   | 9539/9741 [00:07<00:00, 1581.10it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎| 9698/9741 [00:07<00:00, 1580.13it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:07<00:00, 1316.40it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.44s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.53s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.50s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:11,  5.53s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.23s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.42s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.65s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.70s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.62s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.82s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.97s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.92s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.10s/it]
[2023-08-11 11:25:41,439] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.96s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.14s/it]
[2023-08-11 11:25:54,352] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 11:25:54,353] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 11:25:54,353] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 11:25:54,353] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 11:25:54,353] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 11:25:54,353] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f87fc140e80>
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 11:25:54,354] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f88203cc910>
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 11:25:54,355] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 11:25:54,355] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4067811965942383 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Answer: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Answer: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Answer: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Answer: 30

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s10-rFalse
Loading extension module utils...
Time to load utils op: 0.4044475555419922 seconds
Loading extension module utils...
Time to load utils op: 0.40456128120422363 seconds
Loading extension module utils...
Time to load utils op: 0.4043920040130615 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:53<43:37, 53.41s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:49<43:48, 54.75s/it]Evaluating commonsenseqa :   6%|███████▌                                                                                                                     | 3/50 [02:42<42:16, 53.96s/it]Evaluating commonsenseqa :   8%|██████████                                                                                                                   | 4/50 [03:31<40:04, 52.26s/it]Evaluating commonsenseqa :  10%|████████████▌                                                                                                                | 5/50 [04:24<39:16, 52.36s/it]Evaluating commonsenseqa :  12%|███████████████                                                                                                              | 6/50 [05:18<38:53, 53.04s/it]Evaluating commonsenseqa :  14%|█████████████████▌                                                                                                           | 7/50 [06:12<38:05, 53.15s/it]Evaluating commonsenseqa :  16%|████████████████████                                                                                                         | 8/50 [07:05<37:10, 53.10s/it]Evaluating commonsenseqa :  18%|██████████████████████▌                                                                                                      | 9/50 [07:58<36:24, 53.27s/it]Evaluating commonsenseqa :  20%|████████████████████████▊                                                                                                   | 10/50 [08:31<31:13, 46.83s/it]Evaluating commonsenseqa :  22%|███████████████████████████▎                                                                                                | 11/50 [09:24<31:44, 48.82s/it]Evaluating commonsenseqa :  24%|█████████████████████████████▊                                                                                              | 12/50 [10:18<31:54, 50.39s/it]Evaluating commonsenseqa :  26%|████████████████████████████████▏                                                                                           | 13/50 [11:11<31:38, 51.32s/it]Evaluating commonsenseqa :  28%|██████████████████████████████████▋                                                                                         | 14/50 [11:39<26:29, 44.17s/it]Evaluating commonsenseqa :  30%|█████████████████████████████████████▏                                                                                      | 15/50 [12:32<27:19, 46.85s/it]Evaluating commonsenseqa :  32%|███████████████████████████████████████▋                                                                                    | 16/50 [13:26<27:48, 49.06s/it]Evaluating commonsenseqa :  34%|██████████████████████████████████████████▏                                                                                 | 17/50 [14:21<27:56, 50.79s/it]Evaluating commonsenseqa :  36%|████████████████████████████████████████████▋                                                                               | 18/50 [15:15<27:31, 51.62s/it]Evaluating commonsenseqa :  38%|███████████████████████████████████████████████                                                                             | 19/50 [16:07<26:47, 51.86s/it]Evaluating commonsenseqa :  40%|█████████████████████████████████████████████████▌                                                                          | 20/50 [16:54<25:07, 50.24s/it]Evaluating commonsenseqa :  42%|████████████████████████████████████████████████████                                                                        | 21/50 [17:48<24:55, 51.59s/it]Evaluating commonsenseqa :  44%|██████████████████████████████████████████████████████▌                                                                     | 22/50 [18:42<24:20, 52.16s/it]Evaluating commonsenseqa :  46%|█████████████████████████████████████████████████████████                                                                   | 23/50 [19:35<23:37, 52.50s/it]Evaluating commonsenseqa :  48%|███████████████████████████████████████████████████████████▌                                                                | 24/50 [19:48<17:39, 40.74s/it]Evaluating commonsenseqa :  50%|██████████████████████████████████████████████████████████████                                                              | 25/50 [20:26<16:33, 39.75s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████████████████████████████████▍                                                           | 26/50 [21:20<17:35, 43.99s/it]Evaluating commonsenseqa :  54%|██████████████████████████████████████████████████████████████████▉                                                         | 27/50 [22:13<17:55, 46.75s/it]Evaluating commonsenseqa :  56%|█████████████████████████████████████████████████████████████████████▍                                                      | 28/50 [23:06<17:51, 48.68s/it]Evaluating commonsenseqa :  58%|███████████████████████████████████████████████████████████████████████▉                                                    | 29/50 [24:00<17:35, 50.26s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████████████████████████████████████▍                                                 | 30/50 [24:52<16:56, 50.81s/it]Evaluating commonsenseqa :  62%|████████████████████████████████████████████████████████████████████████████▉                                               | 31/50 [25:47<16:26, 51.93s/it]Evaluating commonsenseqa :  64%|███████████████████████████████████████████████████████████████████████████████▎                                            | 32/50 [26:40<15:43, 52.43s/it]Evaluating commonsenseqa :  66%|█████████████████████████████████████████████████████████████████████████████████▊                                          | 33/50 [27:33<14:55, 52.67s/it]Evaluating commonsenseqa :  68%|████████████████████████████████████████████████████████████████████████████████████▎                                       | 34/50 [28:10<12:44, 47.77s/it]Evaluating commonsenseqa :  70%|██████████████████████████████████████████████████████████████████████████████████████▊                                     | 35/50 [28:53<11:36, 46.42s/it]Evaluating commonsenseqa :  72%|█████████████████████████████████████████████████████████████████████████████████████████▎                                  | 36/50 [29:09<08:42, 37.34s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████████████████████████████████████████████▊                                | 37/50 [29:38<07:33, 34.87s/it]Evaluating commonsenseqa :  76%|██████████████████████████████████████████████████████████████████████████████████████████████▏                             | 38/50 [30:32<08:07, 40.64s/it]Evaluating commonsenseqa :  78%|████████████████████████████████████████████████████████████████████████████████████████████████▋                           | 39/50 [30:56<06:30, 35.53s/it]Evaluating commonsenseqa :  80%|███████████████████████████████████████████████████████████████████████████████████████████████████▏                        | 40/50 [31:39<06:18, 37.84s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████▋                      | 41/50 [32:32<06:22, 42.46s/it]Evaluating commonsenseqa :  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   | 42/50 [33:25<06:03, 45.46s/it]Evaluating commonsenseqa :  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 43/50 [34:01<04:58, 42.69s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████               | 44/50 [34:54<04:34, 45.77s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 45/50 [35:35<03:41, 44.36s/it]Evaluating commonsenseqa :  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████          | 46/50 [36:06<02:41, 40.38s/it]Evaluating commonsenseqa :  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       | 47/50 [37:00<02:13, 44.35s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████     | 48/50 [37:54<01:34, 47.31s/it]Evaluating commonsenseqa :  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌  | 49/50 [38:41<00:47, 47.21s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:19<00:00, 44.55s/it]Evaluating commonsenseqa : 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [39:19<00:00, 47.20s/it]
name: commonsenseqa | {'exact_match': 0.4, 'rougeL': 4.157} | lm_loss 7.7213 | avg. gen lenth: 211.02
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s10-rFalse --seed 10 --num-out-domain 5
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[2023-08-11 12:06:30,390] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o5-tgsm8k-s10-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 5
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s10-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  num_beams .................... 1
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 10
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                                                                              | 0/9741 [00:00<?, ?it/s]  1%|█▍                                                                                                                                                  | 92/9741 [00:00<00:10, 914.30it/s]  2%|██▊                                                                                                                                                | 184/9741 [00:00<00:10, 916.99it/s]  3%|████▏                                                                                                                                              | 276/9741 [00:00<00:10, 915.25it/s]  4%|█████▌                                                                                                                                             | 369/9741 [00:00<00:10, 919.49it/s]  5%|██████▉                                                                                                                                            | 461/9741 [00:00<00:10, 918.91it/s]  6%|████████▎                                                                                                                                          | 554/9741 [00:00<00:09, 920.99it/s]  7%|█████████▊                                                                                                                                         | 647/9741 [00:00<00:09, 921.79it/s]  8%|███████████▏                                                                                                                                       | 740/9741 [00:00<00:09, 921.01it/s]  9%|████████████▌                                                                                                                                      | 833/9741 [00:00<00:09, 906.51it/s]  9%|█████████████▉                                                                                                                                     | 924/9741 [00:01<00:09, 907.06it/s] 10%|███████████████▏                                                                                                                                  | 1017/9741 [00:01<00:09, 912.30it/s] 11%|████████████████▋                                                                                                                                 | 1110/9741 [00:01<00:09, 915.18it/s] 12%|██████████████████                                                                                                                                | 1203/9741 [00:01<00:09, 917.86it/s] 13%|███████████████████▍                                                                                                                              | 1296/9741 [00:01<00:09, 920.45it/s] 14%|████████████████████▊                                                                                                                             | 1389/9741 [00:01<00:09, 918.06it/s] 15%|██████████████████████▏                                                                                                                           | 1482/9741 [00:01<00:08, 920.41it/s] 16%|███████████████████████▌                                                                                                                          | 1575/9741 [00:01<00:08, 920.01it/s] 17%|█████████████████████████                                                                                                                         | 1668/9741 [00:01<00:08, 922.12it/s] 18%|██████████████████████████▍                                                                                                                       | 1761/9741 [00:01<00:08, 918.83it/s] 19%|███████████████████████████▊                                                                                                                      | 1853/9741 [00:02<00:08, 893.32it/s] 20%|█████████████████████████████▏                                                                                                                    | 1946/9741 [00:02<00:08, 901.78it/s] 21%|██████████████████████████████▌                                                                                                                   | 2038/9741 [00:02<00:08, 906.29it/s] 22%|███████████████████████████████▉                                                                                                                  | 2131/9741 [00:02<00:08, 910.94it/s] 23%|█████████████████████████████████▎                                                                                                                | 2224/9741 [00:02<00:08, 916.25it/s] 24%|██████████████████████████████████▋                                                                                                               | 2316/9741 [00:02<00:08, 917.14it/s] 25%|████████████████████████████████████                                                                                                              | 2410/9741 [00:02<00:07, 921.06it/s] 26%|█████████████████████████████████████▋                                                                                                           | 2531/9741 [00:02<00:07, 1006.09it/s] 27%|███████████████████████████████████████▊                                                                                                         | 2673/9741 [00:02<00:06, 1128.52it/s] 29%|█████████████████████████████████████████▊                                                                                                       | 2812/9741 [00:02<00:05, 1206.61it/s] 30%|███████████████████████████████████████████▉                                                                                                     | 2951/9741 [00:03<00:05, 1258.69it/s] 32%|██████████████████████████████████████████████                                                                                                   | 3091/9741 [00:03<00:05, 1298.35it/s] 33%|████████████████████████████████████████████████                                                                                                 | 3231/9741 [00:03<00:04, 1328.12it/s] 35%|██████████████████████████████████████████████████▏                                                                                              | 3373/9741 [00:03<00:04, 1353.03it/s] 36%|████████████████████████████████████████████████████▎                                                                                            | 3514/9741 [00:03<00:04, 1367.41it/s] 38%|██████████████████████████████████████████████████████▍                                                                                          | 3655/9741 [00:03<00:04, 1378.74it/s] 39%|████████████████████████████████████████████████████████▌                                                                                        | 3796/9741 [00:03<00:04, 1387.02it/s] 40%|██████████████████████████████████████████████████████████▌                                                                                      | 3936/9741 [00:03<00:04, 1388.14it/s] 42%|████████████████████████████████████████████████████████████▋                                                                                    | 4077/9741 [00:03<00:04, 1393.74it/s] 43%|██████████████████████████████████████████████████████████████▊                                                                                  | 4218/9741 [00:03<00:03, 1397.78it/s] 45%|████████████████████████████████████████████████████████████████▉                                                                                | 4359/9741 [00:04<00:03, 1399.16it/s] 46%|██████████████████████████████████████████████████████████████████▉                                                                              | 4500/9741 [00:04<00:03, 1401.76it/s] 48%|█████████████████████████████████████████████████████████████████████                                                                            | 4641/9741 [00:04<00:03, 1359.82it/s] 49%|███████████████████████████████████████████████████████████████████████                                                                          | 4778/9741 [00:04<00:04, 1046.83it/s] 50%|█████████████████████████████████████████████████████████████████████████▏                                                                       | 4918/9741 [00:04<00:04, 1130.89it/s] 52%|███████████████████████████████████████████████████████████████████████████▎                                                                     | 5059/9741 [00:04<00:03, 1201.00it/s] 53%|█████████████████████████████████████████████████████████████████████████████▍                                                                   | 5200/9741 [00:04<00:03, 1255.46it/s] 55%|███████████████████████████████████████████████████████████████████████████████▌                                                                 | 5342/9741 [00:04<00:03, 1298.82it/s] 56%|█████████████████████████████████████████████████████████████████████████████████▌                                                               | 5481/9741 [00:04<00:03, 1322.53it/s] 58%|███████████████████████████████████████████████████████████████████████████████████▊                                                             | 5627/9741 [00:05<00:03, 1360.79it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████▉                                                           | 5774/9741 [00:05<00:02, 1392.56it/s] 61%|████████████████████████████████████████████████████████████████████████████████████████                                                         | 5918/9741 [00:05<00:02, 1406.14it/s] 62%|██████████████████████████████████████████████████████████████████████████████████████████▎                                                      | 6064/9741 [00:05<00:02, 1420.24it/s] 64%|████████████████████████████████████████████████████████████████████████████████████████████▍                                                    | 6210/9741 [00:05<00:02, 1430.63it/s] 65%|██████████████████████████████████████████████████████████████████████████████████████████████▌                                                  | 6356/9741 [00:05<00:02, 1436.43it/s] 67%|████████████████████████████████████████████████████████████████████████████████████████████████▊                                                | 6503/9741 [00:05<00:02, 1444.43it/s] 68%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                                              | 6648/9741 [00:05<00:02, 1440.90it/s] 70%|█████████████████████████████████████████████████████████████████████████████████████████████████████                                            | 6793/9741 [00:05<00:02, 1436.37it/s] 71%|███████████████████████████████████████████████████████████████████████████████████████████████████████▎                                         | 6940/9741 [00:05<00:01, 1443.83it/s] 73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                       | 7086/9741 [00:06<00:01, 1445.92it/s] 74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                     | 7231/9741 [00:06<00:01, 1445.83it/s] 76%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                   | 7378/9741 [00:06<00:01, 1450.44it/s] 77%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                 | 7524/9741 [00:06<00:01, 1408.87it/s] 79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                              | 7670/9741 [00:06<00:01, 1421.15it/s] 80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                            | 7817/9741 [00:06<00:01, 1435.20it/s] 82%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                          | 7964/9741 [00:06<00:01, 1442.74it/s] 83%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                        | 8111/9741 [00:06<00:01, 1450.16it/s] 85%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                      | 8258/9741 [00:06<00:01, 1454.29it/s] 86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                    | 8404/9741 [00:06<00:00, 1454.21it/s] 88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                 | 8551/9741 [00:07<00:00, 1457.63it/s] 89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍               | 8697/9741 [00:07<00:00, 1438.73it/s] 91%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌             | 8842/9741 [00:07<00:00, 1440.81it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊           | 8987/9741 [00:07<00:00, 1440.38it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉         | 9132/9741 [00:07<00:00, 1431.58it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████       | 9276/9741 [00:07<00:00, 1432.56it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎    | 9423/9741 [00:07<00:00, 1442.07it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍  | 9568/9741 [00:07<00:00, 1439.52it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌| 9713/9741 [00:07<00:00, 1440.56it/s]100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:07<00:00, 1232.07it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                                                                      | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.10s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.11s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.33s/it]Loading checkpoint shards:  33%|██████████████████████████████████████████                                                                                    | 1/3 [00:05<00:10,  5.45s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:09<00:04,  4.95s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.17s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:10<00:05,  5.29s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████████████████████████████████████████                                          | 2/3 [00:11<00:05,  5.55s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.38s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.55s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.81s/it]
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.87s/it]
[2023-08-11 12:07:30,257] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:18<00:00,  6.35s/it]Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:18<00:00,  6.13s/it]
[2023-08-11 12:07:45,063] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-11 12:07:45,064] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-11 12:07:45,065] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-11 12:07:45,065] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-11 12:07:45,065] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-11 12:07:45,065] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-11 12:07:45,066] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-11 12:07:45,066] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-11 12:07:45,066] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-11 12:07:45,066] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-11 12:07:45,066] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-11 12:07:45,066] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fd0badbee80>
[2023-08-11 12:07:45,066] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-11 12:07:45,066] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-11 12:07:45,066] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-11 12:07:45,066] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-11 12:07:45,066] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-11 12:07:45,066] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fd0bf2ce910>
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-11 12:07:45,067] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-11 12:07:45,068] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-11 12:07:45,068] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.42901182174682617 seconds
Loading extension module utils...
Loading extension module utils...
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Time to load utils op: 0.4043591022491455 seconds
Time to load utils op: 0.40454602241516113 seconds
Evaluating commonsenseqa :   0%|                                                                                                                                     | 0/50 [00:00<?, ?it/s]############### Example ###############
Loading extension module utils...
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: Adam bought 3 kilograms of nuts and 2.5 kilograms of dried fruits at a store. One kilogram of nuts costs $12 and one kilogram of dried fruit costs $8. How much did his purchases cost?
Answer: 56

Input: Johns goes to the gym 3 times a week.  He spends 1 hour each day lifting weight. Additionally, he also spends a third of his weightlifting time warming up and doing cardio each day.  How many hours does he spend at the gym a week?
Answer: 4

Input: James has to refuel his plane.  It used to cost $200 to refill the tank.  He got an extra tank to double fuel capacity.  Fuel prices also went up by 20%.  How much does he pay now for fuel?
Answer: 480

Input: The number of goals scored in a game against Barca by exactly two players last season accounts for 20% of all goals scored in the league. If the players scored an equal number of goals, and the total number of goals scored in the league against Barca that season is 300, calculate the number of goals each of the two players scored.
Answer: 30

Input: Every day Tom drinks 5 12-oz cans of soda plus 64 ounces of water. How many ounces of fluid does he drink a week?
Answer: 868

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o5-tgsm8k-s10-rFalse
Time to load utils op: 0.40441441535949707 seconds
Evaluating commonsenseqa :   2%|██▌                                                                                                                          | 1/50 [00:52<43:14, 52.94s/it]Evaluating commonsenseqa :   4%|█████                                                                                                                        | 2/50 [01:47<42:54, 53.64s/it]