PYTHONPATH=/home/ylu130/workspace/in-context-generalization
torchrun --nproc_per_node 5 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 2113 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 5 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-out-domain 0 --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 4 --seed 42 --data-dir /scratch/ylu130/processed_data/commonsenseqa/in-domain/i0-s42-rTrue --rationales --num-in-domain 0
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 5
[2023-08-08 13:16:16,280] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 5
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/in-domain/i0-s42-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 0
  out_domain_data_name ......... None
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/in-domain/i0-s42-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 4
  clip_grad .................... 1.0
  seed ......................... 42
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 5
Loading Data
  0%|                                                                                    | 0/9741 [00:00<?, ?it/s]  3%|██▏                                                                     | 295/9741 [00:00<00:03, 2947.77it/s]  6%|████▌                                                                   | 610/9741 [00:00<00:02, 3061.45it/s] 10%|██████▊                                                                 | 926/9741 [00:00<00:02, 3106.09it/s] 13%|█████████                                                              | 1244/9741 [00:00<00:02, 3134.97it/s] 16%|███████████▎                                                           | 1559/9741 [00:00<00:02, 3138.13it/s] 19%|█████████████▋                                                         | 1873/9741 [00:00<00:02, 2955.52it/s] 22%|███████████████▉                                                       | 2182/9741 [00:00<00:02, 2995.70it/s] 26%|██████████████████▏                                                    | 2494/9741 [00:00<00:02, 3033.36it/s] 29%|████████████████████▍                                                  | 2804/9741 [00:00<00:02, 3052.08it/s] 32%|██████████████████████▋                                                | 3116/9741 [00:01<00:02, 3071.82it/s] 35%|████████████████████████▉                                              | 3426/9741 [00:01<00:02, 3080.24it/s] 38%|███████████████████████████▏                                           | 3736/9741 [00:01<00:01, 3084.59it/s] 42%|█████████████████████████████▌                                         | 4049/9741 [00:01<00:01, 3097.72it/s] 45%|███████████████████████████████▊                                       | 4360/9741 [00:01<00:01, 3098.90it/s] 48%|██████████████████████████████████                                     | 4671/9741 [00:01<00:01, 3051.73it/s] 51%|████████████████████████████████████▎                                  | 4977/9741 [00:01<00:02, 2028.97it/s] 54%|██████████████████████████████████████▌                                | 5285/9741 [00:01<00:01, 2259.03it/s] 57%|████████████████████████████████████████▊                              | 5601/9741 [00:01<00:01, 2473.12it/s] 61%|███████████████████████████████████████████▏                           | 5929/9741 [00:02<00:01, 2676.92it/s] 64%|█████████████████████████████████████████████▌                         | 6259/9741 [00:02<00:01, 2840.83it/s] 68%|████████████████████████████████████████████████                       | 6595/9741 [00:02<00:01, 2981.35it/s] 71%|██████████████████████████████████████████████████▌                    | 6937/9741 [00:02<00:00, 3105.09it/s] 75%|█████████████████████████████████████████████████████▌                 | 7348/9741 [00:02<00:00, 3392.06it/s] 80%|█████████████████████████████████████████████████████████▏             | 7839/9741 [00:02<00:00, 3832.28it/s] 86%|████████████████████████████████████████████████████████████▉          | 8360/9741 [00:02<00:00, 4234.95it/s] 91%|████████████████████████████████████████████████████████████████▋      | 8880/9741 [00:02<00:00, 4519.33it/s] 97%|████████████████████████████████████████████████████████████████████▌  | 9403/9741 [00:02<00:00, 4728.34it/s]100%|███████████████████████████████████████████████████████████████████████| 9741/9741 [00:02<00:00, 3287.76it/s]
Load End
Num instances: 1000
